[{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(auth)\\forgot-password\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(auth)\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(auth)\\login\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(auth)\\login\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(auth)\\register\\ambulancia\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(auth)\\register\\clinica\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(auth)\\register\\farmacia\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(auth)\\register\\laboratorio\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(auth)\\register\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(auth)\\register\\medico\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(auth)\\register\\paciente\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(auth)\\register\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(auth)\\register\\seguro\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(auth)\\reset-password\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(protected)\\academy\\comunidad\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(protected)\\academy\\dashboard\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(protected)\\academy\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(protected)\\academy\\mis-certificaciones\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(protected)\\academy\\mis-cursos\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\blog\\escribir\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'checkUserAndLoadData'. Either include it or remove the dependency array.","line":53,"column":6,"nodeType":"ArrayExpression","endLine":53,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [checkUserAndLoadData]","fix":{"range":[1668,1670],"text":"[checkUserAndLoadData]"}}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":304,"column":23,"nodeType":"JSXOpeningElement","endLine":308,"endColumn":25},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":398,"column":19,"nodeType":"JSXOpeningElement","endLine":402,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport Link from \"next/link\";\r\nimport { motion } from \"framer-motion\";\r\nimport { Card } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { Textarea } from \"@red-salud/ui\";\r\nimport { Label } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@red-salud/ui\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@red-salud/ui\";\r\nimport {\r\n  ArrowLeft, Save, Eye, Send, X, Plus,\r\n  BookOpen, Shield, AlertCircle, CheckCircle\r\n} from \"lucide-react\";\r\nimport { createPost, getCategories } from \"@/lib/api/blog\";\r\nimport type { BlogCategory, CreatePostInput, PostStatus } from \"@/lib/types/blog\";\r\nimport { createClient } from \"@/lib/supabase/client\";\r\n\r\nexport default function WritePostPage() {\r\n  const router = useRouter();\r\n  const supabase = createClient();\r\n  \r\n  const [categories, setCategories] = useState<BlogCategory[]>([]);\r\n  const [isVerifiedDoctor, setIsVerifiedDoctor] = useState<boolean | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [saving, setSaving] = useState(false);\r\n  const [activeTab, setActiveTab] = useState(\"escribir\");\r\n  \r\n  const [post, setPost] = useState<CreatePostInput>({\r\n    title: \"\",\r\n    content: \"\",\r\n    excerpt: \"\",\r\n    category_id: undefined,\r\n    tags: [],\r\n    cover_image: \"\",\r\n    status: \"draft\",\r\n  });\r\n  \r\n  const [newTag, setNewTag] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    checkUserAndLoadData();\r\n  }, []);\r\n\r\n  async function checkUserAndLoadData() {\r\n    setLoading(true);\r\n    try {\r\n      // Check if user is logged in and is a verified doctor\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      \r\n      if (!user) {\r\n        setIsVerifiedDoctor(false);\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      // Check if user is a verified doctor\r\n      const { data: doctorDetails } = await supabase\r\n        .from('doctor_details')\r\n        .select('verified')\r\n        .eq('profile_id', user.id)\r\n        .single();\r\n\r\n      setIsVerifiedDoctor(doctorDetails?.verified || false);\r\n\r\n      // Load categories\r\n      const categoriesData = await getCategories();\r\n      setCategories(categoriesData);\r\n    } catch (error) {\r\n      console.error(\"Error checking user:\", error);\r\n      setIsVerifiedDoctor(false);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  function handleAddTag() {\r\n    if (newTag.trim() && !post.tags?.includes(newTag.trim())) {\r\n      setPost(prev => ({\r\n        ...prev,\r\n        tags: [...(prev.tags || []), newTag.trim()],\r\n      }));\r\n      setNewTag(\"\");\r\n    }\r\n  }\r\n\r\n  function handleRemoveTag(tag: string) {\r\n    setPost(prev => ({\r\n      ...prev,\r\n      tags: prev.tags?.filter(t => t !== tag) || [],\r\n    }));\r\n  }\r\n\r\n  async function handleSave(status: PostStatus) {\r\n    if (!post.title.trim() || !post.content.trim()) {\r\n      alert(\"Por favor completa el título y contenido del artículo\");\r\n      return;\r\n    }\r\n\r\n    setSaving(true);\r\n    try {\r\n      const createdPost = await createPost({\r\n        ...post,\r\n        status,\r\n      });\r\n      \r\n      if (status === 'published') {\r\n        router.push(`/blog/${createdPost.slug}`);\r\n      } else {\r\n        alert(\"Borrador guardado exitosamente\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error saving post:\", error);\r\n      alert(\"Error al guardar el artículo\");\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  }\r\n\r\n  // Calculate reading time\r\n  const wordCount = post.content.split(/\\s+/).filter(Boolean).length;\r\n  const readingTime = Math.max(1, Math.ceil(wordCount / 200));\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center\">\r\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!isVerifiedDoctor) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900\">\r\n        <div className=\"bg-white dark:bg-gray-800 border-b\">\r\n          <div className=\"container mx-auto px-4 py-4\">\r\n            <Link href=\"/blog\" className=\"inline-flex items-center text-gray-600 hover:text-blue-600 transition-colors\">\r\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\r\n              Volver al blog\r\n            </Link>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"container mx-auto px-4 py-16 max-w-2xl\">\r\n          <Card className=\"p-8 text-center\">\r\n            <div className=\"w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-6\">\r\n              <Shield className=\"h-8 w-8 text-yellow-600\" />\r\n            </div>\r\n            <h1 className=\"text-2xl font-bold mb-4\">Acceso Restringido</h1>\r\n            <p className=\"text-gray-600 mb-6\">\r\n              Solo los médicos verificados pueden escribir artículos en el blog. \r\n              Esto garantiza la calidad y veracidad del contenido médico.\r\n            </p>\r\n            \r\n            <div className=\"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 mb-6 text-left\">\r\n              <h3 className=\"font-semibold text-blue-800 dark:text-blue-300 mb-2 flex items-center gap-2\">\r\n                <CheckCircle className=\"h-5 w-5\" />\r\n                ¿Eres médico?\r\n              </h3>\r\n              <p className=\"text-sm text-blue-700 dark:text-blue-400\">\r\n                Completa tu perfil profesional y verifica tu licencia médica para \r\n                poder publicar artículos y responder preguntas de la comunidad.\r\n              </p>\r\n            </div>\r\n\r\n            <div className=\"flex flex-col sm:flex-row gap-3 justify-center\">\r\n              <Link href=\"/registro?role=medico\">\r\n                <Button>\r\n                  Registrarme como Médico\r\n                </Button>\r\n              </Link>\r\n              <Link href=\"/login\">\r\n                <Button variant=\"outline\">\r\n                  Ya tengo cuenta\r\n                </Button>\r\n              </Link>\r\n            </div>\r\n          </Card>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900\">\r\n      {/* Header */}\r\n      <div className=\"bg-white dark:bg-gray-800 border-b sticky top-0 z-10\">\r\n        <div className=\"container mx-auto px-4 py-4\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <Link href=\"/blog\" className=\"inline-flex items-center text-gray-600 hover:text-blue-600 transition-colors\">\r\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\r\n              Volver al blog\r\n            </Link>\r\n            <div className=\"flex items-center gap-3\">\r\n              <Button \r\n                variant=\"outline\" \r\n                onClick={() => handleSave('draft')}\r\n                disabled={saving}\r\n              >\r\n                <Save className=\"h-4 w-4 mr-2\" />\r\n                Guardar borrador\r\n              </Button>\r\n              <Button \r\n                onClick={() => handleSave('published')}\r\n                disabled={saving || !post.title.trim() || !post.content.trim()}\r\n              >\r\n                <Send className=\"h-4 w-4 mr-2\" />\r\n                {saving ? 'Publicando...' : 'Publicar'}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"container mx-auto px-4 py-8\">\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n          {/* Main Editor */}\r\n          <div className=\"lg:col-span-2\">\r\n            <motion.div\r\n              initial={{ opacity: 0, y: 20 }}\r\n              animate={{ opacity: 1, y: 0 }}\r\n            >\r\n              <Tabs value={activeTab} onValueChange={setActiveTab}>\r\n                <TabsList className=\"mb-6\">\r\n                  <TabsTrigger value=\"escribir\">\r\n                    <BookOpen className=\"h-4 w-4 mr-2\" />\r\n                    Escribir\r\n                  </TabsTrigger>\r\n                  <TabsTrigger value=\"preview\">\r\n                    <Eye className=\"h-4 w-4 mr-2\" />\r\n                    Vista Previa\r\n                  </TabsTrigger>\r\n                </TabsList>\r\n\r\n                <TabsContent value=\"escribir\">\r\n                  <Card className=\"p-6\">\r\n                    {/* Title */}\r\n                    <div className=\"mb-6\">\r\n                      <Input\r\n                        placeholder=\"Título del artículo...\"\r\n                        value={post.title}\r\n                        onChange={(e) => setPost(prev => ({ ...prev, title: e.target.value }))}\r\n                        className=\"text-2xl font-bold border-0 border-b rounded-none px-0 focus-visible:ring-0 focus-visible:border-blue-500\"\r\n                      />\r\n                    </div>\r\n\r\n                    {/* Excerpt */}\r\n                    <div className=\"mb-6\">\r\n                      <Label className=\"text-sm text-gray-500 mb-2 block\">\r\n                        Resumen (aparecerá en las tarjetas del blog)\r\n                      </Label>\r\n                      <Textarea\r\n                        placeholder=\"Escribe un breve resumen del artículo...\"\r\n                        value={post.excerpt}\r\n                        onChange={(e) => setPost(prev => ({ ...prev, excerpt: e.target.value }))}\r\n                        rows={2}\r\n                        className=\"resize-none\"\r\n                      />\r\n                    </div>\r\n\r\n                    {/* Content */}\r\n                    <div className=\"mb-6\">\r\n                      <Label className=\"text-sm text-gray-500 mb-2 block\">\r\n                        Contenido del artículo\r\n                      </Label>\r\n                      <Textarea\r\n                        placeholder=\"Escribe el contenido de tu artículo aquí...\r\n\r\nPuedes usar formato Markdown:\r\n- **negrita** para texto importante\r\n- *cursiva* para énfasis\r\n- ## para subtítulos\r\n- - para listas\r\n\r\nRecuerda citar fuentes cuando sea necesario.\"\r\n                        value={post.content}\r\n                        onChange={(e) => setPost(prev => ({ ...prev, content: e.target.value }))}\r\n                        rows={20}\r\n                        className=\"font-mono text-sm\"\r\n                      />\r\n                    </div>\r\n\r\n                    {/* Word count */}\r\n                    <div className=\"flex items-center justify-between text-sm text-gray-500\">\r\n                      <span>{wordCount} palabras</span>\r\n                      <span>~{readingTime} min de lectura</span>\r\n                    </div>\r\n                  </Card>\r\n                </TabsContent>\r\n\r\n                <TabsContent value=\"preview\">\r\n                  <Card className=\"p-6\">\r\n                    {post.cover_image && (\r\n                      <img \r\n                        src={post.cover_image} \r\n                        alt=\"Cover\" \r\n                        className=\"w-full h-64 object-cover rounded-lg mb-6\"\r\n                      />\r\n                    )}\r\n                    <h1 className=\"text-3xl font-bold mb-4\">\r\n                      {post.title || \"Título del artículo\"}\r\n                    </h1>\r\n                    {post.excerpt && (\r\n                      <p className=\"text-lg text-gray-600 mb-6 italic\">\r\n                        {post.excerpt}\r\n                      </p>\r\n                    )}\r\n                    <div className=\"prose dark:prose-invert max-w-none\">\r\n                      {post.content ? (\r\n                        <div style={{ whiteSpace: 'pre-wrap' }}>{post.content}</div>\r\n                      ) : (\r\n                        <p className=\"text-gray-400\">El contenido aparecerá aquí...</p>\r\n                      )}\r\n                    </div>\r\n                  </Card>\r\n                </TabsContent>\r\n              </Tabs>\r\n            </motion.div>\r\n          </div>\r\n\r\n          {/* Sidebar */}\r\n          <div className=\"lg:col-span-1 space-y-6\">\r\n            {/* Category */}\r\n            <Card className=\"p-5\">\r\n              <Label className=\"font-semibold mb-3 block\">Categoría</Label>\r\n              <Select\r\n                value={post.category_id}\r\n                onValueChange={(value) => setPost(prev => ({ ...prev, category_id: value }))}\r\n              >\r\n                <SelectTrigger>\r\n                  <SelectValue placeholder=\"Selecciona una categoría\" />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  {categories.map((cat) => (\r\n                    <SelectItem key={cat.id} value={cat.id}>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <span \r\n                          className=\"w-3 h-3 rounded-full\" \r\n                          style={{ backgroundColor: cat.color }}\r\n                        />\r\n                        {cat.name}\r\n                      </div>\r\n                    </SelectItem>\r\n                  ))}\r\n                </SelectContent>\r\n              </Select>\r\n            </Card>\r\n\r\n            {/* Tags */}\r\n            <Card className=\"p-5\">\r\n              <Label className=\"font-semibold mb-3 block\">Tags</Label>\r\n              <div className=\"flex gap-2 mb-3\">\r\n                <Input\r\n                  placeholder=\"Agregar tag...\"\r\n                  value={newTag}\r\n                  onChange={(e) => setNewTag(e.target.value)}\r\n                  onKeyPress={(e) => e.key === 'Enter' && (e.preventDefault(), handleAddTag())}\r\n                />\r\n                <Button variant=\"outline\" size=\"icon\" onClick={handleAddTag}>\r\n                  <Plus className=\"h-4 w-4\" />\r\n                </Button>\r\n              </div>\r\n              <div className=\"flex flex-wrap gap-2\">\r\n                {post.tags?.map((tag) => (\r\n                  <Badge key={tag} variant=\"secondary\" className=\"pr-1\">\r\n                    #{tag}\r\n                    <button\r\n                      onClick={() => handleRemoveTag(tag)}\r\n                      className=\"ml-1 hover:text-red-500\"\r\n                    >\r\n                      <X className=\"h-3 w-3\" />\r\n                    </button>\r\n                  </Badge>\r\n                ))}\r\n              </div>\r\n            </Card>\r\n\r\n            {/* Cover Image */}\r\n            <Card className=\"p-5\">\r\n              <Label className=\"font-semibold mb-3 block\">Imagen de portada</Label>\r\n              <Input\r\n                placeholder=\"URL de la imagen...\"\r\n                value={post.cover_image}\r\n                onChange={(e) => setPost(prev => ({ ...prev, cover_image: e.target.value }))}\r\n              />\r\n              {post.cover_image && (\r\n                <div className=\"mt-3 relative\">\r\n                  <img \r\n                    src={post.cover_image} \r\n                    alt=\"Preview\" \r\n                    className=\"w-full h-32 object-cover rounded-lg\"\r\n                  />\r\n                  <button\r\n                    onClick={() => setPost(prev => ({ ...prev, cover_image: '' }))}\r\n                    className=\"absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600\"\r\n                  >\r\n                    <X className=\"h-4 w-4\" />\r\n                  </button>\r\n                </div>\r\n              )}\r\n            </Card>\r\n\r\n            {/* Tips */}\r\n            <Card className=\"p-5 bg-blue-50 dark:bg-blue-900/20 border-blue-200\">\r\n              <h3 className=\"font-semibold text-blue-800 dark:text-blue-300 mb-3 flex items-center gap-2\">\r\n                <AlertCircle className=\"h-5 w-5\" />\r\n                Consejos para un buen artículo\r\n              </h3>\r\n              <ul className=\"text-sm text-blue-700 dark:text-blue-400 space-y-2\">\r\n                <li>• Usa un título claro y descriptivo</li>\r\n                <li>• Incluye fuentes y referencias</li>\r\n                <li>• Estructura el contenido con subtítulos</li>\r\n                <li>• Evita jerga médica excesiva</li>\r\n                <li>• Revisa la ortografía antes de publicar</li>\r\n              </ul>\r\n            </Card>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\blog\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\blog\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadPosts'. Either include it or remove the dependency array.","line":59,"column":6,"nodeType":"ArrayExpression","endLine":59,"endColumn":43,"suggestions":[{"desc":"Update the dependencies array to be: [selectedCategory, searchQuery, page, loadPosts]","fix":{"range":[1675,1712],"text":"[selectedCategory, searchQuery, page, loadPosts]"}}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":213,"column":27,"nodeType":"JSXOpeningElement","endLine":217,"endColumn":29},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":517,"column":13,"nodeType":"JSXOpeningElement","endLine":521,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { motion } from \"framer-motion\";\r\nimport Link from \"next/link\";\r\nimport { Card } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Tabs, TabsList, TabsTrigger } from \"@red-salud/ui\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@red-salud/ui\";\r\nimport { fadeInUp, staggerContainer } from \"@/lib/animations\";\r\nimport {\r\n  Search,\r\n  TrendingUp,\r\n  MessageCircle,\r\n  ThumbsUp,\r\n  Eye,\r\n  BookOpen,\r\n  Award,\r\n  Clock,\r\n  Filter,\r\n  ChevronRight,\r\n  Sparkles,\r\n  Users,\r\n} from \"lucide-react\";\r\nimport {\r\n  getPosts,\r\n  getCategories,\r\n  getPopularTags,\r\n  getFeaturedPosts,\r\n  getTopContributors,\r\n} from \"@/lib/api/blog\";\r\nimport type {\r\n  BlogPost,\r\n  BlogCategory,\r\n  ContentTag,\r\n  UserReputation,\r\n} from \"@/lib/types/blog\";\r\n\r\nexport default function BlogPage() {\r\n  const [posts, setPosts] = useState<BlogPost[]>([]);\r\n  const [featuredPosts, setFeaturedPosts] = useState<BlogPost[]>([]);\r\n  const [categories, setCategories] = useState<BlogCategory[]>([]);\r\n  const [popularTags, setPopularTags] = useState<ContentTag[]>([]);\r\n  const [topContributors, setTopContributors] = useState<UserReputation[]>([]);\r\n  const [searchQuery, setSearchQuery] = useState(\"\");\r\n  const [selectedCategory, setSelectedCategory] = useState<string | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [page, setPage] = useState(1);\r\n  const [hasMore, setHasMore] = useState(true);\r\n\r\n  useEffect(() => {\r\n    loadInitialData();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    loadPosts();\r\n  }, [selectedCategory, searchQuery, page]);\r\n\r\n  async function loadInitialData() {\r\n    try {\r\n      const [categoriesData, tagsData, featuredData, contributorsData] =\r\n        await Promise.all([\r\n          getCategories(),\r\n          getPopularTags(15),\r\n          getFeaturedPosts(3),\r\n          getTopContributors(5),\r\n        ]);\r\n      setCategories(categoriesData);\r\n      setPopularTags(tagsData);\r\n      setFeaturedPosts(featuredData);\r\n      setTopContributors(contributorsData);\r\n    } catch (error) {\r\n      console.error(\"Error loading initial data:\", error);\r\n    }\r\n  }\r\n\r\n  async function loadPosts() {\r\n    setLoading(true);\r\n    try {\r\n      const result = await getPosts(\r\n        {\r\n          category: selectedCategory || undefined,\r\n          search: searchQuery || undefined,\r\n        },\r\n        { page, limit: 9 },\r\n      );\r\n      setPosts((prev) =>\r\n        page === 1 ? result.data : [...prev, ...result.data],\r\n      );\r\n      setHasMore(result.hasMore);\r\n    } catch (error) {\r\n      console.error(\"Error loading posts:\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  function handleSearch(e: React.FormEvent) {\r\n    e.preventDefault();\r\n    setPage(1);\r\n  }\r\n\r\n  function handleCategoryChange(categoryId: string | null) {\r\n    setSelectedCategory(categoryId);\r\n    setPage(1);\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900\">\r\n      {/* Hero Section */}\r\n      <section className=\"relative bg-gradient-to-br from-blue-600 via-blue-700 to-teal-600 text-white py-20 overflow-hidden\">\r\n        <div className=\"absolute inset-0 opacity-10 bg-[radial-gradient(circle_at_2px_2px,white_1px,transparent_0)] bg-[length:50px_50px]\" />\r\n        <div className=\"container mx-auto px-4 sm:px-6 lg:px-8 relative z-10\">\r\n          <motion.div\r\n            className=\"max-w-4xl mx-auto text-center\"\r\n            variants={staggerContainer}\r\n            initial=\"initial\"\r\n            animate=\"animate\"\r\n          >\r\n            <motion.div\r\n              variants={fadeInUp}\r\n              className=\"flex items-center justify-center gap-2 mb-4\"\r\n            >\r\n              <Sparkles className=\"h-6 w-6 text-yellow-300\" />\r\n              <span className=\"text-blue-200 font-medium\">\r\n                Conocimiento médico verificado\r\n              </span>\r\n            </motion.div>\r\n            <motion.h1\r\n              variants={fadeInUp}\r\n              className=\"text-4xl sm:text-5xl lg:text-6xl font-bold mb-6\"\r\n            >\r\n              Blog Médico & Comunidad\r\n            </motion.h1>\r\n            <motion.p\r\n              variants={fadeInUp}\r\n              className=\"text-xl text-blue-100 mb-8 max-w-2xl mx-auto\"\r\n            >\r\n              Artículos escritos por médicos verificados, preguntas de la\r\n              comunidad y las últimas noticias en salud\r\n            </motion.p>\r\n\r\n            {/* Search Bar */}\r\n            <motion.form\r\n              variants={fadeInUp}\r\n              onSubmit={handleSearch}\r\n              className=\"max-w-2xl mx-auto\"\r\n            >\r\n              <div className=\"relative\">\r\n                <Search className=\"absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400\" />\r\n                <Input\r\n                  type=\"text\"\r\n                  placeholder=\"Buscar artículos, temas de salud...\"\r\n                  value={searchQuery}\r\n                  onChange={(e) => setSearchQuery(e.target.value)}\r\n                  className=\"pl-12 pr-4 py-6 text-lg rounded-full bg-white/10 backdrop-blur-sm border-white/20 text-white placeholder:text-blue-200 focus:bg-white focus:text-gray-900 focus:placeholder:text-gray-400 transition-all\"\r\n                />\r\n                <Button\r\n                  type=\"submit\"\r\n                  className=\"absolute right-2 top-1/2 -translate-y-1/2 rounded-full bg-white text-blue-600 hover:bg-blue-50\"\r\n                >\r\n                  Buscar\r\n                </Button>\r\n              </div>\r\n            </motion.form>\r\n\r\n            {/* Quick Links */}\r\n            <motion.div\r\n              variants={fadeInUp}\r\n              className=\"flex flex-wrap justify-center gap-3 mt-6\"\r\n            >\r\n              <Link href=\"/blog/preguntas\">\r\n                <Button\r\n                  variant=\"outline\"\r\n                  className=\"border-white/30 text-white hover:bg-white/10\"\r\n                >\r\n                  <MessageCircle className=\"h-4 w-4 mr-2\" />\r\n                  Preguntas y Respuestas\r\n                </Button>\r\n              </Link>\r\n              <Link href=\"/blog/escribir\">\r\n                <Button\r\n                  variant=\"outline\"\r\n                  className=\"border-white/30 text-white hover:bg-white/10\"\r\n                >\r\n                  <BookOpen className=\"h-4 w-4 mr-2\" />\r\n                  Escribir Artículo\r\n                </Button>\r\n              </Link>\r\n            </motion.div>\r\n          </motion.div>\r\n        </div>\r\n      </section>\r\n\r\n      {/* Featured Posts */}\r\n      {featuredPosts.length > 0 && (\r\n        <section className=\"py-12 -mt-16 relative z-20\">\r\n          <div className=\"container mx-auto px-4 sm:px-6 lg:px-8\">\r\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n              {featuredPosts.map((post, index) => (\r\n                <motion.div\r\n                  key={post.id}\r\n                  initial={{ opacity: 0, y: 20 }}\r\n                  animate={{ opacity: 1, y: 0 }}\r\n                  transition={{ delay: index * 0.1 }}\r\n                >\r\n                  <Link href={`/blog/${post.slug}`}>\r\n                    <Card className=\"h-full overflow-hidden group hover:shadow-xl transition-all duration-300 bg-white dark:bg-gray-800\">\r\n                      <div className=\"relative h-48 bg-gradient-to-br from-blue-500 to-teal-500\">\r\n                        {post.cover_image && (\r\n                          <img\r\n                            src={post.cover_image}\r\n                            alt={post.title}\r\n                            className=\"w-full h-full object-cover\"\r\n                          />\r\n                        )}\r\n                        <div className=\"absolute top-3 left-3\">\r\n                          <Badge className=\"bg-yellow-500 text-yellow-900\">\r\n                            <Sparkles className=\"h-3 w-3 mr-1\" />\r\n                            Destacado\r\n                          </Badge>\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"p-5\">\r\n                        {post.category && (\r\n                          <Badge\r\n                            variant=\"secondary\"\r\n                            className=\"mb-2\"\r\n                            style={{\r\n                              backgroundColor: `${post.category.color}20`,\r\n                              color: post.category.color,\r\n                            }}\r\n                          >\r\n                            {post.category.name}\r\n                          </Badge>\r\n                        )}\r\n                        <h3 className=\"text-lg font-bold mb-2 group-hover:text-blue-600 transition-colors line-clamp-2\">\r\n                          {post.title}\r\n                        </h3>\r\n                        <p className=\"text-gray-600 dark:text-gray-400 text-sm line-clamp-2 mb-3\">\r\n                          {post.excerpt}\r\n                        </p>\r\n                        <div className=\"flex items-center justify-between text-sm text-gray-500\">\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <Avatar className=\"h-6 w-6\">\r\n                              <AvatarImage\r\n                                src={post.author?.avatar_url || \"\"}\r\n                              />\r\n                              <AvatarFallback>\r\n                                {post.author?.nombre_completo?.[0] || \"A\"}\r\n                              </AvatarFallback>\r\n                            </Avatar>\r\n                            <span className=\"truncate max-w-[100px]\">\r\n                              {post.author?.nombre_completo}\r\n                            </span>\r\n                          </div>\r\n                          <div className=\"flex items-center gap-3\">\r\n                            <span className=\"flex items-center gap-1\">\r\n                              <Eye className=\"h-3 w-3\" />\r\n                              {post.view_count}\r\n                            </span>\r\n                            <span className=\"flex items-center gap-1\">\r\n                              <ThumbsUp className=\"h-3 w-3\" />\r\n                              {post.like_count}\r\n                            </span>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    </Card>\r\n                  </Link>\r\n                </motion.div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        </section>\r\n      )}\r\n\r\n      {/* Main Content */}\r\n      <section className=\"py-12\">\r\n        <div className=\"container mx-auto px-4 sm:px-6 lg:px-8\">\r\n          <div className=\"grid grid-cols-1 lg:grid-cols-4 gap-8\">\r\n            {/* Sidebar */}\r\n            <aside className=\"lg:col-span-1 space-y-6\">\r\n              {/* Categories */}\r\n              <Card className=\"p-5\">\r\n                <h3 className=\"font-bold text-lg mb-4 flex items-center gap-2\">\r\n                  <Filter className=\"h-5 w-5 text-blue-600\" />\r\n                  Categorías\r\n                </h3>\r\n                <div className=\"space-y-2\">\r\n                  <button\r\n                    onClick={() => handleCategoryChange(null)}\r\n                    className={`w-full text-left px-3 py-2 rounded-lg transition-colors ${\r\n                      !selectedCategory\r\n                        ? \"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300\"\r\n                        : \"hover:bg-gray-100 dark:hover:bg-gray-800\"\r\n                    }`}\r\n                  >\r\n                    Todas las categorías\r\n                  </button>\r\n                  {categories.map((category) => (\r\n                    <button\r\n                      key={category.id}\r\n                      onClick={() => handleCategoryChange(category.id)}\r\n                      className={`w-full text-left px-3 py-2 rounded-lg transition-colors flex items-center gap-2 ${\r\n                        selectedCategory === category.id\r\n                          ? \"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300\"\r\n                          : \"hover:bg-gray-100 dark:hover:bg-gray-800\"\r\n                      }`}\r\n                    >\r\n                      <span\r\n                        className=\"w-3 h-3 rounded-full\"\r\n                        style={{ backgroundColor: category.color }}\r\n                      />\r\n                      {category.name}\r\n                    </button>\r\n                  ))}\r\n                </div>\r\n              </Card>\r\n\r\n              {/* Popular Tags */}\r\n              <Card className=\"p-5\">\r\n                <h3 className=\"font-bold text-lg mb-4 flex items-center gap-2\">\r\n                  <TrendingUp className=\"h-5 w-5 text-blue-600\" />\r\n                  Tags Populares\r\n                </h3>\r\n                <div className=\"flex flex-wrap gap-2\">\r\n                  {popularTags.map((tag) => (\r\n                    <Link key={tag.id} href={`/blog?tag=${tag.slug}`}>\r\n                      <Badge\r\n                        variant=\"outline\"\r\n                        className=\"cursor-pointer hover:bg-blue-50 dark:hover:bg-blue-900/30\"\r\n                      >\r\n                        #{tag.name}\r\n                      </Badge>\r\n                    </Link>\r\n                  ))}\r\n                </div>\r\n              </Card>\r\n\r\n              {/* Top Contributors */}\r\n              <Card className=\"p-5\">\r\n                <h3 className=\"font-bold text-lg mb-4 flex items-center gap-2\">\r\n                  <Award className=\"h-5 w-5 text-yellow-500\" />\r\n                  Top Contribuidores\r\n                </h3>\r\n                <div className=\"space-y-3\">\r\n                  {topContributors.map((contributor: UserReputation, index) => (\r\n                    <Link\r\n                      key={contributor.user_id}\r\n                      href={`/blog/autor/${contributor.user_id}`}\r\n                      className=\"flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors\"\r\n                    >\r\n                      <span\r\n                        className={`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${\r\n                          index === 0\r\n                            ? \"bg-yellow-100 text-yellow-700\"\r\n                            : index === 1\r\n                              ? \"bg-gray-100 text-gray-700\"\r\n                              : index === 2\r\n                                ? \"bg-orange-100 text-orange-700\"\r\n                                : \"bg-blue-50 text-blue-600\"\r\n                        }`}\r\n                      >\r\n                        {index + 1}\r\n                      </span>\r\n                      <Avatar className=\"h-8 w-8\">\r\n                        <AvatarImage src={contributor.user?.avatar_url || \"\"} />\r\n                        <AvatarFallback>\r\n                          {contributor.user?.nombre_completo?.[0] || \"U\"}\r\n                        </AvatarFallback>\r\n                      </Avatar>\r\n                      <div className=\"flex-1 min-w-0\">\r\n                        <p className=\"text-sm font-medium truncate\">\r\n                          {contributor.user?.nombre_completo}\r\n                        </p>\r\n                        <p className=\"text-xs text-gray-500\">\r\n                          {contributor.total_points} pts\r\n                        </p>\r\n                      </div>\r\n                    </Link>\r\n                  ))}\r\n                </div>\r\n                <Link href=\"/blog/ranking\">\r\n                  <Button variant=\"ghost\" className=\"w-full mt-3 text-blue-600\">\r\n                    Ver ranking completo\r\n                    <ChevronRight className=\"h-4 w-4 ml-1\" />\r\n                  </Button>\r\n                </Link>\r\n              </Card>\r\n            </aside>\r\n\r\n            {/* Posts Grid */}\r\n            <div className=\"lg:col-span-3\">\r\n              <Tabs defaultValue=\"recientes\" className=\"mb-6\">\r\n                <TabsList>\r\n                  <TabsTrigger value=\"recientes\">Más Recientes</TabsTrigger>\r\n                  <TabsTrigger value=\"populares\">Más Populares</TabsTrigger>\r\n                  <TabsTrigger value=\"tendencias\">Tendencias</TabsTrigger>\r\n                </TabsList>\r\n              </Tabs>\r\n\r\n              {loading && page === 1 ? (\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n                  {[...Array(6)].map((_, i) => (\r\n                    <Card key={i} className=\"animate-pulse\">\r\n                      <div className=\"h-40 bg-gray-200 dark:bg-gray-700\" />\r\n                      <div className=\"p-5 space-y-3\">\r\n                        <div className=\"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/4\" />\r\n                        <div className=\"h-6 bg-gray-200 dark:bg-gray-700 rounded\" />\r\n                        <div className=\"h-4 bg-gray-200 dark:bg-gray-700 rounded w-3/4\" />\r\n                      </div>\r\n                    </Card>\r\n                  ))}\r\n                </div>\r\n              ) : posts.length === 0 ? (\r\n                <Card className=\"p-12 text-center\">\r\n                  <BookOpen className=\"h-12 w-12 mx-auto text-gray-400 mb-4\" />\r\n                  <h3 className=\"text-lg font-semibold mb-2\">\r\n                    No hay artículos\r\n                  </h3>\r\n                  <p className=\"text-gray-500 mb-4\">\r\n                    {searchQuery\r\n                      ? `No encontramos artículos para \"${searchQuery}\"`\r\n                      : \"Aún no hay artículos publicados en esta categoría\"}\r\n                  </p>\r\n                  <Link href=\"/blog/escribir\">\r\n                    <Button>\r\n                      <BookOpen className=\"h-4 w-4 mr-2\" />\r\n                      Escribir el primero\r\n                    </Button>\r\n                  </Link>\r\n                </Card>\r\n              ) : (\r\n                <>\r\n                  <motion.div\r\n                    className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\"\r\n                    variants={staggerContainer}\r\n                    initial=\"initial\"\r\n                    animate=\"animate\"\r\n                  >\r\n                    {posts.map((post) => (\r\n                      <motion.div key={post.id} variants={fadeInUp}>\r\n                        <PostCard post={post} />\r\n                      </motion.div>\r\n                    ))}\r\n                  </motion.div>\r\n\r\n                  {hasMore && (\r\n                    <div className=\"text-center mt-8\">\r\n                      <Button\r\n                        variant=\"outline\"\r\n                        onClick={() => setPage((p) => p + 1)}\r\n                        disabled={loading}\r\n                      >\r\n                        {loading ? \"Cargando...\" : \"Cargar más artículos\"}\r\n                      </Button>\r\n                    </div>\r\n                  )}\r\n                </>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </section>\r\n\r\n      {/* CTA Section */}\r\n      <section className=\"py-16 bg-gradient-to-r from-blue-600 to-teal-600 text-white\">\r\n        <div className=\"container mx-auto px-4 sm:px-6 lg:px-8\">\r\n          <div className=\"max-w-3xl mx-auto text-center\">\r\n            <Users className=\"h-12 w-12 mx-auto mb-4 opacity-80\" />\r\n            <h2 className=\"text-3xl font-bold mb-4\">\r\n              ¿Eres médico verificado?\r\n            </h2>\r\n            <p className=\"text-xl text-blue-100 mb-6\">\r\n              Comparte tu conocimiento con miles de pacientes. Escribe\r\n              artículos, responde preguntas y construye tu reputación\r\n              profesional.\r\n            </p>\r\n            <div className=\"flex flex-wrap justify-center gap-4\">\r\n              <Link href=\"/blog/escribir\">\r\n                <Button\r\n                  size=\"lg\"\r\n                  className=\"bg-white text-blue-600 hover:bg-blue-50\"\r\n                >\r\n                  <BookOpen className=\"h-5 w-5 mr-2\" />\r\n                  Escribir Artículo\r\n                </Button>\r\n              </Link>\r\n              <Link href=\"/blog/preguntas\">\r\n                <Button\r\n                  size=\"lg\"\r\n                  variant=\"outline\"\r\n                  className=\"border-white text-white hover:bg-white/10\"\r\n                >\r\n                  <MessageCircle className=\"h-5 w-5 mr-2\" />\r\n                  Responder Preguntas\r\n                </Button>\r\n              </Link>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </section>\r\n    </div>\r\n  );\r\n}\r\n\r\n// Componente de tarjeta de post\r\nfunction PostCard({ post }: { post: BlogPost }) {\r\n  return (\r\n    <Link href={`/blog/${post.slug}`}>\r\n      <Card className=\"h-full overflow-hidden group hover:shadow-lg transition-all duration-300\">\r\n        <div className=\"relative h-40 bg-gradient-to-br from-blue-500 to-teal-500\">\r\n          {post.cover_image && (\r\n            <img\r\n              src={post.cover_image}\r\n              alt={post.title}\r\n              className=\"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300\"\r\n            />\r\n          )}\r\n        </div>\r\n        <div className=\"p-5\">\r\n          {post.category && (\r\n            <Badge\r\n              variant=\"secondary\"\r\n              className=\"mb-2 text-xs\"\r\n              style={{\r\n                backgroundColor: `${post.category.color}20`,\r\n                color: post.category.color,\r\n              }}\r\n            >\r\n              {post.category.name}\r\n            </Badge>\r\n          )}\r\n          <h3 className=\"font-bold mb-2 group-hover:text-blue-600 transition-colors line-clamp-2\">\r\n            {post.title}\r\n          </h3>\r\n          <p className=\"text-gray-600 dark:text-gray-400 text-sm line-clamp-2 mb-4\">\r\n            {post.excerpt}\r\n          </p>\r\n          <div className=\"flex items-center justify-between text-xs text-gray-500\">\r\n            <div className=\"flex items-center gap-2\">\r\n              <Avatar className=\"h-5 w-5\">\r\n                <AvatarImage src={post.author?.avatar_url || \"\"} />\r\n                <AvatarFallback className=\"text-[10px]\">\r\n                  {post.author?.nombre_completo?.[0] || \"A\"}\r\n                </AvatarFallback>\r\n              </Avatar>\r\n              <span className=\"truncate max-w-[80px]\">\r\n                {post.author?.nombre_completo}\r\n              </span>\r\n            </div>\r\n            <div className=\"flex items-center gap-1\">\r\n              <Clock className=\"h-3 w-3\" />\r\n              {post.reading_time} min\r\n            </div>\r\n          </div>\r\n          <div className=\"flex items-center gap-4 mt-3 pt-3 border-t text-xs text-gray-500\">\r\n            <span className=\"flex items-center gap-1\">\r\n              <Eye className=\"h-3 w-3\" />\r\n              {post.view_count}\r\n            </span>\r\n            <span className=\"flex items-center gap-1\">\r\n              <ThumbsUp className=\"h-3 w-3\" />\r\n              {post.like_count}\r\n            </span>\r\n            <span className=\"flex items-center gap-1\">\r\n              <MessageCircle className=\"h-3 w-3\" />\r\n              {post.comment_count}\r\n            </span>\r\n          </div>\r\n        </div>\r\n      </Card>\r\n    </Link>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\blog\\preguntas\\page.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadQuestions'. Either include it or remove the dependency array.","line":84,"column":6,"nodeType":"ArrayExpression","endLine":84,"endColumn":54,"suggestions":[{"desc":"Update the dependencies array to be: [selectedCategory, searchQuery, activeTab, page, loadQuestions]","fix":{"range":[2341,2389],"text":"[selectedCategory, searchQuery, activeTab, page, loadQuestions]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\blog\\ranking\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\blog\\suscripciones\\page.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadSubscriptions'. Either include it or remove the dependency array.","line":76,"column":6,"nodeType":"ArrayExpression","endLine":76,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadSubscriptions]","fix":{"range":[1895,1897],"text":"[loadSubscriptions]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\nosotros\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\nosotros\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\precios\\components\\ComparisonTable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\precios\\components\\OrganizationsSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\precios\\components\\PricingCTA.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\precios\\components\\PricingCards.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\precios\\components\\PricingFAQ.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\precios\\components\\PricingHero.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\precios\\components\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\precios\\data\\precios-data.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\precios\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\precios\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\privacidad\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\privacidad\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\servicios\\ambulancias\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\servicios\\clinicas\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\servicios\\farmacias\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\servicios\\laboratorios\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\servicios\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\servicios\\medicos\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\servicios\\pacientes\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\servicios\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\servicios\\secretarias\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\servicios\\seguros\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\soporte\\agendar-llamada\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\soporte\\agendar-llamada\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\soporte\\chat\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\soporte\\chat\\page.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'welcomeMessage'. Either include it or remove the dependency array.","line":309,"column":6,"nodeType":"ArrayExpression","endLine":309,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [welcomeMessage]","fix":{"range":[9925,9927],"text":"[welcomeMessage]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\soporte\\contacto\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\soporte\\contacto\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\soporte\\estado\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\soporte\\estado\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\soporte\\faq\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\soporte\\faq\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\soporte\\guias\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\soporte\\guias\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\soporte\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\soporte\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\terminos\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\(public)\\terminos\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\academy\\certificaciones\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\academy\\cursos\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\academy\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\academy\\metodologia\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\academy\\pacientes\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\academy\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\academy\\planes\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\academy\\profesionales\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\admin\\chatbot\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\ambulancia\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\clinica\\[clinicId]\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\clinica\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\farmacia\\alertas\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\farmacia\\caducidades\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\farmacia\\caja\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\farmacia\\comunicacion\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\farmacia\\entregas\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\farmacia\\fidelizacion\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\farmacia\\historial-ventas\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\farmacia\\inventario\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\farmacia\\laboratorios\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\farmacia\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\farmacia\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\farmacia\\pedidos\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\farmacia\\permisos\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\farmacia\\personal\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\farmacia\\precios\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\farmacia\\proveedores\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\farmacia\\recetas\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\farmacia\\reportes\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\farmacia\\responsive\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\farmacia\\seguros\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\farmacia\\ventas\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\laboratorio\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\medico\\citas\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\medico\\citas\\nueva\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TourButton' is defined but never used.","line":18,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":20},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/incompatible-library').","line":106,"column":3,"severity":1,"nodeType":null,"fix":{"range":[4033,4093],"text":" "}},{"ruleId":"react-hooks/incompatible-library","severity":1,"message":"Compilation Skipped: Use of incompatible library\n\nThis API returns functions which cannot be memoized without leading to stale UI. To prevent this, by default React Compiler will skip memoizing this component/hook. However, you may see issues if values from this API are passed to other components/hooks that are memoized.\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\medico\\citas\\nueva\\page.tsx:108:26\n  106 |   // eslint-disable-next-line react-hooks/incompatible-library\n  107 |   useEffect(() => {\n> 108 |     const subscription = watch((data) => {\n      |                          ^^^^^ React Hook Form's `useForm()` API returns a `watch()` function which cannot be memoized safely.\n  109 |       saveFormToLocalStorage(data);\n  110 |     });\n  111 |     return () => subscription.unsubscribe();","line":108,"column":26,"nodeType":null,"endLine":108,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_data' is defined but never used.","line":123,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":123,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":1,"source":"\"use client\";\r\n\r\nimport { useState, useEffect, Suspense, useCallback, useMemo } from \"react\";\r\nimport { useRouter, useSearchParams } from \"next/navigation\";\r\nimport { ArrowLeft, Plus } from \"lucide-react\";\r\nimport { format } from \"date-fns\";\r\nimport { useForm, FormProvider } from \"react-hook-form\";\r\nimport { zodResolver } from \"@hookform/resolvers/zod\";\r\n\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { VerificationGuard } from \"@/components/dashboard/medico/features/verification-guard\";\r\nimport { searchConsultationReasons } from \"@/lib/data/consultation-reasons\";\r\nimport { appointmentSchema, AppointmentFormValues } from \"@/lib/validations/appointment\";\r\n\r\n// Componentes nuevos\r\nimport { CompactAppointmentForm } from \"@/components/citas/nueva/compact-appointment-form\";\r\nimport { AppointmentConfirmationModal } from \"@/components/citas/nueva/confirmation-modal\";\r\nimport { TourButton } from \"@/components/citas/nueva/tour-button\";\r\nimport { useAppointmentForm } from \"@/hooks/use-appointment-form\";\r\n\r\nfunction NuevaCitaContent() {\r\n  const router = useRouter();\r\n  const searchParams = useSearchParams();\r\n\r\n  // Estado derivado del hook personalizado\r\n  const {\r\n    loading,\r\n    error: hookError,\r\n    checkingConflict,\r\n    conflictingAppointments,\r\n    patients,\r\n    isInitialLoad,\r\n    checkTimeConflicts,\r\n    submitAppointment,\r\n    getMinDate,\r\n    getMinTime,\r\n    isTimeValid,\r\n    saveFormToLocalStorage,\r\n    loadFormFromLocalStorage,\r\n  } = useAppointmentForm();\r\n\r\n  // Parámetros URL\r\n  const dateParam = searchParams.get(\"date\");\r\n  const hourParam = searchParams.get(\"hour\");\r\n  const pacienteParam = searchParams.get(\"paciente\");\r\n\r\n  // Cargar datos previos del localStorage\r\n  const savedFormData = useMemo(() => loadFormFromLocalStorage(), [loadFormFromLocalStorage]);\r\n\r\n  // Estado local\r\n  const advancedMode = searchParams.get(\"modo\") === \"clinico\";\r\n  const [showConfirmation, setShowConfirmation] = useState(false);\r\n\r\n  // Inicializar formulario con datos guardados o parámetros URL\r\n  const form = useForm<AppointmentFormValues>({\r\n    resolver: zodResolver(appointmentSchema),\r\n    defaultValues: {\r\n      paciente_id: savedFormData?.paciente_id || pacienteParam || \"\",\r\n      fecha:\r\n        savedFormData?.fecha ||\r\n        (dateParam ? format(new Date(dateParam), \"yyyy-MM-dd\") : format(new Date(), \"yyyy-MM-dd\")),\r\n      hora:\r\n        savedFormData?.hora ||\r\n        (hourParam ? `${hourParam.padStart(2, \"0\")}:00` : \"09:00\"),\r\n      duracion_minutos: savedFormData?.duracion_minutos || 30,\r\n      tipo_cita: savedFormData?.tipo_cita || \"presencial\",\r\n      motivo: savedFormData?.motivo || \"\",\r\n      notas_internas: savedFormData?.notas_internas || \"\",\r\n      precio: savedFormData?.precio || \"\",\r\n      metodo_pago: savedFormData?.metodo_pago || \"efectivo\",\r\n      enviar_recordatorio: savedFormData?.enviar_recordatorio ?? true,\r\n      diagnostico_preliminar: savedFormData?.diagnostico_preliminar || \"\",\r\n      antecedentes_relevantes: savedFormData?.antecedentes_relevantes || \"\",\r\n      medicamentos_actuales: savedFormData?.medicamentos_actuales || \"\",\r\n      alergias: savedFormData?.alergias || \"\",\r\n      notas_clinicas: savedFormData?.notas_clinicas || \"\",\r\n    },\r\n  });\r\n\r\n  const { watch, handleSubmit, getValues } = form;\r\n  const motivo = watch(\"motivo\");\r\n\r\n  // Sugerencias de motivo\r\n  const [motivoSuggestions, setMotivoSuggestions] = useState<string[]>([]);\r\n\r\n  useEffect(() => {\r\n    if (!motivo) {\r\n      setMotivoSuggestions([]);\r\n      return;\r\n    }\r\n\r\n    const lastCommaIndex = motivo.lastIndexOf(\",\");\r\n    const currentTerm =\r\n      lastCommaIndex === -1 ? motivo.trim() : motivo.substring(lastCommaIndex + 1).trim();\r\n\r\n    if (currentTerm.length >= 2) {\r\n      const suggestions = searchConsultationReasons(currentTerm);\r\n      setMotivoSuggestions(suggestions);\r\n    } else {\r\n      setMotivoSuggestions([]);\r\n    }\r\n  }, [motivo]);\r\n\r\n  // Guardar formulario en localStorage cuando cambia\r\n  // Guardar formulario en localStorage cuando cambia\r\n  // eslint-disable-next-line react-hooks/incompatible-library\r\n  useEffect(() => {\r\n    const subscription = watch((data) => {\r\n      saveFormToLocalStorage(data);\r\n    });\r\n    return () => subscription.unsubscribe();\r\n  }, [watch, saveFormToLocalStorage]);\r\n\r\n  // Manejar conflictos con debounce\r\n  const handleConflictCheck = useCallback(\r\n    async (fecha: string, hora: string, duracion: number) => {\r\n      await checkTimeConflicts(fecha, hora, duracion);\r\n    },\r\n    [checkTimeConflicts]\r\n  );\r\n\r\n  // Enviar formulario\r\n  const onSubmit = async (_data: AppointmentFormValues) => {\r\n    // Mostrar modal de confirmación\r\n    setShowConfirmation(true);\r\n  };\r\n\r\n  // Confirmar envío desde modal\r\n  const handleConfirmSubmit = useCallback(async () => {\r\n    const formData = getValues();\r\n    await submitAppointment(formData);\r\n    setShowConfirmation(false);\r\n  }, [getValues, submitAppointment]);\r\n\r\n  const pacienteId = watch(\"paciente_id\");\r\n  const selectedPatient = useMemo(\r\n    () => patients.find((p) => p.id === pacienteId),\r\n    [pacienteId, patients]\r\n  );\r\n\r\n  return (\r\n    <VerificationGuard>\r\n      <div className=\"h-[calc(100vh-3rem)] bg-background px-4 sm:px-6 py-4 overflow-auto\">\r\n        <div className=\"w-full\">\r\n          {/* Back Button - Inline */}\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => router.back()}\r\n            className=\"inline-flex items-center gap-1.5 text-sm text-muted-foreground hover:text-foreground transition-colors mb-3 group\"\r\n          >\r\n            <ArrowLeft className=\"h-4 w-4 group-hover:-translate-x-0.5 transition-transform\" />\r\n            <span>Volver a citas</span>\r\n          </button>\r\n\r\n          <FormProvider {...form}>\r\n            <form onSubmit={handleSubmit(onSubmit)} className=\"space-y-4\">\r\n              {/* Formulario compacto */}\r\n              <div className=\"bg-card rounded-lg shadow-sm border border-border\">\r\n                <div className=\"p-4\">\r\n                  <CompactAppointmentForm\r\n                    getMinDate={getMinDate}\r\n                    getMinTime={getMinTime}\r\n                    isTimeValid={isTimeValid}\r\n                    motivoSuggestions={motivoSuggestions}\r\n                    patients={patients}\r\n                    checkingConflict={checkingConflict}\r\n                    conflictingAppointments={conflictingAppointments}\r\n                    error={hookError}\r\n                    onConflictCheck={handleConflictCheck}\r\n                    advancedMode={advancedMode}\r\n                    isInitialLoad={isInitialLoad}\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              {/* Acciones - Fixed al fondo */}\r\n              <div className=\"flex gap-3 justify-end sticky bottom-0 bg-background py-3 -mx-4 px-4 sm:-mx-6 sm:px-6 border-t border-border\">\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"outline\"\r\n                  onClick={() => router.back()}\r\n                  disabled={loading}\r\n                >\r\n                  Cancelar\r\n                </Button>\r\n                <Button\r\n                  type=\"submit\"\r\n                  disabled={loading || !watch(\"paciente_id\")}\r\n                  _data-tour=\"submit-button\"\r\n                >\r\n                  <Plus className=\"h-4 w-4 mr-2\" />\r\n                  {loading ? \"Creando...\" : \"Crear Cita\"}\r\n                </Button>\r\n              </div>\r\n            </form>\r\n          </FormProvider>\r\n\r\n          {/* Modal de confirmación */}\r\n          <AppointmentConfirmationModal\r\n            open={showConfirmation}\r\n            onConfirm={handleConfirmSubmit}\r\n            onCancel={() => setShowConfirmation(false)}\r\n            isLoading={loading}\r\n            formData={getValues()}\r\n            selectedPatientName={selectedPatient?.nombre_completo}\r\n          />\r\n        </div>\r\n      </div>\r\n    </VerificationGuard>\r\n  );\r\n}\r\n\r\nexport default function NuevaCitaPage() {\r\n  return (\r\n    <Suspense\r\n      fallback={\r\n        <div className=\"flex items-center justify-center min-h-screen\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\" />\r\n        </div>\r\n      }\r\n    >\r\n      <NuevaCitaContent />\r\n    </Suspense>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\medico\\citas\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Loader2' is defined but never used.","line":42,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":42,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'searchParams' is assigned a value but never used.","line":48,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":48,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":155,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":155,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5612,5615],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5612,5615],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":183,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":183,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6753,6756],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6753,6756],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":296,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":296,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11497,11500],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11497,11500],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\n\"use client\";\r\nimport { useEffect, useState, useRef } from \"react\";\r\nimport { useRouter, useSearchParams } from \"next/navigation\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { VerificationGuard } from \"@/components/dashboard/medico/features/verification-guard\";\r\nimport { UnifiedCalendar } from \"@/components/dashboard/medico/calendar/unified-calendar\";\r\nimport { PatientSummaryModal } from \"@/components/dashboard/medico/calendar/patient-summary-modal\";\r\nimport type { CalendarAppointment } from \"@/components/dashboard/medico/calendar/types\";\r\nimport { startOfMonth, endOfMonth, addMonths, isSameDay } from \"date-fns\";\r\nimport { Toast, type ToastType } from \"@red-salud/ui\";\r\nimport type { RealtimeChannel } from \"@supabase/supabase-js\";\r\nimport { useKeyboardShortcuts, DEFAULT_SHORTCUTS } from \"@/hooks/use-keyboard-shortcuts\";\r\nimport { tauriApiService } from \"@/lib/services/tauri-api-service\";\r\n\r\ninterface RawAppointment {\r\n  id: string;\r\n  paciente_id: string | null;\r\n  offline_patient_id: string | null;\r\n  fecha_hora: string;\r\n  duracion_minutos: number | null;\r\n  motivo: string | null;\r\n  status: string | null;\r\n  tipo_cita: string | null;\r\n  color: string | null;\r\n  notas_internas: string | null;\r\n  paciente: {\r\n    nombre_completo: string;\r\n    telefono: string | null;\r\n    email: string | null;\r\n    avatar_url: string | null;\r\n  } | null;\r\n  offline_patient: {\r\n    nombre_completo: string;\r\n    telefono: string | null;\r\n    email: string | null;\r\n  } | null;\r\n}\r\n\r\n\r\nimport { Suspense } from \"react\";\r\nimport { Loader2 } from \"lucide-react\";\r\n\r\nimport { CalendarFilters } from \"@/components/dashboard/medico/calendar/calendar-filters\";\r\n\r\nfunction CitasContent() {\r\n  const router = useRouter();\r\n  const searchParams = useSearchParams();\r\n  const [loading, setLoading] = useState(true);\r\n  const [appointments, setAppointments] = useState<CalendarAppointment[]>([]);\r\n  const [selectedAppointment, setSelectedAppointment] = useState<CalendarAppointment | null>(null);\r\n  const [modalOpen, setModalOpen] = useState(false);\r\n  // Filters\r\n  const [selectedStatuses, setSelectedStatuses] = useState<string[]>([]);\r\n  const [selectedTypes, setSelectedTypes] = useState<string[]>([]);\r\n\r\n  const [toast, setToast] = useState<{ message: string; type: ToastType; isVisible: boolean }>({\r\n    message: \"\",\r\n    type: \"info\",\r\n    isVisible: false,\r\n  });\r\n  const channelRef = useRef<RealtimeChannel | null>(null);\r\n  const doctorIdRef = useRef<string | null>(null);\r\n\r\n  const showToast = (message: string, type: ToastType = \"info\") => {\r\n    setToast({ message, type, isVisible: true });\r\n  };\r\n\r\n  // Handlers - deben declararse antes de los hooks customizados\r\n  const handleNewAppointment = () => {\r\n    router.push(\"/dashboard/medico/citas/nueva\");\r\n  };\r\n\r\n  const handleAppointmentClick = (appointment: CalendarAppointment) => {\r\n    setSelectedAppointment(appointment);\r\n    setModalOpen(true);\r\n  };\r\n\r\n  const handleCloseModal = () => {\r\n    setModalOpen(false);\r\n    setSelectedAppointment(null);\r\n  };\r\n\r\n  const handleTimeSlotClick = (date: Date, hour?: number) => {\r\n    // Validar que no sea fecha/hora pasada\r\n    const now = new Date();\r\n    const selectedDateTime = new Date(date);\r\n\r\n    if (hour !== undefined) {\r\n      selectedDateTime.setHours(hour, 0, 0, 0);\r\n    }\r\n\r\n    // Check for double booking\r\n    if (selectedDateTime < now) {\r\n      showToast(\"No puedes agendar citas en fechas u horas pasadas\", \"warning\");\r\n      return;\r\n    }\r\n\r\n    // Check if slot is taken (basic check)\r\n    const isSlotTaken = appointments.some(apt => {\r\n      const aptDate = new Date(apt.fecha_hora);\r\n      const aptEndDate = new Date(apt.fecha_hora_fin);\r\n      const selectedEndTime = new Date(selectedDateTime.getTime() + (apt.duracion_minutos || 30) * 60000); // Assuming default 30 min for new slot check\r\n\r\n      // Check for overlap:\r\n      // (StartA < EndB) && (EndA > StartB)\r\n      return (\r\n        isSameDay(aptDate, selectedDateTime) &&\r\n        selectedDateTime.getTime() < aptEndDate.getTime() &&\r\n        selectedEndTime.getTime() > aptDate.getTime()\r\n      );\r\n    });\r\n\r\n    if (isSlotTaken) {\r\n      showToast(\"Ya existe una cita en este horario o se superpone con otra. Por favor selecciona otro.\", \"warning\");\r\n      return;\r\n    }\r\n\r\n    // Si es fecha/hora pasada, no permitir\r\n    if (selectedDateTime < now) {\r\n      showToast(\"No puedes agendar citas en fechas u horas pasadas\", \"warning\");\r\n      return;\r\n    }\r\n\r\n    const dateParam = date.toISOString();\r\n    const hourParam = hour !== undefined ? `&hour=${hour}` : \"\";\r\n    router.push(`/dashboard/medico/citas/nueva?date=${dateParam}${hourParam}`);\r\n  };\r\n\r\n  const handleMessage = (appointment: CalendarAppointment) => {\r\n    if (!appointment.paciente_id) {\r\n      showToast(\"No se puede enviar mensajes a pacientes sin cuenta en el sistema\", \"warning\");\r\n      return;\r\n    }\r\n    router.push(`/dashboard/medico/mensajeria?patient=${appointment.paciente_id}`);\r\n  };\r\n\r\n  const handleStartVideo = (appointment: CalendarAppointment) => {\r\n    if (!appointment.paciente_id) {\r\n      showToast(\"No se puede iniciar videollamada con pacientes sin cuenta en el sistema\", \"warning\");\r\n      return;\r\n    }\r\n    router.push(`/dashboard/medico/telemedicina/${appointment.id}`);\r\n  };\r\n\r\n  // Keyboard Shortcuts\r\n  useKeyboardShortcuts([\r\n    {\r\n      key: DEFAULT_SHORTCUTS.NEW_APPOINTMENT.key,\r\n      handler: handleNewAppointment,\r\n      description: DEFAULT_SHORTCUTS.NEW_APPOINTMENT.description,\r\n    },\r\n  ]);\r\n\r\n  const formatAppointment = useCallback(async (aptData: Record<string, any>): Promise<CalendarAppointment | null> => {\r\n    try {\r\n      const isOfflinePatient = !aptData.paciente_id && aptData.offline_patient_id;\r\n\r\n      let patientData = null;\r\n      if (isOfflinePatient) {\r\n        const { data } = await supabase\r\n          .from('offline_patients')\r\n          .select('nombre_completo, telefono, email')\r\n          .eq('id', aptData.offline_patient_id)\r\n          .single();\r\n        patientData = data;\r\n      } else if (aptData.paciente_id) {\r\n        const { data } = await supabase\r\n          .from('profiles')\r\n          .select('nombre_completo, telefono, email, avatar_url')\r\n          .eq('id', aptData.paciente_id)\r\n          .single();\r\n        patientData = data;\r\n      }\r\n\r\n      return {\r\n        id: aptData.id as string,\r\n        paciente_id: aptData.paciente_id as string | null,\r\n        offline_patient_id: aptData.offline_patient_id as string | null,\r\n        paciente_nombre: patientData?.nombre_completo || \"Paciente\",\r\n        paciente_telefono: patientData?.telefono,\r\n        paciente_email: patientData?.email,\r\n        paciente_avatar: isOfflinePatient ? null : (patientData as any)?.avatar_url || null,\r\n        fecha_hora: aptData.fecha_hora as string,\r\n        fecha_hora_fin: new Date(\r\n          new Date(aptData.fecha_hora as string).getTime() + ((aptData.duracion_minutos as number) || 30) * 60000\r\n        ).toISOString(),\r\n        duracion_minutos: aptData.duracion_minutos as number || 30,\r\n        motivo: aptData.motivo as string,\r\n        status: aptData.status as CalendarAppointment['status'],\r\n        tipo_cita: aptData.tipo_cita as CalendarAppointment['tipo_cita'],\r\n        color: aptData.color as string,\r\n        notas_internas: aptData.notas_internas as string | null,\r\n      };\r\n    } catch (error) {\r\n      console.error('Error formatting appointment:', error);\r\n      return null;\r\n    }\r\n  }, []);\r\n\r\n  const setupRealtimeSubscription = useCallback((doctorId: string) => {\r\n    // Limpiar suscripción anterior si existe\r\n    if (channelRef.current) {\r\n      channelRef.current.unsubscribe();\r\n    }\r\n\r\n    // Crear nueva suscripción\r\n    const channel = supabase\r\n      .channel('appointments-changes')\r\n      .on(\r\n        'postgres_changes',\r\n        {\r\n          event: '*',\r\n          schema: 'public',\r\n          table: 'appointments',\r\n          filter: `medico_id=eq.${doctorId}`\r\n        },\r\n        async (payload) => {\r\n          console.log('Realtime update:', payload);\r\n\r\n          if (payload.eventType === 'INSERT') {\r\n            const newAppointment = await formatAppointment(payload.new);\r\n            if (newAppointment) {\r\n              setAppointments(prev => [...prev, newAppointment]);\r\n              showToast('Nueva cita agregada', 'success');\r\n            }\r\n          } else if (payload.eventType === 'UPDATE') {\r\n            const updatedAppointment = await formatAppointment(payload.new);\r\n            if (updatedAppointment) {\r\n              setAppointments(prev =>\r\n                prev.map(apt => apt.id === updatedAppointment.id ? updatedAppointment : apt)\r\n              );\r\n              showToast('Cita actualizada', 'info');\r\n            }\r\n          } else if (payload.eventType === 'DELETE') {\r\n            setAppointments(prev => prev.filter(apt => apt.id !== payload.old.id));\r\n            showToast('Cita eliminada', 'info');\r\n          }\r\n        }\r\n      )\r\n      .subscribe();\r\n\r\n    channelRef.current = channel;\r\n  }, [formatAppointment]);\r\n\r\n  const loadAppointments = useCallback(async (doctorId: string) => {\r\n    // Cargar citas del mes actual y siguiente\r\n    const startDate = startOfMonth(new Date());\r\n    const endDate = endOfMonth(addMonths(new Date(), 1));\r\n    const cacheKey = `calendar_appointments_${doctorId}`;\r\n\r\n    try {\r\n      // 1. Intentar cargar caché offline primero para mostrar datos inmediatos\r\n      const cachedData = await tauriApiService.getOfflineData<CalendarAppointment[]>(cacheKey);\r\n      if (cachedData) {\r\n        setAppointments(cachedData);\r\n        console.log(\"Loaded appointments from offline cache\");\r\n      }\r\n\r\n      // 2. Obtener sesión para token\r\n      const { data: { session } } = await supabase.auth.getSession();\r\n      const token = session?.access_token;\r\n\r\n      if (!token) {\r\n        console.warn(\"No auth token available for sync\");\r\n        return;\r\n      }\r\n\r\n      // 3. Consulta REST a Supabase a través del proxy de Tauri\r\n      const selectQuery = \"id,paciente_id,offline_patient_id,fecha_hora,duracion_minutos,motivo,status,tipo_cita,color,notas_internas,paciente:profiles!appointments_paciente_id_fkey(nombre_completo,telefono,email,avatar_url),offline_patient:offline_patients!appointments_offline_patient_id_fkey(nombre_completo,telefono,email)\";\r\n\r\n      const queryParams = new URLSearchParams({\r\n        select: selectQuery,\r\n        medico_id: `eq.${doctorId}`,\r\n        fecha_hora: `gte.${startDate.toISOString()}`,\r\n      });\r\n      const queryString = `${queryParams.toString()}&fecha_hora=lte.${endDate.toISOString()}&order=fecha_hora.asc`;\r\n\r\n      const data = await tauriApiService.supabaseGet<RawAppointment[]>(\r\n        `/rest/v1/appointments?${queryString}`,\r\n        token\r\n      );\r\n\r\n      if (data) {\r\n        const formattedAppointments: CalendarAppointment[] = data.map((apt) => {\r\n          const isOfflinePatient = !apt.paciente_id && apt.offline_patient_id;\r\n          const patientData = isOfflinePatient ? apt.offline_patient : apt.paciente;\r\n\r\n          return {\r\n            id: apt.id,\r\n            paciente_id: apt.paciente_id,\r\n            offline_patient_id: apt.offline_patient_id,\r\n            paciente_nombre: patientData?.nombre_completo || \"Paciente\",\r\n            paciente_telefono: patientData?.telefono || null,\r\n            paciente_email: patientData?.email || null,\r\n            paciente_avatar: isOfflinePatient ? null : (patientData as any)?.avatar_url || null,\r\n            fecha_hora: apt.fecha_hora,\r\n            fecha_hora_fin: new Date(\r\n              new Date(apt.fecha_hora).getTime() + (apt.duracion_minutos || 30) * 60000\r\n            ).toISOString(),\r\n            duracion_minutos: apt.duracion_minutos || 30,\r\n            motivo: apt.motivo || \"Sin motivo\",\r\n            status: apt.status as CalendarAppointment['status'] || \"pendiente\",\r\n            tipo_cita: apt.tipo_cita as CalendarAppointment['tipo_cita'] || \"presencial\",\r\n            color: apt.color || \"#3B82F6\",\r\n            notas_internas: apt.notas_internas || null,\r\n          };\r\n        });\r\n\r\n        console.log(`Synced ${formattedAppointments.length} appointments from server`);\r\n        setAppointments(formattedAppointments);\r\n\r\n        await tauriApiService.saveOfflineData(cacheKey, formattedAppointments);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error syncing appointments:\", error);\r\n      if (!appointments.length) {\r\n        showToast(\"Error de conexión. Mostrando datos offline si están disponibles.\", \"error\");\r\n      }\r\n    }\r\n  }, [appointments.length]);\r\n\r\n  const loadData = useCallback(async () => {\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) {\r\n        router.push(\"/login/medico\");\r\n        return;\r\n      }\r\n      doctorIdRef.current = user.id;\r\n      await loadAppointments(user.id);\r\n      setupRealtimeSubscription(user.id);\r\n    } catch (error) {\r\n      console.error(\"Error loading data:\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [router, loadAppointments, setupRealtimeSubscription]);\r\n\r\n  useEffect(() => {\r\n    loadData();\r\n\r\n    return () => {\r\n      if (channelRef.current) {\r\n        channelRef.current.unsubscribe();\r\n      }\r\n    };\r\n  }, [loadData]);\r\n\r\n  const filteredAppointments = appointments.filter((apt) => {\r\n    if (selectedStatuses.length > 0 && !selectedStatuses.includes(apt.status)) return false;\r\n    if (selectedTypes.length > 0 && !selectedTypes.includes(apt.tipo_cita)) return false;\r\n    return true;\r\n  });\r\n\r\n  // Updated JSX with Glassmorphism\r\n  return (\r\n    <VerificationGuard>\r\n      <div className=\"flex flex-col h-[calc(100vh-48px)] overflow-hidden p-4 space-y-4\">\r\n        {/* Filters */}\r\n        <div className=\"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between flex-shrink-0\">\r\n          <div className=\"glass px-4 py-2 rounded-lg\">\r\n            <CalendarFilters\r\n              selectedStatuses={selectedStatuses}\r\n              onStatusChange={setSelectedStatuses}\r\n              selectedTypes={selectedTypes}\r\n              onTypeChange={setSelectedTypes}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Calendario unificado - ocupa todo el espacio disponible */}\r\n        <div className=\"flex-1 min-h-0 rounded-xl overflow-hidden shadow-glow border border-white/20 glass-card\">\r\n          <UnifiedCalendar\r\n            appointments={filteredAppointments}\r\n            onNewAppointment={handleNewAppointment}\r\n            onAppointmentClick={handleAppointmentClick}\r\n            onTimeSlotClick={handleTimeSlotClick}\r\n            onMessage={handleMessage}\r\n            onStartVideo={handleStartVideo}\r\n            loading={loading}\r\n          />\r\n        </div>\r\n\r\n        {/* Modal de resumen del paciente */}\r\n        <PatientSummaryModal\r\n          appointment={selectedAppointment}\r\n          open={modalOpen}\r\n          onClose={handleCloseModal}\r\n          onMessage={handleMessage}\r\n          onStartVideo={handleStartVideo}\r\n        />\r\n\r\n        {/* Toast notifications */}\r\n        <Toast\r\n          message={toast.message}\r\n          type={toast.type}\r\n          isVisible={toast.isVisible}\r\n          onClose={() => setToast((prev) => ({ ...prev, isVisible: false }))}\r\n        />\r\n      </div>\r\n    </VerificationGuard>\r\n  );\r\n}\r\n\r\nexport default function DoctorCitasPage() {\r\n  return (\r\n    <Suspense\r\n      fallback={\r\n        <div className=\"flex items-center justify-center min-h-screen\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\" />\r\n        </div>\r\n      }\r\n    >\r\n      <CitasContent />\r\n    </Suspense>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\medico\\configuracion\\horarios\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\medico\\configuracion\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ProfileSection' is defined but never used.","line":29,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleTabChange' is assigned a value but never used.","line":102,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":102,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file page.tsx\r\n * @description Página principal de configuración del médico.\r\n * Centro de control unificado para todas las preferencias y configuraciones con diseño minimalista.\r\n * @module Dashboard/Medico/Configuracion\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useSearchParams, useRouter } from \"next/navigation\";\r\nimport { motion } from \"framer-motion\";\r\nimport {\r\n  User,\r\n  Clock,\r\n  Users,\r\n  Bell,\r\n  Shield,\r\n  Settings,\r\n  Keyboard,\r\n  Briefcase,\r\n  FileText,\r\n  Palette,\r\n  Eye,\r\n  Activity,\r\n  CreditCard,\r\n  MapPin,\r\n} from \"lucide-react\";\r\nimport { VerificationGuard } from \"@/components/dashboard/medico/features/verification-guard\";\r\nimport { ProfileSection } from \"@/components/dashboard/medico/configuracion/profile-section\";\r\nimport { ProfileSectionV2 } from \"@/components/dashboard/medico/configuracion/profile-section-v2\";\r\nimport { InfoProfesionalSection } from \"@/components/dashboard/medico/configuracion/info-profesional-section\";\r\nimport { DocumentsSection } from \"@/components/dashboard/medico/configuracion/documents-section\";\r\nimport { OfficesSection } from \"@/components/dashboard/medico/configuracion/offices-section\";\r\nimport { ScheduleSection } from \"@/components/dashboard/medico/configuracion/schedule-section\";\r\nimport { SecretariesSection } from \"@/components/dashboard/medico/configuracion/secretaries-section\";\r\nimport { NotificationsSection } from \"@/components/dashboard/medico/configuracion/notifications-section\";\r\nimport { PreferencesSection } from \"@/components/dashboard/medico/configuracion/preferences-section\";\r\nimport { SecuritySection } from \"@/components/dashboard/medico/configuracion/security-section\";\r\nimport { PrivacySection } from \"@/components/dashboard/medico/configuracion/privacy-section\";\r\nimport { ActivitySection } from \"@/components/dashboard/medico/configuracion/activity-section\";\r\nimport { BillingSection } from \"@/components/dashboard/medico/configuracion/billing-section\";\r\nimport { ShortcutsSection } from \"@/components/dashboard/medico/configuracion/shortcuts-section\";\r\n\r\n/**\r\n * Tipos de tabs disponibles en la configuración\r\n */\r\ntype TabType =\r\n  | \"perfil\"\r\n  | \"info-profesional\"\r\n  | \"documentos\"\r\n  | \"consultorios\"\r\n  | \"horarios\"\r\n  | \"secretarias\"\r\n  | \"notificaciones\"\r\n  | \"preferencias\"\r\n  | \"seguridad\"\r\n  | \"privacidad\"\r\n  | \"actividad\"\r\n  | \"facturacion\"\r\n  | \"shortcuts\";\r\n\r\n/**\r\n * Configuración de cada tab\r\n */\r\ninterface TabConfig {\r\n  id: TabType;\r\n  label: string;\r\n  icon: React.ComponentType<{ className?: string }>;\r\n  description: string;\r\n  category: \"perfil\" | \"consultorio\" | \"sistema\" | \"cuenta\";\r\n}\r\n\r\n/**\r\n * Definición de todos los tabs de configuración organizados por categoría\r\n */\r\nconst TABS: TabConfig[] = [\r\n  { id: \"perfil\", label: \"Perfil Básico\", icon: User, description: \"Datos personales\", category: \"perfil\" },\r\n  { id: \"info-profesional\", label: \"Info. Profesional\", icon: Briefcase, description: \"Bio y certificados\", category: \"perfil\" },\r\n  { id: \"documentos\", label: \"Documentos\", icon: FileText, description: \"Verificación\", category: \"perfil\" },\r\n  { id: \"consultorios\", label: \"Consultorios\", icon: MapPin, description: \"Ubicaciones\", category: \"consultorio\" },\r\n  { id: \"horarios\", label: \"Horarios\", icon: Clock, description: \"Atención\", category: \"consultorio\" },\r\n  { id: \"secretarias\", label: \"Secretarias\", icon: Users, description: \"Equipo\", category: \"consultorio\" },\r\n  { id: \"notificaciones\", label: \"Notificaciones\", icon: Bell, description: \"Alertas\", category: \"sistema\" },\r\n  { id: \"preferencias\", label: \"Preferencias\", icon: Palette, description: \"Tema e idioma\", category: \"sistema\" },\r\n  { id: \"shortcuts\", label: \"Atajos\", icon: Keyboard, description: \"Teclas rápidas\", category: \"sistema\" },\r\n  { id: \"seguridad\", label: \"Seguridad\", icon: Shield, description: \"Cuenta\", category: \"cuenta\" },\r\n  { id: \"privacidad\", label: \"Privacidad\", icon: Eye, description: \"Datos\", category: \"cuenta\" },\r\n  { id: \"actividad\", label: \"Actividad\", icon: Activity, description: \"Historial\", category: \"cuenta\" },\r\n  { id: \"facturacion\", label: \"Facturación\", icon: CreditCard, description: \"Pagos\", category: \"cuenta\" },\r\n];\r\n\r\nimport { Suspense } from \"react\";\r\n\r\nfunction ConfiguracionContent() {\r\n  const searchParams = useSearchParams();\r\n  const router = useRouter();\r\n\r\n  // Obtener el tab activo directamente de la URL sin estado duplicado\r\n  const tabFromUrl = searchParams.get(\"tab\") as TabType;\r\n  const activeTab = (tabFromUrl && TABS.some(t => t.id === tabFromUrl)) ? tabFromUrl : \"perfil\";\r\n\r\n  const handleTabChange = (tabId: TabType) => {\r\n    const newUrl = tabId === \"perfil\"\r\n      ? \"/dashboard/medico/configuracion\"\r\n      : `/dashboard/medico/configuracion?tab=${tabId}`;\r\n    router.push(newUrl, { scroll: false });\r\n  };\r\n\r\n  const renderTabContent = () => {\r\n    switch (activeTab) {\r\n      case \"perfil\": return <ProfileSectionV2 />;\r\n      case \"info-profesional\": return <InfoProfesionalSection />;\r\n      case \"documentos\": return <DocumentsSection />;\r\n      case \"consultorios\": return <OfficesSection />;\r\n      case \"horarios\": return <ScheduleSection />;\r\n      case \"secretarias\": return <SecretariesSection />;\r\n      case \"notificaciones\": return <NotificationsSection />;\r\n      case \"preferencias\": return <PreferencesSection />;\r\n      case \"shortcuts\": return <ShortcutsSection />;\r\n      case \"seguridad\": return <SecuritySection />;\r\n      case \"privacidad\": return <PrivacySection />;\r\n      case \"actividad\": return <ActivitySection />;\r\n      case \"facturacion\": return <BillingSection />;\r\n      default: return <ProfileSectionV2 />;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <VerificationGuard>\r\n      {activeTab === \"perfil\" ? (\r\n        // Perfil V2 usa su propio layout completo\r\n        <ProfileSectionV2 />\r\n      ) : (\r\n        // Otras secciones usan el layout tradicional\r\n        <div className=\"min-h-screen bg-white dark:bg-gray-950\">\r\n          <div className=\"container mx-auto px-6 py-10 max-w-[1400px]\">\r\n            {/* Header Minimalista */}\r\n            <div className=\"flex items-center gap-4 mb-10\">\r\n              <div className=\"p-2 bg-gray-50 dark:bg-gray-900 rounded-lg border dark:border-gray-800\">\r\n                <Settings className=\"h-5 w-5 text-gray-500\" />\r\n              </div>\r\n              <div>\r\n                <h1 className=\"text-2xl font-semibold text-gray-900 dark:text-gray-100 tracking-tight\">\r\n                  Configuración\r\n                </h1>\r\n                <p className=\"text-gray-500 dark:text-gray-400 text-sm\">\r\n                  Gestiona tu perfil y sistema\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"relative\">\r\n              <div className=\"w-full\">\r\n                <motion.div\r\n                  key={activeTab}\r\n                  initial={{ opacity: 0, y: 10 }}\r\n                  animate={{ opacity: 1, y: 0 }}\r\n                  transition={{ duration: 0.3 }}\r\n                  className=\"bg-white dark:bg-gray-900 rounded-xl border border-gray-100 dark:border-gray-800 p-8 shadow-sm min-h-[800px]\"\r\n                >\r\n                  {renderTabContent()}\r\n                </motion.div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </VerificationGuard>\r\n  );\r\n}\r\n\r\nexport default function ConfiguracionMedicoPage() {\r\n  return (\r\n    <Suspense\r\n      fallback={\r\n        <div className=\"flex items-center justify-center min-h-screen\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\" />\r\n        </div>\r\n      }\r\n    >\r\n      <ConfiguracionContent />\r\n    </Suspense>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\medico\\configuracion\\secretarias\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadSecretaries'. Either include it or remove the dependency array.","line":29,"column":6,"nodeType":"ArrayExpression","endLine":29,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadSecretaries]","fix":{"range":[1409,1411],"text":"[loadSecretaries]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { ArrowLeft, UserPlus, CheckCircle, AlertCircle, Loader2 } from \"lucide-react\";\r\nimport { Alert, AlertDescription } from \"@red-salud/ui\";\r\nimport { VerificationGuard } from \"@/components/dashboard/medico/features/verification-guard\";\r\n\r\n// Components\r\nimport { SecretaryList } from \"@/components/configuracion/secretarias/secretary-list\";\r\nimport { InviteDialog } from \"@/components/configuracion/secretarias/invite-dialog\";\r\nimport { PermissionsDialog } from \"@/components/configuracion/secretarias/permissions-dialog\";\r\nimport { Secretary } from \"@/components/configuracion/secretarias/types\";\r\n\r\nexport default function SecretariasPage() {\r\n  const router = useRouter();\r\n  const [loading, setLoading] = useState(true);\r\n  const [secretaries, setSecretaries] = useState<Secretary[]>([]);\r\n  const [showInviteDialog, setShowInviteDialog] = useState(false);\r\n  const [showPermissionsDialog, setShowPermissionsDialog] = useState(false);\r\n  const [selectedSecretary, setSelectedSecretary] = useState<Secretary | null>(null);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [success, setSuccess] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    loadSecretaries();\r\n  }, []);\r\n\r\n  const loadSecretaries = async () => {\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) {\r\n        router.push(\"/login/medico\");\r\n        return;\r\n      }\r\n\r\n      const { data, error } = await supabase\r\n        .from(\"doctor_secretary_relationships\")\r\n        .select(\"*\")\r\n        .eq(\"doctor_id\", user.id);\r\n\r\n      if (error) throw error;\r\n\r\n      setSecretaries(data || []);\r\n    } catch (err) {\r\n      console.error(\"Error loading secretaries:\", err);\r\n      setError(err instanceof Error ? err.message : \"Error desconocido\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleInviteSecretary = async (inviteForm: { email: string; password: string; nombre_completo: string }) => {\r\n    setError(null);\r\n    setSuccess(null);\r\n    setLoading(true);\r\n\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) return;\r\n\r\n      // 1. Crear usuario en auth\r\n      const { data: authData, error: authError } = await supabase.auth.admin.createUser({\r\n        email: inviteForm.email,\r\n        password: inviteForm.password,\r\n        email_confirm: true,\r\n        user_metadata: {\r\n          nombre_completo: inviteForm.nombre_completo,\r\n          role: \"secretaria\",\r\n        },\r\n      });\r\n\r\n      if (authError) throw authError;\r\n\r\n      // 2. Crear perfil\r\n      const { error: profileError } = await supabase\r\n        .from(\"profiles\")\r\n        .insert({\r\n          id: authData.user.id,\r\n          email: inviteForm.email,\r\n          nombre_completo: inviteForm.nombre_completo,\r\n          role: \"secretaria\",\r\n        });\r\n\r\n      if (profileError) throw profileError;\r\n\r\n      // 3. Crear relación médico-secretaria\r\n      const { error: relationError } = await supabase\r\n        .from(\"doctor_secretaries\")\r\n        .insert({\r\n          doctor_id: user.id,\r\n          secretary_id: authData.user.id,\r\n          status: \"active\",\r\n        });\r\n\r\n      if (relationError) throw relationError;\r\n\r\n      setSuccess(\"Secretaria invitada exitosamente\");\r\n      setShowInviteDialog(false);\r\n      loadSecretaries();\r\n    } catch (err) {\r\n      console.error(\"Error inviting secretary:\", err);\r\n      setError(err instanceof Error ? err.message : \"Error al invitar secretaria\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleUpdatePermissions = async () => {\r\n    if (!selectedSecretary) return;\r\n\r\n    setError(null);\r\n    setLoading(true);\r\n\r\n    try {\r\n      const { error } = await supabase\r\n        .from(\"doctor_secretaries\")\r\n        .update({ permissions: selectedSecretary.permissions })\r\n        .eq(\"id\", selectedSecretary.id);\r\n\r\n      if (error) throw error;\r\n\r\n      setSuccess(\"Permisos actualizados exitosamente\");\r\n      setShowPermissionsDialog(false);\r\n      loadSecretaries();\r\n    } catch (err) {\r\n      console.error(\"Error updating permissions:\", err);\r\n      setError(err instanceof Error ? err.message : \"Error desconocido\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleDeleteSecretary = async (secretaryId: string) => {\r\n    if (!confirm(\"¿Estás seguro de eliminar esta secretaria?\")) return;\r\n\r\n    try {\r\n      const { error } = await supabase\r\n        .from(\"doctor_secretaries\")\r\n        .delete()\r\n        .eq(\"id\", secretaryId);\r\n\r\n      if (error) throw error;\r\n\r\n      setSuccess(\"Secretaria eliminada exitosamente\");\r\n      loadSecretaries();\r\n    } catch (err) {\r\n      console.error(\"Error deleting secretary:\", err);\r\n      setError(err instanceof Error ? err.message : \"Error desconocido\");\r\n    }\r\n  };\r\n\r\n  const togglePermission = (key: keyof Secretary[\"permissions\"]) => {\r\n    if (!selectedSecretary) return;\r\n    setSelectedSecretary({\r\n      ...selectedSecretary,\r\n      permissions: {\r\n        ...selectedSecretary.permissions,\r\n        [key]: !selectedSecretary.permissions[key],\r\n      },\r\n    });\r\n  };\r\n\r\n  if (loading && secretaries.length === 0) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-screen\">\r\n        <Loader2 className=\"h-12 w-12 animate-spin text-blue-600\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <VerificationGuard>\r\n      <div className=\"container mx-auto px-4 py-8 max-w-6xl\">\r\n        <div className=\"flex items-center gap-4 mb-6\">\r\n          <Button variant=\"ghost\" size=\"sm\" onClick={() => router.back()}>\r\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\r\n            Volver\r\n          </Button>\r\n          <div className=\"flex-1\">\r\n            <h1 className=\"text-3xl font-bold text-gray-900\">Gestión de Secretarias</h1>\r\n            <p className=\"text-gray-600 mt-1\">\r\n              Invita y gestiona el acceso de tus secretarias\r\n            </p>\r\n          </div>\r\n          <Button onClick={() => setShowInviteDialog(true)}>\r\n            <UserPlus className=\"h-4 w-4 mr-2\" />\r\n            Invitar Secretaria\r\n          </Button>\r\n        </div>\r\n\r\n        {error && (\r\n          <Alert variant=\"destructive\" className=\"mb-6\">\r\n            <AlertCircle className=\"h-4 w-4\" />\r\n            <AlertDescription>{error}</AlertDescription>\r\n          </Alert>\r\n        )}\r\n\r\n        {success && (\r\n          <Alert className=\"mb-6 bg-green-50 border-green-200\">\r\n            <CheckCircle className=\"h-4 w-4 text-green-600\" />\r\n            <AlertDescription className=\"text-green-800\">{success}</AlertDescription>\r\n          </Alert>\r\n        )}\r\n\r\n        <SecretaryList\r\n          secretaries={secretaries}\r\n          onInvite={() => setShowInviteDialog(true)}\r\n          onEditPermissions={(secretary) => {\r\n            setSelectedSecretary(secretary);\r\n            setShowPermissionsDialog(true);\r\n          }}\r\n          onDelete={handleDeleteSecretary}\r\n        />\r\n\r\n        <InviteDialog\r\n          open={showInviteDialog}\r\n          onOpenChange={setShowInviteDialog}\r\n          onInvite={handleInviteSecretary}\r\n          loading={loading}\r\n        />\r\n\r\n        <PermissionsDialog\r\n          open={showPermissionsDialog}\r\n          onOpenChange={setShowPermissionsDialog}\r\n          secretary={selectedSecretary}\r\n          onUpdate={handleUpdatePermissions}\r\n          onTogglePermission={togglePermission}\r\n          loading={loading}\r\n        />\r\n      </div>\r\n    </VerificationGuard>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\medico\\consulta\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\medico\\consulta\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\medico\\estadisticas\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setDateRange' is assigned a value but never used.","line":84,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":84,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleTabChange' is assigned a value but never used.","line":112,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":112,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file page.tsx\r\n * @description Página de estadísticas avanzadas del médico con header híbrido.\r\n * Sistema completo con 8 tabs especializados conectados a Supabase.\r\n *\r\n * @module Dashboard/Médico/Estadísticas\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useState, useEffect, Suspense } from \"react\";\r\nimport { useRouter, useSearchParams } from \"next/navigation\";\r\nimport { motion } from \"framer-motion\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { VerificationGuard } from \"@/components/dashboard/medico/features/verification-guard\";\r\nimport { Card, CardContent } from \"@red-salud/ui\";\r\nimport { Skeleton } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport {\r\n  BarChart3,\r\n  Users,\r\n  Activity,\r\n  DollarSign,\r\n  Clock,\r\n  FlaskConical,\r\n  TrendingUp,\r\n  AlertTriangle,\r\n  Download,\r\n  RefreshCw\r\n} from \"lucide-react\";\r\n\r\n// Importar tabs\r\nimport { ResumenTab } from \"@/components/dashboard/medico/estadisticas/tabs/resumen-tab\";\r\nimport { PacientesTab } from \"@/components/dashboard/medico/estadisticas/tabs/pacientes-tab\";\r\nimport { EnfermedadesTab } from \"@/components/dashboard/medico/estadisticas/tabs/enfermedades-tab\";\r\nimport { FinanzasTab } from \"@/components/dashboard/medico/estadisticas/tabs/finanzas-tab\";\r\nimport { PatronesTab } from \"@/components/dashboard/medico/estadisticas/tabs/patrones-tab\";\r\nimport { LaboratorioTab } from \"@/components/dashboard/medico/estadisticas/tabs/laboratorio-tab\";\r\nimport { EficienciaTab } from \"@/components/dashboard/medico/estadisticas/tabs/eficiencia-tab\";\r\nimport { BrotesTab } from \"@/components/dashboard/medico/estadisticas/tabs/brotes-tab\";\r\n\r\n// ============================================================================\r\n// TIPOS\r\n// ============================================================================\r\n\r\ntype TabType =\r\n  | \"resumen\"\r\n  | \"pacientes\"\r\n  | \"enfermedades\"\r\n  | \"finanzas\"\r\n  | \"patrones\"\r\n  | \"laboratorio\"\r\n  | \"eficiencia\"\r\n  | \"brotes\";\r\n\r\ninterface TabConfig {\r\n  id: TabType;\r\n  label: string;\r\n  icon: React.ComponentType<{ className?: string }>;\r\n  description: string;\r\n}\r\n\r\nconst TABS: TabConfig[] = [\r\n  { id: \"resumen\", label: \"Resumen\", icon: BarChart3, description: \"Vista general\" },\r\n  { id: \"pacientes\", label: \"Pacientes\", icon: Users, description: \"Demografía\" },\r\n  { id: \"enfermedades\", label: \"Enfermedades\", icon: Activity, description: \"Epidemiología\" },\r\n  { id: \"finanzas\", label: \"Finanzas\", icon: DollarSign, description: \"Ingresos\" },\r\n  { id: \"patrones\", label: \"Patrones\", icon: Clock, description: \"Temporales\" },\r\n  { id: \"laboratorio\", label: \"Laboratorio\", icon: FlaskConical, description: \"Análisis\" },\r\n  { id: \"eficiencia\", label: \"Eficiencia\", icon: TrendingUp, description: \"Operativa\" },\r\n  { id: \"brotes\", label: \"Brotes\", icon: AlertTriangle, description: \"Detección\" },\r\n];\r\n\r\n// ============================================================================\r\n// COMPONENTE PRINCIPAL\r\n// ============================================================================\r\n\r\n\r\nfunction EstadisticasInner() {\r\n  const router = useRouter();\r\n  const searchParams = useSearchParams();\r\n  const [doctorId, setDoctorId] = useState<string | null>(null);\r\n  const [isRefreshing, setIsRefreshing] = useState(false);\r\n  const [dateRange, setDateRange] = useState({\r\n    start: new Date(new Date().setDate(new Date().getDate() - 30)),\r\n    end: new Date()\r\n  });\r\n\r\n  // Obtener tab activo de la URL\r\n  const tabFromUrl = searchParams.get(\"tab\") as TabType;\r\n  const activeTab = (tabFromUrl && TABS.some(t => t.id === tabFromUrl)) ? tabFromUrl : \"resumen\";\r\n\r\n  // Cargar ID del médico\r\n  useEffect(() => {\r\n    const loadDoctorId = async () => {\r\n      try {\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user) {\r\n          router.push(\"/login\");\r\n          return;\r\n        }\r\n        setDoctorId(user.id);\r\n      } catch (error) {\r\n        console.error(\"Error loading doctor ID:\", error);\r\n        router.push(\"/login\");\r\n      }\r\n    };\r\n\r\n    loadDoctorId();\r\n  }, [router]);\r\n\r\n  const handleTabChange = (tabId: TabType) => {\r\n    const newUrl = tabId === \"resumen\"\r\n      ? \"/dashboard/medico/estadisticas\"\r\n      : `/dashboard/medico/estadisticas?tab=${tabId}`;\r\n    router.push(newUrl, { scroll: false });\r\n  };\r\n\r\n  const handleRefresh = async () => {\r\n    setIsRefreshing(true);\r\n    // Simular recarga\r\n    await new Promise(resolve => setTimeout(resolve, 500));\r\n    setIsRefreshing(false);\r\n  };\r\n\r\n  const handleExport = () => {\r\n    // TODO: Implementar exportación\r\n    alert(\"Exportación próximamente\");\r\n  };\r\n\r\n  const renderTabContent = () => {\r\n    if (!doctorId) return null;\r\n\r\n    switch (activeTab) {\r\n      case \"resumen\": return <ResumenTab doctorId={doctorId} dateRange={dateRange} />;\r\n      case \"pacientes\": return <PacientesTab doctorId={doctorId} dateRange={dateRange} />;\r\n      case \"enfermedades\": return <EnfermedadesTab doctorId={doctorId} dateRange={dateRange} />;\r\n      case \"finanzas\": return <FinanzasTab doctorId={doctorId} dateRange={dateRange} />;\r\n      case \"patrones\": return <PatronesTab doctorId={doctorId} dateRange={dateRange} />;\r\n      case \"laboratorio\": return <LaboratorioTab doctorId={doctorId} dateRange={dateRange} />;\r\n      case \"eficiencia\": return <EficienciaTab doctorId={doctorId} dateRange={dateRange} />;\r\n      case \"brotes\": return <BrotesTab doctorId={doctorId} dateRange={dateRange} />;\r\n      default: return <ResumenTab doctorId={doctorId} dateRange={dateRange} />;\r\n    }\r\n  };\r\n\r\n  // Mostrar skeleton mientras carga\r\n  if (!doctorId) {\r\n    return (\r\n      <div className=\"container mx-auto px-6 py-8 max-w-[1400px]\">\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n          {[1, 2, 3, 4].map((i) => (\r\n            <Skeleton key={i} className=\"h-40\" />\r\n          ))}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"container mx-auto px-6 py-8 max-w-[1400px]\">\r\n      {/* Botones de Acción en la parte superior */}\r\n      <div className=\"flex items-center justify-end gap-2 mb-6\">\r\n        <Button\r\n          variant=\"outline\"\r\n          size=\"sm\"\r\n          onClick={handleRefresh}\r\n          disabled={isRefreshing}\r\n          className=\"gap-2\"\r\n        >\r\n          <RefreshCw className={`h-4 w-4 ${isRefreshing ? 'animate-spin' : ''}`} />\r\n          Actualizar\r\n        </Button>\r\n        <Button\r\n          variant=\"outline\"\r\n          size=\"sm\"\r\n          onClick={handleExport}\r\n          className=\"gap-2\"\r\n        >\r\n          <Download className=\"h-4 w-4\" />\r\n          Exportar\r\n        </Button>\r\n      </div>\r\n\r\n      {/* Contenido del Tab */}\r\n      <motion.div\r\n        key={activeTab}\r\n        initial={{ opacity: 0, y: 10 }}\r\n        animate={{ opacity: 1, y: 0 }}\r\n        transition={{ duration: 0.3 }}\r\n      >\r\n        <Suspense fallback={<LoadingSkeleton />}>\r\n          {renderTabContent()}\r\n        </Suspense>\r\n      </motion.div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction EstadisticasContent() {\r\n  return (\r\n    <Suspense fallback={<LoadingSkeleton />}>\r\n      <EstadisticasInner />\r\n    </Suspense>\r\n  );\r\n}\r\n\r\n// ============================================================================\r\n// SKELETON DE CARGA\r\n// ============================================================================\r\n\r\nfunction LoadingSkeleton() {\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n        {[1, 2, 3, 4, 5, 6].map((i) => (\r\n          <Card key={i}>\r\n            <CardContent className=\"pt-6\">\r\n              <Skeleton className=\"h-4 w-24 mb-2\" />\r\n              <Skeleton className=\"h-8 w-16 mb-2\" />\r\n              <Skeleton className=\"h-3 w-full\" />\r\n            </CardContent>\r\n          </Card>\r\n        ))}\r\n      </div>\r\n      <Card>\r\n        <CardContent className=\"pt-6\">\r\n          <Skeleton className=\"h-6 w-48 mb-4\" />\r\n          <Skeleton className=\"h-64 w-full\" />\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n\r\n// ============================================================================\r\n// PÁGINA PRINCIPAL\r\n// ============================================================================\r\n\r\nexport default function DoctorEstadisticasPage() {\r\n  return (\r\n    <VerificationGuard>\r\n      <EstadisticasContent />\r\n    </VerificationGuard>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\medico\\icd11-demo\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\medico\\laboratorio\\nueva\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\medico\\laboratorio\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileText' is defined but never used.","line":9,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":54},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Filter' is defined but never used.","line":9,"column":64,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":70},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":42,"column":8,"nodeType":"ArrayExpression","endLine":42,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [loadData]","fix":{"range":[1316,1318],"text":"[loadData]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { FlaskConical, Plus, Calendar, User, FileText, Search, Filter } from \"lucide-react\";\r\nimport { VerificationGuard } from \"@/components/dashboard/medico/features/verification-guard\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport {\r\n    Select,\r\n    SelectContent,\r\n    SelectItem,\r\n    SelectTrigger,\r\n    SelectValue,\r\n} from \"@red-salud/ui\";\r\n\r\ninterface LabOrder {\r\n    id: string;\r\n    patient_id: string;\r\n    status: string;\r\n    created_at: string;\r\n    prioridad?: string;\r\n    numero_orden?: string;\r\n    paciente?: {\r\n        nombre_completo: string;\r\n    };\r\n    tests?: Array<Record<string, unknown>>;\r\n}\r\n\r\nexport default function DoctorLaboratorioPage() {\r\n    const router = useRouter();\r\n    const [loading, setLoading] = useState(true);\r\n    const [orders, setOrders] = useState<LabOrder[]>([]);\r\n    const [searchTerm, setSearchTerm] = useState(\"\");\r\n    const [statusFilter, setStatusFilter] = useState<string>(\"all\");\r\n\r\n    useEffect(() => {\r\n        loadData();\r\n    }, []);\r\n\r\n    const loadData = async () => {\r\n        try {\r\n            const { data: { user } } = await supabase.auth.getUser();\r\n            if (!user) {\r\n                router.push(\"/login/medico\");\r\n                return;\r\n            }\r\n            await loadOrders(user.id);\r\n        } catch (error) {\r\n            console.error(\"Error loading data:\", error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const loadOrders = async (doctorId: string) => {\r\n        const { data, error } = await supabase\r\n            .from(\"lab_orders\")\r\n            .select(`\r\n        *,\r\n        paciente:profiles!lab_orders_paciente_id_fkey(\r\n          nombre_completo,\r\n          avatar_url\r\n        )\r\n      `)\r\n            .eq(\"medico_id\", doctorId)\r\n            .order(\"created_at\", { ascending: false });\r\n\r\n        if (!error && data) {\r\n            setOrders(data);\r\n        }\r\n    };\r\n\r\n    const filteredOrders = orders.filter(order => {\r\n        const matchesSearch = order.paciente?.nombre_completo?.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n            order.numero_orden?.toLowerCase().includes(searchTerm.toLowerCase());\r\n        const matchesStatus = statusFilter === \"all\" || order.status === statusFilter;\r\n        return matchesSearch && matchesStatus;\r\n    });\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"flex items-center justify-center min-h-screen\">\r\n                <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\" />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <VerificationGuard>\r\n            <div className=\"container mx-auto px-4 py-8 space-y-6\">\r\n                <div className=\"flex items-center justify-between\">\r\n                    <div>\r\n                        <h1 className=\"text-3xl font-bold text-gray-900\">Laboratorio</h1>\r\n                        <p className=\"text-gray-600 mt-1\">Gestiona las órdenes de laboratorio de tus pacientes</p>\r\n                    </div>\r\n                    <Button onClick={() => router.push(\"/dashboard/medico/laboratorio/nueva\")}>\r\n                        <Plus className=\"h-4 w-4 mr-2\" />\r\n                        Nueva Orden\r\n                    </Button>\r\n                </div>\r\n\r\n                <Card>\r\n                    <CardContent className=\"p-4\">\r\n                        <div className=\"flex gap-4\">\r\n                            <div className=\"relative flex-1\">\r\n                                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400\" />\r\n                                <Input\r\n                                    placeholder=\"Buscar por paciente o número de orden...\"\r\n                                    className=\"pl-10\"\r\n                                    value={searchTerm}\r\n                                    onChange={(e) => setSearchTerm(e.target.value)}\r\n                                />\r\n                            </div>\r\n                            <Select value={statusFilter} onValueChange={setStatusFilter}>\r\n                                <SelectTrigger className=\"w-[180px]\">\r\n                                    <SelectValue placeholder=\"Estado\" />\r\n                                </SelectTrigger>\r\n                                <SelectContent>\r\n                                    <SelectItem value=\"all\">Todos</SelectItem>\r\n                                    <SelectItem value=\"pendiente\">Pendiente</SelectItem>\r\n                                    <SelectItem value=\"en_proceso\">En Proceso</SelectItem>\r\n                                    <SelectItem value=\"completada\">Completada</SelectItem>\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n\r\n                {filteredOrders.length > 0 ? (\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n                        {filteredOrders.map((order) => (\r\n                            <Card key={order.id} className=\"hover:shadow-lg transition-shadow\">\r\n                                <CardHeader>\r\n                                    <CardTitle className=\"flex items-center justify-between\">\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <User className=\"h-5 w-5 text-gray-500\" />\r\n                                            <span className=\"text-lg truncate\">{order.paciente?.nombre_completo}</span>\r\n                                        </div>\r\n                                        <Badge variant={order.status === 'completada' ? 'default' : 'secondary'}>\r\n                                            {order.status}\r\n                                        </Badge>\r\n                                    </CardTitle>\r\n                                </CardHeader>\r\n                                <CardContent className=\"space-y-3\">\r\n                                    <div className=\"flex items-center justify-between text-sm text-gray-600\">\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <FlaskConical className=\"h-4 w-4\" />\r\n                                            <span>Orden #{order.numero_orden}</span>\r\n                                        </div>\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <Calendar className=\"h-4 w-4\" />\r\n                                            <span>{new Date(order.created_at).toLocaleDateString(\"es-ES\")}</span>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    {order.prioridad && (\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <span className=\"text-sm font-medium\">Prioridad:</span>\r\n                                            <Badge variant=\"outline\" className={\r\n                                                order.prioridad === 'urgente' ? 'text-orange-600 border-orange-600' :\r\n                                                    order.prioridad === 'stat' ? 'text-red-600 border-red-600' : ''\r\n                                            }>\r\n                                                {order.prioridad}\r\n                                            </Badge>\r\n                                        </div>\r\n                                    )}\r\n\r\n                                    <div className=\"flex gap-2 pt-2\">\r\n                                        <Button variant=\"outline\" className=\"flex-1\" onClick={() => router.push(`/dashboard/medico/laboratorio/${order.id}`)}>\r\n                                            Ver Detalles\r\n                                        </Button>\r\n                                        {order.status !== 'completada' && (\r\n                                            <Button className=\"flex-1\" onClick={() => router.push(`/dashboard/medico/laboratorio/${order.id}/resultados`)}>\r\n                                                Subir Resultados\r\n                                            </Button>\r\n                                        )}\r\n                                    </div>\r\n                                </CardContent>\r\n                            </Card>\r\n                        ))}\r\n                    </div>\r\n                ) : (\r\n                    <Card>\r\n                        <CardContent className=\"py-12\">\r\n                            <div className=\"text-center\">\r\n                                <FlaskConical className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\r\n                                <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">\r\n                                    No hay órdenes registradas\r\n                                </h3>\r\n                                <p className=\"text-gray-600 mb-4\">\r\n                                    Las órdenes de laboratorio que generes aparecerán aquí\r\n                                </p>\r\n                                <Button onClick={() => router.push(\"/dashboard/medico/laboratorio/nueva\")}>\r\n                                    <Plus className=\"h-4 w-4 mr-2\" />\r\n                                    Crear Primera Orden\r\n                                </Button>\r\n                            </div>\r\n                        </CardContent>\r\n                    </Card>\r\n                )}\r\n            </div>\r\n        </VerificationGuard>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\medico\\layout.client.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'session' is defined but never used.","line":57,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":57,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { DashboardLayoutClient } from \"@/components/dashboard/layout/dashboard-layout-client\";\r\nimport { AppProviders } from \"@/components/providers/app-providers\";\r\nimport { TourGuideProvider } from \"@/components/dashboard/shared/tour-guide/tour-guide-provider\";\r\nimport { SidebarProvider } from \"@/lib/contexts/sidebar-context\";\r\n\r\nimport type { User } from \"@supabase/supabase-js\";\r\n\r\ninterface Profile {\r\n  id: string;\r\n  role: string;\r\n  nombre_completo: string | null;\r\n}\r\n\r\nexport function MedicoLayoutClient({ children }: { children: React.ReactNode }) {\r\n  const router = useRouter();\r\n  const [user, setUser] = useState<User | null>(null);\r\n  const [profile, setProfile] = useState<Profile | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    // Verificar autenticación\r\n    const checkAuth = async () => {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n\r\n      if (!user) {\r\n        router.push(\"/login\");\r\n        return;\r\n      }\r\n\r\n      setUser(user);\r\n\r\n      // Obtener perfil\r\n      const { data: profile } = await supabase\r\n        .from(\"profiles\")\r\n        .select(\"*\")\r\n        .eq(\"id\", user.id)\r\n        .single();\r\n\r\n      if (profile?.role !== \"medico\") {\r\n        router.push(`/dashboard/${profile?.role || \"paciente\"}`);\r\n        return;\r\n      }\r\n\r\n      setProfile(profile);\r\n      setLoading(false);\r\n    };\r\n\r\n    checkAuth();\r\n\r\n    // Escuchar cambios de autenticación\r\n    const { data: { subscription } } = supabase.auth.onAuthStateChange(\r\n      (event, session) => {\r\n        if (event === \"SIGNED_OUT\") {\r\n          router.push(\"/login\");\r\n        }\r\n      }\r\n    );\r\n\r\n    return () => subscription.unsubscribe();\r\n  }, [router]);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-screen\">\r\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!user || !profile) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <AppProviders>\r\n      <SidebarProvider>\r\n        <TourGuideProvider>\r\n          <DashboardLayoutClient\r\n            userName={profile?.nombre_completo || user.email?.split(\"@\")[0]}\r\n            userEmail={user.email}\r\n            userRole=\"medico\"\r\n            userId={user.id}\r\n          >\r\n            {children}\r\n          </DashboardLayoutClient>\r\n        </TourGuideProvider>\r\n      </SidebarProvider>\r\n    </AppProviders>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\medico\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\medico\\mensajeria\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\medico\\pacientes\\[id]\\client.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'User' is defined but never used.","line":12,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Clock' is defined but never used.","line":23,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":8},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadPatientData'. Either include it or remove the dependency array.","line":96,"column":6,"nodeType":"ArrayExpression","endLine":96,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [loadPatientData, patientId]","fix":{"range":[2605,2616],"text":"[loadPatientData, patientId]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter, useParams } from \"next/navigation\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport {\r\n  User,\r\n  Calendar,\r\n  FileText,\r\n  Pill,\r\n  Activity,\r\n  ArrowLeft,\r\n  Phone,\r\n  Mail,\r\n  MapPin,\r\n  Edit,\r\n  Plus,\r\n  Clock,\r\n  AlertCircle,\r\n} from \"lucide-react\";\r\nimport { format } from \"date-fns\";\r\nimport { es } from \"date-fns/locale\";\r\nimport { VerificationGuard } from \"@/components/dashboard/medico/features/verification-guard\";\r\n\r\ninterface Appointment {\r\n  id: string;\r\n  fecha: string;\r\n  hora: string;\r\n  fecha_hora?: string;\r\n  motivo: string;\r\n  status: string;\r\n  duracion_minutos?: number;\r\n}\r\n\r\ninterface MedicalNote {\r\n  id: string;\r\n  created_at: string;\r\n  diagnostico: string;\r\n  tratamiento: string;\r\n  title?: string;\r\n  note_type?: string;\r\n  content?: string;\r\n}\r\n\r\ninterface Prescription {\r\n  id: string;\r\n  created_at: string;\r\n  medicamento: string;\r\n  dosis: string;\r\n  diagnostico?: string;\r\n  status?: string;\r\n}\r\n\r\ninterface PatientData {\r\n  id: string;\r\n  nombre_completo: string;\r\n  email: string;\r\n  avatar_url: string | null;\r\n  fecha_nacimiento: string | null;\r\n  genero: string | null;\r\n  telefono: string | null;\r\n  cedula: string | null;\r\n  direccion: string | null;\r\n  tipo_sangre: string | null;\r\n  alergias: string[] | null;\r\n  condiciones_cronicas: string[] | null;\r\n  medicamentos_actuales: string[] | null;\r\n}\r\n\r\ninterface DoctorPatientRelation {\r\n  first_consultation_date: string | null;\r\n  last_consultation_date: string | null;\r\n  total_consultations: number;\r\n  notes: string | null;\r\n}\r\n\r\nexport default function PatientDetailPage() {\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const patientId = params.id as string;\r\n\r\n  const [loading, setLoading] = useState(true);\r\n  const [patient, setPatient] = useState<PatientData | null>(null);\r\n  const [relation, setRelation] = useState<DoctorPatientRelation | null>(null);\r\n  const [appointments, setAppointments] = useState<Appointment[]>([]);\r\n  const [medicalNotes, setMedicalNotes] = useState<MedicalNote[]>([]);\r\n  const [prescriptions, setPrescriptions] = useState<Prescription[]>([]);\r\n\r\n  useEffect(() => {\r\n    loadPatientData();\r\n  }, [patientId]);\r\n\r\n  const loadPatientData = async () => {\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) {\r\n        router.push(\"/login/medico\");\r\n        return;\r\n      }\r\n\r\n      // Cargar datos del paciente\r\n      const { data: patientData, error: patientError } = await supabase\r\n        .from(\"profiles\")\r\n        .select(\"*\")\r\n        .eq(\"id\", patientId)\r\n        .single();\r\n\r\n      if (patientError) throw patientError;\r\n      setPatient(patientData);\r\n\r\n      // Cargar relación médico-paciente\r\n      const { data: relationData } = await supabase\r\n        .from(\"doctor_patients\")\r\n        .select(\"*\")\r\n        .eq(\"doctor_id\", user.id)\r\n        .eq(\"patient_id\", patientId)\r\n        .single();\r\n\r\n      setRelation(relationData);\r\n\r\n      // Cargar citas\r\n      const { data: appointmentsData } = await supabase\r\n        .from(\"appointments\")\r\n        .select(\"*\")\r\n        .eq(\"medico_id\", user.id)\r\n        .eq(\"paciente_id\", patientId)\r\n        .order(\"fecha_hora\", { ascending: false });\r\n\r\n      setAppointments(appointmentsData || []);\r\n\r\n      // Cargar notas médicas\r\n      const { data: notesData } = await supabase\r\n        .from(\"medical_notes\")\r\n        .select(\"*\")\r\n        .eq(\"doctor_id\", user.id)\r\n        .eq(\"patient_id\", patientId)\r\n        .order(\"created_at\", { ascending: false });\r\n\r\n      setMedicalNotes(notesData || []);\r\n\r\n      // Cargar recetas\r\n      const { data: prescriptionsData } = await supabase\r\n        .from(\"prescriptions\")\r\n        .select(\"*\")\r\n        .eq(\"medico_id\", user.id)\r\n        .eq(\"paciente_id\", patientId)\r\n        .order(\"created_at\", { ascending: false });\r\n\r\n      setPrescriptions(prescriptionsData || []);\r\n\r\n    } catch (error) {\r\n      console.error(\"Error loading patient data:\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const calculateAge = (birthDate: string | null) => {\r\n    if (!birthDate) return null;\r\n    const today = new Date();\r\n    const birth = new Date(birthDate);\r\n    let age = today.getFullYear() - birth.getFullYear();\r\n    const monthDiff = today.getMonth() - birth.getMonth();\r\n    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {\r\n      age--;\r\n    }\r\n    return age;\r\n  };\r\n\r\n  const getInitials = (name: string) => {\r\n    return name\r\n      .split(\" \")\r\n      .map((n) => n[0])\r\n      .join(\"\")\r\n      .toUpperCase()\r\n      .slice(0, 2);\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-screen\">\r\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!patient) {\r\n    return (\r\n      <div className=\"container mx-auto px-4 py-8\">\r\n        <Card>\r\n          <CardContent className=\"py-12\">\r\n            <div className=\"text-center\">\r\n              <AlertCircle className=\"h-12 w-12 text-red-500 mx-auto mb-4\" />\r\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">\r\n                Paciente no encontrado\r\n              </h3>\r\n              <Button onClick={() => router.back()}>Volver</Button>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const age = calculateAge(patient.fecha_nacimiento);\r\n\r\n  return (\r\n    <VerificationGuard>\r\n      <div className=\"container mx-auto px-4 py-8 space-y-6\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center gap-4\">\r\n          <Button variant=\"ghost\" size=\"sm\" onClick={() => router.back()}>\r\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\r\n            Volver\r\n          </Button>\r\n        </div>\r\n\r\n        {/* Patient Header Card */}\r\n        <Card>\r\n          <CardContent className=\"p-6\">\r\n            <div className=\"flex items-start gap-6\">\r\n              <Avatar className=\"h-24 w-24\">\r\n                <AvatarImage src={patient.avatar_url || undefined} />\r\n                <AvatarFallback className=\"text-2xl\">\r\n                  {getInitials(patient.nombre_completo)}\r\n                </AvatarFallback>\r\n              </Avatar>\r\n              <div className=\"flex-1\">\r\n                <div className=\"flex items-start justify-between\">\r\n                  <div>\r\n                    <h1 className=\"text-3xl font-bold text-gray-900\">\r\n                      {patient.nombre_completo}\r\n                    </h1>\r\n                    <div className=\"flex items-center gap-4 mt-2 text-gray-600\">\r\n                      {age && <span>{age} años</span>}\r\n                      {patient.genero && (\r\n                        <Badge variant=\"outline\">\r\n                          {patient.genero === \"M\" ? \"Masculino\" : \"Femenino\"}\r\n                        </Badge>\r\n                      )}\r\n                      {patient.tipo_sangre && (\r\n                        <Badge variant=\"outline\">Tipo {patient.tipo_sangre}</Badge>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                  <Button onClick={() => router.push(`/dashboard/medico/pacientes/${patientId}/editar`)}>\r\n                    <Edit className=\"h-4 w-4 mr-2\" />\r\n                    Editar\r\n                  </Button>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mt-6\">\r\n                  {patient.telefono && (\r\n                    <div className=\"flex items-center gap-2 text-sm\">\r\n                      <Phone className=\"h-4 w-4 text-gray-400\" />\r\n                      <span>{patient.telefono}</span>\r\n                    </div>\r\n                  )}\r\n                  <div className=\"flex items-center gap-2 text-sm\">\r\n                    <Mail className=\"h-4 w-4 text-gray-400\" />\r\n                    <span>{patient.email}</span>\r\n                  </div>\r\n                  {patient.direccion && (\r\n                    <div className=\"flex items-center gap-2 text-sm\">\r\n                      <MapPin className=\"h-4 w-4 text-gray-400\" />\r\n                      <span className=\"truncate\">{patient.direccion}</span>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                {relation && (\r\n                  <div className=\"flex items-center gap-6 mt-4 pt-4 border-t\">\r\n                    <div className=\"text-sm\">\r\n                      <span className=\"text-gray-600\">Primera consulta:</span>{\" \"}\r\n                      <span className=\"font-medium\">\r\n                        {relation.first_consultation_date\r\n                          ? format(new Date(relation.first_consultation_date), \"dd/MM/yyyy\", { locale: es })\r\n                          : \"N/A\"}\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"text-sm\">\r\n                      <span className=\"text-gray-600\">Última consulta:</span>{\" \"}\r\n                      <span className=\"font-medium\">\r\n                        {relation.last_consultation_date\r\n                          ? format(new Date(relation.last_consultation_date), \"dd/MM/yyyy\", { locale: es })\r\n                          : \"N/A\"}\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"text-sm\">\r\n                      <span className=\"text-gray-600\">Total consultas:</span>{\" \"}\r\n                      <span className=\"font-medium\">{relation.total_consultations}</span>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Quick Actions */}\r\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n          <Button\r\n            variant=\"outline\"\r\n            onClick={() => router.push(`/dashboard/medico/recetas/nueva?paciente=${patientId}`)}\r\n            className=\"h-auto py-4\"\r\n          >\r\n            <div className=\"flex flex-col items-center gap-2\">\r\n              <Pill className=\"h-6 w-6\" />\r\n              <span>Nueva Receta</span>\r\n            </div>\r\n          </Button>\r\n          <Button\r\n            variant=\"outline\"\r\n            onClick={() => router.push(`/dashboard/medico/notas/nueva?paciente=${patientId}`)}\r\n            className=\"h-auto py-4\"\r\n          >\r\n            <div className=\"flex flex-col items-center gap-2\">\r\n              <FileText className=\"h-6 w-6\" />\r\n              <span>Nueva Nota</span>\r\n            </div>\r\n          </Button>\r\n          <Button\r\n            variant=\"outline\"\r\n            onClick={() => router.push(`/dashboard/medico/citas/nueva?paciente=${patientId}`)}\r\n            className=\"h-auto py-4\"\r\n          >\r\n            <div className=\"flex flex-col items-center gap-2\">\r\n              <Calendar className=\"h-6 w-6\" />\r\n              <span>Agendar Cita</span>\r\n            </div>\r\n          </Button>\r\n          <Button\r\n            variant=\"outline\"\r\n            onClick={() => router.push(`/dashboard/medico/mensajeria?paciente=${patientId}`)}\r\n            className=\"h-auto py-4\"\r\n          >\r\n            <div className=\"flex flex-col items-center gap-2\">\r\n              <Mail className=\"h-6 w-6\" />\r\n              <span>Enviar Mensaje</span>\r\n            </div>\r\n          </Button>\r\n        </div>\r\n\r\n        {/* Tabs Content */}\r\n        <Tabs defaultValue=\"historial\" className=\"space-y-6\">\r\n          <TabsList className=\"grid w-full grid-cols-4\">\r\n            <TabsTrigger value=\"historial\">\r\n              <Activity className=\"h-4 w-4 mr-2\" />\r\n              Historial\r\n            </TabsTrigger>\r\n            <TabsTrigger value=\"citas\">\r\n              <Calendar className=\"h-4 w-4 mr-2\" />\r\n              Citas ({appointments.length})\r\n            </TabsTrigger>\r\n            <TabsTrigger value=\"recetas\">\r\n              <Pill className=\"h-4 w-4 mr-2\" />\r\n              Recetas ({prescriptions.length})\r\n            </TabsTrigger>\r\n            <TabsTrigger value=\"notas\">\r\n              <FileText className=\"h-4 w-4 mr-2\" />\r\n              Notas ({medicalNotes.length})\r\n            </TabsTrigger>\r\n          </TabsList>\r\n\r\n          {/* Historial Tab */}\r\n          <TabsContent value=\"historial\">\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n              {/* Información Médica */}\r\n              <Card>\r\n                <CardHeader>\r\n                  <CardTitle>Información Médica</CardTitle>\r\n                </CardHeader>\r\n                <CardContent className=\"space-y-4\">\r\n                  {patient.alergias && patient.alergias.length > 0 && (\r\n                    <div>\r\n                      <h4 className=\"font-semibold text-sm text-gray-700 mb-2\">Alergias</h4>\r\n                      <div className=\"flex flex-wrap gap-2\">\r\n                        {patient.alergias.map((alergia, idx) => (\r\n                          <Badge key={idx} variant=\"destructive\">{alergia}</Badge>\r\n                        ))}\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                  {patient.condiciones_cronicas && patient.condiciones_cronicas.length > 0 && (\r\n                    <div>\r\n                      <h4 className=\"font-semibold text-sm text-gray-700 mb-2\">Condiciones Crónicas</h4>\r\n                      <div className=\"flex flex-wrap gap-2\">\r\n                        {patient.condiciones_cronicas.map((condicion, idx) => (\r\n                          <Badge key={idx} variant=\"secondary\">{condicion}</Badge>\r\n                        ))}\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                  {patient.medicamentos_actuales && patient.medicamentos_actuales.length > 0 && (\r\n                    <div>\r\n                      <h4 className=\"font-semibold text-sm text-gray-700 mb-2\">Medicamentos Actuales</h4>\r\n                      <div className=\"flex flex-wrap gap-2\">\r\n                        {patient.medicamentos_actuales.map((med, idx) => (\r\n                          <Badge key={idx} variant=\"outline\">{med}</Badge>\r\n                        ))}\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                  {(!patient.alergias || patient.alergias.length === 0) &&\r\n                    (!patient.condiciones_cronicas || patient.condiciones_cronicas.length === 0) &&\r\n                    (!patient.medicamentos_actuales || patient.medicamentos_actuales.length === 0) && (\r\n                      <p className=\"text-sm text-gray-500 text-center py-4\">\r\n                        No hay información médica registrada\r\n                      </p>\r\n                    )}\r\n                </CardContent>\r\n              </Card>\r\n\r\n              {/* Notas del Médico */}\r\n              <Card>\r\n                <CardHeader>\r\n                  <CardTitle>Notas del Médico</CardTitle>\r\n                  <CardDescription>Observaciones sobre el paciente</CardDescription>\r\n                </CardHeader>\r\n                <CardContent>\r\n                  {relation?.notes ? (\r\n                    <p className=\"text-sm text-gray-700\">{relation.notes}</p>\r\n                  ) : (\r\n                    <p className=\"text-sm text-gray-500 text-center py-4\">\r\n                      No hay notas registradas\r\n                    </p>\r\n                  )}\r\n                </CardContent>\r\n              </Card>\r\n            </div>\r\n          </TabsContent>\r\n\r\n          {/* Citas Tab */}\r\n          <TabsContent value=\"citas\">\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>Historial de Citas</CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                {appointments.length > 0 ? (\r\n                  <div className=\"space-y-4\">\r\n                    {appointments.map((apt) => (\r\n                      <div\r\n                        key={apt.id}\r\n                        className=\"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50\"\r\n                      >\r\n                        <div className=\"flex items-center gap-4\">\r\n                          <div className=\"h-12 w-12 rounded-full bg-blue-100 flex items-center justify-center\">\r\n                            <Calendar className=\"h-6 w-6 text-blue-600\" />\r\n                          </div>\r\n                          <div>\r\n                            <p className=\"font-medium\">\r\n                              {apt.fecha_hora ? format(new Date(apt.fecha_hora), \"dd 'de' MMMM, yyyy\", { locale: es }) : 'Fecha no disponible'}\r\n                            </p>\r\n                            <p className=\"text-sm text-gray-600\">\r\n                              {apt.fecha_hora ? format(new Date(apt.fecha_hora), \"HH:mm\") : 'N/A'} • {apt.duracion_minutos || 0} min\r\n                            </p>\r\n                            {apt.motivo && (\r\n                              <p className=\"text-sm text-gray-500 mt-1\">{apt.motivo}</p>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                        <Badge>\r\n                          {apt.status === \"pendiente\" && \"Pendiente\"}\r\n                          {apt.status === \"confirmada\" && \"Confirmada\"}\r\n                          {apt.status === \"completada\" && \"Completada\"}\r\n                          {apt.status === \"cancelada\" && \"Cancelada\"}\r\n                        </Badge>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                ) : (\r\n                  <p className=\"text-center text-gray-500 py-8\">\r\n                    No hay citas registradas\r\n                  </p>\r\n                )}\r\n              </CardContent>\r\n            </Card>\r\n          </TabsContent>\r\n\r\n          {/* Recetas Tab */}\r\n          <TabsContent value=\"recetas\">\r\n            <Card>\r\n              <CardHeader>\r\n                <div className=\"flex items-center justify-between\">\r\n                  <CardTitle>Recetas Médicas</CardTitle>\r\n                  <Button\r\n                    size=\"sm\"\r\n                    onClick={() => router.push(`/dashboard/medico/recetas/nueva?paciente=${patientId}`)}\r\n                  >\r\n                    <Plus className=\"h-4 w-4 mr-2\" />\r\n                    Nueva Receta\r\n                  </Button>\r\n                </div>\r\n              </CardHeader>\r\n              <CardContent>\r\n                {prescriptions.length > 0 ? (\r\n                  <div className=\"space-y-4\">\r\n                    {prescriptions.map((rx) => (\r\n                      <div\r\n                        key={rx.id}\r\n                        className=\"p-4 border rounded-lg hover:bg-gray-50 cursor-pointer\"\r\n                        onClick={() => router.push(`/dashboard/medico/recetas/${rx.id}`)}\r\n                      >\r\n                        <div className=\"flex items-start justify-between\">\r\n                          <div>\r\n                            <p className=\"font-medium\">{rx.diagnostico || \"Sin diagnóstico\"}</p>\r\n                            <p className=\"text-sm text-gray-600 mt-1\">\r\n                              {format(new Date(rx.created_at), \"dd/MM/yyyy HH:mm\")}\r\n                            </p>\r\n                          </div>\r\n                          <Badge>{rx.status}</Badge>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                ) : (\r\n                  <p className=\"text-center text-gray-500 py-8\">\r\n                    No hay recetas registradas\r\n                  </p>\r\n                )}\r\n              </CardContent>\r\n            </Card>\r\n          </TabsContent>\r\n\r\n          {/* Notas Tab */}\r\n          <TabsContent value=\"notas\">\r\n            <Card>\r\n              <CardHeader>\r\n                <div className=\"flex items-center justify-between\">\r\n                  <CardTitle>Notas Médicas</CardTitle>\r\n                  <Button\r\n                    size=\"sm\"\r\n                    onClick={() => router.push(`/dashboard/medico/notas/nueva?paciente=${patientId}`)}\r\n                  >\r\n                    <Plus className=\"h-4 w-4 mr-2\" />\r\n                    Nueva Nota\r\n                  </Button>\r\n                </div>\r\n              </CardHeader>\r\n              <CardContent>\r\n                {medicalNotes.length > 0 ? (\r\n                  <div className=\"space-y-4\">\r\n                    {medicalNotes.map((note) => (\r\n                      <div\r\n                        key={note.id}\r\n                        className=\"p-4 border rounded-lg hover:bg-gray-50\"\r\n                      >\r\n                        <div className=\"flex items-start justify-between mb-2\">\r\n                          <h4 className=\"font-medium\">{note.title || \"Sin título\"}</h4>\r\n                          <Badge variant=\"outline\">{note.note_type}</Badge>\r\n                        </div>\r\n                        <p className=\"text-sm text-gray-700 mb-2\">{note.content}</p>\r\n                        <p className=\"text-xs text-gray-500\">\r\n                          {format(new Date(note.created_at), \"dd/MM/yyyy HH:mm\")}\r\n                        </p>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                ) : (\r\n                  <p className=\"text-center text-gray-500 py-8\">\r\n                    No hay notas registradas\r\n                  </p>\r\n                )}\r\n              </CardContent>\r\n            </Card>\r\n          </TabsContent>\r\n        </Tabs>\r\n      </div>\r\n    </VerificationGuard>\r\n  );\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\medico\\pacientes\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'params' is defined but never used.","line":7,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import PatientDetailPage from \"./client\";\r\n\r\nexport async function generateStaticParams() {\r\n    return [{ id: \"1\" }];\r\n}\r\n\r\nexport default function Page({ params }: { params: Promise<{ id: string }> }) {\r\n    return <PatientDetailPage />;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\medico\\pacientes\\consulta\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tratamiento' is assigned a value but never used.","line":35,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setTratamiento' is assigned a value but never used.","line":36,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'observaciones' is assigned a value but never used.","line":37,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":37,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setObservaciones' is assigned a value but never used.","line":38,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useSearchParams, useRouter } from \"next/navigation\";\r\nimport { Suspense } from \"react\";\r\nimport { VerificationGuard } from \"@/components/dashboard/medico/features/verification-guard\";\r\nimport { MedicalWorkspace } from \"@/components/dashboard/medico/medical-workspace\";\r\nimport { Loader2 } from \"lucide-react\";\r\nimport { useConsultation } from \"@/components/dashboard/medico/consulta/hooks/use-consultation\";\r\n\r\nfunction ConsultaContent() {\r\n  const router = useRouter();\r\n  const searchParams = useSearchParams();\r\n  const appointmentId = searchParams.get(\"appointment_id\");\r\n  const pacienteId = searchParams.get(\"paciente_id\");\r\n  const fromPage = searchParams.get(\"from\");\r\n\r\n  const {\r\n    appointment,\r\n    patient,\r\n    loading,\r\n    saving,\r\n    error,\r\n    lastSaved,\r\n    autoSaving,\r\n    alergias,\r\n    setAlergias,\r\n    condicionesCronicas,\r\n    setCondicionesCronicas,\r\n    medicamentosActuales,\r\n    setMedicamentosActuales,\r\n    notasMedicas,\r\n    setNotasMedicas,\r\n    diagnosticos,\r\n    setDiagnosticos,\r\n    tratamiento,\r\n    setTratamiento,\r\n    observaciones,\r\n    setObservaciones,\r\n    saveConsultation,\r\n  } = useConsultation(appointmentId, pacienteId, fromPage);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-screen\">\r\n        <div className=\"text-center\">\r\n          <Loader2 className=\"h-12 w-12 animate-spin text-blue-600 mx-auto mb-4\" />\r\n          <p className=\"text-gray-600\">Cargando datos del paciente...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error || !appointment || !patient) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-screen\">\r\n        <div className=\"text-center\">\r\n          <p className=\"text-red-600 mb-4\">{error || \"Error al cargar los datos\"}</p>\r\n          <button\r\n            onClick={() => router.back()}\r\n            className=\"text-blue-600 hover:underline\"\r\n          >\r\n            Volver\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const pacienteData = {\r\n    cedula: patient.cedula,\r\n    nombre_completo: patient.nombre_completo,\r\n    edad: patient.fecha_nacimiento\r\n      ? Math.floor((new Date().getTime() - new Date(patient.fecha_nacimiento).getTime()) / (365.25 * 24 * 60 * 60 * 1000))\r\n      : null,\r\n    genero: patient.genero || \"\",\r\n  };\r\n\r\n  return (\r\n    <VerificationGuard>\r\n      {/* Indicador de autoguardado */}\r\n      {lastSaved && (\r\n        <div className=\"fixed top-4 right-4 z-50 bg-green-100 text-green-800 px-4 py-2 rounded-lg shadow-lg text-sm flex items-center gap-2\">\r\n          <svg className=\"h-4 w-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\r\n          </svg>\r\n          Guardado automático: {lastSaved.toLocaleTimeString()}\r\n        </div>\r\n      )}\r\n      {autoSaving && (\r\n        <div className=\"fixed top-4 right-4 z-50 bg-blue-100 text-blue-800 px-4 py-2 rounded-lg shadow-lg text-sm flex items-center gap-2\">\r\n          <svg className=\"animate-spin h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n            <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\r\n            <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n          </svg>\r\n          Guardando...\r\n        </div>\r\n      )}\r\n      <MedicalWorkspace\r\n        paciente={pacienteData}\r\n        alergias={alergias}\r\n        setAlergias={setAlergias}\r\n        condicionesCronicas={condicionesCronicas}\r\n        setCondicionesCronicas={setCondicionesCronicas}\r\n        medicamentosActuales={medicamentosActuales}\r\n        setMedicamentosActuales={setMedicamentosActuales}\r\n        notasMedicas={notasMedicas}\r\n        setNotasMedicas={setNotasMedicas}\r\n        diagnosticos={diagnosticos}\r\n        setDiagnosticos={setDiagnosticos}\r\n        onSave={saveConsultation}\r\n        onBack={() => router.back()}\r\n        loading={saving}\r\n      />\r\n    </VerificationGuard>\r\n  );\r\n}\r\n\r\nexport default function ConsultaPage() {\r\n  return (\r\n    <Suspense fallback={\r\n      <div className=\"flex items-center justify-center min-h-screen\">\r\n        <Loader2 className=\"h-12 w-12 animate-spin text-blue-600\" />\r\n      </div>\r\n    }>\r\n      <ConsultaContent />\r\n    </Suspense>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\medico\\pacientes\\nuevo\\_components\\patient-primary-info.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Badge' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useState' is defined but never used.","line":9,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { Textarea } from \"@red-salud/ui\";\r\nimport { Label } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { CheckCircle, UserPlus, Calendar, Phone, Mail, MapPin, FileText, AlertCircle } from \"lucide-react\";\r\nimport { useEffect, useState } from \"react\";\r\nimport \"../_styles/responsive.css\";\r\n\r\ntype FormData = {\r\n  cedula: string;\r\n  nombre_completo: string;\r\n  fecha_nacimiento: string;\r\n  genero: string;\r\n  telefono: string;\r\n  email: string;\r\n  direccion: string;\r\n};\r\n\r\ntype Props = {\r\n  formData: FormData;\r\n  setFormData: (data: FormData) => void;\r\n  edad: number | null;\r\n  cedulaFound: boolean;\r\n  validatingCedula: boolean;\r\n  alergias: string[];\r\n  setAlergias: (a: string[]) => void;\r\n  notasMedicas: string;\r\n  setNotasMedicas: (s: string) => void;\r\n  observaciones: string;\r\n  setObservaciones: (s: string) => void;\r\n  emailError?: string | null;\r\n  telefonoError?: string | null;\r\n  ageError?: string | null;\r\n  dateMin?: string;\r\n  dateMax?: string;\r\n  enforcePhonePrefix?: (v: string) => void;\r\n};\r\n\r\nexport function PatientPrimaryInfo({ formData, setFormData, edad, cedulaFound, validatingCedula, alergias, setAlergias, notasMedicas, setNotasMedicas, observaciones, setObservaciones, emailError, telefonoError, ageError, dateMin, dateMax, enforcePhonePrefix }: Props) {\r\n  return (\r\n    <div className=\"bg-white rounded-2xl border shadow-sm p-6 space-y-8\">\r\n      {/* Sección 1: Identidad */}\r\n      <div className=\"space-y-4\">\r\n        <div className=\"flex items-center gap-3 pb-2 border-b\">\r\n          <div className=\"h-8 w-8 rounded-lg bg-blue-100 flex items-center justify-center\">\r\n            <UserPlus className=\"h-4 w-4 text-blue-600\" />\r\n          </div>\r\n          <h2 className=\"text-base font-semibold text-gray-900\">Identidad del Paciente</h2>\r\n        </div>\r\n\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n          {/* Cédula */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"cedula\" className=\"text-sm font-medium text-gray-700\">\r\n              Cédula <span className=\"text-red-500\">*</span>\r\n            </Label>\r\n            <div className=\"relative\">\r\n              <Input\r\n                id=\"cedula\"\r\n                type=\"text\"\r\n                placeholder=\"Ej: 12345678\"\r\n                value={formData.cedula}\r\n                onChange={(e) => setFormData({ ...formData, cedula: e.target.value })}\r\n                required\r\n                className=\"pr-10\"\r\n              />\r\n              {validatingCedula && (\r\n                <div className=\"absolute right-3 top-1/2 -translate-y-1/2\">\r\n                  <Calendar className=\"h-4 w-4 animate-pulse text-blue-600\" />\r\n                </div>\r\n              )}\r\n              {!validatingCedula && cedulaFound && (\r\n                <div className=\"absolute right-3 top-1/2 -translate-y-1/2\">\r\n                  <CheckCircle className=\"h-4 w-4 text-green-600\" />\r\n                </div>\r\n              )}\r\n            </div>\r\n            {cedulaFound && !validatingCedula && (\r\n              <p className=\"text-xs text-green-600 flex items-center gap-1\">\r\n                <CheckCircle className=\"h-3 w-3\" />\r\n                Verificado\r\n              </p>\r\n            )}\r\n          </div>\r\n\r\n          {/* Nombre Completo */}\r\n          <div className=\"space-y-2 md:col-span-2 lg:col-span-2\">\r\n            <Label htmlFor=\"nombre_completo\" className=\"text-sm font-medium text-gray-700\">\r\n              Nombre Completo <span className=\"text-red-500\">*</span>\r\n            </Label>\r\n            <Input\r\n              id=\"nombre_completo\"\r\n              type=\"text\"\r\n              placeholder=\"Ej: Juan Pérez\"\r\n              value={formData.nombre_completo}\r\n              onChange={(e) => setFormData({ ...formData, nombre_completo: e.target.value })}\r\n              required\r\n              disabled={validatingCedula}\r\n              className={cedulaFound ? \"bg-green-50 border-green-300\" : \"\"}\r\n            />\r\n          </div>\r\n\r\n          {/* Género */}\r\n          <div className=\"space-y-2\">\r\n            <Label className=\"text-sm font-medium text-gray-700\">Género</Label>\r\n            <div className=\"flex gap-2\">\r\n              <Button\r\n                type=\"button\"\r\n                variant={formData.genero === \"M\" ? \"default\" : \"outline\"}\r\n                className=\"flex-1 px-2\"\r\n                onClick={() => setFormData({ ...formData, genero: \"M\" })}\r\n              >\r\n                M\r\n              </Button>\r\n              <Button\r\n                type=\"button\"\r\n                variant={formData.genero === \"F\" ? \"default\" : \"outline\"}\r\n                className=\"flex-1 px-2\"\r\n                onClick={() => setFormData({ ...formData, genero: \"F\" })}\r\n              >\r\n                F\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Fecha Nacimiento */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"fecha_nacimiento\" className=\"text-sm font-medium text-gray-700\">\r\n              Fecha Nacimiento\r\n            </Label>\r\n            <Input\r\n              id=\"fecha_nacimiento\"\r\n              type=\"date\"\r\n              value={formData.fecha_nacimiento}\r\n              onChange={(e) => setFormData({ ...formData, fecha_nacimiento: e.target.value })}\r\n              min={dateMin}\r\n              max={dateMax}\r\n            />\r\n            {ageError && <p className=\"text-xs text-red-600\">{ageError}</p>}\r\n          </div>\r\n\r\n          {/* Edad (Calculada) */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"edad\" className=\"text-sm font-medium text-gray-700\">\r\n              Edad\r\n            </Label>\r\n            <div className=\"relative\">\r\n              <Input\r\n                id=\"edad\"\r\n                type=\"text\"\r\n                value={edad !== null ? `${edad} años` : \"\"}\r\n                disabled\r\n                placeholder=\"Auto\"\r\n                className=\"bg-gray-50\"\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Sección 2: Contacto */}\r\n      <div className=\"space-y-4\">\r\n        <div className=\"flex items-center gap-3 pb-2 border-b\">\r\n          <div className=\"h-8 w-8 rounded-lg bg-purple-100 flex items-center justify-center\">\r\n            <Phone className=\"h-4 w-4 text-purple-600\" />\r\n          </div>\r\n          <h2 className=\"text-base font-semibold text-gray-900\">Datos de Contacto</h2>\r\n        </div>\r\n\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n          {/* Teléfono */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"telefono\" className=\"text-sm font-medium text-gray-700\">\r\n              Teléfono\r\n            </Label>\r\n            <div className=\"relative\">\r\n              <Phone className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400\" />\r\n              <Input\r\n                id=\"telefono\"\r\n                type=\"tel\"\r\n                inputMode=\"tel\"\r\n                placeholder=\"+58 412 1234567\"\r\n                value={formData.telefono}\r\n                onChange={(e) => enforcePhonePrefix ? enforcePhonePrefix(e.target.value) : setFormData({ ...formData, telefono: e.target.value })}\r\n                className={`pl-9 ${telefonoError ? \"border-red-500 focus-visible:ring-red-500\" : \"\"}`}\r\n                maxLength={16}\r\n              />\r\n            </div>\r\n            {telefonoError && <p className=\"text-xs text-red-600\">{telefonoError}</p>}\r\n          </div>\r\n\r\n          {/* Email */}\r\n          <div className=\"space-y-2 md:col-span-2 lg:col-span-2\">\r\n            <Label htmlFor=\"email\" className=\"text-sm font-medium text-gray-700\">\r\n              Email\r\n            </Label>\r\n            <div className=\"relative\">\r\n              <Mail className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400\" />\r\n              <Input\r\n                id=\"email\"\r\n                type=\"email\"\r\n                placeholder=\"paciente@ejemplo.com\"\r\n                value={formData.email}\r\n                onChange={(e) => setFormData({ ...formData, email: e.target.value })}\r\n                className={`pl-9 ${emailError ? \"border-red-500 focus-visible:ring-red-500\" : \"\"}`}\r\n              />\r\n            </div>\r\n            {emailError && <p className=\"text-xs text-red-600\">{emailError}</p>}\r\n          </div>\r\n\r\n          {/* Dirección */}\r\n          <div className=\"space-y-2 md:col-span-2 lg:col-span-3\">\r\n            <Label htmlFor=\"direccion\" className=\"text-sm font-medium text-gray-700\">\r\n              Dirección\r\n            </Label>\r\n            <div className=\"relative\">\r\n              <MapPin className=\"absolute left-3 top-3 h-4 w-4 text-gray-400\" />\r\n              <Textarea\r\n                id=\"direccion\"\r\n                placeholder=\"Calle, ciudad, estado\"\r\n                value={formData.direccion}\r\n                onChange={(e) => setFormData({ ...formData, direccion: e.target.value })}\r\n                className=\"pl-9 min-h-[60px]\"\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Sección 3: Información Médica */}\r\n      <div className=\"space-y-4\">\r\n        <div className=\"flex items-center gap-3 pb-2 border-b\">\r\n          <div className=\"h-8 w-8 rounded-lg bg-green-100 flex items-center justify-center\">\r\n            <FileText className=\"h-4 w-4 text-green-600\" />\r\n          </div>\r\n          <h2 className=\"text-base font-semibold text-gray-900\">Información Médica Básica</h2>\r\n        </div>\r\n\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n          {/* Alergias */}\r\n          <div className=\"space-y-2 md:col-span-2\">\r\n            <Label htmlFor=\"alergias\" className=\"text-sm font-medium text-gray-700\">\r\n              Alergias Conocidas\r\n            </Label>\r\n            <div className=\"relative\">\r\n              <AlertCircle className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400\" />\r\n              <Input\r\n                id=\"alergias\"\r\n                type=\"text\"\r\n                placeholder=\"Ej: Penicilina, Polvo, Mani\"\r\n                value={alergias.join(\", \")}\r\n                onChange={(e) => setAlergias(e.target.value.split(\",\").map((s) => s.trim()).filter(Boolean))}\r\n                className=\"pl-9\"\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          {/* Historial */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"historial\" className=\"text-sm font-medium text-gray-700\">\r\n              Historial Médico Breve\r\n            </Label>\r\n            <Textarea\r\n              id=\"historial\"\r\n              placeholder=\"Antecedentes relevantes...\"\r\n              value={notasMedicas}\r\n              onChange={(e) => setNotasMedicas(e.target.value)}\r\n              className=\"min-h-[80px]\"\r\n            />\r\n          </div>\r\n\r\n          {/* Observaciones */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"observaciones\" className=\"text-sm font-medium text-gray-700\">\r\n              Observaciones Adicionales\r\n            </Label>\r\n            <Textarea\r\n              id=\"observaciones\"\r\n              placeholder=\"Notas complementarias...\"\r\n              value={observaciones}\r\n              onChange={(e) => setObservaciones(e.target.value)}\r\n              className=\"min-h-[80px]\"\r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\medico\\pacientes\\nuevo\\_utils\\consulta.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\medico\\pacientes\\nuevo\\_utils\\phone.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\medico\\pacientes\\nuevo\\_utils\\validation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\medico\\pacientes\\nuevo\\consulta\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useMemo' is defined but never used.","line":4,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":28},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'showRegistration'. Either include it or remove the dependency array.","line":37,"column":6,"nodeType":"ArrayExpression","endLine":37,"endColumn":24,"suggestions":[{"desc":"Update the dependencies array to be: [paciente, router, showRegistration]","fix":{"range":[1996,2014],"text":"[paciente, router, showRegistration]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useSearchParams, useRouter } from \"next/navigation\";\r\nimport { useEffect, useMemo, useState } from \"react\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { VerificationGuard } from \"@/components/dashboard/medico/features/verification-guard\";\r\nimport { MedicalWorkspace } from \"@/components/dashboard/medico/medical-workspace\";\r\nimport { QuickRegistrationModal } from \"@/components/dashboard/medico/pacientes/quick-registration-modal\";\r\nimport { buildPacienteFromParams } from \"../_utils/consulta\";\r\n\r\nimport { Suspense } from \"react\";\r\n\r\nfunction ConsultaContent() {\r\n  const router = useRouter();\r\n  const searchParams = useSearchParams();\r\n  // Inicialmente construimos desde params, pero podemos actualizarlo tras el registro rápido\r\n  const [paciente, setPaciente] = useState(() => buildPacienteFromParams(searchParams as unknown as URLSearchParams));\r\n  const [showRegistration, setShowRegistration] = useState(false);\r\n\r\n  const [alergias, setAlergias] = useState<string[]>([]);\r\n  const [condicionesCronicas, setCondicionesCronicas] = useState<string[]>([]);\r\n  const [medicamentosActuales, setMedicamentosActuales] = useState<string[]>([]);\r\n  const [notasMedicas, setNotasMedicas] = useState(\"\");\r\n  const [diagnosticos, setDiagnosticos] = useState<string[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    // Si no hay ID (es un paciente nuevo desde params) y tenemos datos básicos, mostrar modal\r\n    // Verificamos si ya estamos \"registrados\" en el estado local (paciente.id)\r\n    if ((!paciente.id && paciente.cedula && paciente.nombre_completo) && !showRegistration) {\r\n      // Verificar si realmente no existe (doble check opcional, pero aquí asumimos que el flujo anterior ya buscó)\r\n      // Mostramos el modal para completar datos\r\n      setShowRegistration(true);\r\n    } else if (!paciente.cedula || !paciente.nombre_completo) {\r\n      router.replace(\"/dashboard/medico/pacientes/nuevo\");\r\n    }\r\n  }, [paciente, router]);\r\n\r\n  const handleRegistrationSuccess = (patientId: string, patientData: Record<string, unknown>) => {\r\n    // Actualizar el estado del paciente con los datos reales de la BD\r\n    setPaciente({\r\n      ...paciente,\r\n      id: patientId,\r\n      ...patientData,\r\n      // Asegurar que usamos el formato correcto para MedicalWorkspace\r\n      edad: patientData.fecha_nacimiento && typeof patientData.fecha_nacimiento === 'string' ? calculateAge(patientData.fecha_nacimiento) : null,\r\n    });\r\n    setShowRegistration(false);\r\n  };\r\n\r\n  const calculateAge = (birthDate: string) => {\r\n    const today = new Date();\r\n    const birth = new Date(birthDate);\r\n    let age = today.getFullYear() - birth.getFullYear();\r\n    const m = today.getMonth() - birth.getMonth();\r\n    if (m < 0 || (m === 0 && today.getDate() < birth.getDate())) {\r\n      age--;\r\n    }\r\n    return age;\r\n  };\r\n\r\n  const onSave = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) {\r\n        router.push(\"/login/medico\");\r\n        return;\r\n      }\r\n\r\n      const notasConDiagnosticos = notasMedicas + (diagnosticos.length > 0 ? `\\n\\nDiagnósticos:\\n${diagnosticos.join(\"\\n\")}` : \"\");\r\n\r\n      // Si ya tenemos ID (registrado vía modal), actualizamos\r\n      if (paciente.id) {\r\n        const { error: updateError } = await supabase\r\n          .from(\"offline_patients\")\r\n          .update({\r\n            alergias: alergias.length > 0 ? alergias : null,\r\n            condiciones_cronicas: condicionesCronicas.length > 0 ? condicionesCronicas : null,\r\n            medicamentos_actuales: medicamentosActuales.length > 0 ? medicamentosActuales : null,\r\n            notas_medico: notasConDiagnosticos || null,\r\n          })\r\n          .eq(\"id\", paciente.id);\r\n\r\n        if (updateError) throw updateError;\r\n        router.push(`/dashboard/medico/pacientes/offline/${paciente.id}`);\r\n      } else {\r\n        // Fallback original (por si acaso)\r\n        const { data: offlinePatient, error: insertError } = await supabase\r\n          .from(\"offline_patients\")\r\n          .insert({\r\n            doctor_id: user.id,\r\n            cedula: paciente.cedula,\r\n            nombre_completo: paciente.nombre_completo,\r\n            fecha_nacimiento: null,\r\n            genero: paciente.genero || null,\r\n            telefono: null,\r\n            email: null,\r\n            direccion: null,\r\n            alergias: alergias.length > 0 ? alergias : null,\r\n            condiciones_cronicas: condicionesCronicas.length > 0 ? condicionesCronicas : null,\r\n            medicamentos_actuales: medicamentosActuales.length > 0 ? medicamentosActuales : null,\r\n            notas_medico: notasConDiagnosticos || null,\r\n            status: \"offline\",\r\n          })\r\n          .select()\r\n          .single();\r\n        if (insertError) throw insertError;\r\n        router.push(`/dashboard/medico/pacientes/offline/${offlinePatient.id}`);\r\n      }\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <VerificationGuard>\r\n      <MedicalWorkspace\r\n        paciente={paciente}\r\n        alergias={alergias}\r\n        setAlergias={setAlergias}\r\n        condicionesCronicas={condicionesCronicas}\r\n        setCondicionesCronicas={setCondicionesCronicas}\r\n        medicamentosActuales={medicamentosActuales}\r\n        setMedicamentosActuales={setMedicamentosActuales}\r\n        notasMedicas={notasMedicas}\r\n        setNotasMedicas={setNotasMedicas}\r\n        diagnosticos={diagnosticos}\r\n        setDiagnosticos={setDiagnosticos}\r\n        onSave={onSave}\r\n        onBack={() => router.push(\"/dashboard/medico/pacientes/nuevo\")}\r\n        loading={loading}\r\n      />\r\n\r\n      <QuickRegistrationModal\r\n        open={showRegistration}\r\n        onOpenChange={setShowRegistration}\r\n        cedula={paciente.cedula || \"\"}\r\n        nombre={paciente.nombre_completo || \"\"}\r\n        onSuccess={handleRegistrationSuccess}\r\n      />\r\n    </VerificationGuard>\r\n  );\r\n}\r\n\r\nexport default function ConsultaPage() {\r\n  return (\r\n    <Suspense\r\n      fallback={\r\n        <div className=\"flex items-center justify-center min-h-screen\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\" />\r\n        </div>\r\n      }\r\n    >\r\n      <ConsultaContent />\r\n    </Suspense>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\medico\\pacientes\\nuevo\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Input' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Label' is defined but never used.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckCircle' is defined but never used.","line":9,"column":44,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":55},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Loader2' is defined but never used.","line":9,"column":57,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":64},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Sparkles' is defined but never used.","line":9,"column":66,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":74},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used.","line":9,"column":76,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":84},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Badge' is defined but never used.","line":13,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MedicalWorkspace' is defined but never used.","line":14,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'validateVzlaPhone' is defined but never used.","line":17,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":45},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'fromCita' is assigned a value but never used.","line":24,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'loading' is assigned a value but never used.","line":26,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setCurrentStep' is assigned a value but never used.","line":28,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setCondicionesCronicas' is assigned a value but never used.","line":58,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":58,"endColumn":53},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setMedicamentosActuales' is assigned a value but never used.","line":59,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":59,"endColumn":55},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setDiagnosticos' is assigned a value but never used.","line":61,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":61,"endColumn":39},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'formData.telefono'. Either include it or remove the dependency array.","line":142,"column":6,"nodeType":"ArrayExpression","endLine":142,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [formData.telefono]","fix":{"range":[4984,4986],"text":"[formData.telefono]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'saveDraft'. Either include it or remove the dependency array.","line":184,"column":6,"nodeType":"ArrayExpression","endLine":184,"endColumn":200,"suggestions":[{"desc":"Update the dependencies array to be: [formData.cedula, formData.nombre_completo, formData.fecha_nacimiento, formData.genero, formData.telefono, formData.email, formData.direccion, notasMedicas, observaciones, alergias, currentStep, saveDraft]","fix":{"range":[6727,6921],"text":"[formData.cedula, formData.nombre_completo, formData.fecha_nacimiento, formData.genero, formData.telefono, formData.email, formData.direccion, notasMedicas, observaciones, alergias, currentStep, saveDraft]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleSubmit' is assigned a value but never used.","line":201,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":201,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":18,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { useRouter, useSearchParams } from \"next/navigation\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { Label } from \"@red-salud/ui\";\r\nimport { ArrowLeft, UserPlus, AlertCircle, CheckCircle, Loader2, Sparkles, Calendar } from \"lucide-react\";\r\nimport { Alert, AlertDescription } from \"@red-salud/ui\";\r\nimport { VerificationGuard } from \"@/components/dashboard/medico/features/verification-guard\";\r\nimport { validateCedulaWithCNE, isValidVenezuelanCedula, calculateAge } from \"@/lib/services/cedula-validation\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { MedicalWorkspace } from \"@/components/dashboard/medico/medical-workspace\";\r\nimport { PatientPrimaryInfo } from \"./_components/patient-primary-info\";\r\nimport { validateEmailFormat, validatePhoneFormat } from \"./_utils/validation\";\r\nimport { enforceVzlaPhone, validateVzlaPhone } from \"./_utils/phone\";\r\n\r\nimport { Suspense } from \"react\";\r\n\r\nfunction NuevoPacienteContent() {\r\n  const router = useRouter();\r\n  const searchParams = useSearchParams();\r\n  const fromCita = searchParams.get(\"from\") === \"cita\";\r\n\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [currentStep, setCurrentStep] = useState(1);\r\n  const [validatingCedula, setValidatingCedula] = useState(false);\r\n  const [cedulaFound, setCedulaFound] = useState(false);\r\n\r\n  // Si viene de cita, mostrar mensaje y no redirigir automáticamente\r\n  // El usuario ya está en la página correcta\r\n\r\n  type PatientFormData = {\r\n    cedula: string;\r\n    nombre_completo: string;\r\n    fecha_nacimiento: string;\r\n    genero: string;\r\n    telefono: string;\r\n    email: string;\r\n    direccion: string;\r\n  };\r\n\r\n  const [formData, setFormData] = useState<PatientFormData>({\r\n    cedula: \"\",\r\n    nombre_completo: \"\",\r\n    fecha_nacimiento: \"\",\r\n    genero: \"\",\r\n    telefono: \"\",\r\n    email: \"\",\r\n    direccion: \"\",\r\n  });\r\n  const [edad, setEdad] = useState<number | null>(null);\r\n\r\n  // Medical data\r\n  const [alergias, setAlergias] = useState<string[]>([]);\r\n  const [condicionesCronicas, setCondicionesCronicas] = useState<string[]>([]);\r\n  const [medicamentosActuales, setMedicamentosActuales] = useState<string[]>([]);\r\n  const [notasMedicas, setNotasMedicas] = useState(\"\");\r\n  const [diagnosticos, setDiagnosticos] = useState<string[]>([]);\r\n  const [observaciones, setObservaciones] = useState(\"\");\r\n  const [emailError, setEmailError] = useState<string | null>(null);\r\n  const [telefonoError, setTelefonoError] = useState<string | null>(null);\r\n  const [draftSavedOnce, setDraftSavedOnce] = useState(false);\r\n  const [ageError, setAgeError] = useState<string | null>(null);\r\n\r\n  // Calcular edad\r\n  useEffect(() => {\r\n    if (formData.fecha_nacimiento) {\r\n      const calculatedAge = calculateAge(formData.fecha_nacimiento);\r\n      setEdad(calculatedAge);\r\n    } else {\r\n      setEdad(null);\r\n    }\r\n  }, [formData.fecha_nacimiento]);\r\n\r\n  useEffect(() => {\r\n    if (edad === null) {\r\n      setAgeError(null);\r\n      return;\r\n    }\r\n    if (edad < 0) {\r\n      setAgeError(\"La edad no puede ser negativa\");\r\n    } else if (edad > 150) {\r\n      setAgeError(\"La edad no puede superar 150 años\");\r\n    } else {\r\n      setAgeError(null);\r\n    }\r\n  }, [edad]);\r\n\r\n  // Validar cédula\r\n  useEffect(() => {\r\n    const validateCedulaDebounced = async () => {\r\n      const cleanCedula = formData.cedula.trim();\r\n\r\n      if (cleanCedula.length >= 6 && isValidVenezuelanCedula(cleanCedula)) {\r\n        setValidatingCedula(true);\r\n        setCedulaFound(false);\r\n\r\n        try {\r\n          const result = await validateCedulaWithCNE(cleanCedula);\r\n\r\n          if (result.found && result.nombre_completo) {\r\n            setCedulaFound(true);\r\n            setFormData((prev) => ({\r\n              ...prev,\r\n              nombre_completo: result.nombre_completo!,\r\n            }));\r\n          } else {\r\n            setCedulaFound(false);\r\n          }\r\n        } catch (err) {\r\n          console.error(\"Error validating cedula:\", err);\r\n          setCedulaFound(false);\r\n        } finally {\r\n          setValidatingCedula(false);\r\n        }\r\n      } else {\r\n        setValidatingCedula(false);\r\n        setCedulaFound(false);\r\n      }\r\n    };\r\n\r\n    const debounce = setTimeout(validateCedulaDebounced, 400);\r\n    return () => clearTimeout(debounce);\r\n  }, [formData.cedula]);\r\n\r\n\r\n\r\n  useEffect(() => {\r\n    setEmailError(validateEmailFormat(formData.email));\r\n  }, [formData.email]);\r\n  useEffect(() => {\r\n    setTelefonoError(validatePhoneFormat(formData.telefono));\r\n  }, [formData.telefono]);\r\n\r\n  useEffect(() => {\r\n    const { formatted } = enforceVzlaPhone(formData.telefono);\r\n    if (formatted !== formData.telefono) setFormData((prev) => ({ ...prev, telefono: formatted }));\r\n    // Removed immediate validation to prevent error on load\r\n  }, []);\r\n\r\n  const saveDraft = async () => {\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) return;\r\n      const { data: existing } = await supabase\r\n        .from(\"offline_patients\")\r\n        .select(\"id\")\r\n        .eq(\"doctor_id\", user.id)\r\n        .eq(\"cedula\", formData.cedula)\r\n        .maybeSingle();\r\n      const payload: Record<string, unknown> = {\r\n        doctor_id: user.id,\r\n        cedula: formData.cedula,\r\n        nombre_completo: formData.nombre_completo,\r\n        fecha_nacimiento: formData.fecha_nacimiento || null,\r\n        genero: formData.genero || null,\r\n        telefono: formData.telefono || null,\r\n        email: formData.email || null,\r\n        direccion: formData.direccion || null,\r\n        alergias: alergias.length > 0 ? alergias : null,\r\n        condiciones_cronicas: condicionesCronicas.length > 0 ? condicionesCronicas : null,\r\n        medicamentos_actuales: medicamentosActuales.length > 0 ? medicamentosActuales : null,\r\n        notas_medico: (notasMedicas || observaciones) ? `${notasMedicas}${observaciones ? `\\n\\nObservaciones:\\n${observaciones}` : \"\"}` : null,\r\n        status: \"draft\",\r\n      };\r\n      if (existing?.id) {\r\n        await supabase.from(\"offline_patients\").update(payload).eq(\"id\", existing.id);\r\n      } else {\r\n        await supabase.from(\"offline_patients\").insert(payload);\r\n      }\r\n      if (!draftSavedOnce) setDraftSavedOnce(true);\r\n    } catch { }\r\n  };\r\n\r\n  useEffect(() => {\r\n    const ready = formData.cedula.trim().length >= 6 && !!formData.nombre_completo.trim();\r\n    if (!ready || currentStep !== 1) return;\r\n    saveDraft();\r\n    const interval = setInterval(saveDraft, 30000);\r\n    return () => clearInterval(interval);\r\n  }, [formData.cedula, formData.nombre_completo, formData.fecha_nacimiento, formData.genero, formData.telefono, formData.email, formData.direccion, notasMedicas, observaciones, alergias, currentStep]);\r\n\r\n  const handleNextStep = () => {\r\n    if (!formData.cedula || !formData.nombre_completo) {\r\n      setError(\"La cédula y el nombre completo son obligatorios\");\r\n      return;\r\n    }\r\n    setError(null);\r\n    const q = new URLSearchParams({\r\n      cedula: formData.cedula,\r\n      nombre: formData.nombre_completo,\r\n      edad: edad ? String(edad) : \"\",\r\n      genero: formData.genero || \"\",\r\n    }).toString();\r\n    router.push(`/dashboard/medico/pacientes/nuevo/consulta?${q}`);\r\n  };\r\n\r\n  const handleSubmit = async () => {\r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) {\r\n        router.push(\"/login/medico\");\r\n        return;\r\n      }\r\n\r\n      if (!formData.cedula || formData.cedula.length < 6) {\r\n        setError(\"La cédula es requerida y debe tener al menos 6 dígitos\");\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      const { data: existingPatient } = await supabase\r\n        .from(\"profiles\")\r\n        .select(\"id\")\r\n        .eq(\"cedula\", formData.cedula)\r\n        .single();\r\n\r\n      if (existingPatient) {\r\n        const { error: relationError } = await supabase\r\n          .from(\"doctor_patients\")\r\n          .insert({\r\n            doctor_id: user.id,\r\n            patient_id: existingPatient.id,\r\n            first_consultation_date: new Date().toISOString(),\r\n            last_consultation_date: new Date().toISOString(),\r\n            total_consultations: 0,\r\n            notes: notasMedicas || null,\r\n          });\r\n\r\n        if (relationError && relationError.code !== \"23505\") {\r\n          throw relationError;\r\n        }\r\n\r\n        router.push(`/dashboard/medico/pacientes/${existingPatient.id}`);\r\n        return;\r\n      }\r\n\r\n      const notasConDiagnosticos = notasMedicas +\r\n        (diagnosticos.length > 0 ? `\\n\\nDiagnósticos:\\n${diagnosticos.join(\"\\n\")}` : \"\");\r\n\r\n      const { data: offlinePatient, error: insertError } = await supabase\r\n        .from(\"offline_patients\")\r\n        .insert({\r\n          doctor_id: user.id,\r\n          cedula: formData.cedula,\r\n          nombre_completo: formData.nombre_completo,\r\n          fecha_nacimiento: formData.fecha_nacimiento || null,\r\n          genero: formData.genero || null,\r\n          telefono: formData.telefono || null,\r\n          email: formData.email || null,\r\n          direccion: formData.direccion || null,\r\n          alergias: alergias.length > 0 ? alergias : null,\r\n          condiciones_cronicas: condicionesCronicas.length > 0 ? condicionesCronicas : null,\r\n          medicamentos_actuales: medicamentosActuales.length > 0 ? medicamentosActuales : null,\r\n          notas_medico: notasConDiagnosticos || null,\r\n          status: \"offline\",\r\n        })\r\n        .select()\r\n        .single();\r\n\r\n      if (insertError) throw insertError;\r\n\r\n      await supabase.from(\"user_activity_log\").insert({\r\n        user_id: user.id,\r\n        activity_type: \"offline_patient_created\",\r\n        description: `Paciente offline registrado: ${formData.nombre_completo} (${formData.cedula})`,\r\n        status: \"success\",\r\n      });\r\n\r\n      router.push(`/dashboard/medico/pacientes/offline/${offlinePatient.id}`);\r\n    } catch (err) {\r\n      console.error(\"Error creating patient:\", err);\r\n      setError(err instanceof Error ? err.message : \"Error al registrar el paciente\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <VerificationGuard>\r\n      {currentStep === 1 ? (\r\n        <div className=\"min-h-screen w-full bg-gradient-to-br from-blue-50 via-white to-purple-50\">\r\n          {/* Header */}\r\n          <div className=\"bg-white/80 backdrop-blur-sm border-b sticky top-0 z-10\">\r\n            <div className=\"w-full px-6 py-4\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center gap-4\">\r\n                  <Button\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    onClick={() => router.back()}\r\n                    className=\"hover:bg-gray-100\"\r\n                  >\r\n                    <ArrowLeft className=\"h-4 w-4 mr-2\" />\r\n                    Volver\r\n                  </Button>\r\n                  <div className=\"h-6 w-px bg-gray-300\" />\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <div className=\"h-12 w-12 rounded-xl bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center shadow-lg\">\r\n                      <UserPlus className=\"h-6 w-6 text-white\" />\r\n                    </div>\r\n                    <div>\r\n                      <h1 className=\"text-xl font-bold text-gray-900\">Nuevo Paciente</h1>\r\n                      <p className=\"text-sm text-gray-600\">Complete la información básica del paciente</p>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <div className=\"flex items-center gap-3\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <div className=\"flex items-center gap-1\">\r\n                      <div className=\"h-2 w-2 rounded-full bg-blue-600\"></div>\r\n                      <span className=\"text-xs font-medium text-gray-700\">Paso 1</span>\r\n                    </div>\r\n                    <div className=\"h-px w-8 bg-gray-300\"></div>\r\n                    <div className=\"flex items-center gap-1\">\r\n                      <div className=\"h-2 w-2 rounded-full bg-gray-300\"></div>\r\n                      <span className=\"text-xs text-gray-400\">Paso 2</span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Content */}\r\n          <div className=\"w-full px-6 py-8\">\r\n            {error && (\r\n              <Alert variant=\"destructive\" className=\"mb-6 animate-in slide-in-from-top-2\">\r\n                <AlertCircle className=\"h-4 w-4\" />\r\n                <AlertDescription>{error}</AlertDescription>\r\n              </Alert>\r\n            )}\r\n\r\n            <div className=\"grid grid-cols-1 gap-6\">\r\n              {/* Main Form */}\r\n              <div>\r\n                <PatientPrimaryInfo\r\n                  formData={formData}\r\n                  setFormData={(data) => setFormData(data)}\r\n                  edad={edad}\r\n                  cedulaFound={cedulaFound}\r\n                  validatingCedula={validatingCedula}\r\n                  alergias={alergias}\r\n                  setAlergias={setAlergias}\r\n                  notasMedicas={notasMedicas}\r\n                  setNotasMedicas={setNotasMedicas}\r\n                  observaciones={observaciones}\r\n                  setObservaciones={setObservaciones}\r\n                  emailError={emailError}\r\n                  telefonoError={telefonoError}\r\n                  ageError={ageError}\r\n                  dateMin={new Date(new Date().setFullYear(new Date().getFullYear() - 150)).toISOString().split(\"T\")[0]}\r\n                  dateMax={new Date().toISOString().split(\"T\")[0]}\r\n                  enforcePhonePrefix={(v) => {\r\n                    const { formatted, error } = enforceVzlaPhone(v);\r\n                    setFormData({ ...formData, telefono: formatted });\r\n                    setTelefonoError(error);\r\n                  }}\r\n                />\r\n              </div>\r\n            </div>\r\n            {/* Actions (desktop estático, móvil/tables fijo) */}\r\n            <div className=\"fixed bottom-6 right-6 z-50 flex items-center gap-3 lg:static lg:mt-10 lg:w-full lg:justify-end\">\r\n              <Button\r\n                type=\"button\"\r\n                onClick={handleNextStep}\r\n                className=\"h-11 px-5 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white shadow-lg transition-colors\"\r\n                disabled={!formData.cedula || !formData.nombre_completo}\r\n                aria-label=\"Continuar al diagnóstico\"\r\n              >\r\n                Continuar al Diagnóstico\r\n              </Button>\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"outline\"\r\n                onClick={() => router.back()}\r\n                className=\"h-11 px-5 transition-colors\"\r\n                aria-label=\"Cancelar\"\r\n              >\r\n                Cancelar\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ) : null}\r\n    </VerificationGuard>\r\n  );\r\n}\r\n\r\nexport default function NuevoPacientePage() {\r\n  return (\r\n    <Suspense\r\n      fallback={\r\n        <div className=\"flex items-center justify-center min-h-screen\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\" />\r\n        </div>\r\n      }\r\n    >\r\n      <NuevoPacienteContent />\r\n    </Suspense>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\medico\\pacientes\\nuevo\\simple\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\medico\\pacientes\\offline\\[id]\\client.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardDescription' is defined but never used.","line":6,"column":52,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":67},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Separator' is defined but never used.","line":10,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Trash2' is defined but never used.","line":23,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckCircle' is defined but never used.","line":24,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":14},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadPatient'. Either include it or remove the dependency array.","line":60,"column":6,"nodeType":"ArrayExpression","endLine":60,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [loadPatient, params.id]","fix":{"range":[1854,1865],"text":"[loadPatient, params.id]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter, useParams } from \"next/navigation\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\r\nimport { Separator } from \"@/components/ui/separator\";\r\nimport {\r\n  ArrowLeft,\r\n  User,\r\n  Calendar,\r\n  Phone,\r\n  Mail,\r\n  MapPin,\r\n  Droplet,\r\n  AlertCircle,\r\n  Pill,\r\n  FileText,\r\n  Edit,\r\n  Trash2,\r\n  CheckCircle,\r\n} from \"lucide-react\";\r\nimport { format } from \"date-fns\";\r\nimport { es } from \"date-fns/locale\";\r\nimport { VerificationGuard } from \"@/components/dashboard/medico/features/verification-guard\";\r\nimport { ConsultationActionButton } from \"@/components/dashboard/medico/pacientes/consultation-action-button\";\r\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\r\n\r\ninterface OfflinePatient {\r\n  id: string;\r\n  cedula: string;\r\n  nombre_completo: string;\r\n  fecha_nacimiento: string | null;\r\n  genero: string | null;\r\n  telefono: string | null;\r\n  email: string | null;\r\n  direccion: string | null;\r\n  tipo_sangre: string | null;\r\n  alergias: string[] | null;\r\n  condiciones_cronicas: string[] | null;\r\n  medicamentos_actuales: string[] | null;\r\n  notas_medico: string | null;\r\n  status: string;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport default function OfflinePatientDetailPage() {\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const [loading, setLoading] = useState(true);\r\n  const [patient, setPatient] = useState<OfflinePatient | null>(null);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    loadPatient();\r\n  }, [params.id]);\r\n\r\n  const loadPatient = async () => {\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) {\r\n        router.push(\"/login/medico\");\r\n        return;\r\n      }\r\n\r\n      const { data, error } = await supabase\r\n        .from(\"offline_patients\")\r\n        .select(\"*\")\r\n        .eq(\"id\", params.id)\r\n        .eq(\"doctor_id\", user.id)\r\n        .single();\r\n\r\n      if (error) throw error;\r\n      setPatient(data);\r\n    } catch (err) {\r\n      console.error(\"Error loading patient:\", err);\r\n      setError(err instanceof Error ? err.message : \"Error desconocido\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const calculateAge = (birthDate: string | null) => {\r\n    if (!birthDate) return null;\r\n    const today = new Date();\r\n    const birth = new Date(birthDate);\r\n    let age = today.getFullYear() - birth.getFullYear();\r\n    const monthDiff = today.getMonth() - birth.getMonth();\r\n    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {\r\n      age--;\r\n    }\r\n    return age;\r\n  };\r\n\r\n  const getInitials = (name: string) => {\r\n    return name\r\n      .split(\" \")\r\n      .map((n) => n[0])\r\n      .join(\"\")\r\n      .toUpperCase()\r\n      .slice(0, 2);\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-screen\">\r\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error || !patient) {\r\n    return (\r\n      <div className=\"container mx-auto px-4 py-8\">\r\n        <Alert variant=\"destructive\">\r\n          <AlertCircle className=\"h-4 w-4\" />\r\n          <AlertDescription>\r\n            {error || \"No se pudo cargar la información del paciente\"}\r\n          </AlertDescription>\r\n        </Alert>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const age = calculateAge(patient.fecha_nacimiento);\r\n\r\n  return (\r\n    <VerificationGuard>\r\n      <div className=\"container mx-auto px-4 py-8 max-w-5xl space-y-6\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between\">\r\n          <Button variant=\"ghost\" size=\"sm\" onClick={() => router.back()}>\r\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\r\n            Volver\r\n          </Button>\r\n          <div className=\"flex gap-2\">\r\n            <Button variant=\"outline\" size=\"sm\">\r\n              <Edit className=\"h-4 w-4 mr-2\" />\r\n              Editar\r\n            </Button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Alert */}\r\n        <Alert>\r\n          <AlertCircle className=\"h-4 w-4\" />\r\n          <AlertDescription>\r\n            <strong>Paciente sin cuenta:</strong> Este paciente aún no se ha registrado en la plataforma.\r\n            Cuando se registre con la cédula <strong>{patient.cedula}</strong>, su historial se vinculará automáticamente.\r\n          </AlertDescription>\r\n        </Alert>\r\n\r\n        {/* Patient Header Card */}\r\n        <Card>\r\n          <CardContent className=\"p-6\">\r\n            <div className=\"flex items-start gap-6\">\r\n              <Avatar className=\"h-20 w-20\">\r\n                <AvatarFallback className=\"text-2xl\">\r\n                  {getInitials(patient.nombre_completo)}\r\n                </AvatarFallback>\r\n              </Avatar>\r\n              <div className=\"flex-1\">\r\n                <div className=\"flex items-start justify-between\">\r\n                  <div>\r\n                    <h1 className=\"text-2xl font-bold text-gray-900\">\r\n                      {patient.nombre_completo}\r\n                    </h1>\r\n                    <div className=\"flex items-center gap-3 mt-2\">\r\n                      <Badge variant=\"outline\">\r\n                        Cédula: {patient.cedula}\r\n                      </Badge>\r\n                      {patient.genero && (\r\n                        <Badge variant=\"outline\">\r\n                          {patient.genero === \"M\" ? \"Masculino\" : \"Femenino\"}\r\n                        </Badge>\r\n                      )}\r\n                      {age && (\r\n                        <Badge variant=\"outline\">\r\n                          {age} años\r\n                        </Badge>\r\n                      )}\r\n                      <Badge variant=\"secondary\">\r\n                        Sin cuenta\r\n                      </Badge>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Quick Actions */}\r\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n          <ConsultationActionButton\r\n            patientId={patient.id}\r\n            patientType=\"offline\"\r\n          />\r\n        </div>\r\n\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n          {/* Contact Information */}\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"flex items-center gap-2\">\r\n                <User className=\"h-5 w-5\" />\r\n                Información de Contacto\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-4\">\r\n              {patient.telefono && (\r\n                <div className=\"flex items-center gap-3\">\r\n                  <div className=\"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center\">\r\n                    <Phone className=\"h-5 w-5 text-blue-600\" />\r\n                  </div>\r\n                  <div>\r\n                    <p className=\"text-sm text-gray-600\">Teléfono</p>\r\n                    <p className=\"font-medium text-gray-900\">{patient.telefono}</p>\r\n                  </div>\r\n                </div>\r\n              )}\r\n              {patient.email && (\r\n                <div className=\"flex items-center gap-3\">\r\n                  <div className=\"h-10 w-10 rounded-full bg-purple-100 flex items-center justify-center\">\r\n                    <Mail className=\"h-5 w-5 text-purple-600\" />\r\n                  </div>\r\n                  <div>\r\n                    <p className=\"text-sm text-gray-600\">Email</p>\r\n                    <p className=\"font-medium text-gray-900\">{patient.email}</p>\r\n                  </div>\r\n                </div>\r\n              )}\r\n              {patient.direccion && (\r\n                <div className=\"flex items-center gap-3\">\r\n                  <div className=\"h-10 w-10 rounded-full bg-green-100 flex items-center justify-center\">\r\n                    <MapPin className=\"h-5 w-5 text-green-600\" />\r\n                  </div>\r\n                  <div>\r\n                    <p className=\"text-sm text-gray-600\">Dirección</p>\r\n                    <p className=\"font-medium text-gray-900\">{patient.direccion}</p>\r\n                  </div>\r\n                </div>\r\n              )}\r\n              {patient.fecha_nacimiento && (\r\n                <div className=\"flex items-center gap-3\">\r\n                  <div className=\"h-10 w-10 rounded-full bg-amber-100 flex items-center justify-center\">\r\n                    <Calendar className=\"h-5 w-5 text-amber-600\" />\r\n                  </div>\r\n                  <div>\r\n                    <p className=\"text-sm text-gray-600\">Fecha de Nacimiento</p>\r\n                    <p className=\"font-medium text-gray-900\">\r\n                      {format(new Date(patient.fecha_nacimiento), \"dd 'de' MMMM 'de' yyyy\", { locale: es })}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* Medical Information */}\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"flex items-center gap-2\">\r\n                <Droplet className=\"h-5 w-5\" />\r\n                Información Médica\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-4\">\r\n              {patient.tipo_sangre && (\r\n                <div>\r\n                  <p className=\"text-sm text-gray-600 mb-1\">Tipo de Sangre</p>\r\n                  <Badge variant=\"outline\" className=\"text-base\">\r\n                    {patient.tipo_sangre}\r\n                  </Badge>\r\n                </div>\r\n              )}\r\n              {patient.alergias && patient.alergias.length > 0 && (\r\n                <div>\r\n                  <p className=\"text-sm text-gray-600 mb-2\">Alergias</p>\r\n                  <div className=\"flex flex-wrap gap-2\">\r\n                    {patient.alergias.map((alergia, index) => (\r\n                      <Badge key={index} variant=\"destructive\">\r\n                        {alergia}\r\n                      </Badge>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n              {patient.condiciones_cronicas && patient.condiciones_cronicas.length > 0 && (\r\n                <div>\r\n                  <p className=\"text-sm text-gray-600 mb-2\">Condiciones Crónicas</p>\r\n                  <div className=\"flex flex-wrap gap-2\">\r\n                    {patient.condiciones_cronicas.map((condicion, index) => (\r\n                      <Badge key={index} variant=\"secondary\">\r\n                        {condicion}\r\n                      </Badge>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n              {patient.medicamentos_actuales && patient.medicamentos_actuales.length > 0 && (\r\n                <div>\r\n                  <p className=\"text-sm text-gray-600 mb-2\">Medicamentos Actuales</p>\r\n                  <div className=\"space-y-2\">\r\n                    {patient.medicamentos_actuales.map((medicamento, index) => (\r\n                      <div key={index} className=\"flex items-center gap-2\">\r\n                        <Pill className=\"h-4 w-4 text-blue-600\" />\r\n                        <span className=\"text-sm text-gray-900\">{medicamento}</span>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n\r\n        {/* Doctor Notes */}\r\n        {patient.notas_medico && (\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"flex items-center gap-2\">\r\n                <FileText className=\"h-5 w-5\" />\r\n                Notas del Médico\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <p className=\"text-gray-700 whitespace-pre-wrap\">{patient.notas_medico}</p>\r\n            </CardContent>\r\n          </Card>\r\n        )}\r\n\r\n        {/* Registration Info */}\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle>Información de Registro</CardTitle>\r\n          </CardHeader>\r\n          <CardContent className=\"space-y-2\">\r\n            <div className=\"flex justify-between text-sm\">\r\n              <span className=\"text-gray-600\">Registrado el:</span>\r\n              <span className=\"font-medium text-gray-900\">\r\n                {format(new Date(patient.created_at), \"dd/MM/yyyy 'a las' HH:mm\", { locale: es })}\r\n              </span>\r\n            </div>\r\n            <div className=\"flex justify-between text-sm\">\r\n              <span className=\"text-gray-600\">Última actualización:</span>\r\n              <span className=\"font-medium text-gray-900\">\r\n                {format(new Date(patient.updated_at), \"dd/MM/yyyy 'a las' HH:mm\", { locale: es })}\r\n              </span>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    </VerificationGuard>\r\n  );\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\medico\\pacientes\\offline\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'params' is defined but never used.","line":7,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import OfflinePatientDetailPage from \"./client\";\r\n\r\nexport async function generateStaticParams() {\r\n    return [{ id: \"1\" }];\r\n}\r\n\r\nexport default function Page({ params }: { params: Promise<{ id: string }> }) {\r\n    return <OfflinePatientDetailPage />;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\medico\\pacientes\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\medico\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\medico\\perfil\\setup\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\medico\\recetas\\nueva\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'selectedMethod' is assigned a value but never used.","line":33,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":26}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Label } from \"@red-salud/ui\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { Textarea } from \"@red-salud/ui\";\r\nimport { Pill, Save, ArrowLeft, Loader2, Plus, Trash2, FileText, Sparkles, Camera, Zap } from \"lucide-react\";\r\nimport { VerificationGuard } from \"@/components/dashboard/medico/features/verification-guard\";\r\nimport { PatientSelector } from \"@/components/citas/nueva/patient-selector\";\r\nimport { usePatientsList } from \"@/components/dashboard/medico/patients/hooks/usePatientsList\";\r\nimport { createPrescription } from \"@/lib/supabase/services/medications-service\";\r\nimport { toast } from \"sonner\";\r\n\r\ninterface MedicationItem {\r\n    medicamento: string;\r\n    dosis: string;\r\n    frecuencia: string;\r\n    duracion: string;\r\n    instrucciones: string;\r\n}\r\n\r\nexport default function NewPrescriptionPage() {\r\n    const router = useRouter();\r\n    const [userId, setUserId] = useState<string | null>(null);\r\n    const { state: patientsState } = usePatientsList(userId);\r\n\r\n    // Estado para el selector de métodos\r\n    const [showMethodSelector, setShowMethodSelector] = useState(true);\r\n    const [selectedMethod, setSelectedMethod] = useState<string | null>(null);\r\n\r\n    const [selectedPatientId, setSelectedPatientId] = useState<string>(\"\");\r\n    const [diagnosis, setDiagnosis] = useState(\"\");\r\n    const [notes, setNotes] = useState(\"\");\r\n    const [medications, setMedications] = useState<MedicationItem[]>([\r\n        { medicamento: \"\", dosis: \"\", frecuencia: \"\", duracion: \"\", instrucciones: \"\" }\r\n    ]);\r\n    const [submitting, setSubmitting] = useState(false);\r\n\r\n    useEffect(() => {\r\n        const init = async () => {\r\n            const { data: { user } } = await supabase.auth.getUser();\r\n            if (!user) {\r\n                router.push(\"/login/medico\");\r\n                return;\r\n            }\r\n            setUserId(user.id);\r\n        };\r\n        init();\r\n    }, [router]);\r\n\r\n    const handleSelectMethod = (method: string) => {\r\n        setSelectedMethod(method);\r\n        setShowMethodSelector(false);\r\n\r\n        // Manejar cada método\r\n        switch (method) {\r\n            case 'template':\r\n                // Navegar a selección de template\r\n                router.push('/dashboard/medico/recipes/nueva/template');\r\n                break;\r\n            case 'personalizada':\r\n                // Continuar con la recipe personalizada (quedarse en esta página)\r\n                break;\r\n            case 'escanear':\r\n                // Navegar a escaneo\r\n                router.push('/dashboard/medico/recipes/nueva/escanear');\r\n                break;\r\n            case 'rapida':\r\n                // Recipe rápida sin template\r\n                break;\r\n        }\r\n    };\r\n\r\n    const handleBackToSelector = () => {\r\n        setShowMethodSelector(true);\r\n        setSelectedMethod(null);\r\n    };\r\n\r\n    const handleAddMedication = () => {\r\n        setMedications([...medications, { medicamento: \"\", dosis: \"\", frecuencia: \"\", duracion: \"\", instrucciones: \"\" }]);\r\n    };\r\n\r\n    const handleRemoveMedication = (index: number) => {\r\n        setMedications(medications.filter((_, i) => i !== index));\r\n    };\r\n\r\n    const handleMedicationChange = (index: number, field: keyof MedicationItem, value: string) => {\r\n        const newMedications = [...medications];\r\n        newMedications[index][field] = value;\r\n        setMedications(newMedications);\r\n    };\r\n\r\n    const handleSubmit = async () => {\r\n        if (!userId || !selectedPatientId || !diagnosis || medications.some(m => !m.medicamento)) {\r\n            toast.error(\"Por favor complete los campos requeridos\");\r\n            return;\r\n        }\r\n\r\n        setSubmitting(true);\r\n        try {\r\n            const result = await createPrescription({\r\n                paciente_id: selectedPatientId,\r\n                medico_id: userId,\r\n                diagnostico: diagnosis,\r\n                notas: notes,\r\n                medications: medications.map(m => ({\r\n                    nombre_medicamento: m.medicamento,\r\n                    dosis: m.dosis,\r\n                    frecuencia: m.frecuencia,\r\n                    duracion_dias: m.duracion ? parseInt(m.duracion) || undefined : undefined,\r\n                    instrucciones_especiales: m.instrucciones || undefined,\r\n                }))\r\n            });\r\n\r\n            if (result.success) {\r\n                toast.success(\"Recipe creada exitosamente\");\r\n                router.push(\"/dashboard/medico/recipes\");\r\n            } else {\r\n                throw new Error((result.error as Error)?.message || \"Error al crear la receta\");\r\n            }\r\n        } catch (error: unknown) {\r\n            console.error(\"Error creating prescription:\", error);\r\n            const errorMessage = error instanceof Error ? error.message : \"Error al crear la recipe\";\r\n            toast.error(errorMessage);\r\n        } finally {\r\n            setSubmitting(false);\r\n        }\r\n    };\r\n\r\n    // Combine registered and offline patients for the selector\r\n    const allPatients = [\r\n        ...patientsState.patients.map(p => ({\r\n            id: p.patient_id,\r\n            nombre_completo: p.patient.nombre_completo,\r\n            email: p.patient.email,\r\n            type: 'registered'\r\n        })),\r\n        ...patientsState.offlinePatients.map(p => ({\r\n            id: p.id,\r\n            nombre_completo: p.nombre_completo,\r\n            cedula: p.cedula,\r\n            type: 'offline'\r\n        }))\r\n    ];\r\n\r\n    return (\r\n        <VerificationGuard>\r\n            <div className=\"container mx-auto px-4 py-8 space-y-6\">\r\n                <div className=\"flex items-center gap-4\">\r\n                    <Button variant=\"ghost\" onClick={showMethodSelector ? () => router.back() : handleBackToSelector}>\r\n                        <ArrowLeft className=\"h-4 w-4 mr-2\" />\r\n                        {showMethodSelector ? 'Volver' : 'Cambiar Método'}\r\n                    </Button>\r\n                    <div>\r\n                        <h1 className=\"text-3xl font-bold text-gray-900\">Nueva Recipe Médica</h1>\r\n                        <p className=\"text-gray-600 mt-1\">\r\n                            {showMethodSelector ? 'Selecciona el método para crear la recipe' : 'Emite una nueva recipe para tus pacientes'}\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Selector de Métodos */}\r\n                {showMethodSelector && (\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mt-8\">\r\n                        {/* Template del Sistema */}\r\n                        <Card\r\n                            className=\"cursor-pointer hover:shadow-lg transition-all border-2 hover:border-blue-500 group\"\r\n                            onClick={() => handleSelectMethod('template')}\r\n                        >\r\n                            <CardHeader className=\"text-center pb-4\">\r\n                                <div className=\"mx-auto w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center mb-4 group-hover:scale-110 transition-transform\">\r\n                                    <Sparkles className=\"h-8 w-8 text-white\" />\r\n                                </div>\r\n                                <CardTitle className=\"text-xl\">Template del Sistema</CardTitle>\r\n                            </CardHeader>\r\n                            <CardContent className=\"text-center\">\r\n                                <p className=\"text-sm text-gray-600 mb-4\">\r\n                                    Usa un formato predeterminado profesional con logo Esculapio\r\n                                </p>\r\n                                <div className=\"flex flex-wrap gap-1 justify-center\">\r\n                                    <span className=\"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded\">General</span>\r\n                                    <span className=\"text-xs bg-green-100 text-green-700 px-2 py-1 rounded\">Pediatria</span>\r\n                                    <span className=\"text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded\">Cardiología</span>\r\n                                </div>\r\n                            </CardContent>\r\n                        </Card>\r\n\r\n                        {/* Template Personalizado */}\r\n                        <Card\r\n                            className=\"cursor-pointer hover:shadow-lg transition-all border-2 hover:border-purple-500 group\"\r\n                            onClick={() => handleSelectMethod('personalizada')}\r\n                        >\r\n                            <CardHeader className=\"text-center pb-4\">\r\n                                <div className=\"mx-auto w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-600 rounded-full flex items-center justify-center mb-4 group-hover:scale-110 transition-transform\">\r\n                                    <FileText className=\"h-8 w-8 text-white\" />\r\n                                </div>\r\n                                <CardTitle className=\"text-xl\">Personalizada</CardTitle>\r\n                            </CardHeader>\r\n                            <CardContent className=\"text-center\">\r\n                                <p className=\"text-sm text-gray-600 mb-4\">\r\n                                    Crea tu propio formato o edita uno existente con el editor visual\r\n                                </p>\r\n                                <div className=\"flex flex-wrap gap-1 justify-center\">\r\n                                    <span className=\"text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded\">Editor WYSIWYG</span>\r\n                                    <span className=\"text-xs bg-pink-100 text-pink-700 px-2 py-1 rounded\">Drag & Drop</span>\r\n                                </div>\r\n                            </CardContent>\r\n                        </Card>\r\n\r\n                        {/* Escanear Recipe */}\r\n                        <Card\r\n                            className=\"cursor-pointer hover:shadow-lg transition-all border-2 hover:border-green-500 group\"\r\n                            onClick={() => handleSelectMethod('escanear')}\r\n                        >\r\n                            <CardHeader className=\"text-center pb-4\">\r\n                                <div className=\"mx-auto w-16 h-16 bg-gradient-to-br from-green-500 to-green-600 rounded-full flex items-center justify-center mb-4 group-hover:scale-110 transition-transform\">\r\n                                    <Camera className=\"h-8 w-8 text-white\" />\r\n                                </div>\r\n                                <CardTitle className=\"text-xl\">Escanear Recipe</CardTitle>\r\n                            </CardHeader>\r\n                            <CardContent className=\"text-center\">\r\n                                <p className=\"text-sm text-gray-600 mb-4\">\r\n                                    Escanea una recipe física y el sistema extraerá los datos con OCR\r\n                                </p>\r\n                                <div className=\"flex flex-wrap gap-1 justify-center\">\r\n                                    <span className=\"text-xs bg-green-100 text-green-700 px-2 py-1 rounded\">Cámara</span>\r\n                                    <span className=\"text-xs bg-teal-100 text-teal-700 px-2 py-1 rounded\">OCR</span>\r\n                                </div>\r\n                            </CardContent>\r\n                        </Card>\r\n\r\n                        {/* Recipe Rápida */}\r\n                        <Card\r\n                            className=\"cursor-pointer hover:shadow-lg transition-all border-2 hover:border-amber-500 group\"\r\n                            onClick={() => handleSelectMethod('rapida')}\r\n                        >\r\n                            <CardHeader className=\"text-center pb-4\">\r\n                                <div className=\"mx-auto w-16 h-16 bg-gradient-to-br from-amber-500 to-amber-600 rounded-full flex items-center justify-center mb-4 group-hover:scale-110 transition-transform\">\r\n                                    <Zap className=\"h-8 w-8 text-white\" />\r\n                                </div>\r\n                                <CardTitle className=\"text-xl\">Recipe Rápida</CardTitle>\r\n                            </CardHeader>\r\n                            <CardContent className=\"text-center\">\r\n                                <p className=\"text-sm text-gray-600 mb-4\">\r\n                                    Crea una recipe rápidamente sin template, solo lo esencial\r\n                                </p>\r\n                                <div className=\"flex flex-wrap gap-1 justify-center\">\r\n                                    <span className=\"text-xs bg-amber-100 text-amber-700 px-2 py-1 rounded\">Rápido</span>\r\n                                    <span className=\"text-xs bg-orange-100 text-orange-700 px-2 py-1 rounded\">Simple</span>\r\n                                </div>\r\n                            </CardContent>\r\n                        </Card>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Formulario de Receta (solo se muestra si NO está en el selector) */}\r\n                {!showMethodSelector && (\r\n\r\n                    <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n                        <div className=\"lg:col-span-2 space-y-6\">\r\n                            <PatientSelector\r\n                                patients={allPatients}\r\n                                loadingPatients={patientsState.loading}\r\n                                selectedPatientId={selectedPatientId}\r\n                                onPatientSelect={setSelectedPatientId}\r\n                            />\r\n\r\n                            <Card>\r\n                                <CardHeader className=\"flex flex-row items-center justify-between\">\r\n                                    <CardTitle className=\"flex items-center gap-2 text-lg\">\r\n                                        <Pill className=\"h-5 w-5\" />\r\n                                        Medicamentos\r\n                                    </CardTitle>\r\n                                    <Button variant=\"outline\" size=\"sm\" onClick={handleAddMedication}>\r\n                                        <Plus className=\"h-4 w-4 mr-2\" />\r\n                                        Agregar Medicamento\r\n                                    </Button>\r\n                                </CardHeader>\r\n                                <CardContent className=\"space-y-6\">\r\n                                    {medications.map((medication, index) => (\r\n                                        <div key={index} className=\"p-4 border rounded-lg bg-gray-50 relative\">\r\n                                            {medications.length > 1 && (\r\n                                                <Button\r\n                                                    variant=\"ghost\"\r\n                                                    size=\"icon\"\r\n                                                    className=\"absolute top-2 right-2 text-red-500 hover:text-red-700 hover:bg-red-50\"\r\n                                                    onClick={() => handleRemoveMedication(index)}\r\n                                                >\r\n                                                    <Trash2 className=\"h-4 w-4\" />\r\n                                                </Button>\r\n                                            )}\r\n                                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                                                <div className=\"space-y-2\">\r\n                                                    <Label>Medicamento <span className=\"text-red-500\">*</span></Label>\r\n                                                    <Input\r\n                                                        placeholder=\"Nombre del medicamento\"\r\n                                                        value={medication.medicamento}\r\n                                                        onChange={(e) => handleMedicationChange(index, \"medicamento\", e.target.value)}\r\n                                                    />\r\n                                                </div>\r\n                                                <div className=\"space-y-2\">\r\n                                                    <Label>Dosis</Label>\r\n                                                    <Input\r\n                                                        placeholder=\"Ej: 500mg\"\r\n                                                        value={medication.dosis}\r\n                                                        onChange={(e) => handleMedicationChange(index, \"dosis\", e.target.value)}\r\n                                                    />\r\n                                                </div>\r\n                                                <div className=\"space-y-2\">\r\n                                                    <Label>Frecuencia</Label>\r\n                                                    <Input\r\n                                                        placeholder=\"Ej: Cada 8 horas\"\r\n                                                        value={medication.frecuencia}\r\n                                                        onChange={(e) => handleMedicationChange(index, \"frecuencia\", e.target.value)}\r\n                                                    />\r\n                                                </div>\r\n                                                <div className=\"space-y-2\">\r\n                                                    <Label>Duración</Label>\r\n                                                    <Input\r\n                                                        placeholder=\"Ej: 7 días\"\r\n                                                        value={medication.duracion}\r\n                                                        onChange={(e) => handleMedicationChange(index, \"duracion\", e.target.value)}\r\n                                                    />\r\n                                                </div>\r\n                                                <div className=\"col-span-1 md:col-span-2 space-y-2\">\r\n                                                    <Label>Instrucciones Adicionales</Label>\r\n                                                    <Input\r\n                                                        placeholder=\"Ej: Tomar con alimentos\"\r\n                                                        value={medication.instrucciones}\r\n                                                        onChange={(e) => handleMedicationChange(index, \"instrucciones\", e.target.value)}\r\n                                                    />\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    ))}\r\n                                </CardContent>\r\n                            </Card>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-6\">\r\n                            <Card>\r\n                                <CardHeader>\r\n                                    <CardTitle className=\"text-lg\">Detalles de la Receta</CardTitle>\r\n                                </CardHeader>\r\n                                <CardContent className=\"space-y-4\">\r\n                                    <div className=\"space-y-2\">\r\n                                        <Label>Diagnóstico <span className=\"text-red-500\">*</span></Label>\r\n                                        <Input\r\n                                            placeholder=\"Diagnóstico principal\"\r\n                                            value={diagnosis}\r\n                                            onChange={(e) => setDiagnosis(e.target.value)}\r\n                                        />\r\n                                    </div>\r\n\r\n                                    <div className=\"space-y-2\">\r\n                                        <Label>Notas Adicionales</Label>\r\n                                        <Textarea\r\n                                            placeholder=\"Observaciones o recomendaciones...\"\r\n                                            value={notes}\r\n                                            onChange={(e) => setNotes(e.target.value)}\r\n                                            rows={4}\r\n                                        />\r\n                                    </div>\r\n\r\n                                    <Button\r\n                                        className=\"w-full\"\r\n                                        size=\"lg\"\r\n                                        onClick={handleSubmit}\r\n                                        disabled={submitting || !selectedPatientId || !diagnosis || medications.some(m => !m.medicamento)}\r\n                                    >\r\n                                        {submitting ? (\r\n                                            <>\r\n                                                <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\r\n                                                Creando Receta...\r\n                                            </>\r\n                                        ) : (\r\n                                            <>\r\n                                                <Save className=\"h-4 w-4 mr-2\" />\r\n                                                Emitir Receta\r\n                                            </>\r\n                                        )}\r\n                                    </Button>\r\n                                </CardContent>\r\n                            </Card>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </VerificationGuard>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\medico\\recetas\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\medico\\tareas\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'X' is defined but never used.","line":25,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":6},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Card' is defined but never used.","line":36,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardContent' is defined but never used.","line":36,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardHeader' is defined but never used.","line":36,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardTitle' is defined but never used.","line":36,"column":41,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":50},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TaskFilters' is defined but never used.","line":50,"column":56,"nodeType":null,"messageId":"unusedVar","endLine":50,"endColumn":67}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file page.tsx\r\n * @description Página completa de gestión de tareas del médico.\r\n * Permite crear, editar, filtrar y completar tareas con vista expandida.\r\n * \r\n * @module Dashboard/Tareas\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useState, useCallback, useEffect } from \"react\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport {\r\n    CheckSquare,\r\n    Plus,\r\n    Search,\r\n    Filter,\r\n    Check,\r\n    Trash2,\r\n    Calendar,\r\n    Clock,\r\n    AlertCircle,\r\n    AlertTriangle,\r\n    Loader2,\r\n    X,\r\n    ChevronDown,\r\n    MoreHorizontal,\r\n    Edit2,\r\n    ArrowLeft,\r\n} from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { Textarea } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogHeader,\r\n    DialogTitle,\r\n    DialogFooter,\r\n} from \"@red-salud/ui\";\r\nimport {\r\n    DropdownMenu,\r\n    DropdownMenuContent,\r\n    DropdownMenuItem,\r\n    DropdownMenuTrigger,\r\n} from \"@red-salud/ui\";\r\nimport { useTasks, isTaskOverdue, isTaskDueToday, type TaskFilters } from \"@/hooks/use-tasks\";\r\nimport type { DoctorTask, TaskPriority } from \"@/lib/types/dashboard-types\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport Link from \"next/link\";\r\n\r\n// ============================================================================\r\n// CONSTANTES\r\n// ============================================================================\r\n\r\n/** Configuración de prioridades */\r\nconst PRIORITY_CONFIG: Record<TaskPriority, {\r\n    label: string;\r\n    color: string;\r\n    bgColor: string;\r\n    borderColor: string;\r\n    icon: typeof Clock;\r\n}> = {\r\n    low: {\r\n        label: \"Baja\",\r\n        color: \"text-gray-500\",\r\n        bgColor: \"bg-gray-500/10\",\r\n        borderColor: \"border-gray-500/30\",\r\n        icon: Clock,\r\n    },\r\n    medium: {\r\n        label: \"Media\",\r\n        color: \"text-blue-500\",\r\n        bgColor: \"bg-blue-500/10\",\r\n        borderColor: \"border-blue-500/30\",\r\n        icon: Clock,\r\n    },\r\n    high: {\r\n        label: \"Alta\",\r\n        color: \"text-orange-500\",\r\n        bgColor: \"bg-orange-500/10\",\r\n        borderColor: \"border-orange-500/30\",\r\n        icon: AlertCircle,\r\n    },\r\n    urgent: {\r\n        label: \"Urgente\",\r\n        color: \"text-red-500\",\r\n        bgColor: \"bg-red-500/10\",\r\n        borderColor: \"border-red-500/30\",\r\n        icon: AlertTriangle,\r\n    },\r\n};\r\n\r\n// ============================================================================\r\n// COMPONENTES AUXILIARES\r\n// ============================================================================\r\n\r\n/**\r\n * Selector de prioridad\r\n */\r\nfunction PrioritySelector({\r\n    value,\r\n    onChange,\r\n}: {\r\n    value: TaskPriority;\r\n    onChange: (priority: TaskPriority) => void;\r\n}) {\r\n    const priorities: TaskPriority[] = ['low', 'medium', 'high', 'urgent'];\r\n\r\n    return (\r\n        <div className=\"flex gap-2\">\r\n            {priorities.map((p) => {\r\n                const config = PRIORITY_CONFIG[p];\r\n                return (\r\n                    <button\r\n                        key={p}\r\n                        type=\"button\"\r\n                        onClick={() => onChange(p)}\r\n                        className={cn(\r\n                            \"flex items-center gap-2 px-3 py-2 rounded-lg border-2 transition-all\",\r\n                            value === p\r\n                                ? `${config.bgColor} ${config.borderColor} ${config.color}`\r\n                                : \"border-muted bg-muted/30 text-muted-foreground hover:bg-muted\"\r\n                        )}\r\n                    >\r\n                        <config.icon className=\"h-4 w-4\" />\r\n                        <span className=\"text-sm font-medium\">{config.label}</span>\r\n                    </button>\r\n                );\r\n            })}\r\n        </div>\r\n    );\r\n}\r\n\r\n/**\r\n * Formatea fecha para mostrar\r\n */\r\nfunction formatDueDate(dueDate: string | null): string {\r\n    if (!dueDate) return \"\";\r\n    const date = new Date(dueDate);\r\n    const today = new Date();\r\n\r\n    if (date.toDateString() === today.toDateString()) {\r\n        return \"Hoy\";\r\n    }\r\n\r\n    const tomorrow = new Date(today);\r\n    tomorrow.setDate(today.getDate() + 1);\r\n    if (date.toDateString() === tomorrow.toDateString()) {\r\n        return \"Mañana\";\r\n    }\r\n\r\n    return date.toLocaleDateString(\"es\", { weekday: 'short', day: \"numeric\", month: \"short\" });\r\n}\r\n\r\n/**\r\n * Card de estadísticas\r\n */\r\nfunction StatCard({\r\n    label,\r\n    value,\r\n    icon: Icon,\r\n    color = \"text-primary\",\r\n}: {\r\n    label: string;\r\n    value: number;\r\n    icon: typeof CheckSquare;\r\n    color?: string;\r\n}) {\r\n    return (\r\n        <div className=\"flex items-center gap-3 p-4 rounded-xl bg-muted/30 border border-border/50\">\r\n            <div className={cn(\"p-2 rounded-lg\", color.replace('text-', 'bg-') + '/10')}>\r\n                <Icon className={cn(\"h-5 w-5\", color)} />\r\n            </div>\r\n            <div>\r\n                <p className=\"text-2xl font-bold\">{value}</p>\r\n                <p className=\"text-xs text-muted-foreground\">{label}</p>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n/**\r\n * Item de tarea\r\n */\r\nfunction TaskCard({\r\n    task,\r\n    onComplete,\r\n    onDelete,\r\n    onEdit,\r\n}: {\r\n    task: DoctorTask;\r\n    onComplete: (taskId: string, completed: boolean) => void;\r\n    onDelete: (taskId: string) => void;\r\n    onEdit: (task: DoctorTask) => void;\r\n}) {\r\n    const config = PRIORITY_CONFIG[task.priority];\r\n    const overdue = isTaskOverdue(task.due_date) && !task.is_completed;\r\n    const dueToday = isTaskDueToday(task.due_date);\r\n\r\n    return (\r\n        <motion.div\r\n            layout\r\n            initial={{ opacity: 0, y: 10 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            exit={{ opacity: 0, x: -20 }}\r\n            className={cn(\r\n                \"group flex items-start gap-4 p-4 rounded-xl border transition-all\",\r\n                \"hover:shadow-md hover:border-primary/30\",\r\n                task.is_completed\r\n                    ? \"bg-muted/20 border-muted\"\r\n                    : overdue\r\n                        ? \"bg-red-500/5 border-red-500/30\"\r\n                        : \"bg-card border-border\"\r\n            )}\r\n        >\r\n            {/* Checkbox */}\r\n            <button\r\n                onClick={() => onComplete(task.id, !task.is_completed)}\r\n                className={cn(\r\n                    \"flex items-center justify-center w-6 h-6 rounded-lg border-2 transition-all mt-0.5 flex-shrink-0\",\r\n                    task.is_completed\r\n                        ? \"bg-primary border-primary\"\r\n                        : \"border-muted-foreground/30 hover:border-primary hover:bg-primary/10\"\r\n                )}\r\n            >\r\n                {task.is_completed && (\r\n                    <Check className=\"h-4 w-4 text-primary-foreground\" />\r\n                )}\r\n            </button>\r\n\r\n            {/* Content */}\r\n            <div className=\"flex-1 min-w-0\">\r\n                <div className=\"flex items-start justify-between gap-2\">\r\n                    <div>\r\n                        <h3\r\n                            className={cn(\r\n                                \"font-medium\",\r\n                                task.is_completed && \"line-through text-muted-foreground\"\r\n                            )}\r\n                        >\r\n                            {task.title}\r\n                        </h3>\r\n                        {task.description && (\r\n                            <p className=\"text-sm text-muted-foreground mt-1 line-clamp-2\">\r\n                                {task.description}\r\n                            </p>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Actions dropdown */}\r\n                    <DropdownMenu>\r\n                        <DropdownMenuTrigger asChild>\r\n                            <Button\r\n                                variant=\"ghost\"\r\n                                size=\"icon\"\r\n                                className=\"h-8 w-8 opacity-0 group-hover:opacity-100 transition-opacity\"\r\n                            >\r\n                                <MoreHorizontal className=\"h-4 w-4\" />\r\n                            </Button>\r\n                        </DropdownMenuTrigger>\r\n                        <DropdownMenuContent align=\"end\">\r\n                            <DropdownMenuItem onClick={() => onEdit(task)}>\r\n                                <Edit2 className=\"h-4 w-4 mr-2\" />\r\n                                Editar\r\n                            </DropdownMenuItem>\r\n                            <DropdownMenuItem\r\n                                onClick={() => onDelete(task.id)}\r\n                                className=\"text-destructive focus:text-destructive\"\r\n                            >\r\n                                <Trash2 className=\"h-4 w-4 mr-2\" />\r\n                                Eliminar\r\n                            </DropdownMenuItem>\r\n                        </DropdownMenuContent>\r\n                    </DropdownMenu>\r\n                </div>\r\n\r\n                {/* Meta info */}\r\n                <div className=\"flex items-center gap-3 mt-3\">\r\n                    {/* Priority badge */}\r\n                    <Badge\r\n                        variant=\"secondary\"\r\n                        className={cn(\"text-xs\", config.bgColor, config.color)}\r\n                    >\r\n                        <config.icon className=\"h-3 w-3 mr-1\" />\r\n                        {config.label}\r\n                    </Badge>\r\n\r\n                    {/* Due date */}\r\n                    {task.due_date && (\r\n                        <div\r\n                            className={cn(\r\n                                \"flex items-center gap-1 text-xs\",\r\n                                overdue\r\n                                    ? \"text-red-500 font-medium\"\r\n                                    : dueToday\r\n                                        ? \"text-orange-500\"\r\n                                        : \"text-muted-foreground\"\r\n                            )}\r\n                        >\r\n                            <Calendar className=\"h-3 w-3\" />\r\n                            {overdue ? \"Vencida: \" : \"\"}\r\n                            {formatDueDate(task.due_date)}\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Completed date */}\r\n                    {task.is_completed && task.completed_at && (\r\n                        <div className=\"flex items-center gap-1 text-xs text-muted-foreground\">\r\n                            <Check className=\"h-3 w-3\" />\r\n                            Completada {formatDueDate(task.completed_at)}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </motion.div>\r\n    );\r\n}\r\n\r\n// ============================================================================\r\n// COMPONENTE PRINCIPAL\r\n// ============================================================================\r\n\r\nexport default function TareasPage() {\r\n    // Estado de autenticación\r\n    const [doctorId, setDoctorId] = useState<string | undefined>(undefined);\r\n    const [authLoading, setAuthLoading] = useState(true);\r\n\r\n    // Modal de tarea\r\n    const [isModalOpen, setIsModalOpen] = useState(false);\r\n    const [editingTask, setEditingTask] = useState<DoctorTask | null>(null);\r\n    const [taskTitle, setTaskTitle] = useState(\"\");\r\n    const [taskDescription, setTaskDescription] = useState(\"\");\r\n    const [taskPriority, setTaskPriority] = useState<TaskPriority>(\"medium\");\r\n    const [taskDueDate, setTaskDueDate] = useState(\"\");\r\n    const [isSubmitting, setIsSubmitting] = useState(false);\r\n\r\n    // Hook de tareas\r\n    const {\r\n        filteredTasks,\r\n        stats,\r\n        filters,\r\n        isLoading,\r\n        createTask,\r\n        updateTask,\r\n        completeTask,\r\n        deleteTask,\r\n        updateFilters,\r\n    } = useTasks(doctorId);\r\n\r\n    // Cargar usuario\r\n    useEffect(() => {\r\n        const loadUser = async () => {\r\n            const { data: { user } } = await supabase.auth.getUser();\r\n            setDoctorId(user?.id);\r\n            setAuthLoading(false);\r\n        };\r\n        loadUser();\r\n    }, []);\r\n\r\n    // Abrir modal para nueva tarea\r\n    const handleNewTask = useCallback(() => {\r\n        setEditingTask(null);\r\n        setTaskTitle(\"\");\r\n        setTaskDescription(\"\");\r\n        setTaskPriority(\"medium\");\r\n        setTaskDueDate(\"\");\r\n        setIsModalOpen(true);\r\n    }, []);\r\n\r\n    // Abrir modal para editar\r\n    const handleEditTask = useCallback((task: DoctorTask) => {\r\n        setEditingTask(task);\r\n        setTaskTitle(task.title);\r\n        setTaskDescription(task.description || \"\");\r\n        setTaskPriority(task.priority);\r\n        setTaskDueDate(task.due_date || \"\");\r\n        setIsModalOpen(true);\r\n    }, []);\r\n\r\n    // Guardar tarea (crear o editar)\r\n    const handleSaveTask = useCallback(async () => {\r\n        if (!taskTitle.trim()) return;\r\n\r\n        setIsSubmitting(true);\r\n        try {\r\n            let success = false;\r\n\r\n            if (editingTask) {\r\n                // Editar tarea existente\r\n                success = await updateTask(editingTask.id, {\r\n                    title: taskTitle.trim(),\r\n                    description: taskDescription.trim() || undefined,\r\n                    priority: taskPriority,\r\n                    due_date: taskDueDate || undefined,\r\n                });\r\n            } else {\r\n                // Crear nueva tarea\r\n                success = await createTask({\r\n                    title: taskTitle.trim(),\r\n                    description: taskDescription.trim() || undefined,\r\n                    priority: taskPriority,\r\n                    due_date: taskDueDate || undefined,\r\n                });\r\n            }\r\n\r\n            if (success) {\r\n                setIsModalOpen(false);\r\n                setEditingTask(null);\r\n            }\r\n        } finally {\r\n            setIsSubmitting(false);\r\n        }\r\n    }, [taskTitle, taskDescription, taskPriority, taskDueDate, createTask, updateTask, editingTask]);\r\n\r\n    // Tabs de estado\r\n    const statusTabs = [\r\n        { id: 'pending' as const, label: 'Pendientes', count: stats.pending },\r\n        { id: 'completed' as const, label: 'Completadas', count: stats.completed },\r\n        { id: 'all' as const, label: 'Todas', count: stats.total },\r\n    ];\r\n\r\n    if (authLoading) {\r\n        return (\r\n            <div className=\"flex items-center justify-center min-h-screen\">\r\n                <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-gradient-to-br from-background via-background to-muted/20\">\r\n            <div className=\"max-w-5xl mx-auto px-4 py-8\">\r\n                {/* Header */}\r\n                <div className=\"mb-8\">\r\n                    <div className=\"flex items-center gap-4 mb-4\">\r\n                        <Link href=\"/dashboard/medico\">\r\n                            <Button variant=\"ghost\" size=\"icon\" className=\"rounded-full\">\r\n                                <ArrowLeft className=\"h-5 w-5\" />\r\n                            </Button>\r\n                        </Link>\r\n                        <div>\r\n                            <h1 className=\"text-3xl font-bold flex items-center gap-3\">\r\n                                <CheckSquare className=\"h-8 w-8 text-primary\" />\r\n                                Mis Tareas\r\n                            </h1>\r\n                            <p className=\"text-muted-foreground mt-1\">\r\n                                Gestiona tus pendientes y mantén el control de tu día\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Stats */}\r\n                    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6\">\r\n                        <StatCard\r\n                            label=\"Pendientes\"\r\n                            value={stats.pending}\r\n                            icon={Clock}\r\n                            color=\"text-blue-500\"\r\n                        />\r\n                        <StatCard\r\n                            label=\"Para hoy\"\r\n                            value={stats.dueToday}\r\n                            icon={Calendar}\r\n                            color=\"text-orange-500\"\r\n                        />\r\n                        <StatCard\r\n                            label=\"Vencidas\"\r\n                            value={stats.overdue}\r\n                            icon={AlertTriangle}\r\n                            color=\"text-red-500\"\r\n                        />\r\n                        <StatCard\r\n                            label=\"Completadas hoy\"\r\n                            value={stats.completedToday}\r\n                            icon={Check}\r\n                            color=\"text-green-500\"\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Toolbar */}\r\n                <div className=\"flex flex-col sm:flex-row gap-4 mb-6\">\r\n                    {/* Search */}\r\n                    <div className=\"relative flex-1\">\r\n                        <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\r\n                        <Input\r\n                            placeholder=\"Buscar tareas...\"\r\n                            value={filters.search}\r\n                            onChange={(e) => updateFilters({ search: e.target.value })}\r\n                            className=\"pl-10\"\r\n                        />\r\n                    </div>\r\n\r\n                    {/* Priority filter */}\r\n                    <DropdownMenu>\r\n                        <DropdownMenuTrigger asChild>\r\n                            <Button variant=\"outline\" className=\"gap-2\">\r\n                                <Filter className=\"h-4 w-4\" />\r\n                                Prioridad\r\n                                <ChevronDown className=\"h-4 w-4\" />\r\n                            </Button>\r\n                        </DropdownMenuTrigger>\r\n                        <DropdownMenuContent>\r\n                            <DropdownMenuItem onClick={() => updateFilters({ priority: 'all' })}>\r\n                                Todas\r\n                            </DropdownMenuItem>\r\n                            {(['urgent', 'high', 'medium', 'low'] as TaskPriority[]).map((p) => (\r\n                                <DropdownMenuItem\r\n                                    key={p}\r\n                                    onClick={() => updateFilters({ priority: p })}\r\n                                >\r\n                                    {PRIORITY_CONFIG[p].label}\r\n                                </DropdownMenuItem>\r\n                            ))}\r\n                        </DropdownMenuContent>\r\n                    </DropdownMenu>\r\n\r\n                    {/* New task button */}\r\n                    <Button onClick={handleNewTask} className=\"gap-2\">\r\n                        <Plus className=\"h-4 w-4\" />\r\n                        Nueva Tarea\r\n                    </Button>\r\n                </div>\r\n\r\n                {/* Status tabs */}\r\n                <div className=\"flex gap-2 mb-6 border-b border-border pb-2\">\r\n                    {statusTabs.map((tab) => (\r\n                        <Button\r\n                            key={tab.id}\r\n                            variant={filters.status === tab.id ? \"default\" : \"ghost\"}\r\n                            size=\"sm\"\r\n                            onClick={() => updateFilters({ status: tab.id })}\r\n                            className=\"gap-2\"\r\n                        >\r\n                            {tab.label}\r\n                            <Badge\r\n                                variant={filters.status === tab.id ? \"secondary\" : \"outline\"}\r\n                                className=\"text-xs\"\r\n                            >\r\n                                {tab.count}\r\n                            </Badge>\r\n                        </Button>\r\n                    ))}\r\n                </div>\r\n\r\n                {/* Task list */}\r\n                <div className=\"space-y-3\">\r\n                    {isLoading ? (\r\n                        <div className=\"flex items-center justify-center py-16\">\r\n                            <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\r\n                        </div>\r\n                    ) : filteredTasks.length > 0 ? (\r\n                        <AnimatePresence mode=\"popLayout\">\r\n                            {filteredTasks.map((task) => (\r\n                                <TaskCard\r\n                                    key={task.id}\r\n                                    task={task}\r\n                                    onComplete={completeTask}\r\n                                    onDelete={deleteTask}\r\n                                    onEdit={handleEditTask}\r\n                                />\r\n                            ))}\r\n                        </AnimatePresence>\r\n                    ) : (\r\n                        <motion.div\r\n                            initial={{ opacity: 0 }}\r\n                            animate={{ opacity: 1 }}\r\n                            className=\"text-center py-16\"\r\n                        >\r\n                            <CheckSquare className=\"h-16 w-16 mx-auto mb-4 text-muted-foreground/30\" />\r\n                            <h3 className=\"text-lg font-medium text-muted-foreground mb-2\">\r\n                                {filters.status === 'completed'\r\n                                    ? \"Sin tareas completadas\"\r\n                                    : filters.search\r\n                                        ? \"Sin resultados\"\r\n                                        : \"¡Todo al día!\"}\r\n                            </h3>\r\n                            <p className=\"text-sm text-muted-foreground mb-4\">\r\n                                {filters.status === 'pending' && !filters.search\r\n                                    ? \"No tienes tareas pendientes. ¡Buen trabajo!\"\r\n                                    : \"Prueba con otros filtros o crea una nueva tarea\"}\r\n                            </p>\r\n                            {filters.status === 'pending' && !filters.search && (\r\n                                <Button onClick={handleNewTask} variant=\"outline\" className=\"gap-2\">\r\n                                    <Plus className=\"h-4 w-4\" />\r\n                                    Agregar tarea\r\n                                </Button>\r\n                            )}\r\n                        </motion.div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Task Modal */}\r\n                <Dialog open={isModalOpen} onOpenChange={setIsModalOpen}>\r\n                    <DialogContent className=\"sm:max-w-lg\">\r\n                        <DialogHeader>\r\n                            <DialogTitle>\r\n                                {editingTask ? \"Editar Tarea\" : \"Nueva Tarea\"}\r\n                            </DialogTitle>\r\n                        </DialogHeader>\r\n\r\n                        <div className=\"space-y-4 py-4\">\r\n                            {/* Title */}\r\n                            <div>\r\n                                <label className=\"text-sm font-medium mb-2 block\">\r\n                                    Título *\r\n                                </label>\r\n                                <Input\r\n                                    placeholder=\"¿Qué necesitas hacer?\"\r\n                                    value={taskTitle}\r\n                                    onChange={(e) => setTaskTitle(e.target.value)}\r\n                                    autoFocus\r\n                                />\r\n                            </div>\r\n\r\n                            {/* Description */}\r\n                            <div>\r\n                                <label className=\"text-sm font-medium mb-2 block\">\r\n                                    Descripción\r\n                                </label>\r\n                                <Textarea\r\n                                    placeholder=\"Añade más detalles...\"\r\n                                    value={taskDescription}\r\n                                    onChange={(e) => setTaskDescription(e.target.value)}\r\n                                    rows={3}\r\n                                />\r\n                            </div>\r\n\r\n                            {/* Priority */}\r\n                            <div>\r\n                                <label className=\"text-sm font-medium mb-2 block\">\r\n                                    Prioridad\r\n                                </label>\r\n                                <PrioritySelector\r\n                                    value={taskPriority}\r\n                                    onChange={setTaskPriority}\r\n                                />\r\n                            </div>\r\n\r\n                            {/* Due date */}\r\n                            <div>\r\n                                <label className=\"text-sm font-medium mb-2 block\">\r\n                                    Fecha límite\r\n                                </label>\r\n                                <Input\r\n                                    type=\"date\"\r\n                                    value={taskDueDate}\r\n                                    onChange={(e) => setTaskDueDate(e.target.value)}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <DialogFooter>\r\n                            <Button\r\n                                variant=\"outline\"\r\n                                onClick={() => setIsModalOpen(false)}\r\n                            >\r\n                                Cancelar\r\n                            </Button>\r\n                            <Button\r\n                                onClick={handleSaveTask}\r\n                                disabled={!taskTitle.trim() || isSubmitting}\r\n                            >\r\n                                {isSubmitting ? (\r\n                                    <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\r\n                                ) : null}\r\n                                {editingTask ? \"Guardar cambios\" : \"Crear tarea\"}\r\n                            </Button>\r\n                        </DialogFooter>\r\n                    </DialogContent>\r\n                </Dialog>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\medico\\telemedicina\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\paciente\\calificaciones\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\paciente\\citas\\nueva\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Input' is defined but never used.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Video' is defined but never used.","line":12,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MapPin' is defined but never used.","line":12,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":34},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Phone' is defined but never used.","line":12,"column":36,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":41},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'es' is defined but never used.","line":19,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'availableTimeSlots' is assigned a value but never used.","line":79,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":79,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":121,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4553,4556],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4553,4556],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":130,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4837,4840],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4837,4840],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":143,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":143,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5283,5286],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5283,5286],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport { Label } from \"@red-salud/ui\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { Textarea } from \"@red-salud/ui\";\r\nimport { useMedicalSpecialties, useAvailableDoctors, useAvailableTimeSlots, useCreateAppointment } from \"@/hooks/use-appointments\";\r\nimport { ArrowLeft, Video, MapPin, Phone, Check } from \"lucide-react\";\r\nimport { SpecialtyGrid } from \"@/components/dashboard/paciente/components/specialty-grid\";\r\nimport { DoctorSelector } from \"@/components/dashboard/paciente/components/doctor-selector\";\r\nimport { DateTimePicker } from \"@/components/dashboard/paciente/components/date-time-picker\";\r\nimport { ConsultationTypeSelector } from \"@/components/dashboard/paciente/components/consultation-type-selector\";\r\nimport { AppointmentSummary } from \"@/components/dashboard/paciente/components/appointment-summary\";\r\nimport Link from \"next/link\";\r\nimport { es } from \"date-fns/locale\";\r\n\r\nexport default function NuevaCitaPage() {\r\n  const [userId, setUserId] = useState<string | null>(null);\r\n  const [step, setStep] = useState(1);\r\n  const [selectedSpecialty, setSelectedSpecialty] = useState<string>(\"\");\r\n  const [selectedDoctor, setSelectedDoctor] = useState<string>(\"\");\r\n  const [selectedDate, setSelectedDate] = useState<Date>();\r\n  const [selectedTime, setSelectedTime] = useState<string>(\"\");\r\n  const [consultationType, setConsultationType] = useState<\"video\" | \"presencial\" | \"telefono\">(\r\n    \"video\"\r\n  );\r\n  const [reason, setReason] = useState(\"\");\r\n\r\n  const router = useRouter();\r\n  const { specialties } = useMedicalSpecialties(true); // Solo especialidades con médicos\r\n  const { doctors } = useAvailableDoctors(selectedSpecialty || undefined);\r\n  const { timeSlots, loading: timeSlotsLoading } = useAvailableTimeSlots(\r\n    selectedDoctor || undefined,\r\n    selectedDate?.toISOString().split(\"T\")[0]\r\n  );\r\n  const { create, loading: creating } = useCreateAppointment();\r\n  \r\n  // Estado para búsqueda de especialidades\r\n  useEffect(() => {\r\n    const checkUser = async () => {\r\n      const {\r\n        data: { user },\r\n      } = await supabase.auth.getUser();\r\n\r\n      if (!user) {\r\n        router.push(\"/login\");\r\n        return;\r\n      }\r\n\r\n      setUserId(user.id);\r\n    };\r\n\r\n    checkUser();\r\n  }, [router]);\r\n\r\n  \r\n\r\n  const handleSubmit = async () => {\r\n    if (!userId || !selectedDoctor || !selectedDate || !selectedTime) return;\r\n\r\n    const result = await create(userId, {\r\n      doctor_id: selectedDoctor,\r\n      appointment_date: selectedDate.toISOString().split(\"T\")[0],\r\n      appointment_time: selectedTime,\r\n      consultation_type: consultationType,\r\n      reason: reason || undefined,\r\n    });\r\n\r\n    if (result.success) {\r\n      router.push(\"/dashboard/paciente/citas\");\r\n    }\r\n  };\r\n\r\n  const selectedDoctorData = doctors.find((d) => d.id === selectedDoctor);\r\n  const availableTimeSlots = timeSlots.filter((slot) => slot.available);\r\n\r\n  return (\r\n    <div className=\"container mx-auto py-8 px-4 max-w-4xl\">\r\n      <div className=\"mb-6\">\r\n        <Link href=\"/dashboard/paciente/citas\">\r\n          <Button variant=\"ghost\" size=\"sm\">\r\n            <ArrowLeft className=\"mr-2 h-4 w-4\" />\r\n            Volver\r\n          </Button>\r\n        </Link>\r\n      </div>\r\n\r\n      <div className=\"mb-8\">\r\n        <h1 className=\"text-3xl font-bold\">Agendar Nueva Cita</h1>\r\n        <p className=\"text-muted-foreground mt-1\">\r\n          Sigue los pasos para agendar tu cita médica\r\n        </p>\r\n      </div>\r\n\r\n      {/* Progress Steps */}\r\n      <div className=\"flex items-center justify-between mb-8\">\r\n        {[1, 2, 3, 4].map((s) => (\r\n          <div key={s} className=\"flex items-center flex-1\">\r\n            <div\r\n              className={`flex items-center justify-center w-10 h-10 rounded-full ${\r\n                step >= s ? \"bg-primary text-primary-foreground\" : \"bg-muted text-muted-foreground\"\r\n              }`}\r\n            >\r\n              {step > s ? <Check className=\"h-5 w-5\" /> : s}\r\n            </div>\r\n            {s < 4 && (\r\n              <div\r\n                className={`flex-1 h-1 mx-2 ${step > s ? \"bg-primary\" : \"bg-muted\"}`}\r\n              />\r\n            )}\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      {step === 1 && (\r\n        <SpecialtyGrid\r\n          specialties={specialties as any}\r\n          selectedSpecialty={selectedSpecialty}\r\n          onSelected={(id) => { setSelectedSpecialty(id); setSelectedDoctor(\"\"); }}\r\n          onContinue={() => setStep(2)}\r\n        />\r\n      )}\r\n\r\n      {step === 2 && (\r\n        <DoctorSelector\r\n          doctors={doctors as any}\r\n          selectedDoctor={selectedDoctor}\r\n          selectedSpecialtyName={specialties.find(s => s.id === selectedSpecialty)?.name}\r\n          onSelect={setSelectedDoctor}\r\n          onBack={() => setStep(1)}\r\n          onContinue={() => setStep(3)}\r\n        />\r\n      )}\r\n\r\n      {step === 3 && (\r\n        <DateTimePicker\r\n          selectedDate={selectedDate}\r\n          onDateSelect={setSelectedDate}\r\n          timeSlots={timeSlots as any}\r\n          timeSlotsLoading={timeSlotsLoading}\r\n          selectedTime={selectedTime}\r\n          onTimeSelect={setSelectedTime}\r\n          onBack={() => setStep(2)}\r\n          onContinue={() => setStep(4)}\r\n        />\r\n      )}\r\n\r\n      {step === 4 && (\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle>Detalles de la Consulta</CardTitle>\r\n            <CardDescription>Completa la información de tu cita</CardDescription>\r\n          </CardHeader>\r\n          <CardContent className=\"space-y-6\">\r\n            <ConsultationTypeSelector consultationType={consultationType} onChange={setConsultationType} />\r\n            <div>\r\n              <Label htmlFor=\"reason\">Motivo de la Consulta (Opcional)</Label>\r\n              <Textarea id=\"reason\" placeholder=\"Describe brevemente el motivo de tu consulta...\" value={reason} onChange={(e) => setReason(e.target.value)} rows={4} className=\"mt-2\" />\r\n            </div>\r\n            <AppointmentSummary doctorName={selectedDoctorData?.profile?.nombre_completo} doctorFee={selectedDoctorData?.tarifa_consulta ?? null} date={selectedDate} time={selectedTime} type={consultationType} />\r\n            <div className=\"flex gap-2\">\r\n              <Button variant=\"outline\" onClick={() => setStep(3)} className=\"flex-1\">Atrás</Button>\r\n              <Button onClick={handleSubmit} disabled={creating} className=\"flex-1\">{creating ? \"Agendando...\" : \"Confirmar Cita\"}</Button>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\paciente\\citas\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardDescription' is defined but never used.","line":8,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardHeader' is defined but never used.","line":8,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":56},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardTitle' is defined but never used.","line":8,"column":58,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":67},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":83,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2566,2569],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2566,2569],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport Image from \"next/image\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@red-salud/ui\";\r\nimport { usePatientAppointments } from \"@/hooks/use-appointments\";\r\nimport { Calendar, Clock, Video, MapPin, Phone, Plus } from \"lucide-react\";\r\nimport Link from \"next/link\";\r\n\r\ninterface PatientAppointment {\r\n  id: string;\r\n  status: string;\r\n  appointment_date: string;\r\n  appointment_time: string;\r\n  consultation_type: string;\r\n  reason?: string;\r\n  doctor?: {\r\n    nombre_completo: string;\r\n    avatar_url: string | null;\r\n    specialty?: {\r\n      name: string;\r\n    };\r\n  };\r\n}\r\n\r\nexport default function CitasPage() {\r\n  const [userId, setUserId] = useState<string | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const router = useRouter();\r\n\r\n  useEffect(() => {\r\n    const checkUser = async () => {\r\n      const {\r\n        data: { user },\r\n      } = await supabase.auth.getUser();\r\n\r\n      if (!user) {\r\n        router.push(\"/login\");\r\n        return;\r\n      }\r\n\r\n      setUserId(user.id);\r\n      setLoading(false);\r\n    };\r\n\r\n    checkUser();\r\n  }, [router]);\r\n\r\n  const { appointments, loading: appointmentsLoading } = usePatientAppointments(userId || undefined);\r\n\r\n  if (loading || appointmentsLoading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-screen\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4\"></div>\r\n          <p className=\"text-muted-foreground\">Cargando citas...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const upcomingAppointments = appointments.filter(\r\n    (apt) =>\r\n      (apt.status === \"pending\" || apt.status === \"confirmed\") &&\r\n      new Date(`${apt.appointment_date}T${apt.appointment_time}`) > new Date()\r\n  );\r\n\r\n  const pastAppointments = appointments.filter(\r\n    (apt) =>\r\n      apt.status === \"completed\" ||\r\n      (apt.status !== \"cancelled\" &&\r\n        new Date(`${apt.appointment_date}T${apt.appointment_time}`) < new Date())\r\n  );\r\n\r\n  const cancelledAppointments = appointments.filter((apt) => apt.status === \"cancelled\");\r\n\r\n  const getStatusBadge = (status: string) => {\r\n    const variants: Record<string, { variant: any; label: string }> = {\r\n      pending: { variant: \"secondary\", label: \"Pendiente\" },\r\n      confirmed: { variant: \"default\", label: \"Confirmada\" },\r\n      cancelled: { variant: \"destructive\", label: \"Cancelada\" },\r\n      completed: { variant: \"outline\", label: \"Completada\" },\r\n      no_show: { variant: \"destructive\", label: \"No asistió\" },\r\n    };\r\n    const config = variants[status] || variants.pending;\r\n    return <Badge variant={config.variant}>{config.label}</Badge>;\r\n  };\r\n\r\n  const getConsultationIcon = (type: string) => {\r\n    switch (type) {\r\n      case \"video\":\r\n        return <Video className=\"h-4 w-4\" />;\r\n      case \"presencial\":\r\n        return <MapPin className=\"h-4 w-4\" />;\r\n      case \"telefono\":\r\n        return <Phone className=\"h-4 w-4\" />;\r\n      default:\r\n        return <Video className=\"h-4 w-4\" />;\r\n    }\r\n  };\r\n\r\n  const getConsultationLabel = (type: string) => {\r\n    switch (type) {\r\n      case \"video\":\r\n        return \"Videollamada\";\r\n      case \"presencial\":\r\n        return \"Presencial\";\r\n      case \"telefono\":\r\n        return \"Teléfono\";\r\n      default:\r\n        return type;\r\n    }\r\n  };\r\n\r\n  const AppointmentCard = ({ appointment }: { appointment: PatientAppointment }) => (\r\n    <Card>\r\n      <CardContent className=\"pt-6\">\r\n        <div className=\"flex items-start justify-between mb-4\">\r\n          <div className=\"flex items-center gap-3\">\r\n            <div className=\"h-12 w-12 rounded-full bg-primary/10 flex items-center justify-center\">\r\n              {appointment.doctor?.avatar_url ? (\r\n                <Image\r\n                  src={appointment.doctor.avatar_url}\r\n                  alt={appointment.doctor.nombre_completo}\r\n                  width={48}\r\n                  height={48}\r\n                  className=\"rounded-full object-cover\"\r\n                />\r\n              ) : (\r\n                <span className=\"text-lg font-semibold text-primary\">\r\n                  {appointment.doctor?.nombre_completo?.charAt(0) || \"D\"}\r\n                </span>\r\n              )}\r\n            </div>\r\n            <div>\r\n              <h3 className=\"font-semibold\">{appointment.doctor?.nombre_completo || \"Doctor\"}</h3>\r\n              <p className=\"text-sm text-muted-foreground\">\r\n                {appointment.doctor?.specialty?.name || \"Medicina General\"}\r\n              </p>\r\n            </div>\r\n          </div>\r\n          {getStatusBadge(appointment.status)}\r\n        </div>\r\n\r\n        <div className=\"space-y-2 text-sm\">\r\n          <div className=\"flex items-center gap-2 text-muted-foreground\">\r\n            <Calendar className=\"h-4 w-4\" />\r\n            <span>\r\n              {new Date(appointment.appointment_date).toLocaleDateString(\"es-ES\", {\r\n                weekday: \"long\",\r\n                year: \"numeric\",\r\n                month: \"long\",\r\n                day: \"numeric\",\r\n              })}\r\n            </span>\r\n          </div>\r\n          <div className=\"flex items-center gap-2 text-muted-foreground\">\r\n            <Clock className=\"h-4 w-4\" />\r\n            <span>{appointment.appointment_time.slice(0, 5)}</span>\r\n          </div>\r\n          <div className=\"flex items-center gap-2 text-muted-foreground\">\r\n            {getConsultationIcon(appointment.consultation_type)}\r\n            <span>{getConsultationLabel(appointment.consultation_type)}</span>\r\n          </div>\r\n        </div>\r\n\r\n        {appointment.reason && (\r\n          <div className=\"mt-4 p-3 bg-muted rounded-lg\">\r\n            <p className=\"text-sm\">\r\n              <span className=\"font-medium\">Motivo:</span> {appointment.reason}\r\n            </p>\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"mt-4 flex gap-2\">\r\n          <Button variant=\"outline\" size=\"sm\" className=\"flex-1\">\r\n            Ver Detalles\r\n          </Button>\r\n          {(appointment.status === \"pending\" || appointment.status === \"confirmed\") && (\r\n            <Button variant=\"destructive\" size=\"sm\">\r\n              Cancelar\r\n            </Button>\r\n          )}\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n\r\n  return (\r\n    <div className=\"container mx-auto py-8 px-4\">\r\n      <div className=\"flex items-center justify-between mb-6\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold\">Mis Citas</h1>\r\n          <p className=\"text-muted-foreground mt-1\">Gestiona tus citas médicas</p>\r\n        </div>\r\n        <Link href=\"/dashboard/paciente/citas/nueva\">\r\n          <Button>\r\n            <Plus className=\"mr-2 h-4 w-4\" />\r\n            Nueva Cita\r\n          </Button>\r\n        </Link>\r\n      </div>\r\n\r\n      <Tabs defaultValue=\"upcoming\" className=\"space-y-6\">\r\n        <TabsList>\r\n          <TabsTrigger value=\"upcoming\">\r\n            Próximas ({upcomingAppointments.length})\r\n          </TabsTrigger>\r\n          <TabsTrigger value=\"past\">Pasadas ({pastAppointments.length})</TabsTrigger>\r\n          <TabsTrigger value=\"cancelled\">\r\n            Canceladas ({cancelledAppointments.length})\r\n          </TabsTrigger>\r\n        </TabsList>\r\n\r\n        <TabsContent value=\"upcoming\" className=\"space-y-4\">\r\n          {upcomingAppointments.length > 0 ? (\r\n            upcomingAppointments.map((appointment) => (\r\n              <AppointmentCard key={appointment.id} appointment={appointment} />\r\n            ))\r\n          ) : (\r\n            <Card>\r\n              <CardContent className=\"pt-6 text-center py-12\">\r\n                <Calendar className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\r\n                <h3 className=\"font-semibold mb-2\">No tienes citas próximas</h3>\r\n                <p className=\"text-muted-foreground mb-4\">\r\n                  Agenda una cita con uno de nuestros especialistas\r\n                </p>\r\n                <Link href=\"/dashboard/paciente/citas/nueva\">\r\n                  <Button>Agendar Cita</Button>\r\n                </Link>\r\n              </CardContent>\r\n            </Card>\r\n          )}\r\n        </TabsContent>\r\n\r\n        <TabsContent value=\"past\" className=\"space-y-4\">\r\n          {pastAppointments.length > 0 ? (\r\n            pastAppointments.map((appointment) => (\r\n              <AppointmentCard key={appointment.id} appointment={appointment} />\r\n            ))\r\n          ) : (\r\n            <Card>\r\n              <CardContent className=\"pt-6 text-center py-12\">\r\n                <p className=\"text-muted-foreground\">No tienes citas pasadas</p>\r\n              </CardContent>\r\n            </Card>\r\n          )}\r\n        </TabsContent>\r\n\r\n        <TabsContent value=\"cancelled\" className=\"space-y-4\">\r\n          {cancelledAppointments.length > 0 ? (\r\n            cancelledAppointments.map((appointment) => (\r\n              <AppointmentCard key={appointment.id} appointment={appointment} />\r\n            ))\r\n          ) : (\r\n            <Card>\r\n              <CardContent className=\"pt-6 text-center py-12\">\r\n                <p className=\"text-muted-foreground\">No tienes citas canceladas</p>\r\n              </CardContent>\r\n            </Card>\r\n          )}\r\n        </TabsContent>\r\n      </Tabs>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\paciente\\components\\appointment-section.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[517,520],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[517,520],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { Card, CardContent } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Calendar, Clock, Video, Plus, ArrowRight } from \"lucide-react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { format } from \"date-fns\";\r\nimport { es } from \"date-fns/locale\";\r\nimport { useI18n } from \"@/lib/hooks/use-i18n\";\r\n\r\ninterface AppointmentAlertProps {\r\n  activeTelemed: number;\r\n}\r\n\r\ninterface UpcomingAppointmentsProps {\r\n  appointments: any[];\r\n  activeTelemed: number;\r\n}\r\n\r\nexport function AppointmentAlert({ activeTelemed }: AppointmentAlertProps) {\r\n  const router = useRouter();\r\n\r\n  if (activeTelemed <= 0) return null;\r\n\r\n  return (\r\n    <Card className=\"border-blue-500 bg-blue-50\">\r\n      <CardContent className=\"p-4\">\r\n        <div className=\"flex items-center gap-3\">\r\n          <Video className=\"h-5 w-5 text-blue-600\" />\r\n          <div className=\"flex-1\">\r\n            <p className=\"font-semibold text-blue-900\">\r\n              Tienes {activeTelemed} sesión(es) de telemedicina activa(s)\r\n            </p>\r\n            <p className=\"text-sm text-blue-700\">\r\n              Haz clic para unirte a la videoconsulta\r\n            </p>\r\n          </div>\r\n          <Button\r\n            onClick={() => router.push(\"/dashboard/paciente/telemedicina\")}\r\n            className=\"bg-blue-600 hover:bg-blue-700\"\r\n          >\r\n            Unirse Ahora\r\n          </Button>\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n}\r\n\r\nexport function UpcomingAppointmentsSection({\r\n  appointments,\r\n  activeTelemed,\r\n}: UpcomingAppointmentsProps) {\r\n  const router = useRouter();\r\n  const { t } = useI18n();\r\n\r\n  return (\r\n    <>\r\n      {/* Alert */}\r\n      <AppointmentAlert activeTelemed={activeTelemed} />\r\n\r\n      {/* Próximas Citas */}\r\n      <Card>\r\n        <CardContent className=\"p-6\">\r\n          <div className=\"flex items-center justify-between mb-4\">\r\n            <h2 className=\"text-lg font-semibold text-gray-900\">\r\n              {t(\"dashboard.upcomingAppointments\")}\r\n            </h2>\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"sm\"\r\n              onClick={() => router.push(\"/dashboard/paciente/citas\")}\r\n            >\r\n              {t(\"dashboard.viewAll\")}\r\n              <ArrowRight className=\"h-4 w-4 ml-2\" />\r\n            </Button>\r\n          </div>\r\n\r\n          {appointments.length > 0 ? (\r\n            <div className=\"space-y-4\">\r\n              {appointments.map((apt) => {\r\n                const fechaHora = new Date(apt.fecha_hora);\r\n                return (\r\n                  <div\r\n                    key={apt.id}\r\n                    className=\"flex items-start gap-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer\"\r\n                    onClick={() => router.push(`/dashboard/paciente/citas`)}\r\n                  >\r\n                    <div className=\"h-12 w-12 bg-blue-600 text-white rounded-lg flex items-center justify-center shrink-0\">\r\n                      <Calendar className=\"h-6 w-6\" />\r\n                    </div>\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <div className=\"flex items-center gap-2 mb-1\">\r\n                        <h3 className=\"font-semibold text-gray-900 truncate\">\r\n                          {apt.motivo || \"Consulta Médica\"}\r\n                        </h3>\r\n                        <Badge\r\n                          variant={\r\n                            apt.status === \"confirmada\" ? \"default\" : \"secondary\"\r\n                          }\r\n                        >\r\n                          {apt.status === \"confirmada\"\r\n                            ? \"Confirmada\"\r\n                            : \"Pendiente\"}\r\n                        </Badge>\r\n                      </div>\r\n                      <p className=\"text-sm text-gray-600\">\r\n                        Dr. {apt.doctor?.nombre_completo || \"Por asignar\"}\r\n                      </p>\r\n                      <div className=\"flex items-center gap-2 mt-2 text-sm text-gray-500\">\r\n                        <Clock className=\"h-4 w-4\" />\r\n                        <span>\r\n                          {format(fechaHora, \"EEEE, d 'de' MMMM 'a las' HH:mm\", {\r\n                            locale: es,\r\n                          })}\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n          ) : (\r\n            <div className=\"text-center py-12\">\r\n              <Calendar className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\r\n              <p className=\"text-gray-600 mb-4\">\r\n                {t(\"dashboard.noAppointments\")}\r\n              </p>\r\n              <Button\r\n                onClick={() =>\r\n                  router.push(\"/dashboard/paciente/citas/nueva\")\r\n                }\r\n              >\r\n                <Plus className=\"h-4 w-4 mr-2\" />\r\n                {t(\"dashboard.scheduleAppointment\")}\r\n              </Button>\r\n            </div>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n    </>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\paciente\\components\\health-metrics-section.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[414,417],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[414,417],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Activity, Plus } from \"lucide-react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { format } from \"date-fns\";\r\nimport { useI18n } from \"@/lib/hooks/use-i18n\";\r\n\r\ninterface HealthMetricsProps {\r\n  metrics: any[];\r\n}\r\n\r\nexport function HealthMetricsSection({ metrics }: HealthMetricsProps) {\r\n  const router = useRouter();\r\n  const { t } = useI18n();\r\n\r\n  return (\r\n    <Card>\r\n      <CardHeader>\r\n        <div className=\"flex items-center justify-between\">\r\n          <div>\r\n            <CardTitle>{t(\"dashboard.healthMetrics\")}</CardTitle>\r\n            <CardDescription>{t(\"dashboard.lastMeasurements\")}</CardDescription>\r\n          </div>\r\n          <Button\r\n            variant=\"ghost\"\r\n            size=\"sm\"\r\n            onClick={() => router.push(\"/dashboard/paciente/metricas\")}\r\n          >\r\n            {t(\"dashboard.viewAll\")}\r\n          </Button>\r\n        </div>\r\n      </CardHeader>\r\n      <CardContent>\r\n        {metrics.length > 0 ? (\r\n          <div className=\"space-y-4\">\r\n            {metrics.map((metric) => (\r\n              <div key={metric.id} className=\"space-y-2\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <span className=\"text-sm font-medium text-gray-700\">\r\n                    {metric.metric_type?.nombre}\r\n                  </span>\r\n                  <Badge variant=\"outline\">\r\n                    {format(new Date(metric.fecha_medicion), \"dd/MM\")}\r\n                  </Badge>\r\n                </div>\r\n                <div className=\"flex items-baseline gap-2\">\r\n                  <span className=\"text-2xl font-bold text-gray-900\">\r\n                    {metric.valor}\r\n                    {metric.valor_secundario && `/${metric.valor_secundario}`}\r\n                  </span>\r\n                  <span className=\"text-sm text-gray-500\">\r\n                    {metric.metric_type?.unidad_medida}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        ) : (\r\n          <div className=\"text-center py-8\">\r\n            <Activity className=\"h-10 w-10 text-gray-400 mx-auto mb-3\" />\r\n            <p className=\"text-sm text-gray-600 mb-3\">\r\n              {t(\"dashboard.noMetrics\")}\r\n            </p>\r\n            <Button\r\n              size=\"sm\"\r\n              variant=\"outline\"\r\n              onClick={() =>\r\n                router.push(\"/dashboard/paciente/metricas/registrar\")\r\n              }\r\n            >\r\n              <Plus className=\"h-4 w-4 mr-2\" />\r\n              {t(\"dashboard.registerMetric\")}\r\n            </Button>\r\n          </div>\r\n        )}\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\paciente\\components\\medications-section.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[376,379],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[376,379],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Pill, Plus } from \"lucide-react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { useI18n } from \"@/lib/hooks/use-i18n\";\r\n\r\ninterface MedicationsProps {\r\n  medications: any[];\r\n}\r\n\r\nexport function MedicationsSection({ medications }: MedicationsProps) {\r\n  const router = useRouter();\r\n  const { t } = useI18n();\r\n\r\n  return (\r\n    <Card>\r\n      <CardHeader>\r\n        <div className=\"flex items-center justify-between\">\r\n          <div>\r\n            <CardTitle>{t(\"dashboard.medications\")}</CardTitle>\r\n            <CardDescription>{t(\"dashboard.remindersConfigured\")}</CardDescription>\r\n          </div>\r\n          <Button\r\n            variant=\"ghost\"\r\n            size=\"sm\"\r\n            onClick={() => router.push(\"/dashboard/paciente/medicamentos\")}\r\n          >\r\n            {t(\"dashboard.viewAll\")}\r\n          </Button>\r\n        </div>\r\n      </CardHeader>\r\n      <CardContent>\r\n        {medications.length > 0 ? (\r\n          <div className=\"space-y-3\">\r\n            {medications.map((med) => (\r\n              <div\r\n                key={med.id}\r\n                className=\"flex items-start gap-3 p-3 bg-orange-50 rounded-lg\"\r\n              >\r\n                <div className=\"h-10 w-10 bg-orange-100 rounded-lg flex items-center justify-center shrink-0\">\r\n                  <Pill className=\"h-5 w-5 text-orange-600\" />\r\n                </div>\r\n                <div className=\"flex-1 min-w-0\">\r\n                  <p className=\"font-medium text-gray-900 text-sm truncate\">\r\n                    {med.nombre_medicamento}\r\n                  </p>\r\n                  <p className=\"text-xs text-gray-600\">{med.dosis}</p>\r\n                  <div className=\"flex items-center gap-1 mt-1\">\r\n                    {med.horarios?.slice(0, 3).map((hora: string, idx: number) => (\r\n                      <Badge key={idx} variant=\"outline\" className=\"text-xs\">\r\n                        {hora}\r\n                      </Badge>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        ) : (\r\n          <div className=\"text-center py-8\">\r\n            <Pill className=\"h-10 w-10 text-gray-400 mx-auto mb-3\" />\r\n            <p className=\"text-sm text-gray-600 mb-3\">\r\n              {t(\"dashboard.noMedications\")}\r\n            </p>\r\n            <Button\r\n              size=\"sm\"\r\n              variant=\"outline\"\r\n              onClick={() =>\r\n                router.push(\r\n                  \"/dashboard/paciente/medicamentos/recordatorios/nuevo\"\r\n                )\r\n              }\r\n            >\r\n              <Plus className=\"h-4 w-4 mr-2\" />\r\n              {t(\"dashboard.addReminder\")}\r\n            </Button>\r\n          </div>\r\n        )}\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\paciente\\components\\quick-access-section.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\paciente\\components\\recent-activity-section.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":18,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[655,658],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[655,658],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport { Activity, Calendar, Pill, Beaker, MessageSquare, Video, User } from \"lucide-react\";\r\nimport { format } from \"date-fns\";\r\nimport { es } from \"date-fns/locale\";\r\nimport { useI18n } from \"@/lib/hooks/use-i18n\";\r\nimport type { RecentActivity } from \"../hooks/use-dashboard-data\";\r\n\r\ninterface RecentActivityProps {\r\n  activities: RecentActivity[];\r\n}\r\n\r\nexport function RecentActivitySection({ activities }: RecentActivityProps) {\r\n  const { t } = useI18n();\r\n\r\n  const getActivityIcon = (type: string) => {\r\n    const icons: Record<string, any> = {\r\n      appointment_created: Calendar,\r\n      appointment_cancelled: Calendar,\r\n      prescription_created: Pill,\r\n      lab_order_created: Beaker,\r\n      message_sent: MessageSquare,\r\n      telemedicine_session_created: Video,\r\n      profile_updated: User,\r\n      metric_recorded: Activity,\r\n    };\r\n    return icons[type] || Activity;\r\n  };\r\n\r\n  const getActivityColor = (status: string) => {\r\n    const colors: Record<string, string> = {\r\n      success: \"text-green-600 bg-green-50\",\r\n      error: \"text-red-600 bg-red-50\",\r\n      warning: \"text-yellow-600 bg-yellow-50\",\r\n      info: \"text-blue-600 bg-blue-50\",\r\n    };\r\n    return colors[status] || colors.info;\r\n  };\r\n\r\n  return (\r\n    <Card>\r\n      <CardHeader>\r\n        <CardTitle>{t(\"dashboard.recentActivity\")}</CardTitle>\r\n        <CardDescription>\r\n          {t(\"dashboard.recentActivity\")}\r\n        </CardDescription>\r\n      </CardHeader>\r\n      <CardContent>\r\n        {activities.length > 0 ? (\r\n          <div className=\"space-y-3\">\r\n            {activities.map((activity) => {\r\n              const Icon = getActivityIcon(activity.activity_type);\r\n              return (\r\n                <div\r\n                  key={activity.id}\r\n                  className=\"flex items-start gap-3 p-3 rounded-lg hover:bg-gray-50\"\r\n                >\r\n                  <div\r\n                    className={`h-10 w-10 rounded-full flex items-center justify-center ${getActivityColor(\r\n                      activity.status\r\n                    )}`}\r\n                  >\r\n                    <Icon className=\"h-5 w-5\" />\r\n                  </div>\r\n                  <div className=\"flex-1 min-w-0\">\r\n                    <p className=\"text-sm font-medium text-gray-900\">\r\n                      {activity.description}\r\n                    </p>\r\n                    <p className=\"text-xs text-gray-500 mt-1\">\r\n                      {format(new Date(activity.created_at), \"PPp\", {\r\n                        locale: es,\r\n                      })}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              );\r\n            })}\r\n          </div>\r\n        ) : (\r\n          <p className=\"text-center text-gray-500 py-8\">\r\n            {t(\"dashboard.noActivity\")}\r\n          </p>\r\n        )}\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\paciente\\components\\stats-grid.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { Card, CardContent } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Calendar, Pill, Beaker, MessageSquare } from \"lucide-react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { useI18n } from \"@/lib/hooks/use-i18n\";\r\nimport type { DashboardStats } from \"../hooks/use-dashboard-stats\";\r\n\r\ninterface StatsGridProps {\r\n  stats: DashboardStats;\r\n}\r\n\r\nexport function StatsGrid({ stats }: StatsGridProps) {\r\n  const router = useRouter();\r\n  const { t } = useI18n();\r\n\r\n  return (\r\n    <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n      <Card\r\n        className=\"hover:shadow-lg transition-shadow cursor-pointer\"\r\n        onClick={() => router.push(\"/dashboard/paciente/citas\")}\r\n      >\r\n        <CardContent className=\"p-6\">\r\n          <div className=\"flex items-center justify-between mb-2\">\r\n            <div className=\"h-12 w-12 rounded-full bg-blue-100 flex items-center justify-center\">\r\n              <Calendar className=\"h-6 w-6 text-blue-600\" />\r\n            </div>\r\n            <span className=\"text-3xl font-bold text-gray-900\">\r\n              {stats.upcomingAppointments}\r\n            </span>\r\n          </div>\r\n          <h3 className=\"text-sm font-medium text-gray-600 dark:text-gray-400\">\r\n            {t(\"dashboard.upcomingAppointments\")}\r\n          </h3>\r\n          <p className=\"text-xs text-gray-500 dark:text-gray-500 mt-1\">\r\n            {stats.totalConsultations} {t(\"dashboard.totalAppointments\")}\r\n          </p>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      <Card\r\n        className=\"hover:shadow-lg transition-shadow cursor-pointer\"\r\n        onClick={() => router.push(\"/dashboard/paciente/medicamentos\")}\r\n      >\r\n        <CardContent className=\"p-6\">\r\n          <div className=\"flex items-center justify-between mb-2\">\r\n            <div className=\"h-12 w-12 rounded-full bg-orange-100 flex items-center justify-center\">\r\n              <Pill className=\"h-6 w-6 text-orange-600\" />\r\n            </div>\r\n            <span className=\"text-3xl font-bold text-gray-900\">\r\n              {stats.activeMedications}\r\n            </span>\r\n          </div>\r\n          <h3 className=\"text-sm font-medium text-gray-600 dark:text-gray-400\">\r\n            {t(\"dashboard.activeMedications\")}\r\n          </h3>\r\n          <p className=\"text-xs text-gray-500 dark:text-gray-500 mt-1\">\r\n            {t(\"dashboard.remindersConfigured\")}\r\n          </p>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      <Card\r\n        className=\"hover:shadow-lg transition-shadow cursor-pointer\"\r\n        onClick={() => router.push(\"/dashboard/paciente/laboratorio\")}\r\n      >\r\n        <CardContent className=\"p-6\">\r\n          <div className=\"flex items-center justify-between mb-2\">\r\n            <div className=\"h-12 w-12 rounded-full bg-purple-100 flex items-center justify-center\">\r\n              <Beaker className=\"h-6 w-6 text-purple-600\" />\r\n            </div>\r\n            <span className=\"text-3xl font-bold text-gray-900\">\r\n              {stats.pendingLabResults}\r\n            </span>\r\n          </div>\r\n          <h3 className=\"text-sm font-medium text-gray-600 dark:text-gray-400\">\r\n            {t(\"dashboard.pendingResults\")}\r\n          </h3>\r\n          <p className=\"text-xs text-gray-500 dark:text-gray-500 mt-1\">\r\n            {t(\"dashboard.documentsToUpload\")}\r\n          </p>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      <Card\r\n        className=\"hover:shadow-lg transition-shadow cursor-pointer\"\r\n        onClick={() => router.push(\"/dashboard/paciente/mensajeria\")}\r\n      >\r\n        <CardContent className=\"p-6\">\r\n          <div className=\"flex items-center justify-between mb-2\">\r\n            <div className=\"h-12 w-12 rounded-full bg-green-100 flex items-center justify-center\">\r\n              <MessageSquare className=\"h-6 w-6 text-green-600\" />\r\n            </div>\r\n            <span className=\"text-3xl font-bold text-gray-900\">\r\n              {stats.unreadMessages}\r\n            </span>\r\n          </div>\r\n          <h3 className=\"text-sm font-medium text-gray-600 dark:text-gray-400\">\r\n            {t(\"dashboard.unreadMessages\")}\r\n          </h3>\r\n          <p className=\"text-xs text-gray-500 dark:text-gray-500 mt-1\">\r\n            {t(\"dashboard.activeConversations\")}\r\n          </p>\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\paciente\\configuracion\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\paciente\\historial\\[id]\\client.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardDescription' is defined but never used.","line":6,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Badge' is defined but never used.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Separator' is defined but never used.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userId' is assigned a value but never used.","line":26,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter, useParams } from \"next/navigation\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Separator } from \"@red-salud/ui\";\r\nimport Image from \"next/image\";\r\nimport { useMedicalRecord } from \"@/hooks/use-medical-records\";\r\nimport {\r\n  ArrowLeft,\r\n  Calendar,\r\n  User,\r\n  FileText,\r\n  Pill,\r\n  Activity,\r\n  ClipboardList,\r\n  Download,\r\n  Share2,\r\n} from \"lucide-react\";\r\nimport Link from \"next/link\";\r\n\r\nexport default function DetalleRegistroMedicoPage() {\r\n  const [userId, setUserId] = useState<string | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const recordId = params.id as string;\r\n\r\n  const { record, loading: recordLoading } = useMedicalRecord(recordId);\r\n\r\n  useEffect(() => {\r\n    const checkUser = async () => {\r\n      const {\r\n        data: { user },\r\n      } = await supabase.auth.getUser();\r\n\r\n      if (!user) {\r\n        router.push(\"/login\");\r\n        return;\r\n      }\r\n\r\n      setUserId(user.id);\r\n      setLoading(false);\r\n    };\r\n\r\n    checkUser();\r\n  }, [router]);\r\n\r\n  if (loading || recordLoading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-screen\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4\"></div>\r\n          <p className=\"text-muted-foreground\">Cargando registro médico...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!record) {\r\n    return (\r\n      <div className=\"container mx-auto py-8 px-4\">\r\n        <Card>\r\n          <CardContent className=\"pt-6 text-center py-12\">\r\n            <FileText className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\r\n            <h3 className=\"font-semibold mb-2\">Registro no encontrado</h3>\r\n            <p className=\"text-muted-foreground mb-4\">\r\n              El registro médico que buscas no existe o no tienes acceso a él\r\n            </p>\r\n            <Link href=\"/dashboard/paciente/historial\">\r\n              <Button>Volver al Historial</Button>\r\n            </Link>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"container mx-auto py-8 px-4 max-w-4xl\">\r\n      {/* Header */}\r\n      <div className=\"mb-6\">\r\n        <Link href=\"/dashboard/paciente/historial\">\r\n          <Button variant=\"ghost\" size=\"sm\">\r\n            <ArrowLeft className=\"mr-2 h-4 w-4\" />\r\n            Volver al Historial\r\n          </Button>\r\n        </Link>\r\n      </div>\r\n\r\n      <div className=\"flex items-start justify-between mb-6\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold mb-2\">Registro Médico</h1>\r\n          <p className=\"text-muted-foreground\">\r\n            {new Date(record.created_at).toLocaleDateString(\"es-ES\", {\r\n              weekday: \"long\",\r\n              year: \"numeric\",\r\n              month: \"long\",\r\n              day: \"numeric\",\r\n            })}\r\n          </p>\r\n        </div>\r\n        <div className=\"flex gap-2\">\r\n          <Button variant=\"outline\" size=\"sm\">\r\n            <Download className=\"mr-2 h-4 w-4\" />\r\n            Descargar\r\n          </Button>\r\n          <Button variant=\"outline\" size=\"sm\">\r\n            <Share2 className=\"mr-2 h-4 w-4\" />\r\n            Compartir\r\n          </Button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Información del Doctor */}\r\n      <Card className=\"mb-6\">\r\n        <CardHeader>\r\n          <CardTitle className=\"flex items-center gap-2\">\r\n            <User className=\"h-5 w-5\" />\r\n            Información del Médico\r\n          </CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"flex items-center gap-4\">\r\n            <div className=\"h-16 w-16 rounded-full bg-primary/10 flex items-center justify-center\">\r\n              {record.medico?.avatar_url ? (\r\n                <Image\r\n                  src={record.medico.avatar_url}\r\n                  alt={record.medico.nombre_completo}\r\n                  width={64}\r\n                  height={64}\r\n                  className=\"rounded-full object-cover\"\r\n                />\r\n              ) : (\r\n                <span className=\"text-2xl font-semibold text-primary\">\r\n                  {record.medico?.nombre_completo?.charAt(0) || \"D\"}\r\n                </span>\r\n              )}\r\n            </div>\r\n            <div>\r\n              <h3 className=\"font-semibold text-lg\">\r\n                {record.medico?.nombre_completo || \"No especificado\"}\r\n              </h3>\r\n              <p className=\"text-sm text-muted-foreground\">\r\n                {record.medico?.especialidad || \"Medicina General\"}\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Diagnóstico Principal */}\r\n      <Card className=\"mb-6\">\r\n        <CardHeader>\r\n          <CardTitle className=\"flex items-center gap-2\">\r\n            <Activity className=\"h-5 w-5\" />\r\n            Diagnóstico\r\n          </CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"p-4 bg-primary/5 rounded-lg\">\r\n            <p className=\"text-lg font-medium\">{record.diagnostico}</p>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Síntomas */}\r\n      {record.sintomas && (\r\n        <Card className=\"mb-6\">\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <ClipboardList className=\"h-5 w-5\" />\r\n              Síntomas Reportados\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <p className=\"text-muted-foreground whitespace-pre-wrap\">{record.sintomas}</p>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Tratamiento */}\r\n      {record.tratamiento && (\r\n        <Card className=\"mb-6\">\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <FileText className=\"h-5 w-5\" />\r\n              Tratamiento Indicado\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <p className=\"text-muted-foreground whitespace-pre-wrap\">{record.tratamiento}</p>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Medicamentos */}\r\n      {record.medicamentos && (\r\n        <Card className=\"mb-6\">\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <Pill className=\"h-5 w-5\" />\r\n              Medicamentos Recetados\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"space-y-2\">\r\n              {record.medicamentos.split(\",\").map((med, index) => (\r\n                <div key={index} className=\"flex items-center gap-2 p-2 border rounded\">\r\n                  <Pill className=\"h-4 w-4 text-muted-foreground\" />\r\n                  <span>{med.trim()}</span>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Exámenes Solicitados */}\r\n      {record.examenes_solicitados && (\r\n        <Card className=\"mb-6\">\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <Activity className=\"h-5 w-5\" />\r\n              Exámenes Solicitados\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"space-y-2\">\r\n              {record.examenes_solicitados.split(\",\").map((exam, index) => (\r\n                <div key={index} className=\"flex items-center gap-2 p-2 border rounded\">\r\n                  <Activity className=\"h-4 w-4 text-muted-foreground\" />\r\n                  <span>{exam.trim()}</span>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Observaciones */}\r\n      {record.observaciones && (\r\n        <Card className=\"mb-6\">\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <FileText className=\"h-5 w-5\" />\r\n              Observaciones Adicionales\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <p className=\"text-muted-foreground whitespace-pre-wrap\">{record.observaciones}</p>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Información de la Cita */}\r\n      {record.appointment && (\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <Calendar className=\"h-5 w-5\" />\r\n              Información de la Consulta\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"space-y-2\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <span className=\"text-sm text-muted-foreground\">Fecha de Consulta:</span>\r\n                <span className=\"text-sm font-medium\">\r\n                  {new Date(record.appointment.fecha_hora).toLocaleDateString(\"es-ES\")}\r\n                </span>\r\n              </div>\r\n              <div className=\"flex items-center justify-between\">\r\n                <span className=\"text-sm text-muted-foreground\">Hora:</span>\r\n                <span className=\"text-sm font-medium\">\r\n                  {new Date(record.appointment.fecha_hora).toLocaleTimeString(\"es-ES\", {\r\n                    hour: \"2-digit\",\r\n                    minute: \"2-digit\",\r\n                  })}\r\n                </span>\r\n              </div>\r\n              {record.appointment.motivo && (\r\n                <div className=\"flex items-center justify-between\">\r\n                  <span className=\"text-sm text-muted-foreground\">Motivo:</span>\r\n                  <span className=\"text-sm font-medium\">{record.appointment.motivo}</span>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Metadata */}\r\n      <div className=\"mt-6 p-4 bg-muted rounded-lg\">\r\n        <div className=\"flex items-center justify-between text-sm text-muted-foreground\">\r\n          <span>Registro creado: {new Date(record.created_at).toLocaleString(\"es-ES\")}</span>\r\n          {record.updated_at !== record.created_at && (\r\n            <span>\r\n              Última actualización: {new Date(record.updated_at).toLocaleString(\"es-ES\")}\r\n            </span>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\paciente\\historial\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'params' is defined but never used.","line":7,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import DetalleRegistroMedicoPage from \"./client\";\r\n\r\nexport async function generateStaticParams() {\r\n    return [{ id: \"1\" }];\r\n}\r\n\r\nexport default function Page({ params }: { params: Promise<{ id: string }> }) {\r\n    return <DetalleRegistroMedicoPage />;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\paciente\\historial\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Filter' is defined but never used.","line":24,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":9}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@red-salud/ui\";\r\nimport {\r\n  usePatientMedicalRecords,\r\n  useMedicalHistorySummary,\r\n  useSearchMedicalRecords,\r\n} from \"@/hooks/use-medical-records\";\r\nimport {\r\n  FileText,\r\n  Search,\r\n  Calendar,\r\n  User,\r\n  Pill,\r\n  Activity,\r\n  Download,\r\n  Filter,\r\n  TrendingUp,\r\n} from \"lucide-react\";\r\nimport Link from \"next/link\";\r\n\r\nexport default function HistorialClinicoPage() {\r\n  const [userId, setUserId] = useState<string | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [searchTerm, setSearchTerm] = useState(\"\");\r\n  const router = useRouter();\r\n\r\n  useEffect(() => {\r\n    const checkUser = async () => {\r\n      const {\r\n        data: { user },\r\n      } = await supabase.auth.getUser();\r\n\r\n      if (!user) {\r\n        router.push(\"/login\");\r\n        return;\r\n      }\r\n\r\n      setUserId(user.id);\r\n      setLoading(false);\r\n    };\r\n\r\n    checkUser();\r\n  }, [router]);\r\n\r\n  const { records, loading: recordsLoading } = usePatientMedicalRecords(userId || undefined);\r\n  const { summary, loading: summaryLoading } = useMedicalHistorySummary(userId || undefined);\r\n  const { results: searchResults, search, clearSearch } = useSearchMedicalRecords(\r\n    userId || undefined\r\n  );\r\n\r\n  const handleSearch = (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (searchTerm.trim()) {\r\n      search(searchTerm);\r\n    } else {\r\n      clearSearch();\r\n    }\r\n  };\r\n\r\n  if (loading || recordsLoading || summaryLoading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-screen\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4\"></div>\r\n          <p className=\"text-muted-foreground\">Cargando historial clínico...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const displayRecords = searchTerm ? searchResults : records;\r\n\r\n  return (\r\n    <div className=\"container mx-auto py-8 px-4\">\r\n      {/* Header */}\r\n      <div className=\"flex items-start justify-between mb-6\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold\">Historial Clínico</h1>\r\n          <p className=\"text-muted-foreground mt-1\">\r\n            Tu historial médico completo y registros de consultas\r\n          </p>\r\n        </div>\r\n        <Button variant=\"outline\">\r\n          <Download className=\"mr-2 h-4 w-4\" />\r\n          Exportar PDF\r\n        </Button>\r\n      </div>\r\n\r\n      {/* Resumen */}\r\n      {summary && (\r\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6\">\r\n          <Card>\r\n            <CardContent className=\"pt-6\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                  <p className=\"text-sm text-muted-foreground\">Total Consultas</p>\r\n                  <p className=\"text-2xl font-bold\">{summary.total_consultas}</p>\r\n                </div>\r\n                <Activity className=\"h-8 w-8 text-primary\" />\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card>\r\n            <CardContent className=\"pt-6\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                  <p className=\"text-sm text-muted-foreground\">Doctores</p>\r\n                  <p className=\"text-2xl font-bold\">{summary.doctores_consultados.length}</p>\r\n                </div>\r\n                <User className=\"h-8 w-8 text-blue-500\" />\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card>\r\n            <CardContent className=\"pt-6\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                  <p className=\"text-sm text-muted-foreground\">Medicamentos</p>\r\n                  <p className=\"text-2xl font-bold\">{summary.medicamentos_actuales.length}</p>\r\n                </div>\r\n                <Pill className=\"h-8 w-8 text-green-500\" />\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card>\r\n            <CardContent className=\"pt-6\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                  <p className=\"text-sm text-muted-foreground\">Última Consulta</p>\r\n                  <p className=\"text-sm font-medium\">\r\n                    {summary.ultima_consulta\r\n                      ? new Date(summary.ultima_consulta).toLocaleDateString(\"es-ES\")\r\n                      : \"N/A\"}\r\n                  </p>\r\n                </div>\r\n                <Calendar className=\"h-8 w-8 text-orange-500\" />\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n      )}\r\n\r\n      {/* Búsqueda */}\r\n      <Card className=\"mb-6\">\r\n        <CardContent className=\"pt-6\">\r\n          <form onSubmit={handleSearch} className=\"flex gap-2\">\r\n            <div className=\"relative flex-1\">\r\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\r\n              <Input\r\n                placeholder=\"Buscar en tu historial médico...\"\r\n                value={searchTerm}\r\n                onChange={(e) => setSearchTerm(e.target.value)}\r\n                className=\"pl-10\"\r\n              />\r\n            </div>\r\n            <Button type=\"submit\">Buscar</Button>\r\n            {searchTerm && (\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"outline\"\r\n                onClick={() => {\r\n                  setSearchTerm(\"\");\r\n                  clearSearch();\r\n                }}\r\n              >\r\n                Limpiar\r\n              </Button>\r\n            )}\r\n          </form>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      <Tabs defaultValue=\"registros\" className=\"space-y-6\">\r\n        <TabsList>\r\n          <TabsTrigger value=\"registros\">\r\n            Registros Médicos ({displayRecords.length})\r\n          </TabsTrigger>\r\n          <TabsTrigger value=\"resumen\">Resumen</TabsTrigger>\r\n          <TabsTrigger value=\"estadisticas\">Estadísticas</TabsTrigger>\r\n        </TabsList>\r\n\r\n        {/* Registros Médicos */}\r\n        <TabsContent value=\"registros\" className=\"space-y-4\">\r\n          {displayRecords.length > 0 ? (\r\n            displayRecords.map((record) => (\r\n              <Card key={record.id} className=\"hover:shadow-md transition-shadow\">\r\n                <CardContent className=\"pt-6\">\r\n                  <div className=\"flex items-start justify-between mb-4\">\r\n                    <div className=\"flex items-start gap-4 flex-1\">\r\n                      <div className=\"h-12 w-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0\">\r\n                        <FileText className=\"h-6 w-6 text-primary\" />\r\n                      </div>\r\n                      <div className=\"flex-1\">\r\n                        <div className=\"flex items-center gap-2 mb-2\">\r\n                          <h3 className=\"font-semibold text-lg\">{record.diagnostico}</h3>\r\n                          <Badge variant=\"outline\">\r\n                            {new Date(record.created_at).toLocaleDateString(\"es-ES\")}\r\n                          </Badge>\r\n                        </div>\r\n                        <p className=\"text-sm text-muted-foreground mb-2\">\r\n                          Dr. {record.medico?.nombre_completo || \"No especificado\"} •{\" \"}\r\n                          {record.medico?.especialidad || \"Medicina General\"}\r\n                        </p>\r\n                        {record.sintomas && (\r\n                          <div className=\"mb-2\">\r\n                            <p className=\"text-sm font-medium\">Síntomas:</p>\r\n                            <p className=\"text-sm text-muted-foreground\">{record.sintomas}</p>\r\n                          </div>\r\n                        )}\r\n                        {record.tratamiento && (\r\n                          <div className=\"mb-2\">\r\n                            <p className=\"text-sm font-medium\">Tratamiento:</p>\r\n                            <p className=\"text-sm text-muted-foreground\">{record.tratamiento}</p>\r\n                          </div>\r\n                        )}\r\n                        {record.medicamentos && (\r\n                          <div className=\"mb-2\">\r\n                            <p className=\"text-sm font-medium\">Medicamentos:</p>\r\n                            <p className=\"text-sm text-muted-foreground\">{record.medicamentos}</p>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                    <Link href={`/dashboard/paciente/historial/${record.id}`}>\r\n                      <Button variant=\"outline\" size=\"sm\">\r\n                        Ver Detalles\r\n                      </Button>\r\n                    </Link>\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n            ))\r\n          ) : (\r\n            <Card>\r\n              <CardContent className=\"pt-6 text-center py-12\">\r\n                <FileText className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\r\n                <h3 className=\"font-semibold mb-2\">\r\n                  {searchTerm ? \"No se encontraron resultados\" : \"No tienes registros médicos\"}\r\n                </h3>\r\n                <p className=\"text-muted-foreground mb-4\">\r\n                  {searchTerm\r\n                    ? \"Intenta con otros términos de búsqueda\"\r\n                    : \"Tus registros médicos aparecerán aquí después de tus consultas\"}\r\n                </p>\r\n              </CardContent>\r\n            </Card>\r\n          )}\r\n        </TabsContent>\r\n\r\n        {/* Resumen */}\r\n        <TabsContent value=\"resumen\" className=\"space-y-6\">\r\n          {summary && (\r\n            <>\r\n              {/* Diagnósticos Frecuentes */}\r\n              <Card>\r\n                <CardHeader>\r\n                  <CardTitle className=\"flex items-center gap-2\">\r\n                    <TrendingUp className=\"h-5 w-5\" />\r\n                    Diagnósticos Frecuentes\r\n                  </CardTitle>\r\n                  <CardDescription>\r\n                    Los diagnósticos más comunes en tu historial\r\n                  </CardDescription>\r\n                </CardHeader>\r\n                <CardContent>\r\n                  {summary.diagnosticos_frecuentes.length > 0 ? (\r\n                    <div className=\"space-y-3\">\r\n                      {summary.diagnosticos_frecuentes.map((item, index) => (\r\n                        <div key={index} className=\"flex items-center justify-between\">\r\n                          <span className=\"text-sm\">{item.diagnostico}</span>\r\n                          <Badge variant=\"secondary\">{item.count} veces</Badge>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  ) : (\r\n                    <p className=\"text-sm text-muted-foreground\">\r\n                      No hay diagnósticos registrados\r\n                    </p>\r\n                  )}\r\n                </CardContent>\r\n              </Card>\r\n\r\n              {/* Medicamentos Actuales */}\r\n              <Card>\r\n                <CardHeader>\r\n                  <CardTitle className=\"flex items-center gap-2\">\r\n                    <Pill className=\"h-5 w-5\" />\r\n                    Medicamentos Actuales\r\n                  </CardTitle>\r\n                  <CardDescription>Medicamentos recetados en los últimos 3 meses</CardDescription>\r\n                </CardHeader>\r\n                <CardContent>\r\n                  {summary.medicamentos_actuales.length > 0 ? (\r\n                    <div className=\"flex flex-wrap gap-2\">\r\n                      {summary.medicamentos_actuales.map((med, index) => (\r\n                        <Badge key={index} variant=\"outline\">\r\n                          {med}\r\n                        </Badge>\r\n                      ))}\r\n                    </div>\r\n                  ) : (\r\n                    <p className=\"text-sm text-muted-foreground\">\r\n                      No hay medicamentos actuales registrados\r\n                    </p>\r\n                  )}\r\n                </CardContent>\r\n              </Card>\r\n\r\n              {/* Doctores Consultados */}\r\n              <Card>\r\n                <CardHeader>\r\n                  <CardTitle className=\"flex items-center gap-2\">\r\n                    <User className=\"h-5 w-5\" />\r\n                    Doctores Consultados\r\n                  </CardTitle>\r\n                  <CardDescription>Profesionales que te han atendido</CardDescription>\r\n                </CardHeader>\r\n                <CardContent>\r\n                  {summary.doctores_consultados.length > 0 ? (\r\n                    <div className=\"space-y-3\">\r\n                      {summary.doctores_consultados.map((doctor) => (\r\n                        <div\r\n                          key={doctor.id}\r\n                          className=\"flex items-center justify-between p-3 border rounded-lg\"\r\n                        >\r\n                          <div>\r\n                            <p className=\"font-medium\">{doctor.nombre}</p>\r\n                            <p className=\"text-sm text-muted-foreground\">{doctor.especialidad}</p>\r\n                          </div>\r\n                          <Badge>{doctor.consultas} consultas</Badge>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  ) : (\r\n                    <p className=\"text-sm text-muted-foreground\">\r\n                      No hay doctores registrados\r\n                    </p>\r\n                  )}\r\n                </CardContent>\r\n              </Card>\r\n            </>\r\n          )}\r\n        </TabsContent>\r\n\r\n        {/* Estadísticas */}\r\n        <TabsContent value=\"estadisticas\">\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle>Estadísticas de Salud</CardTitle>\r\n              <CardDescription>Análisis de tu historial médico</CardDescription>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <p className=\"text-sm text-muted-foreground text-center py-8\">\r\n                Próximamente: Gráficos y análisis detallados de tu historial médico\r\n              </p>\r\n            </CardContent>\r\n          </Card>\r\n        </TabsContent>\r\n      </Tabs>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\paciente\\hooks\\use-dashboard-data.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userId' is defined but never used.","line":17,"column":34,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":40},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":19,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[566,569],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[566,569],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[632,635],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[632,635],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[706,709],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[706,709],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useCallback } from \"react\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\n\r\nexport interface RecentActivity {\r\n  id: string;\r\n  type: string;\r\n  activity_type: string;\r\n  description: string;\r\n  date: string;\r\n  status: string;\r\n  created_at: string;\r\n}\r\n\r\n/**\r\n * Hook para cargar actividades recientes y citas próximas\r\n */\r\nexport function useDashboardData(userId: string | undefined) {\r\n  const [recentActivities, setRecentActivities] = useState<RecentActivity[]>([]);\r\n  const [upcomingAppointments, setUpcomingAppointments] = useState<any[]>([]);\r\n  const [latestMetrics, setLatestMetrics] = useState<any[]>([]);\r\n  const [activeMedications, setActiveMedications] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const loadRecentActivities = useCallback(async (uid: string) => {\r\n    const { data, error: err } = await supabase\r\n      .from(\"user_activity_log\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", uid)\r\n      .order(\"created_at\", { ascending: false })\r\n      .limit(5);\r\n\r\n    if (!err && data) {\r\n      setRecentActivities(data);\r\n    }\r\n  }, []);\r\n\r\n  const loadUpcomingAppointments = useCallback(async (uid: string) => {\r\n    const { data, error: err } = await supabase\r\n      .from(\"appointments\")\r\n      .select(`\r\n        *,\r\n        doctor:profiles!appointments_medico_id_fkey(\r\n          id,\r\n          nombre_completo,\r\n          avatar_url\r\n        )\r\n      `)\r\n      .eq(\"paciente_id\", uid)\r\n      .in(\"status\", [\"pendiente\", \"confirmada\"])\r\n      .order(\"fecha_hora\", { ascending: true })\r\n      .limit(3);\r\n\r\n    if (!err && data) {\r\n      setUpcomingAppointments(data);\r\n    }\r\n  }, []);\r\n\r\n  const loadLatestMetrics = useCallback(async (uid: string) => {\r\n    const { data, error: err } = await supabase\r\n      .from(\"health_metrics\")\r\n      .select(`\r\n        *,\r\n        metric_type:health_metric_types(nombre, unidad_medida, icono)\r\n      `)\r\n      .eq(\"paciente_id\", uid)\r\n      .order(\"fecha_medicion\", { ascending: false })\r\n      .limit(4);\r\n\r\n    if (!err && data) {\r\n      setLatestMetrics(data);\r\n    }\r\n  }, []);\r\n\r\n  const loadActiveMedications = useCallback(async (uid: string) => {\r\n    const { data, error: err } = await supabase\r\n      .from(\"medication_reminders\")\r\n      .select(\"*\")\r\n      .eq(\"paciente_id\", uid)\r\n      .eq(\"activo\", true)\r\n      .order(\"created_at\", { ascending: false })\r\n      .limit(3);\r\n\r\n    if (!err && data) {\r\n      setActiveMedications(data);\r\n    }\r\n  }, []);\r\n\r\n  const loadAllData = useCallback(\r\n    async (uid: string) => {\r\n      setLoading(true);\r\n      setError(null);\r\n      try {\r\n        await Promise.all([\r\n          loadRecentActivities(uid),\r\n          loadUpcomingAppointments(uid),\r\n          loadLatestMetrics(uid),\r\n          loadActiveMedications(uid),\r\n        ]);\r\n      } catch (err) {\r\n        const message = err instanceof Error ? err.message : \"Error loading data\";\r\n        setError(message);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    },\r\n    [\r\n      loadRecentActivities,\r\n      loadUpcomingAppointments,\r\n      loadLatestMetrics,\r\n      loadActiveMedications,\r\n    ]\r\n  );\r\n\r\n  return {\r\n    recentActivities,\r\n    upcomingAppointments,\r\n    latestMetrics,\r\n    activeMedications,\r\n    loading,\r\n    error,\r\n    loadAllData,\r\n  };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\paciente\\hooks\\use-dashboard-stats.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userId' is defined but never used.","line":25,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":41}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useCallback } from \"react\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\n\r\nexport interface DashboardStats {\r\n  upcomingAppointments: number;\r\n  totalConsultations: number;\r\n  activeMedications: number;\r\n  pendingLabResults: number;\r\n  unreadMessages: number;\r\n  activeTelemed: number;\r\n}\r\n\r\nconst INITIAL_STATS: DashboardStats = {\r\n  upcomingAppointments: 0,\r\n  totalConsultations: 0,\r\n  activeMedications: 0,\r\n  pendingLabResults: 0,\r\n  unreadMessages: 0,\r\n  activeTelemed: 0,\r\n};\r\n\r\n/**\r\n * Hook para cargar estadísticas del dashboard del paciente\r\n */\r\nexport function useDashboardStats(userId: string | undefined) {\r\n  const [stats, setStats] = useState<DashboardStats>(INITIAL_STATS);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const loadAppointmentsStats = useCallback(async (uid: string) => {\r\n    const { data, error: err } = await supabase\r\n      .from(\"appointments\")\r\n      .select(\"id, status\")\r\n      .eq(\"paciente_id\", uid);\r\n\r\n    if (!err && data) {\r\n      const upcoming = data.filter(\r\n        (apt) => apt.status === \"pendiente\" || apt.status === \"confirmada\"\r\n      ).length;\r\n      const total = data.length;\r\n\r\n      setStats((prev) => ({\r\n        ...prev,\r\n        upcomingAppointments: upcoming,\r\n        totalConsultations: total,\r\n      }));\r\n    }\r\n  }, []);\r\n\r\n  const loadMedicationsStats = useCallback(async (uid: string) => {\r\n    const { data, error: err } = await supabase\r\n      .from(\"medication_reminders\")\r\n      .select(\"id\")\r\n      .eq(\"paciente_id\", uid)\r\n      .eq(\"activo\", true);\r\n\r\n    if (!err && data) {\r\n      setStats((prev) => ({ ...prev, activeMedications: data.length }));\r\n    }\r\n  }, []);\r\n\r\n  const loadLabStats = useCallback(async (uid: string) => {\r\n    const { data, error: err } = await supabase\r\n      .from(\"lab_orders\")\r\n      .select(\"id\")\r\n      .eq(\"paciente_id\", uid)\r\n      .in(\"status\", [\"en_proceso\", \"muestra_tomada\"]);\r\n\r\n    if (!err && data) {\r\n      setStats((prev) => ({ ...prev, pendingLabResults: data.length }));\r\n    }\r\n  }, []);\r\n\r\n  const loadMessagesStats = useCallback(async (uid: string) => {\r\n    const { data, error: err } = await supabase\r\n      .from(\"messages_new\")\r\n      .select(\"id\")\r\n      .neq(\"sender_id\", uid)\r\n      .eq(\"is_read\", false);\r\n\r\n    if (!err && data) {\r\n      setStats((prev) => ({ ...prev, unreadMessages: data.length }));\r\n    }\r\n  }, []);\r\n\r\n  const loadTelemedicineStats = useCallback(async (uid: string) => {\r\n    const { data, error: err } = await supabase\r\n      .from(\"telemedicine_sessions\")\r\n      .select(\"id\")\r\n      .eq(\"patient_id\", uid)\r\n      .in(\"status\", [\"waiting\", \"active\"]);\r\n\r\n    if (!err && data) {\r\n      setStats((prev) => ({ ...prev, activeTelemed: data.length }));\r\n    }\r\n  }, []);\r\n\r\n  const loadAllStats = useCallback(\r\n    async (uid: string) => {\r\n      setLoading(true);\r\n      setError(null);\r\n      try {\r\n        await Promise.all([\r\n          loadAppointmentsStats(uid),\r\n          loadMedicationsStats(uid),\r\n          loadLabStats(uid),\r\n          loadMessagesStats(uid),\r\n          loadTelemedicineStats(uid),\r\n        ]);\r\n      } catch (err) {\r\n        const message = err instanceof Error ? err.message : \"Error loading stats\";\r\n        setError(message);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    },\r\n    [\r\n      loadAppointmentsStats,\r\n      loadMedicationsStats,\r\n      loadLabStats,\r\n      loadMessagesStats,\r\n      loadTelemedicineStats,\r\n    ]\r\n  );\r\n\r\n  return { stats, loading, error, loadAllStats };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\paciente\\laboratorio\\[id]\\client.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useState' is defined but never used.","line":3,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used.","line":3,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":34},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Separator' is defined but never used.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileText' is defined but never used.","line":13,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Building2' is defined but never used.","line":21,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'supabase' is defined but never used.","line":26,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { use, useState, useEffect } from \"react\";\r\nimport { useLabOrder } from \"@/hooks/use-laboratory\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\r\nimport { Separator } from \"@/components/ui/separator\";\r\nimport {\r\n  FlaskConical,\r\n  Calendar,\r\n  FileText,\r\n  Download,\r\n  AlertCircle,\r\n  CheckCircle2,\r\n  Clock,\r\n  TrendingUp,\r\n  ArrowLeft,\r\n  User,\r\n  Building2,\r\n  AlertTriangle,\r\n  Info,\r\n  Loader2,\r\n} from \"lucide-react\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { format } from \"date-fns\";\r\nimport { es } from \"date-fns/locale\";\r\nimport Link from \"next/link\";\r\nimport type { LabResultValue } from \"@/lib/supabase/types/laboratory\";\r\n\r\nconst statusConfig = {\r\n  pendiente: {\r\n    label: \"Pendiente\",\r\n    color: \"bg-yellow-100 text-yellow-800 border-yellow-200\",\r\n    icon: Clock,\r\n  },\r\n  muestra_tomada: {\r\n    label: \"Muestra Tomada\",\r\n    color: \"bg-blue-100 text-blue-800 border-blue-200\",\r\n    icon: FlaskConical,\r\n  },\r\n  en_proceso: {\r\n    label: \"En Proceso\",\r\n    color: \"bg-purple-100 text-purple-800 border-purple-200\",\r\n    icon: Loader2,\r\n  },\r\n  completada: {\r\n    label: \"Completada\",\r\n    color: \"bg-green-100 text-green-800 border-green-200\",\r\n    icon: CheckCircle2,\r\n  },\r\n  cancelada: {\r\n    label: \"Cancelada\",\r\n    color: \"bg-gray-100 text-gray-800 border-gray-200\",\r\n    icon: AlertCircle,\r\n  },\r\n  rechazada: {\r\n    label: \"Rechazada\",\r\n    color: \"bg-red-100 text-red-800 border-red-200\",\r\n    icon: AlertCircle,\r\n  },\r\n};\r\n\r\nconst alertLevelConfig = {\r\n  normal: { color: \"text-green-600\", icon: CheckCircle2, label: \"Normal\" },\r\n  bajo: { color: \"text-blue-600\", icon: TrendingUp, label: \"Bajo\" },\r\n  alto: { color: \"text-orange-600\", icon: AlertTriangle, label: \"Alto\" },\r\n  critico: { color: \"text-red-600\", icon: AlertCircle, label: \"Crítico\" },\r\n};\r\n\r\nexport default function LabOrderDetailPage({\r\n  params,\r\n}: {\r\n  params: Promise<{ id: string }>;\r\n}) {\r\n  const { id } = use(params);\r\n  const { order, results, statusHistory, loading, error } = useLabOrder(id);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-[600px]\">\r\n        <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error || !order) {\r\n    return (\r\n      <div className=\"text-center py-12\">\r\n        <AlertCircle className=\"h-12 w-12 text-destructive mx-auto mb-4\" />\r\n        <p className=\"text-destructive\">{error || \"Orden no encontrada\"}</p>\r\n        <Link href=\"/dashboard/paciente/laboratorio\">\r\n          <Button variant=\"outline\" className=\"mt-4\">\r\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\r\n            Volver a Laboratorio\r\n          </Button>\r\n        </Link>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const StatusIcon = statusConfig[order.status].icon;\r\n  const hasResults = results.length > 0;\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div className=\"flex items-center gap-4\">\r\n          <Link href=\"/dashboard/paciente/laboratorio\">\r\n            <Button variant=\"ghost\" size=\"icon\">\r\n              <ArrowLeft className=\"h-4 w-4\" />\r\n            </Button>\r\n          </Link>\r\n          <div>\r\n            <h1 className=\"text-3xl font-bold\">Orden de Laboratorio</h1>\r\n            <p className=\"text-muted-foreground font-mono\">{order.numero_orden}</p>\r\n          </div>\r\n        </div>\r\n        <Badge variant=\"outline\" className={statusConfig[order.status].color}>\r\n          <StatusIcon className=\"h-4 w-4 mr-2\" />\r\n          {statusConfig[order.status].label}\r\n        </Badge>\r\n      </div>\r\n\r\n      {/* Información General */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <Calendar className=\"h-5 w-5\" />\r\n              Información de la Orden\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent className=\"space-y-4\">\r\n            <div>\r\n              <p className=\"text-sm text-muted-foreground\">Fecha de Orden</p>\r\n              <p className=\"font-medium\">\r\n                {format(new Date(order.fecha_orden), \"dd 'de' MMMM, yyyy\", {\r\n                  locale: es,\r\n                })}\r\n              </p>\r\n            </div>\r\n            {order.fecha_muestra && (\r\n              <div>\r\n                <p className=\"text-sm text-muted-foreground\">Fecha de Muestra</p>\r\n                <p className=\"font-medium\">\r\n                  {format(new Date(order.fecha_muestra), \"dd 'de' MMMM, yyyy 'a las' HH:mm\", {\r\n                    locale: es,\r\n                  })}\r\n                </p>\r\n              </div>\r\n            )}\r\n            {order.fecha_entrega_estimada && (\r\n              <div>\r\n                <p className=\"text-sm text-muted-foreground\">Entrega Estimada</p>\r\n                <p className=\"font-medium\">\r\n                  {format(new Date(order.fecha_entrega_estimada), \"dd 'de' MMMM, yyyy\", {\r\n                    locale: es,\r\n                  })}\r\n                </p>\r\n              </div>\r\n            )}\r\n            <div>\r\n              <p className=\"text-sm text-muted-foreground\">Prioridad</p>\r\n              <Badge className=\"mt-1\">\r\n                {order.prioridad === \"normal\" && \"Normal\"}\r\n                {order.prioridad === \"urgente\" && \"Urgente\"}\r\n                {order.prioridad === \"stat\" && \"STAT (Inmediato)\"}\r\n              </Badge>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <User className=\"h-5 w-5\" />\r\n              Información Médica\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent className=\"space-y-4\">\r\n            {order.medico && (\r\n              <div>\r\n                <p className=\"text-sm text-muted-foreground\">Médico Solicitante</p>\r\n                <p className=\"font-medium\">{order.medico.nombre_completo}</p>\r\n                {order.medico.especialidad && (\r\n                  <p className=\"text-sm text-muted-foreground\">\r\n                    {order.medico.especialidad}\r\n                  </p>\r\n                )}\r\n              </div>\r\n            )}\r\n            {order.laboratorio && (\r\n              <div>\r\n                <p className=\"text-sm text-muted-foreground\">Laboratorio</p>\r\n                <p className=\"font-medium\">{order.laboratorio.nombre_completo}</p>\r\n              </div>\r\n            )}\r\n            {order.diagnostico_presuntivo && (\r\n              <div>\r\n                <p className=\"text-sm text-muted-foreground\">Diagnóstico Presuntivo</p>\r\n                <p className=\"font-medium\">{order.diagnostico_presuntivo}</p>\r\n              </div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Instrucciones */}\r\n      {order.instrucciones_paciente && (\r\n        <Card className=\"border-blue-200 bg-blue-50\">\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2 text-blue-900\">\r\n              <Info className=\"h-5 w-5\" />\r\n              Instrucciones para el Paciente\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <p className=\"text-blue-900\">{order.instrucciones_paciente}</p>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Tabs: Exámenes y Resultados */}\r\n      <Card>\r\n        <CardContent className=\"p-6\">\r\n          <Tabs defaultValue=\"examenes\">\r\n            <TabsList className=\"grid w-full grid-cols-3\">\r\n              <TabsTrigger value=\"examenes\">\r\n                Exámenes Solicitados\r\n                {order.tests && (\r\n                  <Badge variant=\"secondary\" className=\"ml-2\">\r\n                    {order.tests.length}\r\n                  </Badge>\r\n                )}\r\n              </TabsTrigger>\r\n              <TabsTrigger value=\"resultados\">\r\n                Resultados\r\n                {results.length > 0 && (\r\n                  <Badge variant=\"secondary\" className=\"ml-2\">\r\n                    {results.length}\r\n                  </Badge>\r\n                )}\r\n              </TabsTrigger>\r\n              <TabsTrigger value=\"historial\">Historial</TabsTrigger>\r\n            </TabsList>\r\n\r\n            <TabsContent value=\"examenes\" className=\"mt-6\">\r\n              {order.tests && order.tests.length > 0 ? (\r\n                <div className=\"space-y-3\">\r\n                  {order.tests.map((test) => (\r\n                    <div\r\n                      key={test.id}\r\n                      className=\"flex items-center justify-between p-4 border rounded-lg\"\r\n                    >\r\n                      <div className=\"flex-1\">\r\n                        <p className=\"font-medium\">{test.test_type?.nombre}</p>\r\n                        {test.test_type?.categoria && (\r\n                          <p className=\"text-sm text-muted-foreground\">\r\n                            {test.test_type.categoria}\r\n                          </p>\r\n                        )}\r\n                        {test.test_type?.preparacion_requerida && (\r\n                          <p className=\"text-sm text-blue-600 mt-1\">\r\n                            {test.test_type.preparacion_requerida}\r\n                          </p>\r\n                        )}\r\n                      </div>\r\n                      <Badge\r\n                        variant={test.resultado_disponible ? \"default\" : \"secondary\"}\r\n                      >\r\n                        {test.resultado_disponible ? \"Resultado Disponible\" : test.status}\r\n                      </Badge>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              ) : (\r\n                <p className=\"text-center text-muted-foreground py-8\">\r\n                  No hay exámenes registrados\r\n                </p>\r\n              )}\r\n            </TabsContent>\r\n\r\n            <TabsContent value=\"resultados\" className=\"mt-6\">\r\n              {hasResults ? (\r\n                <div className=\"space-y-6\">\r\n                  {results.map((result) => (\r\n                    <Card key={result.id}>\r\n                      <CardHeader>\r\n                        <div className=\"flex items-center justify-between\">\r\n                          <div>\r\n                            <CardTitle>{result.test_type?.nombre}</CardTitle>\r\n                            <CardDescription>\r\n                              {format(new Date(result.fecha_resultado), \"dd 'de' MMMM, yyyy 'a las' HH:mm\", {\r\n                                locale: es,\r\n                              })}\r\n                            </CardDescription>\r\n                          </div>\r\n                          {result.resultado_pdf_url && (\r\n                            <Button variant=\"outline\" size=\"sm\">\r\n                              <Download className=\"h-4 w-4 mr-2\" />\r\n                              Descargar PDF\r\n                            </Button>\r\n                          )}\r\n                        </div>\r\n                      </CardHeader>\r\n                      <CardContent>\r\n                        {result.values && result.values.length > 0 ? (\r\n                          <div className=\"space-y-2\">\r\n                            {result.values.map((value) => (\r\n                              <ResultValueRow key={value.id} value={value} />\r\n                            ))}\r\n                          </div>\r\n                        ) : (\r\n                          <p className=\"text-muted-foreground\">\r\n                            No hay valores individuales registrados\r\n                          </p>\r\n                        )}\r\n                        {result.observaciones_generales && (\r\n                          <div className=\"mt-4 p-4 bg-muted rounded-lg\">\r\n                            <p className=\"text-sm font-medium mb-1\">Observaciones:</p>\r\n                            <p className=\"text-sm\">{result.observaciones_generales}</p>\r\n                          </div>\r\n                        )}\r\n                      </CardContent>\r\n                    </Card>\r\n                  ))}\r\n                </div>\r\n              ) : (\r\n                <div className=\"text-center py-12\">\r\n                  <FlaskConical className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\r\n                  <p className=\"text-muted-foreground\">\r\n                    Los resultados aún no están disponibles\r\n                  </p>\r\n                  <p className=\"text-sm text-muted-foreground mt-2\">\r\n                    Te notificaremos cuando estén listos\r\n                  </p>\r\n                </div>\r\n              )}\r\n            </TabsContent>\r\n\r\n            <TabsContent value=\"historial\" className=\"mt-6\">\r\n              {statusHistory.length > 0 ? (\r\n                <div className=\"space-y-3\">\r\n                  {statusHistory.map((history) => (\r\n                    <div key={history.id} className=\"flex items-start gap-4 p-4 border rounded-lg\">\r\n                      <div className=\"flex-1\">\r\n                        <div className=\"flex items-center gap-2 mb-1\">\r\n                          <Badge variant=\"outline\">{history.status_nuevo}</Badge>\r\n                          {history.status_anterior && (\r\n                            <>\r\n                              <span className=\"text-muted-foreground\">←</span>\r\n                              <Badge variant=\"secondary\">{history.status_anterior}</Badge>\r\n                            </>\r\n                          )}\r\n                        </div>\r\n                        <p className=\"text-sm text-muted-foreground\">\r\n                          {format(new Date(history.created_at), \"dd 'de' MMMM, yyyy 'a las' HH:mm\", {\r\n                            locale: es,\r\n                          })}\r\n                        </p>\r\n                        {history.comentario && (\r\n                          <p className=\"text-sm mt-2\">{history.comentario}</p>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              ) : (\r\n                <p className=\"text-center text-muted-foreground py-8\">\r\n                  No hay historial de cambios\r\n                </p>\r\n              )}\r\n            </TabsContent>\r\n          </Tabs>\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction ResultValueRow({ value }: { value: LabResultValue }) {\r\n  const AlertIcon = value.nivel_alerta\r\n    ? alertLevelConfig[value.nivel_alerta].icon\r\n    : null;\r\n\r\n  return (\r\n    <div\r\n      className={`flex items-center justify-between p-3 rounded-lg border ${value.es_anormal ? \"bg-red-50 border-red-200\" : \"bg-white\"\r\n        }`}\r\n    >\r\n      <div className=\"flex-1\">\r\n        <div className=\"flex items-center gap-2\">\r\n          <p className=\"font-medium\">{value.parametro}</p>\r\n          {value.es_anormal && AlertIcon && (\r\n            <AlertIcon className={`h-4 w-4 ${alertLevelConfig[value.nivel_alerta!].color}`} />\r\n          )}\r\n        </div>\r\n        {value.rango_referencia && (\r\n          <p className=\"text-sm text-muted-foreground\">\r\n            Rango: {value.rango_referencia}\r\n          </p>\r\n        )}\r\n      </div>\r\n      <div className=\"text-right\">\r\n        <p className={`font-bold ${value.es_anormal ? \"text-red-600\" : \"\"}`}>\r\n          {value.valor} {value.unidad}\r\n        </p>\r\n        {value.nivel_alerta && value.nivel_alerta !== \"normal\" && (\r\n          <Badge variant=\"outline\" className=\"mt-1\">\r\n            {alertLevelConfig[value.nivel_alerta].label}\r\n          </Badge>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\paciente\\laboratorio\\[id]\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\paciente\\laboratorio\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used.","line":18,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingUp' is defined but never used.","line":24,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":13},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":178,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":178,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5860,5863],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5860,5863],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":196,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":196,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6739,6742],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6739,6742],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { useLaboratory } from \"@/hooks/use-laboratory\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@red-salud/ui\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@red-salud/ui\";\r\nimport {\r\n  FlaskConical,\r\n  Calendar,\r\n  FileText,\r\n  Download,\r\n  AlertCircle,\r\n  CheckCircle2,\r\n  Clock,\r\n  TrendingUp,\r\n  Filter,\r\n  Loader2,\r\n} from \"lucide-react\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport type { LabOrder, LabOrderStatus } from \"@/lib/supabase/types/laboratory\";\r\nimport { format } from \"date-fns\";\r\nimport { es } from \"date-fns/locale\";\r\nimport Link from \"next/link\";\r\n\r\nconst statusConfig = {\r\n  pendiente: {\r\n    label: \"Pendiente\",\r\n    color: \"bg-yellow-100 text-yellow-800 border-yellow-200\",\r\n    icon: Clock,\r\n  },\r\n  muestra_tomada: {\r\n    label: \"Muestra Tomada\",\r\n    color: \"bg-blue-100 text-blue-800 border-blue-200\",\r\n    icon: FlaskConical,\r\n  },\r\n  en_proceso: {\r\n    label: \"En Proceso\",\r\n    color: \"bg-purple-100 text-purple-800 border-purple-200\",\r\n    icon: Loader2,\r\n  },\r\n  completada: {\r\n    label: \"Completada\",\r\n    color: \"bg-green-100 text-green-800 border-green-200\",\r\n    icon: CheckCircle2,\r\n  },\r\n  cancelada: {\r\n    label: \"Cancelada\",\r\n    color: \"bg-gray-100 text-gray-800 border-gray-200\",\r\n    icon: AlertCircle,\r\n  },\r\n  rechazada: {\r\n    label: \"Rechazada\",\r\n    color: \"bg-red-100 text-red-800 border-red-200\",\r\n    icon: AlertCircle,\r\n  },\r\n};\r\n\r\nconst prioridadConfig = {\r\n  normal: { label: \"Normal\", color: \"bg-gray-100 text-gray-800\" },\r\n  urgente: { label: \"Urgente\", color: \"bg-orange-100 text-orange-800\" },\r\n  stat: { label: \"STAT\", color: \"bg-red-100 text-red-800\" },\r\n};\r\n\r\nexport default function LaboratorioPage() {\r\n  const [userId, setUserId] = useState<string>(\"\");\r\n  const [statusFilter, setStatusFilter] = useState<LabOrderStatus | \"all\">(\"all\");\r\n  const [activeTab, setActiveTab] = useState<\"todas\" | \"pendientes\" | \"completadas\">(\"todas\");\r\n\r\n  useEffect(() => {\r\n    const getUser = async () => {\r\n      const {\r\n        data: { user },\r\n      } = await supabase.auth.getUser();\r\n      if (user) {\r\n        setUserId(user.id);\r\n      }\r\n    };\r\n    getUser();\r\n  }, []);\r\n\r\n  const filters = statusFilter !== \"all\" ? { status: statusFilter } : undefined;\r\n  const { orders, stats, loading, error } = useLaboratory(userId, filters);\r\n\r\n  const filteredOrders = orders.filter((order) => {\r\n    if (activeTab === \"pendientes\") {\r\n      return [\"pendiente\", \"muestra_tomada\", \"en_proceso\"].includes(order.status);\r\n    }\r\n    if (activeTab === \"completadas\") {\r\n      return order.status === \"completada\";\r\n    }\r\n    return true;\r\n  });\r\n\r\n  if (!userId) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-[600px]\">\r\n        <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div>\r\n        <h1 className=\"text-3xl font-bold\">Resultados de Laboratorio</h1>\r\n        <p className=\"text-muted-foreground\">\r\n          Visualiza y gestiona tus exámenes y resultados de laboratorio\r\n        </p>\r\n      </div>\r\n\r\n      {/* Estadísticas */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">Total Órdenes</CardTitle>\r\n            <FileText className=\"h-4 w-4 text-muted-foreground\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold\">{stats.total_ordenes}</div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">Pendientes</CardTitle>\r\n            <Clock className=\"h-4 w-4 text-yellow-600\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold\">{stats.pendientes}</div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">Completadas</CardTitle>\r\n            <CheckCircle2 className=\"h-4 w-4 text-green-600\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold\">{stats.completadas}</div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">Valores Anormales</CardTitle>\r\n            <AlertCircle className=\"h-4 w-4 text-red-600\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold\">{stats.con_valores_anormales}</div>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Filtros y Tabs */}\r\n      <Card>\r\n        <CardHeader>\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <CardTitle>Mis Órdenes de Laboratorio</CardTitle>\r\n              <CardDescription>\r\n                Historial completo de exámenes y resultados\r\n              </CardDescription>\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <Filter className=\"h-4 w-4 text-muted-foreground\" />\r\n              <Select\r\n                value={statusFilter}\r\n                onValueChange={(value) => setStatusFilter(value as any)}\r\n              >\r\n                <SelectTrigger className=\"w-[180px]\">\r\n                  <SelectValue placeholder=\"Filtrar por estado\" />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  <SelectItem value=\"all\">Todos los estados</SelectItem>\r\n                  <SelectItem value=\"pendiente\">Pendiente</SelectItem>\r\n                  <SelectItem value=\"muestra_tomada\">Muestra Tomada</SelectItem>\r\n                  <SelectItem value=\"en_proceso\">En Proceso</SelectItem>\r\n                  <SelectItem value=\"completada\">Completada</SelectItem>\r\n                  <SelectItem value=\"cancelada\">Cancelada</SelectItem>\r\n                </SelectContent>\r\n              </Select>\r\n            </div>\r\n          </div>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <Tabs value={activeTab} onValueChange={(v) => setActiveTab(v as any)}>\r\n            <TabsList className=\"grid w-full grid-cols-3\">\r\n              <TabsTrigger value=\"todas\">Todas</TabsTrigger>\r\n              <TabsTrigger value=\"pendientes\">\r\n                Pendientes\r\n                {stats.pendientes > 0 && (\r\n                  <Badge variant=\"secondary\" className=\"ml-2\">\r\n                    {stats.pendientes}\r\n                  </Badge>\r\n                )}\r\n              </TabsTrigger>\r\n              <TabsTrigger value=\"completadas\">Completadas</TabsTrigger>\r\n            </TabsList>\r\n\r\n            <TabsContent value={activeTab} className=\"mt-6\">\r\n              {loading ? (\r\n                <div className=\"flex items-center justify-center py-12\">\r\n                  <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\r\n                </div>\r\n              ) : error ? (\r\n                <div className=\"text-center py-12\">\r\n                  <AlertCircle className=\"h-12 w-12 text-destructive mx-auto mb-4\" />\r\n                  <p className=\"text-destructive\">{error}</p>\r\n                </div>\r\n              ) : filteredOrders.length === 0 ? (\r\n                <div className=\"text-center py-12\">\r\n                  <FlaskConical className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\r\n                  <p className=\"text-muted-foreground\">\r\n                    No hay órdenes de laboratorio en esta categoría\r\n                  </p>\r\n                </div>\r\n              ) : (\r\n                <div className=\"space-y-4\">\r\n                  {filteredOrders.map((order) => (\r\n                    <LabOrderCard key={order.id} order={order} />\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </TabsContent>\r\n          </Tabs>\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction LabOrderCard({ order }: { order: LabOrder }) {\r\n  const StatusIcon = statusConfig[order.status].icon;\r\n  const hasResults = order.results && order.results.length > 0;\r\n\r\n  return (\r\n    <Card>\r\n      <CardContent className=\"p-6\">\r\n        <div className=\"flex items-start justify-between\">\r\n          <div className=\"space-y-3 flex-1\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <FlaskConical className=\"h-5 w-5 text-muted-foreground\" />\r\n                <span className=\"font-mono text-sm font-medium\">\r\n                  {order.numero_orden}\r\n                </span>\r\n              </div>\r\n              <Badge\r\n                variant=\"outline\"\r\n                className={statusConfig[order.status].color}\r\n              >\r\n                <StatusIcon className=\"h-3 w-3 mr-1\" />\r\n                {statusConfig[order.status].label}\r\n              </Badge>\r\n              {order.prioridad !== \"normal\" && (\r\n                <Badge className={prioridadConfig[order.prioridad].color}>\r\n                  {prioridadConfig[order.prioridad].label}\r\n                </Badge>\r\n              )}\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-2 gap-4 text-sm\">\r\n              <div>\r\n                <p className=\"text-muted-foreground\">Fecha de Orden</p>\r\n                <p className=\"font-medium\">\r\n                  {format(new Date(order.fecha_orden), \"dd 'de' MMMM, yyyy\", {\r\n                    locale: es,\r\n                  })}\r\n                </p>\r\n              </div>\r\n              {order.medico && (\r\n                <div>\r\n                  <p className=\"text-muted-foreground\">Médico Solicitante</p>\r\n                  <p className=\"font-medium\">{order.medico.nombre_completo}</p>\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {order.tests && order.tests.length > 0 && (\r\n              <div>\r\n                <p className=\"text-sm text-muted-foreground mb-2\">\r\n                  Exámenes Solicitados ({order.tests.length})\r\n                </p>\r\n                <div className=\"flex flex-wrap gap-2\">\r\n                  {order.tests.slice(0, 3).map((test) => (\r\n                    <Badge key={test.id} variant=\"secondary\">\r\n                      {test.test_type?.nombre}\r\n                    </Badge>\r\n                  ))}\r\n                  {order.tests.length > 3 && (\r\n                    <Badge variant=\"secondary\">\r\n                      +{order.tests.length - 3} más\r\n                    </Badge>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {order.instrucciones_paciente && (\r\n              <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-3\">\r\n                <p className=\"text-sm text-blue-900\">\r\n                  <strong>Instrucciones:</strong> {order.instrucciones_paciente}\r\n                </p>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"flex flex-col gap-2 ml-4\">\r\n            <Link href={`/dashboard/paciente/laboratorio/${order.id}`}>\r\n              <Button variant=\"outline\" size=\"sm\">\r\n                <FileText className=\"h-4 w-4 mr-2\" />\r\n                Ver Detalles\r\n              </Button>\r\n            </Link>\r\n            {hasResults && (\r\n              <Button variant=\"outline\" size=\"sm\">\r\n                <Download className=\"h-4 w-4 mr-2\" />\r\n                Descargar PDF\r\n              </Button>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\paciente\\layout.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[582,585],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[582,585],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { DashboardLayoutClient } from \"@/components/dashboard/layout/dashboard-layout-client\";\r\nimport { AppProviders } from \"@/components/providers/app-providers\";\r\nimport { useAuth } from \"@/hooks/use-auth\";\r\n\r\nexport default function PacienteLayout({\r\n  children,\r\n}: {\r\n  children: React.ReactNode;\r\n}) {\r\n  const router = useRouter();\r\n  const { user, loading } = useAuth();\r\n  const [profile, setProfile] = useState<any>(null);\r\n  const [profileLoading, setProfileLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    async function getProfile() {\r\n      if (loading) return;\r\n\r\n      if (!user) {\r\n        router.push(\"/login\");\r\n        return;\r\n      }\r\n\r\n      try {\r\n        const { data: profileData, error } = await supabase\r\n          .from(\"profiles\")\r\n          .select(\"*\")\r\n          .eq(\"id\", user.id)\r\n          .single();\r\n\r\n        if (error) throw error;\r\n\r\n        // Verificar que el usuario sea paciente\r\n        if (profileData?.role !== \"paciente\") {\r\n          router.push(`/dashboard/${profileData?.role || \"paciente\"}`);\r\n          return;\r\n        }\r\n\r\n        setProfile(profileData);\r\n      } catch (error) {\r\n        console.error(\"Error fetching profile:\", error);\r\n      } finally {\r\n        setProfileLoading(false);\r\n      }\r\n    }\r\n\r\n    getProfile();\r\n  }, [user, loading, router]);\r\n\r\n  if (loading || (user && profileLoading)) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-screen\">\r\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Si no hay usuario y no estamos cargando, useEffect redirigirá\r\n  if (!user && !loading) return null;\r\n\r\n  return (\r\n    <AppProviders>\r\n      <DashboardLayoutClient\r\n        userName={profile?.nombre_completo || user?.email?.split(\"@\")[0]}\r\n        userEmail={user?.email}\r\n        userId={user?.id}\r\n        userRole=\"paciente\"\r\n      >\r\n        {children}\r\n      </DashboardLayoutClient>\r\n    </AppProviders>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\paciente\\medicamentos\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AlertCircle' is defined but never used.","line":22,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'refreshIntakeLog' is assigned a value but never used.","line":55,"column":36,"nodeType":null,"messageId":"unusedVar","endLine":55,"endColumn":52}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@red-salud/ui\";\r\nimport {\r\n  usePatientPrescriptions,\r\n  useTodayIntakeLog,\r\n  useAdherenceStats,\r\n  useActiveMedicationsSummary,\r\n  usePatientReminders,\r\n} from \"@/hooks/use-medications\";\r\nimport {\r\n  Pill,\r\n  Clock,\r\n  CheckCircle2,\r\n  XCircle,\r\n  AlertCircle,\r\n  TrendingUp,\r\n  Calendar,\r\n  Plus,\r\n  Bell,\r\n  FileText,\r\n} from \"lucide-react\";\r\nimport Link from \"next/link\";\r\n\r\nexport default function MedicamentosPage() {\r\n  const [userId, setUserId] = useState<string | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const router = useRouter();\r\n\r\n  useEffect(() => {\r\n    const checkUser = async () => {\r\n      const {\r\n        data: { user },\r\n      } = await supabase.auth.getUser();\r\n\r\n      if (!user) {\r\n        router.push(\"/login\");\r\n        return;\r\n      }\r\n\r\n      setUserId(user.id);\r\n      setLoading(false);\r\n    };\r\n\r\n    checkUser();\r\n  }, [router]);\r\n\r\n  const { prescriptions, loading: prescriptionsLoading } = usePatientPrescriptions(userId || undefined);\r\n  const { intakeLog, recordIntake, refreshIntakeLog } = useTodayIntakeLog(userId || undefined);\r\n  const { stats } = useAdherenceStats(userId || undefined, 30);\r\n  const { summary } = useActiveMedicationsSummary(userId || undefined);\r\n  const { reminders } = usePatientReminders(userId || undefined);\r\n\r\n  if (loading || prescriptionsLoading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-screen\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4\"></div>\r\n          <p className=\"text-muted-foreground\">Cargando medicamentos...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const handleRecordIntake = async (intakeId: string, status: 'tomado' | 'omitido') => {\r\n    await recordIntake(intakeId, status);\r\n  };\r\n\r\n  const activePrescriptions = prescriptions.filter(p => p.status === 'activa');\r\n  const pendingIntakes = intakeLog.filter(log => log.status === 'pendiente');\r\n  const completedToday = intakeLog.filter(log => log.status === 'tomado').length;\r\n\r\n  return (\r\n    <div className=\"container mx-auto py-8 px-4\">\r\n      {/* Header */}\r\n      <div className=\"flex items-start justify-between mb-6\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold\">Mis Medicamentos</h1>\r\n          <p className=\"text-muted-foreground mt-1\">\r\n            Gestiona tus medicamentos y recordatorios\r\n          </p>\r\n        </div>\r\n        <Link href=\"/dashboard/paciente/medicamentos/recordatorios/nuevo\">\r\n          <Button>\r\n            <Plus className=\"mr-2 h-4 w-4\" />\r\n            Nuevo Recordatorio\r\n          </Button>\r\n        </Link>\r\n      </div>\r\n\r\n      {/* Resumen Rápido */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6\">\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm text-muted-foreground\">Medicamentos Activos</p>\r\n                <p className=\"text-2xl font-bold\">{summary?.total_medicamentos || 0}</p>\r\n              </div>\r\n              <Pill className=\"h-8 w-8 text-primary\" />\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm text-muted-foreground\">Tomados Hoy</p>\r\n                <p className=\"text-2xl font-bold\">{completedToday}/{intakeLog.length}</p>\r\n              </div>\r\n              <CheckCircle2 className=\"h-8 w-8 text-green-500\" />\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm text-muted-foreground\">Adherencia</p>\r\n                <p className=\"text-2xl font-bold\">{stats?.porcentaje_adherencia || 0}%</p>\r\n              </div>\r\n              <TrendingUp className=\"h-8 w-8 text-blue-500\" />\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm text-muted-foreground\">Racha Actual</p>\r\n                <p className=\"text-2xl font-bold\">{stats?.racha_actual || 0} días</p>\r\n              </div>\r\n              <Calendar className=\"h-8 w-8 text-orange-500\" />\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Próxima Toma */}\r\n      {summary?.proxima_toma && (\r\n        <Card className=\"mb-6 border-primary\">\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center gap-4\">\r\n              <div className=\"h-12 w-12 rounded-full bg-primary/10 flex items-center justify-center\">\r\n                <Bell className=\"h-6 w-6 text-primary\" />\r\n              </div>\r\n              <div className=\"flex-1\">\r\n                <h3 className=\"font-semibold\">Próxima Toma</h3>\r\n                <p className=\"text-sm text-muted-foreground\">\r\n                  {summary.proxima_toma.medicamento} - {summary.proxima_toma.hora}\r\n                </p>\r\n              </div>\r\n              <div className=\"text-right\">\r\n                <p className=\"text-sm text-muted-foreground\">En</p>\r\n                <p className=\"text-lg font-bold\">{summary.proxima_toma.minutos_restantes} min</p>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      <Tabs defaultValue=\"hoy\" className=\"space-y-6\">\r\n        <TabsList>\r\n          <TabsTrigger value=\"hoy\">\r\n            Hoy ({pendingIntakes.length} pendientes)\r\n          </TabsTrigger>\r\n          <TabsTrigger value=\"recordatorios\">\r\n            Recordatorios ({reminders.length})\r\n          </TabsTrigger>\r\n          <TabsTrigger value=\"recipe\">\r\n            recipe ({activePrescriptions.length})\r\n          </TabsTrigger>\r\n          <TabsTrigger value=\"estadisticas\">Estadísticas</TabsTrigger>\r\n        </TabsList>\r\n\r\n        {/* Tomas de Hoy */}\r\n        <TabsContent value=\"hoy\" className=\"space-y-4\">\r\n          {intakeLog.length > 0 ? (\r\n            intakeLog.map((log) => (\r\n              <Card key={log.id}>\r\n                <CardContent className=\"pt-6\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <div className=\"flex items-center gap-4\">\r\n                      <div className={`h-12 w-12 rounded-full flex items-center justify-center ${\r\n                        log.status === 'tomado' ? 'bg-green-100' :\r\n                        log.status === 'omitido' ? 'bg-red-100' :\r\n                        'bg-gray-100'\r\n                      }`}>\r\n                        {log.status === 'tomado' ? (\r\n                          <CheckCircle2 className=\"h-6 w-6 text-green-600\" />\r\n                        ) : log.status === 'omitido' ? (\r\n                          <XCircle className=\"h-6 w-6 text-red-600\" />\r\n                        ) : (\r\n                          <Clock className=\"h-6 w-6 text-gray-600\" />\r\n                        )}\r\n                      </div>\r\n                      <div>\r\n                        <h3 className=\"font-semibold\">{log.reminder?.nombre_medicamento}</h3>\r\n                        <p className=\"text-sm text-muted-foreground\">\r\n                          {log.reminder?.dosis} •{\" \"}\r\n                          {new Date(log.fecha_programada).toLocaleTimeString(\"es-ES\", {\r\n                            hour: \"2-digit\",\r\n                            minute: \"2-digit\",\r\n                          })}\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                    {log.status === 'pendiente' && (\r\n                      <div className=\"flex gap-2\">\r\n                        <Button\r\n                          size=\"sm\"\r\n                          onClick={() => handleRecordIntake(log.id, 'tomado')}\r\n                        >\r\n                          <CheckCircle2 className=\"mr-2 h-4 w-4\" />\r\n                          Tomado\r\n                        </Button>\r\n                        <Button\r\n                          size=\"sm\"\r\n                          variant=\"outline\"\r\n                          onClick={() => handleRecordIntake(log.id, 'omitido')}\r\n                        >\r\n                          <XCircle className=\"mr-2 h-4 w-4\" />\r\n                          Omitir\r\n                        </Button>\r\n                      </div>\r\n                    )}\r\n                    {log.status === 'tomado' && (\r\n                      <Badge variant=\"default\">\r\n                        Tomado a las{\" \"}\r\n                        {new Date(log.fecha_tomada!).toLocaleTimeString(\"es-ES\", {\r\n                          hour: \"2-digit\",\r\n                          minute: \"2-digit\",\r\n                        })}\r\n                      </Badge>\r\n                    )}\r\n                    {log.status === 'omitido' && (\r\n                      <Badge variant=\"destructive\">Omitido</Badge>\r\n                    )}\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n            ))\r\n          ) : (\r\n            <Card>\r\n              <CardContent className=\"pt-6 text-center py-12\">\r\n                <Clock className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\r\n                <h3 className=\"font-semibold mb-2\">No hay tomas programadas para hoy</h3>\r\n                <p className=\"text-muted-foreground mb-4\">\r\n                  Configura recordatorios para tus medicamentos\r\n                </p>\r\n                <Link href=\"/dashboard/paciente/medicamentos/recordatorios/nuevo\">\r\n                  <Button>Crear Recordatorio</Button>\r\n                </Link>\r\n              </CardContent>\r\n            </Card>\r\n          )}\r\n        </TabsContent>\r\n\r\n        {/* Recordatorios */}\r\n        <TabsContent value=\"recordatorios\" className=\"space-y-4\">\r\n          {reminders.length > 0 ? (\r\n            reminders.map((reminder) => (\r\n              <Card key={reminder.id}>\r\n                <CardContent className=\"pt-6\">\r\n                  <div className=\"flex items-start justify-between\">\r\n                    <div className=\"flex items-start gap-4 flex-1\">\r\n                      <div className=\"h-12 w-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0\">\r\n                        <Bell className=\"h-6 w-6 text-primary\" />\r\n                      </div>\r\n                      <div className=\"flex-1\">\r\n                        <h3 className=\"font-semibold\">{reminder.nombre_medicamento}</h3>\r\n                        <p className=\"text-sm text-muted-foreground mb-2\">{reminder.dosis}</p>\r\n                        <div className=\"flex flex-wrap gap-2 mb-2\">\r\n                          {reminder.horarios.map((hora, index) => (\r\n                            <Badge key={index} variant=\"outline\">\r\n                              {hora}\r\n                            </Badge>\r\n                          ))}\r\n                        </div>\r\n                        <p className=\"text-xs text-muted-foreground\">\r\n                          Desde {new Date(reminder.fecha_inicio).toLocaleDateString(\"es-ES\")}\r\n                          {reminder.fecha_fin && ` hasta ${new Date(reminder.fecha_fin).toLocaleDateString(\"es-ES\")}`}\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                    <Link href={`/dashboard/paciente/medicamentos/recordatorios/${reminder.id}`}>\r\n                      <Button variant=\"outline\" size=\"sm\">\r\n                        Editar\r\n                      </Button>\r\n                    </Link>\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n            ))\r\n          ) : (\r\n            <Card>\r\n              <CardContent className=\"pt-6 text-center py-12\">\r\n                <Bell className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\r\n                <h3 className=\"font-semibold mb-2\">No tienes recordatorios activos</h3>\r\n                <p className=\"text-muted-foreground mb-4\">\r\n                  Crea recordatorios para no olvidar tus medicamentos\r\n                </p>\r\n                <Link href=\"/dashboard/paciente/medicamentos/recordatorios/nuevo\">\r\n                  <Button>Crear Recordatorio</Button>\r\n                </Link>\r\n              </CardContent>\r\n            </Card>\r\n          )}\r\n        </TabsContent>\r\n\r\n        {/* recipe */}\r\n        <TabsContent value=\"recipe\" className=\"space-y-4\">\r\n          {prescriptions.length > 0 ? (\r\n            prescriptions.map((prescription) => (\r\n              <Card key={prescription.id}>\r\n                <CardContent className=\"pt-6\">\r\n                  <div className=\"flex items-start justify-between mb-4\">\r\n                    <div className=\"flex items-start gap-4 flex-1\">\r\n                      <div className=\"h-12 w-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0\">\r\n                        <FileText className=\"h-6 w-6 text-primary\" />\r\n                      </div>\r\n                      <div className=\"flex-1\">\r\n                        <div className=\"flex items-center gap-2 mb-2\">\r\n                          <h3 className=\"font-semibold\">\r\n                            recipe del {new Date(prescription.fecha_prescripcion).toLocaleDateString(\"es-ES\")}\r\n                          </h3>\r\n                          <Badge\r\n                            variant={\r\n                              prescription.status === 'activa' ? 'default' :\r\n                              prescription.status === 'surtida' ? 'outline' :\r\n                              'destructive'\r\n                            }\r\n                          >\r\n                            {prescription.status}\r\n                          </Badge>\r\n                        </div>\r\n                        <p className=\"text-sm text-muted-foreground mb-2\">\r\n                          Dr. {prescription.medico?.nombre_completo}\r\n                        </p>\r\n                        {prescription.diagnostico && (\r\n                          <p className=\"text-sm text-muted-foreground mb-2\">\r\n                            Diagnóstico: {prescription.diagnostico}\r\n                          </p>\r\n                        )}\r\n                        <div className=\"mt-3\">\r\n                          <p className=\"text-sm font-medium mb-2\">Medicamentos:</p>\r\n                          <div className=\"space-y-1\">\r\n                            {prescription.medications?.map((med) => (\r\n                              <p key={med.id} className=\"text-sm text-muted-foreground\">\r\n                                • {med.nombre_medicamento} - {med.dosis} - {med.frecuencia}\r\n                              </p>\r\n                            ))}\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                    <Link href={`/dashboard/paciente/medicamentos/recipe/${prescription.id}`}>\r\n                      <Button variant=\"outline\" size=\"sm\">\r\n                        Ver Detalles\r\n                      </Button>\r\n                    </Link>\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n            ))\r\n          ) : (\r\n            <Card>\r\n              <CardContent className=\"pt-6 text-center py-12\">\r\n                <FileText className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\r\n                <h3 className=\"font-semibold mb-2\">No tienes recipe médicas</h3>\r\n                <p className=\"text-muted-foreground\">\r\n                  Tus recipe aparecerán aquí después de tus consultas\r\n                </p>\r\n              </CardContent>\r\n            </Card>\r\n          )}\r\n        </TabsContent>\r\n\r\n        {/* Estadísticas */}\r\n        <TabsContent value=\"estadisticas\" className=\"space-y-6\">\r\n          {stats && (\r\n            <>\r\n              <Card>\r\n                <CardHeader>\r\n                  <CardTitle className=\"flex items-center gap-2\">\r\n                    <TrendingUp className=\"h-5 w-5\" />\r\n                    Adherencia al Tratamiento\r\n                  </CardTitle>\r\n                  <CardDescription>Últimos 30 días</CardDescription>\r\n                </CardHeader>\r\n                <CardContent>\r\n                  <div className=\"space-y-4\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <span className=\"text-sm\">Porcentaje de adherencia</span>\r\n                      <span className=\"text-2xl font-bold\">{stats.porcentaje_adherencia}%</span>\r\n                    </div>\r\n                    <div className=\"w-full bg-gray-200 rounded-full h-4\">\r\n                      <div\r\n                        className=\"bg-primary h-4 rounded-full transition-all\"\r\n                        style={{ width: `${stats.porcentaje_adherencia}%` }}\r\n                      />\r\n                    </div>\r\n                    <div className=\"grid grid-cols-3 gap-4 mt-6\">\r\n                      <div className=\"text-center\">\r\n                        <p className=\"text-2xl font-bold text-green-600\">{stats.tomas_completadas}</p>\r\n                        <p className=\"text-sm text-muted-foreground\">Tomadas</p>\r\n                      </div>\r\n                      <div className=\"text-center\">\r\n                        <p className=\"text-2xl font-bold text-red-600\">{stats.tomas_omitidas}</p>\r\n                        <p className=\"text-sm text-muted-foreground\">Omitidas</p>\r\n                      </div>\r\n                      <div className=\"text-center\">\r\n                        <p className=\"text-2xl font-bold text-orange-600\">{stats.tomas_retrasadas}</p>\r\n                        <p className=\"text-sm text-muted-foreground\">Retrasadas</p>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n\r\n              <Card>\r\n                <CardHeader>\r\n                  <CardTitle className=\"flex items-center gap-2\">\r\n                    <Calendar className=\"h-5 w-5\" />\r\n                    Rachas\r\n                  </CardTitle>\r\n                  <CardDescription>Días consecutivos tomando medicamentos</CardDescription>\r\n                </CardHeader>\r\n                <CardContent>\r\n                  <div className=\"grid grid-cols-2 gap-4\">\r\n                    <div className=\"text-center p-4 border rounded-lg\">\r\n                      <p className=\"text-3xl font-bold text-primary\">{stats.racha_actual}</p>\r\n                      <p className=\"text-sm text-muted-foreground mt-2\">Racha Actual</p>\r\n                    </div>\r\n                    <div className=\"text-center p-4 border rounded-lg\">\r\n                      <p className=\"text-3xl font-bold text-orange-500\">{stats.mejor_racha}</p>\r\n                      <p className=\"text-sm text-muted-foreground mt-2\">Mejor Racha</p>\r\n                    </div>\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n            </>\r\n          )}\r\n        </TabsContent>\r\n      </Tabs>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\paciente\\medicamentos\\recetas\\[id]\\client.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Clock' is defined but never used.","line":19,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":8},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userId' is assigned a value but never used.","line":25,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter, useParams } from \"next/navigation\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Separator } from \"@/components/ui/separator\";\r\nimport { usePrescription } from \"@/hooks/use-medications\";\r\nimport {\r\n  ArrowLeft,\r\n  FileText,\r\n  User,\r\n  Calendar,\r\n  Pill,\r\n  Download,\r\n  Share2,\r\n  Clock,\r\n  AlertCircle,\r\n} from \"lucide-react\";\r\nimport Link from \"next/link\";\r\n\r\nexport default function DetalleRecetaPage() {\r\n  const [userId, setUserId] = useState<string | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const prescriptionId = params.id as string;\r\n\r\n  const { prescription, loading: prescriptionLoading } = usePrescription(prescriptionId);\r\n\r\n  useEffect(() => {\r\n    const checkUser = async () => {\r\n      const {\r\n        data: { user },\r\n      } = await supabase.auth.getUser();\r\n\r\n      if (!user) {\r\n        router.push(\"/login\");\r\n        return;\r\n      }\r\n\r\n      setUserId(user.id);\r\n      setLoading(false);\r\n    };\r\n\r\n    checkUser();\r\n  }, [router]);\r\n\r\n  if (loading || prescriptionLoading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-screen\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4\"></div>\r\n          <p className=\"text-muted-foreground\">Cargando receta...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!prescription) {\r\n    return (\r\n      <div className=\"container mx-auto py-8 px-4\">\r\n        <Card>\r\n          <CardContent className=\"pt-6 text-center py-12\">\r\n            <FileText className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\r\n            <h3 className=\"font-semibold mb-2\">Receta no encontrada</h3>\r\n            <p className=\"text-muted-foreground mb-4\">\r\n              La receta que buscas no existe o no tienes acceso a ella\r\n            </p>\r\n            <Link href=\"/dashboard/paciente/medicamentos\">\r\n              <Button>Volver a Medicamentos</Button>\r\n            </Link>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const getStatusColor = (status: string) => {\r\n    switch (status) {\r\n      case 'activa':\r\n        return 'default';\r\n      case 'surtida':\r\n        return 'outline';\r\n      case 'vencida':\r\n        return 'destructive';\r\n      case 'cancelada':\r\n        return 'destructive';\r\n      default:\r\n        return 'secondary';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"container mx-auto py-8 px-4 max-w-4xl\">\r\n      {/* Header */}\r\n      <div className=\"mb-6\">\r\n        <Link href=\"/dashboard/paciente/medicamentos\">\r\n          <Button variant=\"ghost\" size=\"sm\">\r\n            <ArrowLeft className=\"mr-2 h-4 w-4\" />\r\n            Volver\r\n          </Button>\r\n        </Link>\r\n      </div>\r\n\r\n      <div className=\"flex items-start justify-between mb-6\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold\">Receta Médica</h1>\r\n          <p className=\"text-muted-foreground mt-1\">\r\n            {new Date(prescription.fecha_prescripcion).toLocaleDateString(\"es-ES\", {\r\n              weekday: \"long\",\r\n              year: \"numeric\",\r\n              month: \"long\",\r\n              day: \"numeric\",\r\n            })}\r\n          </p>\r\n        </div>\r\n        <div className=\"flex gap-2\">\r\n          <Button variant=\"outline\" size=\"sm\">\r\n            <Download className=\"mr-2 h-4 w-4\" />\r\n            Descargar\r\n          </Button>\r\n          <Button variant=\"outline\" size=\"sm\">\r\n            <Share2 className=\"mr-2 h-4 w-4\" />\r\n            Compartir\r\n          </Button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Estado */}\r\n      <Card className=\"mb-6\">\r\n        <CardContent className=\"pt-6\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <p className=\"text-sm text-muted-foreground mb-1\">Estado de la Receta</p>\r\n              <Badge variant={getStatusColor(prescription.status)} className=\"text-base\">\r\n                {prescription.status.toUpperCase()}\r\n              </Badge>\r\n            </div>\r\n            {prescription.fecha_vencimiento && (\r\n              <div className=\"text-right\">\r\n                <p className=\"text-sm text-muted-foreground mb-1\">Válida hasta</p>\r\n                <p className=\"font-medium\">\r\n                  {new Date(prescription.fecha_vencimiento).toLocaleDateString(\"es-ES\")}\r\n                </p>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Información del Médico */}\r\n      <Card className=\"mb-6\">\r\n        <CardHeader>\r\n          <CardTitle className=\"flex items-center gap-2\">\r\n            <User className=\"h-5 w-5\" />\r\n            Médico Prescriptor\r\n          </CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"flex items-center gap-4\">\r\n            <div className=\"h-16 w-16 rounded-full bg-primary/10 flex items-center justify-center\">\r\n              <span className=\"text-2xl font-semibold text-primary\">\r\n                {prescription.medico?.nombre_completo?.charAt(0) || \"D\"}\r\n              </span>\r\n            </div>\r\n            <div>\r\n              <h3 className=\"font-semibold text-lg\">\r\n                {prescription.medico?.nombre_completo || \"No especificado\"}\r\n              </h3>\r\n              <p className=\"text-sm text-muted-foreground\">\r\n                {prescription.medico?.especialidad || \"Medicina General\"}\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Diagnóstico */}\r\n      {prescription.diagnostico && (\r\n        <Card className=\"mb-6\">\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <AlertCircle className=\"h-5 w-5\" />\r\n              Diagnóstico\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <p className=\"text-lg\">{prescription.diagnostico}</p>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Medicamentos */}\r\n      <Card className=\"mb-6\">\r\n        <CardHeader>\r\n          <CardTitle className=\"flex items-center gap-2\">\r\n            <Pill className=\"h-5 w-5\" />\r\n            Medicamentos Recetados\r\n          </CardTitle>\r\n          <CardDescription>\r\n            {prescription.medications?.length || 0} medicamento(s)\r\n          </CardDescription>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"space-y-4\">\r\n            {prescription.medications?.map((med, index) => (\r\n              <div key={med.id}>\r\n                {index > 0 && <Separator className=\"my-4\" />}\r\n                <div className=\"space-y-2\">\r\n                  <div className=\"flex items-start justify-between\">\r\n                    <div className=\"flex-1\">\r\n                      <h3 className=\"font-semibold text-lg\">{med.nombre_medicamento}</h3>\r\n                      {med.medication && (\r\n                        <p className=\"text-sm text-muted-foreground\">\r\n                          {med.medication.nombre_generico} - {med.medication.concentracion}\r\n                        </p>\r\n                      )}\r\n                    </div>\r\n                    <Link href={`/dashboard/paciente/medicamentos/recordatorios/nuevo?medication=${med.nombre_medicamento}&dosis=${med.dosis}`}>\r\n                      <Button variant=\"outline\" size=\"sm\">\r\n                        Crear Recordatorio\r\n                      </Button>\r\n                    </Link>\r\n                  </div>\r\n\r\n                  <div className=\"grid grid-cols-2 gap-4 mt-3\">\r\n                    <div>\r\n                      <p className=\"text-sm text-muted-foreground\">Dosis</p>\r\n                      <p className=\"font-medium\">{med.dosis}</p>\r\n                    </div>\r\n                    <div>\r\n                      <p className=\"text-sm text-muted-foreground\">Frecuencia</p>\r\n                      <p className=\"font-medium\">{med.frecuencia}</p>\r\n                    </div>\r\n                    {med.via_administracion && (\r\n                      <div>\r\n                        <p className=\"text-sm text-muted-foreground\">Vía de Administración</p>\r\n                        <p className=\"font-medium\">{med.via_administracion}</p>\r\n                      </div>\r\n                    )}\r\n                    {med.duracion_dias && (\r\n                      <div>\r\n                        <p className=\"text-sm text-muted-foreground\">Duración</p>\r\n                        <p className=\"font-medium\">{med.duracion_dias} días</p>\r\n                      </div>\r\n                    )}\r\n                    {med.cantidad_total && (\r\n                      <div>\r\n                        <p className=\"text-sm text-muted-foreground\">Cantidad Total</p>\r\n                        <p className=\"font-medium\">{med.cantidad_total}</p>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n\r\n                  {med.instrucciones_especiales && (\r\n                    <div className=\"mt-3 p-3 bg-amber-50 border border-amber-200 rounded-lg\">\r\n                      <p className=\"text-sm font-medium text-amber-800 mb-1\">\r\n                        Instrucciones Especiales:\r\n                      </p>\r\n                      <p className=\"text-sm text-amber-700\">{med.instrucciones_especiales}</p>\r\n                    </div>\r\n                  )}\r\n\r\n                  {med.medication?.indicaciones && (\r\n                    <details className=\"mt-3\">\r\n                      <summary className=\"text-sm font-medium cursor-pointer text-primary\">\r\n                        Ver indicaciones y contraindicaciones\r\n                      </summary>\r\n                      <div className=\"mt-2 space-y-2 text-sm text-muted-foreground\">\r\n                        {med.medication.indicaciones && (\r\n                          <div>\r\n                            <p className=\"font-medium text-foreground\">Indicaciones:</p>\r\n                            <p>{med.medication.indicaciones}</p>\r\n                          </div>\r\n                        )}\r\n                        {med.medication.contraindicaciones && (\r\n                          <div>\r\n                            <p className=\"font-medium text-foreground\">Contraindicaciones:</p>\r\n                            <p>{med.medication.contraindicaciones}</p>\r\n                          </div>\r\n                        )}\r\n                        {med.medication.efectos_secundarios && (\r\n                          <div>\r\n                            <p className=\"font-medium text-foreground\">Efectos Secundarios:</p>\r\n                            <p>{med.medication.efectos_secundarios}</p>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    </details>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Instrucciones Generales */}\r\n      {prescription.instrucciones_generales && (\r\n        <Card className=\"mb-6\">\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <FileText className=\"h-5 w-5\" />\r\n              Instrucciones Generales\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <p className=\"whitespace-pre-wrap\">{prescription.instrucciones_generales}</p>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Información Adicional */}\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"flex items-center gap-2\">\r\n            <Calendar className=\"h-5 w-5\" />\r\n            Información de la Receta\r\n          </CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"space-y-2\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <span className=\"text-sm text-muted-foreground\">Fecha de Prescripción:</span>\r\n              <span className=\"text-sm font-medium\">\r\n                {new Date(prescription.fecha_prescripcion).toLocaleDateString(\"es-ES\")}\r\n              </span>\r\n            </div>\r\n            {prescription.fecha_vencimiento && (\r\n              <div className=\"flex items-center justify-between\">\r\n                <span className=\"text-sm text-muted-foreground\">Fecha de Vencimiento:</span>\r\n                <span className=\"text-sm font-medium\">\r\n                  {new Date(prescription.fecha_vencimiento).toLocaleDateString(\"es-ES\")}\r\n                </span>\r\n              </div>\r\n            )}\r\n            {prescription.fecha_surtida && (\r\n              <div className=\"flex items-center justify-between\">\r\n                <span className=\"text-sm text-muted-foreground\">Fecha Surtida:</span>\r\n                <span className=\"text-sm font-medium\">\r\n                  {new Date(prescription.fecha_surtida).toLocaleDateString(\"es-ES\")}\r\n                </span>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Notas */}\r\n      {prescription.notas && (\r\n        <Card className=\"mt-6\">\r\n          <CardHeader>\r\n            <CardTitle>Notas</CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <p className=\"text-sm text-muted-foreground whitespace-pre-wrap\">\r\n              {prescription.notas}\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\paciente\\medicamentos\\recetas\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'params' is defined but never used.","line":7,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import DetalleRecetaPage from \"./client\";\n\nexport async function generateStaticParams() {\n  return [{ id: \"1\" }];\n}\n\nexport default function Page({ params }: { params: Promise<{ id: string }> }) {\n  return <DetalleRecetaPage />;\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\paciente\\medicamentos\\recordatorios\\nuevo\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2266,2269],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2266,2269],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { Label } from \"@red-salud/ui\";\r\nimport { Textarea } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Calendar } from \"@red-salud/ui\";\r\nimport { useCreateReminder, useSearchMedications } from \"@/hooks/use-medications\";\r\nimport { ArrowLeft, Plus, X, Search, Bell, Clock } from \"lucide-react\";\r\nimport Link from \"next/link\";\r\nimport { es } from \"date-fns/locale\";\r\n\r\nexport default function NuevoRecordatorioPage() {\r\n  const [userId, setUserId] = useState<string | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const router = useRouter();\r\n\r\n  // Form state\r\n  const [nombreMedicamento, setNombreMedicamento] = useState(\"\");\r\n  const [dosis, setDosis] = useState(\"\");\r\n  const [horarios, setHorarios] = useState<string[]>([]);\r\n  const [nuevoHorario, setNuevoHorario] = useState(\"\");\r\n  const [diasSemana, setDiasSemana] = useState<number[]>([]);\r\n  const [fechaInicio, setFechaInicio] = useState<Date>(new Date());\r\n  const [fechaFin, setFechaFin] = useState<Date | undefined>();\r\n  const [notas, setNotas] = useState(\"\");\r\n  const [notificarEmail, setNotificarEmail] = useState(false);\r\n  const [notificarPush, setNotificarPush] = useState(true);\r\n  const [searchTerm, setSearchTerm] = useState(\"\");\r\n\r\n  const { create, loading: creating } = useCreateReminder();\r\n  const { results: searchResults, search, clearSearch } = useSearchMedications();\r\n\r\n  useEffect(() => {\r\n    const checkUser = async () => {\r\n      const {\r\n        data: { user },\r\n      } = await supabase.auth.getUser();\r\n\r\n      if (!user) {\r\n        router.push(\"/login\");\r\n        return;\r\n      }\r\n\r\n      setUserId(user.id);\r\n      setLoading(false);\r\n    };\r\n\r\n    checkUser();\r\n  }, [router]);\r\n\r\n  const handleSearch = (term: string) => {\r\n    setSearchTerm(term);\r\n    if (term.length >= 2) {\r\n      search(term);\r\n    } else {\r\n      clearSearch();\r\n    }\r\n  };\r\n\r\n  const selectMedication = (medication: any) => {\r\n    setNombreMedicamento(medication.nombre_comercial);\r\n    setDosis(medication.dosis_usual || \"\");\r\n    clearSearch();\r\n    setSearchTerm(\"\");\r\n  };\r\n\r\n  const agregarHorario = () => {\r\n    if (nuevoHorario && !horarios.includes(nuevoHorario)) {\r\n      setHorarios([...horarios, nuevoHorario].sort());\r\n      setNuevoHorario(\"\");\r\n    }\r\n  };\r\n\r\n  const eliminarHorario = (horario: string) => {\r\n    setHorarios(horarios.filter((h) => h !== horario));\r\n  };\r\n\r\n  const toggleDiaSemana = (dia: number) => {\r\n    if (diasSemana.includes(dia)) {\r\n      setDiasSemana(diasSemana.filter((d) => d !== dia));\r\n    } else {\r\n      setDiasSemana([...diasSemana, dia].sort());\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n\r\n    if (!userId || !nombreMedicamento || !dosis || horarios.length === 0) {\r\n      alert(\"Por favor completa todos los campos requeridos\");\r\n      return;\r\n    }\r\n\r\n    const result = await create({\r\n      paciente_id: userId,\r\n      nombre_medicamento: nombreMedicamento,\r\n      dosis,\r\n      horarios,\r\n      dias_semana: diasSemana.length > 0 ? diasSemana : undefined,\r\n      fecha_inicio: fechaInicio.toISOString().split(\"T\")[0],\r\n      fecha_fin: fechaFin?.toISOString().split(\"T\")[0],\r\n      notificar_email: notificarEmail,\r\n      notificar_push: notificarPush,\r\n      notas,\r\n    });\r\n\r\n    if (result.success) {\r\n      router.push(\"/dashboard/paciente/medicamentos\");\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-screen\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4\"></div>\r\n          <p className=\"text-muted-foreground\">Cargando...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const diasSemanaLabels = [\"Dom\", \"Lun\", \"Mar\", \"Mié\", \"Jue\", \"Vie\", \"Sáb\"];\r\n\r\n  return (\r\n    <div className=\"container mx-auto py-8 px-4 max-w-4xl\">\r\n      <div className=\"mb-6\">\r\n        <Link href=\"/dashboard/paciente/medicamentos\">\r\n          <Button variant=\"ghost\" size=\"sm\">\r\n            <ArrowLeft className=\"mr-2 h-4 w-4\" />\r\n            Volver\r\n          </Button>\r\n        </Link>\r\n      </div>\r\n\r\n      <div className=\"mb-6\">\r\n        <h1 className=\"text-3xl font-bold\">Nuevo Recordatorio</h1>\r\n        <p className=\"text-muted-foreground mt-1\">\r\n          Configura un recordatorio para tu medicamento\r\n        </p>\r\n      </div>\r\n\r\n      <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n        {/* Buscar Medicamento */}\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <Search className=\"h-5 w-5\" />\r\n              Medicamento\r\n            </CardTitle>\r\n            <CardDescription>Busca en el catálogo o escribe el nombre</CardDescription>\r\n          </CardHeader>\r\n          <CardContent className=\"space-y-4\">\r\n            <div>\r\n              <Label htmlFor=\"search\">Buscar medicamento</Label>\r\n              <div className=\"relative mt-2\">\r\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\r\n                <Input\r\n                  id=\"search\"\r\n                  placeholder=\"Buscar por nombre...\"\r\n                  value={searchTerm}\r\n                  onChange={(e) => handleSearch(e.target.value)}\r\n                  className=\"pl-10\"\r\n                />\r\n              </div>\r\n              {searchResults.length > 0 && (\r\n                <div className=\"mt-2 border rounded-lg max-h-48 overflow-y-auto\">\r\n                  {searchResults.map((med) => (\r\n                    <button\r\n                      key={med.id}\r\n                      type=\"button\"\r\n                      onClick={() => selectMedication(med)}\r\n                      className=\"w-full p-3 text-left hover:bg-muted transition-colors border-b last:border-b-0\"\r\n                    >\r\n                      <p className=\"font-medium\">{med.nombre_comercial}</p>\r\n                      <p className=\"text-sm text-muted-foreground\">\r\n                        {med.nombre_generico} - {med.concentracion}\r\n                      </p>\r\n                    </button>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            <div>\r\n              <Label htmlFor=\"nombre\">Nombre del Medicamento *</Label>\r\n              <Input\r\n                id=\"nombre\"\r\n                value={nombreMedicamento}\r\n                onChange={(e) => setNombreMedicamento(e.target.value)}\r\n                placeholder=\"Ej: Paracetamol\"\r\n                required\r\n                className=\"mt-2\"\r\n              />\r\n            </div>\r\n\r\n            <div>\r\n              <Label htmlFor=\"dosis\">Dosis *</Label>\r\n              <Input\r\n                id=\"dosis\"\r\n                value={dosis}\r\n                onChange={(e) => setDosis(e.target.value)}\r\n                placeholder=\"Ej: 500mg\"\r\n                required\r\n                className=\"mt-2\"\r\n              />\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Horarios */}\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <Clock className=\"h-5 w-5\" />\r\n              Horarios\r\n            </CardTitle>\r\n            <CardDescription>¿A qué horas debes tomar el medicamento?</CardDescription>\r\n          </CardHeader>\r\n          <CardContent className=\"space-y-4\">\r\n            <div className=\"flex gap-2\">\r\n              <Input\r\n                type=\"time\"\r\n                value={nuevoHorario}\r\n                onChange={(e) => setNuevoHorario(e.target.value)}\r\n                className=\"flex-1\"\r\n              />\r\n              <Button type=\"button\" onClick={agregarHorario}>\r\n                <Plus className=\"h-4 w-4\" />\r\n              </Button>\r\n            </div>\r\n\r\n            {horarios.length > 0 && (\r\n              <div className=\"flex flex-wrap gap-2\">\r\n                {horarios.map((horario) => (\r\n                  <Badge key={horario} variant=\"secondary\" className=\"text-base px-3 py-1\">\r\n                    {horario}\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={() => eliminarHorario(horario)}\r\n                      className=\"ml-2\"\r\n                    >\r\n                      <X className=\"h-3 w-3\" />\r\n                    </button>\r\n                  </Badge>\r\n                ))}\r\n              </div>\r\n            )}\r\n\r\n            {horarios.length === 0 && (\r\n              <p className=\"text-sm text-muted-foreground\">\r\n                Agrega al menos un horario\r\n              </p>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Días de la Semana */}\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle>Días de la Semana</CardTitle>\r\n            <CardDescription>\r\n              Deja vacío para todos los días o selecciona días específicos\r\n            </CardDescription>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"flex gap-2\">\r\n              {diasSemanaLabels.map((label, index) => (\r\n                <button\r\n                  key={index}\r\n                  type=\"button\"\r\n                  onClick={() => toggleDiaSemana(index)}\r\n                  className={`flex-1 py-2 px-3 rounded-lg border transition-colors ${\r\n                    diasSemana.includes(index)\r\n                      ? \"bg-primary text-primary-foreground border-primary\"\r\n                      : \"hover:bg-muted\"\r\n                  }`}\r\n                >\r\n                  {label}\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Fechas */}\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle>Duración</CardTitle>\r\n            <CardDescription>¿Cuándo inicia y termina el tratamiento?</CardDescription>\r\n          </CardHeader>\r\n          <CardContent className=\"space-y-4\">\r\n            <div className=\"grid md:grid-cols-2 gap-4\">\r\n              <div>\r\n                <Label>Fecha de Inicio *</Label>\r\n                <Calendar\r\n                  mode=\"single\"\r\n                  selected={fechaInicio}\r\n                  onSelect={(date) => date && setFechaInicio(date)}\r\n                  locale={es}\r\n                  className=\"rounded-md border mt-2\"\r\n                />\r\n              </div>\r\n              <div>\r\n                <Label>Fecha de Fin (Opcional)</Label>\r\n                <Calendar\r\n                  mode=\"single\"\r\n                  selected={fechaFin}\r\n                  onSelect={setFechaFin}\r\n                  locale={es}\r\n                  disabled={(date) => date < fechaInicio}\r\n                  className=\"rounded-md border mt-2\"\r\n                />\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Notificaciones y Notas */}\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <Bell className=\"h-5 w-5\" />\r\n              Notificaciones y Notas\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent className=\"space-y-4\">\r\n            <div className=\"flex items-center gap-2\">\r\n              <input\r\n                type=\"checkbox\"\r\n                id=\"notificar-push\"\r\n                checked={notificarPush}\r\n                onChange={(e) => setNotificarPush(e.target.checked)}\r\n                className=\"h-4 w-4\"\r\n              />\r\n              <Label htmlFor=\"notificar-push\" className=\"cursor-pointer\">\r\n                Notificaciones push\r\n              </Label>\r\n            </div>\r\n\r\n            <div className=\"flex items-center gap-2\">\r\n              <input\r\n                type=\"checkbox\"\r\n                id=\"notificar-email\"\r\n                checked={notificarEmail}\r\n                onChange={(e) => setNotificarEmail(e.target.checked)}\r\n                className=\"h-4 w-4\"\r\n              />\r\n              <Label htmlFor=\"notificar-email\" className=\"cursor-pointer\">\r\n                Notificaciones por email\r\n              </Label>\r\n            </div>\r\n\r\n            <div>\r\n              <Label htmlFor=\"notas\">Notas (Opcional)</Label>\r\n              <Textarea\r\n                id=\"notas\"\r\n                value={notas}\r\n                onChange={(e) => setNotas(e.target.value)}\r\n                placeholder=\"Instrucciones especiales, efectos secundarios a vigilar, etc.\"\r\n                rows={3}\r\n                className=\"mt-2\"\r\n              />\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Botones */}\r\n        <div className=\"flex gap-2\">\r\n          <Link href=\"/dashboard/paciente/medicamentos\" className=\"flex-1\">\r\n            <Button type=\"button\" variant=\"outline\" className=\"w-full\">\r\n              Cancelar\r\n            </Button>\r\n          </Link>\r\n          <Button type=\"submit\" disabled={creating} className=\"flex-1\">\r\n            {creating ? \"Creando...\" : \"Crear Recordatorio\"}\r\n          </Button>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\paciente\\mensajeria\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'LucideIcon' is defined but never used.","line":3,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TabsContent' is defined but never used.","line":12,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'currentConversation' is assigned a value but never used.","line":56,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":56,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport type { LucideIcon } from \"lucide-react\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { useMessaging, useConversation } from \"@/hooks/use-messaging\";\r\nimport { ConversationList } from \"@/components/messaging/conversation-list\";\r\nimport { MessageThread } from \"@/components/messaging/message-thread\";\r\nimport { MessageInput } from \"@/components/messaging/message-input\";\r\nimport { NewConversationDialog } from \"@/components/messaging/new-conversation-dialog\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@red-salud/ui\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport {\r\n  MessageSquare,\r\n  Archive,\r\n  ArchiveRestore,\r\n  Loader2,\r\n  Info,\r\n} from \"lucide-react\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport type { Conversation } from \"@/lib/supabase/types/messaging\";\r\n\r\nexport default function MensajeriaPage() {\r\n  const [userId, setUserId] = useState<string>(\"\");\r\n  const [selectedConversation, setSelectedConversation] =\r\n    useState<Conversation | null>(null);\r\n  const [activeTab, setActiveTab] = useState<\"active\" | \"archived\">(\"active\");\r\n\r\n  useEffect(() => {\r\n    const getUser = async () => {\r\n      const {\r\n        data: { user },\r\n      } = await supabase.auth.getUser();\r\n      if (user) {\r\n        setUserId(user.id);\r\n      }\r\n    };\r\n    getUser();\r\n  }, []);\r\n\r\n  const {\r\n    conversations,\r\n    loading: conversationsLoading,\r\n    error: conversationsError,\r\n    unreadCount,\r\n    refreshConversations,\r\n    createConversation,\r\n    archiveConversation,\r\n    reactivateConversation,\r\n  } = useMessaging(userId);\r\n\r\n  const {\r\n    conversation: currentConversation,\r\n    messages,\r\n    loading: messagesLoading,\r\n    sending,\r\n    error: messagesError,\r\n    sendMessage,\r\n  } = useConversation(selectedConversation?.id || \"\", userId);\r\n\r\n  const handleSelectConversation = (conversation: Conversation) => {\r\n    setSelectedConversation(conversation);\r\n  };\r\n\r\n  const handleSendMessage = async (content: string) => {\r\n    if (!selectedConversation) return;\r\n\r\n    await sendMessage({\r\n      conversation_id: selectedConversation.id,\r\n      content,\r\n    });\r\n\r\n    // Refrescar lista de conversaciones para actualizar último mensaje\r\n    refreshConversations();\r\n  };\r\n\r\n  const handleArchive = async () => {\r\n    if (!selectedConversation) return;\r\n\r\n    await archiveConversation(selectedConversation.id);\r\n    setSelectedConversation(null);\r\n  };\r\n\r\n  const handleReactivate = async () => {\r\n    if (!selectedConversation) return;\r\n\r\n    await reactivateConversation(selectedConversation.id);\r\n    setSelectedConversation(null);\r\n  };\r\n\r\n  if (!userId) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-[600px]\">\r\n        <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const otherUser =\r\n    selectedConversation?.patient_id === userId\r\n      ? selectedConversation?.doctor\r\n      : selectedConversation?.patient;\r\n\r\n  const initials = otherUser?.nombre_completo\r\n    ?.split(\" \")\r\n    .map((n) => n[0])\r\n    .join(\"\")\r\n    .toUpperCase()\r\n    .slice(0, 2);\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold\">Mensajería</h1>\r\n          <p className=\"text-muted-foreground\">\r\n            Comunícate con tus doctores de forma segura\r\n          </p>\r\n        </div>\r\n        <NewConversationDialog onCreateConversation={createConversation} />\r\n      </div>\r\n\r\n      <Card>\r\n        <CardContent className=\"p-0\">\r\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 h-[700px]\">\r\n            {/* Lista de conversaciones */}\r\n            <div className=\"border-r\">\r\n              <div className=\"p-4 border-b\">\r\n                <Tabs value={activeTab} onValueChange={(v) => setActiveTab(v as \"active\" | \"archived\")}>\r\n                  <TabsList className=\"grid w-full grid-cols-2\">\r\n                    <TabsTrigger value=\"active\" className=\"relative\">\r\n                      Activas\r\n                      {unreadCount > 0 && (\r\n                        <Badge\r\n                          variant=\"destructive\"\r\n                          className=\"ml-2 h-5 w-5 rounded-full p-0 text-xs\"\r\n                        >\r\n                          {unreadCount}\r\n                        </Badge>\r\n                      )}\r\n                    </TabsTrigger>\r\n                    <TabsTrigger value=\"archived\">\r\n                      <Archive className=\"h-4 w-4 mr-2\" />\r\n                      Archivadas\r\n                    </TabsTrigger>\r\n                  </TabsList>\r\n                </Tabs>\r\n              </div>\r\n\r\n              {conversationsLoading ? (\r\n                <div className=\"flex items-center justify-center h-[600px]\">\r\n                  <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\r\n                </div>\r\n              ) : conversationsError ? (\r\n                <div className=\"flex items-center justify-center h-[600px] p-4 text-center\">\r\n                  <p className=\"text-destructive\">{conversationsError}</p>\r\n                </div>\r\n              ) : (\r\n                <ConversationList\r\n                  conversations={conversations}\r\n                  selectedId={selectedConversation?.id}\r\n                  onSelect={handleSelectConversation}\r\n                  currentUserId={userId}\r\n                  showArchived={activeTab === \"archived\"}\r\n                />\r\n              )}\r\n            </div>\r\n\r\n            {/* Área de mensajes */}\r\n            <div className=\"lg:col-span-2 flex flex-col\">\r\n              {selectedConversation ? (\r\n                <>\r\n                  {/* Header de conversación */}\r\n                  <div className=\"p-4 border-b\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <div className=\"flex items-center gap-3\">\r\n                        <Avatar className=\"h-10 w-10\">\r\n                          <AvatarImage src={otherUser?.avatar_url} />\r\n                          <AvatarFallback>{initials}</AvatarFallback>\r\n                        </Avatar>\r\n                        <div>\r\n                          <p className=\"font-medium\">\r\n                            {otherUser?.nombre_completo}\r\n                          </p>\r\n                          {selectedConversation.subject && (\r\n                            <p className=\"text-sm text-muted-foreground\">\r\n                              {selectedConversation.subject}\r\n                            </p>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n\r\n                      <div className=\"flex items-center gap-2\">\r\n                        {selectedConversation.status === \"active\" ? (\r\n                          <Button\r\n                            variant=\"ghost\"\r\n                            size=\"sm\"\r\n                            onClick={handleArchive}\r\n                          >\r\n                            <Archive className=\"h-4 w-4 mr-2\" />\r\n                            Archivar\r\n                          </Button>\r\n                        ) : (\r\n                          <Button\r\n                            variant=\"ghost\"\r\n                            size=\"sm\"\r\n                            onClick={handleReactivate}\r\n                          >\r\n                            <ArchiveRestore className=\"h-4 w-4 mr-2\" />\r\n                            Reactivar\r\n                          </Button>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Mensajes */}\r\n                  <div className=\"flex-1 overflow-hidden\">\r\n                    {messagesLoading ? (\r\n                      <div className=\"flex items-center justify-center h-full\">\r\n                        <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\r\n                      </div>\r\n                    ) : messagesError ? (\r\n                      <div className=\"flex items-center justify-center h-full p-4 text-center\">\r\n                        <p className=\"text-destructive\">{messagesError}</p>\r\n                      </div>\r\n                    ) : (\r\n                      <MessageThread messages={messages} currentUserId={userId} />\r\n                    )}\r\n                  </div>\r\n\r\n                  {/* Input de mensaje */}\r\n                  {selectedConversation.status === \"active\" && (\r\n                    <MessageInput\r\n                      onSend={handleSendMessage}\r\n                      disabled={sending}\r\n                    />\r\n                  )}\r\n                </>\r\n              ) : (\r\n                <div className=\"flex flex-col items-center justify-center h-full text-center p-8\">\r\n                  <MessageSquare className=\"h-16 w-16 text-muted-foreground mb-4\" />\r\n                  <h3 className=\"text-lg font-medium mb-2\">\r\n                    Selecciona una conversación\r\n                  </h3>\r\n                  <p className=\"text-muted-foreground max-w-sm\">\r\n                    Elige una conversación de la lista o inicia una nueva para\r\n                    comenzar a comunicarte con tus doctores\r\n                  </p>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Información adicional */}\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"flex items-center gap-2\">\r\n            <Info className=\"h-5 w-5\" />\r\n            Información sobre Mensajería\r\n          </CardTitle>\r\n        </CardHeader>\r\n        <CardContent className=\"space-y-2 text-sm text-muted-foreground\">\r\n          <p>\r\n            • Los mensajes son privados y seguros entre tú y tu doctor\r\n          </p>\r\n          <p>\r\n            • Puedes adjuntar archivos relacionados con tu consulta\r\n          </p>\r\n          <p>\r\n            • Las conversaciones archivadas se pueden reactivar en cualquier momento\r\n          </p>\r\n          <p>\r\n            • Los doctores responderán en su horario de atención\r\n          </p>\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\paciente\\metricas\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardDescription' is defined but never used.","line":8,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardHeader' is defined but never used.","line":8,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":56},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardTitle' is defined but never used.","line":8,"column":58,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":67},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Badge' is defined but never used.","line":10,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingDown' is defined but never used.","line":21,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport type { LucideIcon } from \"lucide-react\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@red-salud/ui\";\r\nimport {\r\n  useHealthDashboardSummary,\r\n  usePatientHealthMetrics,\r\n  usePatientHealthGoals,\r\n  useHealthMetricTypes,\r\n} from \"@/hooks/use-health-metrics\";\r\nimport {\r\n  Activity,\r\n  TrendingUp,\r\n  TrendingDown,\r\n  Target,\r\n  Plus,\r\n  Calendar,\r\n  Heart,\r\n  Droplet,\r\n  Weight,\r\n  Thermometer,\r\n} from \"lucide-react\";\r\nimport Link from \"next/link\";\r\n\r\nexport default function MetricasSaludPage() {\r\n  const [userId, setUserId] = useState<string | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const router = useRouter();\r\n\r\n  useEffect(() => {\r\n    const checkUser = async () => {\r\n      const {\r\n        data: { user },\r\n      } = await supabase.auth.getUser();\r\n\r\n      if (!user) {\r\n        router.push(\"/login\");\r\n        return;\r\n      }\r\n\r\n      setUserId(user.id);\r\n      setLoading(false);\r\n    };\r\n\r\n    checkUser();\r\n  }, [router]);\r\n\r\n  const { summary, loading: summaryLoading } = useHealthDashboardSummary(userId || undefined);\r\n  const { metrics, loading: metricsLoading } = usePatientHealthMetrics(userId || undefined, { limit: 10 });\r\n  const { goals } = usePatientHealthGoals(userId || undefined, 'activa');\r\n  const { metricTypes } = useHealthMetricTypes();\r\n\r\n  if (loading || summaryLoading || metricsLoading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-screen\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4\"></div>\r\n          <p className=\"text-muted-foreground\">Cargando métricas...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const getIconForMetric = (nombre: string) => {\r\n    const iconMap: Record<string, LucideIcon> = {\r\n      'Presión Arterial': Activity,\r\n      'Frecuencia Cardíaca': Heart,\r\n      'Temperatura Corporal': Thermometer,\r\n      'Peso': Weight,\r\n      'Glucosa': Droplet,\r\n    };\r\n    return iconMap[nombre] || Activity;\r\n  };\r\n\r\n  return (\r\n    <div className=\"container mx-auto py-8 px-4\">\r\n      {/* Header */}\r\n      <div className=\"flex items-start justify-between mb-6\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold\">Métricas de Salud</h1>\r\n          <p className=\"text-muted-foreground mt-1\">\r\n            Monitorea tus indicadores vitales y progreso\r\n          </p>\r\n        </div>\r\n        <Link href=\"/dashboard/paciente/metricas/registrar\">\r\n          <Button>\r\n            <Plus className=\"mr-2 h-4 w-4\" />\r\n            Registrar Métrica\r\n          </Button>\r\n        </Link>\r\n      </div>\r\n\r\n      {/* Resumen */}\r\n      {summary && (\r\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6\">\r\n          <Card>\r\n            <CardContent className=\"pt-6\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                  <p className=\"text-sm text-muted-foreground\">Total Registros</p>\r\n                  <p className=\"text-2xl font-bold\">{summary.total_metricas_registradas}</p>\r\n                </div>\r\n                <Activity className=\"h-8 w-8 text-primary\" />\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card>\r\n            <CardContent className=\"pt-6\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                  <p className=\"text-sm text-muted-foreground\">Hoy</p>\r\n                  <p className=\"text-2xl font-bold\">{summary.metricas_hoy}</p>\r\n                </div>\r\n                <Calendar className=\"h-8 w-8 text-blue-500\" />\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card>\r\n            <CardContent className=\"pt-6\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                  <p className=\"text-sm text-muted-foreground\">Metas Activas</p>\r\n                  <p className=\"text-2xl font-bold\">{summary.metas_activas}</p>\r\n                </div>\r\n                <Target className=\"h-8 w-8 text-green-500\" />\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card>\r\n            <CardContent className=\"pt-6\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                  <p className=\"text-sm text-muted-foreground\">Completadas</p>\r\n                  <p className=\"text-2xl font-bold\">{summary.metas_completadas}</p>\r\n                </div>\r\n                <TrendingUp className=\"h-8 w-8 text-orange-500\" />\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n      )}\r\n\r\n      <Tabs defaultValue=\"recientes\" className=\"space-y-6\">\r\n        <TabsList>\r\n          <TabsTrigger value=\"recientes\">Registros Recientes</TabsTrigger>\r\n          <TabsTrigger value=\"metas\">Metas ({goals.length})</TabsTrigger>\r\n          <TabsTrigger value=\"tipos\">Tipos de Métricas</TabsTrigger>\r\n        </TabsList>\r\n\r\n        {/* Registros Recientes */}\r\n        <TabsContent value=\"recientes\" className=\"space-y-4\">\r\n          {metrics.length > 0 ? (\r\n            metrics.map((metric) => {\r\n              const Icon = getIconForMetric(metric.metric_type?.nombre || '');\r\n              const valorDisplay = metric.metric_type?.requiere_multiple_valores && metric.valor_secundario\r\n                ? `${metric.valor}/${metric.valor_secundario}`\r\n                : metric.valor;\r\n\r\n              return (\r\n                <Card key={metric.id}>\r\n                  <CardContent className=\"pt-6\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <div className=\"flex items-center gap-4\">\r\n                        <div className=\"h-12 w-12 rounded-full bg-primary/10 flex items-center justify-center\">\r\n                          <Icon className=\"h-6 w-6 text-primary\" />\r\n                        </div>\r\n                        <div>\r\n                          <h3 className=\"font-semibold\">{metric.metric_type?.nombre}</h3>\r\n                          <p className=\"text-2xl font-bold text-primary\">\r\n                            {valorDisplay} {metric.metric_type?.unidad_medida}\r\n                          </p>\r\n                          <p className=\"text-sm text-muted-foreground\">\r\n                            {new Date(metric.fecha_medicion).toLocaleString(\"es-ES\", {\r\n                              dateStyle: \"medium\",\r\n                              timeStyle: \"short\",\r\n                            })}\r\n                          </p>\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"text-right\">\r\n                        {metric.notas && (\r\n                          <p className=\"text-sm text-muted-foreground mb-2\">{metric.notas}</p>\r\n                        )}\r\n                        <Link href={`/dashboard/paciente/metricas/${metric.metric_type_id}`}>\r\n                          <Button variant=\"outline\" size=\"sm\">\r\n                            Ver Historial\r\n                          </Button>\r\n                        </Link>\r\n                      </div>\r\n                    </div>\r\n                  </CardContent>\r\n                </Card>\r\n              );\r\n            })\r\n          ) : (\r\n            <Card>\r\n              <CardContent className=\"pt-6 text-center py-12\">\r\n                <Activity className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\r\n                <h3 className=\"font-semibold mb-2\">No hay registros aún</h3>\r\n                <p className=\"text-muted-foreground mb-4\">\r\n                  Comienza a registrar tus métricas de salud\r\n                </p>\r\n                <Link href=\"/dashboard/paciente/metricas/registrar\">\r\n                  <Button>Registrar Primera Métrica</Button>\r\n                </Link>\r\n              </CardContent>\r\n            </Card>\r\n          )}\r\n        </TabsContent>\r\n\r\n        {/* Metas */}\r\n        <TabsContent value=\"metas\" className=\"space-y-4\">\r\n          {goals.length > 0 ? (\r\n            goals.map((goal) => (\r\n              <Card key={goal.id}>\r\n                <CardContent className=\"pt-6\">\r\n                  <div className=\"flex items-start justify-between mb-4\">\r\n                    <div className=\"flex items-start gap-4 flex-1\">\r\n                      <div className=\"h-12 w-12 rounded-full bg-green-100 flex items-center justify-center\">\r\n                        <Target className=\"h-6 w-6 text-green-600\" />\r\n                      </div>\r\n                      <div className=\"flex-1\">\r\n                        <h3 className=\"font-semibold text-lg\">{goal.titulo}</h3>\r\n                        <p className=\"text-sm text-muted-foreground mb-2\">\r\n                          {goal.metric_type?.nombre}\r\n                        </p>\r\n                        {goal.descripcion && (\r\n                          <p className=\"text-sm text-muted-foreground mb-3\">{goal.descripcion}</p>\r\n                        )}\r\n                        <div className=\"space-y-2\">\r\n                          <div className=\"flex items-center justify-between text-sm\">\r\n                            <span>Progreso</span>\r\n                            <span className=\"font-medium\">{goal.progreso_actual}%</span>\r\n                          </div>\r\n                          <div className=\"w-full bg-gray-200 rounded-full h-2\">\r\n                            <div\r\n                              className=\"bg-green-500 h-2 rounded-full transition-all\"\r\n                              style={{ width: `${goal.progreso_actual}%` }}\r\n                            />\r\n                          </div>\r\n                          <div className=\"flex items-center justify-between text-sm text-muted-foreground\">\r\n                            <span>Objetivo: {goal.valor_objetivo} {goal.metric_type?.unidad_medida}</span>\r\n                            {goal.fecha_objetivo && (\r\n                              <span>\r\n                                Hasta: {new Date(goal.fecha_objetivo).toLocaleDateString(\"es-ES\")}\r\n                              </span>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                    <Link href={`/dashboard/paciente/metricas/metas/${goal.id}`}>\r\n                      <Button variant=\"outline\" size=\"sm\">\r\n                        Ver Detalles\r\n                      </Button>\r\n                    </Link>\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n            ))\r\n          ) : (\r\n            <Card>\r\n              <CardContent className=\"pt-6 text-center py-12\">\r\n                <Target className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\r\n                <h3 className=\"font-semibold mb-2\">No tienes metas activas</h3>\r\n                <p className=\"text-muted-foreground mb-4\">\r\n                  Establece metas para mejorar tu salud\r\n                </p>\r\n                <Link href=\"/dashboard/paciente/metricas/metas/nueva\">\r\n                  <Button>Crear Meta</Button>\r\n                </Link>\r\n              </CardContent>\r\n            </Card>\r\n          )}\r\n        </TabsContent>\r\n\r\n        {/* Tipos de Métricas */}\r\n        <TabsContent value=\"tipos\" className=\"space-y-4\">\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n            {metricTypes.map((type) => {\r\n              const Icon = getIconForMetric(type.nombre);\r\n              return (\r\n                <Card key={type.id} className=\"hover:shadow-md transition-shadow\">\r\n                  <CardContent className=\"pt-6\">\r\n                    <div className=\"flex items-start gap-3 mb-3\">\r\n                      <div className=\"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0\">\r\n                        <Icon className=\"h-5 w-5 text-primary\" />\r\n                      </div>\r\n                      <div className=\"flex-1\">\r\n                        <h3 className=\"font-semibold\">{type.nombre}</h3>\r\n                        <p className=\"text-sm text-muted-foreground\">\r\n                          Unidad: {type.unidad_medida}\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                    {type.descripcion && (\r\n                      <p className=\"text-sm text-muted-foreground mb-3\">{type.descripcion}</p>\r\n                    )}\r\n                    {type.rango_normal_min && type.rango_normal_max && (\r\n                      <div className=\"text-sm\">\r\n                        <p className=\"text-muted-foreground\">Rango Normal:</p>\r\n                        <p className=\"font-medium\">\r\n                          {type.rango_normal_min} - {type.rango_normal_max} {type.unidad_medida}\r\n                        </p>\r\n                      </div>\r\n                    )}\r\n                    <Link href={`/dashboard/paciente/metricas/${type.id}`} className=\"mt-3 block\">\r\n                      <Button variant=\"outline\" size=\"sm\" className=\"w-full\">\r\n                        Ver Historial\r\n                      </Button>\r\n                    </Link>\r\n                  </CardContent>\r\n                </Card>\r\n              );\r\n            })}\r\n          </div>\r\n        </TabsContent>\r\n      </Tabs>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\paciente\\metricas\\registrar\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\paciente\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\paciente\\perfil\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\paciente\\perfil\\preview\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\paciente\\telemedicina\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardDescription' is defined but never used.","line":8,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingUp' is defined but never used.","line":17,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'refreshSessions' is assigned a value but never used.","line":29,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":45},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":106,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":109,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1370,1373],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1370,1373],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":220,"column":31,"nodeType":"JSXOpeningElement","endLine":224,"endColumn":33},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":320,"column":31,"nodeType":"JSXOpeningElement","endLine":324,"endColumn":33}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { usePatientSessions, useSessionStats } from \"@/hooks/use-telemedicine\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@red-salud/ui\";\r\nimport {\r\n  Video,\r\n  Calendar,\r\n  Clock,\r\n  User,\r\n  FileText,\r\n  TrendingUp,\r\n  Plus,\r\n  Play,\r\n  CheckCircle,\r\n  XCircle,\r\n  AlertCircle,\r\n} from \"lucide-react\";\r\nimport type { TelemedicineSession } from \"@/lib/supabase/types/telemedicine\";\r\n\r\nexport default function TelemedicinePage() {\r\n  const router = useRouter();\r\n  const [userId, setUserId] = useState<string | undefined>();\r\n  const { sessions, loading, refreshSessions } = usePatientSessions(userId);\r\n  const { stats } = useSessionStats(userId);\r\n\r\n  useEffect(() => {\r\n    const getUser = async () => {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (user) {\r\n        setUserId(user.id);\r\n      }\r\n    };\r\n    getUser();\r\n  }, []);\r\n\r\n  const getStatusBadge = (status: string) => {\r\n    const variants: Record<string, { variant: \"default\" | \"secondary\" | \"destructive\" | \"outline\", icon: any }> = {\r\n      scheduled: { variant: \"outline\", icon: Calendar },\r\n      waiting: { variant: \"secondary\", icon: Clock },\r\n      active: { variant: \"default\", icon: Play },\r\n      completed: { variant: \"secondary\", icon: CheckCircle },\r\n      cancelled: { variant: \"destructive\", icon: XCircle },\r\n      failed: { variant: \"destructive\", icon: AlertCircle },\r\n    };\r\n\r\n    const config = variants[status] || variants.scheduled;\r\n    const Icon = config.icon;\r\n\r\n    return (\r\n      <Badge variant={config.variant} className=\"flex items-center gap-1\">\r\n        <Icon className=\"h-3 w-3\" />\r\n        {status === \"scheduled\" && \"Programada\"}\r\n        {status === \"waiting\" && \"En espera\"}\r\n        {status === \"active\" && \"En curso\"}\r\n        {status === \"completed\" && \"Completada\"}\r\n        {status === \"cancelled\" && \"Cancelada\"}\r\n        {status === \"failed\" && \"Fallida\"}\r\n      </Badge>\r\n    );\r\n  };\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString(\"es-ES\", {\r\n      day: \"2-digit\",\r\n      month: \"long\",\r\n      year: \"numeric\",\r\n    });\r\n  };\r\n\r\n  const formatTime = (dateString: string) => {\r\n    return new Date(dateString).toLocaleTimeString(\"es-ES\", {\r\n      hour: \"2-digit\",\r\n      minute: \"2-digit\",\r\n    });\r\n  };\r\n\r\n  const upcomingSessions = sessions.filter(\r\n    (s) => s.status === \"scheduled\" || s.status === \"waiting\"\r\n  );\r\n  const pastSessions = sessions.filter(\r\n    (s) => s.status === \"completed\" || s.status === \"cancelled\" || s.status === \"failed\"\r\n  );\r\n\r\n  const handleJoinSession = (session: TelemedicineSession) => {\r\n    router.push(`/dashboard/paciente/telemedicina/sesion/${session.id}`);\r\n  };\r\n\r\n  const handleNewSession = () => {\r\n    router.push(\"/dashboard/paciente/citas/nueva?type=video\");\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-[400px]\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"></div>\r\n          <p className=\"text-gray-600\">Cargando sesiones...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold text-gray-900\">Telemedicina</h1>\r\n          <p className=\"text-gray-600 mt-1\">\r\n            Consultas médicas por videollamada\r\n          </p>\r\n        </div>\r\n        <Button onClick={handleNewSession} size=\"lg\">\r\n          <Plus className=\"h-5 w-5 mr-2\" />\r\n          Nueva Consulta\r\n        </Button>\r\n      </div>\r\n\r\n      {/* Estadísticas */}\r\n      {stats && (\r\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n          <Card>\r\n            <CardHeader className=\"pb-3\">\r\n              <CardTitle className=\"text-sm font-medium text-gray-600\">\r\n                Total de Sesiones\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"text-2xl font-bold\">{stats.total_sessions}</div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card>\r\n            <CardHeader className=\"pb-3\">\r\n              <CardTitle className=\"text-sm font-medium text-gray-600\">\r\n                Completadas\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"text-2xl font-bold text-green-600\">\r\n                {stats.completed_sessions}\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card>\r\n            <CardHeader className=\"pb-3\">\r\n              <CardTitle className=\"text-sm font-medium text-gray-600\">\r\n                Duración Promedio\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"text-2xl font-bold\">\r\n                {Math.round(stats.average_duration)} min\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card>\r\n            <CardHeader className=\"pb-3\">\r\n              <CardTitle className=\"text-sm font-medium text-gray-600\">\r\n                Tiempo Total\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"text-2xl font-bold\">\r\n                {Math.round(stats.total_duration / 60)} hrs\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n      )}\r\n\r\n      {/* Tabs */}\r\n      <Tabs defaultValue=\"upcoming\" className=\"space-y-4\">\r\n        <TabsList>\r\n          <TabsTrigger value=\"upcoming\">\r\n            Próximas ({upcomingSessions.length})\r\n          </TabsTrigger>\r\n          <TabsTrigger value=\"past\">\r\n            Historial ({pastSessions.length})\r\n          </TabsTrigger>\r\n        </TabsList>\r\n\r\n        {/* Próximas Sesiones */}\r\n        <TabsContent value=\"upcoming\" className=\"space-y-4\">\r\n          {upcomingSessions.length === 0 ? (\r\n            <Card>\r\n              <CardContent className=\"flex flex-col items-center justify-center py-12\">\r\n                <Video className=\"h-12 w-12 text-gray-400 mb-4\" />\r\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">\r\n                  No tienes consultas programadas\r\n                </h3>\r\n                <p className=\"text-gray-600 mb-4 text-center max-w-md\">\r\n                  Agenda una nueva consulta por videollamada con uno de nuestros\r\n                  especialistas\r\n                </p>\r\n                <Button onClick={handleNewSession}>\r\n                  <Plus className=\"h-4 w-4 mr-2\" />\r\n                  Agendar Consulta\r\n                </Button>\r\n              </CardContent>\r\n            </Card>\r\n          ) : (\r\n            <div className=\"grid gap-4\">\r\n              {upcomingSessions.map((session) => (\r\n                <Card key={session.id} className=\"hover:shadow-md transition-shadow\">\r\n                  <CardContent className=\"p-6\">\r\n                    <div className=\"flex items-start justify-between\">\r\n                      <div className=\"flex-1\">\r\n                        <div className=\"flex items-center gap-3 mb-3\">\r\n                          <div className=\"h-12 w-12 rounded-full bg-blue-100 flex items-center justify-center\">\r\n                            {session.doctor?.avatar_url ? (\r\n                              <img\r\n                                src={session.doctor.avatar_url}\r\n                                alt={session.doctor.nombre_completo}\r\n                                className=\"h-12 w-12 rounded-full object-cover\"\r\n                              />\r\n                            ) : (\r\n                              <User className=\"h-6 w-6 text-blue-600\" />\r\n                            )}\r\n                          </div>\r\n                          <div>\r\n                            <h3 className=\"font-semibold text-lg\">\r\n                              Dr. {session.doctor?.nombre_completo}\r\n                            </h3>\r\n                            <p className=\"text-sm text-gray-600\">\r\n                              {session.doctor?.specialty || \"Medicina General\"}\r\n                            </p>\r\n                          </div>\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-2 gap-4 mb-4\">\r\n                          <div className=\"flex items-center gap-2 text-sm text-gray-600\">\r\n                            <Calendar className=\"h-4 w-4\" />\r\n                            {formatDate(session.scheduled_start_time)}\r\n                          </div>\r\n                          <div className=\"flex items-center gap-2 text-sm text-gray-600\">\r\n                            <Clock className=\"h-4 w-4\" />\r\n                            {formatTime(session.scheduled_start_time)}\r\n                          </div>\r\n                        </div>\r\n\r\n                        {session.appointment?.reason && (\r\n                          <div className=\"flex items-start gap-2 text-sm text-gray-600 mb-3\">\r\n                            <FileText className=\"h-4 w-4 mt-0.5\" />\r\n                            <span>{session.appointment.reason}</span>\r\n                          </div>\r\n                        )}\r\n\r\n                        <div className=\"flex items-center gap-2\">\r\n                          {getStatusBadge(session.status)}\r\n                          {session.recording_enabled && (\r\n                            <Badge variant=\"outline\">\r\n                              <Video className=\"h-3 w-3 mr-1\" />\r\n                              Grabación habilitada\r\n                            </Badge>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n\r\n                      <div className=\"flex flex-col gap-2\">\r\n                        {session.status === \"waiting\" || session.status === \"active\" ? (\r\n                          <Button\r\n                            onClick={() => handleJoinSession(session)}\r\n                            size=\"lg\"\r\n                            className=\"bg-green-600 hover:bg-green-700\"\r\n                          >\r\n                            <Video className=\"h-5 w-5 mr-2\" />\r\n                            Unirse\r\n                          </Button>\r\n                        ) : (\r\n                          <Button\r\n                            onClick={() => handleJoinSession(session)}\r\n                            variant=\"outline\"\r\n                            size=\"lg\"\r\n                          >\r\n                            Ver Detalles\r\n                          </Button>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                  </CardContent>\r\n                </Card>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </TabsContent>\r\n\r\n        {/* Historial */}\r\n        <TabsContent value=\"past\" className=\"space-y-4\">\r\n          {pastSessions.length === 0 ? (\r\n            <Card>\r\n              <CardContent className=\"flex flex-col items-center justify-center py-12\">\r\n                <FileText className=\"h-12 w-12 text-gray-400 mb-4\" />\r\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">\r\n                  No hay consultas anteriores\r\n                </h3>\r\n                <p className=\"text-gray-600 text-center max-w-md\">\r\n                  Aquí aparecerán tus consultas completadas\r\n                </p>\r\n              </CardContent>\r\n            </Card>\r\n          ) : (\r\n            <div className=\"grid gap-4\">\r\n              {pastSessions.map((session) => (\r\n                <Card key={session.id} className=\"hover:shadow-md transition-shadow\">\r\n                  <CardContent className=\"p-6\">\r\n                    <div className=\"flex items-start justify-between\">\r\n                      <div className=\"flex-1\">\r\n                        <div className=\"flex items-center gap-3 mb-3\">\r\n                          <div className=\"h-12 w-12 rounded-full bg-gray-100 flex items-center justify-center\">\r\n                            {session.doctor?.avatar_url ? (\r\n                              <img\r\n                                src={session.doctor.avatar_url}\r\n                                alt={session.doctor.nombre_completo}\r\n                                className=\"h-12 w-12 rounded-full object-cover\"\r\n                              />\r\n                            ) : (\r\n                              <User className=\"h-6 w-6 text-gray-600\" />\r\n                            )}\r\n                          </div>\r\n                          <div>\r\n                            <h3 className=\"font-semibold text-lg\">\r\n                              Dr. {session.doctor?.nombre_completo}\r\n                            </h3>\r\n                            <p className=\"text-sm text-gray-600\">\r\n                              {session.doctor?.specialty || \"Medicina General\"}\r\n                            </p>\r\n                          </div>\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-2 gap-4 mb-3\">\r\n                          <div className=\"flex items-center gap-2 text-sm text-gray-600\">\r\n                            <Calendar className=\"h-4 w-4\" />\r\n                            {formatDate(session.scheduled_start_time)}\r\n                          </div>\r\n                          {session.duration_minutes && (\r\n                            <div className=\"flex items-center gap-2 text-sm text-gray-600\">\r\n                              <Clock className=\"h-4 w-4\" />\r\n                              {session.duration_minutes} minutos\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n\r\n                        <div className=\"flex items-center gap-2\">\r\n                          {getStatusBadge(session.status)}\r\n                        </div>\r\n                      </div>\r\n\r\n                      <Button\r\n                        onClick={() => router.push(`/dashboard/paciente/telemedicina/sesion/${session.id}`)}\r\n                        variant=\"outline\"\r\n                      >\r\n                        Ver Detalles\r\n                      </Button>\r\n                    </div>\r\n                  </CardContent>\r\n                </Card>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </TabsContent>\r\n      </Tabs>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\paciente\\telemedicina\\recipes\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\paciente\\telemedicina\\sesion\\[id]\\client.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'update' is assigned a value but never used.","line":37,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":37,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'leave' is assigned a value but never used.","line":38,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'markAsRead' is assigned a value but never used.","line":39,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":39,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'remoteVideoRef' is assigned a value but never used.","line":42,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":42,"endColumn":23},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The ref value 'videoRef.current' will likely have changed by the time this effect cleanup function runs. If this ref points to a node rendered by React, copy 'videoRef.current' to a variable inside the effect, and use that variable in the cleanup function.","line":92,"column":33,"nodeType":"Identifier","endLine":92,"endColumn":40},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'formatTime' is assigned a value but never used.","line":158,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":158,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isActive' is assigned a value but never used.","line":191,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":191,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isWaiting' is assigned a value but never used.","line":192,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":192,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'canStart' is assigned a value but never used.","line":193,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":193,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":238,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":238,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8028,8031],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8028,8031],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":249,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":249,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8424,8427],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8424,8427],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState, useRef } from \"react\";\r\nimport { useParams, useRouter } from \"next/navigation\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport {\r\n  useSession,\r\n  useActiveSession,\r\n  useSessionParticipants,\r\n  useSessionChat,\r\n} from \"@/hooks/use-telemedicine\";\r\nimport { Tabs, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card, CardContent } from \"@/components/ui/card\";\r\nimport { MessageSquare, FileText } from \"lucide-react\";\r\nimport { SessionHeader } from \"@/components/dashboard/paciente/telemedicina/session/session-header\";\r\nimport { VideoPanel } from \"@/components/dashboard/paciente/telemedicina/session/video-panel\";\r\nimport { InfoCard } from \"@/components/dashboard/paciente/telemedicina/session/info-card\";\r\nimport { ChatPanel } from \"@/components/dashboard/paciente/telemedicina/session/chat-panel\";\r\nimport { NotesPanel } from \"@/components/dashboard/paciente/telemedicina/session/notes-panel\";\r\nimport { ParticipantsPanel } from \"@/components/dashboard/paciente/telemedicina/session/participants-panel\";\r\n\r\nexport default function SessionPage() {\r\n  const params = useParams();\r\n  const router = useRouter();\r\n  const sessionId = params.id as string;\r\n\r\n  const [userId, setUserId] = useState<string | undefined>();\r\n  const [userName, setUserName] = useState<string>(\"\");\r\n  const [isVideoEnabled, setIsVideoEnabled] = useState(true);\r\n  const [isAudioEnabled, setIsAudioEnabled] = useState(true);\r\n  const [isScreenSharing, setIsScreenSharing] = useState(false);\r\n  const [messageText, setMessageText] = useState(\"\");\r\n  const [sessionNotes, setSessionNotes] = useState(\"\");\r\n\r\n  const { session, loading, refreshSession } = useSession(sessionId);\r\n  const { start, end, update } = useActiveSession(sessionId);\r\n  const { participants, join, leave } = useSessionParticipants(sessionId);\r\n  const { messages, send, markAsRead, refreshMessages } = useSessionChat(sessionId);\r\n\r\n  const videoRef = useRef<HTMLVideoElement>(null);\r\n  const remoteVideoRef = useRef<HTMLVideoElement>(null);\r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n\r\n  useEffect(() => {\r\n    const getUser = async () => {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (user) {\r\n        setUserId(user.id);\r\n\r\n        // Obtener nombre del usuario\r\n        const { data: profile } = await supabase\r\n          .from(\"profiles\")\r\n          .select(\"nombre_completo\")\r\n          .eq(\"id\", user.id)\r\n          .single();\r\n\r\n        if (profile) {\r\n          setUserName(profile.nombre_completo);\r\n        }\r\n      }\r\n    };\r\n    getUser();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  }, [messages]);\r\n\r\n  // Simular acceso a cámara y micrófono\r\n  useEffect(() => {\r\n    const initMedia = async () => {\r\n      try {\r\n        const stream = await navigator.mediaDevices.getUserMedia({\r\n          video: true,\r\n          audio: true,\r\n        });\r\n        if (videoRef.current) {\r\n          videoRef.current.srcObject = stream;\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error accessing media devices:\", error);\r\n      }\r\n    };\r\n\r\n    if (session?.status === \"active\" || session?.status === \"waiting\") {\r\n      initMedia();\r\n    }\r\n\r\n    return () => {\r\n      if (videoRef.current?.srcObject) {\r\n        const stream = videoRef.current.srcObject as MediaStream;\r\n        stream.getTracks().forEach((track) => track.stop());\r\n      }\r\n    };\r\n  }, [session?.status]);\r\n\r\n  const handleStartSession = async () => {\r\n    if (!userId) return;\r\n\r\n    // Unirse como participante\r\n    await join(userId, {\r\n      session_id: sessionId,\r\n      role: \"patient\",\r\n      video_enabled: isVideoEnabled,\r\n      audio_enabled: isAudioEnabled,\r\n    });\r\n\r\n    // Iniciar sesión\r\n    await start();\r\n    await refreshSession();\r\n  };\r\n\r\n  const handleEndSession = async () => {\r\n    await end(sessionNotes);\r\n    await refreshSession();\r\n    router.push(\"/dashboard/paciente/telemedicina\");\r\n  };\r\n\r\n  const handleSendMessage = async () => {\r\n    if (!userId || !messageText.trim()) return;\r\n\r\n    await send(userId, {\r\n      session_id: sessionId,\r\n      message: messageText,\r\n      message_type: \"text\",\r\n    });\r\n\r\n    setMessageText(\"\");\r\n    await refreshMessages();\r\n  };\r\n\r\n  const toggleVideo = async () => {\r\n    setIsVideoEnabled(!isVideoEnabled);\r\n    if (videoRef.current?.srcObject) {\r\n      const stream = videoRef.current.srcObject as MediaStream;\r\n      stream.getVideoTracks().forEach((track) => {\r\n        track.enabled = !isVideoEnabled;\r\n      });\r\n    }\r\n  };\r\n\r\n  const toggleAudio = async () => {\r\n    setIsAudioEnabled(!isAudioEnabled);\r\n    if (videoRef.current?.srcObject) {\r\n      const stream = videoRef.current.srcObject as MediaStream;\r\n      stream.getAudioTracks().forEach((track) => {\r\n        track.enabled = !isAudioEnabled;\r\n      });\r\n    }\r\n  };\r\n\r\n  const toggleScreenShare = () => {\r\n    setIsScreenSharing(!isScreenSharing);\r\n    // Aquí iría la lógica real de compartir pantalla\r\n  };\r\n\r\n  const formatTime = (dateString: string) => {\r\n    return new Date(dateString).toLocaleTimeString(\"es-ES\", {\r\n      hour: \"2-digit\",\r\n      minute: \"2-digit\",\r\n    });\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-screen\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"></div>\r\n          <p className=\"text-gray-600\">Cargando sesión...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!session) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-screen\">\r\n        <Card className=\"max-w-md\">\r\n          <CardContent className=\"pt-6 text-center\">\r\n            <p className=\"text-gray-600 mb-4\">Sesión no encontrada</p>\r\n            <Button onClick={() => router.push(\"/dashboard/paciente/telemedicina\")}>\r\n              Volver a Telemedicina\r\n            </Button>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const isActive = session.status === \"active\";\r\n  const isWaiting = session.status === \"waiting\";\r\n  const canStart = session.status === \"scheduled\" || session.status === \"waiting\";\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 p-4\">\r\n      <div className=\"max-w-7xl mx-auto space-y-4\">\r\n        <SessionHeader status={session.status} />\r\n\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4\">\r\n          <div className=\"lg:col-span-2 space-y-4\">\r\n            <VideoPanel\r\n              status={session.status}\r\n              doctorName={session.doctor?.nombre_completo}\r\n              doctorSpecialty={session.doctor?.specialty}\r\n              isVideoEnabled={isVideoEnabled}\r\n              isAudioEnabled={isAudioEnabled}\r\n              isScreenSharing={isScreenSharing}\r\n              onToggleVideo={toggleVideo}\r\n              onToggleAudio={toggleAudio}\r\n              onToggleScreen={toggleScreenShare}\r\n              onEnd={handleEndSession}\r\n              onStart={handleStartSession}\r\n            />\r\n\r\n            <InfoCard\r\n              scheduled_start_time={session.scheduled_start_time}\r\n              reason={session.appointment?.reason}\r\n              duration_minutes={session.duration_minutes}\r\n            />\r\n          </div>\r\n\r\n          {/* Panel lateral */}\r\n          <div className=\"space-y-4\">\r\n            <Tabs defaultValue=\"chat\" className=\"w-full\">\r\n              <TabsList className=\"grid w-full grid-cols-2\">\r\n                <TabsTrigger value=\"chat\">\r\n                  <MessageSquare className=\"h-4 w-4 mr-2\" />\r\n                  Chat\r\n                </TabsTrigger>\r\n                <TabsTrigger value=\"notes\">\r\n                  <FileText className=\"h-4 w-4 mr-2\" />\r\n                  Notas\r\n                </TabsTrigger>\r\n              </TabsList>\r\n\r\n              <ChatPanel\r\n                messages={messages as any}\r\n                userId={userId}\r\n                messageText={messageText}\r\n                onMessageTextChange={setMessageText}\r\n                onSend={handleSendMessage}\r\n              />\r\n\r\n              {/* Notas */}\r\n              <NotesPanel notes={sessionNotes} onNotesChange={setSessionNotes} />\r\n            </Tabs>\r\n\r\n            <ParticipantsPanel participants={participants as any} userName={userName} doctorName={session.doctor?.nombre_completo} />\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\paciente\\telemedicina\\sesion\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'params' is defined but never used.","line":7,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import SessionPage from \"./client\";\r\n\r\nexport async function generateStaticParams() {\r\n    return [{ id: \"1\" }];\r\n}\r\n\r\nexport default function Page({ params }: { params: Promise<{ id: string }> }) {\r\n    return <SessionPage />;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\redirect\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\secretaria\\agenda\\nueva\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\secretaria\\agenda\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\secretaria\\layout-client.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\secretaria\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\secretaria\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\dashboard\\seguro\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\app\\tauri-test\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\academy\\lesson-player\\LessonFooter.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\academy\\lesson-player\\LessonHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\academy\\lesson-player\\LessonPlayer.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'motion' is defined but never used.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AnimatePresence' is defined but never used.","line":9,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AcademyGamificationService' is defined but never used.","line":14,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'lesson' is defined but never used.","line":21,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":11},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1471,1474],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1471,1474],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file LessonPlayer.tsx\r\n * @description Orquestador principal de la sesión de lección interactiva\r\n */\r\n\r\n'use client';\r\n\r\nimport React, { useState, useCallback } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { LessonPlayerProps, LessonState } from './LessonPlayer.types';\r\nimport { LessonHeader } from './LessonHeader';\r\nimport { QuestionRenderer } from './QuestionRenderer';\r\nimport { LessonFooter } from './LessonFooter';\r\nimport { AcademyGamificationService } from '@/lib/academy/services/gamification.service';\r\n\r\n/**\r\n * Componente LessonPlayer\r\n * Gestiona el estado de la lección, validación de respuestas y navegación.\r\n */\r\nexport const LessonPlayer: React.FC<LessonPlayerProps> = ({\r\n    lesson,\r\n    questions,\r\n    onComplete,\r\n    onExit\r\n}) => {\r\n    const [state, setState] = useState<LessonState>({\r\n        currentIndex: 0,\r\n        answers: [],\r\n        lives: 5,\r\n        isFinished: false,\r\n        validationState: 'idle'\r\n    });\r\n\r\n    const [selectedOptionId, setSelectedOptionId] = useState<string | null>(null);\r\n\r\n    const currentQuestion = questions[state.currentIndex];\r\n    const progressPercent = ((state.currentIndex) / questions.length) * 100;\r\n\r\n    /**\r\n     * Valida la respuesta seleccionada\r\n     */\r\n    const handleCheck = useCallback(() => {\r\n        if (!selectedOptionId || !currentQuestion) return;\r\n\r\n        const isCorrect = selectedOptionId === (currentQuestion.correctAnswer as any);\r\n\r\n        setState(prev => ({\r\n            ...prev,\r\n            validationState: isCorrect ? 'correct' : 'wrong',\r\n            lives: isCorrect ? prev.lives : Math.max(0, prev.lives - 1),\r\n            answers: [...prev.answers, {\r\n                questionId: currentQuestion.id,\r\n                isCorrect,\r\n                answer: selectedOptionId\r\n            }]\r\n        }));\r\n    }, [selectedOptionId, currentQuestion]);\r\n\r\n    /**\r\n     * Avanza a la siguiente pregunta o finaliza\r\n     */\r\n    const handleContinue = useCallback(() => {\r\n        const isLastQuestion = state.currentIndex === questions.length - 1;\r\n\r\n        if (isLastQuestion) {\r\n            const correctCount = state.answers.filter(a => a.isCorrect).length;\r\n            const score = Math.round((correctCount / questions.length) * 100);\r\n            const stars = score === 100 ? 3 : score > 80 ? 2 : score > 50 ? 1 : 0;\r\n\r\n            onComplete(score, stars);\r\n            return;\r\n        }\r\n\r\n        setState(prev => ({\r\n            ...prev,\r\n            currentIndex: prev.currentIndex + 1,\r\n            validationState: 'idle'\r\n        }));\r\n        setSelectedOptionId(null);\r\n    }, [state.currentIndex, questions.length, state.answers, onComplete]);\r\n\r\n    if (!currentQuestion) return null;\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-black flex flex-col\">\r\n            <LessonHeader\r\n                progress={progressPercent}\r\n                lives={state.lives}\r\n                onExit={onExit}\r\n            />\r\n\r\n            <main className=\"flex-1 flex flex-col justify-center py-20\">\r\n                <QuestionRenderer\r\n                    question={currentQuestion}\r\n                    selectedOptionId={selectedOptionId}\r\n                    onOptionSelect={setSelectedOptionId}\r\n                    disabled={state.validationState !== 'idle'}\r\n                />\r\n            </main>\r\n\r\n            <LessonFooter\r\n                status={state.validationState}\r\n                onCheck={handleCheck}\r\n                onContinue={handleContinue}\r\n                canCheck={selectedOptionId !== null}\r\n                explanation={state.validationState === 'wrong' ? (currentQuestion.explanation || undefined) : undefined}\r\n            />\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\academy\\lesson-player\\LessonPlayer.types.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[791,794],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[791,794],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file LessonPlayer.types.ts\r\n * @description Tipos para el reproductor de lecciones\r\n */\r\n\r\nimport { AcademyLesson, AcademyQuestion } from '@/lib/academy/types/lesson.types';\r\n\r\nexport interface LessonPlayerProps {\r\n    /** Lección a reproducir */\r\n    lesson: AcademyLesson;\r\n    /** Lista de preguntas cargadas */\r\n    questions: AcademyQuestion[];\r\n    /** Callback al finalizar todas las preguntas */\r\n    onComplete: (score: number, stars: number) => void;\r\n    /** Callback para salir de la lección */\r\n    onExit: () => void;\r\n}\r\n\r\nexport interface LessonState {\r\n    /** Índice de la pregunta actual */\r\n    currentIndex: number;\r\n    /** Historial de respuestas del usuario */\r\n    answers: Array<{\r\n        questionId: string;\r\n        isCorrect: boolean;\r\n        answer: any;\r\n    }>;\r\n    /** Vidas restantes */\r\n    lives: number;\r\n    /** Si la lección está finalizada */\r\n    isFinished: boolean;\r\n    /** Estado de validación de la pregunta actual */\r\n    validationState: 'idle' | 'checking' | 'correct' | 'wrong';\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\academy\\lesson-player\\QuestionRenderer.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1558,1561],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1558,1561],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file QuestionRenderer.tsx\r\n * @description Renderiza dinámicamente el tipo de pregunta correspondiente\r\n */\r\n\r\n'use client';\r\n\r\nimport React from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { AcademyQuestion } from '@/lib/academy/types/lesson.types';\r\nimport { cn } from '@/lib/utils';\r\n\r\ninterface QuestionRendererProps {\r\n    question: AcademyQuestion;\r\n    selectedOptionId: string | null;\r\n    onOptionSelect: (optionId: string) => void;\r\n    disabled?: boolean;\r\n}\r\n\r\nexport const QuestionRenderer: React.FC<QuestionRendererProps> = ({\r\n    question,\r\n    selectedOptionId,\r\n    onOptionSelect,\r\n    disabled = false\r\n}) => {\r\n    // Animación para entrada de preguntas\r\n    const variants = {\r\n        enter: { x: 50, opacity: 0 },\r\n        center: { x: 0, opacity: 1 },\r\n        exit: { x: -50, opacity: 0 }\r\n    };\r\n\r\n    return (\r\n        <div className=\"w-full max-w-2xl mx-auto px-6 py-10 flex flex-col items-center\">\r\n            <AnimatePresence mode=\"wait\">\r\n                <motion.div\r\n                    key={question.id}\r\n                    variants={variants}\r\n                    initial=\"enter\"\r\n                    animate=\"center\"\r\n                    exit=\"exit\"\r\n                    transition={{ duration: 0.3, ease: \"easeOut\" }}\r\n                    className=\"w-full\"\r\n                >\r\n                    {/* Enunciado de la pregunta */}\r\n                    <h2 className=\"text-2xl font-bold text-white mb-8 text-center leading-tight\">\r\n                        {(question.question as any).text || \"Pregunta sin texto\"}\r\n                    </h2>\r\n\r\n                    {/* Opciones (Estilo Multiple Choice) */}\r\n                    <div className=\"grid grid-cols-1 gap-3 w-full\">\r\n                        {question.options?.map((option) => (\r\n                            <button\r\n                                key={option.id}\r\n                                onClick={() => !disabled && onOptionSelect(option.id)}\r\n                                disabled={disabled}\r\n                                className={cn(\r\n                                    \"w-full text-left p-4 rounded-2xl border-2 transition-all duration-200\",\r\n                                    \"bg-slate-900/50 backdrop-blur-sm\",\r\n                                    selectedOptionId === option.id\r\n                                        ? \"border-primary bg-primary/10 shadow-[0_0_20px_rgba(14,165,233,0.1)]\"\r\n                                        : \"border-white/5 hover:border-white/20 hover:bg-white/5\",\r\n                                    disabled && selectedOptionId !== option.id && \"opacity-50\"\r\n                                )}\r\n                            >\r\n                                <div className=\"flex items-center gap-4\">\r\n                                    <div className={cn(\r\n                                        \"w-8 h-8 rounded-lg flex items-center justify-center font-bold text-sm border\",\r\n                                        selectedOptionId === option.id\r\n                                            ? \"bg-primary text-white border-primary\"\r\n                                            : \"bg-white/5 text-white/40 border-white/10\"\r\n                                    )}>\r\n                                        {/* Podríamos asignar letras A, B, C, D aquí */}\r\n                                        {String.fromCharCode(65 + (question.options?.indexOf(option) || 0))}\r\n                                    </div>\r\n                                    <span className=\"text-lg font-medium text-white/90\">\r\n                                        {option.text}\r\n                                    </span>\r\n                                </div>\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n\r\n                    {/* Pista (opcional) */}\r\n                    {question.hint && (\r\n                        <motion.div\r\n                            initial={{ opacity: 0 }}\r\n                            animate={{ opacity: 1 }}\r\n                            className=\"mt-8 p-4 rounded-xl bg-amber-400/10 border border-amber-400/20 text-amber-200 text-sm italic text-center\"\r\n                        >\r\n                            💡 Pista: {question.hint}\r\n                        </motion.div>\r\n                    )}\r\n                </motion.div>\r\n            </AnimatePresence>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\academy\\lesson-player\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\academy\\navigation\\AcademyHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\academy\\navigation\\AcademyPublicNavbar.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\academy\\navigation\\AcademyPublicNavbar.tsx:86:9\n  84 |     // Cerrar menú móvil al cambiar de ruta\n  85 |     useEffect(() => {\n> 86 |         setIsMobileMenuOpen(false);\n     |         ^^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  87 |     }, [pathname]);\n  88 |\n  89 |     return (","line":86,"column":9,"nodeType":null,"endLine":86,"endColumn":28}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file AcademyPublicNavbar.tsx\r\n * @description Navbar para las páginas públicas de Red-Salud Academy.\r\n * Diseño profesional y diferenciado del navbar principal de Red-Salud.\r\n * \r\n * @example\r\n * <AcademyPublicNavbar />\r\n */\r\n\r\n'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport Link from 'next/link';\r\nimport { usePathname } from 'next/navigation';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport {\r\n    GraduationCap,\r\n    BookOpen,\r\n    FlaskConical,\r\n    CreditCard,\r\n    Stethoscope,\r\n    Heart,\r\n    Menu,\r\n    X,\r\n    ChevronRight,\r\n    ArrowLeft,\r\n} from 'lucide-react';\r\nimport { cn } from '@/lib/utils';\r\nimport { Button } from \"@red-salud/ui\";\r\n\r\n/** Elementos de navegación del navbar público */\r\nconst NAV_ITEMS = [\r\n    {\r\n        label: 'Cursos',\r\n        href: '/academy/cursos',\r\n        icon: BookOpen,\r\n        description: 'Explora nuestro catálogo de especialidades',\r\n    },\r\n    {\r\n        label: 'Metodología',\r\n        href: '/academy/metodologia',\r\n        icon: FlaskConical,\r\n        description: 'Ciencia del aprendizaje',\r\n    },\r\n    {\r\n        label: 'Para Profesionales',\r\n        href: '/academy/profesionales',\r\n        icon: Stethoscope,\r\n        description: 'Médicos y estudiantes de medicina',\r\n    },\r\n    {\r\n        label: 'Para Pacientes',\r\n        href: '/academy/pacientes',\r\n        icon: Heart,\r\n        description: 'Educación en salud personal',\r\n    },\r\n    {\r\n        label: 'Planes',\r\n        href: '/academy/planes',\r\n        icon: CreditCard,\r\n        description: 'Precios y suscripciones',\r\n    },\r\n];\r\n\r\n/**\r\n * Navbar público de Red-Salud Academy\r\n * Incluye navegación, logo diferenciado y CTAs\r\n */\r\nexport function AcademyPublicNavbar() {\r\n    const pathname = usePathname();\r\n    const [isScrolled, setIsScrolled] = useState(false);\r\n    const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);\r\n\r\n    // Detectar scroll para cambiar estilo del navbar\r\n    useEffect(() => {\r\n        const handleScroll = () => {\r\n            setIsScrolled(window.scrollY > 20);\r\n        };\r\n\r\n        window.addEventListener('scroll', handleScroll);\r\n        return () => window.removeEventListener('scroll', handleScroll);\r\n    }, []);\r\n\r\n    // Cerrar menú móvil al cambiar de ruta\r\n    useEffect(() => {\r\n        setIsMobileMenuOpen(false);\r\n    }, [pathname]);\r\n\r\n    return (\r\n        <>\r\n            <header\r\n                className={cn(\r\n                    'fixed top-0 left-0 right-0 z-50 transition-all duration-300',\r\n                    isScrolled\r\n                        ? 'bg-slate-950/95 backdrop-blur-xl border-b border-white/5 shadow-lg'\r\n                        : 'bg-transparent'\r\n                )}\r\n            >\r\n                <nav className=\"container mx-auto max-w-7xl px-4 sm:px-6\">\r\n                    <div className=\"flex items-center justify-between h-16 md:h-20\">\r\n                        {/* Logo y enlace a Red-Salud */}\r\n                        <div className=\"flex items-center gap-4\">\r\n                            {/* Enlace de vuelta a Red-Salud */}\r\n                            <Link\r\n                                href=\"/\"\r\n                                className=\"hidden md:flex items-center gap-1 text-xs text-white/40 hover:text-white/70 transition-colors\"\r\n                                aria-label=\"Volver a Red-Salud\"\r\n                            >\r\n                                <ArrowLeft className=\"w-3 h-3\" />\r\n                                <span>Red-Salud</span>\r\n                            </Link>\r\n\r\n                            {/* Separador */}\r\n                            <div className=\"hidden md:block w-px h-6 bg-white/10\" />\r\n\r\n                            {/* Logo Academy */}\r\n                            <Link\r\n                                href=\"/academy\"\r\n                                className=\"flex items-center gap-2 group\"\r\n                                aria-label=\"Ir a Academy\"\r\n                            >\r\n                                <div className=\"relative\">\r\n                                    <div className=\"w-9 h-9 rounded-xl bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center shadow-lg shadow-cyan-500/20 group-hover:shadow-cyan-500/40 transition-shadow\">\r\n                                        <GraduationCap className=\"w-5 h-5 text-white\" />\r\n                                    </div>\r\n                                    {/* Efecto de brillo */}\r\n                                    <div className=\"absolute inset-0 rounded-xl bg-gradient-to-br from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity\" />\r\n                                </div>\r\n                                <div className=\"flex flex-col\">\r\n                                    <span className=\"text-white font-bold text-lg tracking-tight\">\r\n                                        Academy\r\n                                    </span>\r\n                                    <span className=\"text-[10px] text-cyan-400/80 font-medium -mt-1 hidden sm:block\">\r\n                                        by Red-Salud\r\n                                    </span>\r\n                                </div>\r\n                            </Link>\r\n                        </div>\r\n\r\n                        {/* Navegación Desktop */}\r\n                        <div className=\"hidden lg:flex items-center gap-1\">\r\n                            {NAV_ITEMS.map((item) => {\r\n                                const isActive = pathname === item.href;\r\n                                return (\r\n                                    <Link\r\n                                        key={item.href}\r\n                                        href={item.href}\r\n                                        className={cn(\r\n                                            'px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200',\r\n                                            isActive\r\n                                                ? 'bg-white/10 text-white'\r\n                                                : 'text-white/60 hover:text-white hover:bg-white/5'\r\n                                        )}\r\n                                    >\r\n                                        {item.label}\r\n                                    </Link>\r\n                                );\r\n                            })}\r\n                        </div>\r\n\r\n                        {/* CTAs Desktop */}\r\n                        <div className=\"hidden md:flex items-center gap-3\">\r\n                            <Link href=\"/login?redirect=/academy/dashboard\">\r\n                                <Button\r\n                                    variant=\"ghost\"\r\n                                    className=\"text-white/70 hover:text-white hover:bg-white/5\"\r\n                                >\r\n                                    Iniciar Sesión\r\n                                </Button>\r\n                            </Link>\r\n                            <Link href=\"/registro?type=patient&redirect=/academy/dashboard\">\r\n                                <Button className=\"bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-400 hover:to-blue-500 text-white shadow-lg shadow-cyan-500/20 hover:shadow-cyan-500/30 transition-all\">\r\n                                    Comenzar Gratis\r\n                                    <ChevronRight className=\"w-4 h-4 ml-1\" />\r\n                                </Button>\r\n                            </Link>\r\n                        </div>\r\n\r\n                        {/* Botón menú móvil */}\r\n                        <button\r\n                            className=\"lg:hidden p-2 text-white/70 hover:text-white transition-colors\"\r\n                            onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}\r\n                            aria-label={isMobileMenuOpen ? 'Cerrar menú' : 'Abrir menú'}\r\n                        >\r\n                            {isMobileMenuOpen ? (\r\n                                <X className=\"w-6 h-6\" />\r\n                            ) : (\r\n                                <Menu className=\"w-6 h-6\" />\r\n                            )}\r\n                        </button>\r\n                    </div>\r\n                </nav>\r\n            </header>\r\n\r\n            {/* Menú Móvil */}\r\n            <AnimatePresence>\r\n                {isMobileMenuOpen && (\r\n                    <motion.div\r\n                        initial={{ opacity: 0, y: -10 }}\r\n                        animate={{ opacity: 1, y: 0 }}\r\n                        exit={{ opacity: 0, y: -10 }}\r\n                        transition={{ duration: 0.2 }}\r\n                        className=\"fixed inset-0 z-40 lg:hidden\"\r\n                    >\r\n                        {/* Overlay */}\r\n                        <div\r\n                            className=\"absolute inset-0 bg-black/80 backdrop-blur-sm\"\r\n                            onClick={() => setIsMobileMenuOpen(false)}\r\n                        />\r\n\r\n                        {/* Panel de navegación */}\r\n                        <motion.nav\r\n                            initial={{ x: '100%' }}\r\n                            animate={{ x: 0 }}\r\n                            exit={{ x: '100%' }}\r\n                            transition={{ type: 'spring', damping: 25, stiffness: 300 }}\r\n                            className=\"absolute top-0 right-0 bottom-0 w-full max-w-sm bg-slate-900 border-l border-white/10 pt-20\"\r\n                        >\r\n                            <div className=\"p-6 space-y-2\">\r\n                                {/* Link a Red-Salud (móvil) */}\r\n                                <Link\r\n                                    href=\"/\"\r\n                                    className=\"flex items-center gap-3 px-4 py-3 rounded-xl text-white/50 hover:text-white hover:bg-white/5 transition-colors\"\r\n                                >\r\n                                    <ArrowLeft className=\"w-5 h-5\" />\r\n                                    <span className=\"font-medium\">Volver a Red-Salud</span>\r\n                                </Link>\r\n\r\n                                <div className=\"h-px bg-white/10 my-4\" />\r\n\r\n                                {/* Items de navegación */}\r\n                                {NAV_ITEMS.map((item) => {\r\n                                    const isActive = pathname === item.href;\r\n                                    return (\r\n                                        <Link\r\n                                            key={item.href}\r\n                                            href={item.href}\r\n                                            className={cn(\r\n                                                'flex items-center gap-3 px-4 py-3 rounded-xl transition-colors',\r\n                                                isActive\r\n                                                    ? 'bg-cyan-500/10 text-cyan-400'\r\n                                                    : 'text-white/70 hover:text-white hover:bg-white/5'\r\n                                            )}\r\n                                        >\r\n                                            <item.icon className=\"w-5 h-5\" />\r\n                                            <div>\r\n                                                <div className=\"font-medium\">{item.label}</div>\r\n                                                <div className=\"text-xs text-white/40\">\r\n                                                    {item.description}\r\n                                                </div>\r\n                                            </div>\r\n                                        </Link>\r\n                                    );\r\n                                })}\r\n\r\n                                <div className=\"h-px bg-white/10 my-4\" />\r\n\r\n                                {/* CTAs móvil */}\r\n                                <div className=\"space-y-3 px-4\">\r\n                                    <Link\r\n                                        href=\"/registro?type=patient&redirect=/academy/dashboard\"\r\n                                        className=\"block\"\r\n                                    >\r\n                                        <Button className=\"w-full bg-gradient-to-r from-cyan-500 to-blue-600 text-white shadow-lg shadow-cyan-500/20\">\r\n                                            Comenzar Gratis\r\n                                        </Button>\r\n                                    </Link>\r\n                                    <Link\r\n                                        href=\"/login?redirect=/academy/dashboard\"\r\n                                        className=\"block\"\r\n                                    >\r\n                                        <Button variant=\"outline\" className=\"w-full border-white/20 text-white hover:bg-white/5\">\r\n                                            Iniciar Sesión\r\n                                        </Button>\r\n                                    </Link>\r\n                                </div>\r\n                            </div>\r\n                        </motion.nav>\r\n                    </motion.div>\r\n                )}\r\n            </AnimatePresence>\r\n\r\n            {/* Spacer para compensar el navbar fixed */}\r\n            <div className=\"h-16 md:h-20\" />\r\n        </>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\academy\\navigation\\AcademySidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\academy\\navigation\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\academy\\skill-tree\\LessonNode.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\academy\\skill-tree\\SkillTree.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'motion' is defined but never used.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'specialtyId' is defined but never used.","line":21,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file SkillTree.tsx\r\n * @description Componente principal de la ruta de aprendizaje de la Academia\r\n */\r\n\r\n'use client';\r\n\r\nimport React from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { ArrowLeft, Settings, Info, BookOpen, Trophy, Star } from 'lucide-react';\r\nimport Link from 'next/link';\r\nimport { cn } from '@/lib/utils';\r\nimport { SkillTreeProps } from './SkillTree.types';\r\nimport { UnitSection } from './UnitSection';\r\n\r\n/**\r\n * Componente SkillTree\r\n * Orquesta la visualización de niveles y unidades.\r\n */\r\nexport const SkillTree: React.FC<SkillTreeProps> = ({\r\n    specialtyId,\r\n    specialtyName,\r\n    color,\r\n    units,\r\n    className\r\n}) => {\r\n    return (\r\n        <div className={cn(\"min-h-screen bg-black text-white selection:bg-primary/30\", className)}>\r\n            {/* Header Sticky Persistente */}\r\n            <header className=\"sticky top-0 z-50 bg-black/80 backdrop-blur-xl border-b border-white/5 px-6 py-4 flex items-center justify-between\">\r\n                <div className=\"flex items-center gap-4\">\r\n                    <Link href=\"/academy\" className=\"p-2 hover:bg-white/5 rounded-full transition-colors\">\r\n                        <ArrowLeft className=\"w-6 h-6\" />\r\n                    </Link>\r\n                    <div>\r\n                        <h1 className=\"text-lg font-bold leading-none\">{specialtyName}</h1>\r\n                        <p className=\"text-xs text-white/40 mt-1 uppercase tracking-wider font-semibold\">Mapa de Aprendizaje</p>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-2\">\r\n                    <button className=\"p-2 hover:bg-white/5 rounded-full transition-colors\">\r\n                        <Info className=\"w-5 h-5 text-white/60\" />\r\n                    </button>\r\n                    <button className=\"p-2 hover:bg-white/5 rounded-full transition-colors\">\r\n                        <Settings className=\"w-5 h-5 text-white/60\" />\r\n                    </button>\r\n                </div>\r\n            </header>\r\n\r\n            {/* Contenedor del Mapa */}\r\n            <main className=\"max-w-2xl mx-auto pt-10 pb-32 px-4 relative\">\r\n                {/* Decoraciones de fondo */}\r\n                <div\r\n                    className=\"fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] rounded-full blur-[160px] opacity-[0.08] pointer-events-none\"\r\n                    style={{ backgroundColor: color }}\r\n                />\r\n\r\n                {/* Renderizado de Secciones por Unidad */}\r\n                <div className=\"relative z-10 flex flex-col items-center\">\r\n                    {units.length > 0 ? (\r\n                        units.map((unit) => (\r\n                            <UnitSection\r\n                                key={unit.id}\r\n                                unit={unit}\r\n                                accentColor={color}\r\n                            />\r\n                        ))\r\n                    ) : (\r\n                        <div className=\"py-20 text-center\">\r\n                            <p className=\"text-white/40 italic\">Cargando material educativo...</p>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </main>\r\n\r\n            {/* Navigation Bar Inferior (Mockup para Dashboard) */}\r\n            <nav className=\"fixed bottom-0 left-0 right-0 z-50 bg-black/90 backdrop-blur-2xl border-t border-white/5 px-6 py-4\">\r\n                <div className=\"max-w-md mx-auto flex items-center justify-around\">\r\n                    {/* Aquí irían iconos de Home, Ligas, Shop, Perfil */}\r\n                    <div className=\"flex flex-col items-center gap-1 text-primary\">\r\n                        <div className=\"p-2 bg-primary/10 rounded-xl\">\r\n                            <BookOpen className=\"w-6 h-6\" />\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"flex flex-col items-center gap-1 text-white/40\">\r\n                        <div className=\"p-2 hover:bg-white/5 rounded-xl transition-colors\">\r\n                            <Trophy className=\"w-6 h-6\" />\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"flex flex-col items-center gap-1 text-white/40\">\r\n                        <div className=\"p-2 hover:bg-white/5 rounded-xl transition-colors\">\r\n                            <Star className=\"w-6 h-6\" />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </nav>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\academy\\skill-tree\\SkillTree.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\academy\\skill-tree\\UnitSection.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Star' is defined but never used.","line":10,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":32},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":68,"column":25,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[2859,2886],"text":"\r\n                        &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[2859,2886],"text":"\r\n                        &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[2859,2886],"text":"\r\n                        &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[2859,2886],"text":"\r\n                        &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":68,"column":44,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[2904,2927],"text":"&quot;\r\n                    "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[2904,2927],"text":"&ldquo;\r\n                    "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[2904,2927],"text":"&#34;\r\n                    "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[2904,2927],"text":"&rdquo;\r\n                    "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file UnitSection.tsx\r\n * @description Sección que agrupa lecciones por unidad en el Skill Tree\r\n */\r\n\r\n'use client';\r\n\r\nimport React from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { Trophy, BookOpen, Star } from 'lucide-react';\r\nimport { cn } from '@/lib/utils';\r\nimport { UnitSectionProps } from './SkillTree.types';\r\nimport { LessonNode } from './LessonNode';\r\n\r\n/**\r\n * Componente UnitSection\r\n * Renderiza el encabezado de la unidad y el camino de lecciones.\r\n */\r\nexport const UnitSection: React.FC<UnitSectionProps> = ({\r\n    unit,\r\n    accentColor\r\n}) => {\r\n    // Patrón de zig-zag para los nodos de lecciones\r\n    const getOffset = (index: number) => {\r\n        const sequence = [0, 45, 75, 45, 0, -45, -75, -45];\r\n        return sequence[index % sequence.length];\r\n    };\r\n\r\n    return (\r\n        <div className=\"w-full flex flex-col items-center mb-16 relative\">\r\n            {/* Header de la Unidad */}\r\n            <motion.div\r\n                initial={{ opacity: 0, y: 30 }}\r\n                whileInView={{ opacity: 1, y: 0 }}\r\n                viewport={{ once: true }}\r\n                className={cn(\r\n                    \"w-full max-w-md px-6 py-8 rounded-3xl mb-12 relative overflow-hidden\",\r\n                    \"bg-gradient-to-br from-slate-900/90 to-slate-950 border border-white/10 shadow-2xl backdrop-blur-md\"\r\n                )}\r\n            >\r\n                {/* Decoración de fondo */}\r\n                <div\r\n                    className=\"absolute -right-10 -top-10 w-40 h-40 rounded-full blur-[80px] opacity-20\"\r\n                    style={{ backgroundColor: accentColor }}\r\n                />\r\n\r\n                <div className=\"relative z-10\">\r\n                    <div className=\"flex items-center justify-between mb-4\">\r\n                        <span className=\"text-xs font-bold uppercase tracking-[0.2em] text-white/50\">\r\n                            Unidad {unit.orderIndex}\r\n                        </span>\r\n                        <div className=\"flex items-center gap-1.5 bg-white/5 px-2.5 py-1 rounded-full border border-white/10\">\r\n                            {unit.isCheckpoint ? (\r\n                                <Trophy className=\"w-3.5 h-3.5 text-amber-400\" />\r\n                            ) : (\r\n                                <BookOpen className=\"w-3.5 h-3.5 text-white/60\" />\r\n                            )}\r\n                            <span className=\"text-xs font-medium text-white/80\">\r\n                                {unit.estimatedMinutes} min\r\n                            </span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <h3 className=\"text-2xl font-bold text-white mb-2 leading-tight\">\r\n                        {unit.name}\r\n                    </h3>\r\n                    <p className=\"text-white/60 text-sm leading-relaxed mb-6 italic\">\r\n                        \"{unit.description}\"\r\n                    </p>\r\n\r\n                    {/* Guía visual del camino si la unidad no está bloqueada */}\r\n                    {!unit.isLocked && (\r\n                        <button className=\"w-full py-3 bg-white text-slate-950 font-bold rounded-xl active:scale-95 transition-transform\">\r\n                            CONTINUAR\r\n                        </button>\r\n                    )}\r\n                </div>\r\n            </motion.div>\r\n\r\n            {/* Lista de Lecciones en camino */}\r\n            <div className=\"flex flex-col items-center gap-8 w-full\">\r\n                {unit.lessons.map((lesson, index) => (\r\n                    <React.Fragment key={lesson.id}>\r\n                        <LessonNode\r\n                            lesson={lesson}\r\n                            accentColor={accentColor}\r\n                            offset={getOffset(index)}\r\n                            isActive={!unit.isLocked && lesson.status === 'in_progress'}\r\n                        />\r\n                        {/* Conector visual (opcional: podrías añadir un SVG curvo aquí en el futuro) */}\r\n                    </React.Fragment>\r\n                ))}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\academy\\skill-tree\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\auth\\google-signin-button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\auth\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\auth\\login-form.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cn' is defined but never used.","line":25,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":12}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, Suspense } from \"react\";\r\nimport { useForm } from \"react-hook-form\";\r\nimport { zodResolver } from \"@hookform/resolvers/zod\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport Link from \"next/link\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { Mail, Lock, Eye, EyeOff, Loader2, ArrowLeft } from \"lucide-react\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { Label } from \"@red-salud/ui\";\r\nimport { Card, CardContent } from \"@red-salud/ui\";\r\nimport { loginSchema, type LoginFormData } from \"@/lib/validations/auth\";\r\nimport { signIn, signOut } from \"@/lib/supabase/auth\";\r\nimport { useRateLimit } from \"@/hooks/auth/use-rate-limit\";\r\nimport { useOAuthErrors } from \"@/hooks/auth/use-oauth-errors\";\r\nimport { useOAuthSignIn } from \"@/hooks/auth/use-oauth-signin\";\r\nimport { RememberMeCheckbox } from \"@/components/auth/remember-me-checkbox\";\r\nimport { GoogleSignInButton } from \"@/components/auth/google-signin-button\";\r\nimport { validateUserRole } from \"@/lib/auth/role-validator\";\r\nimport { type UserRole } from \"@/lib/constants\";\r\nimport { sessionManager } from \"@/lib/security/session-manager\";\r\nimport { Logo } from \"@red-salud/ui\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\ninterface LoginFormProps {\r\n  role: UserRole;\r\n  roleLabel: string;\r\n}\r\n\r\nfunction LoginFormContent({ role, roleLabel }: LoginFormProps) {\r\n  const router = useRouter();\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [rememberMe, setRememberMe] = useState(false);\r\n\r\n  // Hooks personalizados\r\n  const { checkRateLimit, recordFailedAttempt, resetAttempts } = useRateLimit();\r\n  const { signInWithGoogle, isLoading: isOAuthLoading } = useOAuthSignIn({\r\n    role,\r\n    mode: \"login\",\r\n    onError: setError,\r\n    rememberMe, // Pasar rememberMe al hook de OAuth\r\n  });\r\n  useOAuthErrors(setError);\r\n\r\n  const {\r\n    register,\r\n    handleSubmit,\r\n    formState: { errors },\r\n  } = useForm<LoginFormData>({\r\n    resolver: zodResolver(loginSchema),\r\n  });\r\n\r\n  // Helper para fingerprinting\r\n  const getDeviceFingerprint = async (): Promise<string> => {\r\n    if (typeof window === \"undefined\") return \"\";\r\n    const data = [\r\n      navigator.userAgent,\r\n      navigator.language,\r\n      screen.width,\r\n      screen.height,\r\n      new Date().getTimezoneOffset(),\r\n    ].join(\"|\");\r\n    return btoa(data);\r\n  };\r\n\r\n  const onSubmit = async (data: LoginFormData) => {\r\n    const rateLimitCheck = checkRateLimit();\r\n    if (!rateLimitCheck.allowed) {\r\n      setError(rateLimitCheck.message!);\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    setError(null);\r\n\r\n    const result = await signIn(data);\r\n\r\n    if (!result.success || !result.user) {\r\n      recordFailedAttempt();\r\n      setError(result.error || \"Error al iniciar sesión\");\r\n      setIsLoading(false);\r\n      return;\r\n    }\r\n\r\n    resetAttempts();\r\n    const userRole = result.user.user_metadata?.role || \"paciente\";\r\n\r\n    // Validar que el rol del usuario coincida con el rol de la página\r\n    const validation = validateUserRole(userRole, role);\r\n    if (!validation.isValid) {\r\n      setError(validation.errorMessage!);\r\n      setIsLoading(false);\r\n      // Cerrar sesión automáticamente\r\n      await signOut();\r\n      return;\r\n    }\r\n\r\n    // Configurar sesión con preferencias de seguridad\r\n    await sessionManager.setupSession({\r\n      rememberMe,\r\n      role: userRole,\r\n      deviceFingerprint: await getDeviceFingerprint(),\r\n    });\r\n\r\n    router.push(`/dashboard/${userRole}`);\r\n  };\r\n\r\n  return (\r\n    <div className=\"h-screen bg-background relative overflow-hidden flex flex-col\">\r\n      {/* Background Elements */}\r\n      <div className=\"absolute inset-0 z-0 overflow-hidden pointer-events-none\">\r\n        <div className=\"absolute -top-[20%] -left-[10%] w-[50%] h-[50%] rounded-full bg-primary/5 blur-[100px] animate-blob\" />\r\n        <div className=\"absolute top-[20%] -right-[10%] w-[40%] h-[40%] rounded-full bg-secondary/5 blur-[100px] animate-blob animation-delay-2000\" />\r\n        <div className=\"absolute -bottom-[20%] left-[20%] w-[40%] h-[40%] rounded-full bg-accent/10 blur-[100px] animate-blob animation-delay-4000\" />\r\n      </div>\r\n\r\n      {/* Header bar with Back button and Logo */}\r\n      <div className=\"relative z-10 px-4 pt-4 pb-2 shrink-0 flex items-center justify-between\">\r\n        <Link\r\n          href=\"/login\"\r\n          className=\"inline-flex items-center gap-2 text-muted-foreground hover:text-primary transition-colors group px-3 py-1.5 rounded-full hover:bg-muted/50 relative z-20\"\r\n        >\r\n          <ArrowLeft className=\"w-4 h-4 group-hover:-translate-x-1 transition-transform\" />\r\n          <span className=\"text-xs sm:text-sm font-medium\">Cambiar tipo de cuenta</span>\r\n        </Link>\r\n\r\n        {/* Centered Logo */}\r\n        <div className=\"absolute inset-0 flex items-center justify-center pointer-events-none pt-2\">\r\n          <Logo size=\"md\" showIcon className=\"pointer-events-auto\" />\r\n        </div>\r\n      </div>\r\n\r\n      {/* Contenedor centrado */}\r\n      <div className=\"flex-1 flex items-center justify-center px-4 relative z-10 overflow-y-auto py-4\">\r\n        <div className=\"w-full max-w-md\">\r\n          <motion.div\r\n            initial={{ opacity: 0, scale: 0.95 }}\r\n            animate={{ opacity: 1, scale: 1 }}\r\n            transition={{ duration: 0.3 }}\r\n          >\r\n            {/* Título */}\r\n            <div className=\"text-center mb-6 space-y-1\">\r\n              <h1 className=\"text-2xl sm:text-3xl font-bold tracking-tight text-foreground\">\r\n                Bienvenido de vuelta\r\n              </h1>\r\n              <p className=\"text-muted-foreground text-xs sm:text-sm\">\r\n                Inicia sesión como <span className=\"font-semibold text-primary\">{roleLabel}</span>\r\n              </p>\r\n            </div>\r\n\r\n            {/* Card del formulario */}\r\n            <Card className=\"border shadow-glow bg-card/50 backdrop-blur-sm overflow-hidden\">\r\n              <CardContent className=\"p-5 sm:p-6\">\r\n                <AnimatePresence mode=\"wait\">\r\n                  {error && (\r\n                    <motion.div\r\n                      key=\"error-message\"\r\n                      initial={{ opacity: 0, height: 0 }}\r\n                      animate={{ opacity: 1, height: \"auto\" }}\r\n                      exit={{ opacity: 0, height: 0 }}\r\n                      className=\"mb-4 p-2.5 rounded-lg bg-destructive/10 border border-destructive/20 text-destructive text-xs sm:text-sm flex items-center gap-2\"\r\n                    >\r\n                      <div className=\"w-1.5 h-1.5 rounded-full bg-destructive shrink-0\" />\r\n                      {error}\r\n                    </motion.div>\r\n                  )}\r\n                </AnimatePresence>\r\n\r\n                {/* OAuth Google */}\r\n                <div className=\"mb-4\">\r\n                  <GoogleSignInButton\r\n                    onClick={signInWithGoogle}\r\n                    disabled={isLoading || isOAuthLoading}\r\n                    mode=\"login\"\r\n                  />\r\n                </div>\r\n\r\n                <div className=\"relative mb-4\">\r\n                  <div className=\"absolute inset-0 flex items-center\">\r\n                    <div className=\"w-full border-t border-border\" />\r\n                  </div>\r\n                  <div className=\"relative flex justify-center text-xs sm:text-sm\">\r\n                    <span className=\"bg-card px-2 text-muted-foreground\">\r\n                      O continúa con tu email\r\n                    </span>\r\n                  </div>\r\n                </div>\r\n\r\n                <form onSubmit={handleSubmit(onSubmit)} className=\"space-y-3\">\r\n                  <div className=\"space-y-1.5\">\r\n                    <Label htmlFor=\"email\" className=\"text-foreground/80 text-xs sm:text-sm\">Correo electrónico</Label>\r\n                    <div className=\"relative group\">\r\n                      <Mail className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 sm:h-5 sm:w-5 text-muted-foreground group-focus-within:text-primary transition-colors\" />\r\n                      <Input\r\n                        id=\"email\"\r\n                        type=\"email\"\r\n                        placeholder=\"tu@email.com\"\r\n                        className=\"pl-9 sm:pl-10 h-10 sm:h-11 bg-background/50 focus:bg-background transition-all text-sm\"\r\n                        {...register(\"email\")}\r\n                        disabled={isLoading}\r\n                      />\r\n                    </div>\r\n                    {errors.email && (\r\n                      <p className=\"text-xs text-destructive mt-1 font-medium\">\r\n                        {errors.email.message}\r\n                      </p>\r\n                    )}\r\n                  </div>\r\n\r\n                  <div className=\"space-y-1.5\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <Label htmlFor=\"password\" className=\"text-foreground/80 text-xs sm:text-sm\">Contraseña</Label>\r\n                      <Link\r\n                        href=\"/forgot-password\"\r\n                        className=\"text-[10px] sm:text-xs font-medium text-primary hover:text-primary/80 hover:underline transition-all\"\r\n                      >\r\n                        ¿Olvidaste tu contraseña?\r\n                      </Link>\r\n                    </div>\r\n                    <div className=\"relative group\">\r\n                      <Lock className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 sm:h-5 sm:w-5 text-muted-foreground group-focus-within:text-primary transition-colors\" />\r\n                      <Input\r\n                        id=\"password\"\r\n                        type={showPassword ? \"text\" : \"password\"}\r\n                        placeholder=\"••••••••\"\r\n                        className=\"pl-9 sm:pl-10 pr-10 h-10 sm:h-11 bg-background/50 focus:bg-background transition-all text-sm\"\r\n                        {...register(\"password\")}\r\n                        disabled={isLoading}\r\n                      />\r\n                      <button\r\n                        type=\"button\"\r\n                        onClick={() => setShowPassword(!showPassword)}\r\n                        className=\"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors p-1\"\r\n                        disabled={isLoading}\r\n                      >\r\n                        {showPassword ? (\r\n                          <EyeOff className=\"h-4 w-4 sm:h-5 sm:w-5\" />\r\n                        ) : (\r\n                          <Eye className=\"h-4 w-4 sm:h-5 sm:w-5\" />\r\n                        )}\r\n                      </button>\r\n                    </div>\r\n                    {errors.password && (\r\n                      <p className=\"text-xs text-destructive mt-1 font-medium\">\r\n                        {errors.password.message}\r\n                      </p>\r\n                    )}\r\n                  </div>\r\n\r\n                  <div className=\"pt-1\">\r\n                    <RememberMeCheckbox\r\n                      checked={rememberMe}\r\n                      onCheckedChange={setRememberMe}\r\n                      role={role}\r\n                    />\r\n                  </div>\r\n\r\n                  <Button\r\n                    type=\"submit\"\r\n                    size=\"lg\"\r\n                    className=\"w-full h-10 sm:h-11 text-sm sm:text-base shadow-lg shadow-primary/20 hover:shadow-primary/30 transition-all duration-300\"\r\n                    disabled={isLoading}\r\n                  >\r\n                    {isLoading ? (\r\n                      <>\r\n                        <Loader2 className=\"mr-2 h-4 w-4 sm:h-5 sm:w-5 animate-spin\" />\r\n                        Iniciando sesión...\r\n                      </>\r\n                    ) : (\r\n                      \"Iniciar Sesión\"\r\n                    )}\r\n                  </Button>\r\n                </form>\r\n\r\n                <p className=\"mt-5 sm:mt-6 text-center text-xs sm:text-sm text-muted-foreground\">\r\n                  ¿No tienes cuenta?{\" \"}\r\n                  <Link\r\n                    href={`/register/${role}`}\r\n                    className=\"font-semibold text-primary hover:text-primary/80 hover:underline transition-all\"\r\n                  >\r\n                    Regístrate aquí\r\n                  </Link>\r\n                </p>\r\n              </CardContent>\r\n            </Card>\r\n          </motion.div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport function LoginForm(props: LoginFormProps) {\r\n  return (\r\n    <Suspense fallback={\r\n      <div className=\"h-screen w-full bg-background flex items-center justify-center\">\r\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\r\n      </div>\r\n    }>\r\n      <LoginFormContent {...props} />\r\n    </Suspense>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\auth\\register-form-v2.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cn' is defined but never used.","line":28,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":12}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, Suspense, useCallback } from \"react\";\r\nimport { useForm } from \"react-hook-form\";\r\nimport { zodResolver } from \"@hookform/resolvers/zod\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport Link from \"next/link\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport {\r\n  ArrowLeft,\r\n  Mail,\r\n  Lock,\r\n  Eye,\r\n  EyeOff,\r\n  User,\r\n  Loader2,\r\n  ChevronLeft,\r\n  Stethoscope\r\n} from \"lucide-react\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { Label } from \"@red-salud/ui\";\r\nimport { APP_NAME, ROUTES } from \"@/lib/constants\";\r\nimport { registerSchema, type RegisterFormData } from \"@/lib/validations/auth\";\r\nimport { signUp, signIn, type UserRole } from \"@/lib/supabase/auth\";\r\nimport { useOAuthErrors } from \"@/hooks/auth/use-oauth-errors\";\r\nimport { useOAuthSignIn } from \"@/hooks/auth/use-oauth-signin\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\ninterface RegisterFormProps {\r\n  role: UserRole;\r\n  roleLabel: string;\r\n}\r\n\r\n// Animation variants - smooth and performant\r\nconst fadeIn = {\r\n  initial: { opacity: 0, scale: 0.98 },\r\n  animate: { opacity: 1, scale: 1, transition: { duration: 0.25, ease: [0.25, 0.1, 0.25, 1] as const } },\r\n  exit: { opacity: 0, scale: 0.98, transition: { duration: 0.2 } },\r\n};\r\n\r\nconst slideIn = {\r\n  initial: { opacity: 0, x: 20 },\r\n  animate: { opacity: 1, x: 0, transition: { duration: 0.3, ease: [0.25, 0.1, 0.25, 1] as const } },\r\n  exit: { opacity: 0, x: -20, transition: { duration: 0.2 } },\r\n};\r\n\r\n// Google Icon SVG\r\nfunction GoogleIcon({ className }: { className?: string }) {\r\n  return (\r\n    <svg className={className} viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n      <path d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\" fill=\"#4285F4\" />\r\n      <path d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\" fill=\"#34A853\" />\r\n      <path d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\" fill=\"#FBBC05\" />\r\n      <path d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\" fill=\"#EA4335\" />\r\n    </svg>\r\n  );\r\n}\r\n\r\ntype AuthStep = \"choose\" | \"email-form\";\r\n\r\nfunction RegisterFormContent({ role, roleLabel }: RegisterFormProps) {\r\n  const router = useRouter();\r\n  const [step, setStep] = useState<AuthStep>(\"choose\");\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const { signInWithGoogle, isLoading: isOAuthLoading } = useOAuthSignIn({\r\n    role,\r\n    mode: \"register\",\r\n    onError: setError,\r\n    rememberMe: true,\r\n  });\r\n  useOAuthErrors(setError);\r\n\r\n  const {\r\n    register,\r\n    handleSubmit,\r\n    formState: { errors },\r\n  } = useForm<RegisterFormData>({\r\n    resolver: zodResolver(registerSchema),\r\n  });\r\n\r\n  const onSubmit = async (data: RegisterFormData) => {\r\n    setIsLoading(true);\r\n    setError(null);\r\n\r\n    const signUpResult = await signUp({ ...data, role });\r\n\r\n    if (!signUpResult.success || !signUpResult.user) {\r\n      setError(signUpResult.error || \"Error al registrar usuario\");\r\n      setIsLoading(false);\r\n      return;\r\n    }\r\n\r\n    const signInResult = await signIn({\r\n      email: data.email,\r\n      password: data.password,\r\n    });\r\n\r\n    if (!signInResult.success) {\r\n      router.push(`/login/${role}`);\r\n      return;\r\n    }\r\n\r\n    router.push(`/dashboard/${role}`);\r\n  };\r\n\r\n  const handleEmailClick = useCallback(() => {\r\n    setStep(\"email-form\");\r\n    setError(null);\r\n  }, []);\r\n\r\n  const handleBack = useCallback(() => {\r\n    setStep(\"choose\");\r\n    setError(null);\r\n  }, []);\r\n\r\n  const isSubmitting = isLoading || isOAuthLoading;\r\n\r\n  return (\r\n    <div className=\"h-dvh h-screen bg-[#0f0f0f] flex flex-col overflow-hidden\">\r\n      {/* Header - Minimal, always visible */}\r\n      <header className=\"shrink-0 px-4 py-3 flex items-center justify-between\">\r\n        <Link\r\n          href=\"/register\"\r\n          className=\"inline-flex items-center gap-1.5 text-sm text-neutral-500 hover:text-neutral-300 transition-colors cursor-pointer group\"\r\n        >\r\n          <ArrowLeft className=\"h-4 w-4 group-hover:-translate-x-0.5 transition-transform\" />\r\n          <span className=\"hidden sm:inline\">Cambiar tipo</span>\r\n        </Link>\r\n\r\n        <Link href={ROUTES.HOME} className=\"cursor-pointer\">\r\n          <span className=\"font-semibold text-lg text-primary hover:text-primary/80 transition-colors\">\r\n            {APP_NAME}\r\n          </span>\r\n        </Link>\r\n      </header>\r\n\r\n      {/* Main content - Centered, no scroll */}\r\n      <main className=\"flex-1 flex items-center justify-center px-4 py-4 overflow-hidden\">\r\n        <div className=\"w-full max-w-sm\">\r\n          {/* Card */}\r\n          <div className=\"bg-[#1a1a1a] rounded-2xl border border-neutral-800 p-6 sm:p-8\">\r\n            <AnimatePresence mode=\"wait\">\r\n              {step === \"choose\" ? (\r\n                <motion.div\r\n                  key=\"choose\"\r\n                  variants={fadeIn}\r\n                  initial=\"initial\"\r\n                  animate=\"animate\"\r\n                  exit=\"exit\"\r\n                  className=\"flex flex-col\"\r\n                >\r\n                  {/* Logo & Title */}\r\n                  <div className=\"text-center mb-6\">\r\n                    <div className=\"inline-flex items-center justify-center w-14 h-14 rounded-xl bg-gradient-to-br from-primary/20 to-cyan-500/20 border border-primary/30 mb-4\">\r\n                      <Stethoscope className=\"w-7 h-7 text-primary\" />\r\n                    </div>\r\n                    <h1 className=\"text-xl sm:text-2xl font-semibold text-white mb-1\">\r\n                      Registro de {roleLabel}\r\n                    </h1>\r\n                    <p className=\"text-sm text-neutral-500\">\r\n                      Únete a la red de profesionales\r\n                    </p>\r\n                  </div>\r\n\r\n                  {/* Error Message */}\r\n                  <AnimatePresence mode=\"wait\">\r\n                    {error && (\r\n                      <motion.div\r\n                        key=\"error\"\r\n                        initial={{ opacity: 0, height: 0 }}\r\n                        animate={{ opacity: 1, height: \"auto\" }}\r\n                        exit={{ opacity: 0, height: 0 }}\r\n                        className=\"mb-4 p-3 rounded-xl bg-red-500/10 border border-red-500/20 text-red-400 text-sm text-center\"\r\n                      >\r\n                        {error}\r\n                      </motion.div>\r\n                    )}\r\n                  </AnimatePresence>\r\n\r\n                  {/* Google Button - Primary */}\r\n                  <Button\r\n                    type=\"button\"\r\n                    onClick={signInWithGoogle}\r\n                    disabled={isSubmitting}\r\n                    className=\"w-full h-12 bg-neutral-800 hover:bg-neutral-700 text-white border border-neutral-700 rounded-xl font-medium text-sm flex items-center justify-center gap-3 transition-all cursor-pointer\"\r\n                  >\r\n                    {isOAuthLoading ? (\r\n                      <Loader2 className=\"h-5 w-5 animate-spin\" />\r\n                    ) : (\r\n                      <>\r\n                        <GoogleIcon className=\"h-5 w-5\" />\r\n                        <span>Continuar con Google</span>\r\n                      </>\r\n                    )}\r\n                  </Button>\r\n\r\n                  {/* Divider */}\r\n                  <div className=\"flex items-center gap-3 my-5\">\r\n                    <div className=\"flex-1 h-px bg-neutral-800\" />\r\n                    <span className=\"text-xs text-neutral-600 font-medium\">o</span>\r\n                    <div className=\"flex-1 h-px bg-neutral-800\" />\r\n                  </div>\r\n\r\n                  {/* Email Button - Secondary */}\r\n                  <Button\r\n                    type=\"button\"\r\n                    onClick={handleEmailClick}\r\n                    disabled={isSubmitting}\r\n                    variant=\"outline\"\r\n                    className=\"w-full h-12 bg-transparent hover:bg-neutral-800/50 text-neutral-300 border border-neutral-700 rounded-xl font-medium text-sm flex items-center justify-center gap-3 transition-all cursor-pointer\"\r\n                  >\r\n                    <Mail className=\"h-5 w-5\" />\r\n                    <span>Continuar con Email</span>\r\n                  </Button>\r\n\r\n                  {/* Already have account */}\r\n                  <p className=\"mt-6 text-center text-sm text-neutral-500\">\r\n                    ¿Ya tienes cuenta?{\" \"}\r\n                    <Link href=\"/login\" className=\"text-primary hover:text-primary/80 font-medium cursor-pointer\">\r\n                      Inicia sesión\r\n                    </Link>\r\n                  </p>\r\n                </motion.div>\r\n              ) : (\r\n                <motion.div\r\n                  key=\"email-form\"\r\n                  variants={slideIn}\r\n                  initial=\"initial\"\r\n                  animate=\"animate\"\r\n                  exit=\"exit\"\r\n                  className=\"flex flex-col\"\r\n                >\r\n                  {/* Back button + Title */}\r\n                  <div className=\"flex items-center gap-3 mb-5\">\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={handleBack}\r\n                      className=\"p-2 -ml-2 rounded-lg hover:bg-neutral-800 text-neutral-400 hover:text-white transition-colors cursor-pointer\"\r\n                      aria-label=\"Volver\"\r\n                    >\r\n                      <ChevronLeft className=\"h-5 w-5\" />\r\n                    </button>\r\n                    <div>\r\n                      <h2 className=\"text-lg font-semibold text-white\">Crear cuenta</h2>\r\n                      <p className=\"text-xs text-neutral-500\">Completa tus datos</p>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Error Message */}\r\n                  <AnimatePresence mode=\"wait\">\r\n                    {error && (\r\n                      <motion.div\r\n                        key=\"error\"\r\n                        initial={{ opacity: 0, height: 0 }}\r\n                        animate={{ opacity: 1, height: \"auto\" }}\r\n                        exit={{ opacity: 0, height: 0 }}\r\n                        className=\"mb-4 p-3 rounded-xl bg-red-500/10 border border-red-500/20 text-red-400 text-sm\"\r\n                      >\r\n                        {error}\r\n                      </motion.div>\r\n                    )}\r\n                  </AnimatePresence>\r\n\r\n                  {/* Form - Compact */}\r\n                  <form onSubmit={handleSubmit(onSubmit)} className=\"space-y-3\">\r\n                    {/* Full Name */}\r\n                    <div className=\"space-y-1.5\">\r\n                      <Label htmlFor=\"fullName\" className=\"text-sm font-medium text-neutral-400\">\r\n                        Nombre completo\r\n                      </Label>\r\n                      <div className=\"relative\">\r\n                        <User className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-neutral-600\" />\r\n                        <Input\r\n                          id=\"fullName\"\r\n                          type=\"text\"\r\n                          placeholder=\"Dr. Juan Pérez\"\r\n                          autoComplete=\"name\"\r\n                          className=\"pl-10 h-11 bg-neutral-900 border-neutral-800 text-white placeholder:text-neutral-600 focus:border-primary focus:ring-1 focus:ring-primary/20 rounded-xl\"\r\n                          {...register(\"fullName\")}\r\n                          disabled={isSubmitting}\r\n                        />\r\n                      </div>\r\n                      {errors.fullName && (\r\n                        <p className=\"text-xs text-red-400\">{errors.fullName.message}</p>\r\n                      )}\r\n                    </div>\r\n\r\n                    {/* Email */}\r\n                    <div className=\"space-y-1.5\">\r\n                      <Label htmlFor=\"email\" className=\"text-sm font-medium text-neutral-400\">\r\n                        Correo electrónico\r\n                      </Label>\r\n                      <div className=\"relative\">\r\n                        <Mail className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-neutral-600\" />\r\n                        <Input\r\n                          id=\"email\"\r\n                          type=\"email\"\r\n                          inputMode=\"email\"\r\n                          autoComplete=\"email\"\r\n                          placeholder=\"tu@email.com\"\r\n                          className=\"pl-10 h-11 bg-neutral-900 border-neutral-800 text-white placeholder:text-neutral-600 focus:border-primary focus:ring-1 focus:ring-primary/20 rounded-xl\"\r\n                          {...register(\"email\")}\r\n                          disabled={isSubmitting}\r\n                        />\r\n                      </div>\r\n                      {errors.email && (\r\n                        <p className=\"text-xs text-red-400\">{errors.email.message}</p>\r\n                      )}\r\n                    </div>\r\n\r\n                    {/* Password */}\r\n                    <div className=\"space-y-1.5\">\r\n                      <Label htmlFor=\"password\" className=\"text-sm font-medium text-neutral-400\">\r\n                        Contraseña\r\n                      </Label>\r\n                      <div className=\"relative\">\r\n                        <Lock className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-neutral-600\" />\r\n                        <Input\r\n                          id=\"password\"\r\n                          type={showPassword ? \"text\" : \"password\"}\r\n                          placeholder=\"••••••••\"\r\n                          autoComplete=\"new-password\"\r\n                          className=\"pl-10 pr-10 h-11 bg-neutral-900 border-neutral-800 text-white placeholder:text-neutral-600 focus:border-primary focus:ring-1 focus:ring-primary/20 rounded-xl\"\r\n                          {...register(\"password\")}\r\n                          disabled={isSubmitting}\r\n                        />\r\n                        <button\r\n                          type=\"button\"\r\n                          onClick={() => setShowPassword(!showPassword)}\r\n                          className=\"absolute right-3 top-1/2 -translate-y-1/2 text-neutral-600 hover:text-neutral-400 transition-colors cursor-pointer p-1\"\r\n                          disabled={isSubmitting}\r\n                          aria-label={showPassword ? \"Ocultar\" : \"Mostrar\"}\r\n                        >\r\n                          {showPassword ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\r\n                        </button>\r\n                      </div>\r\n                      {errors.password && (\r\n                        <p className=\"text-xs text-red-400\">{errors.password.message}</p>\r\n                      )}\r\n                    </div>\r\n\r\n                    {/* Confirm Password */}\r\n                    <div className=\"space-y-1.5\">\r\n                      <Label htmlFor=\"confirmPassword\" className=\"text-sm font-medium text-neutral-400\">\r\n                        Confirmar contraseña\r\n                      </Label>\r\n                      <div className=\"relative\">\r\n                        <Lock className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-neutral-600\" />\r\n                        <Input\r\n                          id=\"confirmPassword\"\r\n                          type={showPassword ? \"text\" : \"password\"}\r\n                          placeholder=\"••••••••\"\r\n                          autoComplete=\"new-password\"\r\n                          className=\"pl-10 h-11 bg-neutral-900 border-neutral-800 text-white placeholder:text-neutral-600 focus:border-primary focus:ring-1 focus:ring-primary/20 rounded-xl\"\r\n                          {...register(\"confirmPassword\")}\r\n                          disabled={isSubmitting}\r\n                        />\r\n                      </div>\r\n                      {errors.confirmPassword && (\r\n                        <p className=\"text-xs text-red-400\">{errors.confirmPassword.message}</p>\r\n                      )}\r\n                    </div>\r\n\r\n                    <Button\r\n                      type=\"submit\"\r\n                      disabled={isSubmitting}\r\n                      className=\"w-full h-11 bg-primary hover:bg-primary/90 text-primary-foreground font-medium rounded-xl shadow-lg shadow-primary/20 mt-2 cursor-pointer\"\r\n                    >\r\n                      {isLoading ? (\r\n                        <>\r\n                          <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                          Creando...\r\n                        </>\r\n                      ) : (\r\n                        \"Crear cuenta\"\r\n                      )}\r\n                    </Button>\r\n                  </form>\r\n\r\n                  {/* Quick login */}\r\n                  <div className=\"mt-5 flex items-center justify-center gap-3\">\r\n                    <span className=\"text-xs text-neutral-600\">Acceso rápido:</span>\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={signInWithGoogle}\r\n                      disabled={isSubmitting}\r\n                      className=\"p-2 rounded-lg bg-neutral-800 hover:bg-neutral-700 border border-neutral-700 transition-colors cursor-pointer\"\r\n                      aria-label=\"Registrar con Google\"\r\n                    >\r\n                      <GoogleIcon className=\"h-4 w-4\" />\r\n                    </button>\r\n                  </div>\r\n                </motion.div>\r\n              )}\r\n            </AnimatePresence>\r\n          </div>\r\n\r\n          {/* Footer - Terms */}\r\n          <p className=\"mt-4 text-center text-xs text-neutral-600 px-4\">\r\n            Al registrarte aceptas nuestros{\" \"}\r\n            <Link href={ROUTES.TERMINOS} className=\"text-neutral-500 hover:text-neutral-400 underline cursor-pointer\">\r\n              Términos\r\n            </Link>{\" \"}\r\n            y{\" \"}\r\n            <Link href={ROUTES.PRIVACIDAD} className=\"text-neutral-500 hover:text-neutral-400 underline cursor-pointer\">\r\n              Privacidad\r\n            </Link>\r\n          </p>\r\n        </div>\r\n      </main>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport function RegisterFormV2(props: RegisterFormProps) {\r\n  return (\r\n    <Suspense fallback={\r\n      <div className=\"h-dvh h-screen bg-[#0f0f0f] flex items-center justify-center\">\r\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\r\n      </div>\r\n    }>\r\n      <RegisterFormContent {...props} />\r\n    </Suspense>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\auth\\register-form.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\auth\\remember-me-checkbox.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\auth\\session-timer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\blog\\AuthorCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\blog\\NotificationBell.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\blog\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\chatbot\\chat-widget.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'X' is defined but never used.","line":4,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":26}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { MessageCircle, X } from \"lucide-react\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { ChatWindow, type ChatContext, type ChatPersona } from \"./chat-window\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\n\r\nexport interface ChatWidgetProps {\r\n    persona?: ChatPersona;\r\n    context?: ChatContext;\r\n    suggestedQuestions?: string[];\r\n    hideTrigger?: boolean;\r\n}\r\n\r\nexport function ChatWidget({ persona, context, suggestedQuestions, hideTrigger = false }: ChatWidgetProps) {\r\n    const [isOpen, setIsOpen] = useState(false);\r\n\r\n    useEffect(() => {\r\n        const handleToggle = () => setIsOpen(prev => !prev);\r\n        document.addEventListener('toggle-chat', handleToggle);\r\n        return () => document.removeEventListener('toggle-chat', handleToggle);\r\n    }, []);\r\n\r\n    return (\r\n        <>\r\n            {!hideTrigger && (\r\n                <div className=\"fixed bottom-20 right-4 z-[60]\">\r\n                    <AnimatePresence mode=\"wait\">\r\n                        {!isOpen && (\r\n                            <motion.div\r\n                                initial={{ scale: 0, opacity: 0 }}\r\n                                animate={{ scale: 1, opacity: 1 }}\r\n                                exit={{ scale: 0, opacity: 0 }}\r\n                                transition={{ duration: 0.2 }}\r\n                            >\r\n                                <Button\r\n                                    data-tour=\"chat-trigger\"\r\n                                    onClick={() => setIsOpen(true)}\r\n                                    size=\"lg\"\r\n                                    className=\"rounded-full w-14 h-14 shadow-lg hover:shadow-xl bg-primary text-primary-foreground transition-all duration-300 hover:scale-110\"\r\n                                >\r\n                                    <MessageCircle className=\"h-6 w-6\" />\r\n                                    <span className=\"sr-only\">Abrir chat</span>\r\n                                </Button>\r\n                            </motion.div>\r\n                        )}\r\n                    </AnimatePresence>\r\n                </div>\r\n            )}\r\n\r\n            <ChatWindow\r\n                isOpen={isOpen}\r\n                onClose={() => setIsOpen(false)}\r\n                persona={persona}\r\n                context={context}\r\n                suggestedQuestionsOverride={suggestedQuestions}\r\n            />\r\n        </>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\chatbot\\chat-window.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useCallback' is defined but never used.","line":3,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":50},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MessageCircle' is defined but never used.","line":5,"column":71,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":84},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":230,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":230,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7528,7531],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7528,7531],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'effectiveContext', 'persona', and 't'. Either include them or remove the dependency array.","line":167,"column":8,"nodeType":"ArrayExpression","endLine":167,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [effectiveContext, persona, t]","fix":{"range":[5427,5429],"text":"[effectiveContext, persona, t]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useRef, useEffect, useCallback } from \"react\";\r\nimport { usePathname } from \"next/navigation\";\r\nimport { Send, X, Bot, User, Loader2, ThumbsUp, ThumbsDown, Sparkles, MessageCircle } from \"lucide-react\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { ScrollArea } from \"@red-salud/ui\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport ReactMarkdown from \"react-markdown\";\r\nimport { suggestedQuestions, pageSuggestions } from \"@/lib/data/knowledge-base\";\r\nimport { useTranslation } from \"@/lib/hooks/use-translation\";\r\nimport { TranslationKey } from \"@/lib/i18n/translations\";\r\n\r\ninterface Message {\r\n    id: string;\r\n    role: \"user\" | \"model\";\r\n    content: string;\r\n    feedback?: \"positive\" | \"negative\" | null;\r\n}\r\n\r\ntype ChatPersona = \"default\" | \"doctor\";\r\n\r\nexport type { ChatPersona, ChatContext };\r\n\r\ninterface ChatContext {\r\n    role?: string;\r\n    page?: string;\r\n    userId?: string;\r\n    specialty?: string;\r\n}\r\n\r\ninterface ChatWindowProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    persona?: ChatPersona;\r\n    context?: ChatContext;\r\n    suggestedQuestionsOverride?: string[];\r\n}\r\n\r\nconst STORAGE_KEY = \"red-salud-chat-history\";\r\nconst SESSION_KEY = \"red-salud-chat-session\";\r\n\r\nconst doctorSuggestedQuestions = [\r\n    \"¿Qué pacientes tengo hoy y cuál es la prioridad?\",\r\n    \"Resume las alertas o conflictos de agenda de esta semana\",\r\n    \"Guíame por el tour del calendario y los atajos\",\r\n    \"¿Cómo envío un recordatorio rápido al paciente?\",\r\n];\r\n\r\nfunction generateId(): string {\r\n    return Math.random().toString(36).substring(2, 15);\r\n}\r\n\r\nfunction getSessionId(): string {\r\n    if (typeof window === \"undefined\") return generateId();\r\n\r\n    let sessionId = sessionStorage.getItem(SESSION_KEY);\r\n    if (!sessionId) {\r\n        sessionId = generateId();\r\n        sessionStorage.setItem(SESSION_KEY, sessionId);\r\n    }\r\n    return sessionId;\r\n}\r\n\r\nfunction loadHistory(): Message[] {\r\n    if (typeof window === \"undefined\") return [];\r\n\r\n    try {\r\n        const saved = localStorage.getItem(STORAGE_KEY);\r\n        if (saved) {\r\n            return JSON.parse(saved);\r\n        }\r\n    } catch (e) {\r\n        console.error(\"Error loading chat history:\", e);\r\n    }\r\n    return [];\r\n}\r\n\r\nfunction saveHistory(messages: Message[]): void {\r\n    if (typeof window === \"undefined\") return;\r\n\r\n    try {\r\n        // Keep only last 50 messages\r\n        const toSave = messages.slice(-50);\r\n        localStorage.setItem(STORAGE_KEY, JSON.stringify(toSave));\r\n    } catch (e) {\r\n        console.error(\"Error saving chat history:\", e);\r\n    }\r\n}\r\n\r\nfunction getWelcomeMessage(persona: ChatPersona, context: ChatContext | undefined, t: (key: TranslationKey) => string): string {\r\n    if (persona === \"doctor\") {\r\n        return t(\"welcome_doctor\");\r\n    }\r\n\r\n    // Contextual welcome message\r\n    if (context?.page?.includes(\"/precios\")) {\r\n        return t(\"welcome_pricing\");\r\n    }\r\n    if (context?.page?.includes(\"/servicios\")) {\r\n        return t(\"welcome_services\");\r\n    }\r\n\r\n    return t(\"welcome_default\");\r\n}\r\n\r\nexport function ChatWindow({ isOpen, onClose, persona = \"default\", context, suggestedQuestionsOverride }: ChatWindowProps) {\r\n    const { t } = useTranslation();\r\n    const [messages, setMessages] = useState<Message[]>([]);\r\n    const [input, setInput] = useState(\"\");\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [showSuggestions, setShowSuggestions] = useState(true);\r\n    const scrollRef = useRef<HTMLDivElement>(null);\r\n    const inputRef = useRef<HTMLInputElement>(null);\r\n\r\n    const pathname = usePathname();\r\n    const effectivePage = context?.page || pathname;\r\n\r\n    // Determine dynamic suggestions based on page\r\n    const getDynamicSuggestions = () => {\r\n        if (suggestedQuestionsOverride) return suggestedQuestionsOverride;\r\n        if (persona === \"doctor\") return doctorSuggestedQuestions;\r\n\r\n        // Find matching page suggestions (longest match wins)\r\n        if (effectivePage) {\r\n            const keys = Object.keys(pageSuggestions);\r\n            const matchingKey = keys\r\n                .filter(key => effectivePage.startsWith(key))\r\n                .sort((a, b) => b.length - a.length)[0]; // Sort by length desc\r\n\r\n            if (matchingKey) return pageSuggestions[matchingKey];\r\n        }\r\n\r\n        return suggestedQuestions;\r\n    };\r\n\r\n    const effectiveSuggestions = getDynamicSuggestions();\r\n\r\n    const effectiveContext: ChatContext = {\r\n        ...context,\r\n        page: effectivePage,\r\n        role: context?.role || (persona === \"doctor\" ? \"medico\" : context?.role),\r\n    };\r\n    \r\n    // Welcome message is now derived inside effect to use 't'\r\n    \r\n    // Load history on mount\r\n    useEffect(() => {\r\n        const history = loadHistory();\r\n        if (history.length > 0) {\r\n            setMessages(history);\r\n            setShowSuggestions(false);\r\n        } else {\r\n            // Initial welcome message\r\n            const welcomeMessage = getWelcomeMessage(persona, effectiveContext, t);\r\n            setMessages([\r\n                {\r\n                    id: generateId(),\r\n                    role: \"model\",\r\n                    content: welcomeMessage,\r\n                },\r\n            ]);\r\n        }\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, []);\r\n\r\n    // Save history when messages change\r\n    useEffect(() => {\r\n        if (messages.length > 0) {\r\n            saveHistory(messages);\r\n        }\r\n    }, [messages]);\r\n\r\n    // Scroll to bottom on new messages\r\n    useEffect(() => {\r\n        if (scrollRef.current) {\r\n            scrollRef.current.scrollIntoView({ behavior: \"smooth\" });\r\n        }\r\n    }, [messages]);\r\n\r\n    // Focus input when chat opens\r\n    useEffect(() => {\r\n        if (isOpen && inputRef.current) {\r\n            setTimeout(() => inputRef.current?.focus(), 100);\r\n        }\r\n    }, [isOpen]);\r\n\r\n    const sendFeedback = async (message: Message, isPositive: boolean) => {\r\n        try {\r\n            // Find the user message that triggered this response\r\n            const messageIndex = messages.findIndex((m) => m.id === message.id);\r\n            const userMessage = messages[messageIndex - 1];\r\n\r\n            await fetch(\"/api/chat/feedback\", {\r\n                method: \"POST\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify({\r\n                    messageContent: userMessage?.content || \"\",\r\n                    responseContent: message.content,\r\n                    isPositive,\r\n                    sessionId: getSessionId(),\r\n                    pageUrl: pathname,\r\n                }),\r\n            });\r\n        } catch (error) {\r\n            console.error(\"Error sending feedback:\", error);\r\n        }\r\n    };\r\n\r\n    const handleFeedback = (messageId: string, type: \"positive\" | \"negative\") => {\r\n        setMessages((prev) =>\r\n            prev.map((msg) =>\r\n                msg.id === messageId ? { ...msg, feedback: type } : msg\r\n            )\r\n        );\r\n\r\n        const message = messages.find((m) => m.id === messageId);\r\n        if (message) {\r\n            sendFeedback(message, type === \"positive\");\r\n        }\r\n    };\r\n\r\n    const handleSuggestionClick = (question: string) => {\r\n        setInput(question);\r\n        setShowSuggestions(false);\r\n        // Auto submit\r\n        setTimeout(() => {\r\n            handleSubmit(new Event(\"submit\") as any, question);\r\n        }, 100);\r\n    };\r\n\r\n    const handleSubmit = async (e: React.FormEvent, overrideInput?: string) => {\r\n        e.preventDefault();\r\n        const messageText = overrideInput || input.trim();\r\n        if (!messageText || isLoading) return;\r\n\r\n        const userMessage: Message = { id: generateId(), role: \"user\", content: messageText };\r\n        setInput(\"\");\r\n        setShowSuggestions(false);\r\n        setMessages((prev) => [...prev, userMessage]);\r\n        setIsLoading(true);\r\n\r\n        try {\r\n            const response = await fetch(\"/api/chat\", {\r\n                method: \"POST\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify({\r\n                    messages: [...messages, { role: \"user\", content: messageText }],\r\n                    context: effectiveContext,\r\n                }),\r\n            });\r\n\r\n            if (!response.ok) throw new Error(\"Error en la respuesta del chat\");\r\n\r\n            const reader = response.body?.getReader();\r\n            if (!reader) throw new Error(\"No se pudo iniciar el stream\");\r\n\r\n            const modelMessageId = generateId();\r\n            setMessages((prev) => [...prev, { id: modelMessageId, role: \"model\", content: \"\" }]);\r\n\r\n            const decoder = new TextDecoder();\r\n            let done = false;\r\n            let accumulatedText = \"\";\r\n\r\n            while (!done) {\r\n                const { value, done: doneReading } = await reader.read();\r\n                done = doneReading;\r\n                const chunkValue = decoder.decode(value, { stream: !done });\r\n                accumulatedText += chunkValue;\r\n\r\n                setMessages((prev) => {\r\n                    const newMessages = [...prev];\r\n                    const lastMessage = newMessages[newMessages.length - 1];\r\n                    if (lastMessage.role === \"model\") {\r\n                        lastMessage.content = accumulatedText;\r\n                    }\r\n                    return newMessages;\r\n                });\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Error sending message:\", error);\r\n            setMessages((prev) => [\r\n                ...prev,\r\n                {\r\n                    id: generateId(),\r\n                    role: \"model\",\r\n                    content: t(\"error_message\"),\r\n                },\r\n            ]);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    const clearHistory = () => {\r\n        localStorage.removeItem(STORAGE_KEY);\r\n        setMessages([\r\n            {\r\n                id: generateId(),\r\n                role: \"model\",\r\n                content: getWelcomeMessage(persona, effectiveContext, t),\r\n            },\r\n        ]);\r\n        setShowSuggestions(true);\r\n    };\r\n\r\n    return (\r\n        <AnimatePresence>\r\n            {isOpen && (\r\n                <motion.div\r\n                    initial={{ opacity: 0, scale: 0.95, y: 20 }}\r\n                    animate={{ opacity: 1, scale: 1, y: 0 }}\r\n                    exit={{ opacity: 0, scale: 0.95, y: 20 }}\r\n                    transition={{ duration: 0.2 }}\r\n                    className=\"fixed bottom-20 right-4 z-50 w-[380px] md:w-[420px] h-[550px] bg-background border rounded-2xl shadow-2xl flex flex-col overflow-hidden\"\r\n                >\r\n                    {/* Header */}\r\n                    <div className=\"bg-gradient-to-r from-primary to-primary/80 p-4 flex justify-between items-center text-primary-foreground\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"relative\">\r\n                                <div className=\"bg-white/20 p-2 rounded-full\">\r\n                                    <Bot className=\"h-5 w-5\" />\r\n                                </div>\r\n                                <div className=\"absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-400 rounded-full border-2 border-primary\" />\r\n                            </div>\r\n                            <div>\r\n                                <h3 className=\"font-semibold text-sm\">{t(\"header_title\")}</h3>\r\n                                <p className=\"text-xs text-primary-foreground/80 flex items-center gap-1\">\r\n                                    <Sparkles className=\"h-3 w-3\" /> {t(\"header_subtitle\")}\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-1\">\r\n                            <Button\r\n                                variant=\"ghost\"\r\n                                size=\"sm\"\r\n                                onClick={clearHistory}\r\n                                className=\"text-primary-foreground/80 hover:text-primary-foreground hover:bg-primary-foreground/10 text-xs h-7 px-2\"\r\n                            >\r\n                                {t(\"clear_history\")}\r\n                            </Button>\r\n                            <Button\r\n                                variant=\"ghost\"\r\n                                size=\"icon\"\r\n                                onClick={onClose}\r\n                                className=\"text-primary-foreground hover:bg-primary-foreground/10 h-8 w-8\"\r\n                                aria-label={t(\"close_chat\")}\r\n                            >\r\n                                <X className=\"h-4 w-4\" />\r\n                            </Button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Messages */}\r\n                    <ScrollArea className=\"flex-1 p-4 bg-muted/20\">\r\n                        <div className=\"space-y-4\">\r\n                            {messages.map((message) => (\r\n                                <motion.div\r\n                                    key={message.id}\r\n                                    initial={{ opacity: 0, y: 10 }}\r\n                                    animate={{ opacity: 1, y: 0 }}\r\n                                    transition={{ duration: 0.2 }}\r\n                                    className={cn(\r\n                                        \"flex gap-2 max-w-[90%]\",\r\n                                        message.role === \"user\" ? \"ml-auto flex-row-reverse\" : \"\"\r\n                                    )}\r\n                                >\r\n                                    <div\r\n                                        className={cn(\r\n                                            \"w-8 h-8 rounded-full flex items-center justify-center shrink-0\",\r\n                                            message.role === \"user\"\r\n                                                ? \"bg-primary text-primary-foreground\"\r\n                                                : \"bg-gradient-to-br from-primary/20 to-secondary/20 border\"\r\n                                        )}\r\n                                    >\r\n                                        {message.role === \"user\" ? (\r\n                                            <User className=\"h-4 w-4\" />\r\n                                        ) : (\r\n                                            <Bot className=\"h-4 w-4 text-primary\" />\r\n                                        )}\r\n                                    </div>\r\n                                    <div className=\"flex flex-col gap-1\">\r\n                                        <div\r\n                                            className={cn(\r\n                                                \"p-3 rounded-2xl text-sm\",\r\n                                                message.role === \"user\"\r\n                                                    ? \"bg-primary text-primary-foreground rounded-tr-sm\"\r\n                                                    : \"bg-background border shadow-sm rounded-tl-sm\"\r\n                                            )}\r\n                                        >\r\n                                            {message.role === \"model\" && message.content === \"\" ? (\r\n                                        <span className=\"flex items-center gap-2 text-muted-foreground\">\r\n                                            <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                                            {t(\"searching\")}\r\n                                        </span>\r\n                                    ) : message.role === \"model\" ? (\r\n                                                <div className=\"prose prose-sm dark:prose-invert max-w-none [&_p]:my-1 [&_ul]:my-1 [&_li]:my-0.5\">\r\n                                                    <ReactMarkdown\r\n                                                        components={{\r\n                                                            a: ({ href, children }) => (\r\n                                                                <a href={href} className=\"text-primary hover:underline\" target=\"_blank\" rel=\"noopener noreferrer\">\r\n                                                                    {children}\r\n                                                                </a>\r\n                                                            ),\r\n                                                        }}\r\n                                                    >\r\n                                                        {message.content}\r\n                                                    </ReactMarkdown>\r\n                                                </div>\r\n                                            ) : (\r\n                                                message.content\r\n                                            )}\r\n                                        </div>\r\n\r\n                                        {/* Feedback buttons for bot messages */}\r\n                                        {message.role === \"model\" && message.content && !isLoading && (\r\n                                            <div className=\"flex items-center gap-1 ml-1\">\r\n                                                <button\r\n                                                    onClick={() => handleFeedback(message.id, \"positive\")}\r\n                                                    disabled={message.feedback !== undefined}\r\n                                                    className={cn(\r\n                                                        \"p-1 rounded-md transition-colors\",\r\n                                                        message.feedback === \"positive\"\r\n                                                            ? \"text-green-600 bg-green-100 dark:bg-green-900/30\"\r\n                                                            : message.feedback === \"negative\"\r\n                                                                ? \"text-muted-foreground/30 cursor-not-allowed\"\r\n                                                                : \"text-muted-foreground hover:text-green-600 hover:bg-green-100 dark:hover:bg-green-900/30\"\r\n                                                    )}\r\n                                                    title={t(\"feedback_positive\")}\r\n                                                >\r\n                                                    <ThumbsUp className=\"h-3.5 w-3.5\" />\r\n                                                </button>\r\n                                                <button\r\n                                                    onClick={() => handleFeedback(message.id, \"negative\")}\r\n                                                    disabled={message.feedback !== undefined}\r\n                                                    className={cn(\r\n                                                        \"p-1 rounded-md transition-colors\",\r\n                                                        message.feedback === \"negative\"\r\n                                                            ? \"text-red-600 bg-red-100 dark:bg-red-900/30\"\r\n                                                            : message.feedback === \"positive\"\r\n                                                                ? \"text-muted-foreground/30 cursor-not-allowed\"\r\n                                                                : \"text-muted-foreground hover:text-red-600 hover:bg-red-100 dark:hover:bg-red-900/30\"\r\n                                                    )}\r\n                                                    title={t(\"feedback_negative\")}\r\n                                                >\r\n                                                    <ThumbsDown className=\"h-3.5 w-3.5\" />\r\n                                                </button>\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                </motion.div>\r\n                            ))}\r\n                            <div ref={scrollRef} />\r\n                        </div>\r\n\r\n                        {/* Suggested questions */}\r\n                        {showSuggestions && !isLoading && (\r\n                            <motion.div\r\n                                initial={{ opacity: 0, y: 10 }}\r\n                                animate={{ opacity: 1, y: 0 }}\r\n                                className=\"mt-4 space-y-2\"\r\n                            >\r\n                                <p className=\"text-xs text-muted-foreground font-medium\">{t(\"suggestions_label\")}</p>\r\n                                <div className=\"flex flex-wrap gap-2\">\r\n                                    {effectiveSuggestions.slice(0, 4).map((question, i) => (\r\n                                        <button\r\n                                            key={i}\r\n                                            onClick={() => handleSuggestionClick(question)}\r\n                                            className=\"text-xs px-3 py-1.5 rounded-full bg-primary/10 text-primary hover:bg-primary/20 transition-colors border border-primary/20\"\r\n                                        >\r\n                                            {question}\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            </motion.div>\r\n                        )}\r\n                    </ScrollArea>\r\n\r\n                    {/* Input */}\r\n                    <div className=\"p-4 bg-background border-t\">\r\n                        <form onSubmit={handleSubmit} className=\"flex gap-2\">\r\n                            <Input\r\n                                ref={inputRef}\r\n                                value={input}\r\n                                onChange={(e) => setInput(e.target.value)}\r\n                                placeholder={t(\"input_placeholder\")}\r\n                                className=\"flex-1 focus-visible:ring-1 rounded-full px-4\"\r\n                                disabled={isLoading}\r\n                                aria-label={t(\"input_placeholder\")}\r\n                            />\r\n                            <Button\r\n                                type=\"submit\"\r\n                                size=\"icon\"\r\n                                disabled={isLoading || !input.trim()}\r\n                                className=\"rounded-full shrink-0\"\r\n                                aria-label={t(\"send_message\")}\r\n                            >\r\n                                {isLoading ? (\r\n                                    <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                                ) : (\r\n                                    <Send className=\"h-4 w-4\" />\r\n                                )}\r\n                            </Button>\r\n                        </form>\r\n                        <p className=\"text-[10px] text-muted-foreground text-center mt-2\">\r\n                            {t(\"disclaimer\")}\r\n                        </p>\r\n                    </div>\r\n                </motion.div>\r\n            )}\r\n        </AnimatePresence>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\chatbot\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\configuracion\\secretarias\\invite-dialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[493,496],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[493,496],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { Label } from \"@red-salud/ui\";\r\nimport { Loader2, Eye, EyeOff } from \"lucide-react\";\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogDescription,\r\n    DialogFooter,\r\n    DialogHeader,\r\n    DialogTitle,\r\n} from \"@red-salud/ui\";\r\n\r\ninterface InviteDialogProps {\r\n    open: boolean;\r\n    onOpenChange: (open: boolean) => void;\r\n    onInvite: (data: any) => Promise<void>;\r\n    loading: boolean;\r\n}\r\n\r\nexport function InviteDialog({\r\n    open,\r\n    onOpenChange,\r\n    onInvite,\r\n    loading,\r\n}: InviteDialogProps) {\r\n    const [form, setForm] = useState({\r\n        email: \"\",\r\n        nombre_completo: \"\",\r\n        password: \"\",\r\n        showPassword: false,\r\n    });\r\n\r\n    const handleSubmit = async () => {\r\n        await onInvite(form);\r\n        setForm({ email: \"\", nombre_completo: \"\", password: \"\", showPassword: false });\r\n    };\r\n\r\n    return (\r\n        <Dialog open={open} onOpenChange={onOpenChange}>\r\n            <DialogContent className=\"sm:max-w-md\">\r\n                <DialogHeader>\r\n                    <DialogTitle>Invitar Secretaria</DialogTitle>\r\n                    <DialogDescription>\r\n                        Crea una cuenta para tu secretaria y asigna permisos\r\n                    </DialogDescription>\r\n                </DialogHeader>\r\n                <div className=\"space-y-4 py-4\">\r\n                    <div className=\"space-y-2\">\r\n                        <Label htmlFor=\"nombre\">Nombre Completo</Label>\r\n                        <Input\r\n                            id=\"nombre\"\r\n                            placeholder=\"María García\"\r\n                            value={form.nombre_completo}\r\n                            onChange={(e) => setForm({ ...form, nombre_completo: e.target.value })}\r\n                        />\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                        <Label htmlFor=\"email\">Email</Label>\r\n                        <Input\r\n                            id=\"email\"\r\n                            type=\"email\"\r\n                            placeholder=\"secretaria@ejemplo.com\"\r\n                            value={form.email}\r\n                            onChange={(e) => setForm({ ...form, email: e.target.value })}\r\n                        />\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                        <Label htmlFor=\"password\">Contraseña</Label>\r\n                        <div className=\"relative\">\r\n                            <Input\r\n                                id=\"password\"\r\n                                type={form.showPassword ? \"text\" : \"password\"}\r\n                                placeholder=\"Mínimo 6 caracteres\"\r\n                                value={form.password}\r\n                                onChange={(e) => setForm({ ...form, password: e.target.value })}\r\n                            />\r\n                            <Button\r\n                                type=\"button\"\r\n                                variant=\"ghost\"\r\n                                size=\"sm\"\r\n                                className=\"absolute right-0 top-0 h-full px-3\"\r\n                                onClick={() => setForm({ ...form, showPassword: !form.showPassword })}\r\n                            >\r\n                                {form.showPassword ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\r\n                            </Button>\r\n                        </div>\r\n                        <p className=\"text-xs text-gray-500\">\r\n                            La secretaria usará este email y contraseña para iniciar sesión\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n                <DialogFooter>\r\n                    <Button variant=\"outline\" onClick={() => onOpenChange(false)}>\r\n                        Cancelar\r\n                    </Button>\r\n                    <Button\r\n                        onClick={handleSubmit}\r\n                        disabled={!form.email || !form.nombre_completo || !form.password || loading}\r\n                    >\r\n                        {loading ? <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" /> : null}\r\n                        Invitar\r\n                    </Button>\r\n                </DialogFooter>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\configuracion\\secretarias\\permissions-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\configuracion\\secretarias\\secretary-list.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\configuracion\\secretarias\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\clinica\\clinic-scope-provider.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\clinica\\clinic-scope-provider.tsx:38:7\n  36 |   useEffect(() => {\n  37 |     if (currentLocations.length > 0 && selectedLocationIds.length === 0) {\n> 38 |       setSelectedLocationIds(currentLocations.map((l) => l.id));\n     |       ^^^^^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  39 |     }\n  40 |   }, [currentLocations, selectedLocationIds.length]);\n  41 |","line":38,"column":7,"nodeType":null,"endLine":38,"endColumn":29}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Provider de contexto para el scope de clínica\r\n * \r\n * Maneja la clínica y sedes activas seleccionadas\r\n */\r\n\r\n'use client';\r\n\r\nimport React, { createContext, useContext, useState, useEffect } from 'react';\r\nimport type { Clinic, ClinicLocation } from '@/lib/types/clinic.types';\r\n\r\ninterface ClinicScopeContextValue {\r\n  selectedClinicId: string | null;\r\n  selectedLocationIds: string[];\r\n  currentClinic: Clinic | null;\r\n  currentLocations: ClinicLocation[];\r\n  setSelectedClinicId: (clinicId: string | null) => void;\r\n  setSelectedLocationIds: (locationIds: string[]) => void;\r\n  setCurrentClinic: (clinic: Clinic | null) => void;\r\n  setCurrentLocations: (locations: ClinicLocation[]) => void;\r\n  selectAllLocations: () => void;\r\n  selectMainLocation: () => void;\r\n}\r\n\r\nconst ClinicScopeContext = createContext<ClinicScopeContextValue | undefined>(\r\n  undefined\r\n);\r\n\r\nexport function ClinicScopeProvider({ children }: { children: React.ReactNode }) {\r\n  const [selectedClinicId, setSelectedClinicId] = useState<string | null>(null);\r\n  const [selectedLocationIds, setSelectedLocationIds] = useState<string[]>([]);\r\n  const [currentClinic, setCurrentClinic] = useState<Clinic | null>(null);\r\n  const [currentLocations, setCurrentLocations] = useState<ClinicLocation[]>([]);\r\n\r\n  // Auto-seleccionar todas las sedes cuando cambia la clínica\r\n  useEffect(() => {\r\n    if (currentLocations.length > 0 && selectedLocationIds.length === 0) {\r\n      setSelectedLocationIds(currentLocations.map((l) => l.id));\r\n    }\r\n  }, [currentLocations, selectedLocationIds.length]);\r\n\r\n  const selectAllLocations = () => {\r\n    setSelectedLocationIds(currentLocations.map((l) => l.id));\r\n  };\r\n\r\n  const selectMainLocation = () => {\r\n    const mainLocation = currentLocations.find((l) => l.is_main);\r\n    if (mainLocation) {\r\n      setSelectedLocationIds([mainLocation.id]);\r\n    } else if (currentLocations.length > 0) {\r\n      setSelectedLocationIds([currentLocations[0].id]);\r\n    }\r\n  };\r\n\r\n  const value: ClinicScopeContextValue = {\r\n    selectedClinicId,\r\n    selectedLocationIds,\r\n    currentClinic,\r\n    currentLocations,\r\n    setSelectedClinicId,\r\n    setSelectedLocationIds,\r\n    setCurrentClinic,\r\n    setCurrentLocations,\r\n    selectAllLocations,\r\n    selectMainLocation,\r\n  };\r\n\r\n  return (\r\n    <ClinicScopeContext.Provider value={value}>\r\n      {children}\r\n    </ClinicScopeContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useClinicScope() {\r\n  const context = useContext(ClinicScopeContext);\r\n  if (context === undefined) {\r\n    throw new Error('useClinicScope must be used within ClinicScopeProvider');\r\n  }\r\n  return context;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\clinica\\stats-grid.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\layout\\clinic-mode-toggle.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\layout\\dashboard-header.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userName' is assigned a value but never used.","line":61,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":61,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userEmail' is defined but never used.","line":62,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":62,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":123,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3413,3416],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3413,3416],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file dashboard-header.tsx\r\n * @description Header funcional para el dashboard médico\r\n * @module Dashboard/Layout\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { usePathname } from \"next/navigation\";\r\nimport {\r\n  CircleHelp,\r\n  MessageCircle,\r\n  Sparkles,\r\n  Building2,\r\n  ChevronDown,\r\n} from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { ThemeToggle } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { DashboardMegaMenu } from \"./dashboard-mega-menu\";\r\nimport { ClinicModeToggle } from \"./clinic-mode-toggle\";\r\nimport { MegaMenuSection } from \"@/components/dashboard/medico/configuracion/configuracion-mega-menu-config\";\r\nimport {\r\n  DropdownMenu,\r\n  DropdownMenuContent,\r\n  DropdownMenuItem,\r\n  DropdownMenuLabel,\r\n  DropdownMenuSeparator,\r\n  DropdownMenuTrigger,\r\n} from \"@red-salud/ui\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\n\r\nexport interface Office {\r\n  id: string;\r\n  nombre: string;\r\n  direccion?: string;\r\n}\r\n\r\nexport interface DashboardHeaderProps {\r\n  userName?: string;\r\n  userEmail?: string;\r\n  doctorProfile?: {\r\n    nombre_completo?: string;\r\n    specialty?: { name: string };\r\n    sacs_especialidad?: string;\r\n    is_verified?: boolean;\r\n    sacs_verified?: boolean;\r\n  } | null;\r\n  onTourClick?: () => void;\r\n  onChatClick?: () => void;\r\n  megaMenu?: {\r\n    sections: MegaMenuSection[];\r\n    activeItem?: string;\r\n    onItemClick: (itemId: string) => void;\r\n  };\r\n  className?: string;\r\n}\r\n\r\nexport function DashboardHeader({\r\n  userName = \"Usuario\",\r\n  userEmail,\r\n  doctorProfile,\r\n  onTourClick,\r\n  onChatClick,\r\n  megaMenu,\r\n  className,\r\n}: DashboardHeaderProps) {\r\n  const pathname = usePathname();\r\n  const isCitasPage = pathname?.includes(\"/citas\");\r\n\r\n  const [offices, setOffices] = useState<Office[]>([]);\r\n  const [selectedOffice, setSelectedOffice] = useState<Office | null>(null);\r\n  const [showAllOffices, setShowAllOffices] = useState(true);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    if (isCitasPage) {\r\n      console.log(\"📍 Cargando consultorios para página de citas...\");\r\n      loadOffices();\r\n    }\r\n  }, [isCitasPage]);\r\n\r\n  const loadOffices = async () => {\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) {\r\n        console.log(\"❌ No hay usuario autenticado\");\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      console.log(\"👤 Usuario ID:\", user.id);\r\n\r\n      const { data, error } = await supabase\r\n        .from(\"doctor_offices\")\r\n        .select(\"id, nombre, direccion, ciudad, estado, es_principal\")\r\n        .eq(\"doctor_id\", user.id)\r\n        .eq(\"activo\", true)\r\n        .order(\"es_principal\", { ascending: false });\r\n\r\n      if (error) {\r\n        console.error(\"❌ Error cargando consultorios:\", {\r\n          message: error.message,\r\n          details: error.details,\r\n          hint: error.hint,\r\n          code: error.code\r\n        });\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      console.log(\"🏥 Consultorios encontrados:\", data?.length || 0);\r\n      console.log(\"📋 Datos:\", data);\r\n\r\n      if (data && data.length > 0) {\r\n        setOffices(data);\r\n        console.log(\"✅ Consultorios cargados correctamente\");\r\n      } else {\r\n        console.log(\"⚠️ No hay consultorios activos para este médico\");\r\n        setOffices([]);\r\n      }\r\n    } catch (error: any) {\r\n      console.error(\"💥 Error inesperado loading offices:\", {\r\n        message: error?.message,\r\n        stack: error?.stack,\r\n        error: error\r\n      });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleOfficeChange = (office: Office | null) => {\r\n    setSelectedOffice(office);\r\n    setShowAllOffices(office === null);\r\n    // Emitir evento para que el calendario se actualice\r\n    window.dispatchEvent(new CustomEvent(\"office-changed\", {\r\n      detail: { officeId: office?.id || null }\r\n    }));\r\n  };\r\n\r\n  // Función para obtener saludo según la hora\r\n  const getGreeting = () => {\r\n    const hour = new Date().getHours();\r\n    if (hour >= 5 && hour < 12) return \"Buenos días\";\r\n    if (hour >= 12 && hour < 19) return \"Buenas tardes\";\r\n    return \"Buenas noches\";\r\n  };\r\n\r\n  // Obtener nombre y apellido del doctor\r\n  const getDocName = () => {\r\n    if (doctorProfile?.nombre_completo) {\r\n      const nameParts = doctorProfile.nombre_completo.split(\" \");\r\n      return `Dr. ${nameParts[0]} ${nameParts[1] || \"\"}`.trim();\r\n    }\r\n    return \"Doctor\";\r\n  };\r\n\r\n  // Get current date info\r\n  const today = new Date();\r\n  const dateOptions: Intl.DateTimeFormatOptions = {\r\n    weekday: \"long\",\r\n    day: \"numeric\",\r\n    month: \"long\",\r\n  };\r\n  const formattedDate = today.toLocaleDateString(\"es-ES\", dateOptions);\r\n\r\n  return (\r\n    <header\r\n      className={cn(\r\n        \"flex h-12 items-center flex-shrink-0 border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60\",\r\n        \"sticky top-0 z-50\",\r\n        className\r\n      )}\r\n    >\r\n      <div className=\"flex items-center justify-between h-full pr-3 flex-1 overflow-x-auto overflow-y-visible gap-x-4 pl-4\">\r\n        {/* Left Section - Greeting and Info */}\r\n        <div className=\"flex items-center text-sm gap-2 flex-shrink-0\">\r\n          <div className=\"flex items-center gap-2 text-sm\">\r\n            <span className=\"font-medium text-foreground whitespace-nowrap\">\r\n              {getGreeting()}, {getDocName()}\r\n            </span>\r\n\r\n            <span className=\"text-muted-foreground whitespace-nowrap capitalize\">\r\n              {formattedDate}\r\n            </span>\r\n\r\n            <span className=\"text-muted-foreground\">•</span>\r\n\r\n            <span className=\"text-muted-foreground whitespace-nowrap\">\r\n              {doctorProfile?.specialty?.name ||\r\n                doctorProfile?.sacs_especialidad ||\r\n                \"Médico\"}\r\n            </span>\r\n\r\n            {/* Verification Badge */}\r\n            {(doctorProfile?.is_verified || doctorProfile?.sacs_verified) && (\r\n              <>\r\n                <span className=\"text-muted-foreground\">•</span>\r\n                <span className=\"inline-flex items-center gap-1 text-green-600 dark:text-green-400 whitespace-nowrap\">\r\n                  <Sparkles className=\"h-3 w-3\" />\r\n                  Verificado\r\n                </span>\r\n              </>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Center Section - Office Selector (solo en página de citas) o Mega Menu */}\r\n        {isCitasPage ? (\r\n          <div className=\"flex-1 flex justify-center min-w-0\">\r\n            {loading ? (\r\n              <div className=\"text-xs text-muted-foreground\">Cargando consultorios...</div>\r\n            ) : offices.length > 0 ? (\r\n              <DropdownMenu>\r\n                <DropdownMenuTrigger asChild>\r\n                  <Button variant=\"outline\" size=\"sm\" className=\"gap-2 min-w-[220px]\">\r\n                    <Building2 className=\"h-4 w-4\" />\r\n                    <span className=\"truncate\">\r\n                      {showAllOffices ? \"Todos los consultorios\" : selectedOffice?.nombre || \"Seleccionar\"}\r\n                    </span>\r\n                    <ChevronDown className=\"h-3 w-3 ml-auto\" />\r\n                  </Button>\r\n                </DropdownMenuTrigger>\r\n                <DropdownMenuContent align=\"center\" className=\"w-[280px]\">\r\n                  <DropdownMenuLabel>Consultorios</DropdownMenuLabel>\r\n                  <DropdownMenuSeparator />\r\n                  <DropdownMenuItem\r\n                    onClick={() => handleOfficeChange(null)}\r\n                    className={cn(\r\n                      \"cursor-pointer\",\r\n                      showAllOffices && \"bg-muted\"\r\n                    )}\r\n                  >\r\n                    <Building2 className=\"h-4 w-4 mr-2\" />\r\n                    <div>\r\n                      <div className=\"font-medium\">Todos los consultorios</div>\r\n                      <div className=\"text-xs text-muted-foreground\">Vista unificada</div>\r\n                    </div>\r\n                  </DropdownMenuItem>\r\n                  <DropdownMenuSeparator />\r\n                  {offices.map((office) => (\r\n                    <DropdownMenuItem\r\n                      key={office.id}\r\n                      onClick={() => handleOfficeChange(office)}\r\n                      className={cn(\r\n                        \"cursor-pointer\",\r\n                        selectedOffice?.id === office.id && \"bg-muted\"\r\n                      )}\r\n                    >\r\n                      <Building2 className=\"h-4 w-4 mr-2\" />\r\n                      <div>\r\n                        <div className=\"font-medium\">{office.nombre}</div>\r\n                        <div className=\"text-xs text-muted-foreground truncate\">\r\n                          {office.direccion}\r\n                        </div>\r\n                      </div>\r\n                    </DropdownMenuItem>\r\n                  ))}\r\n                </DropdownMenuContent>\r\n              </DropdownMenu>\r\n            ) : (\r\n              <div className=\"text-xs text-muted-foreground\">\r\n                No hay consultorios configurados\r\n              </div>\r\n            )}\r\n          </div>\r\n        ) : megaMenu ? (\r\n          <div className=\"flex-1 flex justify-center min-w-0\">\r\n            <DashboardMegaMenu\r\n              sections={megaMenu.sections}\r\n              activeItem={megaMenu.activeItem}\r\n              onItemClick={megaMenu.onItemClick}\r\n            />\r\n          </div>\r\n        ) : null}\r\n\r\n        {/* Right Section - Actions */}\r\n        <div className=\"flex items-center gap-x-2 flex-shrink-0\">\r\n          {/* Modo Clínico Toggle (Solo en /citas/nueva) */}\r\n          {pathname?.includes(\"/citas/nueva\") && (\r\n            <ClinicModeToggle />\r\n          )}\r\n\r\n          {/* Chat Button */}\r\n          <Button\r\n            variant=\"ghost\"\r\n            size=\"icon\"\r\n            onClick={onChatClick}\r\n            className={cn(\r\n              \"relative cursor-pointer text-center font-regular ease-out duration-200\",\r\n              \"outline-none transition-all outline-0 focus-visible:outline-4 focus-visible:outline-offset-1\",\r\n              \"border text-foreground bg-transparent border-strong hover:border-foreground-muted\",\r\n              \"focus-visible:outline-border-strong rounded-full w-[32px] h-[32px]\",\r\n              \"flex items-center justify-center p-0 group pointer-events-auto\"\r\n            )}\r\n            title=\"Chat Asistente\"\r\n          >\r\n            <MessageCircle className=\"h-4 w-4 text-muted-foreground group-hover:text-foreground transition-colors\" />\r\n          </Button>\r\n\r\n          {/* Tour/Help Button */}\r\n          <Button\r\n            variant=\"ghost\"\r\n            size=\"icon\"\r\n            onClick={onTourClick}\r\n            className={cn(\r\n              \"relative cursor-pointer text-center font-regular ease-out duration-200\",\r\n              \"outline-none transition-all outline-0 focus-visible:outline-4 focus-visible:outline-offset-1\",\r\n              \"border text-foreground bg-transparent border-strong hover:border-foreground-muted\",\r\n              \"focus-visible:outline-border-strong rounded-full w-[32px] h-[32px]\",\r\n              \"flex items-center justify-center p-0 group pointer-events-auto\"\r\n            )}\r\n            title=\"Iniciar Tour\"\r\n          >\r\n            <CircleHelp className=\"h-4 w-4 text-muted-foreground group-hover:text-foreground transition-colors\" />\r\n          </Button>\r\n\r\n          {/* Theme Toggle */}\r\n          <ThemeToggle className=\"w-[32px] h-[32px] border-strong bg-transparent hover:border-foreground-muted\" />\r\n        </div>\r\n      </div>\r\n    </header>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\layout\\dashboard-layout-client.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Menu' is defined but never used.","line":12,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Bell' is defined but never used.","line":12,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used.","line":13,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SessionTimer' is defined but never used.","line":23,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1723,1726],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1723,1726],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isCitasPage' is assigned a value but never used.","line":60,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":60,"endColumn":20}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file dashboard-layout-client.tsx\r\n * @description Componente cliente del layout del dashboard. Maneja la navegación,\r\n * sidebars y modales de perfil según el rol del usuario.\r\n * @module Dashboard/Layout\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { useRouter, usePathname, useSearchParams } from \"next/navigation\";\r\nimport { Menu, Bell } from \"lucide-react\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { PATIENT_MODULE_CONFIG } from \"@/lib/constants\";\r\nimport { signOut } from \"@/lib/supabase/auth\";\r\nimport { UserProfileModal } from \"@/components/dashboard/shared/profile\";\r\nimport { DashboardSidebar } from \"./dashboard-sidebar\";\r\nimport { DashboardMobileSidebar } from \"./dashboard-mobile-sidebar\";\r\nimport { DashboardMobileHeader } from \"./dashboard-mobile-header\";\r\nimport { DashboardHeader } from \"./dashboard-header\";\r\nimport { SidebarAwareContent } from \"./sidebar-aware-content\";\r\nimport { useSessionSetup, useSessionValidation } from \"@/hooks/auth\";\r\nimport { SessionTimer } from \"@/components/auth\";\r\nimport { ChatWidget } from \"@/components/chatbot/chat-widget\";\r\nimport { useDoctorProfile } from \"@/hooks/use-doctor-profile\";\r\nimport { useTourGuide } from \"@/components/dashboard/shared/tour-guide/tour-guide-provider\";\r\nimport { CONFIGURACION_MEGA_MENU } from \"@/components/dashboard/medico/configuracion/configuracion-mega-menu-config\";\r\nimport { ESTADISTICAS_MEGA_MENU } from \"@/components/dashboard/medico/estadisticas/estadisticas-mega-menu-config\";\r\n\r\ninterface DashboardLayoutClientProps {\r\n  children: React.ReactNode;\r\n  userName?: string;\r\n  userEmail?: string;\r\n  userId?: string;\r\n  userRole?: \"paciente\" | \"medico\" | \"secretaria\";\r\n  secretaryPermissions?: any;\r\n}\r\n\r\nexport function DashboardLayoutClient({\r\n  children,\r\n  userName = \"Usuario\",\r\n  userEmail = \"usuario@email.com\",\r\n  userId,\r\n  userRole = \"paciente\",\r\n  secretaryPermissions,\r\n}: DashboardLayoutClientProps) {\r\n  const router = useRouter();\r\n  const pathname = usePathname();\r\n  const searchParams = useSearchParams();\r\n  const [mobileSidebarOpen, setMobileSidebarOpen] = useState(false);\r\n  const [profileModalOpen, setProfileModalOpen] = useState(false);\r\n\r\n  // Configurar y validar sesión automáticamente\r\n  useSessionSetup();\r\n  useSessionValidation();\r\n\r\n  // Detectar si estamos en la página de configuración, estadísticas o citas y configurar mega menú\r\n  const isConfiguracionPage = pathname?.includes(\"/configuracion\");\r\n  const isEstadisticasPage = pathname?.includes(\"/estadisticas\");\r\n  const isCitasPage = pathname?.includes(\"/citas\");\r\n  const activeTab = (searchParams?.get(\"tab\") as string) || (isConfiguracionPage ? \"perfil\" : \"resumen\");\r\n\r\n  const megaMenuConfig = isConfiguracionPage\r\n    ? {\r\n      sections: CONFIGURACION_MEGA_MENU,\r\n      activeItem: activeTab,\r\n      onItemClick: (itemId: string) => {\r\n        const newUrl =\r\n          itemId === \"perfil\"\r\n            ? \"/dashboard/medico/configuracion\"\r\n            : `/dashboard/medico/configuracion?tab=${itemId}`;\r\n        router.push(newUrl, { scroll: false });\r\n      },\r\n    }\r\n    : isEstadisticasPage\r\n      ? {\r\n        sections: ESTADISTICAS_MEGA_MENU,\r\n        activeItem: activeTab,\r\n        onItemClick: (itemId: string) => {\r\n          const newUrl =\r\n            itemId === \"resumen\"\r\n              ? \"/dashboard/medico/estadisticas\"\r\n              : `/dashboard/medico/estadisticas?tab=${itemId}`;\r\n          router.push(newUrl, { scroll: false });\r\n        },\r\n      }\r\n      : undefined;\r\n\r\n  // Hooks para médicos\r\n  const { profile: doctorProfile } = useDoctorProfile(\r\n    userRole === \"medico\" ? userId : undefined\r\n  );\r\n  const { startTour } = useTourGuide();\r\n\r\n  /**\r\n   * Maneja el clic en el perfil del usuario.\r\n   * Para médicos, navega directamente a configuración.\r\n   * Para otros roles, abre el modal de perfil.\r\n   */\r\n  const handleProfileClick = () => {\r\n    if (userRole === \"medico\") {\r\n      // Médicos: navegar directamente a configuración\r\n      router.push(\"/dashboard/medico/configuracion\");\r\n    } else {\r\n      // Otros roles: abrir modal de perfil\r\n      setProfileModalOpen(true);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Maneja el clic en el perfil desde el sidebar móvil.\r\n   */\r\n  const handleMobileProfileClick = () => {\r\n    setMobileSidebarOpen(false);\r\n    if (userRole === \"medico\") {\r\n      router.push(\"/dashboard/medico/configuracion\");\r\n    } else {\r\n      setProfileModalOpen(true);\r\n    }\r\n  };\r\n\r\n  // Configurar menú según el rol\r\n  const dashboardRoute = userRole === \"secretaria\"\r\n    ? \"/dashboard/secretaria\"\r\n    : userRole === \"medico\"\r\n      ? \"/dashboard/medico\"\r\n      : \"/dashboard/paciente\";\r\n\r\n  const menuGroups = userRole === \"secretaria\"\r\n    ? [\r\n      {\r\n        label: \"Principal\",\r\n        items: [\r\n          ...(secretaryPermissions?.can_view_agenda ? [\r\n            { key: \"agenda\", label: \"Agenda\", icon: \"Calendar\", route: \"/dashboard/secretaria/agenda\" }\r\n          ] : []),\r\n          ...(secretaryPermissions?.can_view_patients ? [\r\n            { key: \"pacientes\", label: \"Pacientes\", icon: \"User\", route: \"/dashboard/secretaria/pacientes\" }\r\n          ] : []),\r\n          ...(secretaryPermissions?.can_send_messages ? [\r\n            { key: \"mensajes\", label: \"Mensajes\", icon: \"MessageSquare\", route: \"/dashboard/secretaria/mensajes\" }\r\n          ] : []),\r\n        ],\r\n      },\r\n    ].filter(group => group.items.length > 0)\r\n    : userRole === \"medico\"\r\n      ? [\r\n        {\r\n          label: \"Principal\",\r\n          items: [\r\n            { key: \"citas\", label: \"Agenda\", icon: \"Calendar\", route: \"/dashboard/medico/citas\" },\r\n            { key: \"consulta\", label: \"Consulta\", icon: \"Stethoscope\", route: \"/dashboard/medico/consulta\" },\r\n            { key: \"pacientes\", label: \"Pacientes\", icon: \"User\", route: \"/dashboard/medico/pacientes\" },\r\n            { key: \"mensajeria\", label: \"Mensajes\", icon: \"MessageSquare\", route: \"/dashboard/medico/mensajeria\" },\r\n            { key: \"telemedicina\", label: \"Telemedicina\", icon: \"Video\", route: \"/dashboard/medico/telemedicina\" },\r\n            { key: \"recipes\", label: \"Recipes\", icon: \"Pill\", route: \"/dashboard/medico/recetas\" },\r\n            { key: \"estadisticas\", label: \"Estadísticas\", icon: \"Activity\", route: \"/dashboard/medico/estadisticas\" },\r\n          ],\r\n        },\r\n      ]\r\n      : [\r\n        {\r\n          label: \"Principal\",\r\n          items: Object.entries(PATIENT_MODULE_CONFIG)\r\n            .filter(([key]) => key !== \"configuracion\") // Excluir configuración del menú\r\n            .map(([key, config]) => ({\r\n              key,\r\n              ...config,\r\n            })),\r\n        },\r\n      ];\r\n\r\n  const handleLogout = async () => {\r\n    await signOut();\r\n    window.location.href = \"/login\";\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-background\">\r\n      {/* Mobile Header - Estilo Supabase */}\r\n      <DashboardMobileHeader\r\n        dashboardRoute={dashboardRoute}\r\n        onMenuClick={() => setMobileSidebarOpen(true)}\r\n        onSearchClick={() => {\r\n          // TODO: Implementar búsqueda\r\n          console.log(\"Search clicked\");\r\n        }}\r\n      />\r\n\r\n      {/* Desktop Header - Solo para médicos - Full Width */}\r\n      {userRole === \"medico\" && (\r\n        <DashboardHeader\r\n          userName={userName}\r\n          userEmail={userEmail}\r\n          doctorProfile={doctorProfile}\r\n          onTourClick={() => startTour(\"dashboard-overview\")}\r\n          onChatClick={() => {\r\n            document.dispatchEvent(new CustomEvent(\"toggle-chat\"));\r\n          }}\r\n          megaMenu={megaMenuConfig}\r\n          className=\"hidden md:flex\"\r\n        />\r\n      )}\r\n\r\n      {/* Layout con Sidebar y Contenido */}\r\n      <div className=\"flex\" style={{ minHeight: userRole === \"medico\" ? \"calc(100vh - 48px)\" : \"100vh\" }}>\r\n        {/* Desktop Sidebar */}\r\n        <DashboardSidebar\r\n          userName={userName}\r\n          userEmail={userEmail}\r\n          menuGroups={menuGroups}\r\n          dashboardRoute={dashboardRoute}\r\n          onProfileClick={handleProfileClick}\r\n          onLogout={handleLogout}\r\n        />\r\n\r\n        {/* Mobile Sidebar */}\r\n        <DashboardMobileSidebar\r\n          isOpen={mobileSidebarOpen}\r\n          onClose={() => setMobileSidebarOpen(false)}\r\n          userName={userName}\r\n          userEmail={userEmail}\r\n          menuGroups={menuGroups}\r\n          dashboardRoute={dashboardRoute}\r\n          onProfileClick={handleMobileProfileClick}\r\n          onLogout={handleLogout}\r\n        />\r\n\r\n        {/* Main Content - Con ajuste dinámico para sidebar */}\r\n        <SidebarAwareContent userRole={userRole}>\r\n          {children}\r\n        </SidebarAwareContent>\r\n      </div>\r\n\r\n      {/* User Profile Modal - Solo para pacientes y secretarias */}\r\n      {userRole !== \"medico\" && (\r\n        <UserProfileModal\r\n          isOpen={profileModalOpen}\r\n          onClose={() => setProfileModalOpen(false)}\r\n          userName={userName}\r\n          userEmail={userEmail}\r\n          userId={userId}\r\n        />\r\n      )}\r\n\r\n      {/* Chat Widget */}\r\n      <ChatWidget hideTrigger={userRole === \"medico\"} />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\layout\\dashboard-mega-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\layout\\dashboard-mobile-header.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\layout\\dashboard-mobile-sidebar.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userEmail' is assigned a value but never used.","line":62,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":62,"endColumn":12}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport Link from \"next/link\";\r\nimport { usePathname } from \"next/navigation\";\r\nimport {\r\n  X,\r\n  LogOut,\r\n  User,\r\n  Calendar,\r\n  FileText,\r\n  Pill,\r\n  Activity,\r\n  MessageSquare,\r\n  Video,\r\n  Stethoscope,\r\n  Home,\r\n} from \"lucide-react\";\r\nimport { Avatar, AvatarFallback } from \"@red-salud/ui\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\nconst iconMap: Record<string, React.ComponentType<{ className?: string }>> = {\r\n  User,\r\n  Calendar,\r\n  FileText,\r\n  Pill,\r\n  Activity,\r\n  MessageSquare,\r\n  Video,\r\n  Stethoscope,\r\n  Home,\r\n};\r\n\r\nexport interface MenuItem {\r\n  key: string;\r\n  label: string;\r\n  icon: string;\r\n  route: string;\r\n  color?: string;\r\n}\r\n\r\nexport interface MenuGroup {\r\n  label: string;\r\n  items: MenuItem[];\r\n}\r\n\r\nexport interface DashboardMobileSidebarProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  userName?: string;\r\n  userEmail?: string;\r\n  menuGroups: MenuGroup[];\r\n  dashboardRoute: string;\r\n  onProfileClick?: () => void;\r\n  onLogout?: () => void;\r\n}\r\n\r\nexport function DashboardMobileSidebar({\r\n  isOpen,\r\n  onClose,\r\n  userName = \"Usuario\",\r\n  userEmail = \"usuario@email.com\",\r\n  menuGroups,\r\n  dashboardRoute,\r\n  onProfileClick,\r\n  onLogout,\r\n}: DashboardMobileSidebarProps) {\r\n  const pathname = usePathname();\r\n\r\n  const isActive = (route: string) => {\r\n    return pathname === route;\r\n  };\r\n\r\n  // Aplanar todos los items\r\n  const allItems = menuGroups.flatMap(group => group.items);\r\n\r\n  return (\r\n    <AnimatePresence mode=\"wait\">\r\n      {isOpen && (\r\n        <>\r\n          {/* Overlay con backdrop blur */}\r\n          <motion.div\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            exit={{ opacity: 0 }}\r\n            transition={{ duration: 0.2 }}\r\n            onClick={onClose}\r\n            className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-40 md:hidden\"\r\n          />\r\n\r\n          {/* Sidebar */}\r\n          <motion.aside\r\n            initial={{ x: \"-100%\" }}\r\n            animate={{ x: 0 }}\r\n            exit={{ x: \"-100%\" }}\r\n            transition={{ \r\n              type: \"spring\", \r\n              damping: 30, \r\n              stiffness: 300,\r\n              mass: 0.8\r\n            }}\r\n            className=\"fixed inset-y-0 left-0 z-50 w-72 bg-sidebar shadow-2xl md:hidden border-r border-sidebar-border\"\r\n          >\r\n            <div className=\"flex h-full flex-col\">\r\n              {/* Header - Logo Red-Salud */}\r\n              <div className=\"flex items-center justify-between border-b border-sidebar-border p-4 h-16\">\r\n                <Link href={dashboardRoute} onClick={onClose}>\r\n                  <motion.div \r\n                    className=\"flex items-center gap-3 cursor-pointer\"\r\n                    whileTap={{ scale: 0.95 }}\r\n                  >\r\n                    <div className=\"bg-gradient-to-br from-blue-600 to-teal-600 text-white size-8 rounded-lg flex items-center justify-center font-bold text-sm\">\r\n                      RS\r\n                    </div>\r\n                    <span className=\"text-base font-bold text-sidebar-foreground\">\r\n                      Red-Salud\r\n                    </span>\r\n                  </motion.div>\r\n                </Link>\r\n                <motion.button\r\n                  whileTap={{ scale: 0.9 }}\r\n                  onClick={onClose}\r\n                  className=\"p-2 hover:bg-sidebar-accent rounded-lg transition-colors text-sidebar-foreground/70 hover:text-sidebar-foreground\"\r\n                >\r\n                  <X className=\"size-5\" />\r\n                </motion.button>\r\n              </div>\r\n\r\n              {/* Content - Navigation */}\r\n              <div className=\"flex-1 overflow-y-auto p-4\">\r\n                <nav className=\"space-y-1\">\r\n                  {allItems.map((item, index) => {\r\n                    const Icon = iconMap[item.icon];\r\n                    const active = isActive(item.route);\r\n\r\n                    return (\r\n                      <motion.div\r\n                        key={item.key}\r\n                        initial={{ opacity: 0, x: -20 }}\r\n                        animate={{ opacity: 1, x: 0 }}\r\n                        transition={{ delay: index * 0.03 }}\r\n                      >\r\n                        <Link href={item.route} onClick={onClose}>\r\n                          <motion.button\r\n                            whileTap={{ scale: 0.98 }}\r\n                            className={cn(\r\n                              \"flex w-full items-center gap-3 px-4 py-3 rounded-lg transition-all text-sm font-medium\",\r\n                              \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\r\n                              active && \"bg-sidebar-accent text-sidebar-primary shadow-sm ring-1 ring-sidebar-ring/50\",\r\n                              !active && \"text-sidebar-foreground/80\"\r\n                            )}\r\n                          >\r\n                            {Icon && (\r\n                              <Icon\r\n                                className={cn(\r\n                                  \"size-5 shrink-0\",\r\n                                  active ? \"text-sidebar-primary\" : \"text-sidebar-foreground/70\"\r\n                                )}\r\n                              />\r\n                            )}\r\n                            <span className={active ? \"text-sidebar-primary font-semibold\" : \"text-sidebar-foreground/90\"}>\r\n                              {item.label}\r\n                            </span>\r\n                          </motion.button>\r\n                        </Link>\r\n                      </motion.div>\r\n                    );\r\n                  })}\r\n                </nav>\r\n              </div>\r\n\r\n              {/* Footer - User Profile & Logout */}\r\n              <div className=\"border-t border-sidebar-border p-4 space-y-2 bg-sidebar\">\r\n                {/* User Profile Button */}\r\n                <motion.button\r\n                  initial={{ opacity: 0, y: 10 }}\r\n                  animate={{ opacity: 1, y: 0 }}\r\n                  transition={{ delay: 0.2 }}\r\n                  whileTap={{ scale: 0.98 }}\r\n                  onClick={() => {\r\n                    onProfileClick?.();\r\n                    onClose();\r\n                  }}\r\n                  className=\"flex w-full items-center gap-3 px-4 py-3 rounded-lg hover:bg-sidebar-accent transition-all text-sidebar-foreground/80 hover:text-sidebar-foreground\"\r\n                >\r\n                  <Avatar className=\"size-9 shrink-0 ring-2 ring-sidebar-border\">\r\n                    <AvatarFallback className=\"bg-gradient-to-br from-sidebar-primary to-sidebar-primary/80 text-sidebar-primary-foreground text-xs font-bold\">\r\n                      {userName.substring(0, 2).toUpperCase()}\r\n                    </AvatarFallback>\r\n                  </Avatar>\r\n                  <div className=\"flex-1 text-left\">\r\n                    <div className=\"text-sm font-semibold text-sidebar-foreground truncate\">\r\n                      {userName}\r\n                    </div>\r\n                    <div className=\"text-xs text-sidebar-foreground/50\">\r\n                      Configuración\r\n                    </div>\r\n                  </div>\r\n                </motion.button>\r\n\r\n                {/* Logout Button */}\r\n                <motion.button\r\n                  initial={{ opacity: 0, y: 10 }}\r\n                  animate={{ opacity: 1, y: 0 }}\r\n                  transition={{ delay: 0.22 }}\r\n                  whileTap={{ scale: 0.98 }}\r\n                  onClick={() => {\r\n                    onLogout?.();\r\n                    onClose();\r\n                  }}\r\n                  className=\"flex w-full items-center gap-3 px-4 py-3 rounded-lg hover:bg-destructive/10 transition-all text-destructive/80 hover:text-destructive text-sm font-medium\"\r\n                >\r\n                  <LogOut className=\"size-5\" />\r\n                  <span>Cerrar Sesión</span>\r\n                </motion.button>\r\n\r\n                {/* Copyright */}\r\n                <motion.div\r\n                  initial={{ opacity: 0 }}\r\n                  animate={{ opacity: 1 }}\r\n                  transition={{ delay: 0.24 }}\r\n                  className=\"text-xs text-sidebar-foreground/40 text-center pt-2\"\r\n                >\r\n                  © 2025 Red-Salud\r\n                </motion.div>\r\n              </div>\r\n            </div>\r\n          </motion.aside>\r\n        </>\r\n      )}\r\n    </AnimatePresence>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\layout\\dashboard-sidebar.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'LogOut' is defined but never used.","line":13,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PanelLeftDashed' is defined but never used.","line":16,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'onLogout' is defined but never used.","line":63,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":63,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport Link from \"next/link\";\r\nimport { usePathname } from \"next/navigation\";\r\nimport {\r\n  User,\r\n  Calendar,\r\n  FileText,\r\n  Pill,\r\n  Activity,\r\n  MessageSquare,\r\n  Video,\r\n  LogOut,\r\n  Stethoscope,\r\n  Home,\r\n  PanelLeftDashed,\r\n} from \"lucide-react\";\r\nimport { Avatar, AvatarFallback } from \"@red-salud/ui\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { useSidebarState } from \"@/hooks/use-sidebar-state\";\r\nimport { SidebarModeSelector } from \"./sidebar-mode-selector\";\r\n\r\n// Mapa de iconos\r\nconst iconMap: Record<string, React.ComponentType<{ className?: string }>> = {\r\n  User,\r\n  Calendar,\r\n  FileText,\r\n  Pill,\r\n  Activity,\r\n  MessageSquare,\r\n  Video,\r\n  Stethoscope,\r\n  Home,\r\n};\r\n\r\nexport interface MenuItem {\r\n  key: string;\r\n  label: string;\r\n  icon: string;\r\n  route: string;\r\n  color?: string;\r\n}\r\n\r\nexport interface MenuGroup {\r\n  label: string;\r\n  items: MenuItem[];\r\n}\r\n\r\nexport interface DashboardSidebarProps {\r\n  userName?: string;\r\n  userEmail?: string;\r\n  menuGroups: MenuGroup[];\r\n  dashboardRoute: string;\r\n  onProfileClick?: () => void;\r\n  onLogout?: () => void;\r\n}\r\n\r\nexport function DashboardSidebar({\r\n  userName = \"Usuario\",\r\n  menuGroups,\r\n  dashboardRoute,\r\n  onProfileClick,\r\n  onLogout,\r\n}: DashboardSidebarProps) {\r\n  const { mode, isExpanded, handleMouseEnter, handleMouseLeave } = useSidebarState();\r\n  const pathname = usePathname();\r\n\r\n  const isActive = (route: string) => {\r\n    return pathname === route;\r\n  };\r\n\r\n  // Aplanar todos los items de todos los grupos\r\n  const allItems = menuGroups.flatMap(group => group.items);\r\n\r\n  return (\r\n    <>\r\n      {/* Zona de activación para hover - más ancha para evitar flickering */}\r\n      {mode === \"hover\" && (\r\n        <div\r\n          className=\"fixed left-0 top-12 h-[calc(100vh-48px)] w-16 z-40\"\r\n          onMouseEnter={handleMouseEnter}\r\n          onMouseLeave={handleMouseLeave}\r\n        />\r\n      )}\r\n\r\n      {/* Sidebar Content - Fixed Position debajo del header */}\r\n      <div\r\n        className={cn(\r\n          \"fixed left-0 flex flex-col glass border-r border-sidebar-border/50 transition-all duration-200 ease-out\",\r\n          isExpanded ? \"w-64\" : \"w-12\",\r\n          // Posicionar debajo del header (48px de altura)\r\n          \"top-12 h-[calc(100vh-48px)]\",\r\n          // En modo hover, z-index más alto para overlay\r\n          mode === \"hover\" ? \"z-50\" : \"z-40\",\r\n          \"hidden md:flex\"\r\n        )}\r\n        data-state={isExpanded ? \"expanded\" : \"collapsed\"}\r\n        data-collapsible=\"icon\"\r\n        data-variant=\"sidebar\"\r\n        data-side=\"left\"\r\n        // Solo agregar handlers si está en modo hover\r\n        onMouseEnter={mode === \"hover\" ? handleMouseEnter : undefined}\r\n        onMouseLeave={mode === \"hover\" ? handleMouseLeave : undefined}\r\n      >\r\n        <div\r\n          data-sidebar=\"sidebar\"\r\n          className=\"flex h-full w-full flex-col\"\r\n        >\r\n          {/* Content - Scrollable */}\r\n          <div\r\n            data-sidebar=\"content\"\r\n            className={cn(\r\n              \"flex min-h-0 flex-1 flex-col gap-2 overflow-y-auto overflow-x-hidden\",\r\n              !isExpanded && \"overflow-hidden\",\r\n              // Custom scrollbar styling\r\n              \"scrollbar-thin scrollbar-track-sidebar scrollbar-thumb-sidebar-accent hover:scrollbar-thumb-sidebar-accent/80\"\r\n            )}\r\n          >\r\n            <div>\r\n              <ul\r\n                data-sidebar=\"menu\"\r\n                className=\"flex w-full min-w-0 flex-col gap-1\"\r\n              >\r\n                <div\r\n                  data-sidebar=\"group\"\r\n                  className=\"relative flex w-full min-w-0 flex-col p-2 gap-0.5\"\r\n                >\r\n                  {/* Logo Red-Salud */}\r\n                  <li data-sidebar=\"menu-item\" className=\"group/menu-item relative mb-1\">\r\n                    <Link href={dashboardRoute}>\r\n                      <button\r\n                        data-sidebar=\"menu-button\"\r\n                        data-size=\"default\"\r\n                        data-active={isActive(dashboardRoute)}\r\n                        data-has-icon=\"true\"\r\n                        tabIndex={0}\r\n                        title={!isExpanded ? \"Red-Salud\" : undefined}\r\n                        className={cn(\r\n                          \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md py-2 px-1.5 text-left outline-none ring-sidebar-ring\",\r\n                          \"transition-[width,height,padding] transition-colors duration-200 ease-out focus-visible:ring-2\",\r\n                          \"active:bg-sidebar-accent active:text-sidebar-accent-foreground\",\r\n                          \"disabled:pointer-events-none disabled:opacity-50\",\r\n                          \"group-has-[[data-sidebar=menu-action]]/menu-item:pr-8\",\r\n                          \"aria-disabled:pointer-events-none aria-disabled:opacity-50\",\r\n                          \"data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium\",\r\n                          \"data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground\",\r\n                          \"[&>span:last-child]:truncate [&>svg]:size-5 [&>svg]:shrink-0\",\r\n                          \"text-sidebar-foreground/60 data-[active=true]:text-sidebar-foreground\",\r\n                          \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\r\n                          \"h-8 text-sm\",\r\n                          !isExpanded && \"!size-8 !pl-1.5 !pr-2 justify-center\"\r\n                        )}\r\n                      >\r\n                        <div className=\"bg-gradient-to-br from-blue-600 to-teal-600 text-white size-5 rounded-md flex items-center justify-center font-bold text-[10px] shrink-0\">\r\n                          RS\r\n                        </div>\r\n                        {isExpanded && <span>Red-Salud</span>}\r\n                      </button>\r\n                    </Link>\r\n\r\n                    {/* Tooltip para logo cuando está colapsado */}\r\n                    {!isExpanded && (\r\n                      <div className=\"absolute left-full top-1/2 -translate-y-1/2 ml-2 px-2 py-1 bg-popover text-popover-foreground text-xs rounded-md shadow-md border opacity-0 pointer-events-none group-hover/menu-item:opacity-100 transition-opacity duration-200 whitespace-nowrap z-50\">\r\n                        Red-Salud\r\n                      </div>\r\n                    )}\r\n                  </li>\r\n\r\n                  {/* Menu Items */}\r\n                  {allItems.map((item) => {\r\n                    const Icon = iconMap[item.icon];\r\n                    const active = isActive(item.route);\r\n\r\n                    return (\r\n                      <li\r\n                        key={item.key}\r\n                        data-sidebar=\"menu-item\"\r\n                        className=\"group/menu-item relative\"\r\n                      >\r\n                        <Link href={item.route}>\r\n                          <button\r\n                            data-sidebar=\"menu-button\"\r\n                            data-size=\"default\"\r\n                            data-active={active}\r\n                            data-has-icon=\"true\"\r\n                            tabIndex={0}\r\n                            title={!isExpanded ? item.label : undefined}\r\n                            className={cn(\r\n                              \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md py-2 px-1.5 text-left outline-none ring-sidebar-ring\",\r\n                              \"transition-[width,height,padding] transition-colors duration-200 ease-out focus-visible:ring-2\",\r\n                              \"active:bg-sidebar-accent active:text-sidebar-accent-foreground\",\r\n                              \"disabled:pointer-events-none disabled:opacity-50\",\r\n                              \"group-has-[[data-sidebar=menu-action]]/menu-item:pr-8\",\r\n                              \"aria-disabled:pointer-events-none aria-disabled:opacity-50\",\r\n                              \"data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground\",\r\n                              \"data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground\",\r\n                              \"[&>span:last-child]:truncate [&>svg]:size-5 [&>svg]:shrink-0\",\r\n                              \"text-sidebar-foreground/60 data-[active=true]:text-sidebar-foreground\",\r\n                              \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\r\n                              \"h-8 text-sm\",\r\n                              !isExpanded && \"!size-8 !pl-1.5 !pr-2 justify-center\"\r\n                            )}\r\n                          >\r\n                            {Icon && <Icon />}\r\n                            {isExpanded && <span>{item.label}</span>}\r\n                          </button>\r\n                        </Link>\r\n\r\n                        {/* Tooltip para sidebar colapsado */}\r\n                        {!isExpanded && (\r\n                          <div className=\"absolute left-full top-1/2 -translate-y-1/2 ml-2 px-2 py-1 bg-popover text-popover-foreground text-xs rounded-md shadow-md border opacity-0 pointer-events-none group-hover/menu-item:opacity-100 transition-opacity duration-200 whitespace-nowrap z-50\">\r\n                            {item.label}\r\n                          </div>\r\n                        )}\r\n                      </li>\r\n                    );\r\n                  })}\r\n                </div>\r\n              </ul>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Footer */}\r\n          <div data-sidebar=\"footer\" className=\"flex flex-col gap-2 p-2\">\r\n            {/* User Profile - Botón de Configuración */}\r\n            <button\r\n              onClick={onProfileClick}\r\n              className={cn(\r\n                \"flex w-full items-center gap-2 overflow-hidden rounded-md py-2 px-1.5 text-left outline-none transition-colors duration-200 ease-out\",\r\n                \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\r\n                \"focus-visible:ring-2 ring-sidebar-ring\",\r\n                \"text-sidebar-foreground/60\",\r\n                \"h-10\",\r\n                !isExpanded && \"px-1.5\"\r\n              )}\r\n              title={!isExpanded ? \"Configuración\" : undefined}\r\n            >\r\n              <Avatar className=\"size-6 shrink-0\">\r\n                <AvatarFallback className=\"bg-gradient-to-br from-sidebar-primary to-sidebar-primary/80 text-sidebar-primary-foreground font-bold text-xs\">\r\n                  {userName.substring(0, 2).toUpperCase()}\r\n                </AvatarFallback>\r\n              </Avatar>\r\n              {isExpanded && (\r\n                <div className=\"flex-1 overflow-hidden\">\r\n                  <div className=\"text-xs font-medium text-sidebar-foreground truncate\">\r\n                    {userName}\r\n                  </div>\r\n                  <div className=\"text-[10px] text-sidebar-foreground/50 truncate\">\r\n                    Configuración\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </button>\r\n\r\n            {/* Sidebar Mode Selector */}\r\n            <div\r\n              data-sidebar=\"group\"\r\n              className=\"relative flex w-full min-w-0 flex-col p-0\"\r\n            >\r\n              <SidebarModeSelector isCollapsed={!isExpanded} />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\layout\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\layout\\sidebar-aware-content.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\layout\\sidebar-aware-content.tsx:24:5\n  22 |     const savedMode = localStorage.getItem(\"sidebar-mode\");\n  23 |     const mode = savedMode || \"hover\";\n> 24 |     setCurrentMode(mode);\n     |     ^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  25 |     \n  26 |     // Calcular el ancho inicial según el modo\n  27 |     let initialWidth = 0;","line":24,"column":5,"nodeType":null,"endLine":24,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isExpanded' is assigned a value but never used.","line":39,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":39,"endColumn":40}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\ninterface SidebarAwareContentProps {\r\n  children: React.ReactNode;\r\n  className?: string;\r\n  userRole?: string;\r\n}\r\n\r\nexport function SidebarAwareContent({ \r\n  children, \r\n  className,\r\n  userRole \r\n}: SidebarAwareContentProps) {\r\n  const [sidebarWidth, setSidebarWidth] = useState(0); // Default 0 para modo hover\r\n  const [currentMode, setCurrentMode] = useState<string>(\"hover\");\r\n\r\n  useEffect(() => {\r\n    // Leer el estado inicial del localStorage\r\n    const savedMode = localStorage.getItem(\"sidebar-mode\");\r\n    const mode = savedMode || \"hover\";\r\n    setCurrentMode(mode);\r\n    \r\n    // Calcular el ancho inicial según el modo\r\n    let initialWidth = 0;\r\n    if (mode === \"expanded\") {\r\n      initialWidth = 256;\r\n    } else if (mode === \"collapsed\") {\r\n      initialWidth = 48;\r\n    } else {\r\n      initialWidth = 0; // hover no ocupa espacio\r\n    }\r\n    setSidebarWidth(initialWidth);\r\n\r\n    // Escuchar cambios en el sidebar\r\n    const handleSidebarModeChange = (event: CustomEvent) => {\r\n      const { mode: newMode, isExpanded } = event.detail;\r\n      setCurrentMode(newMode);\r\n      \r\n      // Ajustar el ancho según el modo\r\n      if (newMode === \"hover\") {\r\n        setSidebarWidth(0); // En modo hover no ocupa espacio\r\n      } else if (newMode === \"expanded\") {\r\n        setSidebarWidth(256); // Expandido\r\n      } else if (newMode === \"collapsed\") {\r\n        setSidebarWidth(48); // Colapsado\r\n      }\r\n    };\r\n\r\n    window.addEventListener(\"sidebar-mode-change\", handleSidebarModeChange as EventListener);\r\n\r\n    return () => {\r\n      window.removeEventListener(\"sidebar-mode-change\", handleSidebarModeChange as EventListener);\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <main \r\n      className={cn(\r\n        \"flex-1 min-h-full transition-all duration-200 ease-out\",\r\n        className\r\n      )}\r\n      style={{ \r\n        marginLeft: currentMode === \"hover\" ? \"0px\" : `${sidebarWidth}px`,\r\n        width: currentMode === \"hover\" ? \"100%\" : `calc(100% - ${sidebarWidth}px)`\r\n      }}\r\n    >\r\n      <div className={userRole === \"medico\" ? \"\" : \"pt-14 md:pt-0\"}>\r\n        {children}\r\n      </div>\r\n    </main>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\layout\\sidebar-mode-selector.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChevronDown' is defined but never used.","line":4,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":38},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isCollapsed' is defined but never used.","line":37,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":37,"endColumn":50},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'currentConfig' is assigned a value but never used.","line":41,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":41,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { PanelLeftDashed, ChevronDown, Maximize2, Minimize2, MousePointer } from \"lucide-react\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport {\r\n  DropdownMenu,\r\n  DropdownMenuContent,\r\n  DropdownMenuItem,\r\n  DropdownMenuTrigger,\r\n} from \"@red-salud/ui\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { useSidebarState, type SidebarMode } from \"@/hooks/use-sidebar-state\";\r\n\r\nconst modeConfig = {\r\n  expanded: {\r\n    label: \"Expanded\",\r\n    icon: Maximize2,\r\n    description: \"Sidebar siempre expandido\"\r\n  },\r\n  collapsed: {\r\n    label: \"Collapsed\", \r\n    icon: Minimize2,\r\n    description: \"Sidebar siempre colapsado\"\r\n  },\r\n  hover: {\r\n    label: \"Expand on hover\",\r\n    icon: MousePointer,\r\n    description: \"Se expande al pasar el mouse\"\r\n  }\r\n};\r\n\r\ninterface SidebarModeSelectorProps {\r\n  isCollapsed?: boolean;\r\n}\r\n\r\nexport function SidebarModeSelector({ isCollapsed }: SidebarModeSelectorProps) {\r\n  const { mode, setMode } = useSidebarState();\r\n  const [isOpen, setIsOpen] = useState(false);\r\n\r\n  const currentConfig = modeConfig[mode];\r\n\r\n  const handleModeChange = (newMode: SidebarMode) => {\r\n    setIsOpen(false);\r\n    setMode(newMode);\r\n  };\r\n\r\n  return (\r\n    <DropdownMenu open={isOpen} onOpenChange={setIsOpen}>\r\n      <DropdownMenuTrigger asChild>\r\n        <button\r\n          data-size=\"tiny\"\r\n          type=\"button\"\r\n          className={cn(\r\n            \"relative justify-center cursor-pointer inline-flex items-center space-x-2 text-center font-regular\",\r\n            \"ease-out duration-200 rounded-md outline-none transition-all outline-0\",\r\n            \"focus-visible:outline-4 focus-visible:outline-offset-1\",\r\n            \"border text-foreground hover:bg-surface-300 shadow-none\",\r\n            \"focus-visible:outline-border-strong data-[state=open]:bg-surface-300 data-[state=open]:outline-border-strong\",\r\n            \"border-transparent\",\r\n            \"text-xs py-1 h-[26px] w-min px-1.5 mx-0.5 !px-2\"\r\n          )}\r\n          title=\"Sidebar control\"\r\n        >\r\n          <div className=\"[&_svg]:h-[14px] [&_svg]:w-[14px] text-foreground-lighter\">\r\n            <PanelLeftDashed />\r\n          </div>\r\n        </button>\r\n      </DropdownMenuTrigger>\r\n      \r\n      <DropdownMenuContent \r\n        align=\"start\" \r\n        side=\"right\"\r\n        className=\"w-56 ml-2\"\r\n        sideOffset={8}\r\n      >\r\n        <div className=\"px-2 py-1.5 text-sm font-semibold text-muted-foreground\">\r\n          Sidebar control\r\n        </div>\r\n        \r\n        {Object.entries(modeConfig).map(([modeKey, config]) => {\r\n          const Icon = config.icon;\r\n          const isSelected = mode === modeKey;\r\n          \r\n          return (\r\n            <DropdownMenuItem\r\n              key={modeKey}\r\n              onClick={() => handleModeChange(modeKey as SidebarMode)}\r\n              className={cn(\r\n                \"flex items-center gap-3 px-2 py-2 cursor-pointer\",\r\n                isSelected && \"bg-accent text-accent-foreground\"\r\n              )}\r\n            >\r\n              <div className=\"flex items-center gap-3 flex-1\">\r\n                <Icon className=\"h-4 w-4\" />\r\n                <div className=\"flex flex-col\">\r\n                  <span className=\"text-sm font-medium\">{config.label}</span>\r\n                  <span className=\"text-xs text-muted-foreground\">{config.description}</span>\r\n                </div>\r\n              </div>\r\n              {isSelected && (\r\n                <div className=\"w-2 h-2 rounded-full bg-primary\" />\r\n              )}\r\n            </DropdownMenuItem>\r\n          );\r\n        })}\r\n      </DropdownMenuContent>\r\n    </DropdownMenu>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medical-profile-preview.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Shield' is defined but never used.","line":14,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":9}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@red-salud/ui\";\r\nimport {\r\n  AlertCircle,\r\n  Heart,\r\n  Pill,\r\n  Scissors,\r\n  FileText,\r\n  Share2,\r\n  Shield,\r\n  User,\r\n  Phone,\r\n  Droplet,\r\n} from \"lucide-react\";\r\n\r\n// Componente de preview con datos de ejemplo\r\nexport default function MedicalProfilePreview() {\r\n  const mockProfile = {\r\n    nombre_completo: \"Juan Pérez García\",\r\n    fecha_nacimiento: \"1985-03-15\",\r\n    cedula: \"V-12345678\",\r\n    ciudad: \"Caracas\",\r\n    grupo_sanguineo: \"O+\",\r\n    alergias: [\"Penicilina\", \"Mariscos\", \"Polen\"],\r\n    enfermedades_cronicas: [\"Hipertensión\", \"Diabetes Tipo 2\"],\r\n    medicamentos_actuales: \"Metformina 850mg - 2 veces al día\\nLosartán 50mg - 1 vez al día\",\r\n    cirugias_previas: \"Apendicectomía (2010)\\nCirugía de rodilla (2018)\",\r\n    contacto_emergencia_nombre: \"María Pérez\",\r\n    contacto_emergencia_telefono: \"+58 412-1234567\",\r\n    contacto_emergencia_relacion: \"Esposa\",\r\n  };\r\n\r\n  const mockDocuments = [\r\n    {\r\n      id: 1,\r\n      document_name: \"Análisis de Sangre - Marzo 2024\",\r\n      document_type: \"Laboratorio\",\r\n      created_at: \"2024-03-15\",\r\n    },\r\n    {\r\n      id: 2,\r\n      document_name: \"Radiografía de Tórax\",\r\n      document_type: \"Imagen\",\r\n      created_at: \"2024-02-20\",\r\n    },\r\n    {\r\n      id: 3,\r\n      document_name: \"Informe Cardiológico\",\r\n      document_type: \"Informe Médico\",\r\n      created_at: \"2024-01-10\",\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex items-start justify-between\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold\">Perfil Médico</h1>\r\n          <p className=\"text-muted-foreground mt-1\">\r\n            Información médica para compartir con profesionales de salud\r\n          </p>\r\n        </div>\r\n        <Button>\r\n          <Share2 className=\"mr-2 h-4 w-4\" />\r\n          Compartir Perfil\r\n        </Button>\r\n      </div>\r\n\r\n      <Tabs defaultValue=\"medical\" className=\"space-y-6\">\r\n        <TabsList>\r\n          <TabsTrigger value=\"medical\">Información Médica</TabsTrigger>\r\n          <TabsTrigger value=\"documents\">Documentos</TabsTrigger>\r\n          <TabsTrigger value=\"sharing\">Compartir</TabsTrigger>\r\n        </TabsList>\r\n\r\n        {/* Información Médica */}\r\n        <TabsContent value=\"medical\" className=\"space-y-6\">\r\n          {/* Datos Básicos */}\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"flex items-center gap-2\">\r\n                <User className=\"h-5 w-5\" />\r\n                Información Básica\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-4\">\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <div>\r\n                  <p className=\"text-sm text-muted-foreground\">Nombre</p>\r\n                  <p className=\"font-medium\">{mockProfile.nombre_completo}</p>\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-sm text-muted-foreground\">Fecha de Nacimiento</p>\r\n                  <p className=\"font-medium\">\r\n                    {new Date(mockProfile.fecha_nacimiento).toLocaleDateString(\"es-ES\")}\r\n                  </p>\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-sm text-muted-foreground\">Cédula</p>\r\n                  <p className=\"font-medium\">{mockProfile.cedula}</p>\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-sm text-muted-foreground\">Ciudad</p>\r\n                  <p className=\"font-medium\">{mockProfile.ciudad}</p>\r\n                </div>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* Grupo Sanguíneo */}\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"flex items-center gap-2\">\r\n                <Droplet className=\"h-5 w-5 text-red-500\" />\r\n                Grupo Sanguíneo\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <Badge variant=\"outline\" className=\"text-lg px-4 py-2\">\r\n                {mockProfile.grupo_sanguineo}\r\n              </Badge>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* Alergias */}\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"flex items-center gap-2\">\r\n                <AlertCircle className=\"h-5 w-5 text-red-500\" />\r\n                Alergias\r\n              </CardTitle>\r\n              <CardDescription>\r\n                Reacciones adversas conocidas a medicamentos o sustancias\r\n              </CardDescription>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"flex flex-wrap gap-2\">\r\n                {mockProfile.alergias.map((alergia, index) => (\r\n                  <Badge key={index} variant=\"destructive\">\r\n                    {alergia}\r\n                  </Badge>\r\n                ))}\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* Enfermedades Crónicas */}\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"flex items-center gap-2\">\r\n                <Heart className=\"h-5 w-5 text-blue-500\" />\r\n                Condiciones Médicas Crónicas\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"flex flex-wrap gap-2\">\r\n                {mockProfile.enfermedades_cronicas.map((enfermedad, index) => (\r\n                  <Badge key={index} variant=\"secondary\">\r\n                    {enfermedad}\r\n                  </Badge>\r\n                ))}\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* Medicamentos Actuales */}\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"flex items-center gap-2\">\r\n                <Pill className=\"h-5 w-5 text-green-500\" />\r\n                Medicamentos Actuales\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <p className=\"whitespace-pre-wrap\">{mockProfile.medicamentos_actuales}</p>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* Cirugías Previas */}\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"flex items-center gap-2\">\r\n                <Scissors className=\"h-5 w-5 text-purple-500\" />\r\n                Cirugías y Procedimientos Previos\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <p className=\"whitespace-pre-wrap\">{mockProfile.cirugias_previas}</p>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* Contacto de Emergencia */}\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"flex items-center gap-2\">\r\n                <Phone className=\"h-5 w-5 text-orange-500\" />\r\n                Contacto de Emergencia\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"space-y-2\">\r\n                <div>\r\n                  <p className=\"text-sm text-muted-foreground\">Nombre</p>\r\n                  <p className=\"font-medium\">{mockProfile.contacto_emergencia_nombre}</p>\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-sm text-muted-foreground\">Teléfono</p>\r\n                  <p className=\"font-medium\">{mockProfile.contacto_emergencia_telefono}</p>\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-sm text-muted-foreground\">Relación</p>\r\n                  <p className=\"font-medium\">{mockProfile.contacto_emergencia_relacion}</p>\r\n                </div>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </TabsContent>\r\n\r\n        {/* Documentos */}\r\n        <TabsContent value=\"documents\" className=\"space-y-6\">\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"flex items-center gap-2\">\r\n                <FileText className=\"h-5 w-5\" />\r\n                Documentos Médicos\r\n              </CardTitle>\r\n              <CardDescription>\r\n                Análisis, imágenes y otros documentos médicos relevantes\r\n              </CardDescription>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"space-y-3\">\r\n                {mockDocuments.map((doc) => (\r\n                  <div\r\n                    key={doc.id}\r\n                    className=\"flex items-center justify-between p-3 border rounded-lg\"\r\n                  >\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <FileText className=\"h-5 w-5 text-muted-foreground\" />\r\n                      <div>\r\n                        <p className=\"font-medium\">{doc.document_name}</p>\r\n                        <p className=\"text-sm text-muted-foreground\">\r\n                          {doc.document_type} •{\" \"}\r\n                          {new Date(doc.created_at).toLocaleDateString(\"es-ES\")}\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                    <Button variant=\"outline\" size=\"sm\">\r\n                      Ver\r\n                    </Button>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </TabsContent>\r\n\r\n        {/* Compartir */}\r\n        <TabsContent value=\"sharing\" className=\"space-y-6\">\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle>Compartir Perfil Médico</CardTitle>\r\n              <CardDescription>\r\n                Genera enlaces temporales para compartir tu información médica con\r\n                profesionales de salud\r\n              </CardDescription>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"space-y-4\">\r\n                <div className=\"p-4 border rounded-lg bg-muted/50\">\r\n                  <h3 className=\"font-medium mb-2\">Próximamente:</h3>\r\n                  <ul className=\"space-y-2 text-sm text-muted-foreground\">\r\n                    <li>• Generar enlaces temporales con expiración</li>\r\n                    <li>• Código QR para consultas presenciales</li>\r\n                    <li>• Compartir directo con doctores de la plataforma</li>\r\n                    <li>• Control de permisos sobre información visible</li>\r\n                    <li>• Registro de accesos y notificaciones</li>\r\n                  </ul>\r\n                </div>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </TabsContent>\r\n      </Tabs>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medical-profile-view.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useState' is defined but never used.","line":3,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Separator' is defined but never used.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":294,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":294,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10719,10722],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10719,10722],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { usePatientProfile, usePatientDocuments } from \"@/hooks/use-patient-profile\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Separator } from \"@red-salud/ui\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@red-salud/ui\";\r\nimport {\r\n  AlertCircle,\r\n  Heart,\r\n  Pill,\r\n  Scissors,\r\n  FileText,\r\n  Share2,\r\n  Shield,\r\n  User,\r\n  Phone,\r\n  Droplet,\r\n} from \"lucide-react\";\r\n\r\ninterface MedicalProfileViewProps {\r\n  userId: string;\r\n  isOwner: boolean;\r\n  isShared?: boolean;\r\n}\r\n\r\nexport default function MedicalProfileView({\r\n  userId,\r\n  isOwner,\r\n  isShared = false,\r\n}: MedicalProfileViewProps) {\r\n  const { profile, loading } = usePatientProfile(userId);\r\n  const { documents } = usePatientDocuments(userId);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-[400px]\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4\"></div>\r\n          <p className=\"text-muted-foreground\">Cargando perfil médico...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!profile) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-[400px]\">\r\n        <Card className=\"max-w-md\">\r\n          <CardContent className=\"pt-6\">\r\n            <p className=\"text-center text-muted-foreground\">\r\n              No se pudo cargar el perfil médico\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex items-start justify-between\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold\">Perfil Médico</h1>\r\n          <p className=\"text-muted-foreground mt-1\">\r\n            {isShared\r\n              ? \"Vista compartida de información médica\"\r\n              : \"Información médica para compartir con profesionales de salud\"}\r\n          </p>\r\n        </div>\r\n        {isOwner && !isShared && (\r\n          <Button>\r\n            <Share2 className=\"mr-2 h-4 w-4\" />\r\n            Compartir Perfil\r\n          </Button>\r\n        )}\r\n      </div>\r\n\r\n      {isShared && (\r\n        <Card className=\"border-amber-200 bg-amber-50\">\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center gap-2 text-amber-800\">\r\n              <Shield className=\"h-5 w-5\" />\r\n              <p className=\"text-sm font-medium\">\r\n                Esta es una vista compartida. Solo se muestra información médica relevante.\r\n              </p>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      <Tabs defaultValue=\"medical\" className=\"space-y-6\">\r\n        <TabsList>\r\n          <TabsTrigger value=\"medical\">Información Médica</TabsTrigger>\r\n          <TabsTrigger value=\"documents\">Documentos</TabsTrigger>\r\n          {isOwner && <TabsTrigger value=\"sharing\">Compartir</TabsTrigger>}\r\n        </TabsList>\r\n\r\n        {/* Información Médica */}\r\n        <TabsContent value=\"medical\" className=\"space-y-6\">\r\n          {/* Datos Básicos */}\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"flex items-center gap-2\">\r\n                <User className=\"h-5 w-5\" />\r\n                Información Básica\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-4\">\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <div>\r\n                  <p className=\"text-sm text-muted-foreground\">Nombre</p>\r\n                  <p className=\"font-medium\">{profile.nombre_completo}</p>\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-sm text-muted-foreground\">Fecha de Nacimiento</p>\r\n                  <p className=\"font-medium\">\r\n                    {profile.fecha_nacimiento\r\n                      ? new Date(profile.fecha_nacimiento).toLocaleDateString(\"es-ES\")\r\n                      : \"No especificada\"}\r\n                  </p>\r\n                </div>\r\n                {!isShared && (\r\n                  <>\r\n                    <div>\r\n                      <p className=\"text-sm text-muted-foreground\">Cédula</p>\r\n                      <p className=\"font-medium\">{profile.cedula || \"No especificada\"}</p>\r\n                    </div>\r\n                    <div>\r\n                      <p className=\"text-sm text-muted-foreground\">Ciudad</p>\r\n                      <p className=\"font-medium\">{profile.ciudad || \"No especificada\"}</p>\r\n                    </div>\r\n                  </>\r\n                )}\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* Grupo Sanguíneo */}\r\n          {profile.grupo_sanguineo && (\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle className=\"flex items-center gap-2\">\r\n                  <Droplet className=\"h-5 w-5 text-red-500\" />\r\n                  Grupo Sanguíneo\r\n                </CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <Badge variant=\"outline\" className=\"text-lg px-4 py-2\">\r\n                  {profile.grupo_sanguineo}\r\n                </Badge>\r\n              </CardContent>\r\n            </Card>\r\n          )}\r\n\r\n          {/* Alergias */}\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"flex items-center gap-2\">\r\n                <AlertCircle className=\"h-5 w-5 text-red-500\" />\r\n                Alergias\r\n              </CardTitle>\r\n              <CardDescription>\r\n                Reacciones adversas conocidas a medicamentos o sustancias\r\n              </CardDescription>\r\n            </CardHeader>\r\n            <CardContent>\r\n              {profile.alergias && profile.alergias.length > 0 ? (\r\n                <div className=\"flex flex-wrap gap-2\">\r\n                  {profile.alergias.map((alergia, index) => (\r\n                    <Badge key={index} variant=\"destructive\">\r\n                      {alergia}\r\n                    </Badge>\r\n                  ))}\r\n                </div>\r\n              ) : (\r\n                <p className=\"text-muted-foreground\">No se han registrado alergias</p>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* Enfermedades Crónicas */}\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"flex items-center gap-2\">\r\n                <Heart className=\"h-5 w-5 text-blue-500\" />\r\n                Condiciones Médicas Crónicas\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              {profile.enfermedades_cronicas && profile.enfermedades_cronicas.length > 0 ? (\r\n                <div className=\"flex flex-wrap gap-2\">\r\n                  {profile.enfermedades_cronicas.map((enfermedad, index) => (\r\n                    <Badge key={index} variant=\"secondary\">\r\n                      {enfermedad}\r\n                    </Badge>\r\n                  ))}\r\n                </div>\r\n              ) : (\r\n                <p className=\"text-muted-foreground\">\r\n                  No se han registrado condiciones crónicas\r\n                </p>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* Medicamentos Actuales */}\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"flex items-center gap-2\">\r\n                <Pill className=\"h-5 w-5 text-green-500\" />\r\n                Medicamentos Actuales\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              {profile.medicamentos_actuales ? (\r\n                <p className=\"whitespace-pre-wrap\">{profile.medicamentos_actuales}</p>\r\n              ) : (\r\n                <p className=\"text-muted-foreground\">No se han registrado medicamentos</p>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* Cirugías Previas */}\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"flex items-center gap-2\">\r\n                <Scissors className=\"h-5 w-5 text-purple-500\" />\r\n                Cirugías y Procedimientos Previos\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              {profile.cirugias_previas ? (\r\n                <p className=\"whitespace-pre-wrap\">{profile.cirugias_previas}</p>\r\n              ) : (\r\n                <p className=\"text-muted-foreground\">\r\n                  No se han registrado cirugías previas\r\n                </p>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* Contacto de Emergencia */}\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"flex items-center gap-2\">\r\n                <Phone className=\"h-5 w-5 text-orange-500\" />\r\n                Contacto de Emergencia\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              {profile.contacto_emergencia_nombre ? (\r\n                <div className=\"space-y-2\">\r\n                  <div>\r\n                    <p className=\"text-sm text-muted-foreground\">Nombre</p>\r\n                    <p className=\"font-medium\">{profile.contacto_emergencia_nombre}</p>\r\n                  </div>\r\n                  <div>\r\n                    <p className=\"text-sm text-muted-foreground\">Teléfono</p>\r\n                    <p className=\"font-medium\">{profile.contacto_emergencia_telefono}</p>\r\n                  </div>\r\n                  <div>\r\n                    <p className=\"text-sm text-muted-foreground\">Relación</p>\r\n                    <p className=\"font-medium\">{profile.contacto_emergencia_relacion}</p>\r\n                  </div>\r\n                </div>\r\n              ) : (\r\n                <p className=\"text-muted-foreground\">\r\n                  No se ha registrado contacto de emergencia\r\n                </p>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n        </TabsContent>\r\n\r\n        {/* Documentos */}\r\n        <TabsContent value=\"documents\" className=\"space-y-6\">\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"flex items-center gap-2\">\r\n                <FileText className=\"h-5 w-5\" />\r\n                Documentos Médicos\r\n              </CardTitle>\r\n              <CardDescription>\r\n                Análisis, imágenes y otros documentos médicos relevantes\r\n              </CardDescription>\r\n            </CardHeader>\r\n            <CardContent>\r\n              {documents && documents.length > 0 ? (\r\n                <div className=\"space-y-3\">\r\n                  {documents.map((doc: any) => (\r\n                    <div\r\n                      key={doc.id}\r\n                      className=\"flex items-center justify-between p-3 border rounded-lg\"\r\n                    >\r\n                      <div className=\"flex items-center gap-3\">\r\n                        <FileText className=\"h-5 w-5 text-muted-foreground\" />\r\n                        <div>\r\n                          <p className=\"font-medium\">{doc.document_name}</p>\r\n                          <p className=\"text-sm text-muted-foreground\">\r\n                            {doc.document_type} •{\" \"}\r\n                            {new Date(doc.created_at).toLocaleDateString(\"es-ES\")}\r\n                          </p>\r\n                        </div>\r\n                      </div>\r\n                      <Button variant=\"outline\" size=\"sm\">\r\n                        Ver\r\n                      </Button>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              ) : (\r\n                <p className=\"text-muted-foreground\">No hay documentos disponibles</p>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n        </TabsContent>\r\n\r\n        {/* Compartir */}\r\n        {isOwner && (\r\n          <TabsContent value=\"sharing\" className=\"space-y-6\">\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>Compartir Perfil Médico</CardTitle>\r\n                <CardDescription>\r\n                  Genera enlaces temporales para compartir tu información médica con\r\n                  profesionales de salud\r\n                </CardDescription>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <p className=\"text-muted-foreground text-center py-8\">\r\n                  Funcionalidad de compartir próximamente...\r\n                </p>\r\n              </CardContent>\r\n            </Card>\r\n          </TabsContent>\r\n        )}\r\n      </Tabs>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\calendar\\appointment-card.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CalendarDays' is defined but never used.","line":6,"column":52,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":64},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'User' is defined but never used.","line":6,"column":66,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":70},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'es' is defined but never used.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":12}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@red-salud/ui\";\r\nimport { Video, MessageSquare, Eye, Clock, MapPin, CalendarDays, User } from \"lucide-react\";\r\nimport { format } from \"date-fns\";\r\nimport { es } from \"date-fns/locale\";\r\nimport type { CalendarAppointment } from \"./types\";\r\nimport { APPOINTMENT_STATUS_LABELS, APPOINTMENT_TYPE_LABELS } from \"./types\";\r\n\r\ninterface AppointmentCardProps {\r\n  appointment: CalendarAppointment;\r\n  onView?: (appointment: CalendarAppointment) => void;\r\n  onMessage?: (appointment: CalendarAppointment) => void;\r\n  onStartVideo?: (appointment: CalendarAppointment) => void;\r\n  compact?: boolean;\r\n}\r\n\r\nexport function AppointmentCard({\r\n  appointment,\r\n  onView,\r\n  onMessage,\r\n  onStartVideo,\r\n  compact = false,\r\n}: AppointmentCardProps) {\r\n  const getInitials = (name: string) => {\r\n    return name\r\n      .split(\" \")\r\n      .map((n) => n[0])\r\n      .join(\"\")\r\n      .toUpperCase()\r\n      .slice(0, 2);\r\n  };\r\n\r\n  const getStatusColor = (status: string) => {\r\n    const colors = {\r\n      pendiente: \"bg-yellow-50 text-yellow-700 border-yellow-200\",\r\n      confirmada: \"bg-blue-50 text-blue-700 border-blue-200\",\r\n      en_espera: \"bg-purple-50 text-purple-700 border-purple-200\",\r\n      en_consulta: \"bg-indigo-50 text-indigo-700 border-indigo-200\",\r\n      completada: \"bg-green-50 text-green-700 border-green-200\",\r\n      no_asistio: \"bg-orange-50 text-orange-700 border-orange-200\",\r\n      cancelada: \"bg-red-50 text-red-700 border-red-200\",\r\n      rechazada: \"bg-gray-50 text-gray-700 border-gray-200\",\r\n    };\r\n    return colors[status as keyof typeof colors] || colors.pendiente;\r\n  };\r\n\r\n  const shouldPulse = (status: string) => {\r\n    return status === \"en_espera\" || status === \"en_consulta\";\r\n  };\r\n\r\n  const getTypeIcon = (tipo: string) => {\r\n    if (tipo === \"telemedicina\") return <Video className=\"h-3.5 w-3.5\" />;\r\n    if (tipo === \"urgencia\") return <Clock className=\"h-3.5 w-3.5\" />;\r\n    return <MapPin className=\"h-3.5 w-3.5\" />;\r\n  };\r\n\r\n  if (compact) {\r\n    return (\r\n      <div\r\n        className=\"p-2 rounded-md border-l-4 hover:shadow-md transition-shadow cursor-pointer bg-card group\"\r\n        style={{ borderLeftColor: appointment.color }}\r\n        data-tour=\"appointment-card\"\r\n        data-type={appointment.tipo_cita}\r\n        onClick={(e) => {\r\n          e.stopPropagation();\r\n          onView?.(appointment);\r\n        }}\r\n      >\r\n        <div className=\"flex items-center justify-between gap-2\">\r\n          <div className=\"flex items-center gap-2 flex-1 min-w-0\">\r\n            <Avatar className=\"h-6 w-6 flex-shrink-0 ring-1 ring-border group-hover:ring-primary/50 transition-all\">\r\n              <AvatarImage src={appointment.paciente_avatar || undefined} />\r\n              <AvatarFallback className=\"text-[10px] bg-primary/5 text-primary\">\r\n                {getInitials(appointment.paciente_nombre)}\r\n              </AvatarFallback>\r\n            </Avatar>\r\n            <div className=\"flex-1 min-w-0\">\r\n              <p className=\"text-sm font-medium truncate text-foreground leading-tight\">{appointment.paciente_nombre}</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Grid Card Layout (Vertical)\r\n  return (\r\n    <div\r\n      className=\"group flex flex-col bg-card rounded-xl border border-border hover:border-primary/50 shadow-sm hover:shadow-md transition-all duration-300 h-full overflow-hidden\"\r\n      data-tour=\"appointment-card\"\r\n      data-type={appointment.tipo_cita}\r\n    >\r\n      {/* Top Decoration Line */}\r\n      <div className=\"h-1.5 w-full\" style={{ backgroundColor: appointment.color }} />\r\n\r\n      <div className=\"p-4 flex flex-col flex-1 gap-4\">\r\n        {/* Header: User & Status */}\r\n        <div className=\"flex items-start justify-between gap-3\">\r\n          <div className=\"flex items-center gap-3 min-w-0\">\r\n            <Avatar className=\"h-10 w-10 ring-2 ring-background shadow-sm\">\r\n              <AvatarImage src={appointment.paciente_avatar || undefined} className=\"object-cover\" />\r\n              <AvatarFallback className=\"text-xs font-bold bg-primary/10 text-primary\">\r\n                {getInitials(appointment.paciente_nombre)}\r\n              </AvatarFallback>\r\n            </Avatar>\r\n            <div className=\"min-w-0\">\r\n              <h3 className=\"font-semibold text-sm text-foreground truncate group-hover:text-primary transition-colors\">\r\n                {appointment.paciente_nombre}\r\n              </h3>\r\n              <p className=\"text-xs text-muted-foreground truncate max-w-[120px]\">\r\n                {appointment.motivo}\r\n              </p>\r\n            </div>\r\n          </div>\r\n          <Badge\r\n            variant=\"outline\"\r\n            className={`text-[10px] px-2 py-0.5 h-fit border flex-shrink-0 ${getStatusColor(appointment.status)} ${shouldPulse(appointment.status) ? 'animate-pulse' : ''}`}\r\n          >\r\n            {APPOINTMENT_STATUS_LABELS[appointment.status]}\r\n          </Badge>\r\n        </div>\r\n\r\n        {/* Info Grid */}\r\n        <div className=\"grid grid-cols-2 gap-2 text-xs text-muted-foreground bg-muted/20 p-2.5 rounded-lg border border-border/50\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <Clock className=\"h-3.5 w-3.5 text-primary/70\" />\r\n            <span className=\"font-medium text-foreground\">\r\n              {format(new Date(appointment.fecha_hora), \"HH:mm\")}\r\n            </span>\r\n          </div>\r\n          <div className=\"flex items-center gap-2 justify-end\">\r\n            <span className=\"tabular-nums opacity-80\">{appointment.duracion_minutos} min</span>\r\n          </div>\r\n\r\n          <div className=\"flex items-center gap-2 col-span-2 pt-1 border-t border-border/50\">\r\n            {getTypeIcon(appointment.tipo_cita)}\r\n            <span className=\"capitalize truncate\">{APPOINTMENT_TYPE_LABELS[appointment.tipo_cita]}</span>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Internal Note (if any) */}\r\n        {appointment.notas_internas && (\r\n          <div className=\"text-[10px] text-muted-foreground bg-yellow-50/50 dark:bg-yellow-900/10 p-2 rounded border border-yellow-100 dark:border-yellow-900/30 line-clamp-2\">\r\n            <span className=\"font-medium text-yellow-700 dark:text-yellow-500 mr-1\">Nota:</span>\r\n            {appointment.notas_internas}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Footer Actions */}\r\n      <div className=\"p-3 bg-muted/30 border-t border-border flex items-center justify-between gap-2\">\r\n        <div className=\"flex gap-1\">\r\n          <Button\r\n            variant=\"ghost\"\r\n            size=\"icon\"\r\n            className=\"h-8 w-8 text-muted-foreground hover:text-primary hover:bg-primary/10\"\r\n            onClick={(e) => {\r\n              e.stopPropagation();\r\n              onView?.(appointment);\r\n            }}\r\n            title=\"Ver detalles\"\r\n          >\r\n            <Eye className=\"h-4 w-4\" />\r\n          </Button>\r\n          <Button\r\n            variant=\"ghost\"\r\n            size=\"icon\"\r\n            className=\"h-8 w-8 text-muted-foreground hover:text-primary hover:bg-primary/10\"\r\n            onClick={(e) => {\r\n              e.stopPropagation();\r\n              onMessage?.(appointment);\r\n            }}\r\n            title=\"Mensaje\"\r\n          >\r\n            <MessageSquare className=\"h-4 w-4\" />\r\n          </Button>\r\n        </div>\r\n\r\n        {appointment.tipo_cita === \"telemedicina\" && appointment.status === \"confirmada\" ? (\r\n          <Button\r\n            size=\"sm\"\r\n            className=\"h-7 px-3 text-xs bg-primary hover:bg-primary/90 shadow-sm\"\r\n            onClick={(e) => {\r\n              e.stopPropagation();\r\n              onStartVideo?.(appointment);\r\n            }}\r\n          >\r\n            <Video className=\"h-3 w-3 mr-1.5\" />\r\n            Iniciar\r\n          </Button>\r\n        ) : (\r\n          <div /> /* Spacer if no main action */\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\calendar\\appointment-stack.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'es' is defined but never used.","line":21,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":12}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file appointment-stack.tsx\r\n * @description Componente para mostrar múltiples citas en el mismo horario sin solapamiento\r\n * @module Dashboard/Medico/Calendar\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport type { CalendarAppointment } from \"./types\";\r\nimport { ChevronDown, ChevronUp, Video, MapPin, Clock, AlertCircle } from \"lucide-react\";\r\nimport {\r\n  Tooltip,\r\n  TooltipContent,\r\n  TooltipProvider,\r\n  TooltipTrigger,\r\n} from \"@red-salud/ui\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@red-salud/ui\";\r\nimport { format } from \"date-fns\";\r\nimport { es } from \"date-fns/locale\";\r\nimport { Badge } from \"@red-salud/ui\";\r\n\r\ninterface AppointmentStackProps {\r\n  appointments: CalendarAppointment[];\r\n  maxVisible?: number;\r\n  compact?: boolean;\r\n  onAppointmentClick?: (appointment: CalendarAppointment) => void;\r\n}\r\n\r\nexport function AppointmentStack({\r\n  appointments,\r\n  maxVisible = 3,\r\n  compact = false,\r\n  onAppointmentClick,\r\n}: AppointmentStackProps) {\r\n  const [expanded, setExpanded] = useState(false);\r\n\r\n  if (appointments.length === 0) return null;\r\n\r\n  const visibleAppointments = expanded\r\n    ? appointments\r\n    : appointments.slice(0, maxVisible);\r\n  const hiddenCount = appointments.length - maxVisible;\r\n\r\n  const getInitials = (name: string) => {\r\n    return name\r\n      .split(\" \")\r\n      .map((n) => n[0])\r\n      .join(\"\")\r\n      .toUpperCase()\r\n      .slice(0, 2);\r\n  };\r\n\r\n  const getTypeIcon = (tipo: string, className = \"h-3 w-3\") => {\r\n    if (tipo === \"telemedicina\") return <Video className={className} />;\r\n    if (tipo === \"urgencia\") return <AlertCircle className={className} />;\r\n    return <MapPin className={className} />;\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-1 w-full\">\r\n      <TooltipProvider delayDuration={200}>\r\n        {visibleAppointments.map((apt) => (\r\n          <Tooltip key={apt.id}>\r\n            <TooltipTrigger asChild>\r\n              <div\r\n                className={cn(\r\n                  \"rounded cursor-pointer hover:brightness-95 transition-all w-full flex items-center gap-1\",\r\n                  compact ? \"p-0.5 text-[10px]\" : \"p-1.5 text-xs\"\r\n                )}\r\n                style={{\r\n                  backgroundColor: apt.color + \"15\", // 15 = ~8% opacity\r\n                  borderLeft: `${compact ? \"2px\" : \"3px\"} solid ${apt.color}`,\r\n                  color: \"hsl(var(--foreground))\"\r\n                }}\r\n                onClick={(e) => {\r\n                  e.stopPropagation();\r\n                  onAppointmentClick?.(apt);\r\n                }}\r\n              >\r\n                {/* Icono de tipo small */}\r\n                <span className=\"text-muted-foreground opacity-70 flex-shrink-0\">\r\n                  {getTypeIcon(apt.tipo_cita, compact ? \"h-2.5 w-2.5\" : \"h-3 w-3\")}\r\n                </span>\r\n\r\n                <div className=\"font-medium truncate flex-1 leading-tight\">\r\n                  {apt.paciente_nombre}\r\n                </div>\r\n              </div>\r\n            </TooltipTrigger>\r\n            <TooltipContent side=\"right\" className=\"p-0 border-none shadow-lg\">\r\n              <div className=\"w-[280px] bg-card border rounded-md overflow-hidden shadow-xl animate-in fade-in-0 zoom-in-95\">\r\n                {/* Header: Color & Status */}\r\n                <div className=\"px-3 py-2 border-b flex items-center justify-between\" style={{ backgroundColor: apt.color + \"15\" }}>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <div className=\"w-2 h-2 rounded-full\" style={{ backgroundColor: apt.color }} />\r\n                    <span className=\"text-xs font-semibold capitalize\">\r\n                      {apt.status.replace(\"_\", \" \")}\r\n                    </span>\r\n                  </div>\r\n                  <div className=\"text-xs text-muted-foreground flex items-center gap-1\">\r\n                    <Clock className=\"h-3 w-3\" />\r\n                    {format(new Date(apt.fecha_hora), \"HH:mm\")} - {format(new Date(apt.fecha_hora_fin), \"HH:mm\")}\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Body */}\r\n                <div className=\"p-3 bg-background\">\r\n                  <div className=\"flex items-start gap-3 mb-2\">\r\n                    <Avatar className=\"h-9 w-9 border\">\r\n                      <AvatarImage src={apt.paciente_avatar || undefined} />\r\n                      <AvatarFallback>{getInitials(apt.paciente_nombre)}</AvatarFallback>\r\n                    </Avatar>\r\n                    <div>\r\n                      <p className=\"font-bold text-sm leading-none mb-1\">{apt.paciente_nombre}</p>\r\n                      <p className=\"text-xs text-muted-foreground line-clamp-2\">\r\n                        {apt.motivo || \"Sin motivo especificado\"}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"flex items-center gap-2 mt-2\">\r\n                    <Badge variant=\"outline\" className=\"text-[10px] gap-1 h-5 px-1.5 font-normal\">\r\n                      {getTypeIcon(apt.tipo_cita, \"h-3 w-3\")}\r\n                      <span className=\"capitalize\">{apt.tipo_cita}</span>\r\n                    </Badge>\r\n                    {apt.notas_internas && (\r\n                      <Badge variant=\"secondary\" className=\"text-[10px] h-5 px-1.5 font-normal text-muted-foreground\">\r\n                        Nota interna\r\n                      </Badge>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </TooltipContent>\r\n          </Tooltip>\r\n        ))}\r\n      </TooltipProvider>\r\n\r\n      {/* Botón para expandir/colapsar */}\r\n      {hiddenCount > 0 && (\r\n        <button\r\n          onClick={(e) => {\r\n            e.stopPropagation();\r\n            setExpanded(!expanded);\r\n          }}\r\n          className={cn(\r\n            \"w-full text-center text-muted-foreground hover:text-foreground transition-colors rounded hover:bg-muted/50\",\r\n            compact ? \"text-[9px] py-0.5\" : \"text-[10px] py-1\"\r\n          )}\r\n        >\r\n          {expanded ? (\r\n            <div className=\"flex items-center justify-center gap-0.5\">\r\n              <ChevronUp className=\"h-2.5 w-2.5\" />\r\n              <span>Menos</span>\r\n            </div>\r\n          ) : (\r\n            <div className=\"flex items-center justify-center gap-0.5\">\r\n              <ChevronDown className=\"h-2.5 w-2.5\" />\r\n              <span>+{hiddenCount}</span>\r\n            </div>\r\n          )}\r\n        </button>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\calendar\\calendar-filters.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\calendar\\calendar-main.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1198,1201],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1198,1201],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\calendar\\calendar-main.tsx:61:30\n  59 |   // Sincronizar fecha con props externas\n  60 |   useEffect(() => {\n> 61 |     if (externalCurrentDate) setCurrentDate(externalCurrentDate);\n     |                              ^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  62 |   }, [externalCurrentDate]);\n  63 |\n  64 |   const handleDateChange = (date: Date) => {","line":61,"column":30,"nodeType":null,"endLine":61,"endColumn":44}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { ChevronLeft, ChevronRight, Plus, Calendar as CalendarIcon } from \"lucide-react\";\r\nimport { format, addDays, addWeeks, addMonths, subDays, subWeeks, subMonths } from \"date-fns\";\r\nimport { es } from \"date-fns/locale\";\r\nimport { CalendarViewSelector, type CalendarView } from \"./calendar-view-selector\";\r\nimport { DayView } from \"./day-view\";\r\nimport { WeekView } from \"./week-view-improved\";\r\nimport { MonthView } from \"./month-view\";\r\nimport { AppointmentCard } from \"./appointment-card\";\r\nimport type { CalendarAppointment } from \"./types\";\r\n\r\ninterface CalendarMainProps {\r\n  appointments: CalendarAppointment[];\r\n  onNewAppointment?: () => void;\r\n  onAppointmentClick?: (appointment: CalendarAppointment) => void;\r\n  onTimeSlotClick?: (date: Date, hour?: number) => void;\r\n  onMessage?: (appointment: CalendarAppointment) => void;\r\n  onStartVideo?: (appointment: CalendarAppointment) => void;\r\n  loading?: boolean;\r\n  currentDate?: Date;\r\n  view?: CalendarView;\r\n  onDateChange?: (date: Date) => void;\r\n  onViewChange?: (view: CalendarView) => void;\r\n  // Drag & Drop\r\n  dragState?: any;\r\n  onDragStart?: (appointment: CalendarAppointment) => void;\r\n  onDragOver?: (date: Date, hour: number) => void;\r\n  onDragEnd?: () => void;\r\n  onDragCancel?: () => void;\r\n}\r\n\r\nexport function CalendarMain({\r\n  appointments,\r\n  onNewAppointment,\r\n  onAppointmentClick,\r\n  onTimeSlotClick,\r\n  onMessage,\r\n  onStartVideo,\r\n  loading = false,\r\n  currentDate: externalCurrentDate,\r\n  view: externalView,\r\n  onDateChange,\r\n  onViewChange,\r\n  dragState,\r\n  onDragStart,\r\n  onDragOver,\r\n  onDragEnd,\r\n  onDragCancel,\r\n}: CalendarMainProps) {\r\n  const [currentDate, setCurrentDate] = useState(externalCurrentDate || new Date());\r\n  const [filterStatus, setFilterStatus] = useState<\"all\" | \"pendiente\" | \"confirmada\" | \"completada\">(\"all\");\r\n\r\n  // Usar la vista externa directamente si está disponible, sino usar week por defecto\r\n  const view = externalView || \"week\";\r\n\r\n  // Sincronizar fecha con props externas\r\n  useEffect(() => {\r\n    if (externalCurrentDate) setCurrentDate(externalCurrentDate);\r\n  }, [externalCurrentDate]);\r\n\r\n  const handleDateChange = (date: Date) => {\r\n    setCurrentDate(date);\r\n    onDateChange?.(date);\r\n  };\r\n\r\n  const handleViewChange = (newView: CalendarView) => {\r\n    onViewChange?.(newView);\r\n  };\r\n\r\n  const filteredAppointments = appointments.filter((apt) => {\r\n    if (filterStatus === \"all\") return true;\r\n    return apt.status === filterStatus;\r\n  });\r\n\r\n  const handlePrevious = () => {\r\n    let newDate;\r\n    switch (view) {\r\n      case \"day\":\r\n        newDate = subDays(currentDate, 1);\r\n        break;\r\n      case \"week\":\r\n        newDate = subWeeks(currentDate, 1);\r\n        break;\r\n      case \"month\":\r\n        newDate = subMonths(currentDate, 1);\r\n        break;\r\n      default:\r\n        newDate = currentDate;\r\n    }\r\n    handleDateChange(newDate);\r\n  };\r\n\r\n  const handleNext = () => {\r\n    let newDate;\r\n    switch (view) {\r\n      case \"day\":\r\n        newDate = addDays(currentDate, 1);\r\n        break;\r\n      case \"week\":\r\n        newDate = addWeeks(currentDate, 1);\r\n        break;\r\n      case \"month\":\r\n        newDate = addMonths(currentDate, 1);\r\n        break;\r\n      default:\r\n        newDate = currentDate;\r\n    }\r\n    handleDateChange(newDate);\r\n  };\r\n\r\n  const handleToday = () => {\r\n    handleDateChange(new Date());\r\n  };\r\n\r\n  const getDateRangeText = () => {\r\n    switch (view) {\r\n      case \"day\":\r\n        return format(currentDate, \"EEEE, d 'de' MMMM 'de' yyyy\", { locale: es });\r\n      case \"week\":\r\n        const weekStart = subDays(currentDate, currentDate.getDay() - 1);\r\n        const weekEnd = addDays(weekStart, 6);\r\n        return `${format(weekStart, \"d MMM\", { locale: es })} - ${format(weekEnd, \"d MMM yyyy\", { locale: es })}`;\r\n      case \"month\":\r\n        return format(currentDate, \"MMMM yyyy\", { locale: es });\r\n      case \"list\":\r\n        return \"Todas las citas\";\r\n      default:\r\n        return \"\";\r\n    }\r\n  };\r\n\r\n  // Estadísticas del día/período actual\r\n  const stats = {\r\n    total: appointments.length,\r\n    pendientes: appointments.filter(a => a.status === \"pendiente\").length,\r\n    confirmadas: appointments.filter(a => a.status === \"confirmada\").length,\r\n    completadas: appointments.filter(a => a.status === \"completada\").length,\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-96\">\r\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex flex-col h-full space-y-4\">\r\n      {/* Header Controls */}\r\n      <div className=\"bg-card rounded-lg shadow-sm border border-border p-4\">\r\n        <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\r\n          {/* Navigation */}\r\n          <div className=\"flex items-center gap-2\" data-tour=\"date-navigation\">\r\n            <Button variant=\"outline\" size=\"sm\" onClick={handleToday}>\r\n              <CalendarIcon className=\"h-4 w-4 mr-2\" />\r\n              Hoy\r\n            </Button>\r\n            <div className=\"flex items-center gap-1\">\r\n              <Button variant=\"outline\" size=\"icon\" onClick={handlePrevious}>\r\n                <ChevronLeft className=\"h-4 w-4\" />\r\n              </Button>\r\n              <Button variant=\"outline\" size=\"icon\" onClick={handleNext}>\r\n                <ChevronRight className=\"h-4 w-4\" />\r\n              </Button>\r\n            </div>\r\n            <div className=\"text-lg font-semibold text-foreground min-w-[200px]\">\r\n              {getDateRangeText()}\r\n            </div>\r\n          </div>\r\n\r\n          {/* View Selector and Actions */}\r\n          <div className=\"flex items-center gap-2\">\r\n            <div data-tour=\"calendar-view-buttons\">\r\n              <CalendarViewSelector currentView={view} onViewChange={handleViewChange} />\r\n            </div>\r\n            <Button onClick={onNewAppointment} data-tour=\"new-appointment-btn\">\r\n              <Plus className=\"h-4 w-4 mr-2\" />\r\n              Nueva Cita\r\n            </Button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Stats - Clickeable */}\r\n        {view !== \"list\" && (\r\n          <div className=\"flex items-center gap-3 mt-4 pt-4 border-t border-border flex-wrap\" data-tour=\"calendar-filters\">\r\n            <button\r\n              className={`text-sm px-3 py-1.5 rounded-md transition-colors ${filterStatus === \"all\" ? \"bg-muted\" : \"hover:bg-muted\"\r\n                }`}\r\n              onClick={() => setFilterStatus(\"all\")}\r\n            >\r\n              <span className=\"text-muted-foreground\">Total:</span>{\" \"}\r\n              <span className=\"font-semibold text-foreground\">{stats.total}</span>\r\n            </button>\r\n            <button\r\n              className={`text-sm px-3 py-1.5 rounded-md transition-colors ${filterStatus === \"pendiente\" ? \"bg-yellow-100 dark:bg-yellow-900/30\" : \"hover:bg-yellow-50 dark:hover:bg-yellow-900/20\"\r\n                }`}\r\n              onClick={() => setFilterStatus(\"pendiente\")}\r\n            >\r\n              <span className=\"text-muted-foreground\">Pendientes:</span>{\" \"}\r\n              <span className=\"font-semibold text-yellow-600 dark:text-yellow-400\">{stats.pendientes}</span>\r\n            </button>\r\n            <button\r\n              className={`text-sm px-3 py-1.5 rounded-md transition-colors ${filterStatus === \"confirmada\" ? \"bg-blue-100 dark:bg-blue-900/30\" : \"hover:bg-blue-50 dark:hover:bg-blue-900/20\"\r\n                }`}\r\n              onClick={() => setFilterStatus(\"confirmada\")}\r\n            >\r\n              <span className=\"text-muted-foreground\">Confirmadas:</span>{\" \"}\r\n              <span className=\"font-semibold text-blue-600 dark:text-blue-400\">{stats.confirmadas}</span>\r\n            </button>\r\n            <button\r\n              className={`text-sm px-3 py-1.5 rounded-md transition-colors ${filterStatus === \"completada\" ? \"bg-green-100 dark:bg-green-900/30\" : \"hover:bg-green-50 dark:hover:bg-green-900/20\"\r\n                }`}\r\n              onClick={() => setFilterStatus(\"completada\")}\r\n            >\r\n              <span className=\"text-muted-foreground\">Completadas:</span>{\" \"}\r\n              <span className=\"font-semibold text-green-600 dark:text-green-400\">{stats.completadas}</span>\r\n            </button>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Calendar Views - Flexible height */}\r\n      <div className=\"flex-1 min-h-0\">\r\n        {view === \"day\" && (\r\n          <DayView\r\n            date={currentDate}\r\n            appointments={filteredAppointments}\r\n            onAppointmentClick={onAppointmentClick}\r\n            onTimeSlotClick={onTimeSlotClick}\r\n            onMessage={onMessage}\r\n            onStartVideo={onStartVideo}\r\n          />\r\n        )}\r\n        {view === \"week\" && (\r\n          <WeekView\r\n            date={currentDate}\r\n            appointments={filteredAppointments}\r\n            onAppointmentClick={onAppointmentClick}\r\n            onTimeSlotClick={onTimeSlotClick}\r\n            onMessage={onMessage}\r\n            onStartVideo={onStartVideo}\r\n            dragState={dragState}\r\n            onDragStart={onDragStart}\r\n            onDragOver={onDragOver}\r\n            onDragEnd={onDragEnd}\r\n            onDragCancel={onDragCancel}\r\n          />\r\n        )}\r\n        {view === \"month\" && (\r\n          <MonthView\r\n            date={currentDate}\r\n            appointments={filteredAppointments}\r\n            onDayClick={(date) => {\r\n              setCurrentDate(date);\r\n              handleViewChange(\"day\");\r\n            }}\r\n            onAppointmentClick={onAppointmentClick}\r\n          />\r\n        )}\r\n        {view === \"list\" && (\r\n          <div className=\"h-full overflow-y-auto scrollbar-thin scrollbar-thumb-muted-foreground/30 scrollbar-track-muted bg-muted/50 dark:bg-muted/30 rounded-lg p-4\">\r\n            {filteredAppointments.length > 0 ? (\r\n              <div className=\"space-y-3\">\r\n                {filteredAppointments.map((apt) => (\r\n                  <AppointmentCard\r\n                    key={apt.id}\r\n                    appointment={apt}\r\n                    onView={onAppointmentClick}\r\n                    onMessage={onMessage}\r\n                    onStartVideo={onStartVideo}\r\n                  />\r\n                ))}\r\n              </div>\r\n            ) : (\r\n              <div className=\"h-full flex items-center justify-center\">\r\n                <div className=\"text-center py-12 bg-card rounded-lg border-2 border-dashed border-border max-w-md\">\r\n                  <CalendarIcon className=\"h-16 w-16 text-muted-foreground mx-auto mb-4\" />\r\n                  <h3 className=\"text-lg font-semibold text-foreground mb-2\">\r\n                    No hay citas programadas\r\n                  </h3>\r\n                  <p className=\"text-muted-foreground mb-4\">\r\n                    Las citas que agendes aparecerán aquí\r\n                  </p>\r\n                  <Button onClick={onNewAppointment} size=\"lg\">\r\n                    <Plus className=\"h-5 w-5 mr-2\" />\r\n                    Agendar Primera Cita\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\calendar\\calendar-view-selector.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\calendar\\day-view.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\calendar\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\calendar\\month-view.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\calendar\\patient-summary-modal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Card' is defined but never used.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardContent' is defined but never used.","line":8,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardHeader' is defined but never used.","line":8,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardTitle' is defined but never used.","line":8,"column":41,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":50},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":80,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2277,2280],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2277,2280],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":208,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":208,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6930,6933],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6930,6933],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":605,"column":33,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[26632,26667],"text":"\r\n                                &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[26632,26667],"text":"\r\n                                &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[26632,26667],"text":"\r\n                                &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[26632,26667],"text":"\r\n                                &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":605,"column":116,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[26749,26782],"text":"&quot;\r\n                              "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[26749,26782],"text":"&ldquo;\r\n                              "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[26749,26782],"text":"&#34;\r\n                              "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[26749,26782],"text":"&rdquo;\r\n                              "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'appointment' and 'loadPatientData'. Either include them or remove the dependency array.","line":100,"column":6,"nodeType":"ArrayExpression","endLine":100,"endColumn":71,"suggestions":[{"desc":"Update the dependencies array to be: [open, appointment.paciente_id, appointment.offline_patient_id, appointment, loadPatientData]","fix":{"range":[2945,3010],"text":"[open, appointment.paciente_id, appointment.offline_patient_id, appointment, loadPatientData]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":4,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@red-salud/ui\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@red-salud/ui\";\r\nimport {\r\n  User,\r\n  Phone,\r\n  Mail,\r\n  Calendar,\r\n  MapPin,\r\n  Heart,\r\n  AlertCircle,\r\n  Pill,\r\n  FileText,\r\n  Video,\r\n  MessageSquare,\r\n  Loader2,\r\n  Clock,\r\n} from \"lucide-react\";\r\nimport { format, differenceInYears } from \"date-fns\";\r\nimport { es } from \"date-fns/locale\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport type { CalendarAppointment } from \"./types\";\r\n\r\ninterface PatientSummaryModalProps {\r\n  appointment: CalendarAppointment | null;\r\n  open: boolean;\r\n  onClose: () => void;\r\n  onMessage?: (appointment: CalendarAppointment) => void;\r\n  onStartVideo?: (appointment: CalendarAppointment) => void;\r\n}\r\n\r\ninterface PatientData {\r\n  // Perfil básico\r\n  id: string;\r\n  nombre_completo: string;\r\n  email: string;\r\n  telefono?: string;\r\n  cedula?: string;\r\n  fecha_nacimiento?: string;\r\n  direccion?: string;\r\n  ciudad?: string;\r\n  estado?: string;\r\n  avatar_url?: string;\r\n  \r\n  // Datos médicos\r\n  grupo_sanguineo?: string;\r\n  alergias?: string[];\r\n  enfermedades_cronicas?: string[];\r\n  medicamentos_actuales?: string;\r\n  cirugias_previas?: string;\r\n  peso_kg?: number;\r\n  altura_cm?: number;\r\n  contacto_emergencia_nombre?: string;\r\n  contacto_emergencia_telefono?: string;\r\n  contacto_emergencia_relacion?: string;\r\n}\r\n\r\ninterface MedicalHistory {\r\n  total_consultas: number;\r\n  ultima_consulta?: string;\r\n  diagnosticos_frecuentes: Array<{ diagnostico: string; count: number }>;\r\n}\r\n\r\nexport function PatientSummaryModal({\r\n  appointment,\r\n  open,\r\n  onClose,\r\n  onMessage,\r\n  onStartVideo,\r\n}: PatientSummaryModalProps) {\r\n  const [loading, setLoading] = useState(true);\r\n  const [patientData, setPatientData] = useState<PatientData | null>(null);\r\n  const [medicalHistory, setMedicalHistory] = useState<MedicalHistory | null>(null);\r\n  const [appointmentHistory, setAppointmentHistory] = useState<any[]>([]);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (open && appointment) {\r\n      console.log(\"Modal opened with appointment:\", {\r\n        id: appointment.id,\r\n        paciente_id: appointment.paciente_id,\r\n        offline_patient_id: appointment.offline_patient_id,\r\n        paciente_nombre: appointment.paciente_nombre,\r\n      });\r\n      loadPatientData();\r\n    } else if (!open) {\r\n      // Reset state when modal closes\r\n      setPatientData(null);\r\n      setMedicalHistory(null);\r\n      setAppointmentHistory([]);\r\n      setError(null);\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [open, appointment?.paciente_id, appointment?.offline_patient_id]);\r\n\r\n  const loadPatientData = async () => {\r\n    if (!appointment) return;\r\n    \r\n    setLoading(true);\r\n    setError(null);\r\n    \r\n    try {\r\n      // Verificar si es un paciente offline\r\n      const isOfflinePatient = !appointment.paciente_id && appointment.offline_patient_id;\r\n      \r\n      console.log(\"Loading patient data:\", {\r\n        paciente_id: appointment.paciente_id,\r\n        offline_patient_id: appointment.offline_patient_id,\r\n        isOfflinePatient\r\n      });\r\n\r\n      // Crear perfil básico con los datos que ya tenemos del appointment\r\n      const basicProfile: PatientData = {\r\n        id: appointment.paciente_id || appointment.offline_patient_id || \"\",\r\n        nombre_completo: appointment.paciente_nombre,\r\n        email: appointment.paciente_email || \"\",\r\n        telefono: appointment.paciente_telefono || undefined,\r\n        avatar_url: appointment.paciente_avatar || undefined,\r\n      };\r\n\r\n      if (isOfflinePatient) {\r\n        // Para pacientes offline, cargar datos de la tabla offline_patients\r\n        const { data: offlinePatient, error: offlineError } = await supabase\r\n          .from(\"offline_patients\")\r\n          .select(\"*\")\r\n          .eq(\"id\", appointment.offline_patient_id)\r\n          .maybeSingle();\r\n\r\n        if (offlineError) {\r\n          console.warn(\"Error loading offline patient:\", offlineError);\r\n        }\r\n\r\n        // Combinar datos\r\n        setPatientData({\r\n          ...basicProfile,\r\n          ...(offlinePatient || {}),\r\n        });\r\n\r\n        // Para pacientes offline, no hay historial en el sistema\r\n        setAppointmentHistory([]);\r\n        setMedicalHistory(null);\r\n      } else if (appointment.paciente_id) {\r\n        // Para pacientes registrados, cargar datos completos\r\n        const { data: profile, error: profileError } = await supabase\r\n          .from(\"profiles\")\r\n          .select(\"*\")\r\n          .eq(\"id\", appointment.paciente_id)\r\n          .maybeSingle();\r\n\r\n        console.log(\"Profile query result:\", { profile, profileError });\r\n\r\n        const fullProfile = profile || basicProfile;\r\n\r\n        // Cargar detalles médicos (puede no existir)\r\n        const { data: medicalDetails, error: medicalError } = await supabase\r\n          .from(\"patient_details\")\r\n          .select(\"*\")\r\n          .eq(\"profile_id\", appointment.paciente_id)\r\n          .maybeSingle();\r\n\r\n        if (medicalError && medicalError.code !== \"PGRST116\") {\r\n          console.warn(\"Error loading medical details:\", medicalError);\r\n        }\r\n\r\n        console.log(\"Medical details:\", medicalDetails);\r\n\r\n        // Combinar datos\r\n        setPatientData({\r\n          ...fullProfile,\r\n          ...(medicalDetails || {}),\r\n        });\r\n\r\n        // Cargar historial de citas (incluyendo citas completadas)\r\n        const { data: appointments, error: appointmentsError } = await supabase\r\n          .from(\"appointments\")\r\n          .select(\"*\")\r\n          .eq(\"paciente_id\", appointment.paciente_id)\r\n          .in(\"status\", [\"completada\", \"pendiente\", \"confirmada\"])\r\n          .order(\"fecha_hora\", { ascending: false })\r\n          .limit(10);\r\n\r\n        if (appointmentsError) {\r\n          console.warn(\"Error loading appointments:\", appointmentsError);\r\n        }\r\n\r\n        console.log(\"Loaded appointment history:\", appointments);\r\n        setAppointmentHistory(appointments || []);\r\n\r\n        // Cargar resumen de historial médico\r\n        const { data: records, error: recordsError } = await supabase\r\n          .from(\"medical_records\")\r\n          .select(\"diagnostico, created_at\")\r\n          .eq(\"paciente_id\", appointment.paciente_id)\r\n          .order(\"created_at\", { ascending: false });\r\n\r\n        if (recordsError) {\r\n          console.warn(\"Error loading medical records:\", recordsError);\r\n        }\r\n\r\n        if (records && records.length > 0) {\r\n          const diagnosticosMap = new Map<string, number>();\r\n          records.forEach((record: any) => {\r\n            if (record.diagnostico) {\r\n              diagnosticosMap.set(\r\n                record.diagnostico,\r\n                (diagnosticosMap.get(record.diagnostico) || 0) + 1\r\n              );\r\n            }\r\n          });\r\n\r\n          const diagnosticos_frecuentes = Array.from(diagnosticosMap.entries())\r\n            .map(([diagnostico, count]) => ({ diagnostico, count }))\r\n            .sort((a, b) => b.count - a.count)\r\n            .slice(0, 5);\r\n\r\n          setMedicalHistory({\r\n            total_consultas: records.length,\r\n            ultima_consulta: records[0]?.created_at,\r\n            diagnosticos_frecuentes,\r\n          });\r\n        }\r\n      } else {\r\n        // No hay paciente_id ni offline_patient_id\r\n        throw new Error(\"Esta cita no tiene un paciente asociado. Por favor, verifica los datos de la cita.\");\r\n      }\r\n    } catch (err) {\r\n      const errorMessage = err instanceof Error ? err.message : \"Error desconocido al cargar datos del paciente\";\r\n      console.error(\"Error loading patient data:\", err);\r\n      setError(errorMessage);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const getAge = (birthDate?: string) => {\r\n    if (!birthDate) return null;\r\n    return differenceInYears(new Date(), new Date(birthDate));\r\n  };\r\n\r\n  const getStatusColor = (status: string) => {\r\n    switch (status) {\r\n      case \"pendiente\":\r\n        return \"bg-yellow-100 text-yellow-800\";\r\n      case \"confirmada\":\r\n        return \"bg-blue-100 text-blue-800\";\r\n      case \"completada\":\r\n        return \"bg-green-100 text-green-800\";\r\n      case \"cancelada\":\r\n        return \"bg-red-100 text-red-800\";\r\n      default:\r\n        return \"bg-gray-100 text-gray-800\";\r\n    }\r\n  };\r\n\r\n  const getInitials = (name: string) => {\r\n    return name\r\n      .split(\" \")\r\n      .map((n) => n[0])\r\n      .join(\"\")\r\n      .toUpperCase()\r\n      .slice(0, 2);\r\n  };\r\n\r\n  if (!appointment) return null;\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={onClose}>\r\n      <DialogContent className=\"max-w-4xl w-[95vw] max-h-[90vh] overflow-y-auto overflow-x-hidden p-0\">\r\n        <DialogHeader className=\"px-6 pt-5 pb-3 border-b bg-gradient-to-r from-blue-50 to-white\">\r\n          <DialogTitle className=\"text-lg font-semibold\">Resumen del Paciente</DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <div className=\"px-6 pb-6\">\r\n          {loading ? (\r\n            <div className=\"flex items-center justify-center py-12\">\r\n              <Loader2 className=\"h-8 w-8 animate-spin text-blue-600\" />\r\n              <p className=\"ml-3 text-gray-600\">Cargando información del paciente...</p>\r\n            </div>\r\n        ) : error ? (\r\n          <div className=\"text-center py-12\">\r\n            <AlertCircle className=\"h-12 w-12 text-red-500 mx-auto mb-4\" />\r\n            <p className=\"text-gray-900 font-semibold mb-2\">Error al cargar información</p>\r\n            <p className=\"text-gray-600 text-sm\">{error}</p>\r\n            <Button \r\n              variant=\"outline\" \r\n              className=\"mt-4\"\r\n              onClick={loadPatientData}\r\n            >\r\n              Reintentar\r\n            </Button>\r\n          </div>\r\n        ) : patientData ? (\r\n          <div className=\"space-y-4 mt-4\">\r\n            {/* Header con info básica - Más compacto */}\r\n            <div className=\"bg-white border rounded-lg p-4\">\r\n              <div className=\"flex items-start gap-4\">\r\n                <Avatar className=\"h-16 w-16 ring-2 ring-blue-100\">\r\n                  <AvatarImage src={patientData.avatar_url} />\r\n                  <AvatarFallback className=\"text-base bg-blue-100 text-blue-700\">\r\n                    {getInitials(patientData.nombre_completo)}\r\n                  </AvatarFallback>\r\n                </Avatar>\r\n                \r\n                <div className=\"flex-1 min-w-0\">\r\n                  <div className=\"flex items-center gap-2 mb-2\">\r\n                    <h2 className=\"text-xl font-bold text-gray-900 truncate\">\r\n                      {patientData.nombre_completo}\r\n                    </h2>\r\n                    {appointment.offline_patient_id && !appointment.paciente_id && (\r\n                      <Badge variant=\"secondary\" className=\"text-xs shrink-0\">\r\n                        Paciente sin cuenta\r\n                      </Badge>\r\n                    )}\r\n                  </div>\r\n                  \r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-1.5 text-sm\">\r\n                    {patientData.fecha_nacimiento && (\r\n                      <div className=\"flex items-center gap-1.5 text-gray-600 min-w-0\">\r\n                        <Calendar className=\"h-3.5 w-3.5 shrink-0\" />\r\n                        <span className=\"truncate\">\r\n                          {getAge(patientData.fecha_nacimiento)} años ({format(new Date(patientData.fecha_nacimiento), \"dd/MM/yyyy\")})\r\n                        </span>\r\n                      </div>\r\n                    )}\r\n                    \r\n                    {patientData.telefono && (\r\n                      <div className=\"flex items-center gap-1.5 text-gray-600 min-w-0\">\r\n                        <Phone className=\"h-3.5 w-3.5 shrink-0\" />\r\n                        <span className=\"truncate\">{patientData.telefono}</span>\r\n                      </div>\r\n                    )}\r\n                    \r\n                    <div className=\"flex items-center gap-1.5 text-gray-600 min-w-0\">\r\n                      <Mail className=\"h-3.5 w-3.5 shrink-0\" />\r\n                      <span className=\"truncate\">{patientData.email}</span>\r\n                    </div>\r\n                    \r\n                    {patientData.cedula && (\r\n                      <div className=\"flex items-center gap-1.5 text-gray-600 min-w-0\">\r\n                        <User className=\"h-3.5 w-3.5 shrink-0\" />\r\n                        <span className=\"truncate\">CI: {patientData.cedula}</span>\r\n                      </div>\r\n                    )}\r\n                    \r\n                    {(patientData.ciudad || patientData.estado) && (\r\n                      <div className=\"flex items-center gap-1.5 text-gray-600 col-span-2\">\r\n                        <MapPin className=\"h-3.5 w-3.5 shrink-0\" />\r\n                        <span className=\"truncate\">\r\n                          {[patientData.ciudad, patientData.estado].filter(Boolean).join(\", \")}\r\n                        </span>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Acciones rápidas */}\r\n                <div className=\"flex gap-2 shrink-0\">\r\n                  {onMessage && appointment.paciente_id && (\r\n                    <Button\r\n                      variant=\"outline\"\r\n                      size=\"sm\"\r\n                      onClick={() => onMessage(appointment)}\r\n                      className=\"h-8\"\r\n                    >\r\n                      <MessageSquare className=\"h-3.5 w-3.5 mr-1.5\" />\r\n                      Mensaje\r\n                    </Button>\r\n                  )}\r\n                  {onStartVideo && appointment.paciente_id && appointment.tipo_cita === \"telemedicina\" && (\r\n                    <Button\r\n                      variant=\"outline\"\r\n                      size=\"sm\"\r\n                      onClick={() => onStartVideo(appointment)}\r\n                      className=\"h-8\"\r\n                    >\r\n                      <Video className=\"h-3.5 w-3.5 mr-1.5\" />\r\n                      Video\r\n                    </Button>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Información de la cita actual - Más compacto */}\r\n            <div className=\"bg-white border rounded-lg p-4\">\r\n              <h3 className=\"text-sm font-semibold text-gray-900 mb-3\">Cita Actual</h3>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <div className=\"min-w-0\">\r\n                  <p className=\"text-xs text-gray-500 mb-0.5\">Fecha y Hora</p>\r\n                  <p className=\"text-sm font-medium text-gray-900 break-words\">\r\n                    {format(new Date(appointment.fecha_hora), \"EEEE, d 'de' MMMM 'de' yyyy\", { locale: es })}\r\n                  </p>\r\n                  <p className=\"text-sm text-gray-600\">\r\n                    {format(new Date(appointment.fecha_hora), \"HH:mm\", { locale: es })} - {format(new Date(appointment.fecha_hora_fin), \"HH:mm\", { locale: es })}\r\n                  </p>\r\n                </div>\r\n                <div className=\"min-w-0\">\r\n                  <p className=\"text-xs text-gray-500 mb-0.5\">Estado</p>\r\n                  <Badge className={getStatusColor(appointment.status)}>\r\n                    {appointment.status}\r\n                  </Badge>\r\n                </div>\r\n                <div className=\"col-span-full min-w-0\">\r\n                  <p className=\"text-xs text-gray-500 mb-0.5\">Motivo</p>\r\n                  <p className=\"text-sm font-medium text-gray-900 break-words\">{appointment.motivo}</p>\r\n                </div>\r\n                {appointment.notas_internas && (\r\n                  <div className=\"col-span-full min-w-0\">\r\n                    <p className=\"text-xs text-gray-500 mb-0.5\">Notas Internas</p>\r\n                    <p className=\"text-sm text-gray-700 break-words\">{appointment.notas_internas}</p>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Tabs con información detallada - Diseño minimalista */}\r\n            <Tabs defaultValue=\"medical\" className=\"w-full\">\r\n              <TabsList className=\"grid w-full grid-cols-3 h-9\">\r\n                <TabsTrigger value=\"medical\" className=\"text-xs\">Información Médica</TabsTrigger>\r\n                <TabsTrigger value=\"history\" className=\"text-xs\">Historial</TabsTrigger>\r\n                <TabsTrigger value=\"emergency\" className=\"text-xs\">Emergencia</TabsTrigger>\r\n              </TabsList>\r\n\r\n              <TabsContent value=\"medical\" className=\"space-y-3 mt-3\">\r\n                {/* Datos Vitales */}\r\n                {(patientData.grupo_sanguineo || patientData.peso_kg || patientData.altura_cm) && (\r\n                  <div className=\"bg-white border rounded-lg p-3\">\r\n                    <h4 className=\"text-xs font-semibold text-gray-900 mb-2 flex items-center gap-1.5\">\r\n                      <Heart className=\"h-3.5 w-3.5\" />\r\n                      Datos Vitales\r\n                    </h4>\r\n                    <div className=\"grid grid-cols-3 gap-4\">\r\n                      {patientData.grupo_sanguineo && (\r\n                        <div>\r\n                          <p className=\"text-xs text-gray-500\">Grupo Sanguíneo</p>\r\n                          <p className=\"text-sm font-medium\">{patientData.grupo_sanguineo}</p>\r\n                        </div>\r\n                      )}\r\n                      {patientData.peso_kg && (\r\n                        <div>\r\n                          <p className=\"text-xs text-gray-500\">Peso</p>\r\n                          <p className=\"text-sm font-medium\">{patientData.peso_kg} kg</p>\r\n                        </div>\r\n                      )}\r\n                      {patientData.altura_cm && (\r\n                        <div>\r\n                          <p className=\"text-xs text-gray-500\">Altura</p>\r\n                          <p className=\"text-sm font-medium\">{patientData.altura_cm} cm</p>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Alergias */}\r\n                {patientData.alergias && patientData.alergias.length > 0 && (\r\n                  <div className=\"bg-red-50 border border-red-200 rounded-lg p-3\">\r\n                    <h4 className=\"text-xs font-semibold text-red-900 mb-2 flex items-center gap-1.5\">\r\n                      <AlertCircle className=\"h-3.5 w-3.5\" />\r\n                      Alergias\r\n                    </h4>\r\n                    <div className=\"flex flex-wrap gap-1.5\">\r\n                      {patientData.alergias.map((alergia, index) => (\r\n                        <Badge key={index} variant=\"destructive\" className=\"text-xs\">\r\n                          {alergia}\r\n                        </Badge>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Enfermedades Crónicas */}\r\n                {patientData.enfermedades_cronicas && patientData.enfermedades_cronicas.length > 0 && (\r\n                  <div className=\"bg-white border rounded-lg p-3\">\r\n                    <h4 className=\"text-xs font-semibold text-gray-900 mb-2 flex items-center gap-1.5\">\r\n                      <FileText className=\"h-3.5 w-3.5\" />\r\n                      Enfermedades Crónicas\r\n                    </h4>\r\n                    <ul className=\"list-disc list-inside space-y-0.5\">\r\n                      {patientData.enfermedades_cronicas.map((enfermedad, index) => (\r\n                        <li key={index} className=\"text-xs text-gray-700\">{enfermedad}</li>\r\n                      ))}\r\n                    </ul>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Medicamentos Actuales */}\r\n                {patientData.medicamentos_actuales && (\r\n                  <div className=\"bg-white border rounded-lg p-3\">\r\n                    <h4 className=\"text-xs font-semibold text-gray-900 mb-2 flex items-center gap-1.5\">\r\n                      <Pill className=\"h-3.5 w-3.5\" />\r\n                      Medicamentos Actuales\r\n                    </h4>\r\n                    <p className=\"text-xs text-gray-700 whitespace-pre-wrap\">{patientData.medicamentos_actuales}</p>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Cirugías Previas */}\r\n                {patientData.cirugias_previas && (\r\n                  <div className=\"bg-white border rounded-lg p-3\">\r\n                    <h4 className=\"text-xs font-semibold text-gray-900 mb-2\">Cirugías Previas</h4>\r\n                    <p className=\"text-xs text-gray-700 whitespace-pre-wrap\">{patientData.cirugias_previas}</p>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Mensaje si no hay datos médicos */}\r\n                {!patientData.grupo_sanguineo && \r\n                 !patientData.peso_kg && \r\n                 !patientData.altura_cm && \r\n                 (!patientData.alergias || patientData.alergias.length === 0) &&\r\n                 (!patientData.enfermedades_cronicas || patientData.enfermedades_cronicas.length === 0) &&\r\n                 !patientData.medicamentos_actuales &&\r\n                 !patientData.cirugias_previas && (\r\n                  <div className=\"text-center py-8\">\r\n                    <p className=\"text-sm text-gray-500\">No hay información médica registrada</p>\r\n                  </div>\r\n                )}\r\n              </TabsContent>\r\n\r\n              <TabsContent value=\"history\" className=\"space-y-3 mt-3\">\r\n                {/* Resumen de Historial */}\r\n                <div className=\"bg-white border rounded-lg p-3\">\r\n                  <h4 className=\"text-xs font-semibold text-gray-900 mb-3\">Resumen de Historial</h4>\r\n                  <div className=\"grid grid-cols-3 gap-4\">\r\n                    <div>\r\n                      <p className=\"text-xs text-gray-500\">Total de Citas</p>\r\n                      <p className=\"text-xl font-bold text-blue-600\">\r\n                        {appointmentHistory.length}\r\n                      </p>\r\n                    </div>\r\n                    {appointmentHistory.length > 0 && (\r\n                      <>\r\n                        <div>\r\n                          <p className=\"text-xs text-gray-500\">Completadas</p>\r\n                          <p className=\"text-xl font-bold text-green-600\">\r\n                            {appointmentHistory.filter(a => a.status === \"completada\").length}\r\n                          </p>\r\n                        </div>\r\n                        <div>\r\n                          <p className=\"text-xs text-gray-500\">Última Cita</p>\r\n                          <p className=\"text-sm font-medium\">\r\n                            {format(new Date(appointmentHistory[0].fecha_hora), \"dd/MM/yyyy\", { locale: es })}\r\n                          </p>\r\n                        </div>\r\n                      </>\r\n                    )}\r\n                  </div>\r\n                  {medicalHistory && medicalHistory.diagnosticos_frecuentes.length > 0 && (\r\n                    <div className=\"mt-3 pt-3 border-t\">\r\n                      <p className=\"text-xs text-gray-500 mb-2\">Diagnósticos Frecuentes</p>\r\n                      <div className=\"space-y-1.5\">\r\n                        {medicalHistory.diagnosticos_frecuentes.map((diag, index) => (\r\n                          <div key={index} className=\"flex justify-between items-center text-xs\">\r\n                            <span className=\"text-gray-700\">{diag.diagnostico}</span>\r\n                            <Badge variant=\"secondary\" className=\"text-xs\">{diag.count}x</Badge>\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Historial de Citas */}\r\n                <div className=\"bg-white border rounded-lg p-3\">\r\n                  <h4 className=\"text-xs font-semibold text-gray-900 mb-3 flex items-center gap-2\">\r\n                    <Calendar className=\"h-3.5 w-3.5\" />\r\n                    Historial de Citas\r\n                  </h4>\r\n                  {appointmentHistory.length > 0 ? (\r\n                    <div className=\"space-y-2\">\r\n                      {appointmentHistory.map((apt) => (\r\n                        <div key={apt.id} className=\"flex items-start justify-between py-2 border-b last:border-0 last:pb-0\">\r\n                          <div className=\"flex-1 min-w-0 mr-3\">\r\n                            <div className=\"flex items-center gap-2 mb-1\">\r\n                              <p className=\"font-medium text-xs text-gray-900 truncate\">{apt.motivo}</p>\r\n                              <Badge className={`${getStatusColor(apt.status)} text-xs shrink-0`}>\r\n                                {apt.status}\r\n                              </Badge>\r\n                            </div>\r\n                            <p className=\"text-xs text-gray-500 flex items-center gap-1\">\r\n                              <Calendar className=\"h-3 w-3\" />\r\n                              {format(new Date(apt.fecha_hora), \"EEEE, d 'de' MMMM 'de' yyyy\", { locale: es })}\r\n                            </p>\r\n                            <p className=\"text-xs text-gray-500 flex items-center gap-1 mt-0.5\">\r\n                              <Clock className=\"h-3 w-3\" />\r\n                              {format(new Date(apt.fecha_hora), \"HH:mm\", { locale: es })}\r\n                              {apt.duracion_minutos && ` (${apt.duracion_minutos} min)`}\r\n                            </p>\r\n                            {apt.tipo_cita && (\r\n                              <p className=\"text-xs text-gray-600 mt-1 capitalize flex items-center gap-1\">\r\n                                {apt.tipo_cita === \"telemedicina\" && <Video className=\"h-3 w-3 text-green-600\" />}\r\n                                {apt.tipo_cita === \"presencial\" && <MapPin className=\"h-3 w-3 text-blue-600\" />}\r\n                                {apt.tipo_cita === \"urgencia\" && <AlertCircle className=\"h-3 w-3 text-red-600\" />}\r\n                                {apt.tipo_cita.replace(\"_\", \" \")}\r\n                              </p>\r\n                            )}\r\n                            {apt.notas_internas && (\r\n                              <p className=\"text-xs text-gray-500 mt-1 italic\">\r\n                                \"{apt.notas_internas.substring(0, 80)}{apt.notas_internas.length > 80 ? \"...\" : \"\"}\"\r\n                              </p>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"text-center py-6\">\r\n                      <Calendar className=\"h-8 w-8 text-gray-300 mx-auto mb-2\" />\r\n                      <p className=\"text-xs text-gray-500\">No hay citas registradas</p>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </TabsContent>\r\n\r\n              <TabsContent value=\"emergency\" className=\"mt-3\">\r\n                <div className=\"bg-red-50 border border-red-200 rounded-lg p-3\">\r\n                  <h4 className=\"text-xs font-semibold text-red-900 mb-3 flex items-center gap-1.5\">\r\n                    <AlertCircle className=\"h-3.5 w-3.5\" />\r\n                    Contacto de Emergencia\r\n                  </h4>\r\n                  {patientData.contacto_emergencia_nombre ? (\r\n                    <div className=\"space-y-2\">\r\n                      <div>\r\n                        <p className=\"text-xs text-red-700\">Nombre</p>\r\n                        <p className=\"text-sm font-medium text-red-900\">{patientData.contacto_emergencia_nombre}</p>\r\n                      </div>\r\n                      {patientData.contacto_emergencia_telefono && (\r\n                        <div>\r\n                          <p className=\"text-xs text-red-700\">Teléfono</p>\r\n                          <p className=\"text-sm font-medium text-red-900\">{patientData.contacto_emergencia_telefono}</p>\r\n                        </div>\r\n                      )}\r\n                      {patientData.contacto_emergencia_relacion && (\r\n                        <div>\r\n                          <p className=\"text-xs text-red-700\">Relación</p>\r\n                          <p className=\"text-sm font-medium text-red-900\">{patientData.contacto_emergencia_relacion}</p>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  ) : (\r\n                    <p className=\"text-xs text-red-700 text-center py-4\">No hay contacto de emergencia registrado</p>\r\n                  )}\r\n                </div>\r\n              </TabsContent>\r\n            </Tabs>\r\n          </div>\r\n        ) : (\r\n          <div className=\"text-center py-12\">\r\n            <p className=\"text-sm text-gray-600\">No se pudo cargar la información del paciente</p>\r\n          </div>\r\n        )}\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\calendar\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\calendar\\unified-calendar.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'LayoutGrid' is defined but never used.","line":11,"column":83,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":93},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'LayoutList' is defined but never used.","line":11,"column":95,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":105},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'dayAppointments' is assigned a value but never used.","line":111,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":111,"endColumn":26}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file unified-calendar.tsx\r\n * @description Calendario unificado compacto con vistas integradas (Día, Semana, Mes, Lista)\r\n * @module Dashboard/Medico/Calendar\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { ChevronLeft, ChevronRight, Plus, Calendar as CalendarIcon, AlignJustify, LayoutGrid, LayoutList } from \"lucide-react\";\r\nimport { format, addDays, addWeeks, addMonths, subDays, subWeeks, subMonths, startOfWeek, endOfWeek, startOfMonth, endOfMonth, eachDayOfInterval, isSameDay, isSameMonth, isToday, parseISO } from \"date-fns\";\r\nimport { es } from \"date-fns/locale\";\r\nimport type { CalendarAppointment } from \"./types\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { AppointmentCard } from \"./appointment-card\";\r\nimport { AppointmentStack } from \"./appointment-stack\";\r\nimport {\r\n  DropdownMenu,\r\n  DropdownMenuContent,\r\n  DropdownMenuItem,\r\n  DropdownMenuTrigger,\r\n} from \"@red-salud/ui\";\r\n\r\ntype ViewMode = \"day\" | \"week\" | \"month\" | \"list\";\r\n\r\ninterface UnifiedCalendarProps {\r\n  appointments: CalendarAppointment[];\r\n  onNewAppointment?: () => void;\r\n  onAppointmentClick?: (appointment: CalendarAppointment) => void;\r\n  onTimeSlotClick?: (date: Date, hour?: number) => void;\r\n  onMessage?: (appointment: CalendarAppointment) => void;\r\n  onStartVideo?: (appointment: CalendarAppointment) => void;\r\n  loading?: boolean;\r\n}\r\n\r\nexport function UnifiedCalendar({\r\n  appointments,\r\n  onNewAppointment,\r\n  onAppointmentClick,\r\n  onTimeSlotClick,\r\n  onMessage,\r\n  onStartVideo,\r\n  loading = false,\r\n}: UnifiedCalendarProps) {\r\n  const [currentDate, setCurrentDate] = useState(new Date());\r\n  const [viewMode, setViewMode] = useState<ViewMode>(\"week\");\r\n\r\n  const handlePrevious = () => {\r\n    switch (viewMode) {\r\n      case \"day\":\r\n        setCurrentDate(subDays(currentDate, 1));\r\n        break;\r\n      case \"week\":\r\n        setCurrentDate(subWeeks(currentDate, 1));\r\n        break;\r\n      case \"month\":\r\n        setCurrentDate(subMonths(currentDate, 1));\r\n        break;\r\n    }\r\n  };\r\n\r\n  const handleNext = () => {\r\n    switch (viewMode) {\r\n      case \"day\":\r\n        setCurrentDate(addDays(currentDate, 1));\r\n        break;\r\n      case \"week\":\r\n        setCurrentDate(addWeeks(currentDate, 1));\r\n        break;\r\n      case \"month\":\r\n        setCurrentDate(addMonths(currentDate, 1));\r\n        break;\r\n    }\r\n  };\r\n\r\n  const handleToday = () => {\r\n    setCurrentDate(new Date());\r\n  };\r\n\r\n  const getDateRangeText = () => {\r\n    switch (viewMode) {\r\n      case \"day\":\r\n        return format(currentDate, \"EEEE, d 'de' MMMM\", { locale: es });\r\n      case \"week\":\r\n        const weekStart = startOfWeek(currentDate, { weekStartsOn: 1 });\r\n        const weekEnd = endOfWeek(currentDate, { weekStartsOn: 1 });\r\n        // Si el año cambia, mostrarlo. Si no, ocultar por brevedad\r\n        const sameYear = weekStart.getFullYear() === weekEnd.getFullYear();\r\n        return `${format(weekStart, \"d MMM\", { locale: es })} - ${format(weekEnd, sameYear ? \"d MMM\" : \"d MMM yyyy\", { locale: es })}`;\r\n      case \"month\":\r\n        return format(currentDate, \"MMMM yyyy\", { locale: es });\r\n      case \"list\":\r\n        return \"Todas las citas\";\r\n    }\r\n  };\r\n\r\n  const getAppointmentsForDate = (date: Date) => {\r\n    return appointments.filter(apt => isSameDay(new Date(apt.fecha_hora), date));\r\n  };\r\n\r\n  const getAppointmentsForHour = (date: Date, hour: number) => {\r\n    return appointments.filter(apt => {\r\n      const aptDate = new Date(apt.fecha_hora);\r\n      return isSameDay(aptDate, date) && aptDate.getHours() === hour;\r\n    });\r\n  };\r\n\r\n  const renderDayView = () => {\r\n    const hours = Array.from({ length: 16 }, (_, i) => i + 7); // 7 AM - 10 PM\r\n    const dayAppointments = getAppointmentsForDate(currentDate);\r\n\r\n    // Ajuste de ancho responsivo\r\n    return (\r\n      <div className=\"h-full\">\r\n        <div className=\"min-w-full md:min-w-[600px]\">\r\n          {hours.map(hour => {\r\n            const hourAppointments = getAppointmentsForHour(currentDate, hour);\r\n            return (\r\n              <div\r\n                key={hour}\r\n                className=\"flex border-b border-border hover:bg-muted/30 transition-colors\"\r\n                onClick={() => hourAppointments.length === 0 && onTimeSlotClick?.(currentDate, hour)}\r\n              >\r\n                <div className=\"w-14 md:w-16 flex-shrink-0 p-1 text-xs text-muted-foreground font-medium border-r border-border md:border-none flex items-start justify-center pt-2\">\r\n                  {format(new Date().setHours(hour, 0), \"HH:mm\")}\r\n                </div>\r\n                <div className=\"flex-1 min-h-[50px] md:min-h-[40px] p-0.5 relative\">\r\n                  {hourAppointments.length > 0 ? (\r\n                    <AppointmentStack\r\n                      appointments={hourAppointments}\r\n                      maxVisible={3}\r\n                      compact={false}\r\n                      onAppointmentClick={onAppointmentClick}\r\n                    />\r\n                  ) : (\r\n                    <div className=\"h-full w-full absolute inset-0 opacity-0 hover:opacity-100 transition-opacity flex items-center justify-center pointer-events-none\">\r\n                      <Plus className=\"h-4 w-4 text-muted-foreground/30\" />\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const renderWeekView = () => {\r\n    const weekStart = startOfWeek(currentDate, { weekStartsOn: 1 });\r\n    const weekDays = eachDayOfInterval({ start: weekStart, end: endOfWeek(weekStart, { weekStartsOn: 1 }) });\r\n    const hours = Array.from({ length: 16 }, (_, i) => i + 7);\r\n\r\n    return (\r\n      <div className=\"h-full\">\r\n        <div className=\"min-w-[700px] lg:min-w-full\">\r\n          {/* Header con días - MÁS COMPACTO */}\r\n          <div className=\"flex border-b border-border bg-muted sticky top-0 z-10\">\r\n            <div className=\"w-12 flex-shrink-0\" />\r\n            {weekDays.map(day => (\r\n              <div key={day.toISOString()} className={cn(\"flex-1 p-2 text-center border-l border-border/50\", isToday(day) && \"bg-primary/5\")}>\r\n                <div className=\"text-[10px] text-muted-foreground uppercase font-bold tracking-wider\">\r\n                  {format(day, \"EEE\", { locale: es })}\r\n                </div>\r\n                <div className={cn(\r\n                  \"text-sm font-semibold inline-flex items-center justify-center w-7 h-7 rounded-full mt-0.5\",\r\n                  isToday(day) && \"bg-primary text-primary-foreground\"\r\n                )}>\r\n                  {format(day, \"d\")}\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n\r\n          {/* Grid de horas - MÁS COMPACTO */}\r\n          {hours.map(hour => (\r\n            <div key={hour} className=\"flex border-b border-border\">\r\n              <div className=\"w-12 flex-shrink-0 p-1 text-[10px] text-muted-foreground font-medium text-center pt-2\">\r\n                {format(new Date().setHours(hour, 0), \"HH:mm\")}\r\n              </div>\r\n              {weekDays.map(day => {\r\n                const hourAppointments = getAppointmentsForHour(day, hour);\r\n                const isDayToday = isToday(day);\r\n                return (\r\n                  <div\r\n                    key={day.toISOString()}\r\n                    className={cn(\r\n                      \"flex-1 min-h-[44px] p-0.5 border-l border-border hover:bg-muted/30 transition-colors cursor-pointer relative\",\r\n                      isDayToday && \"bg-primary/[0.02]\"\r\n                    )}\r\n                    onClick={() => hourAppointments.length === 0 && onTimeSlotClick?.(day, hour)}\r\n                  >\r\n                    {hourAppointments.length > 0 && (\r\n                      <AppointmentStack\r\n                        appointments={hourAppointments}\r\n                        maxVisible={2}\r\n                        compact={true}\r\n                        onAppointmentClick={onAppointmentClick}\r\n                      />\r\n                    )}\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const renderMonthView = () => {\r\n    const monthStart = startOfMonth(currentDate);\r\n    const monthEnd = endOfMonth(currentDate);\r\n    const calendarStart = startOfWeek(monthStart, { weekStartsOn: 1 });\r\n    const calendarEnd = endOfWeek(monthEnd, { weekStartsOn: 1 });\r\n    const calendarDays = eachDayOfInterval({ start: calendarStart, end: calendarEnd });\r\n\r\n    return (\r\n      <div className=\"h-full flex flex-col\">\r\n        {/* Header Days */}\r\n        <div className=\"grid grid-cols-7 border-b border-border\">\r\n          {[\"Lun\", \"Mar\", \"Mié\", \"Jue\", \"Vie\", \"Sáb\", \"Dom\"].map(day => (\r\n            <div key={day} className=\"bg-muted/30 p-2 text-center text-xs font-semibold text-muted-foreground uppercase tracking-wide\">\r\n              {day}\r\n            </div>\r\n          ))}\r\n        </div>\r\n\r\n        <div className=\"grid grid-cols-7 grid-rows-5 flex-1 bg-border gap-px overflow-y-auto\">\r\n          {calendarDays.map(day => {\r\n            const dayAppointments = getAppointmentsForDate(day);\r\n            const isCurrentMonth = isSameMonth(day, currentDate);\r\n\r\n            return (\r\n              <div\r\n                key={day.toISOString()}\r\n                className={cn(\r\n                  \"bg-card min-h-[80px] p-1.5 cursor-pointer hover:bg-muted/30 transition-colors relative flex flex-col\",\r\n                  !isCurrentMonth && \"bg-muted/10 text-muted-foreground\"\r\n                )}\r\n                onClick={() => {\r\n                  setCurrentDate(day);\r\n                  setViewMode(\"day\");\r\n                }}\r\n              >\r\n                <div className={cn(\r\n                  \"text-xs font-medium mb-1 ml-1 w-6 h-6 flex items-center justify-center rounded-full\",\r\n                  isToday(day) ? \"bg-primary text-primary-foreground\" : \"\"\r\n                )}>\r\n                  {format(day, \"d\")}\r\n                </div>\r\n\r\n                <div className=\"flex-1 space-y-1 overflow-hidden\">\r\n                  {dayAppointments.slice(0, 3).map(apt => (\r\n                    <div key={apt.id} className=\"text-[10px] truncate px-1 rounded-sm border-l-2 pl-1 bg-muted/40\" style={{ borderLeftColor: apt.color }}>\r\n                      {format(parseISO(apt.fecha_hora), 'HH:mm')} {apt.paciente_nombre}\r\n                    </div>\r\n                  ))}\r\n                  {dayAppointments.length > 3 && (\r\n                    <div className=\"text-[10px] text-muted-foreground pl-1\">\r\n                      + {dayAppointments.length - 3} más\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const renderListView = () => {\r\n    // Group appointments by date\r\n    const groupedAppointments: Record<string, CalendarAppointment[]> = {};\r\n\r\n    // Sort all appointments by date\r\n    const sortedAppointments = [...appointments].sort((a, b) =>\r\n      new Date(a.fecha_hora).getTime() - new Date(b.fecha_hora).getTime()\r\n    );\r\n\r\n    sortedAppointments.forEach(apt => {\r\n      const dateKey = format(parseISO(apt.fecha_hora), 'yyyy-MM-dd');\r\n      if (!groupedAppointments[dateKey]) {\r\n        groupedAppointments[dateKey] = [];\r\n      }\r\n      groupedAppointments[dateKey].push(apt);\r\n    });\r\n\r\n    return (\r\n      <div className=\"h-full p-4 overflow-y-auto\">\r\n        {sortedAppointments.length > 0 ? (\r\n          <div className=\"space-y-6 w-full pb-10\">\r\n            {Object.entries(groupedAppointments).map(([dateKey, apts]) => (\r\n              <div key={dateKey} className=\"space-y-3\">\r\n                <div className=\"sticky top-0 bg-background/95 backdrop-blur-sm p-2 z-10 border-b border-border flex items-center gap-2\">\r\n                  <div className={cn(\r\n                    \"text-lg font-bold\",\r\n                    isToday(parseISO(dateKey)) && \"text-primary\"\r\n                  )}>\r\n                    {format(parseISO(dateKey), \"EEEE d 'de' MMMM\", { locale: es })}\r\n                  </div>\r\n                  <div className=\"text-xs text-muted-foreground bg-muted px-2 py-0.5 rounded-full\">\r\n                    {apts.length} {apts.length === 1 ? 'cita' : 'citas'}\r\n                  </div>\r\n                </div>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 pl-2 sm:pl-4\">\r\n                  {apts.map(apt => (\r\n                    <AppointmentCard\r\n                      key={apt.id}\r\n                      appointment={apt}\r\n                      onView={onAppointmentClick}\r\n                      onMessage={onMessage}\r\n                      onStartVideo={onStartVideo}\r\n                    />\r\n                  ))}\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        ) : (\r\n          <div className=\"flex items-center justify-center h-full\">\r\n            <div className=\"text-center\">\r\n              <div className=\"h-20 w-20 bg-muted/30 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n                <CalendarIcon className=\"h-10 w-10 text-muted-foreground\" />\r\n              </div>\r\n              <h3 className=\"text-lg font-semibold mb-2\">No hay citas visibles</h3>\r\n              <p className=\"text-muted-foreground mb-6 max-w-[250px] mx-auto\">\r\n                No hay citas que coincidan con los filtros seleccionados o el rango de fechas.\r\n              </p>\r\n              <Button onClick={onNewAppointment}>\r\n                <Plus className=\"h-4 w-4 mr-2\" />\r\n                Agendar Primera Cita\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-full\">\r\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex flex-col h-full bg-background\">\r\n      {/* Toolbar responsive */}\r\n      <div className=\"flex flex-col sm:flex-row items-stretch sm:items-center justify-between p-2 sm:p-3 border-b border-border bg-card gap-3 sm:gap-4 transition-all duration-200\">\r\n\r\n        {/* Navigation & Date */}\r\n        <div className=\"flex items-center justify-between sm:justify-start gap-2\">\r\n          <div className=\"flex items-center bg-muted/30 rounded-lg p-0.5\">\r\n            <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8 hover:bg-background shadow-none\" onClick={handlePrevious}>\r\n              <ChevronLeft className=\"h-4 w-4\" />\r\n            </Button>\r\n            <div className=\"h-4 w-[1px] bg-border mx-1\" />\r\n            <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8 hover:bg-background shadow-none\" onClick={handleNext}>\r\n              <ChevronRight className=\"h-4 w-4\" />\r\n            </Button>\r\n          </div>\r\n\r\n          <Button variant=\"outline\" size=\"sm\" className=\"h-9 hidden md:flex\" onClick={handleToday}>\r\n            Hoy\r\n          </Button>\r\n\r\n          <span className=\"text-sm sm:text-base font-semibold text-foreground ml-1 truncate\">\r\n            {getDateRangeText()}\r\n          </span>\r\n        </div>\r\n\r\n        {/* Controls */}\r\n        <div className=\"flex items-center justify-between sm:justify-end gap-2\">\r\n          {/* View Selector Mobile (Dropdown) / Desktop (Tabs) */}\r\n          <div className=\"sm:hidden\">\r\n            <DropdownMenu>\r\n              <DropdownMenuTrigger asChild>\r\n                <Button variant=\"outline\" size=\"sm\" className=\"w-full\">\r\n                  {viewMode === 'day' ? 'Día' : viewMode === 'week' ? 'Semana' : viewMode === 'month' ? 'Mes' : 'Lista'}\r\n                  <AlignJustify className=\"ml-2 h-4 w-4 opacity-50\" />\r\n                </Button>\r\n              </DropdownMenuTrigger>\r\n              <DropdownMenuContent align=\"end\">\r\n                <DropdownMenuItem onClick={() => setViewMode(\"day\")}>Día</DropdownMenuItem>\r\n                <DropdownMenuItem onClick={() => setViewMode(\"week\")}>Semana</DropdownMenuItem>\r\n                <DropdownMenuItem onClick={() => setViewMode(\"month\")}>Mes</DropdownMenuItem>\r\n                <DropdownMenuItem onClick={() => setViewMode(\"list\")}>Lista</DropdownMenuItem>\r\n              </DropdownMenuContent>\r\n            </DropdownMenu>\r\n          </div>\r\n\r\n          <div className=\"hidden sm:flex items-center bg-muted/30 p-1 rounded-lg\">\r\n            <Button\r\n              variant={viewMode === \"day\" ? \"default\" : \"ghost\"}\r\n              size=\"sm\"\r\n              className=\"h-7 text-xs px-3 shadow-none data-[state=active]:bg-background\"\r\n              onClick={() => setViewMode(\"day\")}\r\n            >\r\n              Día\r\n            </Button>\r\n            <Button\r\n              variant={viewMode === \"week\" ? \"default\" : \"ghost\"}\r\n              size=\"sm\"\r\n              className=\"h-7 text-xs px-3 shadow-none\"\r\n              onClick={() => setViewMode(\"week\")}\r\n            >\r\n              Semana\r\n            </Button>\r\n            <Button\r\n              variant={viewMode === \"month\" ? \"default\" : \"ghost\"}\r\n              size=\"sm\"\r\n              className=\"h-7 text-xs px-3 shadow-none\"\r\n              onClick={() => setViewMode(\"month\")}\r\n            >\r\n              Mes\r\n            </Button>\r\n            <Button\r\n              variant={viewMode === \"list\" ? \"default\" : \"ghost\"}\r\n              size=\"sm\"\r\n              className=\"h-7 text-xs px-3 shadow-none\"\r\n              onClick={() => setViewMode(\"list\")}\r\n            >\r\n              Lista\r\n            </Button>\r\n          </div>\r\n\r\n          <Button onClick={onNewAppointment} size=\"sm\" className=\"h-9 px-4 shadow-sm active:scale-95 transition-transform\">\r\n            <Plus className=\"h-4 w-4 sm:mr-2\" />\r\n            <span className=\"hidden sm:inline\">Nueva Cita</span>\r\n          </Button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Calendar Content */}\r\n      <div className=\"flex-1 min-h-0 overflow-y-auto overflow-x-hidden relative\">\r\n        {viewMode === \"day\" && renderDayView()}\r\n        {viewMode === \"week\" && renderWeekView()}\r\n        {viewMode === \"month\" && renderMonthView()}\r\n        {viewMode === \"list\" && renderListView()}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\calendar\\week-view-improved.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\calendar\\week-view.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AppointmentCard' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'onMessage' is defined but never used.","line":26,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'onStartVideo' is defined but never used.","line":27,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useMemo } from \"react\";\r\nimport { format, startOfWeek, addDays, isSameDay, isToday as checkIsToday } from \"date-fns\";\r\nimport { es } from \"date-fns/locale\";\r\nimport { AppointmentCard } from \"./appointment-card\";\r\nimport type { CalendarAppointment } from \"./types\";\r\nimport { Clock } from \"lucide-react\";\r\n\r\ninterface WeekViewProps {\r\n  date: Date;\r\n  appointments: CalendarAppointment[];\r\n  onAppointmentClick?: (appointment: CalendarAppointment) => void;\r\n  onTimeSlotClick?: (date: Date, hour: number) => void;\r\n  onMessage?: (appointment: CalendarAppointment) => void;\r\n  onStartVideo?: (appointment: CalendarAppointment) => void;\r\n  startHour?: number;\r\n  endHour?: number;\r\n}\r\n\r\nexport function WeekView({\r\n  date,\r\n  appointments,\r\n  onAppointmentClick,\r\n  onTimeSlotClick,\r\n  onMessage,\r\n  onStartVideo,\r\n  startHour = 7,\r\n  endHour = 20,\r\n}: WeekViewProps) {\r\n  const weekStart = useMemo(() => startOfWeek(date, { weekStartsOn: 1 }), [date]);\r\n\r\n  const weekDays = useMemo(() => {\r\n    return Array.from({ length: 7 }, (_, i) => addDays(weekStart, i));\r\n  }, [weekStart]);\r\n\r\n  const hours = useMemo(() => {\r\n    const result = [];\r\n    for (let i = startHour; i <= endHour; i++) {\r\n      result.push(i);\r\n    }\r\n    return result;\r\n  }, [startHour, endHour]);\r\n\r\n  const currentHour = new Date().getHours();\r\n  const today = new Date();\r\n\r\n  const getAppointmentsForDayAndHour = (day: Date, hour: number) => {\r\n    return appointments.filter((apt) => {\r\n      const aptDate = new Date(apt.fecha_hora);\r\n      return isSameDay(aptDate, day) && aptDate.getHours() === hour;\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col h-full bg-white rounded-lg shadow-sm overflow-hidden\">\r\n      {/* Header with Days - Sticky */}\r\n      <div className=\"bg-gradient-to-r from-blue-50 to-indigo-50 border-b-2 border-blue-200 sticky top-0 z-20 shadow-sm\">\r\n        <div className=\"flex\">\r\n          {/* Time column header */}\r\n          <div className=\"w-20 flex-shrink-0 border-r border-blue-200 bg-white/90 backdrop-blur-sm flex items-center justify-center\">\r\n            <Clock className=\"h-5 w-5 text-gray-500\" />\r\n          </div>\r\n          \r\n          {/* Day headers */}\r\n          {weekDays.map((day) => {\r\n            const isCurrentDay = checkIsToday(day);\r\n            return (\r\n              <div\r\n                key={day.toISOString()}\r\n                className={`flex-1 p-4 text-center border-r border-blue-100 last:border-r-0 transition-all ${\r\n                  isCurrentDay \r\n                    ? \"bg-gradient-to-b from-blue-500 to-blue-600 text-white shadow-lg scale-105\" \r\n                    : \"bg-white/80 backdrop-blur-sm hover:bg-blue-50/50\"\r\n                }`}\r\n              >\r\n                <div className={`text-xs font-semibold uppercase tracking-wider ${\r\n                  isCurrentDay ? \"text-blue-100\" : \"text-gray-600\"\r\n                }`}>\r\n                  {format(day, \"EEE\", { locale: es })}\r\n                </div>\r\n                <div className={`text-3xl font-bold mt-1 ${\r\n                  isCurrentDay ? \"text-white\" : \"text-gray-900\"\r\n                }`}>\r\n                  {format(day, \"d\")}\r\n                </div>\r\n                <div className={`text-xs mt-0.5 ${\r\n                  isCurrentDay ? \"text-blue-100\" : \"text-gray-500\"\r\n                }`}>\r\n                  {format(day, \"MMM\", { locale: es })}\r\n                </div>\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Time Grid - Scrollable with fixed height cells */}\r\n      <div className=\"flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100\">\r\n        <div className=\"min-w-full\">\r\n          {hours.map((hour) => {\r\n            const isCurrentHourRow = hour === currentHour && isSameDay(today, date);\r\n            \r\n            return (\r\n              <div \r\n                key={hour} \r\n                className={`flex border-b border-gray-200 transition-colors ${\r\n                  isCurrentHourRow ? \"bg-yellow-50/50 border-yellow-300\" : \"\"\r\n                }`}\r\n              >\r\n                {/* Time Label - Sticky left */}\r\n                <div className={`w-20 flex-shrink-0 p-3 text-sm font-semibold border-r border-gray-200 bg-gray-50/90 backdrop-blur-sm sticky left-0 z-10 flex items-start justify-center ${\r\n                  isCurrentHourRow ? \"bg-yellow-100 text-yellow-800\" : \"text-gray-700\"\r\n                }`}>\r\n                  <div className=\"text-center\">\r\n                    <div>{format(new Date().setHours(hour, 0, 0, 0), \"HH:mm\")}</div>\r\n                    {isCurrentHourRow && (\r\n                      <div className=\"text-[10px] text-yellow-600 font-normal mt-0.5\">Ahora</div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Day Columns - Fixed height for uniformity */}\r\n                {weekDays.map((day) => {\r\n                  const dayAppointments = getAppointmentsForDayAndHour(day, hour);\r\n                  const slotTime = new Date(day.getFullYear(), day.getMonth(), day.getDate(), hour);\r\n                  const isPast = slotTime < new Date();\r\n                  const isCurrentDay = checkIsToday(day);\r\n                  \r\n                  return (\r\n                    <div\r\n                      key={`${day.toISOString()}-${hour}`}\r\n                      className={`flex-1 p-2 h-24 border-r border-gray-200 last:border-r-0 transition-all duration-200 ${\r\n                        isCurrentDay ? \"bg-blue-50/30\" : \"\"\r\n                      } ${\r\n                        isPast\r\n                          ? \"bg-gray-50/70 cursor-not-allowed opacity-60\"\r\n                          : \"cursor-pointer hover:bg-blue-50 hover:shadow-inner\"\r\n                      } ${\r\n                        isCurrentHourRow ? \"ring-2 ring-inset ring-yellow-300/50\" : \"\"\r\n                      }`}\r\n                      onClick={() => {\r\n                        if (!isPast) {\r\n                          onTimeSlotClick?.(day, hour);\r\n                        }\r\n                      }}\r\n                    >\r\n                      {dayAppointments.length > 0 ? (\r\n                        <div className=\"space-y-1.5 h-full overflow-y-auto scrollbar-none\">\r\n                          {dayAppointments.map((apt) => (\r\n                            <div\r\n                              key={apt.id}\r\n                              className=\"group p-2 rounded-md text-xs border-l-4 bg-white shadow-sm hover:shadow-md transition-all cursor-pointer transform hover:scale-[1.02]\"\r\n                              style={{ borderLeftColor: apt.color }}\r\n                              onClick={(e) => {\r\n                                e.stopPropagation();\r\n                                onAppointmentClick?.(apt);\r\n                              }}\r\n                            >\r\n                              <div className=\"font-semibold truncate text-gray-900 group-hover:text-blue-600 transition-colors\">\r\n                                {apt.paciente_nombre}\r\n                              </div>\r\n                              <div className=\"text-gray-500 truncate mt-0.5 text-[11px]\">\r\n                                {apt.motivo}\r\n                              </div>\r\n                              <div className=\"flex items-center gap-1 mt-1\">\r\n                                <span className={`text-[10px] px-1.5 py-0.5 rounded-full font-medium ${\r\n                                  apt.status === \"confirmada\" ? \"bg-green-100 text-green-700\" :\r\n                                  apt.status === \"pendiente\" ? \"bg-yellow-100 text-yellow-700\" :\r\n                                  apt.status === \"completada\" ? \"bg-blue-100 text-blue-700\" :\r\n                                  \"bg-gray-100 text-gray-600\"\r\n                                }`}>\r\n                                  {apt.status}\r\n                                </span>\r\n                              </div>\r\n                            </div>\r\n                          ))}\r\n                        </div>\r\n                      ) : (\r\n                        <div className=\"h-full flex items-center justify-center\">\r\n                          {!isPast && (\r\n                            <div className=\"text-gray-300 text-xs font-medium opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                              + Agregar\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  );\r\n                })}\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\citas\\citas-header.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\citas\\citas-mega-menu-config.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\citas\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\configuracion\\activity-section.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\configuracion\\billing-section.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\configuracion\\configuracion-mega-menu-config.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\configuracion\\constants\\medical-conditions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\configuracion\\constants\\profile-data.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\configuracion\\constants\\universities.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\configuracion\\documents-section.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AnimatePresence' is defined but never used.","line":12,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Input' is defined but never used.","line":23,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Label' is defined but never used.","line":24,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileText' is defined but never used.","line":26,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DoctorDocument' is defined but never used.","line":53,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":53,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":121,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3286,3289],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3286,3289],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DocumentTypeState' is defined but never used.","line":127,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":127,"endColumn":28},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":255,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":255,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8228,8231],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8228,8231],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":307,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":307,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9838,9841],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9838,9841],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":385,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":385,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12345,12348],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12345,12348],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_' is defined but never used.","line":409,"column":69,"nodeType":null,"messageId":"unusedVar","endLine":409,"endColumn":70},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":821,"column":33,"nodeType":"JSXOpeningElement","endLine":825,"endColumn":35}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file documents-section.tsx\r\n * @description Sección de documentos profesionales para configuración del médico.\r\n * Muestra todos los tipos de documentos como tarjetas con acciones individuales.\r\n * La cédula usa verificación Didit para validar identidad + prueba de vida.\r\n * @module Dashboard/Medico/Configuracion\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useState, useEffect, useCallback, useRef } from \"react\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Progress } from \"@red-salud/ui\";\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogDescription,\r\n    DialogHeader,\r\n    DialogTitle,\r\n} from \"@red-salud/ui\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { Label } from \"@red-salud/ui\";\r\nimport {\r\n    FileText,\r\n    Upload,\r\n    Download,\r\n    CheckCircle,\r\n    Clock,\r\n    AlertCircle,\r\n    Loader2,\r\n    Eye,\r\n    Trash2,\r\n    Shield,\r\n    Sparkles,\r\n    FileImage,\r\n    FileScan,\r\n    ExternalLink,\r\n    GraduationCap,\r\n    IdCard,\r\n    Stethoscope,\r\n    Award,\r\n    FileCheck,\r\n    X,\r\n} from \"lucide-react\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport {\r\n    getDoctorDocuments,\r\n    uploadDoctorDocument,\r\n    deleteDoctorDocument,\r\n    getDocumentDownloadUrl,\r\n    type DoctorDocument,\r\n    type DoctorDocumentType,\r\n} from \"@/lib/supabase/services/doctor-documents-service\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { toast } from \"sonner\";\r\n\r\n/**\r\n * Configuración de cada tipo de documento\r\n */\r\nconst DOCUMENT_CONFIGS: Record<DoctorDocumentType, {\r\n    name: string;\r\n    description: string;\r\n    icon: React.ComponentType<{ className?: string }>;\r\n    required: boolean;\r\n    useDidit?: boolean; // Si usa verificación Didit\r\n}> = {\r\n    cedula: {\r\n        name: \"Cédula de Identidad\",\r\n        description: \"Verificación de identidad con foto y prueba de vida\",\r\n        icon: IdCard,\r\n        required: true,\r\n        useDidit: true, // Este usa Didit para verificación\r\n    },\r\n    titulo: {\r\n        name: \"Título Universitario\",\r\n        description: \"Título de Médico Cirujano o equivalente\",\r\n        icon: GraduationCap,\r\n        required: true,\r\n    },\r\n    mpps: {\r\n        name: \"Certificado MPPS\",\r\n        description: \"Registro del Ministerio de Salud vigente\",\r\n        icon: FileCheck,\r\n        required: true,\r\n    },\r\n    especialidad: {\r\n        name: \"Certificado de Especialidad\",\r\n        description: \"Título de especialista médico (si aplica)\",\r\n        icon: Stethoscope,\r\n        required: false,\r\n    },\r\n    curso: {\r\n        name: \"Certificados de Cursos\",\r\n        description: \"Diplomados, cursos y formación adicional\",\r\n        icon: Award,\r\n        required: false,\r\n    },\r\n    seguro: {\r\n        name: \"Póliza de Responsabilidad Civil\",\r\n        description: \"Seguro de responsabilidad profesional\",\r\n        icon: Shield,\r\n        required: false,\r\n    },\r\n};\r\n\r\n/**\r\n * Documento formateado para la UI\r\n */\r\ninterface DocumentUI {\r\n    id: string;\r\n    name: string;\r\n    type: DoctorDocumentType;\r\n    status: \"verified\" | \"pending\" | \"rejected\";\r\n    uploadDate: string;\r\n    fileUrl: string;\r\n    filePath: string;\r\n    fileSize: number | null;\r\n    mimeType: string | null;\r\n    extractedData: any;\r\n}\r\n\r\n/**\r\n * Estado de cada tipo de documento\r\n */\r\ninterface DocumentTypeState {\r\n    type: DoctorDocumentType;\r\n    config: typeof DOCUMENT_CONFIGS[DoctorDocumentType];\r\n    document: DocumentUI | null;\r\n    isUploading: boolean;\r\n    isAnalyzing: boolean;\r\n    isDeleting: boolean;\r\n}\r\n\r\nexport function DocumentsSection() {\r\n    const [loading, setLoading] = useState(true);\r\n    const [documents, setDocuments] = useState<DocumentUI[]>([]);\r\n    const [userId, setUserId] = useState<string | null>(null);\r\n    const [isPreviewOpen, setIsPreviewOpen] = useState(false);\r\n    const [previewDoc, setPreviewDoc] = useState<DocumentUI | null>(null);\r\n    const [uploadingType, setUploadingType] = useState<DoctorDocumentType | null>(null);\r\n    const [analyzingId, setAnalyzingId] = useState<string | null>(null);\r\n    const [deletingId, setDeletingId] = useState<string | null>(null);\r\n\r\n    // Estados de Didit\r\n    const [identityVerified, setIdentityVerified] = useState(false);\r\n    const [isVerifyingIdentity, setIsVerifyingIdentity] = useState(false);\r\n\r\n    // Modal de upload\r\n    const [uploadModalOpen, setUploadModalOpen] = useState(false);\r\n    const [uploadType, setUploadType] = useState<DoctorDocumentType | null>(null);\r\n    const [selectedFile, setSelectedFile] = useState<File | null>(null);\r\n    const [dragActive, setDragActive] = useState(false);\r\n    const fileInputRef = useRef<HTMLInputElement>(null);\r\n\r\n    /**\r\n     * Carga documentos y estado de verificación\r\n     */\r\n    const loadData = useCallback(async () => {\r\n        try {\r\n            const { data: { user } } = await supabase.auth.getUser();\r\n            if (!user) return;\r\n\r\n            setUserId(user.id);\r\n\r\n            // Verificar estado de Didit\r\n            const { data: profile } = await supabase\r\n                .from(\"profiles\")\r\n                .select(\"photo_verified, cedula_verificada, cedula\")\r\n                .eq(\"id\", user.id)\r\n                .single();\r\n\r\n            if (profile) {\r\n                setIdentityVerified(profile.photo_verified || false);\r\n            }\r\n\r\n            // Cargar documentos\r\n            const result = await getDoctorDocuments(user.id);\r\n            if (result.success && result.data) {\r\n                setDocuments(result.data.map(doc => ({\r\n                    id: doc.id,\r\n                    name: doc.document_name,\r\n                    type: doc.document_type,\r\n                    status: doc.verification_status,\r\n                    uploadDate: doc.created_at,\r\n                    fileUrl: doc.file_url,\r\n                    filePath: doc.file_path,\r\n                    fileSize: doc.file_size,\r\n                    mimeType: doc.mime_type,\r\n                    extractedData: doc.extracted_data,\r\n                })));\r\n            }\r\n        } catch (error) {\r\n            console.error(\"[DocumentsSection] Error:\", error);\r\n            toast.error(\"Error al cargar documentos\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        loadData();\r\n    }, [loadData]);\r\n\r\n    /**\r\n     * Obtener documento por tipo\r\n     */\r\n    const getDocByType = (type: DoctorDocumentType): DocumentUI | null => {\r\n        return documents.find(d => d.type === type) || null;\r\n    };\r\n\r\n    /**\r\n     * Inicia verificación Didit (para cédula)\r\n     */\r\n    const handleDiditVerification = async () => {\r\n        setIsVerifyingIdentity(true);\r\n        try {\r\n            const response = await fetch(\"/api/didit/create-session\", {\r\n                method: \"POST\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n            });\r\n\r\n            if (!response.ok) {\r\n                throw new Error(\"Error al crear sesión de verificación\");\r\n            }\r\n\r\n            const data = await response.json();\r\n            if (data.session_url) {\r\n                const width = 700;\r\n                const height = 700;\r\n                const left = (window.screen.width - width) / 2;\r\n                const top = (window.screen.height - height) / 2;\r\n\r\n                const popup = window.open(\r\n                    data.session_url,\r\n                    \"DiditVerification\",\r\n                    `width=${width},height=${height},left=${left},top=${top}`\r\n                );\r\n\r\n                // Polling para detectar cuando se cierra\r\n                if (popup) {\r\n                    const checkClosed = setInterval(() => {\r\n                        if (popup.closed) {\r\n                            clearInterval(checkClosed);\r\n                            setIsVerifyingIdentity(false);\r\n                            toast.info(\"Verificando estado...\");\r\n                            setTimeout(() => loadData(), 2000);\r\n                        }\r\n                    }, 1000);\r\n                }\r\n\r\n                toast.success(\"Completa la verificación en la ventana emergente\");\r\n            }\r\n        } catch (error: any) {\r\n            toast.error(error.message || \"Error al iniciar verificación\");\r\n            setIsVerifyingIdentity(false);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Maneja drop de archivo\r\n     */\r\n    const handleDrop = (e: React.DragEvent) => {\r\n        e.preventDefault();\r\n        setDragActive(false);\r\n        if (e.dataTransfer.files?.[0]) {\r\n            handleFileSelect(e.dataTransfer.files[0]);\r\n        }\r\n    };\r\n\r\n    const handleFileSelect = (file: File) => {\r\n        const allowedTypes = [\"application/pdf\", \"image/jpeg\", \"image/png\", \"image/webp\"];\r\n        if (!allowedTypes.includes(file.type)) {\r\n            toast.error(\"Solo PDF, JPG, PNG o WebP\");\r\n            return;\r\n        }\r\n        if (file.size > 10 * 1024 * 1024) {\r\n            toast.error(\"Máximo 10MB\");\r\n            return;\r\n        }\r\n        setSelectedFile(file);\r\n    };\r\n\r\n    /**\r\n     * Sube documento\r\n     */\r\n    const handleUpload = async () => {\r\n        if (!selectedFile || !uploadType || !userId) return;\r\n\r\n        setUploadingType(uploadType);\r\n        try {\r\n            const result = await uploadDoctorDocument(userId, {\r\n                file: selectedFile,\r\n                documentType: uploadType,\r\n            });\r\n\r\n            if (result.success) {\r\n                toast.success(\"Documento subido correctamente\");\r\n                setUploadModalOpen(false);\r\n                setSelectedFile(null);\r\n                setUploadType(null);\r\n                await loadData();\r\n            } else {\r\n                toast.error(result.error || \"Error al subir\");\r\n            }\r\n        } catch (error: any) {\r\n            toast.error(error.message || \"Error al subir\");\r\n        } finally {\r\n            setUploadingType(null);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Abre modal de upload para un tipo específico\r\n     */\r\n    const openUploadModal = (type: DoctorDocumentType) => {\r\n        setUploadType(type);\r\n        setSelectedFile(null);\r\n        setUploadModalOpen(true);\r\n    };\r\n\r\n    /**\r\n     * Descarga documento\r\n     */\r\n    const handleDownload = async (doc: DocumentUI) => {\r\n        const result = await getDocumentDownloadUrl(doc.filePath);\r\n        if (result.success && result.data) {\r\n            window.open(result.data, \"_blank\");\r\n        } else {\r\n            toast.error(\"Error al descargar\");\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Elimina documento\r\n     */\r\n    const handleDelete = async (doc: DocumentUI) => {\r\n        if (!userId) return;\r\n        setDeletingId(doc.id);\r\n        try {\r\n            const result = await deleteDoctorDocument(doc.id, userId);\r\n            if (result.success) {\r\n                toast.success(\"Documento eliminado\");\r\n                await loadData();\r\n            } else {\r\n                toast.error(result.error || \"Error al eliminar\");\r\n            }\r\n        } finally {\r\n            setDeletingId(null);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Analiza documento con OCR\r\n     */\r\n    const handleAnalyze = async (doc: DocumentUI) => {\r\n        setAnalyzingId(doc.id);\r\n        try {\r\n            const response = await fetch(doc.fileUrl);\r\n            const blob = await response.blob();\r\n            const base64 = await new Promise<string>((resolve) => {\r\n                const reader = new FileReader();\r\n                reader.onloadend = () => resolve(reader.result as string);\r\n                reader.readAsDataURL(blob);\r\n            });\r\n\r\n            const analyzeResponse = await fetch(\"/api/documents/analyze\", {\r\n                method: \"POST\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify({\r\n                    documentId: doc.id,\r\n                    imageBase64: base64,\r\n                    mimeType: doc.mimeType,\r\n                }),\r\n            });\r\n\r\n            const result = await analyzeResponse.json();\r\n            if (result.success) {\r\n                toast.success(\"Documento analizado\");\r\n                await loadData();\r\n            } else {\r\n                toast.error(result.error || \"Error al analizar\");\r\n            }\r\n        } catch (error: any) {\r\n            toast.error(error.message || \"Error al analizar\");\r\n        } finally {\r\n            setAnalyzingId(null);\r\n        }\r\n    };\r\n\r\n    /** Formato de fecha */\r\n    const formatDate = (dateString: string) => {\r\n        return new Date(dateString).toLocaleDateString(\"es-VE\", {\r\n            year: \"numeric\",\r\n            month: \"short\",\r\n            day: \"numeric\",\r\n        });\r\n    };\r\n\r\n    /** Formato de tamaño */\r\n    const formatFileSize = (bytes: number | null) => {\r\n        if (!bytes) return \"\";\r\n        const mb = bytes / (1024 * 1024);\r\n        return mb >= 1 ? `${mb.toFixed(1)} MB` : `${(bytes / 1024).toFixed(0)} KB`;\r\n    };\r\n\r\n    // Calcular progreso\r\n    const requiredTypes = Object.entries(DOCUMENT_CONFIGS).filter(([_, c]) => c.required);\r\n    const uploadedRequired = requiredTypes.filter(([type]) => {\r\n        if (type === \"cedula\") return identityVerified;\r\n        return documents.some(d => d.type === type);\r\n    }).length;\r\n    const progressPercent = Math.round((uploadedRequired / requiredTypes.length) * 100);\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"flex items-center justify-center h-64\">\r\n                <Loader2 className=\"h-8 w-8 animate-spin text-blue-600\" />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header con Progreso */}\r\n            <div className=\"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4\">\r\n                <div>\r\n                    <h2 className=\"text-xl font-semibold text-gray-900 dark:text-gray-100\">\r\n                        Documentos Profesionales\r\n                    </h2>\r\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\r\n                        Verifica tus documentos para completar tu perfil profesional\r\n                    </p>\r\n                </div>\r\n                <div className=\"flex items-center gap-3\">\r\n                    <span className=\"text-sm text-gray-500 dark:text-gray-400\">Progreso:</span>\r\n                    <Progress value={progressPercent} className=\"w-32\" />\r\n                    <Badge className={cn(\r\n                        \"font-medium\",\r\n                        progressPercent === 100\r\n                            ? \"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400\"\r\n                            : \"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400\"\r\n                    )}>\r\n                        {progressPercent}% Completo\r\n                    </Badge>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Lista de todos los tipos de documentos */}\r\n            <div className=\"space-y-3\">\r\n                {Object.entries(DOCUMENT_CONFIGS).map(([type, config], index) => {\r\n                    const docType = type as DoctorDocumentType;\r\n                    const doc = getDocByType(docType);\r\n                    const Icon = config.icon;\r\n                    const isDiditType = config.useDidit;\r\n                    const isVerified = isDiditType ? identityVerified : doc?.status === \"verified\";\r\n                    const isPending = !isDiditType && doc?.status === \"pending\";\r\n                    const isRejected = !isDiditType && doc?.status === \"rejected\";\r\n                    const hasDocument = isDiditType ? identityVerified : !!doc;\r\n\r\n                    return (\r\n                        <motion.article\r\n                            key={type}\r\n                            initial={{ opacity: 0, y: 10 }}\r\n                            animate={{ opacity: 1, y: 0 }}\r\n                            transition={{ delay: index * 0.05 }}\r\n                            className={cn(\r\n                                \"border rounded-xl p-4 transition-all\",\r\n                                isVerified\r\n                                    ? \"border-green-200 dark:border-green-800 bg-green-50/50 dark:bg-green-900/10\"\r\n                                    : isPending\r\n                                        ? \"border-yellow-200 dark:border-yellow-800 bg-yellow-50/50 dark:bg-yellow-900/10\"\r\n                                        : isRejected\r\n                                            ? \"border-red-200 dark:border-red-800 bg-red-50/50 dark:bg-red-900/10\"\r\n                                            : \"border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900\"\r\n                            )}\r\n                        >\r\n                            <div className=\"flex items-center justify-between\">\r\n                                {/* Info del documento */}\r\n                                <div className=\"flex items-center gap-4\">\r\n                                    <div className={cn(\r\n                                        \"h-12 w-12 rounded-xl flex items-center justify-center\",\r\n                                        isVerified\r\n                                            ? \"bg-green-100 dark:bg-green-900/40\"\r\n                                            : isPending\r\n                                                ? \"bg-yellow-100 dark:bg-yellow-900/40\"\r\n                                                : \"bg-gray-100 dark:bg-gray-800\"\r\n                                    )}>\r\n                                        <Icon className={cn(\r\n                                            \"h-6 w-6\",\r\n                                            isVerified\r\n                                                ? \"text-green-600 dark:text-green-400\"\r\n                                                : isPending\r\n                                                    ? \"text-yellow-600 dark:text-yellow-400\"\r\n                                                    : \"text-gray-500 dark:text-gray-400\"\r\n                                        )} />\r\n                                    </div>\r\n                                    <div>\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <h3 className=\"font-medium text-gray-900 dark:text-gray-100\">\r\n                                                {config.name}\r\n                                            </h3>\r\n                                            {config.required && (\r\n                                                <span className=\"text-xs text-red-500\">*Requerido</span>\r\n                                            )}\r\n                                        </div>\r\n                                        <p className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                                            {config.description}\r\n                                        </p>\r\n                                        {/* Estado y fecha */}\r\n                                        <div className=\"flex items-center gap-3 mt-1\">\r\n                                            {isVerified && (\r\n                                                <Badge className=\"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400 border-0\">\r\n                                                    <CheckCircle className=\"h-3 w-3 mr-1\" />\r\n                                                    Verificado\r\n                                                </Badge>\r\n                                            )}\r\n                                            {isPending && (\r\n                                                <Badge className=\"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400 border-0\">\r\n                                                    <Clock className=\"h-3 w-3 mr-1\" />\r\n                                                    En revisión\r\n                                                </Badge>\r\n                                            )}\r\n                                            {isRejected && (\r\n                                                <Badge className=\"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400 border-0\">\r\n                                                    <AlertCircle className=\"h-3 w-3 mr-1\" />\r\n                                                    Rechazado\r\n                                                </Badge>\r\n                                            )}\r\n                                            {doc && !isDiditType && (\r\n                                                <span className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                                                    {formatDate(doc.uploadDate)} • {formatFileSize(doc.fileSize)}\r\n                                                </span>\r\n                                            )}\r\n                                            {doc?.extractedData && (\r\n                                                <Badge variant=\"outline\" className=\"text-purple-600 border-purple-200 dark:border-purple-800\">\r\n                                                    <Sparkles className=\"h-3 w-3 mr-1\" />\r\n                                                    Analizado\r\n                                                </Badge>\r\n                                            )}\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Acciones */}\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    {/* Para cédula: usa Didit */}\r\n                                    {isDiditType ? (\r\n                                        identityVerified ? (\r\n                                            <Badge className=\"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 px-4 py-2\">\r\n                                                <CheckCircle className=\"h-4 w-4 mr-2\" />\r\n                                                Identidad Verificada\r\n                                            </Badge>\r\n                                        ) : (\r\n                                            <Button\r\n                                                onClick={handleDiditVerification}\r\n                                                disabled={isVerifyingIdentity}\r\n                                                className=\"bg-blue-600 hover:bg-blue-700\"\r\n                                            >\r\n                                                {isVerifyingIdentity ? (\r\n                                                    <>\r\n                                                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\r\n                                                        Verificando...\r\n                                                    </>\r\n                                                ) : (\r\n                                                    <>\r\n                                                        <Shield className=\"h-4 w-4 mr-2\" />\r\n                                                        Verificar\r\n                                                        <ExternalLink className=\"h-3 w-3 ml-1\" />\r\n                                                    </>\r\n                                                )}\r\n                                            </Button>\r\n                                        )\r\n                                    ) : (\r\n                                        /* Para otros documentos: upload normal */\r\n                                        hasDocument ? (\r\n                                            <div className=\"flex gap-2\">\r\n                                                <Button\r\n                                                    variant=\"outline\"\r\n                                                    size=\"sm\"\r\n                                                    onClick={() => {\r\n                                                        setPreviewDoc(doc);\r\n                                                        setIsPreviewOpen(true);\r\n                                                    }}\r\n                                                    title=\"Ver documento\"\r\n                                                >\r\n                                                    <Eye className=\"h-4 w-4\" />\r\n                                                </Button>\r\n                                                <Button\r\n                                                    variant=\"outline\"\r\n                                                    size=\"sm\"\r\n                                                    onClick={() => handleAnalyze(doc!)}\r\n                                                    disabled={analyzingId === doc?.id}\r\n                                                    title=\"Analizar con IA\"\r\n                                                >\r\n                                                    {analyzingId === doc?.id ? (\r\n                                                        <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                                                    ) : (\r\n                                                        <FileScan className=\"h-4 w-4\" />\r\n                                                    )}\r\n                                                </Button>\r\n                                                <Button\r\n                                                    variant=\"outline\"\r\n                                                    size=\"sm\"\r\n                                                    onClick={() => handleDownload(doc!)}\r\n                                                    title=\"Descargar\"\r\n                                                >\r\n                                                    <Download className=\"h-4 w-4\" />\r\n                                                </Button>\r\n                                                <Button\r\n                                                    variant=\"outline\"\r\n                                                    size=\"sm\"\r\n                                                    onClick={() => handleDelete(doc!)}\r\n                                                    disabled={deletingId === doc?.id}\r\n                                                    className=\"text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20\"\r\n                                                    title=\"Eliminar\"\r\n                                                >\r\n                                                    {deletingId === doc?.id ? (\r\n                                                        <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                                                    ) : (\r\n                                                        <Trash2 className=\"h-4 w-4\" />\r\n                                                    )}\r\n                                                </Button>\r\n                                            </div>\r\n                                        ) : (\r\n                                            <Button\r\n                                                onClick={() => openUploadModal(docType)}\r\n                                                disabled={uploadingType === docType}\r\n                                                className=\"bg-blue-600 hover:bg-blue-700\"\r\n                                            >\r\n                                                {uploadingType === docType ? (\r\n                                                    <>\r\n                                                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\r\n                                                        Subiendo...\r\n                                                    </>\r\n                                                ) : (\r\n                                                    <>\r\n                                                        <Upload className=\"h-4 w-4 mr-2\" />\r\n                                                        Subir Documento\r\n                                                    </>\r\n                                                )}\r\n                                            </Button>\r\n                                        )\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Datos extraídos por OCR */}\r\n                            {doc?.extractedData && !isDiditType && (\r\n                                <motion.div\r\n                                    initial={{ opacity: 0, height: 0 }}\r\n                                    animate={{ opacity: 1, height: \"auto\" }}\r\n                                    className=\"mt-3 pt-3 border-t border-gray-100 dark:border-gray-800\"\r\n                                >\r\n                                    <p className=\"text-xs text-gray-500 dark:text-gray-400 mb-2 flex items-center gap-1\">\r\n                                        <Sparkles className=\"h-3 w-3 text-purple-500\" />\r\n                                        Información extraída automáticamente:\r\n                                    </p>\r\n                                    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm\">\r\n                                        {doc.extractedData.institution && (\r\n                                            <div>\r\n                                                <span className=\"text-gray-500 dark:text-gray-400 text-xs\">Institución</span>\r\n                                                <p className=\"font-medium text-gray-900 dark:text-gray-100 truncate\">\r\n                                                    {doc.extractedData.institution}\r\n                                                </p>\r\n                                            </div>\r\n                                        )}\r\n                                        {doc.extractedData.full_name && (\r\n                                            <div>\r\n                                                <span className=\"text-gray-500 dark:text-gray-400 text-xs\">Nombre</span>\r\n                                                <p className=\"font-medium text-gray-900 dark:text-gray-100 truncate\">\r\n                                                    {doc.extractedData.full_name}\r\n                                                </p>\r\n                                            </div>\r\n                                        )}\r\n                                        {doc.extractedData.specialty && (\r\n                                            <div>\r\n                                                <span className=\"text-gray-500 dark:text-gray-400 text-xs\">Especialidad</span>\r\n                                                <p className=\"font-medium text-gray-900 dark:text-gray-100 truncate\">\r\n                                                    {doc.extractedData.specialty}\r\n                                                </p>\r\n                                            </div>\r\n                                        )}\r\n                                        {doc.extractedData.issue_date && (\r\n                                            <div>\r\n                                                <span className=\"text-gray-500 dark:text-gray-400 text-xs\">Fecha</span>\r\n                                                <p className=\"font-medium text-gray-900 dark:text-gray-100\">\r\n                                                    {doc.extractedData.issue_date}\r\n                                                </p>\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                </motion.div>\r\n                            )}\r\n                        </motion.article>\r\n                    );\r\n                })}\r\n            </div>\r\n\r\n            {/* Nota informativa */}\r\n            <aside className=\"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4\">\r\n                <p className=\"text-sm text-blue-800 dark:text-blue-300\">\r\n                    <span className=\"font-medium\">📋 Nota:</span> Los documentos marcados con * son requeridos.\r\n                    La cédula de identidad se verifica mediante reconocimiento facial y prueba de vida con Didit para mayor seguridad.\r\n                    Los demás documentos son revisados por nuestro equipo en 24-48 horas.\r\n                </p>\r\n            </aside>\r\n\r\n            {/* Modal de Upload */}\r\n            <Dialog open={uploadModalOpen} onOpenChange={setUploadModalOpen}>\r\n                <DialogContent className=\"sm:max-w-md\">\r\n                    <DialogHeader>\r\n                        <DialogTitle>\r\n                            {uploadType && DOCUMENT_CONFIGS[uploadType]?.name}\r\n                        </DialogTitle>\r\n                        <DialogDescription>\r\n                            Sube el documento en formato PDF o imagen\r\n                        </DialogDescription>\r\n                    </DialogHeader>\r\n\r\n                    <div className=\"space-y-4 py-4\">\r\n                        {/* Área de drag & drop */}\r\n                        <div\r\n                            className={cn(\r\n                                \"border-2 border-dashed rounded-lg p-8 transition-colors text-center cursor-pointer\",\r\n                                dragActive\r\n                                    ? \"border-blue-500 bg-blue-50 dark:bg-blue-900/20\"\r\n                                    : \"border-gray-300 dark:border-gray-700 hover:border-blue-400\",\r\n                                selectedFile && \"border-green-500 bg-green-50 dark:bg-green-900/20\"\r\n                            )}\r\n                            onDragEnter={(e) => { e.preventDefault(); setDragActive(true); }}\r\n                            onDragLeave={(e) => { e.preventDefault(); setDragActive(false); }}\r\n                            onDragOver={(e) => e.preventDefault()}\r\n                            onDrop={handleDrop}\r\n                            onClick={() => fileInputRef.current?.click()}\r\n                        >\r\n                            <input\r\n                                ref={fileInputRef}\r\n                                type=\"file\"\r\n                                accept=\".pdf,.jpg,.jpeg,.png,.webp\"\r\n                                className=\"hidden\"\r\n                                onChange={(e) => e.target.files?.[0] && handleFileSelect(e.target.files[0])}\r\n                            />\r\n\r\n                            {selectedFile ? (\r\n                                <div className=\"flex items-center justify-center gap-3\">\r\n                                    <FileImage className=\"h-10 w-10 text-green-600\" />\r\n                                    <div className=\"text-left\">\r\n                                        <p className=\"font-medium text-gray-900 dark:text-gray-100\">\r\n                                            {selectedFile.name}\r\n                                        </p>\r\n                                        <p className=\"text-sm text-gray-500\">\r\n                                            {formatFileSize(selectedFile.size)}\r\n                                        </p>\r\n                                    </div>\r\n                                    <Button\r\n                                        variant=\"ghost\"\r\n                                        size=\"sm\"\r\n                                        onClick={(e) => {\r\n                                            e.stopPropagation();\r\n                                            setSelectedFile(null);\r\n                                        }}\r\n                                    >\r\n                                        <X className=\"h-4 w-4\" />\r\n                                    </Button>\r\n                                </div>\r\n                            ) : (\r\n                                <>\r\n                                    <Upload className=\"h-12 w-12 mx-auto text-gray-400 mb-4\" />\r\n                                    <p className=\"text-gray-600 dark:text-gray-400 mb-2\">\r\n                                        Arrastra un archivo o <span className=\"text-blue-600 font-medium\">haz clic</span>\r\n                                    </p>\r\n                                    <p className=\"text-xs text-gray-400\">\r\n                                        PDF, JPG, PNG o WebP • Máximo 10MB\r\n                                    </p>\r\n                                </>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"flex justify-end gap-2\">\r\n                        <Button\r\n                            variant=\"outline\"\r\n                            onClick={() => {\r\n                                setUploadModalOpen(false);\r\n                                setSelectedFile(null);\r\n                            }}\r\n                        >\r\n                            Cancelar\r\n                        </Button>\r\n                        <Button\r\n                            onClick={handleUpload}\r\n                            disabled={!selectedFile || uploadingType !== null}\r\n                        >\r\n                            {uploadingType ? (\r\n                                <>\r\n                                    <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\r\n                                    Subiendo...\r\n                                </>\r\n                            ) : (\r\n                                <>\r\n                                    <Upload className=\"h-4 w-4 mr-2\" />\r\n                                    Subir\r\n                                </>\r\n                            )}\r\n                        </Button>\r\n                    </div>\r\n                </DialogContent>\r\n            </Dialog>\r\n\r\n            {/* Modal de Vista Previa */}\r\n            <Dialog open={isPreviewOpen} onOpenChange={setIsPreviewOpen}>\r\n                <DialogContent className=\"sm:max-w-2xl max-h-[90vh] overflow-auto\">\r\n                    <DialogHeader>\r\n                        <DialogTitle>{previewDoc?.name}</DialogTitle>\r\n                    </DialogHeader>\r\n                    {previewDoc && (\r\n                        <div className=\"py-4\">\r\n                            {previewDoc.mimeType?.startsWith(\"image/\") ? (\r\n                                <img\r\n                                    src={previewDoc.fileUrl}\r\n                                    alt={previewDoc.name}\r\n                                    className=\"w-full rounded-lg\"\r\n                                />\r\n                            ) : (\r\n                                <iframe\r\n                                    src={previewDoc.fileUrl}\r\n                                    className=\"w-full h-[500px] rounded-lg border\"\r\n                                    title={previewDoc.name}\r\n                                />\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </DialogContent>\r\n            </Dialog>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\configuracion\\info-profesional-section.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Checkbox' is defined but never used.","line":21,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DollarSign' is defined but never used.","line":28,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Clock' is defined but never used.","line":29,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckCircle2' is defined but never used.","line":30,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileText' is defined but never used.","line":32,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Briefcase' is defined but never used.","line":33,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Shield' is defined but never used.","line":34,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":34,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Users' is defined but never used.","line":35,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Plus' is defined but never used.","line":41,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":41,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Youtube' is defined but never used.","line":42,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":42,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'INSURANCE_COMPANIES' is defined but never used.","line":49,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":49,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AGE_GROUPS' is defined but never used.","line":49,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":49,"endColumn":41},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'condicionInput' is assigned a value but never used.","line":94,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":94,"endColumn":26},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":135,"column":21,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":135,"endColumn":34,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[4255,4268],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":148,"column":17,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":148,"endColumn":30,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[4705,4718],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":13,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\n/**\r\n * @file info-profesional-section.tsx\r\n * @description Sección de configuración para información profesional extendida del médico.\r\n * Incluye universidad, credenciales, experiencia, certificaciones, idiomas, seguros y servicios.\r\n * La biografía se maneja en ProfileSection donde tiene integración con IA.\r\n * @module Configuracion\r\n * \r\n * @example\r\n * <InfoProfesionalSection />\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { Label } from \"@red-salud/ui\";\r\nimport { Textarea } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Checkbox } from \"@red-salud/ui\";\r\nimport {\r\n    Save,\r\n    Loader2,\r\n    GraduationCap,\r\n    Award,\r\n    Languages,\r\n    DollarSign,\r\n    Clock,\r\n    CheckCircle2,\r\n    Pen,\r\n    FileText,\r\n    Briefcase,\r\n    Shield,\r\n    Users,\r\n    Globe,\r\n    Facebook,\r\n    Linkedin,\r\n    Twitter,\r\n    Instagram,\r\n    Plus,\r\n    Youtube,\r\n    Stethoscope,\r\n    X\r\n} from \"lucide-react\";\r\n\r\nimport { SearchableSelect } from \"@red-salud/ui\";\r\nimport { VENEZUELAN_UNIVERSITIES } from \"./constants/universities\";\r\nimport { INSURANCE_COMPANIES, AGE_GROUPS, SOCIAL_PLATFORMS } from \"./constants/profile-data\";\r\nimport { MEDICAL_CONDITIONS_OPTIONS } from \"./constants/medical-conditions\";\r\n\r\nimport { supabase } from \"@/lib/supabase/client\";\r\n\r\n/**\r\n * Datos del perfil profesional extendido\r\n */\r\ninterface ProfesionalData {\r\n    /** Universidad de egreso */\r\n    universidad: string;\r\n    /** Número de colegio de médicos */\r\n    numero_colegio: string;\r\n    /** Número de matrícula (MPPS) - Read Only */\r\n    matricula: string;\r\n    /** Año de graduación */\r\n    anio_graduacion: number | null;\r\n    /** Años de experiencia (Manual) */\r\n    anios_experiencia: number;\r\n    /** Certificaciones y diplomados */\r\n    certificaciones: string;\r\n    /** Subespecialidades */\r\n    subespecialidades: string;\r\n    /** Idiomas que habla */\r\n    idiomas: string[];\r\n    /** Enfermedades y condiciones tratadas */\r\n    condiciones_tratadas: string[];\r\n    /** Redes sociales */\r\n    redes_sociales: Record<string, string>;\r\n}\r\n\r\n/** Lista de idiomas disponibles */\r\nconst IDIOMAS_DISPONIBLES = [\r\n    'Español', 'Inglés', 'Francés', 'Portugués',\r\n    'Italiano', 'Alemán', 'Mandarín', 'Árabe', 'Ruso'\r\n];\r\n\r\n/**\r\n * Componente de sección de información profesional para la página de configuración.\r\n * Permite al médico editar su biografía, certificaciones, idiomas y tarifas.\r\n */\r\nexport function InfoProfesionalSection() {\r\n    const [isEditing, setIsEditing] = useState(false);\r\n    const [loading, setLoading] = useState(true);\r\n    const [saving, setSaving] = useState(false);\r\n    const [condicionInput, setCondicionInput] = useState(\"\");\r\n\r\n    const [data, setData] = useState<ProfesionalData>({\r\n        universidad: \"\",\r\n        numero_colegio: \"\",\r\n        matricula: \"\",\r\n        anio_graduacion: null,\r\n        anios_experiencia: 0,\r\n        certificaciones: \"\",\r\n        subespecialidades: \"\",\r\n        idiomas: [\"Español\"],\r\n        condiciones_tratadas: [],\r\n        redes_sociales: {},\r\n    });\r\n\r\n    /** Carga los datos del perfil profesional desde la base de datos */\r\n    useEffect(() => {\r\n        loadProfile();\r\n    }, []);\r\n\r\n    const loadProfile = async () => {\r\n        try {\r\n            const { data: { user } } = await supabase.auth.getUser();\r\n            if (!user) return;\r\n\r\n            // 1. Intentar cargar perfil de doctor\r\n            const { data: profile, error } = await supabase\r\n                .from(\"doctor_profiles\")\r\n                .select(`*, profiles!id(sacs_matricula, licencia_medica, sacs_verificado)`)\r\n                .eq(\"id\", user.id)\r\n                .maybeSingle(); // Usar maybeSingle para no lanzar error si no existe\r\n\r\n            // 2. Si no existe perfil de doctor, cargar datos básicos de profiles\r\n            if (!profile) {\r\n                const { data: userProfile } = await supabase\r\n                    .from(\"profiles\")\r\n                    .select(\"sacs_matricula, licencia_medica, sacs_verificado\")\r\n                    .eq(\"id\", user.id)\r\n                    .single();\r\n\r\n                if (userProfile) {\r\n                    // @ts-ignore\r\n                    const matricula = userProfile.sacs_matricula || userProfile.licencia_medica || \"\";\r\n                    setData(prev => ({ ...prev, matricula }));\r\n                }\r\n                return;\r\n            }\r\n\r\n            if (error && error.code !== \"PGRST116\") {\r\n                console.error(\"Error loading profile:\", error);\r\n                return;\r\n            }\r\n\r\n            if (profile) {\r\n                // @ts-ignore\r\n                const matriculaSacs = profile.profiles?.sacs_matricula || profile.profiles?.licencia_medica || profile.license_number || \"\";\r\n\r\n                setData({\r\n                    universidad: profile.university || \"\",\r\n                    numero_colegio: profile.college_number || \"\",\r\n                    matricula: matriculaSacs,\r\n                    anio_graduacion: profile.graduation_year || null,\r\n                    anios_experiencia: profile.years_experience || 0,\r\n                    certificaciones: profile.certifications_info || \"\",\r\n                    subespecialidades: profile.subspecialties || \"\",\r\n                    idiomas: Array.isArray(profile.languages) ? profile.languages : [\"Español\"],\r\n                    condiciones_tratadas: Array.isArray(profile.conditions_treated) ? profile.conditions_treated : [],\r\n                    redes_sociales: (profile.social_media as Record<string, string>) || {},\r\n                });\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Error loading profile:\", error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    /** Guarda los cambios en la base de datos */\r\n    const handleSave = async () => {\r\n        setSaving(true);\r\n        try {\r\n            const { data: { user } } = await supabase.auth.getUser();\r\n            if (!user) throw new Error(\"No user found\");\r\n\r\n            // Usar upsert para crear o actualizar\r\n            const { error } = await supabase\r\n                .from(\"doctor_profiles\")\r\n                .upsert({\r\n                    id: user.id, // ID explícito para upsert\r\n                    university: data.universidad,\r\n                    college_number: data.numero_colegio,\r\n                    years_experience: data.anios_experiencia,\r\n                    graduation_year: data.anio_graduacion,\r\n                    certifications_info: data.certificaciones,\r\n                    subspecialties: data.subespecialidades,\r\n                    languages: data.idiomas,\r\n                    conditions_treated: data.condiciones_tratadas,\r\n                    social_media: data.redes_sociales,\r\n                    updated_at: new Date().toISOString(),\r\n                    // Campos requeridos mínimos si es nuevo registro (aunque idealmente deberían estar)\r\n                    license_number: data.matricula || \"PENDING\", // Fallback si es nuevo\r\n                })\r\n                .select();\r\n\r\n            if (error) throw error;\r\n\r\n            setIsEditing(false);\r\n        } catch (error) {\r\n            console.error(\"Error saving profile:\", error);\r\n            alert(\"Error al guardar los cambios\");\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    /** Alterna la selección de un idioma */\r\n    const toggleIdioma = (idioma: string) => {\r\n        setData(prev => ({\r\n            ...prev,\r\n            idiomas: prev.idiomas.includes(idioma)\r\n                ? prev.idiomas.filter(i => i !== idioma)\r\n                : [...prev.idiomas, idioma]\r\n        }));\r\n    };\r\n\r\n\r\n\r\n    /** Añadir condición tratada */\r\n    const addCondicion = (condicion: string) => {\r\n        if (!condicion.trim()) return;\r\n        if (!data.condiciones_tratadas.includes(condicion.trim())) {\r\n            setData(prev => ({\r\n                ...prev,\r\n                condiciones_tratadas: [...prev.condiciones_tratadas, condicion.trim()]\r\n            }));\r\n        }\r\n        setCondicionInput(\"\"); // Clear input if it was used\r\n    };\r\n\r\n    const removeCondicion = (condicion: string) => {\r\n        setData(prev => ({\r\n            ...prev,\r\n            condiciones_tratadas: prev.condiciones_tratadas.filter(c => c !== condicion)\r\n        }));\r\n    };\r\n\r\n\r\n    /** Manejo de redes sociales */\r\n    const handleSocialChange = (platformId: string, value: string) => {\r\n        setData(prev => ({\r\n            ...prev,\r\n            redes_sociales: {\r\n                ...prev.redes_sociales,\r\n                [platformId]: value\r\n            }\r\n        }));\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"flex items-center justify-center h-64\">\r\n                <Loader2 className=\"h-8 w-8 animate-spin text-blue-600\" />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header con botón de editar */}\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h2 className=\"text-xl font-semibold text-gray-900 dark:text-gray-100\">\r\n                        Información Profesional\r\n                    </h2>\r\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\r\n                        Detalles sobre tu práctica médica, formación y servicios\r\n                    </p>\r\n                </div>\r\n                {!isEditing ? (\r\n                    <Button variant=\"outline\" size=\"sm\" onClick={() => setIsEditing(true)}>\r\n                        <Pen className=\"h-4 w-4 mr-2\" />\r\n                        Editar\r\n                    </Button>\r\n                ) : (\r\n                    <div className=\"flex gap-2\">\r\n                        <Button variant=\"outline\" size=\"sm\" onClick={() => setIsEditing(false)} disabled={saving}>\r\n                            Cancelar\r\n                        </Button>\r\n                        <Button size=\"sm\" onClick={handleSave} disabled={saving}>\r\n                            {saving ? (\r\n                                <>\r\n                                    <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\r\n                                    Guardando...\r\n                                </>\r\n                            ) : (\r\n                                <>\r\n                                    <Save className=\"h-4 w-4 mr-2\" />\r\n                                    Guardar\r\n                                </>\r\n                            )}\r\n                        </Button>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 gap-6\">\r\n                {/* Columna Principal: Formación, Bio, Credenciales */}\r\n                <div className=\"space-y-6\">\r\n                    {/* Universidad y Credenciales */}\r\n                    <div className=\"border dark:border-gray-700 rounded-lg p-4\">\r\n                        <div className=\"flex items-center gap-2 mb-4\">\r\n                            <div className=\"p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg\">\r\n                                <GraduationCap className=\"h-4 w-4 text-purple-600 dark:text-purple-400\" />\r\n                            </div>\r\n                            <Label className=\"font-semibold text-gray-900 dark:text-gray-100\">\r\n                                Formación y Credenciales\r\n                            </Label>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-4\">\r\n                            {/* Universidad */}\r\n                            <div>\r\n                                <Label className=\"text-xs text-gray-500 mb-1.5 block\">Universidad de Egreso</Label>\r\n                                {isEditing ? (\r\n                                    <SearchableSelect\r\n                                        options={VENEZUELAN_UNIVERSITIES}\r\n                                        value={data.universidad}\r\n                                        onValueChange={(val) => setData({ ...data, universidad: val })}\r\n                                        placeholder=\"Seleccionar universidad...\"\r\n                                        searchPlaceholder=\"Buscar universidad...\"\r\n                                        emptyMessage=\"No se encontró la universidad\"\r\n                                        className=\"w-full\"\r\n                                    />\r\n                                ) : (\r\n                                    <p className=\"text-sm text-gray-700 dark:text-gray-300 font-medium\">\r\n                                        {data.universidad || \"No especificado\"}\r\n                                    </p>\r\n                                )}\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                {/* Año Graduación */}\r\n                                <div>\r\n                                    <Label className=\"text-xs text-gray-500 mb-1.5 block\">Año de Graduación</Label>\r\n                                    {isEditing ? (\r\n                                        <Input\r\n                                            type=\"number\"\r\n                                            placeholder=\"Ej: 2010\"\r\n                                            value={data.anio_graduacion || \"\"}\r\n                                            onChange={(e) => setData({ ...data, anio_graduacion: parseInt(e.target.value) || null })}\r\n                                            className=\"dark:bg-gray-800\"\r\n                                        />\r\n                                    ) : (\r\n                                        <p className=\"text-sm text-gray-700 dark:text-gray-300 font-medium\">\r\n                                            {data.anio_graduacion || \"No especificado\"}\r\n                                        </p>\r\n                                    )}\r\n                                </div>\r\n\r\n                                {/* Años de Experiencia */}\r\n                                <div>\r\n                                    <Label className=\"text-xs text-gray-500 mb-1.5 block\">Años de Experiencia</Label>\r\n                                    {isEditing ? (\r\n                                        <Input\r\n                                            type=\"number\"\r\n                                            min=\"0\"\r\n                                            placeholder=\"Ej: 5\"\r\n                                            value={data.anios_experiencia || \"\"}\r\n                                            onChange={(e) => setData({ ...data, anios_experiencia: parseInt(e.target.value) || 0 })}\r\n                                            className=\"dark:bg-gray-800\"\r\n                                        />\r\n                                    ) : (\r\n                                        <Badge variant=\"outline\" className=\"text-xs text-purple-600 border-purple-200 bg-purple-50\">\r\n                                            {data.anios_experiencia} años de exp.\r\n                                        </Badge>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                {/* N° Matrícula (SACS) */}\r\n                                <div>\r\n                                    <Label className=\"text-xs text-gray-500 mb-1.5 block\">Nº MPPS (Matrícula)</Label>\r\n                                    <div className=\"relative\">\r\n                                        <Input\r\n                                            value={data.matricula || \"Sin matrícula\"}\r\n                                            disabled={true}\r\n                                            className=\"dark:bg-gray-800 bg-gray-50 text-gray-500\"\r\n                                            readOnly\r\n                                        />\r\n                                        {data.matricula && (\r\n                                            <div className=\"absolute right-3 top-1/2 -translate-y-1/2\">\r\n                                                <Badge variant=\"secondary\" className=\"h-5 px-1.5 text-[10px] bg-green-100 text-green-700 hover:bg-green-100 border-0\">\r\n                                                    SACS VALIDADO\r\n                                                </Badge>\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                    <p className=\"text-[10px] text-gray-500 mt-1\">\r\n                                        Validado por SACS. No editable.\r\n                                    </p>\r\n                                </div>\r\n\r\n                                {/* N° Colegio */}\r\n                                <div>\r\n                                    <Label className=\"text-xs text-gray-500 mb-1.5 block\">Nº Colegio de Médicos</Label>\r\n                                    {isEditing ? (\r\n                                        <Input\r\n                                            placeholder=\"Ej: 12345\"\r\n                                            value={data.numero_colegio}\r\n                                            onChange={(e) => setData({ ...data, numero_colegio: e.target.value })}\r\n                                            className=\"dark:bg-gray-800\"\r\n                                        />\r\n                                    ) : (\r\n                                        <p className=\"text-sm text-gray-700 dark:text-gray-300 font-medium\">\r\n                                            {data.numero_colegio || \"No especificado\"}\r\n                                        </p>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Certificaciones y Subespecialidades */}\r\n                    <div className=\"border dark:border-gray-700 rounded-lg p-4\">\r\n                        <div className=\"flex items-center gap-2 mb-4\">\r\n                            <div className=\"p-2 bg-amber-100 dark:bg-amber-900/30 rounded-lg\">\r\n                                <Award className=\"h-4 w-4 text-amber-600 dark:text-amber-400\" />\r\n                            </div>\r\n                            <Label className=\"font-semibold text-gray-900 dark:text-gray-100\">\r\n                                Especialización y Logros\r\n                            </Label>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-4\">\r\n                            <div>\r\n                                <Label className=\"text-xs text-gray-500 mb-1.5 block\">Certificaciones y Diplomados</Label>\r\n                                {isEditing ? (\r\n                                    <Textarea\r\n                                        rows={3}\r\n                                        value={data.certificaciones}\r\n                                        onChange={(e) => setData({ ...data, certificaciones: e.target.value })}\r\n                                        placeholder=\"Ej: Diplomado en Enfermedades Tropicales (2015)&#10;Certificación en Medicina de Emergencia (2018)\"\r\n                                        className=\"dark:bg-gray-800\"\r\n                                    />\r\n                                ) : (\r\n                                    <p className=\"text-sm text-gray-700 dark:text-gray-300 whitespace-pre-wrap\">\r\n                                        {data.certificaciones || \"No especificado\"}\r\n                                    </p>\r\n                                )}\r\n                            </div>\r\n\r\n                            <div>\r\n                                <Label className=\"text-xs text-gray-500 mb-1.5 block\">Subespecialidades / Áreas de Enfoque</Label>\r\n                                {isEditing ? (\r\n                                    <Textarea\r\n                                        rows={2}\r\n                                        value={data.subespecialidades}\r\n                                        onChange={(e) => setData({ ...data, subespecialidades: e.target.value })}\r\n                                        placeholder=\"Ej: Cardiología Intervencionista, Electrofisiología\"\r\n                                        className=\"dark:bg-gray-800\"\r\n                                    />\r\n                                ) : (\r\n                                    <p className=\"text-sm text-gray-700 dark:text-gray-300\">\r\n                                        {data.subespecialidades || \"No especificado\"}\r\n                                    </p>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Enfermedades y Condiciones */}\r\n                    <div className=\"border dark:border-gray-700 rounded-lg p-4\">\r\n                        <div className=\"flex items-center gap-2 mb-3\">\r\n                            <div className=\"p-2 bg-rose-100 dark:bg-rose-900/30 rounded-lg\">\r\n                                <Stethoscope className=\"h-4 w-4 text-rose-600 dark:text-rose-400\" />\r\n                            </div>\r\n                            <div>\r\n                                <Label className=\"font-semibold text-gray-900 dark:text-gray-100\">\r\n                                    Enfermedades y Condiciones\r\n                                </Label>\r\n                                <p className=\"text-[10px] text-gray-500 font-normal\">\r\n                                    Ayuda a los pacientes a encontrarte cuando busquen sus síntomas.\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {isEditing ? (\r\n                            <div className=\"space-y-3\">\r\n                                <SearchableSelect\r\n                                    options={MEDICAL_CONDITIONS_OPTIONS}\r\n                                    value=\"\"\r\n                                    onValueChange={(val) => {\r\n                                        if (val && !data.condiciones_tratadas.includes(val)) {\r\n                                            addCondicion(val);\r\n                                        }\r\n                                    }}\r\n                                    placeholder=\"Buscar enfermedad o condición...\"\r\n                                    searchPlaceholder=\"Escribe para buscar...\"\r\n                                    emptyMessage=\"No encontrado. Presiona Enter para agregar.\"\r\n                                    className=\"w-full\"\r\n                                />\r\n                                <div className=\"flex flex-wrap gap-2 mt-2\">\r\n                                    {data.condiciones_tratadas.map((condicion, index) => (\r\n                                        <Badge\r\n                                            key={index}\r\n                                            variant=\"secondary\"\r\n                                            className=\"pl-2 pr-1 py-0.5 gap-1 hover:bg-rose-100 bg-rose-50 text-rose-700 border-rose-200\"\r\n                                        >\r\n                                            {condicion}\r\n                                            <button\r\n                                                type=\"button\"\r\n                                                onClick={() => removeCondicion(condicion)}\r\n                                                className=\"h-3 w-3 rounded-full hover:bg-rose-200 flex items-center justify-center transition-colors\"\r\n                                            >\r\n                                                <X className=\"h-2.5 w-2.5\" />\r\n                                            </button>\r\n                                        </Badge>\r\n                                    ))}\r\n                                </div>\r\n                                <p className=\"text-xs text-gray-400\">\r\n                                    Selecciona de la lista\r\n                                </p>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"flex flex-wrap gap-2\">\r\n                                {data.condiciones_tratadas.length > 0 ? (\r\n                                    data.condiciones_tratadas.map((condicion, index) => (\r\n                                        <Badge key={index} variant=\"outline\" className=\"border-rose-200 text-rose-700 bg-rose-50\">\r\n                                            {condicion}\r\n                                        </Badge>\r\n                                    ))\r\n                                ) : (\r\n                                    <span className=\"text-sm text-gray-500\">No especificado</span>\r\n                                )}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Redes Sociales */}\r\n                    <div className=\"border dark:border-gray-700 rounded-lg p-4\">\r\n                        <div className=\"flex items-center gap-2 mb-4\">\r\n                            <div className=\"p-2 bg-pink-100 dark:bg-pink-900/30 rounded-lg\">\r\n                                <Globe className=\"h-4 w-4 text-pink-600 dark:text-pink-400\" />\r\n                            </div>\r\n                            <Label className=\"font-semibold text-gray-900 dark:text-gray-100\">\r\n                                Presencia Digital\r\n                            </Label>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-3\">\r\n                            {SOCIAL_PLATFORMS.map((platform) => {\r\n                                const Icon = platform.id === 'instagram' ? Instagram :\r\n                                    platform.id === 'facebook' ? Facebook :\r\n                                        platform.id === 'linkedin' ? Linkedin :\r\n                                            platform.id === 'twitter' ? Twitter : Globe;\r\n\r\n                                return (\r\n                                    <div key={platform.id} className=\"flex items-center gap-3\">\r\n                                        <Icon className=\"h-4 w-4 text-gray-400 shrink-0\" />\r\n                                        {isEditing ? (\r\n                                            <Input\r\n                                                placeholder={platform.placeholder}\r\n                                                value={data.redes_sociales[platform.id] || \"\"}\r\n                                                onChange={(e) => handleSocialChange(platform.id, e.target.value)}\r\n                                                className=\"h-8 text-sm dark:bg-gray-800\"\r\n                                            />\r\n                                        ) : (\r\n                                            data.redes_sociales[platform.id] ? (\r\n                                                <a\r\n                                                    href={data.redes_sociales[platform.id].startsWith('http') ? data.redes_sociales[platform.id] : `https://${platform.prefix}${data.redes_sociales[platform.id]}`}\r\n                                                    target=\"_blank\"\r\n                                                    rel=\"noopener noreferrer\"\r\n                                                    className=\"text-sm text-blue-600 hover:underline truncate\"\r\n                                                >\r\n                                                    {data.redes_sociales[platform.id]}\r\n                                                </a>\r\n                                            ) : (\r\n                                                <span className=\"text-sm text-gray-400 italic\">No agregado</span>\r\n                                            )\r\n                                        )}\r\n                                    </div>\r\n                                );\r\n                            })}\r\n                        </div>\r\n\r\n                    </div>\r\n\r\n                    {/* Idiomas */}\r\n                    <div className=\"border dark:border-gray-700 rounded-lg p-4\">\r\n                        <div className=\"flex items-center gap-2 mb-3\">\r\n                            <div className=\"p-2 bg-indigo-100 dark:bg-indigo-900/30 rounded-lg\">\r\n                                <Languages className=\"h-4 w-4 text-indigo-600 dark:text-indigo-400\" />\r\n                            </div>\r\n                            <Label className=\"font-semibold text-gray-900 dark:text-gray-100\">\r\n                                Idiomas\r\n                            </Label>\r\n                        </div>\r\n                        {isEditing ? (\r\n                            <div className=\"flex flex-wrap gap-2\">\r\n                                {IDIOMAS_DISPONIBLES.map((idioma) => (\r\n                                    <button\r\n                                        key={idioma}\r\n                                        type=\"button\"\r\n                                        onClick={() => toggleIdioma(idioma)}\r\n                                        className={`px-3 py-1.5 rounded-full text-sm font-medium transition-colors ${data.idiomas.includes(idioma)\r\n                                            ? \"bg-indigo-600 text-white\"\r\n                                            : \"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600\"\r\n                                            }`}\r\n                                    >\r\n                                        {idioma}\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"flex flex-wrap gap-2\">\r\n                                {data.idiomas.length > 0 ? (\r\n                                    data.idiomas.map((idioma) => (\r\n                                        <Badge key={idioma} variant=\"secondary\">\r\n                                            {idioma}\r\n                                        </Badge>\r\n                                    ))\r\n                                ) : (\r\n                                    <span className=\"text-sm text-gray-500\">No especificado</span>\r\n                                )}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\configuracion\\notifications-section.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MessageSquare' is defined but never used.","line":11,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Users' is defined but never used.","line":13,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":8},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadSettings'. Either include it or remove the dependency array.","line":48,"column":6,"nodeType":"ArrayExpression","endLine":48,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadSettings]","fix":{"range":[1239,1241],"text":"[loadSettings]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { Label } from \"@red-salud/ui\";\r\nimport { Switch } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { \r\n  Bell, \r\n  Mail, \r\n  MessageSquare, \r\n  Calendar, \r\n  Users,\r\n  Save,\r\n  Loader2\r\n} from \"lucide-react\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\n\r\ninterface NotificationSettings {\r\n  email_nuevas_citas: boolean;\r\n  email_cancelaciones: boolean;\r\n  email_recordatorios: boolean;\r\n  email_mensajes: boolean;\r\n  push_nuevas_citas: boolean;\r\n  push_recordatorios: boolean;\r\n  push_mensajes: boolean;\r\n  recordatorio_24h: boolean;\r\n  recordatorio_1h: boolean;\r\n}\r\n\r\nexport function NotificationsSection() {\r\n  const [loading, setLoading] = useState(true);\r\n  const [saving, setSaving] = useState(false);\r\n  const [settings, setSettings] = useState<NotificationSettings>({\r\n    email_nuevas_citas: true,\r\n    email_cancelaciones: true,\r\n    email_recordatorios: true,\r\n    email_mensajes: true,\r\n    push_nuevas_citas: true,\r\n    push_recordatorios: true,\r\n    push_mensajes: true,\r\n    recordatorio_24h: true,\r\n    recordatorio_1h: true,\r\n  });\r\n\r\n  useEffect(() => {\r\n    loadSettings();\r\n  }, []);\r\n\r\n  const loadSettings = async () => {\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) return;\r\n\r\n      const { data, error } = await supabase\r\n        .from(\"notification_settings\")\r\n        .select(\"*\")\r\n        .eq(\"user_id\", user.id)\r\n        .single();\r\n\r\n      if (error && error.code !== \"PGRST116\") throw error;\r\n\r\n      if (data) {\r\n        setSettings(data.settings || settings);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error loading settings:\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleSave = async () => {\r\n    setSaving(true);\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) return;\r\n\r\n      const { error } = await supabase\r\n        .from(\"notification_settings\")\r\n        .upsert({\r\n          user_id: user.id,\r\n          settings: settings,\r\n        });\r\n\r\n      if (error) throw error;\r\n\r\n      alert(\"Preferencias guardadas correctamente\");\r\n    } catch (error) {\r\n      console.error(\"Error saving settings:\", error);\r\n      alert(\"Error al guardar preferencias\");\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const toggleSetting = (key: keyof NotificationSettings) => {\r\n    setSettings({ ...settings, [key]: !settings[key] });\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center py-12\">\r\n        <Loader2 className=\"h-8 w-8 animate-spin text-blue-600\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Email Notifications */}\r\n      <div className=\"border rounded-lg p-6\">\r\n        <div className=\"flex items-center gap-3 mb-4\">\r\n          <div className=\"p-2 bg-blue-100 rounded-lg\">\r\n            <Mail className=\"h-5 w-5 text-blue-600\" />\r\n          </div>\r\n          <div>\r\n            <h3 className=\"font-semibold text-gray-900\">Notificaciones por Email</h3>\r\n            <p className=\"text-sm text-gray-600\">\r\n              Recibe actualizaciones importantes en tu correo\r\n            </p>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"space-y-4\">\r\n          <div className=\"flex items-center justify-between py-3 border-b\">\r\n            <div>\r\n              <Label className=\"font-medium\">Nuevas Citas</Label>\r\n              <p className=\"text-sm text-gray-600\">\r\n                Cuando un paciente agenda una cita\r\n              </p>\r\n            </div>\r\n            <Switch\r\n              checked={settings.email_nuevas_citas}\r\n              onCheckedChange={() => toggleSetting(\"email_nuevas_citas\")}\r\n            />\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-between py-3 border-b\">\r\n            <div>\r\n              <Label className=\"font-medium\">Cancelaciones</Label>\r\n              <p className=\"text-sm text-gray-600\">\r\n                Cuando se cancela una cita\r\n              </p>\r\n            </div>\r\n            <Switch\r\n              checked={settings.email_cancelaciones}\r\n              onCheckedChange={() => toggleSetting(\"email_cancelaciones\")}\r\n            />\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-between py-3 border-b\">\r\n            <div>\r\n              <Label className=\"font-medium\">Recordatorios</Label>\r\n              <p className=\"text-sm text-gray-600\">\r\n                Recordatorios de citas próximas\r\n              </p>\r\n            </div>\r\n            <Switch\r\n              checked={settings.email_recordatorios}\r\n              onCheckedChange={() => toggleSetting(\"email_recordatorios\")}\r\n            />\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-between py-3\">\r\n            <div>\r\n              <Label className=\"font-medium\">Mensajes de Pacientes</Label>\r\n              <p className=\"text-sm text-gray-600\">\r\n                Cuando recibes un mensaje nuevo\r\n              </p>\r\n            </div>\r\n            <Switch\r\n              checked={settings.email_mensajes}\r\n              onCheckedChange={() => toggleSetting(\"email_mensajes\")}\r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Push Notifications */}\r\n      <div className=\"border rounded-lg p-6\">\r\n        <div className=\"flex items-center gap-3 mb-4\">\r\n          <div className=\"p-2 bg-purple-100 rounded-lg\">\r\n            <Bell className=\"h-5 w-5 text-purple-600\" />\r\n          </div>\r\n          <div className=\"flex-1\">\r\n            <div className=\"flex items-center gap-2\">\r\n              <h3 className=\"font-semibold text-gray-900\">Notificaciones Push</h3>\r\n              <Badge variant=\"secondary\">Próximamente</Badge>\r\n            </div>\r\n            <p className=\"text-sm text-gray-600\">\r\n              Recibe notificaciones en tiempo real\r\n            </p>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"space-y-4 opacity-50\">\r\n          <div className=\"flex items-center justify-between py-3 border-b\">\r\n            <div>\r\n              <Label className=\"font-medium\">Nuevas Citas</Label>\r\n              <p className=\"text-sm text-gray-600\">\r\n                Notificación instantánea de nuevas citas\r\n              </p>\r\n            </div>\r\n            <Switch\r\n              checked={settings.push_nuevas_citas}\r\n              onCheckedChange={() => toggleSetting(\"push_nuevas_citas\")}\r\n              disabled\r\n            />\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-between py-3 border-b\">\r\n            <div>\r\n              <Label className=\"font-medium\">Recordatorios</Label>\r\n              <p className=\"text-sm text-gray-600\">\r\n                Alertas de citas próximas\r\n              </p>\r\n            </div>\r\n            <Switch\r\n              checked={settings.push_recordatorios}\r\n              onCheckedChange={() => toggleSetting(\"push_recordatorios\")}\r\n              disabled\r\n            />\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-between py-3\">\r\n            <div>\r\n              <Label className=\"font-medium\">Mensajes</Label>\r\n              <p className=\"text-sm text-gray-600\">\r\n                Notificación de mensajes nuevos\r\n              </p>\r\n            </div>\r\n            <Switch\r\n              checked={settings.push_mensajes}\r\n              onCheckedChange={() => toggleSetting(\"push_mensajes\")}\r\n              disabled\r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Reminder Settings */}\r\n      <div className=\"border rounded-lg p-6\">\r\n        <div className=\"flex items-center gap-3 mb-4\">\r\n          <div className=\"p-2 bg-green-100 rounded-lg\">\r\n            <Calendar className=\"h-5 w-5 text-green-600\" />\r\n          </div>\r\n          <div>\r\n            <h3 className=\"font-semibold text-gray-900\">Recordatorios de Citas</h3>\r\n            <p className=\"text-sm text-gray-600\">\r\n              Configura cuándo recibir recordatorios\r\n            </p>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"space-y-4\">\r\n          <div className=\"flex items-center justify-between py-3 border-b\">\r\n            <div>\r\n              <Label className=\"font-medium\">24 horas antes</Label>\r\n              <p className=\"text-sm text-gray-600\">\r\n                Recordatorio un día antes de la cita\r\n              </p>\r\n            </div>\r\n            <Switch\r\n              checked={settings.recordatorio_24h}\r\n              onCheckedChange={() => toggleSetting(\"recordatorio_24h\")}\r\n            />\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-between py-3\">\r\n            <div>\r\n              <Label className=\"font-medium\">1 hora antes</Label>\r\n              <p className=\"text-sm text-gray-600\">\r\n                Recordatorio una hora antes de la cita\r\n              </p>\r\n            </div>\r\n            <Switch\r\n              checked={settings.recordatorio_1h}\r\n              onCheckedChange={() => toggleSetting(\"recordatorio_1h\")}\r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Save Button */}\r\n      <div className=\"flex justify-end pt-4 border-t\">\r\n        <Button onClick={handleSave} disabled={saving}>\r\n          {saving ? (\r\n            <>\r\n              <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\r\n              Guardando...\r\n            </>\r\n          ) : (\r\n            <>\r\n              <Save className=\"h-4 w-4 mr-2\" />\r\n              Guardar Preferencias\r\n            </>\r\n          )}\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\configuracion\\office-age-groups.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadOfficeAgeGroups'. Either include it or remove the dependency array.","line":32,"column":8,"nodeType":"ArrayExpression","endLine":32,"endColumn":18,"suggestions":[{"desc":"Update the dependencies array to be: [loadOfficeAgeGroups, officeId]","fix":{"range":[937,947],"text":"[loadOfficeAgeGroups, officeId]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Label } from \"@red-salud/ui\";\r\nimport { Users } from \"lucide-react\";\r\nimport { AGE_GROUPS } from \"./constants/profile-data\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { toast } from \"sonner\";\r\n\r\ninterface OfficeAgeGroupsProps {\r\n    officeId?: string;\r\n    value?: string[];\r\n    readonly?: boolean;\r\n    onChange?: (groups: string[]) => void;\r\n}\r\n\r\nexport function OfficeAgeGroups({ officeId, value = [], readonly = false, onChange }: OfficeAgeGroupsProps) {\r\n    const [selectedGroups, setSelectedGroups] = useState<string[]>(value);\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    useEffect(() => {\r\n        if (value) {\r\n            setSelectedGroups(value);\r\n        }\r\n    }, [value]);\r\n\r\n    useEffect(() => {\r\n        if (officeId) {\r\n            loadOfficeAgeGroups();\r\n        }\r\n    }, [officeId]);\r\n\r\n    const loadOfficeAgeGroups = async () => {\r\n        if (!officeId) return;\r\n        setLoading(true);\r\n        try {\r\n            const { data, error } = await supabase\r\n                .from(\"doctor_offices\")\r\n                .select(\"patient_age_groups\")\r\n                .eq(\"id\", officeId)\r\n                .single();\r\n\r\n            if (error) throw error;\r\n            if (data && data.patient_age_groups) {\r\n                // Ensure it's an array\r\n                const groups = Array.isArray(data.patient_age_groups) ? data.patient_age_groups : [];\r\n                setSelectedGroups(groups);\r\n                if (onChange) onChange(groups);\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Error loading age groups:\", error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const toggleGroup = async (groupValue: string) => {\r\n        if (readonly) return;\r\n\r\n        const newGroups = selectedGroups.includes(groupValue)\r\n            ? selectedGroups.filter(g => g !== groupValue)\r\n            : [...selectedGroups, groupValue];\r\n\r\n        setSelectedGroups(newGroups);\r\n        if (onChange) onChange(newGroups);\r\n\r\n        if (officeId) {\r\n            try {\r\n                const { error } = await supabase\r\n                    .from(\"doctor_offices\")\r\n                    .update({ patient_age_groups: newGroups })\r\n                    .eq(\"id\", officeId);\r\n\r\n                if (error) throw error;\r\n            } catch (error) {\r\n                console.error(\"Error saving age groups:\", error);\r\n                toast.error(\"Error al guardar cambios\");\r\n                // Revert UI on error\r\n                setSelectedGroups(selectedGroups);\r\n            }\r\n        }\r\n    };\r\n\r\n    if (readonly) {\r\n        return (\r\n            <div className=\"flex flex-wrap gap-2\">\r\n                {selectedGroups.length > 0 ? (\r\n                    selectedGroups.map((groupVal) => {\r\n                        const group = AGE_GROUPS.find(g => g.value === groupVal);\r\n                        return (\r\n                            <Badge key={groupVal} variant=\"outline\" className=\"border-cyan-200 text-cyan-700 bg-cyan-50\">\r\n                                {group?.label || groupVal}\r\n                            </Badge>\r\n                        );\r\n                    })\r\n                ) : (\r\n                    <span className=\"text-sm text-gray-500\">No especificado</span>\r\n                )}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-4\">\r\n            <div className=\"flex items-center gap-2 mb-3\">\r\n                <div className=\"p-2 bg-cyan-100 dark:bg-cyan-900/30 rounded-lg\">\r\n                    <Users className=\"h-4 w-4 text-cyan-600 dark:text-cyan-400\" />\r\n                </div>\r\n                <div>\r\n                    <Label className=\"font-semibold text-gray-900 dark:text-gray-100\">\r\n                        Público Objetivo\r\n                    </Label>\r\n                    <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                        ¿A qué grupos de edad atiendes en este consultorio?\r\n                    </p>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"flex flex-wrap gap-2\">\r\n                {AGE_GROUPS.map((grupo) => {\r\n                    const isSelected = selectedGroups.includes(grupo.value);\r\n                    return (\r\n                        <button\r\n                            key={grupo.value}\r\n                            type=\"button\"\r\n                            onClick={() => toggleGroup(grupo.value)}\r\n                            disabled={loading && !!officeId} // Disable only if saving to DB directly\r\n                            className={`px-3 py-1.5 rounded-md text-xs font-medium transition-all border ${isSelected\r\n                                ? \"bg-cyan-50 border-cyan-200 text-cyan-700 dark:bg-cyan-900/40 dark:border-cyan-800 dark:text-cyan-300 shadow-sm\"\r\n                                : \"bg-white dark:bg-gray-800 border-gray-200 text-gray-600 dark:border-gray-700 dark:text-gray-400 hover:border-cyan-300 hover:text-cyan-600\"\r\n                                }`}\r\n                        >\r\n                            {grupo.label}\r\n                        </button>\r\n                    );\r\n                })}\r\n            </div>\r\n            {!officeId && (\r\n                <p className=\"text-xs text-amber-600 mt-2\">\r\n                    * Guarda el consultorio primero para asegurar los cambios.\r\n                </p>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\configuracion\\office-amenities.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'motion' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { OFFICE_AMENITIES } from \"@/lib/data/office-options\";\r\nimport { Checkbox } from \"@red-salud/ui\";\r\nimport { Label } from \"@red-salud/ui\";\r\nimport { motion } from \"framer-motion\";\r\n\r\ninterface OfficeAmenitiesProps {\r\n    value: Record<string, boolean> | undefined;\r\n    onChange: (value: Record<string, boolean>) => void;\r\n}\r\n\r\nexport function OfficeAmenities({ value = {}, onChange }: OfficeAmenitiesProps) {\r\n    const handleToggle = (id: string, checked: boolean) => {\r\n        onChange({\r\n            ...value,\r\n            [id]: checked\r\n        });\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-4\">\r\n            <div>\r\n                <h4 className=\"text-sm font-medium text-gray-900 dark:text-gray-100\">\r\n                    Servicios y Comodidades\r\n                </h4>\r\n                <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                    Selecciona los servicios que ofrece este consultorio para informar a tus pacientes.\r\n                </p>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-2 md:grid-cols-3 gap-3\">\r\n                {OFFICE_AMENITIES.map((amenity) => {\r\n                    const Icon = amenity.icon;\r\n                    const isChecked = value[amenity.id] || false;\r\n\r\n                    return (\r\n                        <div\r\n                            key={amenity.id}\r\n                            className={`\r\n                                flex items-center space-x-3 p-3 rounded-lg border cursor-pointer transition-all\r\n                                ${isChecked\r\n                                    ? \"border-blue-500 bg-blue-50 dark:bg-blue-900/20\"\r\n                                    : \"border-gray-200 dark:border-gray-800 hover:border-blue-200 dark:hover:border-blue-800\"\r\n                                }\r\n                            `}\r\n                            onClick={() => handleToggle(amenity.id, !isChecked)}\r\n                        >\r\n                            <Checkbox\r\n                                id={`amenity-${amenity.id}`}\r\n                                checked={isChecked}\r\n                                onCheckedChange={(checked) => handleToggle(amenity.id, checked === true)}\r\n                                className=\"data-[state=checked]:bg-blue-600 data-[state=checked]:border-blue-600\"\r\n                            />\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <Icon className={`h-4 w-4 ${isChecked ? \"text-blue-600\" : \"text-gray-500\"}`} />\r\n                                <Label\r\n                                    htmlFor={`amenity-${amenity.id}`}\r\n                                    className=\"text-xs font-medium cursor-pointer\"\r\n                                >\r\n                                    {amenity.label}\r\n                                </Label>\r\n                            </div>\r\n                        </div>\r\n                    );\r\n                })}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\configuracion\\office-instructions.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[379,382],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[379,382],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { Label } from \"@red-salud/ui\";\r\nimport { Phone, User, MapPinned } from \"lucide-react\";\r\n\r\ninterface OfficeInstructionsProps {\r\n    instructions?: string;\r\n    receptionInfo: {\r\n        receptionist_name?: string;\r\n        whatsapp?: string;\r\n    } | undefined;\r\n    onChange: (instructions: string, receptionInfo: any) => void;\r\n}\r\n\r\nexport function OfficeInstructions({ instructions = \"\", receptionInfo = {}, onChange }: OfficeInstructionsProps) {\r\n\r\n    const handleReceptionChange = (field: string, val: string) => {\r\n        onChange(instructions, {\r\n            ...receptionInfo,\r\n            [field]: val\r\n        });\r\n    };\r\n\r\n    const handleInstructionsChange = (val: string) => {\r\n        onChange(val, receptionInfo);\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div>\r\n                <h4 className=\"text-sm font-medium text-gray-900 dark:text-gray-100\">\r\n                    Instrucciones y Recepción\r\n                </h4>\r\n                <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                    Facilita la llegada de tus pacientes con indicaciones claras y contacto directo.\r\n                </p>\r\n            </div>\r\n\r\n            {/* Instrucciones de Llegada */}\r\n            <div>\r\n                <Label className=\"text-xs font-medium text-gray-700 dark:text-gray-300 mb-1.5 block flex items-center gap-2\">\r\n                    <MapPinned className=\"h-3.5 w-3.5 text-blue-500\" />\r\n                    ¿Cómo llegar a la puerta del consultorio?\r\n                </Label>\r\n                <textarea\r\n                    value={instructions}\r\n                    onChange={(e) => handleInstructionsChange(e.target.value)}\r\n                    rows={3}\r\n                    className=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none resize-none\"\r\n                    placeholder=\"Ej: Estacionar en el sótano 2 (puestos azules). Subir a la Torre B, Piso 5. Al salir del ascensor, mano derecha, Puerta 502.\"\r\n                />\r\n                <p className=\"text-[10px] text-gray-400 mt-1\">\r\n                    Sé lo más específico posible para evitar que el paciente se pierda.\r\n                </p>\r\n            </div>\r\n\r\n            <div className=\"border-t border-gray-200 dark:border-gray-800 pt-4\">\r\n                <Label className=\"text-xs font-medium text-gray-700 dark:text-gray-300 mb-3 block\">\r\n                    Contacto de Recepción / Secretaria (Opcional)\r\n                </Label>\r\n\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                    <div>\r\n                        <Label className=\"text-[10px] text-gray-500 mb-1 block\">Nombre de Recepcionista</Label>\r\n                        <div className=\"relative\">\r\n                            <User className=\"absolute left-3 top-2.5 h-3.5 w-3.5 text-gray-400\" />\r\n                            <Input\r\n                                value={receptionInfo.receptionist_name || \"\"}\r\n                                onChange={(e) => handleReceptionChange(\"receptionist_name\", e.target.value)}\r\n                                className=\"pl-8 h-9 text-sm\"\r\n                                placeholder=\"María Pérez\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div>\r\n                        <Label className=\"text-[10px] text-gray-500 mb-1 block\">WhatsApp de Citas (Sede)</Label>\r\n                        <div className=\"relative\">\r\n                            <Phone className=\"absolute left-3 top-2.5 h-3.5 w-3.5 text-gray-400\" />\r\n                            <Input\r\n                                type=\"tel\"\r\n                                value={receptionInfo.whatsapp || \"\"}\r\n                                onChange={(e) => handleReceptionChange(\"whatsapp\", e.target.value)}\r\n                                className=\"pl-8 h-9 text-sm\"\r\n                                placeholder=\"+58 412 0000000\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\configuracion\\office-photos.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'X' is defined but never used.","line":5,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cn' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'toast' is defined but never used.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":15},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadPhotos'. Either include it or remove the dependency array.","line":34,"column":8,"nodeType":"ArrayExpression","endLine":34,"endColumn":18,"suggestions":[{"desc":"Update the dependencies array to be: [loadPhotos, officeId]","fix":{"range":[1259,1269],"text":"[loadPhotos, officeId]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'url' is defined but never used.","line":106,"column":50,"nodeType":null,"messageId":"unusedVar","endLine":106,"endColumn":53},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":206,"column":29,"nodeType":"JSXOpeningElement","endLine":210,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect, useRef } from \"react\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Loader2, X, Upload, Image as ImageIcon, Star, Trash2 } from \"lucide-react\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { toast } from \"sonner\"; // Assuming sonner or use toast from ui\r\n\r\ninterface OfficePhoto {\r\n    id: string;\r\n    url: string;\r\n    caption?: string;\r\n    is_cover: boolean;\r\n}\r\n\r\ninterface OfficePhotosProps {\r\n    officeId?: string; // Optional because we might be creating a new office (though photos usually need an ID first)\r\n    // If officeId is missing, we might need to disable upload or handle temp uploads.\r\n    // For now, let's require officeId, implying photos are added AFTER initial save.\r\n    onChange?: () => void; // Trigger refresh or parent update\r\n}\r\n\r\nexport function OfficePhotos({ officeId, onChange }: OfficePhotosProps) {\r\n    const [photos, setPhotos] = useState<OfficePhoto[]>([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [uploading, setUploading] = useState(false);\r\n    const inputRef = useRef<HTMLInputElement>(null);\r\n\r\n    useEffect(() => {\r\n        if (officeId) {\r\n            loadPhotos();\r\n        }\r\n    }, [officeId]);\r\n\r\n    const loadPhotos = async () => {\r\n        if (!officeId) return;\r\n        setLoading(true);\r\n        try {\r\n            const { data, error } = await supabase\r\n                .from(\"office_photos\")\r\n                .select(\"*\")\r\n                .eq(\"office_id\", officeId)\r\n                .order(\"is_cover\", { ascending: false })\r\n                .order(\"display_order\", { ascending: true });\r\n\r\n            if (error) throw error;\r\n            setPhotos(data || []);\r\n        } catch (error) {\r\n            console.error(\"Error loading photos:\", error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const files = e.target.files;\r\n        if (!files || files.length === 0 || !officeId) return;\r\n\r\n        setUploading(true);\r\n        try {\r\n            const { data: { user } } = await supabase.auth.getUser();\r\n            if (!user) throw new Error(\"No user\");\r\n\r\n            const uploadPromises = Array.from(files).map(async (file) => {\r\n                const fileExt = file.name.split('.').pop();\r\n                const fileName = `${officeId}/${Date.now()}-${Math.random().toString(36).substring(7)}.${fileExt}`;\r\n\r\n                // Upload to Storage\r\n                const { error: uploadError } = await supabase.storage\r\n                    .from(\"office-photos\")\r\n                    .upload(fileName, file);\r\n\r\n                if (uploadError) throw uploadError;\r\n\r\n                // Get Public URL\r\n                const { data: { publicUrl } } = supabase.storage\r\n                    .from(\"office-photos\")\r\n                    .getPublicUrl(fileName);\r\n\r\n                // Insert into DB\r\n                const { error: dbError } = await supabase\r\n                    .from(\"office_photos\")\r\n                    .insert({\r\n                        office_id: officeId,\r\n                        url: publicUrl,\r\n                        is_cover: photos.length === 0 // First photo is cover by default\r\n                    });\r\n\r\n                if (dbError) throw dbError;\r\n            });\r\n\r\n            await Promise.all(uploadPromises);\r\n            await loadPhotos();\r\n            onChange?.();\r\n\r\n        } catch (error) {\r\n            console.error(\"Error uploading photos:\", error);\r\n            // alert(\"Error al subir fotos. Asegúrate de que el formato sea válido.\");\r\n        } finally {\r\n            setUploading(false);\r\n            if (inputRef.current) inputRef.current.value = \"\";\r\n        }\r\n    };\r\n\r\n    const handleDelete = async (photoId: string, url: string) => {\r\n        if (!confirm(\"¿Eliminar esta foto?\")) return;\r\n\r\n        try {\r\n            // Delete from DB\r\n            const { error: dbError } = await supabase\r\n                .from(\"office_photos\")\r\n                .delete()\r\n                .eq(\"id\", photoId);\r\n\r\n            if (dbError) throw dbError;\r\n\r\n            // Try to delete from storage (optional cleanup)\r\n            // Extract path from URL... logic might be complex if URL structure varies\r\n            // For now, just removing from DB is sufficient for UI.\r\n\r\n            await loadPhotos();\r\n            onChange?.();\r\n        } catch (error) {\r\n            console.error(\"Error deleting photo:\", error);\r\n        }\r\n    };\r\n\r\n    const handleSetCover = async (photoId: string) => {\r\n        if (!officeId) return;\r\n        try {\r\n            // Unset current cover\r\n            await supabase\r\n                .from(\"office_photos\")\r\n                .update({ is_cover: false })\r\n                .eq(\"office_id\", officeId);\r\n\r\n            // Set new cover\r\n            await supabase\r\n                .from(\"office_photos\")\r\n                .update({ is_cover: true })\r\n                .eq(\"id\", photoId);\r\n\r\n            await loadPhotos();\r\n            onChange?.();\r\n        } catch (error) {\r\n            console.error(\"Error setting cover:\", error);\r\n        }\r\n    };\r\n\r\n    if (!officeId) {\r\n        return (\r\n            <div className=\"text-center py-8 border-2 border-dashed border-gray-200 dark:border-gray-800 rounded-lg bg-gray-50 dark:bg-gray-900/50\">\r\n                <ImageIcon className=\"h-10 w-10 text-gray-300 mx-auto mb-2\" />\r\n                <p className=\"text-sm text-gray-500\">\r\n                    Guarda el consultorio primero para subir fotos.\r\n                </p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-4\">\r\n            <div className=\"flex justify-between items-center\">\r\n                <div>\r\n                    <h4 className=\"text-sm font-medium text-gray-900 dark:text-gray-100\">\r\n                        Galería de Fotos\r\n                    </h4>\r\n                    <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                        Añade fotos de la fachada, sala de espera y consultorio.\r\n                    </p>\r\n                </div>\r\n                <div>\r\n                    <input\r\n                        ref={inputRef}\r\n                        type=\"file\"\r\n                        multiple\r\n                        accept=\"image/*\"\r\n                        onChange={handleUpload}\r\n                        className=\"hidden\"\r\n                    />\r\n                    <Button\r\n                        size=\"sm\"\r\n                        onClick={() => inputRef.current?.click()}\r\n                        disabled={uploading}\r\n                    >\r\n                        {uploading ? <Loader2 className=\"h-4 w-4 animate-spin mr-2\" /> : <Upload className=\"h-4 w-4 mr-2\" />}\r\n                        Subir Fotos\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n\r\n            {loading ? (\r\n                <div className=\"flex justify-center py-8\">\r\n                    <Loader2 className=\"h-6 w-6 animate-spin text-blue-600\" />\r\n                </div>\r\n            ) : photos.length === 0 ? (\r\n                <div className=\"text-center py-8 border-2 border-dashed border-gray-200 dark:border-gray-800 rounded-lg\">\r\n                    <ImageIcon className=\"h-10 w-10 text-gray-300 mx-auto mb-2\" />\r\n                    <p className=\"text-sm text-gray-500\">No hay fotos subidas aún</p>\r\n                </div>\r\n            ) : (\r\n                <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4\">\r\n                    {photos.map((photo) => (\r\n                        <div key={photo.id} className=\"relative group aspect-video rounded-lg overflow-hidden border border-gray-200 dark:border-gray-800 bg-gray-100\">\r\n                            <img\r\n                                src={photo.url}\r\n                                alt=\"Consultorio\"\r\n                                className=\"w-full h-full object-cover\"\r\n                            />\r\n\r\n                            <div className=\"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col justify-between p-2\">\r\n                                <div className=\"flex justify-end\">\r\n                                    <button\r\n                                        onClick={() => handleDelete(photo.id, photo.url)}\r\n                                        className=\"text-white hover:text-red-400 p-1 bg-black/20 rounded-full\"\r\n                                    >\r\n                                        <Trash2 className=\"h-4 w-4\" />\r\n                                    </button>\r\n                                </div>\r\n\r\n                                {photo.is_cover ? (\r\n                                    <div className=\"self-start bg-blue-600 text-white text-[10px] px-2 py-0.5 rounded-full flex items-center gap-1\">\r\n                                        <Star className=\"h-3 w-3 fill-current\" />\r\n                                        Principal\r\n                                    </div>\r\n                                ) : (\r\n                                    <button\r\n                                        onClick={() => handleSetCover(photo.id)}\r\n                                        className=\"self-start text-white/80 hover:text-white text-xs flex items-center gap-1 bg-black/20 px-2 py-0.5 rounded-full\"\r\n                                    >\r\n                                        <Star className=\"h-3 w-3\" />\r\n                                        Hacer Principal\r\n                                    </button>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\configuracion\\office-pricing.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[739,742],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[739,742],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":30,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[884,887],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[884,887],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isLoadingRate' is assigned a value but never used.","line":46,"column":43,"nodeType":null,"messageId":"unusedVar","endLine":46,"endColumn":56}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { CURRENCIES, PAYMENT_METHODS } from \"@/lib/data/office-options\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { Label } from \"@red-salud/ui\";\r\nimport { Checkbox } from \"@red-salud/ui\";\r\nimport {\r\n    Select,\r\n    SelectContent,\r\n    SelectItem,\r\n    SelectTrigger,\r\n    SelectValue,\r\n} from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { DollarSign, CreditCard } from \"lucide-react\";\r\nimport { useBCVRate } from \"@/hooks/use-bcv-rate\";\r\n\r\ninterface OfficePricingProps {\r\n    officeId?: string;\r\n    value: {\r\n        consultation_fee?: number;\r\n        currency?: string;\r\n        payment_methods?: string[];\r\n        insurance_accepted?: boolean;\r\n    } | undefined;\r\n    onChange: (value: any) => void;\r\n}\r\n\r\nexport function OfficePricing({ value = {}, onChange }: OfficePricingProps) {\r\n    const handleChange = (field: string, val: any) => {\r\n        onChange({\r\n            ...value,\r\n            [field]: val\r\n        });\r\n    };\r\n\r\n    const togglePaymentMethod = (methodId: string) => {\r\n        const currentMethods = value.payment_methods || [];\r\n        if (currentMethods.includes(methodId)) {\r\n            handleChange(\"payment_methods\", currentMethods.filter(m => m !== methodId));\r\n        } else {\r\n            handleChange(\"payment_methods\", [...currentMethods, methodId]);\r\n        }\r\n    };\r\n\r\n    const { data: bcvResponse, isLoading: isLoadingRate } = useBCVRate();\r\n\r\n    const getConversionDisplay = (amount: number | undefined, currency: string | undefined) => {\r\n        if (!amount || !bcvResponse?.rates) return null;\r\n\r\n        const usdRate = bcvResponse.rates.find(r => r.currency === 'USD')?.rate;\r\n        const eurRate = bcvResponse.rates.find(r => r.currency === 'EUR')?.rate;\r\n\r\n        if (currency === 'USD' && usdRate) {\r\n            return (\r\n                <p className=\"text-[10px] text-gray-500 mt-1 pl-1\">\r\n                    Aprox. <span className=\"font-medium text-gray-700 dark:text-gray-300\">Bs. {(amount * usdRate).toLocaleString(\"es-VE\", { maximumFractionDigits: 2 })}</span> (Tasa BCV)\r\n                </p>\r\n            );\r\n        }\r\n\r\n        if (currency === 'EUR' && eurRate) {\r\n            return (\r\n                <p className=\"text-[10px] text-gray-500 mt-1 pl-1\">\r\n                    Aprox. <span className=\"font-medium text-gray-700 dark:text-gray-300\">Bs. {(amount * eurRate).toLocaleString(\"es-VE\", { maximumFractionDigits: 2 })}</span> (Tasa BCV)\r\n                </p>\r\n            );\r\n        }\r\n\r\n        if (currency === 'VES' && usdRate) {\r\n            return (\r\n                <p className=\"text-[10px] text-gray-500 mt-1 pl-1\">\r\n                    Aprox. <span className=\"font-medium text-gray-700 dark:text-gray-300\">${(amount / usdRate).toLocaleString(\"en-US\", { maximumFractionDigits: 2 })}</span> (Ref. Oficial)\r\n                </p>\r\n            );\r\n        }\r\n\r\n        return null;\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div>\r\n                <h4 className=\"text-sm font-medium text-gray-900 dark:text-gray-100\">\r\n                    Precios y Pagos\r\n                </h4>\r\n                <div className=\"flex justify-between items-start\">\r\n                    <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                        Define el costo de consulta y métodos de pago aceptados en esta sede.\r\n                    </p>\r\n                    {bcvResponse?.rates && (\r\n                        <div className=\"flex gap-1\">\r\n                            {bcvResponse.rates.map(rate => (\r\n                                <Badge key={rate.currency} variant=\"outline\" className=\"text-[10px] bg-green-50 text-green-700 border-green-200\">\r\n                                    {rate.currency}: {rate.rate.toLocaleString(\"es-VE\")}\r\n                                </Badge>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {/* Costo Consulta */}\r\n                <div>\r\n                    <Label className=\"text-xs font-medium text-gray-700 dark:text-gray-300 mb-1.5 block\">\r\n                        Costo de Consulta\r\n                    </Label>\r\n                    <div className=\"relative\">\r\n                        <DollarSign className=\"absolute left-3 top-2.5 h-4 w-4 text-gray-400\" />\r\n                        <Input\r\n                            type=\"number\"\r\n                            min=\"0\"\r\n                            step=\"0.01\"\r\n                            value={value.consultation_fee || \"\"}\r\n                            onChange={(e) => handleChange(\"consultation_fee\", parseFloat(e.target.value))}\r\n                            className=\"pl-9\"\r\n                            placeholder=\"0.00\"\r\n                        />\r\n                    </div>\r\n                    {getConversionDisplay(value.consultation_fee, value.currency)}\r\n                </div>\r\n\r\n                {/* Moneda */}\r\n                <div>\r\n                    <Label className=\"text-xs font-medium text-gray-700 dark:text-gray-300 mb-1.5 block\">\r\n                        Moneda\r\n                    </Label>\r\n                    <Select\r\n                        value={value.currency || \"USD\"}\r\n                        onValueChange={(val) => handleChange(\"currency\", val)}\r\n                    >\r\n                        <SelectTrigger>\r\n                            <SelectValue placeholder=\"Seleccionar Moneda\" />\r\n                        </SelectTrigger>\r\n                        <SelectContent>\r\n                            {CURRENCIES.map((curr) => (\r\n                                <SelectItem key={curr.code} value={curr.code}>\r\n                                    {curr.code} - {curr.name} ({curr.symbol})\r\n                                </SelectItem>\r\n                            ))}\r\n                        </SelectContent>\r\n                    </Select>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Seguros */}\r\n            <div className=\"flex items-center space-x-2 border rounded-lg p-3 bg-gray-50 dark:bg-gray-800/50\">\r\n                <Checkbox\r\n                    id=\"insurance\"\r\n                    checked={value.insurance_accepted || false}\r\n                    onCheckedChange={(checked) => handleChange(\"insurance_accepted\", checked)}\r\n                />\r\n                <Label htmlFor=\"insurance\" className=\"text-sm cursor-pointer\">\r\n                    Acepta Seguros Médicos en esta sede\r\n                </Label>\r\n            </div>\r\n\r\n            {/* Métodos de Pago */}\r\n            <div>\r\n                <Label className=\"text-xs font-medium text-gray-700 dark:text-gray-300 mb-2 block flex items-center gap-2\">\r\n                    <CreditCard className=\"h-3.5 w-3.5\" />\r\n                    Métodos de Pago Aceptados\r\n                </Label>\r\n                <div className=\"grid grid-cols-2 md:grid-cols-3 gap-2\">\r\n                    {PAYMENT_METHODS.map((method) => {\r\n                        const isSelected = (value.payment_methods || []).includes(method.id);\r\n                        return (\r\n                            <div\r\n                                key={method.id}\r\n                                className={`\r\n                                    flex items-center space-x-2 p-2 rounded border cursor-pointer text-xs\r\n                                    ${isSelected\r\n                                        ? \"border-green-500 bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300\"\r\n                                        : \"border-gray-200 dark:border-gray-800 text-gray-600 dark:text-gray-400\"\r\n                                    }\r\n                                `}\r\n                                onClick={() => togglePaymentMethod(method.id)}\r\n                            >\r\n                                <Checkbox\r\n                                    checked={isSelected}\r\n                                    onCheckedChange={() => togglePaymentMethod(method.id)}\r\n                                    className={`h-3.5 w-3.5 ${isSelected ? \"border-green-600 data-[state=checked]:bg-green-600\" : \"\"}`}\r\n                                />\r\n                                <span>{method.label}</span>\r\n                            </div>\r\n                        );\r\n                    })}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\configuracion\\offices-section.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadOffices'. Either include it or remove the dependency array.","line":124,"column":8,"nodeType":"ArrayExpression","endLine":124,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [loadOffices]","fix":{"range":[3934,3936],"text":"[loadOffices]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'newOffice' is assigned a value but never used.","line":198,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":198,"endColumn":40}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file offices-section.tsx\r\n * @description Sección para gestionar los consultorios del médico (CRUD completo).\r\n * Permite agregar, editar, eliminar y marcar consultorios como principales.\r\n * Ahora incluye capacidades Premium: Amenities, Precios, Instrucciones.\r\n * @module Dashboard/Medico/Configuracion\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Label } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { StateCitySelector } from \"@red-salud/ui\";\r\nimport { LocationPicker, LocationData } from \"@red-salud/ui\";\r\nimport { VENEZUELA_ESTADOS } from \"@/lib/data/venezuela-data\";\r\nimport {\r\n    Plus,\r\n    MapPin,\r\n    Building2,\r\n    Pencil,\r\n    Trash2,\r\n    Save,\r\n    X,\r\n    Loader2,\r\n    Star,\r\n    Map,\r\n    CheckCircle2,\r\n    DollarSign,\r\n    Users,\r\n    FileText,\r\n    Component\r\n} from \"lucide-react\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { Toast } from \"@red-salud/ui\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@red-salud/ui\";\r\n\r\nimport { OfficeAmenities } from \"./office-amenities\";\r\nimport { OfficePricing } from \"./office-pricing\";\r\nimport { OfficeInstructions } from \"./office-instructions\";\r\nimport { OfficePhotos } from \"./office-photos\";\r\nimport { OfficeAgeGroups } from \"./office-age-groups\";\r\n\r\n/** Interfaz para un consultorio completa */\r\ninterface Office {\r\n    id?: string;\r\n    nombre: string;\r\n    direccion: string;\r\n    ciudad: string;\r\n    estado: string;\r\n    codigo_postal: string;\r\n    telefono: string;\r\n    notas: string;\r\n    es_principal: boolean;\r\n    activo: boolean;\r\n    latitude?: number;\r\n    longitude?: number;\r\n    // Premium fields\r\n    amenities?: Record<string, boolean>;\r\n    price_info?: {\r\n        consultation_fee?: number;\r\n        price_currency: string;\r\n        payment_methods: string[];\r\n        accepts_insurance: boolean;\r\n        insurance_companies: string[];\r\n    };\r\n    arrival_instructions?: string;\r\n    reception_info?: {\r\n        receptionist_name?: string;\r\n        whatsapp?: string;\r\n    };\r\n    patient_age_groups?: string[];\r\n}\r\n\r\n/** Consultorio vacío para formulario */\r\nconst EMPTY_OFFICE: Office = {\r\n    nombre: \"\",\r\n    direccion: \"\",\r\n    ciudad: \"\",\r\n    estado: \"\",\r\n    codigo_postal: \"\",\r\n    telefono: \"\",\r\n    notas: \"\",\r\n    es_principal: false,\r\n    activo: true,\r\n    amenities: {},\r\n    price_info: { price_currency: \"USD\", payment_methods: [], accepts_insurance: false, insurance_companies: [] },\r\n    arrival_instructions: \"\",\r\n    reception_info: {},\r\n    patient_age_groups: []\r\n};\r\n\r\n// Constantes de ejemplo para los tabs\r\nconst TABS = [\r\n    { id: \"general\", label: \"General\", icon: Building2 },\r\n    { id: \"amenities\", label: \"Servicios\", icon: CheckCircle2 },\r\n    { id: \"pricing\", label: \"Precios\", icon: DollarSign },\r\n    { id: \"patients\", label: \"Pacientes\", icon: Users },\r\n    { id: \"instructions\", label: \"Llegada\", icon: FileText },\r\n    { id: \"photos\", label: \"Fotos\", icon: Component },\r\n];\r\n\r\n/**\r\n * Componente de gestión de consultorios\r\n */\r\nexport function OfficesSection() {\r\n    const [loading, setLoading] = useState(true);\r\n    const [saving, setSaving] = useState(false);\r\n    const [offices, setOffices] = useState<Office[]>([]);\r\n    const [editing, setEditing] = useState<string | null>(null);\r\n    const [formData, setFormData] = useState<Office>(EMPTY_OFFICE);\r\n    const [isCreating, setIsCreating] = useState(false);\r\n    const [showMap, setShowMap] = useState(false);\r\n    const [selectedEstadoCode, setSelectedEstadoCode] = useState(\"\");\r\n    const [activeTab, setActiveTab] = useState(\"general\");\r\n\r\n    // Estado para Toast\r\n    const [toast, setToast] = useState({ visible: false, message: \"\", type: \"info\" as \"success\" | \"error\" | \"info\" });\r\n\r\n    useEffect(() => {\r\n        loadOffices();\r\n    }, []);\r\n\r\n    /**\r\n     * Carga los consultorios del médico\r\n     */\r\n    const loadOffices = async () => {\r\n        try {\r\n            const { data: { user } } = await supabase.auth.getUser();\r\n            if (!user) return;\r\n\r\n            const { data, error } = await supabase\r\n                .from(\"doctor_offices\")\r\n                .select(\"*\")\r\n                .eq(\"doctor_id\", user.id)\r\n                .order(\"es_principal\", { ascending: false })\r\n                .order(\"created_at\", { ascending: true });\r\n\r\n            if (error) throw error;\r\n\r\n            setOffices(data || []);\r\n        } catch (error) {\r\n            console.error(\"[OfficesSection] Error loading offices:\", error);\r\n            showToast(\"Error al cargar consultorios\", \"error\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Guarda un consultorio (crear o actualizar)\r\n     */\r\n    const handleSave = async () => {\r\n        if (!formData.nombre?.trim()) {\r\n            showToast(\"El nombre del consultorio es obligatorio\", \"error\");\r\n            setActiveTab(\"general\");\r\n            return;\r\n        }\r\n\r\n        setSaving(true);\r\n        try {\r\n            const { data: { user } } = await supabase.auth.getUser();\r\n            if (!user) return;\r\n\r\n            const officeData = {\r\n                nombre: formData.nombre,\r\n                direccion: formData.direccion,\r\n                ciudad: formData.ciudad,\r\n                estado: formData.estado,\r\n                codigo_postal: formData.codigo_postal,\r\n                telefono: formData.telefono,\r\n                notas: formData.notas,\r\n                es_principal: formData.es_principal,\r\n                activo: formData.activo,\r\n                latitude: formData.latitude,\r\n                longitude: formData.longitude,\r\n                amenities: formData.amenities,\r\n                price_info: formData.price_info,\r\n                arrival_instructions: formData.arrival_instructions,\r\n                reception_info: formData.reception_info,\r\n                patient_age_groups: formData.patient_age_groups\r\n            };\r\n\r\n            if (editing) {\r\n                // Actualizar consultorio existente\r\n                const { error } = await supabase\r\n                    .from(\"doctor_offices\")\r\n                    .update(officeData)\r\n                    .eq(\"id\", editing);\r\n\r\n                if (error) throw error;\r\n                showToast(\"Consultorio actualizado con éxito\", \"success\");\r\n            } else {\r\n                // Crear nuevo consultorio\r\n                // Necesitamos devolver el ID para poder subir fotos inmediatamente si el usuario quiere\r\n                const { data: newOffice, error } = await supabase\r\n                    .from(\"doctor_offices\")\r\n                    .insert({\r\n                        doctor_id: user.id,\r\n                        ...officeData\r\n                    })\r\n                    .select()\r\n                    .single();\r\n\r\n                if (error) throw error;\r\n                showToast(\"Consultorio creado con éxito\", \"success\");\r\n\r\n                // Si estamos creando, podríamos cambiar a modo edición para permitir subir fotos sin cerrar\r\n                // Pero por simplicidad, recargamos y cerramos, o podríamos preguntar.\r\n                // Logica actual: cierra el form.\r\n            }\r\n\r\n            await loadOffices();\r\n            handleCancel();\r\n        } catch (error) {\r\n            console.error(\"[OfficesSection] Error saving office:\", error);\r\n            showToast(\"Error al guardar consultorio\", \"error\");\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Elimina un consultorio\r\n     */\r\n    const handleDelete = async (id: string) => {\r\n        if (!confirm(\"¿Estás seguro de eliminar este consultorio? Esta acción no se puede deshacer.\")) {\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const { error } = await supabase\r\n                .from(\"doctor_offices\")\r\n                .delete()\r\n                .eq(\"id\", id);\r\n\r\n            if (error) throw error;\r\n\r\n            showToast(\"Consultorio eliminado\", \"success\");\r\n            await loadOffices();\r\n        } catch (error) {\r\n            console.error(\"[OfficesSection] Error deleting office:\", error);\r\n            showToast(\"Error al eliminar consultorio\", \"error\");\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Inicia la edición de un consultorio\r\n     */\r\n    const startEdit = (office: Office) => {\r\n        // Sanitizar objeto para evitar nulls en inputs\r\n        const sanitizedOffice = {\r\n            ...office,\r\n            nombre: office.nombre || \"\",\r\n            direccion: office.direccion || \"\",\r\n            ciudad: office.ciudad || \"\",\r\n            estado: office.estado || \"\",\r\n            codigo_postal: office.codigo_postal || \"\",\r\n            telefono: office.telefono || \"\",\r\n            notas: office.notas || \"\",\r\n            latitude: office.latitude,\r\n            longitude: office.longitude,\r\n            amenities: office.amenities || {},\r\n            price_info: office.price_info || { price_currency: \"USD\", payment_methods: [], accepts_insurance: false, insurance_companies: [] },\r\n            arrival_instructions: office.arrival_instructions || \"\",\r\n            reception_info: office.reception_info || {},\r\n            patient_age_groups: office.patient_age_groups || []\r\n        };\r\n\r\n        setFormData(sanitizedOffice);\r\n\r\n        // Intentar recuperar el código del estado basado en el nombre para el selector\r\n        const estadoObj = VENEZUELA_ESTADOS.find(e =>\r\n            e.name.toLowerCase() === (office.estado || \"\").toLowerCase() ||\r\n            e.code === office.estado\r\n        );\r\n        setSelectedEstadoCode(estadoObj ? estadoObj.code : \"\");\r\n\r\n        setEditing(office.id!);\r\n        setIsCreating(false);\r\n        setActiveTab(\"general\");\r\n    };\r\n\r\n    /**\r\n     * Inicia la creación de un nuevo consultorio\r\n     */\r\n    const startCreate = () => {\r\n        setFormData(EMPTY_OFFICE);\r\n        setEditing(null);\r\n        setIsCreating(true);\r\n        setActiveTab(\"general\");\r\n        setSelectedEstadoCode(\"\");\r\n    };\r\n\r\n    /**\r\n     * Cancela la edición/creación\r\n     */\r\n    const handleCancel = () => {\r\n        setFormData(EMPTY_OFFICE);\r\n        setEditing(null);\r\n        setIsCreating(false);\r\n        setShowMap(false);\r\n        setSelectedEstadoCode(\"\");\r\n        setActiveTab(\"general\");\r\n    };\r\n\r\n    /**\r\n     * Maneja la selección de ubicación desde el mapa\r\n     */\r\n    const handleLocationSelect = (location: LocationData) => {\r\n        // Intentar mapear el estado de Google al código interno\r\n        let estadoCode = \"\";\r\n        const ciudadName = location.city || formData.ciudad;\r\n        let estadoName = location.state || formData.estado;\r\n\r\n        if (location.state) {\r\n            // Busqueda aproximada del estado\r\n            const estadoObj = VENEZUELA_ESTADOS.find(e =>\r\n                location.state!.toLowerCase().includes(e.name.toLowerCase()) ||\r\n                e.name.toLowerCase().includes(location.state!.toLowerCase())\r\n            );\r\n\r\n            if (estadoObj) {\r\n                estadoCode = estadoObj.code;\r\n                estadoName = estadoObj.name; // Usar el nombre estandarizado\r\n            }\r\n        }\r\n\r\n        setSelectedEstadoCode(estadoCode);\r\n\r\n        setFormData({\r\n            ...formData,\r\n            direccion: location.address || formData.direccion || \"\",\r\n            ciudad: ciudadName || \"\",\r\n            estado: estadoName || \"\",\r\n            codigo_postal: location.postalCode || formData.codigo_postal || \"\",\r\n            latitude: location.lat,\r\n            longitude: location.lng,\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Muestra un toast\r\n     */\r\n    const showToast = (message: string, type: \"success\" | \"error\" | \"info\") => {\r\n        setToast({ visible: true, message, type });\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"flex items-center justify-center py-12\">\r\n                <Loader2 className=\"h-8 w-8 animate-spin text-blue-600\" />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Toast */}\r\n            <Toast\r\n                message={toast.message}\r\n                type={toast.type}\r\n                isVisible={toast.visible}\r\n                onClose={() => setToast({ ...toast, visible: false })}\r\n            />\r\n\r\n            {/* Header */}\r\n            <div className=\"flex items-start justify-between pb-4 border-b border-gray-200 dark:border-gray-800\">\r\n                <div>\r\n                    <h3 className=\"text-base font-semibold text-gray-900 dark:text-gray-100\">\r\n                        Mis Consultorios\r\n                    </h3>\r\n                    <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-0.5\">\r\n                        Gestiona las ubicaciones y la información detallada de tus sedes.\r\n                    </p>\r\n                </div>\r\n                <Button\r\n                    onClick={startCreate}\r\n                    size=\"sm\"\r\n                    className=\"gap-2\"\r\n                    disabled={isCreating || editing !== null}\r\n                >\r\n                    <Plus className=\"h-4 w-4\" />\r\n                    Nuevo Consultorio\r\n                </Button>\r\n            </div>\r\n\r\n            {/* Form (Create/Edit) */}\r\n            <AnimatePresence>\r\n                {(isCreating || editing) && (\r\n                    <motion.div\r\n                        initial={{ opacity: 0, height: 0 }}\r\n                        animate={{ opacity: 1, height: \"auto\" }}\r\n                        exit={{ opacity: 0, height: 0 }}\r\n                        className=\"overflow-hidden\"\r\n                    >\r\n                        <div className=\"border border-blue-200 dark:border-blue-800 rounded-lg p-4 bg-white dark:bg-gray-900 shadow-sm mb-6\">\r\n                            <div className=\"flex justify-between items-center mb-4 border-b pb-2\">\r\n                                <h4 className=\"text-sm font-semibold text-gray-900 dark:text-gray-100\">\r\n                                    {editing ? \"Editar Consultorio\" : \"Nuevo Consultorio\"}\r\n                                </h4>\r\n                                <Button\r\n                                    variant=\"ghost\"\r\n                                    size=\"sm\"\r\n                                    onClick={handleCancel}\r\n                                    className=\"h-8 w-8 p-0\"\r\n                                >\r\n                                    <X className=\"h-4 w-4\" />\r\n                                </Button>\r\n                            </div>\r\n\r\n                            <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\r\n                                <TabsList className=\"grid w-full grid-cols-6 mb-4\">\r\n                                    {TABS.map((tab) => (\r\n                                        <TabsTrigger\r\n                                            key={tab.id}\r\n                                            value={tab.id}\r\n                                            className=\"flex items-center gap-1\"\r\n                                        >\r\n                                            <tab.icon className=\"h-4 w-4\" />\r\n                                            <span className=\"hidden sm:inline\">{tab.label}</span>\r\n                                        </TabsTrigger>\r\n                                    ))}\r\n                                </TabsList>\r\n\r\n                                {/* TAB: GENERAL (Existing Form) */}\r\n                                <TabsContent value=\"general\" className=\"mt-0 space-y-4\">\r\n                                    <div className=\"grid grid-cols-2 gap-4\">\r\n                                        {/* Nombre */}\r\n                                        <div className=\"col-span-2\">\r\n                                            <Label className=\"text-xs font-medium text-gray-700 dark:text-gray-300 mb-1.5 block\">\r\n                                                Nombre del Consultorio *\r\n                                            </Label>\r\n                                            <input\r\n                                                type=\"text\"\r\n                                                value={formData.nombre}\r\n                                                onChange={(e) => setFormData({ ...formData, nombre: e.target.value })}\r\n                                                className=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none\"\r\n                                                placeholder=\"Ej: Consultorio Central\"\r\n                                            />\r\n                                        </div>\r\n\r\n                                        {/* Google Maps LocationPicker */}\r\n                                        <div className=\"col-span-2\">\r\n                                            <div className=\"mb-2 flex items-center justify-between\">\r\n                                                <Label className=\"text-xs font-medium text-gray-700 dark:text-gray-300\">\r\n                                                    Ubicación (Opcional)\r\n                                                </Label>\r\n                                                <Button\r\n                                                    type=\"button\"\r\n                                                    variant=\"ghost\"\r\n                                                    size=\"sm\"\r\n                                                    onClick={() => setShowMap(!showMap)}\r\n                                                    className=\"text-xs gap-1\"\r\n                                                >\r\n                                                    <Map className=\"h-3 w-3\" />\r\n                                                    {showMap ? 'Ocultar Mapa' : 'Mostrar Mapa'}\r\n                                                </Button>\r\n                                            </div>\r\n                                            {showMap && (\r\n                                                <LocationPicker\r\n                                                    initialLocation={\r\n                                                        formData.latitude && formData.longitude\r\n                                                            ? { lat: formData.latitude, lng: formData.longitude }\r\n                                                            : undefined\r\n                                                    }\r\n                                                    onLocationSelect={handleLocationSelect}\r\n                                                    apiKey={process.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY || \"\"}\r\n                                                    height=\"350px\"\r\n                                                />\r\n                                            )}\r\n                                        </div>\r\n\r\n                                        {/* Dirección */}\r\n                                        <div className=\"col-span-2\">\r\n                                            <Label className=\"text-xs font-medium text-gray-700 dark:text-gray-300 mb-1.5 block\">\r\n                                                Dirección\r\n                                            </Label>\r\n                                            <input\r\n                                                type=\"text\"\r\n                                                value={formData.direccion}\r\n                                                onChange={(e) => setFormData({ ...formData, direccion: e.target.value })}\r\n                                                className=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none\"\r\n                                                placeholder=\"Av. Principal 123\"\r\n                                            />\r\n                                        </div>\r\n\r\n                                        {/* StateCitySelector - Venezuela */}\r\n                                        <div className=\"col-span-2\">\r\n                                            <StateCitySelector\r\n                                                selectedEstadoCode={selectedEstadoCode}\r\n                                                selectedCiudad={formData.ciudad}\r\n                                                onEstadoChange={(code) => {\r\n                                                    setSelectedEstadoCode(code);\r\n                                                    setFormData({ ...formData, estado: code });\r\n                                                }}\r\n                                                onCiudadChange={(ciudad) => setFormData({ ...formData, ciudad })}\r\n                                            />\r\n                                        </div>\r\n\r\n                                        {/* Código Postal y Teléfono */}\r\n                                        <div>\r\n                                            <Label className=\"text-xs font-medium text-gray-700 dark:text-gray-300 mb-1.5 block\">\r\n                                                Código Postal\r\n                                            </Label>\r\n                                            <input\r\n                                                type=\"text\"\r\n                                                value={formData.codigo_postal}\r\n                                                onChange={(e) => setFormData({ ...formData, codigo_postal: e.target.value })}\r\n                                                className=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none\"\r\n                                                placeholder=\"1060\"\r\n                                            />\r\n                                        </div>\r\n\r\n                                        <div>\r\n                                            <Label className=\"text-xs font-medium text-gray-700 dark:text-gray-300 mb-1.5 block\">\r\n                                                Teléfono\r\n                                            </Label>\r\n                                            <input\r\n                                                type=\"tel\"\r\n                                                value={formData.telefono}\r\n                                                onChange={(e) => setFormData({ ...formData, telefono: e.target.value })}\r\n                                                className=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none\"\r\n                                                placeholder=\"+58 412 1234567\"\r\n                                            />\r\n                                        </div>\r\n\r\n                                        {/* Notas */}\r\n                                        <div className=\"col-span-2\">\r\n                                            <Label className=\"text-xs font-medium text-gray-700 dark:text-gray-300 mb-1.5 block\">\r\n                                                Notas Internas\r\n                                            </Label>\r\n                                            <textarea\r\n                                                value={formData.notas}\r\n                                                onChange={(e) => setFormData({ ...formData, notas: e.target.value })}\r\n                                                rows={2}\r\n                                                className=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none resize-none\"\r\n                                                placeholder=\"Información adicional sobre este consultorio...\"\r\n                                            />\r\n                                        </div>\r\n\r\n                                        {/* Checkboxes */}\r\n                                        <div className=\"col-span-2 flex gap-4 mt-2\">\r\n                                            <label className=\"flex items-center gap-2 cursor-pointer\">\r\n                                                <input\r\n                                                    type=\"checkbox\"\r\n                                                    checked={formData.es_principal}\r\n                                                    onChange={(e) => setFormData({ ...formData, es_principal: e.target.checked })}\r\n                                                    className=\"rounded border-gray-300 text-blue-600 focus:ring-blue-500\"\r\n                                                />\r\n                                                <span className=\"text-xs text-gray-700 dark:text-gray-300 font-medium\">Consultorio Principal</span>\r\n                                            </label>\r\n                                            <label className=\"flex items-center gap-2 cursor-pointer\">\r\n                                                <input\r\n                                                    type=\"checkbox\"\r\n                                                    checked={formData.activo}\r\n                                                    onChange={(e) => setFormData({ ...formData, activo: e.target.checked })}\r\n                                                    className=\"rounded border-gray-300 text-blue-600 focus:ring-blue-500\"\r\n                                                />\r\n                                                <span className=\"text-xs text-gray-700 dark:text-gray-300 font-medium\">Activo</span>\r\n                                            </label>\r\n                                        </div>\r\n                                    </div>\r\n                                </TabsContent>\r\n\r\n                                {/* TAB: AMENITIES */}\r\n                                <TabsContent value=\"amenities\" className=\"mt-0\">\r\n                                    <OfficeAmenities\r\n                                        value={formData.amenities}\r\n                                        onChange={(val) => setFormData({ ...formData, amenities: val })}\r\n                                    />\r\n                                </TabsContent>\r\n\r\n                                {/* TAB: PRICING */}\r\n                                <TabsContent value=\"pricing\" className=\"mt-0 space-y-6\">\r\n                                    <OfficePricing\r\n                                        officeId={formData.id}\r\n                                        value={formData.price_info}\r\n                                        onChange={(val) => setFormData({ ...formData, price_info: val })}\r\n                                    />\r\n                                </TabsContent>\r\n\r\n                                {/* TAB: PATIENTS */}\r\n                                <TabsContent value=\"patients\" className=\"mt-0 space-y-6\">\r\n                                    <div className=\"bg-white dark:bg-gray-800 rounded-lg border dark:border-gray-700 p-6 shadow-sm\">\r\n                                        <OfficeAgeGroups\r\n                                            officeId={formData.id}\r\n                                            // Si estamos creando, guardamos en el estado local temporalmente\r\n                                            value={formData.patient_age_groups}\r\n                                            onChange={(groups) => setFormData({ ...formData, patient_age_groups: groups })}\r\n                                        />\r\n                                    </div>\r\n                                </TabsContent>\r\n\r\n                                {/* TAB: INSTRUCTIONS */}\r\n                                <TabsContent value=\"instructions\" className=\"mt-0 space-y-6\">\r\n                                    <OfficeInstructions\r\n                                        instructions={formData.arrival_instructions}\r\n                                        receptionInfo={formData.reception_info}\r\n                                        onChange={(instr, rec) => setFormData({\r\n                                            ...formData,\r\n                                            arrival_instructions: instr,\r\n                                            reception_info: rec\r\n                                        })}\r\n                                    />\r\n                                </TabsContent>\r\n\r\n                                {/* TAB: PHOTOS */}\r\n                                <TabsContent value=\"photos\" className=\"mt-0\">\r\n                                    {editing ? (\r\n                                        <OfficePhotos\r\n                                            officeId={editing}\r\n                                        />\r\n                                    ) : (\r\n                                        <div className=\"text-center py-12 border-2 border-dashed border-gray-200 dark:border-gray-800 rounded-lg\">\r\n                                            <p className=\"text-sm text-gray-500\">\r\n                                                Guarda el consultorio primero para habilitar la subida de fotos.\r\n                                            </p>\r\n                                        </div>\r\n                                    )}\r\n                                </TabsContent>\r\n                            </Tabs>\r\n\r\n                            {/* Actions */}\r\n                            <div className=\"flex justify-end gap-2 mt-6 pt-4 border-t border-gray-200 dark:border-gray-700\">\r\n                                <Button\r\n                                    variant=\"ghost\"\r\n                                    size=\"sm\"\r\n                                    onClick={handleCancel}\r\n                                    disabled={saving}\r\n                                >\r\n                                    Cancelar\r\n                                </Button>\r\n                                <Button\r\n                                    size=\"sm\"\r\n                                    onClick={handleSave}\r\n                                    disabled={saving}\r\n                                    className=\"bg-blue-600 hover:bg-blue-700 text-white\"\r\n                                >\r\n                                    {saving ? (\r\n                                        <>\r\n                                            <Loader2 className=\"h-4 w-4 mr-1 animate-spin\" />\r\n                                            Guardando...\r\n                                        </>\r\n                                    ) : (\r\n                                        <>\r\n                                            <Save className=\"h-4 w-4 mr-1\" />\r\n                                            Guardar Consultorio\r\n                                        </>\r\n                                    )}\r\n                                </Button>\r\n                            </div>\r\n                        </div>\r\n                    </motion.div>\r\n                )}\r\n            </AnimatePresence>\r\n\r\n            {/* Offices List */}\r\n            <div className=\"space-y-3\">\r\n                {offices.length === 0 ? (\r\n                    <div className=\"text-center py-12 border border-dashed border-gray-300 dark:border-gray-700 rounded-lg\">\r\n                        <Building2 className=\"h-12 w-12 text-gray-300 dark:text-gray-700 mx-auto mb-3\" />\r\n                        <p className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                            No tienes consultorios registrados\r\n                        </p>\r\n                        <p className=\"text-xs text-gray-400 dark:text-gray-500 mt-1\">\r\n                            Crea tu primer consultorio para comenzar\r\n                        </p>\r\n                    </div>\r\n                ) : (\r\n                    offices.map((office) => (\r\n                        <motion.div\r\n                            key={office.id}\r\n                            initial={{ opacity: 0, x: -10 }}\r\n                            animate={{ opacity: 1, x: 0 }}\r\n                            className={`\r\n                border rounded-lg p-4 transition-all\r\n                ${office.es_principal\r\n                                    ? 'border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-900/10'\r\n                                    : 'border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900'\r\n                                }\r\n                ${!office.activo && 'opacity-60'}\r\n              `}\r\n                        >\r\n                            <div className=\"flex items-start justify-between\">\r\n                                <div className=\"flex-1\">\r\n                                    <div className=\"flex items-center gap-2 mb-1\">\r\n                                        <MapPin className=\"h-4 w-4 text-gray-400\" />\r\n                                        <h4 className=\"font-semibold text-gray-900 dark:text-gray-100\">\r\n                                            {office.nombre}\r\n                                        </h4>\r\n                                        {office.es_principal && (\r\n                                            <Badge className=\"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 text-[10px] px-1.5 py-0\">\r\n                                                <Star className=\"h-2.5 w-2.5 mr-0.5\" />\r\n                                                Principal\r\n                                            </Badge>\r\n                                        )}\r\n                                        {!office.activo && (\r\n                                            <Badge variant=\"secondary\" className=\"text-[10px] px-1.5 py-0\">\r\n                                                Inactivo\r\n                                            </Badge>\r\n                                        )}\r\n                                        {/* Status de datos Premium */}\r\n                                        {office.amenities && Object.values(office.amenities).some(v => v) && (\r\n                                            <Badge variant=\"outline\" className=\"text-[10px] px-1.5 py-0 border-green-200 text-green-700 bg-green-50\">\r\n                                                +Servicios\r\n                                            </Badge>\r\n                                        )}\r\n                                    </div>\r\n                                    {office.direccion && (\r\n                                        <p className=\"text-xs text-gray-600 dark:text-gray-400\">\r\n                                            {office.direccion}\r\n                                            {office.ciudad && `, ${office.ciudad}`}\r\n                                            {office.estado && `, ${office.estado}`}\r\n                                        </p>\r\n                                    )}\r\n                                    <div className=\"flex gap-4 mt-2\">\r\n                                        {office.telefono && (\r\n                                            <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                                                ☎️ {office.telefono}\r\n                                            </p>\r\n                                        )}\r\n                                        {office.price_info?.consultation_fee && (\r\n                                            <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                                                💰 {office.price_info.price_currency} {office.price_info.consultation_fee}\r\n                                            </p>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"flex gap-1\">\r\n                                    <Button\r\n                                        variant=\"ghost\"\r\n                                        size=\"sm\"\r\n                                        onClick={() => startEdit(office)}\r\n                                        className=\"h-8 w-8 p-0\"\r\n                                    >\r\n                                        <Pencil className=\"h-3.5 w-3.5\" />\r\n                                    </Button>\r\n                                    <Button\r\n                                        variant=\"ghost\"\r\n                                        size=\"sm\"\r\n                                        onClick={() => handleDelete(office.id!)}\r\n                                        className=\"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20\"\r\n                                    >\r\n                                        <Trash2 className=\"h-3.5 w-3.5\" />\r\n                                    </Button>\r\n                                </div>\r\n                            </div>\r\n                        </motion.div>\r\n                    ))\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\configuracion\\preferences-section.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'motion' is defined but never used.","line":13,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Mail' is defined but never used.","line":22,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Clock' is defined but never used.","line":25,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'t' is assigned a value but never used.","line":34,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":34,"endColumn":14}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file preferences-section.tsx\r\n * @description Sección de preferencias del sistema para la página de configuración.\r\n * Incluye tema, idioma, zona horaria y preferencias de comunicación.\r\n * @module Configuracion\r\n * \r\n * @example\r\n * <PreferencesSection />\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { motion } from \"framer-motion\";\r\nimport { Label } from \"@red-salud/ui\";\r\nimport { usePreferences } from \"@/lib/contexts/preferences-context\";\r\nimport { useI18n } from \"@/lib/hooks/use-i18n\";\r\nimport {\r\n    Moon,\r\n    Sun,\r\n    Globe,\r\n    Bell,\r\n    Mail,\r\n    MessageSquare,\r\n    Palette,\r\n    Clock\r\n} from \"lucide-react\";\r\n\r\n/**\r\n * Componente de sección de preferencias del sistema.\r\n * Permite configurar tema, idioma, zona horaria y notificaciones.\r\n */\r\nexport function PreferencesSection() {\r\n    const { preferences, updatePreference } = usePreferences();\r\n    const { t } = useI18n();\r\n\r\n    // Determina el tema actual, resolviendo \"system\" al tema real\r\n    const theme = preferences.theme === \"system\"\r\n        ? (typeof window !== \"undefined\" && window.matchMedia(\"(prefers-color-scheme: dark)\").matches ? \"dark\" : \"light\")\r\n        : preferences.theme;\r\n\r\n    /** Alterna entre tema claro y oscuro */\r\n    const toggleTheme = () => {\r\n        const newTheme = theme === \"dark\" ? \"light\" : \"dark\";\r\n        updatePreference(\"theme\", newTheme);\r\n    };\r\n\r\n    /** Cambia el idioma de la aplicación */\r\n    const setLanguage = (lang: \"es\" | \"en\" | \"pt\" | \"fr\" | \"it\") => {\r\n        updatePreference(\"language\", lang);\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div>\r\n                <h2 className=\"text-xl font-semibold text-gray-900 dark:text-gray-100\">\r\n                    Preferencias del Sistema\r\n                </h2>\r\n                <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\r\n                    Personaliza la apariencia y comportamiento de la aplicación\r\n                </p>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n                {/* Columna izquierda: Apariencia y Regional */}\r\n                <div className=\"space-y-6\">\r\n                    {/* Apariencia */}\r\n                    <div className=\"border dark:border-gray-700 rounded-lg p-4\">\r\n                        <div className=\"flex items-center gap-2 mb-4\">\r\n                            <div className=\"p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg\">\r\n                                <Palette className=\"h-4 w-4 text-purple-600 dark:text-purple-400\" />\r\n                            </div>\r\n                            <h3 className=\"font-semibold text-gray-900 dark:text-gray-100\">\r\n                                Apariencia\r\n                            </h3>\r\n                        </div>\r\n\r\n                        {/* Toggle de tema */}\r\n                        <div className=\"flex items-center justify-between p-3 rounded-lg bg-gray-50 dark:bg-gray-800\">\r\n                            <div className=\"flex items-center gap-3\">\r\n                                {theme === \"dark\" ? (\r\n                                    <Moon className=\"h-5 w-5 text-gray-600 dark:text-gray-400\" />\r\n                                ) : (\r\n                                    <Sun className=\"h-5 w-5 text-gray-600 dark:text-gray-400\" />\r\n                                )}\r\n                                <div>\r\n                                    <p className=\"text-sm font-medium text-gray-900 dark:text-gray-100\">\r\n                                        Tema de la Interfaz\r\n                                    </p>\r\n                                    <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                                        {theme === \"dark\" ? \"Modo Oscuro activado\" : \"Modo Claro activado\"}\r\n                                    </p>\r\n                                </div>\r\n                            </div>\r\n                            <label className=\"relative inline-flex items-center cursor-pointer\">\r\n                                <input\r\n                                    type=\"checkbox\"\r\n                                    className=\"sr-only peer\"\r\n                                    checked={theme === \"dark\"}\r\n                                    onChange={toggleTheme}\r\n                                    aria-label=\"Activar modo oscuro\"\r\n                                />\r\n                                <div className=\"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600\"></div>\r\n                            </label>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Configuración Regional */}\r\n                    <div className=\"border dark:border-gray-700 rounded-lg p-4\">\r\n                        <div className=\"flex items-center gap-2 mb-4\">\r\n                            <div className=\"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg\">\r\n                                <Globe className=\"h-4 w-4 text-blue-600 dark:text-blue-400\" />\r\n                            </div>\r\n                            <h3 className=\"font-semibold text-gray-900 dark:text-gray-100\">\r\n                                Configuración Regional\r\n                            </h3>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-4\">\r\n                            {/* Idioma */}\r\n                            <div>\r\n                                <Label htmlFor=\"idioma\" className=\"mb-2 block dark:text-gray-100\">\r\n                                    Idioma de la Aplicación\r\n                                </Label>\r\n                                <select\r\n                                    id=\"idioma\"\r\n                                    value={preferences.language}\r\n                                    onChange={(e) => setLanguage(e.target.value as \"es\" | \"en\" | \"pt\" | \"fr\" | \"it\")}\r\n                                    className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:text-gray-100\"\r\n                                    aria-label=\"Seleccionar idioma\"\r\n                                >\r\n                                    <option value=\"es\">Español</option>\r\n                                    <option value=\"en\">English</option>\r\n                                    <option value=\"pt\">Português</option>\r\n                                    <option value=\"fr\">Français</option>\r\n                                    <option value=\"it\">Italiano</option>\r\n                                </select>\r\n                            </div>\r\n\r\n                            {/* Zona horaria */}\r\n                            <div>\r\n                                <Label htmlFor=\"zona\" className=\"mb-2 block dark:text-gray-100\">\r\n                                    Zona Horaria\r\n                                </Label>\r\n                                <select\r\n                                    id=\"zona\"\r\n                                    value={preferences.timezone}\r\n                                    onChange={(e) => updatePreference(\"timezone\", e.target.value)}\r\n                                    className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:text-gray-100\"\r\n                                    aria-label=\"Seleccionar zona horaria\"\r\n                                >\r\n                                    <option value=\"America/Caracas\">Venezuela (GMT-4)</option>\r\n                                    <option value=\"America/Bogota\">Colombia (GMT-5)</option>\r\n                                    <option value=\"America/Lima\">Perú (GMT-5)</option>\r\n                                    <option value=\"America/Mexico_City\">México (GMT-6)</option>\r\n                                    <option value=\"America/Buenos_Aires\">Argentina (GMT-3)</option>\r\n                                    <option value=\"America/Santiago\">Chile (GMT-3)</option>\r\n                                    <option value=\"America/Sao_Paulo\">Brasil (GMT-3)</option>\r\n                                </select>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Columna derecha: Notificaciones y Comunicación */}\r\n                <div className=\"space-y-6\">\r\n                    {/* Notificaciones del Sistema */}\r\n                    <div className=\"border dark:border-gray-700 rounded-lg p-4\">\r\n                        <div className=\"flex items-center gap-2 mb-4\">\r\n                            <div className=\"p-2 bg-orange-100 dark:bg-orange-900/30 rounded-lg\">\r\n                                <Bell className=\"h-4 w-4 text-orange-600 dark:text-orange-400\" />\r\n                            </div>\r\n                            <h3 className=\"font-semibold text-gray-900 dark:text-gray-100\">\r\n                                Notificaciones del Sistema\r\n                            </h3>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-3\">\r\n                            {/* Notificaciones de escritorio */}\r\n                            <div className=\"flex items-center justify-between p-3 rounded-lg bg-gray-50 dark:bg-gray-800\">\r\n                                <div>\r\n                                    <p className=\"text-sm font-medium text-gray-900 dark:text-gray-100\">\r\n                                        Notificaciones de Escritorio\r\n                                    </p>\r\n                                    <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                                        Recibe alertas en tu navegador\r\n                                    </p>\r\n                                </div>\r\n                                <label className=\"relative inline-flex items-center cursor-pointer\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        className=\"sr-only peer\"\r\n                                        checked={preferences.desktopNotifications}\r\n                                        onChange={(e) => updatePreference(\"desktopNotifications\", e.target.checked)}\r\n                                        aria-label=\"Activar notificaciones de escritorio\"\r\n                                    />\r\n                                    <div className=\"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600\"></div>\r\n                                </label>\r\n                            </div>\r\n\r\n                            {/* Sonidos */}\r\n                            <div className=\"flex items-center justify-between p-3 rounded-lg bg-gray-50 dark:bg-gray-800\">\r\n                                <div>\r\n                                    <p className=\"text-sm font-medium text-gray-900 dark:text-gray-100\">\r\n                                        Sonidos de Notificación\r\n                                    </p>\r\n                                    <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                                        Reproduce sonidos para alertas\r\n                                    </p>\r\n                                </div>\r\n                                <label className=\"relative inline-flex items-center cursor-pointer\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        className=\"sr-only peer\"\r\n                                        checked={preferences.soundNotifications}\r\n                                        onChange={(e) => updatePreference(\"soundNotifications\", e.target.checked)}\r\n                                        aria-label=\"Activar sonidos de notificación\"\r\n                                    />\r\n                                    <div className=\"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600\"></div>\r\n                                </label>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Preferencias de Comunicación */}\r\n                    <div className=\"border dark:border-gray-700 rounded-lg p-4\">\r\n                        <div className=\"flex items-center gap-2 mb-4\">\r\n                            <div className=\"p-2 bg-green-100 dark:bg-green-900/30 rounded-lg\">\r\n                                <MessageSquare className=\"h-4 w-4 text-green-600 dark:text-green-400\" />\r\n                            </div>\r\n                            <h3 className=\"font-semibold text-gray-900 dark:text-gray-100\">\r\n                                Preferencias de Comunicación\r\n                            </h3>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-4\">\r\n                            {/* Método de contacto preferido */}\r\n                            <div>\r\n                                <Label htmlFor=\"metodoContacto\" className=\"mb-2 block dark:text-gray-100\">\r\n                                    Método de Contacto Preferido\r\n                                </Label>\r\n                                <select\r\n                                    id=\"metodoContacto\"\r\n                                    value={preferences.preferredContactMethod}\r\n                                    onChange={(e) => updatePreference(\"preferredContactMethod\", e.target.value as \"email\" | \"sms\" | \"whatsapp\" | \"phone\")}\r\n                                    className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:text-gray-100\"\r\n                                    aria-label=\"Seleccionar método de contacto\"\r\n                                >\r\n                                    <option value=\"email\">Correo Electrónico</option>\r\n                                    <option value=\"sms\">SMS</option>\r\n                                    <option value=\"whatsapp\">WhatsApp</option>\r\n                                    <option value=\"phone\">Llamada Telefónica</option>\r\n                                </select>\r\n                            </div>\r\n\r\n                            {/* Boletín informativo */}\r\n                            <div className=\"flex items-center justify-between p-3 rounded-lg bg-gray-50 dark:bg-gray-800\">\r\n                                <div>\r\n                                    <p className=\"text-sm font-medium text-gray-900 dark:text-gray-100\">\r\n                                        Boletín Informativo\r\n                                    </p>\r\n                                    <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                                        Novedades y actualizaciones de la plataforma\r\n                                    </p>\r\n                                </div>\r\n                                <label className=\"relative inline-flex items-center cursor-pointer\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        className=\"sr-only peer\"\r\n                                        checked={preferences.newsletterSubscribed}\r\n                                        onChange={(e) => updatePreference(\"newsletterSubscribed\", e.target.checked)}\r\n                                        aria-label=\"Suscribirse al boletín\"\r\n                                    />\r\n                                    <div className=\"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600\"></div>\r\n                                </label>\r\n                            </div>\r\n\r\n                            {/* Promociones */}\r\n                            <div className=\"flex items-center justify-between p-3 rounded-lg bg-gray-50 dark:bg-gray-800\">\r\n                                <div>\r\n                                    <p className=\"text-sm font-medium text-gray-900 dark:text-gray-100\">\r\n                                        Ofertas y Promociones\r\n                                    </p>\r\n                                    <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                                        Descuentos y ofertas especiales\r\n                                    </p>\r\n                                </div>\r\n                                <label className=\"relative inline-flex items-center cursor-pointer\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        className=\"sr-only peer\"\r\n                                        checked={preferences.promotionsSubscribed}\r\n                                        onChange={(e) => updatePreference(\"promotionsSubscribed\", e.target.checked)}\r\n                                        aria-label=\"Recibir promociones\"\r\n                                    />\r\n                                    <div className=\"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600\"></div>\r\n                                </label>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Tip informativo */}\r\n                    <aside className=\"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4\">\r\n                        <p className=\"text-sm text-blue-800 dark:text-blue-300\">\r\n                            <strong>Tip:</strong> Puedes configurar recordatorios específicos para citas en la sección de Notificaciones.\r\n                        </p>\r\n                    </aside>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\configuracion\\privacy-section.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\configuracion\\profile-section-v2\\EnhancedBioEditor.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Award' is defined but never used.","line":17,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":8},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Languages' is defined but never used.","line":18,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Target' is defined but never used.","line":19,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":9}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file EnhancedBioEditor.tsx\r\n * @description Editor de biografía mejorado con análisis en tiempo real y sugerencias de IA\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useState, useEffect, useCallback } from \"react\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport {\r\n  Sparkles,\r\n  Loader2,\r\n  CheckCircle,\r\n  AlertCircle,\r\n  TrendingUp,\r\n  FileText,\r\n  Award,\r\n  Languages,\r\n  Target,\r\n  Lightbulb,\r\n} from \"lucide-react\";\r\nimport { Label } from \"@red-salud/ui\";\r\nimport { Textarea } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport type { BioAnalysis } from \"./types\";\r\n\r\ninterface EnhancedBioEditorProps {\r\n  value: string;\r\n  onChange: (value: string) => void;\r\n  specialty: string;\r\n  doctorName: string;\r\n}\r\n\r\nexport function EnhancedBioEditor({\r\n  value,\r\n  onChange,\r\n  specialty,\r\n  doctorName,\r\n}: EnhancedBioEditorProps) {\r\n  const [improving, setImproving] = useState(false);\r\n  const [analysis, setAnalysis] = useState<BioAnalysis | null>(null);\r\n  const [showSuggestions, setShowSuggestions] = useState(false);\r\n\r\n  /**\r\n   * Analiza la biografía en tiempo real\r\n   */\r\n  const analyzeBio = useCallback((text: string): BioAnalysis => {\r\n    const wordCount = text.trim().split(/\\s+/).filter(Boolean).length;\r\n    const sentences = text.split(/[.!?]+/).filter(Boolean);\r\n    \r\n    // Análisis de legibilidad (Flesch Reading Ease simplificado)\r\n    const avgWordsPerSentence = sentences.length > 0 ? wordCount / sentences.length : 0;\r\n    const readabilityScore = Math.max(0, Math.min(100, 100 - (avgWordsPerSentence * 2)));\r\n\r\n    // Detectar elementos clave\r\n    const hasCredentials = /certificad|diplomad|maestr|doctor|especialista|título/i.test(text);\r\n    const hasExperience = /año|experiencia|práctica|atención|paciente/i.test(text);\r\n    const hasSpecialties = /especializ|enfoque|área|interés/i.test(text);\r\n\r\n    // Generar sugerencias\r\n    const suggestions: string[] = [];\r\n    \r\n    if (wordCount < 50) {\r\n      suggestions.push(\"Agrega más detalles sobre tu formación y experiencia\");\r\n    }\r\n    if (!hasCredentials) {\r\n      suggestions.push(\"Menciona tus certificaciones o títulos académicos\");\r\n    }\r\n    if (!hasExperience) {\r\n      suggestions.push(\"Incluye tus años de experiencia y áreas de práctica\");\r\n    }\r\n    if (!hasSpecialties) {\r\n      suggestions.push(\"Describe tus áreas de especialización o interés\");\r\n    }\r\n    if (wordCount > 300) {\r\n      suggestions.push(\"Considera acortar el texto para mejor legibilidad\");\r\n    }\r\n    if (avgWordsPerSentence > 25) {\r\n      suggestions.push(\"Usa oraciones más cortas para mejorar la claridad\");\r\n    }\r\n\r\n    return {\r\n      wordCount,\r\n      readabilityScore,\r\n      hasCredentials,\r\n      hasExperience,\r\n      hasSpecialties,\r\n      suggestions,\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (value) {\r\n      const result = analyzeBio(value);\r\n      setAnalysis(result);\r\n    } else {\r\n      setAnalysis(null);\r\n    }\r\n  }, [value, analyzeBio]);\r\n\r\n  /**\r\n   * Mejora la biografía con IA\r\n   */\r\n  const handleImprove = async () => {\r\n    if (!value || value.length < 20) {\r\n      return;\r\n    }\r\n\r\n    setImproving(true);\r\n    try {\r\n      const response = await fetch(\"/api/ai/improve-bio\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({\r\n          biografia: value,\r\n          nombre: doctorName,\r\n          especialidad: specialty,\r\n        }),\r\n      });\r\n\r\n      if (!response.ok) throw new Error(\"Error al mejorar la biografía\");\r\n\r\n      const data = await response.json();\r\n      if (data.improved_bio) {\r\n        onChange(data.improved_bio);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"[EnhancedBioEditor] Error:\", error);\r\n    } finally {\r\n      setImproving(false);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Aplica un template de biografía\r\n   */\r\n  const applyTemplate = () => {\r\n    const template = `Soy ${doctorName}, especialista en ${specialty || \"medicina\"} con amplia experiencia en la atención de pacientes.\r\n\r\nMi enfoque se centra en brindar atención médica de calidad, combinando conocimientos actualizados con un trato humano y personalizado.\r\n\r\nCuento con formación especializada y me mantengo en constante actualización para ofrecer las mejores opciones de tratamiento a mis pacientes.`;\r\n\r\n    onChange(template);\r\n  };\r\n\r\n  const getQualityColor = () => {\r\n    if (!analysis) return \"text-gray-400\";\r\n    const score = (\r\n      (analysis.wordCount >= 50 && analysis.wordCount <= 300 ? 25 : 0) +\r\n      (analysis.hasCredentials ? 25 : 0) +\r\n      (analysis.hasExperience ? 25 : 0) +\r\n      (analysis.hasSpecialties ? 25 : 0)\r\n    );\r\n\r\n    if (score >= 75) return \"text-green-500\";\r\n    if (score >= 50) return \"text-yellow-500\";\r\n    return \"text-red-500\";\r\n  };\r\n\r\n  const getQualityLabel = () => {\r\n    if (!analysis) return \"Sin analizar\";\r\n    const score = (\r\n      (analysis.wordCount >= 50 && analysis.wordCount <= 300 ? 25 : 0) +\r\n      (analysis.hasCredentials ? 25 : 0) +\r\n      (analysis.hasExperience ? 25 : 0) +\r\n      (analysis.hasSpecialties ? 25 : 0)\r\n    );\r\n\r\n    if (score >= 75) return \"Excelente\";\r\n    if (score >= 50) return \"Buena\";\r\n    if (score >= 25) return \"Mejorable\";\r\n    return \"Básica\";\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <Label htmlFor=\"biografia\" className=\"text-base font-semibold\">\r\n          Biografía Profesional\r\n        </Label>\r\n        <div className=\"flex items-center gap-2\">\r\n          {value.length === 0 && (\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"ghost\"\r\n              size=\"sm\"\r\n              onClick={applyTemplate}\r\n              className=\"text-blue-600 hover:text-blue-700 hover:bg-blue-50 dark:text-blue-400 dark:hover:bg-blue-900/20\"\r\n            >\r\n              <FileText className=\"h-4 w-4 mr-1.5\" />\r\n              Usar Template\r\n            </Button>\r\n          )}\r\n          <Button\r\n            type=\"button\"\r\n            variant=\"ghost\"\r\n            size=\"sm\"\r\n            onClick={handleImprove}\r\n            disabled={improving || value.length < 20}\r\n            className=\"text-purple-600 hover:text-purple-700 hover:bg-purple-50 dark:text-purple-400 dark:hover:bg-purple-900/20\"\r\n          >\r\n            {improving ? (\r\n              <>\r\n                <Loader2 className=\"h-4 w-4 mr-1.5 animate-spin\" />\r\n                Mejorando...\r\n              </>\r\n            ) : (\r\n              <>\r\n                <Sparkles className=\"h-4 w-4 mr-1.5\" />\r\n                Mejorar con IA\r\n              </>\r\n            )}\r\n          </Button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Editor */}\r\n      <div className=\"relative\">\r\n        <Textarea\r\n          id=\"biografia\"\r\n          value={value}\r\n          onChange={(e) => onChange(e.target.value)}\r\n          placeholder=\"Cuéntanos sobre tu experiencia, formación y enfoque profesional...\r\n\r\nEjemplo:\r\n• Tu especialidad y años de experiencia\r\n• Formación académica y certificaciones\r\n• Áreas de interés o subespecialidades\r\n• Enfoque de atención al paciente\r\n• Idiomas que hablas\"\r\n          rows={8}\r\n          className=\"resize-none text-sm leading-relaxed\"\r\n        />\r\n        \r\n        {/* Contador de palabras */}\r\n        <div className=\"absolute bottom-3 right-3 flex items-center gap-2\">\r\n          <Badge\r\n            variant=\"secondary\"\r\n            className={cn(\r\n              \"text-xs\",\r\n              analysis && analysis.wordCount < 50 && \"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400\",\r\n              analysis && analysis.wordCount >= 50 && analysis.wordCount <= 300 && \"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400\",\r\n              analysis && analysis.wordCount > 300 && \"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400\"\r\n            )}\r\n          >\r\n            {analysis?.wordCount || 0} palabras\r\n          </Badge>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Análisis en tiempo real */}\r\n      <AnimatePresence>\r\n        {analysis && value.length > 0 && (\r\n          <motion.div\r\n            initial={{ opacity: 0, y: -10 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            exit={{ opacity: 0, y: -10 }}\r\n            className=\"space-y-3\"\r\n          >\r\n            {/* Barra de calidad */}\r\n            <div className=\"p-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg border border-gray-200 dark:border-gray-700\">\r\n              <div className=\"flex items-center justify-between mb-3\">\r\n                <span className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\r\n                  Calidad de la Biografía\r\n                </span>\r\n                <span className={cn(\"text-sm font-semibold\", getQualityColor())}>\r\n                  {getQualityLabel()}\r\n                </span>\r\n              </div>\r\n\r\n              {/* Indicadores */}\r\n              <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  {analysis.wordCount >= 50 && analysis.wordCount <= 300 ? (\r\n                    <CheckCircle className=\"h-4 w-4 text-green-500\" />\r\n                  ) : (\r\n                    <AlertCircle className=\"h-4 w-4 text-gray-400\" />\r\n                  )}\r\n                  <span className=\"text-xs text-gray-600 dark:text-gray-400\">\r\n                    Longitud óptima\r\n                  </span>\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-2\">\r\n                  {analysis.hasCredentials ? (\r\n                    <CheckCircle className=\"h-4 w-4 text-green-500\" />\r\n                  ) : (\r\n                    <AlertCircle className=\"h-4 w-4 text-gray-400\" />\r\n                  )}\r\n                  <span className=\"text-xs text-gray-600 dark:text-gray-400\">\r\n                    Credenciales\r\n                  </span>\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-2\">\r\n                  {analysis.hasExperience ? (\r\n                    <CheckCircle className=\"h-4 w-4 text-green-500\" />\r\n                  ) : (\r\n                    <AlertCircle className=\"h-4 w-4 text-gray-400\" />\r\n                  )}\r\n                  <span className=\"text-xs text-gray-600 dark:text-gray-400\">\r\n                    Experiencia\r\n                  </span>\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-2\">\r\n                  {analysis.hasSpecialties ? (\r\n                    <CheckCircle className=\"h-4 w-4 text-green-500\" />\r\n                  ) : (\r\n                    <AlertCircle className=\"h-4 w-4 text-gray-400\" />\r\n                  )}\r\n                  <span className=\"text-xs text-gray-600 dark:text-gray-400\">\r\n                    Especialidades\r\n                  </span>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Legibilidad */}\r\n              <div className=\"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700\">\r\n                <div className=\"flex items-center justify-between text-xs\">\r\n                  <span className=\"text-gray-600 dark:text-gray-400\">Legibilidad</span>\r\n                  <span className=\"font-medium text-gray-700 dark:text-gray-300\">\r\n                    {Math.round(analysis.readabilityScore)}/100\r\n                  </span>\r\n                </div>\r\n                <div className=\"mt-2 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden\">\r\n                  <motion.div\r\n                    initial={{ width: 0 }}\r\n                    animate={{ width: `${analysis.readabilityScore}%` }}\r\n                    transition={{ duration: 0.5 }}\r\n                    className={cn(\r\n                      \"h-full rounded-full\",\r\n                      analysis.readabilityScore >= 70 && \"bg-green-500\",\r\n                      analysis.readabilityScore >= 40 && analysis.readabilityScore < 70 && \"bg-yellow-500\",\r\n                      analysis.readabilityScore < 40 && \"bg-red-500\"\r\n                    )}\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Sugerencias */}\r\n            {analysis.suggestions.length > 0 && (\r\n              <div className=\"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800\">\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => setShowSuggestions(!showSuggestions)}\r\n                  className=\"flex items-center justify-between w-full text-left\"\r\n                >\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Lightbulb className=\"h-4 w-4 text-blue-600 dark:text-blue-400\" />\r\n                    <span className=\"text-sm font-medium text-blue-700 dark:text-blue-300\">\r\n                      Sugerencias de Mejora ({analysis.suggestions.length})\r\n                    </span>\r\n                  </div>\r\n                  <motion.div\r\n                    animate={{ rotate: showSuggestions ? 180 : 0 }}\r\n                    transition={{ duration: 0.2 }}\r\n                  >\r\n                    <TrendingUp className=\"h-4 w-4 text-blue-600 dark:text-blue-400\" />\r\n                  </motion.div>\r\n                </button>\r\n\r\n                <AnimatePresence>\r\n                  {showSuggestions && (\r\n                    <motion.ul\r\n                      initial={{ opacity: 0, height: 0 }}\r\n                      animate={{ opacity: 1, height: \"auto\" }}\r\n                      exit={{ opacity: 0, height: 0 }}\r\n                      className=\"mt-3 space-y-2\"\r\n                    >\r\n                      {analysis.suggestions.map((suggestion, index) => (\r\n                        <motion.li\r\n                          key={index}\r\n                          initial={{ opacity: 0, x: -10 }}\r\n                          animate={{ opacity: 1, x: 0 }}\r\n                          transition={{ delay: index * 0.1 }}\r\n                          className=\"flex items-start gap-2 text-sm text-blue-600 dark:text-blue-400\"\r\n                        >\r\n                          <span className=\"text-blue-400 dark:text-blue-500 mt-0.5\">•</span>\r\n                          <span>{suggestion}</span>\r\n                        </motion.li>\r\n                      ))}\r\n                    </motion.ul>\r\n                  )}\r\n                </AnimatePresence>\r\n              </div>\r\n            )}\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n\r\n      {/* Ayuda */}\r\n      <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n        💡 Esta información será visible para tus pacientes. Una biografía completa aumenta la confianza y las conversiones hasta un 40%.\r\n      </p>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\configuracion\\profile-section-v2\\FieldWithContext.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[744,747],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[744,747],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1628,1631],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1628,1631],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file FieldWithContext.tsx\r\n * @description Campo de formulario con contexto educativo, validación visual y tooltips\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport {\r\n  Lock,\r\n  CheckCircle,\r\n  AlertCircle,\r\n  Info,\r\n  TrendingUp,\r\n  ChevronDown,\r\n  ChevronUp,\r\n} from \"lucide-react\";\r\nimport { Label } from \"@red-salud/ui\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { PhoneInput } from \"@red-salud/ui\";\r\nimport { SpecialtyCombobox } from \"@red-salud/ui\";\r\nimport { SpecialtyMultiSelect } from \"@red-salud/ui\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\ninterface FieldWithContextProps {\r\n  label: string;\r\n  value: string | string[];\r\n  onChange?: (value: any) => void;\r\n  type?: \"text\" | \"email\" | \"phone\" | \"specialty\" | \"multi-specialty\";\r\n  locked?: boolean;\r\n  verified?: boolean;\r\n  contextInfo?: string;\r\n  impact?: string;\r\n  allowedValues?: string[];\r\n  placeholder?: string;\r\n  error?: string;\r\n  warning?: string;\r\n}\r\n\r\nconst FieldWithContext = ({\r\n  label,\r\n  value,\r\n  onChange,\r\n  type = \"text\",\r\n  locked = false,\r\n  verified = false,\r\n  contextInfo,\r\n  impact,\r\n  allowedValues,\r\n  placeholder,\r\n  error,\r\n  warning,\r\n}: FieldWithContextProps) => {\r\n  const [showContext, setShowContext] = useState(false);\r\n  const [isFocused, setIsFocused] = useState(false);\r\n\r\n  const hasValue = Array.isArray(value) ? value.length > 0 : Boolean(value);\r\n  const showImpact = impact && hasValue && !locked;\r\n\r\n  const renderInput = () => {\r\n    const commonProps = {\r\n      value: Array.isArray(value) ? \"\" : value,\r\n      onChange: (e: any) => onChange?.(e.target?.value || e),\r\n      disabled: locked,\r\n      placeholder,\r\n      onFocus: () => setIsFocused(true),\r\n      onBlur: () => setIsFocused(false),\r\n      className: cn(\r\n        \"transition-all duration-200\",\r\n        locked && \"bg-gray-50 dark:bg-gray-800 cursor-not-allowed\",\r\n        error && \"border-red-500 focus:ring-red-500\",\r\n        warning && \"border-yellow-500 focus:ring-yellow-500\",\r\n        hasValue && !error && !warning && \"border-green-500\",\r\n        isFocused && \"ring-2 ring-blue-500/20\"\r\n      ),\r\n    };\r\n\r\n    switch (type) {\r\n      case \"phone\":\r\n        return (\r\n          <PhoneInput\r\n            value={value as string}\r\n            onChange={(val) => onChange?.(val)}\r\n            disabled={locked}\r\n          />\r\n        );\r\n\r\n      case \"specialty\":\r\n        return (\r\n          <SpecialtyCombobox\r\n            value={value as string}\r\n            onChange={(val) => onChange?.(val)}\r\n            allowedSpecialties={allowedValues || []}\r\n            readOnly={locked}\r\n            placeholder={placeholder || \"Seleccionar especialidad\"}\r\n          />\r\n        );\r\n\r\n      case \"multi-specialty\":\r\n        return (\r\n          <SpecialtyMultiSelect\r\n            selected={(value as string[]) || []}\r\n            onChange={(val) => onChange?.(val)}\r\n            placeholder={placeholder || \"Buscar especialidades\"}\r\n            readOnly={locked}\r\n          />\r\n        );\r\n\r\n      case \"email\":\r\n        return <Input {...commonProps} type=\"email\" />;\r\n\r\n      default:\r\n        return <Input {...commonProps} type=\"text\" />;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-2\">\r\n      {/* Label con iconos de estado */}\r\n      <div className=\"flex items-center justify-between flex-wrap gap-2\">\r\n        <Label className=\"flex items-center gap-2 flex-wrap\">\r\n          <span className=\"font-medium\">{label}</span>\r\n          \r\n          {locked && (\r\n            <div className=\"flex items-center gap-1 px-2 py-0.5 rounded-full bg-gray-100 dark:bg-gray-800\">\r\n              <Lock className=\"h-3 w-3 text-gray-500\" />\r\n              <span className=\"text-xs text-gray-600 dark:text-gray-400\">Bloqueado</span>\r\n            </div>\r\n          )}\r\n          \r\n          {verified && (\r\n            <motion.div\r\n              initial={{ scale: 0 }}\r\n              animate={{ scale: 1 }}\r\n              transition={{ type: \"spring\" }}\r\n              className=\"flex items-center gap-1 px-2 py-0.5 rounded-full bg-green-100 dark:bg-green-900/30\"\r\n            >\r\n              <CheckCircle className=\"h-3 w-3 text-green-600 dark:text-green-400\" />\r\n              <span className=\"text-xs text-green-700 dark:text-green-400 font-medium\">Verificado</span>\r\n            </motion.div>\r\n          )}\r\n\r\n          {(contextInfo || impact) && (\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => setShowContext(!showContext)}\r\n              className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800\"\r\n              title=\"Ver más información\"\r\n            >\r\n              <Info className=\"h-3.5 w-3.5\" />\r\n            </button>\r\n          )}\r\n        </Label>\r\n\r\n        {/* Estado visual */}\r\n        {!locked && (\r\n          <div className=\"flex items-center gap-1\">\r\n            {error && (\r\n              <span className=\"text-xs text-red-600 dark:text-red-400 flex items-center gap-1 px-2 py-0.5 rounded-full bg-red-50 dark:bg-red-900/20\">\r\n                <AlertCircle className=\"h-3 w-3\" />\r\n                <span className=\"hidden sm:inline\">Error</span>\r\n              </span>\r\n            )}\r\n            {warning && !error && (\r\n              <span className=\"text-xs text-yellow-600 dark:text-yellow-400 flex items-center gap-1 px-2 py-0.5 rounded-full bg-yellow-50 dark:bg-yellow-900/20\">\r\n                <AlertCircle className=\"h-3 w-3\" />\r\n                <span className=\"hidden sm:inline\">Advertencia</span>\r\n              </span>\r\n            )}\r\n            {hasValue && !error && !warning && (\r\n              <motion.span\r\n                initial={{ scale: 0 }}\r\n                animate={{ scale: 1 }}\r\n                className=\"text-xs text-green-600 dark:text-green-400 flex items-center gap-1 px-2 py-0.5 rounded-full bg-green-50 dark:bg-green-900/20\"\r\n              >\r\n                <CheckCircle className=\"h-3 w-3\" />\r\n                <span className=\"hidden sm:inline\">Válido</span>\r\n              </motion.span>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Input Field */}\r\n      <div className=\"relative\">\r\n        {renderInput()}\r\n        \r\n        {/* Indicador de focus */}\r\n        {isFocused && !locked && (\r\n          <motion.div\r\n            layoutId=\"focus-indicator\"\r\n            className=\"absolute inset-0 rounded-md border-2 border-blue-500 pointer-events-none\"\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            exit={{ opacity: 0 }}\r\n          />\r\n        )}\r\n      </div>\r\n\r\n      {/* Mensajes de error/warning */}\r\n      <AnimatePresence>\r\n        {error && (\r\n          <motion.div\r\n            initial={{ opacity: 0, y: -10 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            exit={{ opacity: 0, y: -10 }}\r\n            className=\"flex items-start gap-2 text-sm text-red-600 dark:text-red-400\"\r\n          >\r\n            <AlertCircle className=\"h-4 w-4 flex-shrink-0 mt-0.5\" />\r\n            <span>{error}</span>\r\n          </motion.div>\r\n        )}\r\n\r\n        {warning && !error && (\r\n          <motion.div\r\n            initial={{ opacity: 0, y: -10 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            exit={{ opacity: 0, y: -10 }}\r\n            className=\"flex items-start gap-2 text-sm text-yellow-600 dark:text-yellow-400\"\r\n          >\r\n            <AlertCircle className=\"h-4 w-4 flex-shrink-0 mt-0.5\" />\r\n            <span>{warning}</span>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n\r\n      {/* Contexto expandible */}\r\n      <AnimatePresence>\r\n        {showContext && (contextInfo || impact) && (\r\n          <motion.div\r\n            initial={{ opacity: 0, height: 0 }}\r\n            animate={{ opacity: 1, height: \"auto\" }}\r\n            exit={{ opacity: 0, height: 0 }}\r\n            transition={{ duration: 0.2 }}\r\n            className=\"overflow-hidden\"\r\n          >\r\n            <div className=\"space-y-2 pt-2\">\r\n              {/* Información contextual */}\r\n              {contextInfo && (\r\n                <div className=\"flex items-start gap-2 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800\">\r\n                  <Info className=\"h-4 w-4 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5\" />\r\n                  <div className=\"text-sm text-blue-700 dark:text-blue-300 min-w-0\">\r\n                    <p className=\"font-medium mb-1\">\r\n                      {locked ? \"¿Por qué está bloqueado?\" : \"¿Por qué es importante?\"}\r\n                    </p>\r\n                    <p className=\"text-blue-600 dark:text-blue-400 break-words\">{contextInfo}</p>\r\n                    {locked && (\r\n                      <p className=\"text-xs text-blue-500 dark:text-blue-500 mt-2 italic\">\r\n                        Este campo fue verificado automáticamente mediante el sistema SACS y no puede ser modificado manualmente.\r\n                      </p>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {/* Impacto */}\r\n              {showImpact && (\r\n                <motion.div\r\n                  initial={{ scale: 0.95 }}\r\n                  animate={{ scale: 1 }}\r\n                  className=\"flex items-start gap-2 p-3 bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-lg border border-green-200 dark:border-green-800\"\r\n                >\r\n                  <TrendingUp className=\"h-4 w-4 text-green-600 dark:text-green-400 flex-shrink-0 mt-0.5\" />\r\n                  <div className=\"text-sm text-green-700 dark:text-green-300\">\r\n                    <p className=\"font-medium mb-1\">💡 Impacto en tu perfil</p>\r\n                    <p className=\"text-green-600 dark:text-green-400\">{impact}</p>\r\n                  </div>\r\n                </motion.div>\r\n              )}\r\n            </div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n\r\n      {/* Toggle button para contexto */}\r\n      {(contextInfo || impact) && (\r\n        <button\r\n          type=\"button\"\r\n          onClick={() => setShowContext(!showContext)}\r\n          className=\"text-xs text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 flex items-center gap-1 transition-colors\"\r\n        >\r\n          {showContext ? (\r\n            <>\r\n              <ChevronUp className=\"h-3 w-3\" />\r\n              Ocultar información\r\n            </>\r\n          ) : (\r\n            <>\r\n              <ChevronDown className=\"h-3 w-3\" />\r\n              Ver más información\r\n            </>\r\n          )}\r\n        </button>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport { FieldWithContext };\r\nexport default FieldWithContext;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\configuracion\\profile-section-v2\\LiveProfilePreview.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\configuracion\\profile-section-v2\\ProfessionalAvatarUpload.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\configuracion\\profile-section-v2\\ProfileCompletionRing.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\configuracion\\profile-section-v2\\ProfileImpactMetrics.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\configuracion\\profile-section-v2\\ProfileLevelBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\configuracion\\profile-section-v2\\index.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AnimatePresence' is defined but never used.","line":11,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Sparkles' is defined but never used.","line":12,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":33},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":146,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":146,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5306,5309],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5306,5309],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":161,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":161,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6085,6088],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6085,6088],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":197,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":197,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7090,7093],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7090,7093],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":211,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":211,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7465,7468],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7465,7468],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file index.tsx\r\n * @description Versión 2.0 de la sección de perfil médico con diseño profesional\r\n * Layout de dos columnas con vista previa en vivo y gamificación\r\n * @module Dashboard/Medico/Configuracion/ProfileV2\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useState, useEffect, useCallback } from \"react\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport { Save, Loader2, Sparkles, Eye, EyeOff } from \"lucide-react\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\n// Componentes especializados\r\nimport { ProfileCompletionRing } from \"./ProfileCompletionRing\";\r\nimport { LiveProfilePreview } from \"./LiveProfilePreview\";\r\nimport { ProfessionalAvatarUpload } from \"./ProfessionalAvatarUpload\";\r\nimport { EnhancedBioEditor } from \"./EnhancedBioEditor\";\r\nimport { FieldWithContext } from \"./FieldWithContext\";\r\nimport { ProfileImpactMetrics } from \"./ProfileImpactMetrics\";\r\nimport { ProfileLevelBadge } from \"./ProfileLevelBadge\";\r\n\r\nimport type { ProfileData, ProfileCompleteness } from \"./types\";\r\n\r\n/**\r\n * Sección de Perfil Médico V2 - Experiencia Profesional Premium\r\n */\r\nexport function ProfileSectionV2() {\r\n  const [loading, setLoading] = useState(true);\r\n  const [saving, setSaving] = useState(false);\r\n  const [showPreview, setShowPreview] = useState(true);\r\n  const [profile, setProfile] = useState<ProfileData>({\r\n    nombre_completo: \"\",\r\n    email: \"\",\r\n    telefono: \"+58 \",\r\n    cedula: \"\",\r\n    especialidad: \"\",\r\n    especialidades_adicionales: [],\r\n    biografia: \"\",\r\n    avatar_url: null,\r\n    is_verified: false,\r\n    especialidades_permitidas: [],\r\n  });\r\n\r\n  const [completeness, setCompleteness] = useState<ProfileCompleteness>({\r\n    percentage: 0,\r\n    level: \"basic\",\r\n    missingFields: [],\r\n    nextLevelRequirements: [],\r\n  });\r\n\r\n  /**\r\n   * Calcula la completitud del perfil\r\n   * Nota: Especialidades adicionales son opcionales y no afectan el 100%\r\n   */\r\n  const calculateCompleteness = useCallback((data: ProfileData): ProfileCompleteness => {\r\n    const fields = {\r\n      avatar_url: { weight: 20, label: \"Foto profesional\", required: true },\r\n      nombre_completo: { weight: 10, label: \"Nombre completo\", required: true },\r\n      email: { weight: 5, label: \"Correo electrónico\", required: true },\r\n      telefono: { weight: 15, label: \"Teléfono\", required: true },\r\n      cedula: { weight: 10, label: \"Cédula\", required: true },\r\n      biografia: { weight: 40, label: \"Biografía profesional\", required: true },\r\n      // Especialidades adicionales son opcionales (no requeridas para 100%)\r\n      especialidades_adicionales: { weight: 0, label: \"Especialidades adicionales\", required: false },\r\n    };\r\n\r\n    let totalWeight = 0;\r\n    const missing: string[] = [];\r\n\r\n    Object.entries(fields).forEach(([key, config]) => {\r\n      const value = data[key as keyof ProfileData];\r\n      \r\n      if (key === \"biografia\") {\r\n        if (value && typeof value === \"string\" && value.length >= 150) {\r\n          totalWeight += config.weight;\r\n        } else if (config.required) {\r\n          missing.push(config.label);\r\n        }\r\n      } else if (key === \"especialidades_adicionales\") {\r\n        // Opcional: no suma al peso total ni se marca como faltante\r\n        return;\r\n      } else if (value) {\r\n        totalWeight += config.weight;\r\n      } else if (config.required) {\r\n        missing.push(config.label);\r\n      }\r\n    });\r\n\r\n    // Determinar nivel\r\n    let level: \"basic\" | \"complete\" | \"professional\" | \"elite\" = \"basic\";\r\n    if (totalWeight >= 95) level = \"elite\";\r\n    else if (totalWeight >= 80) level = \"professional\";\r\n    else if (totalWeight >= 60) level = \"complete\";\r\n\r\n    // Requisitos para siguiente nivel\r\n    const nextRequirements: string[] = [];\r\n    if (level === \"basic\") {\r\n      nextRequirements.push(\"Completa tu biografía (mín. 150 caracteres)\");\r\n      nextRequirements.push(\"Agrega una foto profesional\");\r\n    } else if (level === \"complete\") {\r\n      nextRequirements.push(\"Agrega especialidades adicionales (opcional)\");\r\n      nextRequirements.push(\"Mejora tu biografía\");\r\n    } else if (level === \"professional\") {\r\n      nextRequirements.push(\"Agrega especialidades adicionales (opcional)\");\r\n      nextRequirements.push(\"Mantén tu perfil actualizado\");\r\n    }\r\n\r\n    return {\r\n      percentage: totalWeight,\r\n      level,\r\n      missingFields: missing,\r\n      nextLevelRequirements: nextRequirements,\r\n    };\r\n  }, []);\r\n\r\n  /**\r\n   * Carga el perfil del médico\r\n   */\r\n  const loadProfile = useCallback(async () => {\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) return;\r\n\r\n      const { data: profileData } = await supabase\r\n        .from(\"profiles\")\r\n        .select(\"*\")\r\n        .eq(\"id\", user.id)\r\n        .single();\r\n\r\n      const { data: doctorData } = await supabase\r\n        .from(\"doctor_details\")\r\n        .select(`\r\n          *,\r\n          especialidad:specialties!fk_doctor_specialty(id, name)\r\n        `)\r\n        .eq(\"profile_id\", user.id)\r\n        .single();\r\n\r\n      // Extraer especialidades adicionales del SACS\r\n      const sacsPostgrados = doctorData?.sacs_data?.postgrados || [];\r\n      const especialidadesAdicionales = sacsPostgrados\r\n        .map((pg: any) => pg.postgrado)\r\n        .filter((pg: string) => pg !== doctorData?.sacs_data?.especialidad_display);\r\n\r\n      const profileState: ProfileData = {\r\n        nombre_completo: profileData?.nombre_completo || \"\",\r\n        email: user.email || \"\",\r\n        telefono: profileData?.telefono || \"+58 \",\r\n        cedula: profileData?.cedula || \"\",\r\n        especialidad: doctorData?.especialidad?.name || \"\",\r\n        especialidades_adicionales: especialidadesAdicionales,\r\n        biografia: doctorData?.biografia || \"\",\r\n        avatar_url: profileData?.avatar_url || null,\r\n        is_verified: doctorData?.verified || false,\r\n        especialidades_permitidas: [\r\n          doctorData?.sacs_data?.especialidad_display,\r\n          ...(doctorData?.sacs_data?.postgrados?.map((pg: any) => pg.postgrado) || [])\r\n        ].filter(Boolean) || [],\r\n      };\r\n\r\n      setProfile(profileState);\r\n      setCompleteness(calculateCompleteness(profileState));\r\n    } catch (error) {\r\n      console.error(\"[ProfileSectionV2] Error loading profile:\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [calculateCompleteness]);\r\n\r\n  useEffect(() => {\r\n    loadProfile();\r\n  }, [loadProfile]);\r\n\r\n  /**\r\n   * Actualiza el perfil y recalcula completitud\r\n   */\r\n  const updateProfile = (updates: Partial<ProfileData>) => {\r\n    const newProfile = { ...profile, ...updates };\r\n    setProfile(newProfile);\r\n    setCompleteness(calculateCompleteness(newProfile));\r\n  };\r\n\r\n  /**\r\n   * Guarda los cambios\r\n   */\r\n  const handleSave = async () => {\r\n    setSaving(true);\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) throw new Error(\"No hay usuario autenticado\");\r\n\r\n      // Actualizar perfil básico\r\n      const profileUpdate: Record<string, any> = {\r\n        telefono: profile.telefono,\r\n      };\r\n\r\n      if (!profile.is_verified) {\r\n        profileUpdate.nombre_completo = profile.nombre_completo;\r\n      }\r\n\r\n      await supabase\r\n        .from(\"profiles\")\r\n        .update(profileUpdate)\r\n        .eq(\"id\", user.id);\r\n\r\n      // Preparar actualización de doctor_details\r\n      const doctorUpdate: Record<string, any> = {\r\n        biografia: profile.biografia,\r\n      };\r\n\r\n      // Solo actualizar especialidades si el médico NO está verificado con SACS\r\n      if (!profile.is_verified) {\r\n        // Buscar el ID de la especialidad principal\r\n        if (profile.especialidad) {\r\n          const { data: specialtyData } = await supabase\r\n            .from(\"specialties\")\r\n            .select(\"id\")\r\n            .eq(\"name\", profile.especialidad)\r\n            .maybeSingle();\r\n\r\n          if (specialtyData) {\r\n            doctorUpdate.specialty_id = specialtyData.id;\r\n          }\r\n        }\r\n\r\n        // Guardar especialidades adicionales\r\n        if (profile.especialidades_adicionales?.length > 0) {\r\n          doctorUpdate.subespecialidades = profile.especialidades_adicionales;\r\n        } else {\r\n          doctorUpdate.subespecialidades = [];\r\n        }\r\n      }\r\n\r\n      // Actualizar detalles del médico\r\n      await supabase\r\n        .from(\"doctor_details\")\r\n        .update(doctorUpdate)\r\n        .eq(\"profile_id\", user.id);\r\n\r\n      // Mostrar éxito\r\n      // TODO: Agregar toast de éxito\r\n    } catch (error) {\r\n      console.error(\"[ProfileSectionV2] Error saving:\", error);\r\n      // TODO: Agregar toast de error\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center py-20\">\r\n        <Loader2 className=\"h-10 w-10 animate-spin text-blue-600\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-50 via-white to-blue-50 dark:from-gray-950 dark:via-gray-900 dark:to-blue-950\">\r\n      <div className=\"container mx-auto px-4 py-8 max-w-[1600px]\">\r\n        {/* Header con Progress Ring */}\r\n        <motion.div\r\n          initial={{ opacity: 0, y: -20 }}\r\n          animate={{ opacity: 1, y: 0 }}\r\n          className=\"mb-8\"\r\n        >\r\n          <div className=\"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-6 bg-white dark:bg-gray-900 rounded-2xl p-4 sm:p-6 shadow-lg border border-gray-100 dark:border-gray-800\">\r\n            <div className=\"flex items-start sm:items-center gap-3 sm:gap-6 w-full lg:w-auto\">\r\n              <div className=\"flex-shrink-0\">\r\n                <ProfileCompletionRing\r\n                  percentage={completeness.percentage}\r\n                  level={completeness.level}\r\n                  size=\"md\"\r\n                />\r\n              </div>\r\n              <div className=\"flex-1 min-w-0\">\r\n                <h1 className=\"text-lg sm:text-2xl font-bold text-gray-900 dark:text-gray-100 mb-1 truncate\">\r\n                  Configuración de Perfil Profesional\r\n                </h1>\r\n                <p className=\"text-sm sm:text-base text-gray-600 dark:text-gray-400\">\r\n                  {completeness.missingFields.length === 0\r\n                    ? \"¡Tu perfil está completo! 🎉\"\r\n                    : `Completa ${completeness.missingFields.length} ${completeness.missingFields.length === 1 ? 'campo' : 'campos'} para mejorar tu visibilidad`}\r\n                </p>\r\n                {/* Mostrar campos faltantes */}\r\n                {completeness.missingFields.length > 0 && (\r\n                  <div className=\"mt-2 flex flex-wrap gap-1\">\r\n                    {completeness.missingFields.slice(0, 3).map((field, idx) => (\r\n                      <span\r\n                        key={idx}\r\n                        className=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400\"\r\n                      >\r\n                        {field}\r\n                      </span>\r\n                    ))}\r\n                    {completeness.missingFields.length > 3 && (\r\n                      <span className=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-600 dark:bg-gray-800 dark:text-gray-400\">\r\n                        +{completeness.missingFields.length - 3} más\r\n                      </span>\r\n                    )}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"flex items-center gap-3 w-full lg:w-auto justify-between lg:justify-end\">\r\n              <ProfileLevelBadge level={completeness.level} />\r\n              <Button\r\n                variant=\"outline\"\r\n                size=\"sm\"\r\n                onClick={() => setShowPreview(!showPreview)}\r\n                className=\"lg:hidden\"\r\n              >\r\n                {showPreview ? (\r\n                  <>\r\n                    <EyeOff className=\"h-4 w-4 mr-2\" />\r\n                    Ocultar Preview\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <Eye className=\"h-4 w-4 mr-2\" />\r\n                    Ver Preview\r\n                  </>\r\n                )}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </motion.div>\r\n\r\n        {/* Layout de Dos Columnas */}\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-12 gap-8\">\r\n          {/* Columna Izquierda: Formulario */}\r\n          <motion.div\r\n            initial={{ opacity: 0, x: -20 }}\r\n            animate={{ opacity: 1, x: 0 }}\r\n            transition={{ delay: 0.1 }}\r\n            className=\"lg:col-span-7 space-y-6\"\r\n          >\r\n            {/* Avatar Upload */}\r\n            <div className=\"bg-white dark:bg-gray-900 rounded-2xl p-6 shadow-lg border border-gray-100 dark:border-gray-800\">\r\n              <ProfessionalAvatarUpload\r\n                currentUrl={profile.avatar_url}\r\n                onUpload={(url) => updateProfile({ avatar_url: url })}\r\n                userName={profile.nombre_completo}\r\n              />\r\n            </div>\r\n\r\n            {/* Información Básica */}\r\n            <div className=\"bg-white dark:bg-gray-900 rounded-2xl p-6 shadow-lg border border-gray-100 dark:border-gray-800\">\r\n              <h3 className=\"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-6\">\r\n                Información Básica\r\n              </h3>\r\n              <div className=\"space-y-4\">\r\n                <FieldWithContext\r\n                  label=\"Nombre Completo\"\r\n                  value={profile.nombre_completo}\r\n                  onChange={(value) => updateProfile({ nombre_completo: value })}\r\n                  locked={profile.is_verified}\r\n                  verified={profile.is_verified}\r\n                  contextInfo={\r\n                    profile.is_verified\r\n                      ? \"Este campo está vinculado a tu verificación SACS y no puede ser modificado para mantener la integridad de tu identidad profesional.\"\r\n                      : \"Tu nombre completo tal como aparece en tus documentos oficiales.\"\r\n                  }\r\n                  impact=\"Los pacientes verán este nombre en tu perfil público\"\r\n                />\r\n\r\n                <FieldWithContext\r\n                  label=\"Correo Electrónico\"\r\n                  value={profile.email}\r\n                  type=\"email\"\r\n                  locked\r\n                  contextInfo=\"El correo electrónico no puede modificarse por razones de seguridad. Es tu identificador único en la plataforma.\"\r\n                />\r\n\r\n                <FieldWithContext\r\n                  label=\"Teléfono\"\r\n                  value={profile.telefono}\r\n                  onChange={(value) => updateProfile({ telefono: value })}\r\n                  type=\"phone\"\r\n                  contextInfo=\"Número de contacto para que los pacientes puedan comunicarse contigo.\"\r\n                  impact=\"Los pacientes podrán contactarte directamente (+40% de conversión)\"\r\n                />\r\n\r\n                <FieldWithContext\r\n                  label=\"Cédula\"\r\n                  value={profile.cedula}\r\n                  locked\r\n                  verified={profile.is_verified}\r\n                  contextInfo={\r\n                    profile.is_verified\r\n                      ? \"Tu cédula fue verificada exitosamente mediante el sistema SACS. Este campo no puede ser modificado.\"\r\n                      : \"Tu número de cédula de identidad.\"\r\n                  }\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Especialidades */}\r\n            <div className=\"bg-white dark:bg-gray-900 rounded-2xl p-6 shadow-lg border border-gray-100 dark:border-gray-800\">\r\n              <h3 className=\"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-6\">\r\n                Especialidades Médicas\r\n              </h3>\r\n              <div className=\"space-y-4\">\r\n                <FieldWithContext\r\n                  label=\"Especialidad Principal\"\r\n                  value={profile.especialidad}\r\n                  onChange={(value) => updateProfile({ especialidad: value })}\r\n                  type=\"specialty\"\r\n                  locked={profile.is_verified}\r\n                  verified={profile.is_verified}\r\n                  allowedValues={profile.especialidades_permitidas}\r\n                  contextInfo={\r\n                    profile.is_verified\r\n                      ? \"Esta especialidad fue verificada automáticamente mediante el sistema SACS (Sistema de Acreditación de Colegios de Salud). Las especialidades verificadas no pueden ser modificadas manualmente para garantizar la autenticidad de tu perfil profesional.\"\r\n                      : \"Selecciona tu especialidad médica principal. Una vez verificada mediante SACS, este campo quedará bloqueado.\"\r\n                  }\r\n                  impact=\"Define tu área principal de práctica y mejora tu visibilidad en búsquedas específicas\"\r\n                />\r\n\r\n                <FieldWithContext\r\n                  label=\"Especialidades Adicionales\"\r\n                  value={profile.especialidades_adicionales}\r\n                  onChange={(value) => updateProfile({ especialidades_adicionales: value })}\r\n                  type=\"multi-specialty\"\r\n                  locked={profile.is_verified && profile.especialidades_adicionales.length > 0}\r\n                  verified={profile.is_verified && profile.especialidades_adicionales.length > 0}\r\n                  contextInfo={\r\n                    profile.is_verified && profile.especialidades_adicionales.length > 0\r\n                      ? \"Estas especialidades fueron verificadas automáticamente mediante el sistema SACS. Corresponden a los postgrados registrados en tu perfil profesional.\"\r\n                      : \"Puedes agregar especialidades adicionales para ampliar tu alcance. Si tienes postgrados verificados en SACS, aparecerán automáticamente aquí.\"\r\n                  }\r\n                  impact=\"Aumenta tu visibilidad en más búsquedas (+30% de alcance) - Campo opcional\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Biografía */}\r\n            <div className=\"bg-white dark:bg-gray-900 rounded-2xl p-6 shadow-lg border border-gray-100 dark:border-gray-800\">\r\n              <EnhancedBioEditor\r\n                value={profile.biografia}\r\n                onChange={(value) => updateProfile({ biografia: value })}\r\n                specialty={profile.especialidad}\r\n                doctorName={profile.nombre_completo}\r\n              />\r\n            </div>\r\n\r\n            {/* Botón Guardar */}\r\n            <motion.div\r\n              initial={{ opacity: 0 }}\r\n              animate={{ opacity: 1 }}\r\n              transition={{ delay: 0.3 }}\r\n              className=\"mt-6\"\r\n            >\r\n              <div className=\"bg-white dark:bg-gray-900 rounded-2xl p-4 shadow-lg border border-gray-200 dark:border-gray-700\">\r\n                <div className=\"flex flex-col sm:flex-row items-center justify-between gap-3\">\r\n                  <p className=\"text-sm text-gray-600 dark:text-gray-400 text-center sm:text-left\">\r\n                    {saving ? \"Guardando cambios...\" : \"Cambios sin guardar\"}\r\n                  </p>\r\n                  <Button\r\n                    onClick={handleSave}\r\n                    disabled={saving}\r\n                    size=\"lg\"\r\n                    className=\"w-full sm:w-auto bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700\"\r\n                  >\r\n                    {saving ? (\r\n                      <>\r\n                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\r\n                        Guardando...\r\n                      </>\r\n                    ) : (\r\n                      <>\r\n                        <Save className=\"h-4 w-4 mr-2\" />\r\n                        Guardar Cambios\r\n                      </>\r\n                    )}\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n            </motion.div>\r\n          </motion.div>\r\n\r\n          {/* Columna Derecha: Vista Previa */}\r\n          <motion.div\r\n            initial={{ opacity: 0, x: 20 }}\r\n            animate={{ opacity: 1, x: 0 }}\r\n            transition={{ delay: 0.2 }}\r\n            className={cn(\r\n              \"lg:col-span-5 space-y-6\",\r\n              !showPreview && \"hidden lg:block\"\r\n            )}\r\n          >\r\n            <div className=\"lg:sticky lg:top-6 space-y-6\">\r\n              {/* Vista Previa en Vivo */}\r\n              <LiveProfilePreview profile={profile} />\r\n\r\n              {/* Métricas de Impacto */}\r\n              <ProfileImpactMetrics\r\n                completeness={completeness}\r\n                profile={profile}\r\n              />\r\n            </div>\r\n          </motion.div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\configuracion\\profile-section-v2\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\configuracion\\profile-section.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'X' is defined but never used.","line":21,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":4},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":167,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":167,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5198,5201],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5198,5201],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file profile-section.tsx\r\n * @description Sección de Perfil Básico en la configuración del médico.\r\n * Permite editar datos personales, foto, teléfono y especialidades.\r\n * Nombre y cédula son de solo lectura tras verificación SACS.\r\n * @module Dashboard/Medico/Configuracion\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useState, useEffect, useCallback } from \"react\";\r\nimport { Label } from \"@red-salud/ui\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { Textarea } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport {\r\n  Save,\r\n  Loader2,\r\n  Lock,\r\n  X,\r\n  Sparkles,\r\n  CheckCircle,\r\n  AlertCircle,\r\n  Info\r\n} from \"lucide-react\";\r\nimport { PhoneInput } from \"@red-salud/ui\";\r\nimport { SpecialtyCombobox } from \"@red-salud/ui\";\r\nimport { SpecialtyMultiSelect } from \"@red-salud/ui\";\r\nimport { AvatarUpload } from \"@red-salud/ui\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\n/**\r\n * Datos del perfil del médico\r\n */\r\ninterface ProfileData {\r\n  /** Nombre completo (solo lectura tras verificación) */\r\n  nombre_completo: string;\r\n  /** Correo electrónico (solo lectura) */\r\n  email: string;\r\n  /** Teléfono con formato +58 XXX XXX XXXX */\r\n  telefono: string;\r\n  /** Cédula (solo lectura, ID del médico) */\r\n  cedula: string;\r\n  /** Especialidad principal verificada */\r\n  especialidad: string;\r\n  /** Especialidades adicionales del SACS */\r\n  especialidades_adicionales: string[];\r\n  /** Biografía profesional */\r\n  biografia: string;\r\n  /** URL del avatar */\r\n  avatar_url: string | null;\r\n  /** Si el perfil está verificado en SACS */\r\n  is_verified: boolean;\r\n  /** Especialidades permitidas desde SACS */\r\n  especialidades_permitidas: string[];\r\n}\r\n\r\n/**\r\n * Props del componente ProfileSection\r\n */\r\ninterface ProfileSectionProps {\r\n  /** Clase CSS adicional */\r\n  className?: string;\r\n}\r\n\r\n/**\r\n * Sección de Perfil Básico para la configuración del médico\r\n */\r\nexport function ProfileSection({ className }: ProfileSectionProps) {\r\n  const [loading, setLoading] = useState(true);\r\n  const [saving, setSaving] = useState(false);\r\n  const [improvingBio, setImprovingBio] = useState(false);\r\n  const [profile, setProfile] = useState<ProfileData>({\r\n    nombre_completo: \"\",\r\n    email: \"\",\r\n    telefono: \"+58 \",\r\n    cedula: \"\",\r\n    especialidad: \"\",\r\n    especialidades_adicionales: [],\r\n    biografia: \"\",\r\n    avatar_url: null,\r\n    is_verified: false,\r\n    especialidades_permitidas: [],\r\n  });\r\n  const [saveMessage, setSaveMessage] = useState<{ type: \"success\" | \"error\", text: string } | null>(null);\r\n\r\n  /**\r\n   * Carga el perfil del médico desde Supabase\r\n   */\r\n  const loadProfile = useCallback(async () => {\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) return;\r\n\r\n      // Cargar perfil básico\r\n      const { data: profileData, error: profileError } = await supabase\r\n        .from(\"profiles\")\r\n        .select(\"*\")\r\n        .eq(\"id\", user.id)\r\n        .single();\r\n\r\n      if (profileError) throw profileError;\r\n\r\n      // Cargar detalles del médico\r\n      const { data: doctorData } = await supabase\r\n        .from(\"doctor_details\")\r\n        .select(`\r\n          *,\r\n          especialidad:specialties(id, name)\r\n        `)\r\n        .eq(\"profile_id\", user.id)\r\n        .single();\r\n\r\n      // Obtener especialidades permitidas (del SACS o todas si no hay restricción)\r\n      let especialidadesPermitidas: string[] = [];\r\n\r\n      // Intentar obtener del sacs_data si existe\r\n      if (doctorData?.sacs_data?.especialidades) {\r\n        especialidadesPermitidas = doctorData.sacs_data.especialidades;\r\n      } else {\r\n        // Si no hay datos SACS, cargar todas las especialidades disponibles\r\n        const { data: allSpecialties } = await supabase\r\n          .from(\"specialties\")\r\n          .select(\"name\")\r\n          .order(\"name\");\r\n\r\n        especialidadesPermitidas = allSpecialties?.map(s => s.name) || [];\r\n      }\r\n\r\n      setProfile({\r\n        nombre_completo: profileData?.nombre_completo || \"\",\r\n        email: user.email || \"\",\r\n        telefono: profileData?.telefono || \"+58 \",\r\n        cedula: profileData?.cedula || \"\",\r\n        especialidad: doctorData?.especialidad?.name || \"\",\r\n        especialidades_adicionales: doctorData?.subespecialidades || [],\r\n        biografia: doctorData?.biografia || \"\",\r\n        avatar_url: profileData?.avatar_url || null,\r\n        is_verified: doctorData?.verified || false,\r\n        especialidades_permitidas: especialidadesPermitidas,\r\n      });\r\n    } catch (error) {\r\n      console.error(\"[ProfileSection] Error loading profile:\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    loadProfile();\r\n  }, [loadProfile]);\r\n\r\n  /**\r\n   * Guarda los cambios del perfil\r\n   */\r\n  const handleSave = async () => {\r\n    setSaving(true);\r\n    setSaveMessage(null);\r\n\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) throw new Error(\"No hay usuario autenticado\");\r\n\r\n      // Actualizar perfil básico (sin nombre ni cédula si está verificado)\r\n      const profileUpdate: Record<string, any> = {\r\n        telefono: profile.telefono,\r\n      };\r\n\r\n      // Solo actualizar nombre si NO está verificado\r\n      if (!profile.is_verified) {\r\n        profileUpdate.nombre_completo = profile.nombre_completo;\r\n      }\r\n\r\n      const { error: profileError } = await supabase\r\n        .from(\"profiles\")\r\n        .update(profileUpdate)\r\n        .eq(\"id\", user.id);\r\n\r\n      if (profileError) throw profileError;\r\n\r\n      // Actualizar detalles del médico\r\n      const { error: doctorError } = await supabase\r\n        .from(\"doctor_details\")\r\n        .update({\r\n          biografia: profile.biografia,\r\n          subespecialidades: profile.especialidades_adicionales,\r\n        })\r\n        .eq(\"profile_id\", user.id);\r\n\r\n      if (doctorError) throw doctorError;\r\n\r\n      setSaveMessage({ type: \"success\", text: \"Perfil guardado correctamente\" });\r\n\r\n      // Limpiar mensaje después de 3 segundos\r\n      setTimeout(() => setSaveMessage(null), 3000);\r\n    } catch (error) {\r\n      console.error(\"[ProfileSection] Error saving profile:\", error);\r\n      setSaveMessage({ type: \"error\", text: error instanceof Error ? error.message : \"Error al guardar\" });\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Mejora la biografía usando IA\r\n   */\r\n  const handleImproveBio = async () => {\r\n    if (!profile.biografia.trim() || profile.biografia.length < 20) {\r\n      setSaveMessage({ type: \"error\", text: \"Escribe al menos 20 caracteres para mejorar\" });\r\n      return;\r\n    }\r\n\r\n    setImprovingBio(true);\r\n    setSaveMessage(null);\r\n\r\n    try {\r\n      const response = await fetch(\"/api/ai/improve-bio\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({\r\n          biografia: profile.biografia,\r\n          nombre: profile.nombre_completo,\r\n          especialidad: profile.especialidad,\r\n        }),\r\n      });\r\n\r\n      if (!response.ok) throw new Error(\"Error al mejorar la biografía\");\r\n\r\n      const data = await response.json();\r\n\r\n      if (data.improved_bio) {\r\n        setProfile({ ...profile, biografia: data.improved_bio });\r\n        setSaveMessage({ type: \"success\", text: \"Biografía mejorada. No olvides guardar los cambios.\" });\r\n      }\r\n    } catch (error) {\r\n      console.error(\"[ProfileSection] Error improving bio:\", error);\r\n      setSaveMessage({ type: \"error\", text: \"Error al mejorar la biografía\" });\r\n    } finally {\r\n      setImprovingBio(false);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Actualiza la URL del avatar\r\n   */\r\n  const handleAvatarUpload = (url: string) => {\r\n    setProfile({ ...profile, avatar_url: url });\r\n  };\r\n\r\n\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center py-12\">\r\n        <Loader2 className=\"h-8 w-8 animate-spin text-blue-600\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className={cn(\"space-y-8\", className)}>\r\n      {/* Header con Avatar */}\r\n      <div className=\"flex flex-col sm:flex-row items-start sm:items-center gap-6 pb-6 border-b dark:border-gray-700\">\r\n        <AvatarUpload\r\n          currentUrl={profile.avatar_url}\r\n          onUpload={handleAvatarUpload}\r\n          userName={profile.nombre_completo}\r\n          size=\"xl\"\r\n        />\r\n\r\n        <div className=\"flex-1\">\r\n          <div className=\"flex items-center gap-2 mb-1\">\r\n            <h3 className=\"text-xl font-semibold text-gray-900 dark:text-gray-100\">\r\n              {profile.nombre_completo || \"Completa tu perfil\"}\r\n            </h3>\r\n            {profile.is_verified && (\r\n              <Badge className=\"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400\">\r\n                <CheckCircle className=\"h-3 w-3 mr-1\" />\r\n                Verificado\r\n              </Badge>\r\n            )}\r\n          </div>\r\n          <p className=\"text-gray-600 dark:text-gray-400\">{profile.especialidad}</p>\r\n          <p className=\"text-sm text-gray-500 dark:text-gray-500 mt-1\">\r\n            Cédula: {profile.cedula || \"No registrada\"}\r\n          </p>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Aviso de campos bloqueados */}\r\n      {profile.is_verified && (\r\n        <div className=\"flex items-start gap-3 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800\">\r\n          <Info className=\"h-5 w-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5\" />\r\n          <div className=\"text-sm\">\r\n            <p className=\"font-medium text-blue-800 dark:text-blue-300\">\r\n              Perfil verificado por SACS\r\n            </p>\r\n            <p className=\"text-blue-600 dark:text-blue-400 mt-0.5\">\r\n              El nombre y la cédula están vinculados a tu verificación profesional y no pueden modificarse.\r\n            </p>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Formulario */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n        {/* Nombre Completo */}\r\n        <div className=\"space-y-2\">\r\n          <Label htmlFor=\"nombre\" className=\"flex items-center gap-2\">\r\n            Nombre Completo\r\n            {profile.is_verified && <Lock className=\"h-3 w-3 text-gray-400\" />}\r\n          </Label>\r\n          <Input\r\n            id=\"nombre\"\r\n            value={profile.nombre_completo}\r\n            onChange={(e) => setProfile({ ...profile, nombre_completo: e.target.value })}\r\n            placeholder=\"Dr. Juan Pérez\"\r\n            disabled={profile.is_verified}\r\n            className={cn(profile.is_verified && \"bg-gray-50 dark:bg-gray-800 cursor-not-allowed\")}\r\n          />\r\n        </div>\r\n\r\n        {/* Correo Electrónico */}\r\n        <div className=\"space-y-2\">\r\n          <Label htmlFor=\"email\" className=\"flex items-center gap-2\">\r\n            Correo Electrónico\r\n            <Lock className=\"h-3 w-3 text-gray-400\" />\r\n          </Label>\r\n          <Input\r\n            id=\"email\"\r\n            type=\"email\"\r\n            value={profile.email}\r\n            disabled\r\n            className=\"bg-gray-50 dark:bg-gray-800 cursor-not-allowed\"\r\n          />\r\n        </div>\r\n\r\n        {/* Teléfono */}\r\n        <div className=\"space-y-2\">\r\n          <Label htmlFor=\"telefono\">Teléfono</Label>\r\n          <PhoneInput\r\n            value={profile.telefono}\r\n            onChange={(value) => setProfile({ ...profile, telefono: value })}\r\n          />\r\n        </div>\r\n\r\n        {/* Cédula */}\r\n        <div className=\"space-y-2\">\r\n          <Label htmlFor=\"cedula\" className=\"flex items-center gap-2\">\r\n            Cédula (ID)\r\n            <Lock className=\"h-3 w-3 text-gray-400\" />\r\n          </Label>\r\n          <Input\r\n            id=\"cedula\"\r\n            value={profile.cedula}\r\n            disabled\r\n            className=\"bg-gray-50 dark:bg-gray-800 cursor-not-allowed font-mono\"\r\n          />\r\n        </div>\r\n\r\n        {/* Especialidad Principal */}\r\n        <div className=\"space-y-2\">\r\n          <Label htmlFor=\"especialidad\" className=\"flex items-center gap-2\">\r\n            Especialidad Principal\r\n            {profile.is_verified && <Lock className=\"h-3 w-3 text-gray-400\" />}\r\n          </Label>\r\n          <SpecialtyCombobox\r\n            id=\"especialidad\"\r\n            value={profile.especialidad}\r\n            onChange={(value) => setProfile({ ...profile, especialidad: value })}\r\n            allowedSpecialties={profile.especialidades_permitidas}\r\n            readOnly={profile.is_verified}\r\n            placeholder=\"Seleccionar especialidad\"\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      {/* Especialidades Adicionales */}\r\n      <div className=\"space-y-3\">\r\n        <Label>Especialidades Adicionales</Label>\r\n        <SpecialtyMultiSelect\r\n          selected={profile.especialidades_adicionales}\r\n          onChange={(newValues) => setProfile({ ...profile, especialidades_adicionales: newValues })}\r\n          exclude={[profile.especialidad]}\r\n          placeholder=\"Buscar especialidades adicionales\"\r\n        />\r\n        <p className=\"text-xs text-muted-foreground\">\r\n          Agrega otras especialidades o subespecialidades que practiques.\r\n        </p>\r\n      </div>\r\n\r\n      {/* Biografía Profesional */}\r\n      <div className=\"space-y-3\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <Label htmlFor=\"biografia\">Biografía Profesional</Label>\r\n          <Button\r\n            type=\"button\"\r\n            variant=\"ghost\"\r\n            size=\"sm\"\r\n            onClick={handleImproveBio}\r\n            disabled={improvingBio || profile.biografia.length < 20}\r\n            className=\"text-purple-600 hover:text-purple-700 hover:bg-purple-50 dark:text-purple-400 dark:hover:bg-purple-900/20\"\r\n          >\r\n            {improvingBio ? (\r\n              <>\r\n                <Loader2 className=\"h-4 w-4 mr-1.5 animate-spin\" />\r\n                Mejorando...\r\n              </>\r\n            ) : (\r\n              <>\r\n                <Sparkles className=\"h-4 w-4 mr-1.5\" />\r\n                Mejorar con IA\r\n              </>\r\n            )}\r\n          </Button>\r\n        </div>\r\n        <Textarea\r\n          id=\"biografia\"\r\n          value={profile.biografia}\r\n          onChange={(e) => setProfile({ ...profile, biografia: e.target.value })}\r\n          placeholder=\"Cuéntanos sobre tu experiencia y formación profesional. La IA puede ayudarte a mejorar la gramática y estructura...\"\r\n          rows={5}\r\n          className=\"resize-none\"\r\n        />\r\n        <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n          Esta información será visible para tus pacientes. Mínimo 20 caracteres para usar la mejora con IA.\r\n        </p>\r\n      </div>\r\n\r\n      {/* Mensaje de estado */}\r\n      {saveMessage && (\r\n        <div className={cn(\r\n          \"flex items-center gap-2 p-3 rounded-lg text-sm\",\r\n          saveMessage.type === \"success\"\r\n            ? \"bg-green-50 text-green-700 dark:bg-green-900/20 dark:text-green-400\"\r\n            : \"bg-red-50 text-red-700 dark:bg-red-900/20 dark:text-red-400\"\r\n        )}>\r\n          {saveMessage.type === \"success\" ? (\r\n            <CheckCircle className=\"h-4 w-4\" />\r\n          ) : (\r\n            <AlertCircle className=\"h-4 w-4\" />\r\n          )}\r\n          {saveMessage.text}\r\n        </div>\r\n      )}\r\n\r\n      {/* Botón Guardar */}\r\n      <div className=\"flex justify-end pt-4 border-t dark:border-gray-700\">\r\n        <Button onClick={handleSave} disabled={saving} size=\"lg\">\r\n          {saving ? (\r\n            <>\r\n              <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\r\n              Guardando...\r\n            </>\r\n          ) : (\r\n            <>\r\n              <Save className=\"h-4 w-4 mr-2\" />\r\n              Guardar Cambios\r\n            </>\r\n          )}\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\configuracion\\schedule-section.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Clock' is defined but never used.","line":18,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":8},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Plus' is defined but never used.","line":21,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":7},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadOfficesAndSchedules'. Either include it or remove the dependency array.","line":103,"column":6,"nodeType":"ArrayExpression","endLine":103,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadOfficesAndSchedules]","fix":{"range":[3066,3068],"text":"[loadOfficesAndSchedules]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'selectedOffice' is assigned a value but never used.","line":328,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":328,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'index' is defined but never used.","line":400,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":400,"endColumn":37},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":519,"column":50,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[18006,18108],"text":"\r\n                    No hay horarios. Haz clic en &quot;Mañana\" o \"Tarde\" para añadir.\r\n                  "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[18006,18108],"text":"\r\n                    No hay horarios. Haz clic en &ldquo;Mañana\" o \"Tarde\" para añadir.\r\n                  "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[18006,18108],"text":"\r\n                    No hay horarios. Haz clic en &#34;Mañana\" o \"Tarde\" para añadir.\r\n                  "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[18006,18108],"text":"\r\n                    No hay horarios. Haz clic en &rdquo;Mañana\" o \"Tarde\" para añadir.\r\n                  "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":519,"column":57,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[18006,18108],"text":"\r\n                    No hay horarios. Haz clic en \"Mañana&quot; o \"Tarde\" para añadir.\r\n                  "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[18006,18108],"text":"\r\n                    No hay horarios. Haz clic en \"Mañana&ldquo; o \"Tarde\" para añadir.\r\n                  "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[18006,18108],"text":"\r\n                    No hay horarios. Haz clic en \"Mañana&#34; o \"Tarde\" para añadir.\r\n                  "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[18006,18108],"text":"\r\n                    No hay horarios. Haz clic en \"Mañana&rdquo; o \"Tarde\" para añadir.\r\n                  "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":519,"column":61,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[18006,18108],"text":"\r\n                    No hay horarios. Haz clic en \"Mañana\" o &quot;Tarde\" para añadir.\r\n                  "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[18006,18108],"text":"\r\n                    No hay horarios. Haz clic en \"Mañana\" o &ldquo;Tarde\" para añadir.\r\n                  "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[18006,18108],"text":"\r\n                    No hay horarios. Haz clic en \"Mañana\" o &#34;Tarde\" para añadir.\r\n                  "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[18006,18108],"text":"\r\n                    No hay horarios. Haz clic en \"Mañana\" o &rdquo;Tarde\" para añadir.\r\n                  "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":519,"column":67,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[18006,18108],"text":"\r\n                    No hay horarios. Haz clic en \"Mañana\" o \"Tarde&quot; para añadir.\r\n                  "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[18006,18108],"text":"\r\n                    No hay horarios. Haz clic en \"Mañana\" o \"Tarde&ldquo; para añadir.\r\n                  "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[18006,18108],"text":"\r\n                    No hay horarios. Haz clic en \"Mañana\" o \"Tarde&#34; para añadir.\r\n                  "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[18006,18108],"text":"\r\n                    No hay horarios. Haz clic en \"Mañana\" o \"Tarde&rdquo; para añadir.\r\n                  "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file schedule-section.tsx\r\n * @description Sección de configuración de horarios del médico con diseño minimalista y compacto.\r\n * Incluye selector de consultorio, etiquetas mañana/tarde, y selectores profesionales de tiempo.\r\n * @module Dashboard/Medico/Configuracion\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Label } from \"@red-salud/ui\";\r\nimport { Switch } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { TimePicker } from \"@red-salud/ui\";\r\nimport {\r\n  Clock,\r\n  Save,\r\n  Loader2,\r\n  Plus,\r\n  Trash2,\r\n  ChevronDown,\r\n  ChevronUp,\r\n  Sunrise,\r\n  Sunset,\r\n  MapPin\r\n} from \"lucide-react\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { Toast } from \"@red-salud/ui\";\r\n\r\n/** Interfaz para un bloque de horario */\r\ninterface TimeSlot {\r\n  inicio: string;\r\n  fin: string;\r\n}\r\n\r\n/** Interfaz para el horario de un día específico */\r\ninterface DaySchedule {\r\n  activo: boolean;\r\n  horarios: TimeSlot[];\r\n}\r\n\r\n/** Interfaz para todos los horarios */\r\ninterface Schedule {\r\n  [key: string]: DaySchedule;\r\n}\r\n\r\n/** Interfaz para un consultorio */\r\ninterface Office {\r\n  id: string;\r\n  nombre: string;\r\n  direccion?: string;\r\n  ciudad?: string;\r\n  es_principal: boolean;\r\n  activo: boolean;\r\n}\r\n\r\n/** Configuración de días de la semana */\r\nconst DIAS_SEMANA = [\r\n  { key: \"lunes\", label: \"Lun\", fullLabel: \"Lunes\" },\r\n  { key: \"martes\", label: \"Mar\", fullLabel: \"Martes\" },\r\n  { key: \"miercoles\", label: \"Mié\", fullLabel: \"Miércoles\" },\r\n  { key: \"jueves\", label: \"Jue\", fullLabel: \"Jueves\" },\r\n  { key: \"viernes\", label: \"Vie\", fullLabel: \"Viernes\" },\r\n  { key: \"sabado\", label: \"Sáb\", fullLabel: \"Sábado\" },\r\n  { key: \"domingo\", label: \"Dom\", fullLabel: \"Domingo\" },\r\n];\r\n\r\n/** Duraciones de consulta disponibles */\r\nconst DURACIONES = [\r\n  { value: 15, label: \"15 min\", icon: \"⚡\" },\r\n  { value: 30, label: \"30 min\", icon: \"⏱️\" },\r\n  { value: 45, label: \"45 min\", icon: \"🕐\" },\r\n  { value: 60, label: \"1 hora\", icon: \"⌛\" },\r\n];\r\n\r\n/**\r\n * Determina si un horario es de mañana o tarde\r\n */\r\nconst getTimeLabel = (inicio: string): \"morning\" | \"afternoon\" => {\r\n  const hour = parseInt(inicio.split(':')[0]);\r\n  return hour < 14 ? \"morning\" : \"afternoon\";\r\n};\r\n\r\n/**\r\n * Componente principal de configuración de horarios\r\n */\r\nexport function ScheduleSection() {\r\n  const [loading, setLoading] = useState(true);\r\n  const [saving, setSaving] = useState(false);\r\n  const [offices, setOffices] = useState<Office[]>([]);\r\n  const [selectedOfficeId, setSelectedOfficeId] = useState<string | null>(null);\r\n  const [schedule, setSchedule] = useState<Schedule>({});\r\n  const [duracionCita, setDuracionCita] = useState(30);\r\n  const [expandedDay, setExpandedDay] = useState<string | null>(null);\r\n\r\n  // Estado para Toast\r\n  const [toast, setToast] = useState({ visible: false, message: \"\", type: \"info\" as \"success\" | \"error\" | \"info\" });\r\n\r\n  useEffect(() => {\r\n    loadOfficesAndSchedules();\r\n  }, []);\r\n\r\n  /**\r\n   * Carga los consultorios y horarios del médico\r\n   */\r\n  const loadOfficesAndSchedules = async () => {\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) return;\r\n\r\n      // Cargar consultorios\r\n      const { data: officesData, error: officesError } = await supabase\r\n        .from(\"doctor_offices\")\r\n        .select(\"*\")\r\n        .eq(\"doctor_id\", user.id)\r\n        .eq(\"activo\", true)\r\n        .order(\"es_principal\", { ascending: false });\r\n\r\n      if (officesError) throw officesError;\r\n\r\n      setOffices(officesData || []);\r\n\r\n      // Seleccionar el primer consultorio (principal si existe)\r\n      if (officesData && officesData.length > 0) {\r\n        setSelectedOfficeId(officesData[0].id);\r\n        await loadScheduleForOffice(officesData[0].id);\r\n      } else {\r\n        // No hay consultorios, crear uno por defecto\r\n        await createDefaultOffice(user.id);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"[ScheduleSection] Error loading data:\", error);\r\n      showToast(\"Error al cargar datos. Por favor, recarga la página.\", \"error\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Crea un consultorio por defecto\r\n   */\r\n  const createDefaultOffice = async (doctorId: string) => {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from(\"doctor_offices\")\r\n        .insert({\r\n          doctor_id: doctorId,\r\n          nombre: \"Consultorio Principal\",\r\n          es_principal: true,\r\n          activo: true,\r\n        })\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      setOffices([data]);\r\n      setSelectedOfficeId(data.id);\r\n      setSchedule(getDefaultSchedule());\r\n    } catch (error) {\r\n      console.error(\"[ScheduleSection] Error creating default office:\", error);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Carga el horario para un consultorio específico\r\n   */\r\n  const loadScheduleForOffice = async (officeId: string) => {\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) return;\r\n\r\n      const { data, error } = await supabase\r\n        .from(\"doctor_schedules\")\r\n        .select(\"*\")\r\n        .eq(\"doctor_id\", user.id)\r\n        .eq(\"office_id\", officeId)\r\n        .single();\r\n\r\n      if (error && error.code !== \"PGRST116\") throw error;\r\n\r\n      if (data) {\r\n        setSchedule(data.horarios || getDefaultSchedule());\r\n        setDuracionCita(data.duracion_cita_minutos || 30);\r\n      } else {\r\n        setSchedule(getDefaultSchedule());\r\n        setDuracionCita(30);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"[ScheduleSection] Error loading schedule:\", error);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Retorna el horario predeterminado (lunes a viernes activos)\r\n   */\r\n  const getDefaultSchedule = (): Schedule => {\r\n    const defaultSchedule: Schedule = {};\r\n    DIAS_SEMANA.forEach(dia => {\r\n      defaultSchedule[dia.key] = {\r\n        activo: dia.key !== \"sabado\" && dia.key !== \"domingo\",\r\n        horarios: dia.key !== \"sabado\" && dia.key !== \"domingo\"\r\n          ? [{ inicio: \"09:00\", fin: \"13:00\" }, { inicio: \"15:00\", fin: \"19:00\" }]\r\n          : [],\r\n      };\r\n    });\r\n    return defaultSchedule;\r\n  };\r\n\r\n  /**\r\n   * Cambia el consultorio seleccionado\r\n   */\r\n  const handleOfficeChange = async (officeId: string) => {\r\n    setSelectedOfficeId(officeId);\r\n    await loadScheduleForOffice(officeId);\r\n    setExpandedDay(null);\r\n  };\r\n\r\n  /**\r\n   * Guarda los horarios en la base de datos\r\n   */\r\n  const handleSave = async () => {\r\n    if (!selectedOfficeId) return;\r\n\r\n    setSaving(true);\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) return;\r\n\r\n      const { error } = await supabase\r\n        .from(\"doctor_schedules\")\r\n        .upsert({\r\n          doctor_id: user.id,\r\n          office_id: selectedOfficeId,\r\n          horarios: schedule,\r\n          duracion_cita_minutos: duracionCita,\r\n        });\r\n\r\n      if (error) throw error;\r\n\r\n      showToast(\"Horarios actualizados correctamente\", \"success\");\r\n    } catch (error) {\r\n      console.error(\"[ScheduleSection] Error saving schedule:\", error);\r\n      showToast(\"Error al guardar horarios. Intenta nuevamente.\", \"error\");\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Muestra un toast con el mensaje especificado\r\n   */\r\n  const showToast = (message: string, type: \"success\" | \"error\" | \"info\") => {\r\n    setToast({ visible: true, message, type });\r\n  };\r\n\r\n  /**\r\n   * Alterna el estado activo/inactivo de un día\r\n   */\r\n  const toggleDay = (dia: string) => {\r\n    setSchedule({\r\n      ...schedule,\r\n      [dia]: {\r\n        ...schedule[dia],\r\n        activo: !schedule[dia]?.activo,\r\n      },\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Añade un bloque de horario (mañana o tarde)\r\n   */\r\n  const addTimeSlot = (dia: string, type: \"morning\" | \"afternoon\") => {\r\n    const currentSlots = schedule[dia]?.horarios || [];\r\n    const newSlot = type === \"morning\"\r\n      ? { inicio: \"09:00\", fin: \"13:00\" }\r\n      : { inicio: \"15:00\", fin: \"19:00\" };\r\n\r\n    setSchedule({\r\n      ...schedule,\r\n      [dia]: {\r\n        ...schedule[dia],\r\n        activo: true,\r\n        horarios: [...currentSlots, newSlot],\r\n      },\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Elimina un bloque de horario de un día\r\n   */\r\n  const removeTimeSlot = (dia: string, index: number) => {\r\n    const currentSlots = schedule[dia]?.horarios || [];\r\n    setSchedule({\r\n      ...schedule,\r\n      [dia]: {\r\n        ...schedule[dia],\r\n        horarios: currentSlots.filter((_, i) => i !== index),\r\n      },\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Actualiza un campo específico de un bloque de horario\r\n   */\r\n  const updateTimeSlot = (dia: string, index: number, field: \"inicio\" | \"fin\", value: string) => {\r\n    const currentSlots = [...(schedule[dia]?.horarios || [])];\r\n    currentSlots[index] = { ...currentSlots[index], [field]: value };\r\n    setSchedule({\r\n      ...schedule,\r\n      [dia]: {\r\n        ...schedule[dia],\r\n        horarios: currentSlots,\r\n      },\r\n    });\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center py-12\">\r\n        <Loader2 className=\"h-8 w-8 animate-spin text-blue-600\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const selectedOffice = offices.find(o => o.id === selectedOfficeId);\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Toast Component */}\r\n      <Toast\r\n        message={toast.message}\r\n        type={toast.type}\r\n        isVisible={toast.visible}\r\n        onClose={() => setToast({ ...toast, visible: false })}\r\n      />\r\n\r\n      {/* Compact Header with Office Selector and Duration */}\r\n      <div className=\"flex items-start justify-between pb-4 border-b border-gray-200 dark:border-gray-800\">\r\n        <div className=\"flex-1\">\r\n          <h3 className=\"text-base font-semibold text-gray-900 dark:text-gray-100\">\r\n            Horarios de Atención\r\n          </h3>\r\n          <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-0.5\">\r\n            Configura los días y horarios en los que recibirás pacientes\r\n          </p>\r\n        </div>\r\n\r\n        <div className=\"flex items-center gap-3\">\r\n          {/* Office Selector */}\r\n          {offices.length > 0 && (\r\n            <div className=\"flex items-center gap-2\">\r\n              <MapPin className=\"h-4 w-4 text-gray-400\" />\r\n              <select\r\n                value={selectedOfficeId || \"\"}\r\n                onChange={(e) => handleOfficeChange(e.target.value)}\r\n                className=\"px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none\"\r\n              >\r\n                {offices.map((office) => (\r\n                  <option key={office.id} value={office.id}>\r\n                    {office.nombre}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Duration Selector - Visual Radio Buttons */}\r\n      <div className=\"bg-gray-50 dark:bg-gray-900/30 rounded-lg p-4 border border-gray-200 dark:border-gray-800\">\r\n        <Label className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 block\">\r\n          Duración por Consulta\r\n        </Label>\r\n        <div className=\"grid grid-cols-4 gap-2\">\r\n          {DURACIONES.map((dur) => (\r\n            <button\r\n              key={dur.value}\r\n              type=\"button\"\r\n              onClick={() => setDuracionCita(dur.value)}\r\n              className={`\r\n                px-3 py-2 rounded-lg border-2 transition-all text-sm font-medium\r\n                ${duracionCita === dur.value\r\n                  ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300'\r\n                  : 'border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600'\r\n                }\r\n              `}\r\n            >\r\n              <div className=\"text-lg mb-0.5\">{dur.icon}</div>\r\n              {dur.label}\r\n            </button>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Days Grid - 7 columns */}\r\n      <div className=\"grid grid-cols-7 gap-2\">\r\n        {DIAS_SEMANA.map((dia, index) => {\r\n          const daySchedule = schedule[dia.key] || { activo: false, horarios: [] };\r\n          const isExpanded = expandedDay === dia.key;\r\n\r\n          // Separar horarios de mañana y tarde\r\n          const morningSlots = daySchedule.horarios.filter(slot => getTimeLabel(slot.inicio) === \"morning\");\r\n          const afternoonSlots = daySchedule.horarios.filter(slot => getTimeLabel(slot.inicio) === \"afternoon\");\r\n\r\n          return (\r\n            <div\r\n              key={dia.key}\r\n              className={`\r\n                border rounded-lg overflow-hidden transition-all\r\n                ${daySchedule.activo\r\n                  ? 'border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-900/10'\r\n                  : 'border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-gray-900/30'\r\n                }\r\n              `}\r\n            >\r\n              {/* Day Header */}\r\n              <div className=\"p-3 text-center border-b border-gray-200 dark:border-gray-800\">\r\n                <div className=\"flex items-center justify-center mb-2\">\r\n                  <Switch\r\n                    checked={daySchedule.activo}\r\n                    onCheckedChange={() => toggleDay(dia.key)}\r\n                    className=\"scale-75\"\r\n                  />\r\n                </div>\r\n                <div className=\"text-xs font-semibold text-gray-900 dark:text-gray-100\">\r\n                  {dia.label}\r\n                </div>\r\n                {daySchedule.activo && (\r\n                  <div className=\"text-[10px] text-gray-500 dark:text-gray-400 mt-1\">\r\n                    {daySchedule.horarios.length} horario{daySchedule.horarios.length !== 1 ? 's' : ''}\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Summary / Edit Button */}\r\n              {daySchedule.activo && (\r\n                <div className=\"p-2\">\r\n                  {daySchedule.horarios.length > 0 ? (\r\n                    <div className=\"space-y-1\">\r\n                      {morningSlots.length > 0 && (\r\n                        <div className=\"text-[10px] text-gray-600 dark:text-gray-400 flex items-center justify-center gap-1\">\r\n                          <Sunrise className=\"h-2.5 w-2.5\" />\r\n                          {morningSlots[0].inicio}-{morningSlots[0].fin}\r\n                        </div>\r\n                      )}\r\n                      {afternoonSlots.length > 0 && (\r\n                        <div className=\"text-[10px] text-gray-600 dark:text-gray-400 flex items-center justify-center gap-1\">\r\n                          <Sunset className=\"h-2.5 w-2.5\" />\r\n                          {afternoonSlots[0].inicio}-{afternoonSlots[0].fin}\r\n                        </div>\r\n                      )}\r\n                      {daySchedule.horarios.length > 2 && (\r\n                        <div className=\"text-[10px] text-gray-400 text-center\">\r\n                          +{daySchedule.horarios.length - 2}\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"text-[10px] text-gray-400 text-center italic\">\r\n                      Sin horarios\r\n                    </div>\r\n                  )}\r\n                  <button\r\n                    onClick={() => setExpandedDay(isExpanded ? null : dia.key)}\r\n                    className=\"w-full mt-2 px-2 py-1 text-[10px] text-blue-600 dark:text-blue-400 hover:bg-blue-100 dark:hover:bg-blue-900/20 rounded flex items-center justify-center gap-1 transition-colors\"\r\n                  >\r\n                    {isExpanded ? <ChevronUp className=\"h-3 w-3\" /> : <ChevronDown className=\"h-3 w-3\" />}\r\n                    {isExpanded ? 'Cerrar' : 'Editar'}\r\n                  </button>\r\n                </div>\r\n              )}\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n\r\n      {/* Expanded Day Editor */}\r\n      <AnimatePresence>\r\n        {expandedDay && (\r\n          <motion.div\r\n            initial={{ opacity: 0, height: 0 }}\r\n            animate={{ opacity: 1, height: \"auto\" }}\r\n            exit={{ opacity: 0, height: 0 }}\r\n            className=\"overflow-hidden\"\r\n          >\r\n            <div className=\"border border-blue-200 dark:border-blue-800 rounded-lg p-4 bg-blue-50/50 dark:bg-blue-900/10\">\r\n              <div className=\"flex items-center justify-between mb-4\">\r\n                <h4 className=\"text-sm font-semibold text-gray-900 dark:text-gray-100\">\r\n                  {DIAS_SEMANA.find(d => d.key === expandedDay)?.fullLabel}\r\n                </h4>\r\n                <div className=\"flex gap-2\">\r\n                  <Button\r\n                    variant=\"outline\"\r\n                    size=\"sm\"\r\n                    onClick={() => addTimeSlot(expandedDay, \"morning\")}\r\n                    className=\"text-xs gap-1 hover:bg-blue-50 dark:hover:bg-blue-900/20\"\r\n                  >\r\n                    <Sunrise className=\"h-3 w-3\" />\r\n                    Mañana\r\n                  </Button>\r\n                  <Button\r\n                    variant=\"outline\"\r\n                    size=\"sm\"\r\n                    onClick={() => addTimeSlot(expandedDay, \"afternoon\")}\r\n                    className=\"text-xs gap-1 hover:bg-orange-50 dark:hover:bg-orange-900/20\"\r\n                  >\r\n                    <Sunset className=\"h-3 w-3\" />\r\n                    Tarde\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"space-y-2\">\r\n                {schedule[expandedDay]?.horarios.length === 0 ? (\r\n                  <p className=\"text-xs text-gray-400 dark:text-gray-500 text-center py-3\">\r\n                    No hay horarios. Haz clic en \"Mañana\" o \"Tarde\" para añadir.\r\n                  </p>\r\n                ) : (\r\n                  schedule[expandedDay]?.horarios.map((slot, index) => {\r\n                    const timeLabel = getTimeLabel(slot.inicio);\r\n                    return (\r\n                      <div\r\n                        key={index}\r\n                        className=\"flex items-center gap-2 p-3 bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700\"\r\n                      >\r\n                        {timeLabel === \"morning\" ? (\r\n                          <Sunrise className=\"h-4 w-4 text-blue-500 flex-shrink-0\" />\r\n                        ) : (\r\n                          <Sunset className=\"h-4 w-4 text-orange-500 flex-shrink-0\" />\r\n                        )}\r\n                        <Badge variant=\"secondary\" className=\"text-[10px] px-1.5 py-0.5\">\r\n                          {timeLabel === \"morning\" ? \"Mañana\" : \"Tarde\"}\r\n                        </Badge>\r\n                        <TimePicker\r\n                          value={slot.inicio}\r\n                          onChange={(value) => updateTimeSlot(expandedDay, index, \"inicio\", value)}\r\n                          className=\"flex-1\"\r\n                        />\r\n                        <span className=\"text-xs text-gray-400\">a</span>\r\n                        <TimePicker\r\n                          value={slot.fin}\r\n                          onChange={(value) => updateTimeSlot(expandedDay, index, \"fin\", value)}\r\n                          className=\"flex-1\"\r\n                        />\r\n                        <Button\r\n                          variant=\"ghost\"\r\n                          size=\"sm\"\r\n                          onClick={() => removeTimeSlot(expandedDay, index)}\r\n                          className=\"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20\"\r\n                        >\r\n                          <Trash2 className=\"h-3 w-3\" />\r\n                        </Button>\r\n                      </div>\r\n                    );\r\n                  })\r\n                )}\r\n              </div>\r\n            </div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n\r\n      {/* Save Button */}\r\n      <div className=\"flex justify-end pt-4 border-t border-gray-200 dark:border-gray-800\">\r\n        <Button\r\n          onClick={handleSave}\r\n          disabled={saving || !selectedOfficeId}\r\n          className=\"gap-2\"\r\n        >\r\n          {saving ? (\r\n            <>\r\n              <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n              Guardando...\r\n            </>\r\n          ) : (\r\n            <>\r\n              <Save className=\"h-4 w-4\" />\r\n              Guardar Horarios\r\n            </>\r\n          )}\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\configuracion\\secretaries-section.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Label' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":65,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1714,1717],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1714,1717],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { Label } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@red-salud/ui\";\r\nimport { \r\n  UserPlus, \r\n  Mail, \r\n  Loader2, \r\n  Trash2, \r\n  Shield, \r\n  CheckCircle2,\r\n  XCircle,\r\n  Clock\r\n} from \"lucide-react\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\n\r\ninterface Secretary {\r\n  id: string;\r\n  email: string;\r\n  nombre_completo: string;\r\n  avatar_url: string | null;\r\n  status: \"pending\" | \"active\" | \"inactive\";\r\n  created_at: string;\r\n}\r\n\r\nexport function SecretariesSection() {\r\n  const [loading, setLoading] = useState(true);\r\n  const [secretaries, setSecretaries] = useState<Secretary[]>([]);\r\n  const [inviteEmail, setInviteEmail] = useState(\"\");\r\n  const [inviting, setInviting] = useState(false);\r\n\r\n  useEffect(() => {\r\n    loadSecretaries();\r\n  }, []);\r\n\r\n  const loadSecretaries = async () => {\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) return;\r\n\r\n      const { data, error } = await supabase\r\n        .from(\"doctor_secretaries\")\r\n        .select(`\r\n          id,\r\n          secretary_id,\r\n          status,\r\n          created_at,\r\n          secretary:profiles!doctor_secretaries_secretary_id_fkey(\r\n            id,\r\n            email,\r\n            nombre_completo,\r\n            avatar_url\r\n          )\r\n        `)\r\n        .eq(\"doctor_id\", user.id)\r\n        .order(\"created_at\", { ascending: false });\r\n\r\n      if (error) throw error;\r\n\r\n      if (data) {\r\n        const formattedSecretaries: Secretary[] = data.map((item: any) => ({\r\n          id: item.id,\r\n          email: item.secretary?.email || \"\",\r\n          nombre_completo: item.secretary?.nombre_completo || \"Sin nombre\",\r\n          avatar_url: item.secretary?.avatar_url || null,\r\n          status: item.status,\r\n          created_at: item.created_at,\r\n        }));\r\n        setSecretaries(formattedSecretaries);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error loading secretaries:\", error);\r\n      alert(\"Error al cargar secretarias\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleInvite = async () => {\r\n    if (!inviteEmail.trim()) {\r\n      alert(\"Por favor ingresa un correo electrónico\");\r\n      return;\r\n    }\r\n\r\n    setInviting(true);\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) return;\r\n\r\n      // Verificar si el usuario existe\r\n      const { data: existingUser } = await supabase\r\n        .from(\"profiles\")\r\n        .select(\"id, role\")\r\n        .eq(\"email\", inviteEmail.trim())\r\n        .single();\r\n\r\n      if (!existingUser) {\r\n        alert(\"No existe un usuario con ese correo electrónico\");\r\n        return;\r\n      }\r\n\r\n      if (existingUser.role !== \"secretaria\") {\r\n        alert(\"El usuario debe tener rol de secretaria\");\r\n        return;\r\n      }\r\n\r\n      // Verificar si ya está invitada\r\n      const { data: existing } = await supabase\r\n        .from(\"doctor_secretaries\")\r\n        .select(\"id\")\r\n        .eq(\"doctor_id\", user.id)\r\n        .eq(\"secretary_id\", existingUser.id)\r\n        .single();\r\n\r\n      if (existing) {\r\n        alert(\"Esta secretaria ya está en tu lista\");\r\n        return;\r\n      }\r\n\r\n      // Crear la relación\r\n      const { error } = await supabase\r\n        .from(\"doctor_secretaries\")\r\n        .insert({\r\n          doctor_id: user.id,\r\n          secretary_id: existingUser.id,\r\n          status: \"active\",\r\n        });\r\n\r\n      if (error) throw error;\r\n\r\n      alert(\"Secretaria agregada correctamente\");\r\n      setInviteEmail(\"\");\r\n      loadSecretaries();\r\n    } catch (error) {\r\n      console.error(\"Error inviting secretary:\", error);\r\n      alert(\"Error al agregar secretaria\");\r\n    } finally {\r\n      setInviting(false);\r\n    }\r\n  };\r\n\r\n  const handleRemove = async (secretaryId: string) => {\r\n    if (!confirm(\"¿Estás seguro de eliminar esta secretaria?\")) return;\r\n\r\n    try {\r\n      const { error } = await supabase\r\n        .from(\"doctor_secretaries\")\r\n        .delete()\r\n        .eq(\"id\", secretaryId);\r\n\r\n      if (error) throw error;\r\n\r\n      alert(\"Secretaria eliminada correctamente\");\r\n      loadSecretaries();\r\n    } catch (error) {\r\n      console.error(\"Error removing secretary:\", error);\r\n      alert(\"Error al eliminar secretaria\");\r\n    }\r\n  };\r\n\r\n  const getStatusBadge = (status: string) => {\r\n    const variants = {\r\n      active: { label: \"Activa\", className: \"bg-green-100 text-green-800 border-green-300\", icon: CheckCircle2 },\r\n      pending: { label: \"Pendiente\", className: \"bg-yellow-100 text-yellow-800 border-yellow-300\", icon: Clock },\r\n      inactive: { label: \"Inactiva\", className: \"bg-gray-100 text-gray-800 border-gray-300\", icon: XCircle },\r\n    };\r\n    const variant = variants[status as keyof typeof variants] || variants.pending;\r\n    const Icon = variant.icon;\r\n    \r\n    return (\r\n      <Badge variant=\"outline\" className={variant.className}>\r\n        <Icon className=\"h-3 w-3 mr-1\" />\r\n        {variant.label}\r\n      </Badge>\r\n    );\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center py-12\">\r\n        <Loader2 className=\"h-8 w-8 animate-spin text-blue-600\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Invite Section */}\r\n      <div className=\"bg-gradient-to-r from-purple-50 to-blue-50 border border-purple-200 rounded-lg p-6\">\r\n        <div className=\"flex items-start gap-4\">\r\n          <div className=\"p-3 bg-purple-100 rounded-lg\">\r\n            <UserPlus className=\"h-6 w-6 text-purple-600\" />\r\n          </div>\r\n          <div className=\"flex-1\">\r\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">\r\n              Agregar Secretaria\r\n            </h3>\r\n            <p className=\"text-sm text-gray-600 mb-4\">\r\n              Ingresa el correo electrónico de la secretaria que deseas agregar a tu equipo\r\n            </p>\r\n            <div className=\"flex gap-3\">\r\n              <div className=\"flex-1\">\r\n                <Input\r\n                  type=\"email\"\r\n                  placeholder=\"secretaria@ejemplo.com\"\r\n                  value={inviteEmail}\r\n                  onChange={(e) => setInviteEmail(e.target.value)}\r\n                  onKeyPress={(e) => e.key === \"Enter\" && handleInvite()}\r\n                />\r\n              </div>\r\n              <Button onClick={handleInvite} disabled={inviting}>\r\n                {inviting ? (\r\n                  <>\r\n                    <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\r\n                    Agregando...\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <Mail className=\"h-4 w-4 mr-2\" />\r\n                    Agregar\r\n                  </>\r\n                )}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Secretaries List */}\r\n      <div>\r\n        <div className=\"flex items-center justify-between mb-4\">\r\n          <h3 className=\"text-lg font-semibold text-gray-900\">\r\n            Secretarias ({secretaries.length})\r\n          </h3>\r\n        </div>\r\n\r\n        {secretaries.length === 0 ? (\r\n          <div className=\"text-center py-12 border-2 border-dashed rounded-lg\">\r\n            <Shield className=\"h-12 w-12 mx-auto text-gray-400 mb-3\" />\r\n            <p className=\"text-gray-600 font-medium\">No tienes secretarias agregadas</p>\r\n            <p className=\"text-sm text-gray-500 mt-1\">\r\n              Agrega secretarias para que puedan gestionar tu agenda\r\n            </p>\r\n          </div>\r\n        ) : (\r\n          <div className=\"space-y-3\">\r\n            {secretaries.map((secretary) => (\r\n              <div\r\n                key={secretary.id}\r\n                className=\"flex items-center justify-between p-4 border rounded-lg hover:border-purple-300 hover:shadow-md transition-all\"\r\n              >\r\n                <div className=\"flex items-center gap-4\">\r\n                  <Avatar className=\"h-12 w-12\">\r\n                    <AvatarImage src={secretary.avatar_url || undefined} />\r\n                    <AvatarFallback>\r\n                      {secretary.nombre_completo.split(\" \").map(n => n[0]).join(\"\").toUpperCase().slice(0, 2)}\r\n                    </AvatarFallback>\r\n                  </Avatar>\r\n                  <div>\r\n                    <h4 className=\"font-semibold text-gray-900\">{secretary.nombre_completo}</h4>\r\n                    <p className=\"text-sm text-gray-600\">{secretary.email}</p>\r\n                    <p className=\"text-xs text-gray-500 mt-1\">\r\n                      Agregada el {new Date(secretary.created_at).toLocaleDateString(\"es-MX\")}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n                <div className=\"flex items-center gap-3\">\r\n                  {getStatusBadge(secretary.status)}\r\n                  <Button\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    onClick={() => handleRemove(secretary.id)}\r\n                    className=\"text-red-600 hover:text-red-700 hover:bg-red-50\"\r\n                  >\r\n                    <Trash2 className=\"h-4 w-4\" />\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Info Section */}\r\n      <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\r\n        <h4 className=\"font-semibold text-gray-900 mb-2 flex items-center gap-2\">\r\n          <Shield className=\"h-5 w-5 text-blue-600\" />\r\n          Permisos de Secretarias\r\n        </h4>\r\n        <ul className=\"text-sm text-gray-600 space-y-1 ml-7\">\r\n          <li>• Ver y gestionar tu agenda de citas</li>\r\n          <li>• Crear, modificar y cancelar citas</li>\r\n          <li>• Ver información básica de pacientes</li>\r\n          <li>• Enviar recordatorios de citas</li>\r\n        </ul>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\configuracion\\security-section.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'currentPassword' is assigned a value but never used.","line":21,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { Label } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { \r\n  Shield, \r\n  Key, \r\n  Smartphone, \r\n  Lock, \r\n  CheckCircle2,\r\n  AlertTriangle,\r\n  Loader2\r\n} from \"lucide-react\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\n\r\nexport function SecuritySection() {\r\n  const [changingPassword, setChangingPassword] = useState(false);\r\n  const [currentPassword, setCurrentPassword] = useState(\"\");\r\n  const [newPassword, setNewPassword] = useState(\"\");\r\n  const [confirmPassword, setConfirmPassword] = useState(\"\");\r\n\r\n  const handleChangePassword = async () => {\r\n    if (!newPassword || !confirmPassword) {\r\n      alert(\"Por favor completa todos los campos\");\r\n      return;\r\n    }\r\n\r\n    if (newPassword !== confirmPassword) {\r\n      alert(\"Las contraseñas no coinciden\");\r\n      return;\r\n    }\r\n\r\n    if (newPassword.length < 8) {\r\n      alert(\"La contraseña debe tener al menos 8 caracteres\");\r\n      return;\r\n    }\r\n\r\n    setChangingPassword(true);\r\n    try {\r\n      const { error } = await supabase.auth.updateUser({\r\n        password: newPassword,\r\n      });\r\n\r\n      if (error) throw error;\r\n\r\n      alert(\"Contraseña actualizada correctamente\");\r\n      setCurrentPassword(\"\");\r\n      setNewPassword(\"\");\r\n      setConfirmPassword(\"\");\r\n    } catch (error) {\r\n      console.error(\"Error changing password:\", error);\r\n      alert(\"Error al cambiar la contraseña\");\r\n    } finally {\r\n      setChangingPassword(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Security Status */}\r\n      <div className=\"bg-green-50 border border-green-200 rounded-lg p-4\">\r\n        <div className=\"flex items-start gap-3\">\r\n          <CheckCircle2 className=\"h-6 w-6 text-green-600 flex-shrink-0 mt-0.5\" />\r\n          <div>\r\n            <h3 className=\"font-semibold text-gray-900 mb-1\">\r\n              Tu cuenta está protegida\r\n            </h3>\r\n            <p className=\"text-sm text-gray-600\">\r\n              Mantén tu información segura siguiendo las mejores prácticas de seguridad\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Change Password */}\r\n      <div className=\"border rounded-lg p-6\">\r\n        <div className=\"flex items-center gap-3 mb-4\">\r\n          <div className=\"p-2 bg-blue-100 rounded-lg\">\r\n            <Key className=\"h-5 w-5 text-blue-600\" />\r\n          </div>\r\n          <div>\r\n            <h3 className=\"font-semibold text-gray-900\">Cambiar Contraseña</h3>\r\n            <p className=\"text-sm text-gray-600\">\r\n              Actualiza tu contraseña regularmente para mayor seguridad\r\n            </p>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"space-y-4\">\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"new-password\">Nueva Contraseña</Label>\r\n            <Input\r\n              id=\"new-password\"\r\n              type=\"password\"\r\n              value={newPassword}\r\n              onChange={(e) => setNewPassword(e.target.value)}\r\n              placeholder=\"Mínimo 8 caracteres\"\r\n            />\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"confirm-password\">Confirmar Contraseña</Label>\r\n            <Input\r\n              id=\"confirm-password\"\r\n              type=\"password\"\r\n              value={confirmPassword}\r\n              onChange={(e) => setConfirmPassword(e.target.value)}\r\n              placeholder=\"Repite la nueva contraseña\"\r\n            />\r\n          </div>\r\n\r\n          <Button \r\n            onClick={handleChangePassword} \r\n            disabled={changingPassword}\r\n            className=\"w-full\"\r\n          >\r\n            {changingPassword ? (\r\n              <>\r\n                <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\r\n                Actualizando...\r\n              </>\r\n            ) : (\r\n              <>\r\n                <Lock className=\"h-4 w-4 mr-2\" />\r\n                Actualizar Contraseña\r\n              </>\r\n            )}\r\n          </Button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Two-Factor Authentication */}\r\n      <div className=\"border rounded-lg p-6\">\r\n        <div className=\"flex items-start justify-between\">\r\n          <div className=\"flex items-center gap-3\">\r\n            <div className=\"p-2 bg-purple-100 rounded-lg\">\r\n              <Smartphone className=\"h-5 w-5 text-purple-600\" />\r\n            </div>\r\n            <div>\r\n              <h3 className=\"font-semibold text-gray-900\">\r\n                Autenticación de Dos Factores\r\n              </h3>\r\n              <p className=\"text-sm text-gray-600 mt-1\">\r\n                Agrega una capa extra de seguridad a tu cuenta\r\n              </p>\r\n              <Badge variant=\"secondary\" className=\"mt-2\">\r\n                Próximamente\r\n              </Badge>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Active Sessions */}\r\n      <div className=\"border rounded-lg p-6\">\r\n        <div className=\"flex items-center gap-3 mb-4\">\r\n          <div className=\"p-2 bg-orange-100 rounded-lg\">\r\n            <Shield className=\"h-5 w-5 text-orange-600\" />\r\n          </div>\r\n          <div>\r\n            <h3 className=\"font-semibold text-gray-900\">Sesiones Activas</h3>\r\n            <p className=\"text-sm text-gray-600\">\r\n              Gestiona los dispositivos donde has iniciado sesión\r\n            </p>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"space-y-3\">\r\n          <div className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"p-2 bg-white rounded-lg border\">\r\n                <Smartphone className=\"h-4 w-4 text-gray-600\" />\r\n              </div>\r\n              <div>\r\n                <p className=\"font-medium text-sm\">Sesión Actual</p>\r\n                <p className=\"text-xs text-gray-500\">Windows • Chrome</p>\r\n              </div>\r\n            </div>\r\n            <Badge variant=\"outline\" className=\"bg-green-100 text-green-800 border-green-300\">\r\n              Activa\r\n            </Badge>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Security Recommendations */}\r\n      <div className=\"bg-yellow-50 border border-yellow-200 rounded-lg p-4\">\r\n        <div className=\"flex items-start gap-3\">\r\n          <AlertTriangle className=\"h-5 w-5 text-yellow-600 flex-shrink-0 mt-0.5\" />\r\n          <div>\r\n            <h4 className=\"font-semibold text-gray-900 mb-2\">\r\n              Recomendaciones de Seguridad\r\n            </h4>\r\n            <ul className=\"text-sm text-gray-600 space-y-1\">\r\n              <li>• Usa una contraseña única y segura</li>\r\n              <li>• No compartas tu contraseña con nadie</li>\r\n              <li>• Cierra sesión en dispositivos compartidos</li>\r\n              <li>• Revisa regularmente tu actividad de cuenta</li>\r\n            </ul>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\configuracion\\shortcuts-section.tsx","messages":[{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":9,"column":5,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":9,"endColumn":18,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[304,317],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[366,369],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[366,369],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\configuracion\\shortcuts-section.tsx:14:9\n  12 |\n  13 |     useEffect(() => {\n> 14 |         setShortcuts(getStoredShortcuts());\n     |         ^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  15 |     }, []);\n  16 |\n  17 |     const handleKeyRecord = (action: string) => {","line":14,"column":9,"nodeType":null,"endLine":14,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2095,2098],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2095,2098],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { Keyboard, RotateCcw } from \"lucide-react\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { getStoredShortcuts, saveShortcut, DEFAULT_SHORTCUTS } from \"@/hooks/use-keyboard-shortcuts\";\r\n\r\nexport function ShortcutsSection() {\r\n    // @ts-ignore\r\n    const [shortcuts, setShortcuts] = useState<any>(DEFAULT_SHORTCUTS);\r\n    const [editing, setEditing] = useState<string | null>(null);\r\n\r\n    useEffect(() => {\r\n        setShortcuts(getStoredShortcuts());\r\n    }, []);\r\n\r\n    const handleKeyRecord = (action: string) => {\r\n        setEditing(action);\r\n    };\r\n\r\n    const handleKeyDown = (e: React.KeyboardEvent, action: string) => {\r\n        e.preventDefault();\r\n        if (e.key === 'Escape') {\r\n            setEditing(null);\r\n            return;\r\n        }\r\n\r\n        // Guardar solo teclas simples por ahora para evitar conflictos complejos\r\n        if (['Control', 'Shift', 'Alt', 'Meta'].includes(e.key)) return;\r\n\r\n        saveShortcut(action, e.key);\r\n        setShortcuts(getStoredShortcuts());\r\n        setEditing(null);\r\n    };\r\n\r\n    const handleReset = () => {\r\n        localStorage.removeItem('red-salud-shortcuts');\r\n        setShortcuts(DEFAULT_SHORTCUTS);\r\n        window.dispatchEvent(new Event('shortcuts-updated'));\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex items-center justify-between border-b pb-4\">\r\n                <div>\r\n                    <h2 className=\"text-xl font-semibold text-gray-900\">Atajos de Teclado</h2>\r\n                    <p className=\"text-sm text-gray-500\">Personaliza las teclas rápidas para agilizar tu flujo de trabajo.</p>\r\n                </div>\r\n                <Button variant=\"outline\" size=\"sm\" onClick={handleReset}>\r\n                    <RotateCcw className=\"h-4 w-4 mr-2\" />\r\n                    Restaurar\r\n                </Button>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n                {Object.entries(shortcuts).map(([action, config]: [string, any]) => (\r\n                    <div\r\n                        key={action}\r\n                        className={`p-4 rounded-lg border transition-all ${editing === action ? \"ring-2 ring-blue-500 border-blue-500 bg-blue-50\" : \"bg-white hover:border-blue-300\"\r\n                            }`}\r\n                    >\r\n                        <div className=\"flex justify-between items-start mb-2\">\r\n                            <span className=\"font-medium text-gray-700\">{config.description}</span>\r\n                            <Keyboard className=\"h-4 w-4 text-gray-400\" />\r\n                        </div>\r\n\r\n                        <div className=\"mt-2\">\r\n                            {editing === action ? (\r\n                                <input\r\n                                    autoFocus\r\n                                    readOnly\r\n                                    value=\"Presiona una tecla...\"\r\n                                    onKeyDown={(e) => handleKeyDown(e, action)}\r\n                                    onBlur={() => setEditing(null)}\r\n                                    className=\"w-full text-center text-sm font-bold text-blue-600 bg-white border rounded py-1 px-2 focus:outline-none\"\r\n                                />\r\n                            ) : (\r\n                                <button\r\n                                    onClick={() => handleKeyRecord(action)}\r\n                                    className=\"w-full text-left\"\r\n                                >\r\n                                    <kbd className=\"inline-flex items-center justify-center min-w-[30px] px-2 py-1 text-xs font-bold text-gray-800 bg-gray-100 border border-gray-200 rounded shadow-sm\">\r\n                                        {config.key.toUpperCase()}\r\n                                    </kbd>\r\n                                    <span className=\"text-xs text-gray-400 ml-2\">Click para editar</span>\r\n                                </button>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\consulta\\consultation-patient-search.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'User' is defined but never used.","line":4,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CreditCard' is defined but never used.","line":4,"column":36,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":46},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Badge' is defined but never used.","line":10,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleClear' is assigned a value but never used.","line":38,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport { Loader2, Search, User, X, CreditCard, Stethoscope } from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { validateCedulaWithCNE } from \"@/lib/services/cedula-validation\";\r\nimport { toast } from \"sonner\";\r\nimport { Badge } from \"@red-salud/ui\";\r\n\r\nexport interface PatientOption {\r\n    id: string;\r\n    nombre_completo: string;\r\n    cedula: string | null;\r\n    type: \"registered\" | \"offline\";\r\n    email: string | null;\r\n}\r\n\r\ninterface ConsultationPatientSearchProps {\r\n    patients: PatientOption[];\r\n    onPatientFound: (patient: PatientOption) => void;\r\n    onCnePatientFound: (cedula: string, nombre: string) => void;\r\n    className?: string;\r\n}\r\n\r\nexport function ConsultationPatientSearch({\r\n    patients,\r\n    onPatientFound,\r\n    onCnePatientFound,\r\n    className,\r\n}: ConsultationPatientSearchProps) {\r\n    const [cedulaInput, setCedulaInput] = React.useState(\"\");\r\n    const [loading, setLoading] = React.useState(false);\r\n    const [notFound, setNotFound] = React.useState(false);\r\n\r\n    // Limpiar búsqueda\r\n    const handleClear = () => {\r\n        setCedulaInput(\"\");\r\n        setNotFound(false);\r\n    };\r\n\r\n    // Manejar cambio en input\r\n    const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const val = e.target.value.replace(/\\D/g, \"\"); // Solo números\r\n        setCedulaInput(val);\r\n        setNotFound(false);\r\n    };\r\n\r\n    // Efecto de búsqueda\r\n    React.useEffect(() => {\r\n        // Si el input está vacío o es muy corto, no buscar\r\n        if (cedulaInput.length < 6) return;\r\n\r\n        const search = async () => {\r\n            setLoading(true);\r\n            setNotFound(false);\r\n\r\n            try {\r\n                // 1. Buscar localmente\r\n                const localPatient = patients.find(p => p.cedula === cedulaInput);\r\n                \r\n                if (localPatient) {\r\n                    onPatientFound(localPatient);\r\n                    setLoading(false);\r\n                    return;\r\n                }\r\n\r\n                // 2. Buscar en CNE (Remoto)\r\n                const result = await validateCedulaWithCNE(cedulaInput);\r\n\r\n                if (result.found && result.nombre_completo) {\r\n                    toast.success(\"Paciente encontrado en CNE\");\r\n                    onCnePatientFound(cedulaInput, result.nombre_completo);\r\n                } else {\r\n                    setNotFound(true);\r\n                }\r\n\r\n            } catch (error) {\r\n                console.error(\"Error buscando paciente:\", error);\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n\r\n        const timer = setTimeout(search, 800);\r\n        return () => clearTimeout(timer);\r\n\r\n    }, [cedulaInput, patients, onPatientFound, onCnePatientFound]);\r\n\r\n\r\n    return (\r\n        <div className={cn(\"space-y-3\", className)}>\r\n            <div className=\"relative\">\r\n                <div className=\"relative\">\r\n                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground\" />\r\n                    <Input\r\n                        placeholder=\"Ingrese cédula para iniciar consulta...\"\r\n                        value={cedulaInput}\r\n                        onChange={handleInputChange}\r\n                        className=\"pl-10 h-14 text-lg shadow-sm border-2 focus-visible:ring-offset-0 focus-visible:border-primary\"\r\n                        maxLength={9}\r\n                        autoFocus\r\n                    />\r\n                    {loading && (\r\n                        <div className=\"absolute right-3 top-1/2 -translate-y-1/2 bg-background p-1 rounded-full\">\r\n                            <Loader2 className=\"h-5 w-5 animate-spin text-primary\" />\r\n                        </div>\r\n                    )}\r\n                </div>\r\n                \r\n                {notFound && !loading && cedulaInput.length >= 6 && (\r\n                        <div className=\"mt-2 text-sm text-red-600 bg-red-50 dark:bg-red-900/20 p-3 rounded-md border border-red-200 dark:border-red-900 flex items-center gap-2 animate-in fade-in slide-in-from-top-2\">\r\n                        <X className=\"h-4 w-4\" />\r\n                        No se encontró ningún paciente con la cédula V-{cedulaInput}\r\n                        </div>\r\n                )}\r\n                    <div className=\"mt-2 px-1 text-xs text-muted-foreground flex items-center gap-1.5\">\r\n                    <Stethoscope className=\"h-3.5 w-3.5\" />\r\n                    <span>Ingrese cédula para acceder directamente a la consulta</span>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\consulta\\hooks\\use-consultation.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":135,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":135,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5518,5521],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5518,5521],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":321,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":321,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12869,12872],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12869,12872],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect, useCallback } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\n\r\ninterface Appointment {\r\n    id: string;\r\n    paciente_id: string | null;\r\n    offline_patient_id: string | null;\r\n    medico_id: string;\r\n    fecha_hora: string;\r\n    motivo: string;\r\n    status: string;\r\n    tipo_cita: string;\r\n    medical_record_id: string | null;\r\n}\r\n\r\ninterface PatientData {\r\n    id: string;\r\n    nombre_completo: string;\r\n    cedula: string;\r\n    fecha_nacimiento: string | null;\r\n    genero: string | null;\r\n    telefono: string | null;\r\n    email: string | null;\r\n    avatar_url?: string | null;\r\n}\r\n\r\nexport function useConsultation(appointmentId: string | null, pacienteId: string | null, fromPage: string | null) {\r\n    const router = useRouter();\r\n    const [appointment, setAppointment] = useState<Appointment | null>(null);\r\n    const [patient, setPatient] = useState<PatientData | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [saving, setSaving] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [lastSaved, setLastSaved] = useState<Date | null>(null);\r\n    const [autoSaving, setAutoSaving] = useState(false);\r\n\r\n    // Estados del formulario médico\r\n    const [alergias, setAlergias] = useState<string[]>([]);\r\n    const [condicionesCronicas, setCondicionesCronicas] = useState<string[]>([]);\r\n    const [medicamentosActuales, setMedicamentosActuales] = useState<string[]>([]);\r\n    const [notasMedicas, setNotasMedicas] = useState(\"\");\r\n    const [diagnosticos, setDiagnosticos] = useState<string[]>([]);\r\n    const [tratamiento, setTratamiento] = useState(\"\");\r\n    const [observaciones, setObservaciones] = useState(\"\");\r\n\r\n    const loadData = useCallback(async () => {\r\n        try {\r\n            const { data: { user } } = await supabase.auth.getUser();\r\n            if (!user) {\r\n                router.push(\"/login/medico\");\r\n                return;\r\n            }\r\n\r\n            // Cargar cita\r\n            const { data: aptData, error: aptError } = await supabase\r\n                .from(\"appointments\")\r\n                .select(\"*\")\r\n                .eq(\"id\", appointmentId)\r\n                .single();\r\n\r\n            if (aptError) throw aptError;\r\n            setAppointment(aptData);\r\n\r\n            // Cargar datos del paciente\r\n            let patientData: PatientData | null = null;\r\n\r\n            if (aptData.paciente_id) {\r\n                // Paciente registrado\r\n                const { data: profileData, error: profileError } = await supabase\r\n                    .from(\"profiles\")\r\n                    .select(\"id, nombre_completo, cedula, fecha_nacimiento, telefono, email, avatar_url\")\r\n                    .eq(\"id\", aptData.paciente_id)\r\n                    .single();\r\n\r\n                if (profileError) throw profileError;\r\n                patientData = { ...profileData, genero: null };\r\n\r\n                // Cargar detalles adicionales del paciente\r\n                const { data: detailsData } = await supabase\r\n                    .from(\"patient_details\")\r\n                    .select(\"*\")\r\n                    .eq(\"profile_id\", aptData.paciente_id)\r\n                    .single();\r\n\r\n                if (detailsData) {\r\n                    setAlergias(detailsData.alergias || []);\r\n                    setCondicionesCronicas(detailsData.enfermedades_cronicas || []);\r\n                    setMedicamentosActuales(detailsData.medicamentos_actuales?.split(\",\").filter(Boolean) || []);\r\n                }\r\n            } else if (aptData.offline_patient_id) {\r\n                // Paciente offline\r\n                const { data: offlineData, error: offlineError } = await supabase\r\n                    .from(\"offline_patients\")\r\n                    .select(\"*\")\r\n                    .eq(\"id\", aptData.offline_patient_id)\r\n                    .single();\r\n\r\n                if (offlineError) throw offlineError;\r\n                patientData = {\r\n                    id: offlineData.id,\r\n                    nombre_completo: offlineData.nombre_completo,\r\n                    cedula: offlineData.cedula,\r\n                    fecha_nacimiento: offlineData.fecha_nacimiento,\r\n                    genero: offlineData.genero,\r\n                    telefono: offlineData.telefono,\r\n                    email: offlineData.email,\r\n                };\r\n\r\n                setAlergias(offlineData.alergias || []);\r\n                setCondicionesCronicas(offlineData.condiciones_cronicas || []);\r\n                setMedicamentosActuales(offlineData.medicamentos_actuales || []);\r\n                setNotasMedicas(offlineData.notas_medico || \"\");\r\n            }\r\n\r\n            setPatient(patientData);\r\n\r\n            // Si ya existe un medical_record, cargarlo\r\n            if (aptData.medical_record_id) {\r\n                const { data: recordData } = await supabase\r\n                    .from(\"medical_records\")\r\n                    .select(\"*\")\r\n                    .eq(\"id\", aptData.medical_record_id)\r\n                    .single();\r\n\r\n                if (recordData) {\r\n                    setDiagnosticos(recordData.diagnostico?.split(\",\").filter(Boolean) || []);\r\n                    setNotasMedicas(recordData.sintomas || \"\");\r\n                    setTratamiento(recordData.tratamiento || \"\");\r\n                    setObservaciones(recordData.observaciones || \"\");\r\n                }\r\n            }\r\n        } catch (err: any) {\r\n            console.error(\"Error loading data:\", err);\r\n            setError(err.message || \"Error al cargar los datos\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }, [appointmentId, router]);\r\n\r\n    useEffect(() => {\r\n        if (!appointmentId || !pacienteId) {\r\n            setError(\"Faltan parámetros requeridos\");\r\n            setLoading(false);\r\n            return;\r\n        }\r\n        loadData();\r\n    }, [appointmentId, pacienteId, loadData]);\r\n\r\n    // Autoguardado\r\n    useEffect(() => {\r\n        if (!appointment || !patient || loading) return;\r\n\r\n        const autoSave = async () => {\r\n            if (!notasMedicas && diagnosticos.length === 0 && !tratamiento) return;\r\n\r\n            setAutoSaving(true);\r\n            try {\r\n                const { data: { user } } = await supabase.auth.getUser();\r\n                if (!user) return;\r\n\r\n                const medicalRecordData = {\r\n                    paciente_id: appointment.paciente_id || appointment.offline_patient_id,\r\n                    medico_id: user.id,\r\n                    appointment_id: appointment.id,\r\n                    diagnostico: diagnosticos.join(\", \"),\r\n                    sintomas: notasMedicas,\r\n                    tratamiento: tratamiento,\r\n                    observaciones: observaciones,\r\n                    medicamentos: medicamentosActuales.join(\", \"),\r\n                };\r\n\r\n                const medicalRecordId = appointment.medical_record_id;\r\n\r\n                if (medicalRecordId) {\r\n                    await supabase\r\n                        .from(\"medical_records\")\r\n                        .update(medicalRecordData)\r\n                        .eq(\"id\", medicalRecordId);\r\n                } else {\r\n                    const { data: newRecord } = await supabase\r\n                        .from(\"medical_records\")\r\n                        .insert(medicalRecordData)\r\n                        .select()\r\n                        .single();\r\n\r\n                    if (newRecord) {\r\n                        await supabase\r\n                            .from(\"appointments\")\r\n                            .update({ medical_record_id: newRecord.id })\r\n                            .eq(\"id\", appointment.id);\r\n\r\n                        setAppointment(prev => prev ? { ...prev, medical_record_id: newRecord.id } : null);\r\n                    }\r\n                }\r\n\r\n                setLastSaved(new Date());\r\n            } catch (err) {\r\n                console.error(\"Error autoguardando:\", err);\r\n            } finally {\r\n                setAutoSaving(false);\r\n            }\r\n        };\r\n\r\n        const interval = setInterval(autoSave, 30000);\r\n        return () => clearInterval(interval);\r\n    }, [appointment, patient, notasMedicas, diagnosticos, tratamiento, observaciones, medicamentosActuales, loading]);\r\n\r\n    const saveConsultation = async () => {\r\n        if (!appointment || !patient) return;\r\n\r\n        setSaving(true);\r\n        try {\r\n            const { data: { user } } = await supabase.auth.getUser();\r\n            if (!user) {\r\n                router.push(\"/login/medico\");\r\n                return;\r\n            }\r\n\r\n            // 1. Crear o actualizar medical_record\r\n            const medicalRecordData = {\r\n                paciente_id: appointment.paciente_id || appointment.offline_patient_id,\r\n                medico_id: user.id,\r\n                appointment_id: appointment.id,\r\n                diagnostico: diagnosticos.join(\", \"),\r\n                sintomas: notasMedicas,\r\n                tratamiento: tratamiento,\r\n                observaciones: observaciones,\r\n                medicamentos: medicamentosActuales.join(\", \"),\r\n            };\r\n\r\n            let medicalRecordId = appointment.medical_record_id;\r\n\r\n            if (medicalRecordId) {\r\n                const { error: updateError } = await supabase\r\n                    .from(\"medical_records\")\r\n                    .update(medicalRecordData)\r\n                    .eq(\"id\", medicalRecordId);\r\n\r\n                if (updateError) throw updateError;\r\n            } else {\r\n                const { data: newRecord, error: insertError } = await supabase\r\n                    .from(\"medical_records\")\r\n                    .insert(medicalRecordData)\r\n                    .select()\r\n                    .single();\r\n\r\n                if (insertError) throw insertError;\r\n                medicalRecordId = newRecord.id;\r\n\r\n                await supabase\r\n                    .from(\"appointments\")\r\n                    .update({ medical_record_id: medicalRecordId })\r\n                    .eq(\"id\", appointment.id);\r\n            }\r\n\r\n            // 2. Actualizar datos del paciente\r\n            if (appointment.offline_patient_id) {\r\n                await supabase\r\n                    .from(\"offline_patients\")\r\n                    .update({\r\n                        alergias: alergias.length > 0 ? alergias : null,\r\n                        condiciones_cronicas: condicionesCronicas.length > 0 ? condicionesCronicas : null,\r\n                        medicamentos_actuales: medicamentosActuales.length > 0 ? medicamentosActuales : null,\r\n                    })\r\n                    .eq(\"id\", appointment.offline_patient_id);\r\n            } else if (appointment.paciente_id) {\r\n                const { data: existingDetails } = await supabase\r\n                    .from(\"patient_details\")\r\n                    .select(\"id\")\r\n                    .eq(\"profile_id\", appointment.paciente_id)\r\n                    .single();\r\n\r\n                const detailsData = {\r\n                    alergias: alergias.length > 0 ? alergias : null,\r\n                    enfermedades_cronicas: condicionesCronicas.length > 0 ? condicionesCronicas : null,\r\n                    medicamentos_actuales: medicamentosActuales.join(\", \"),\r\n                };\r\n\r\n                if (existingDetails) {\r\n                    await supabase\r\n                        .from(\"patient_details\")\r\n                        .update(detailsData)\r\n                        .eq(\"profile_id\", appointment.paciente_id);\r\n                } else {\r\n                    await supabase\r\n                        .from(\"patient_details\")\r\n                        .insert({\r\n                            profile_id: appointment.paciente_id,\r\n                            ...detailsData,\r\n                        });\r\n                }\r\n            }\r\n\r\n            // 3. Cambiar estado de la cita\r\n            const { error: rpcError } = await supabase.rpc(\"change_appointment_status\", {\r\n                p_appointment_id: appointment.id,\r\n                p_new_status: \"completada\",\r\n                p_user_id: user.id,\r\n                p_reason: null,\r\n            });\r\n\r\n            if (rpcError) throw rpcError;\r\n\r\n            // 4. Log de actividad\r\n            await supabase.from(\"user_activity_log\").insert({\r\n                user_id: user.id,\r\n                activity_type: \"consultation_completed\",\r\n                description: `Consulta completada para ${patient.nombre_completo}`,\r\n                status: \"success\",\r\n            });\r\n\r\n            // 5. Redirigir\r\n            if (fromPage === \"today\") {\r\n                router.push(\"/dashboard/medico/pacientes\");\r\n            } else {\r\n                router.push(\"/dashboard/medico/citas\");\r\n            }\r\n        } catch (err: any) {\r\n            console.error(\"Error saving consultation:\", err);\r\n            alert(err.message || \"Error al guardar la consulta\");\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    return {\r\n        appointment,\r\n        patient,\r\n        loading,\r\n        saving,\r\n        error,\r\n        lastSaved,\r\n        autoSaving,\r\n        alergias,\r\n        setAlergias,\r\n        condicionesCronicas,\r\n        setCondicionesCronicas,\r\n        medicamentosActuales,\r\n        setMedicamentosActuales,\r\n        notasMedicas,\r\n        setNotasMedicas,\r\n        diagnosticos,\r\n        setDiagnosticos,\r\n        tratamiento,\r\n        setTratamiento,\r\n        observaciones,\r\n        setObservaciones,\r\n        saveConsultation,\r\n    };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\consulta\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\consulta\\widgets\\active-consultations.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardHeader' is defined but never used.","line":6,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardTitle' is defined but never used.","line":6,"column":41,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":50},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Loader2' is defined but never used.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":103,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3426,3429],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3426,3429],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Loader2, Play, CalendarClock, RefreshCw } from \"lucide-react\";\r\nimport { format } from \"date-fns\";\r\nimport { es } from \"date-fns/locale\";\r\n\r\ninterface ActiveConsultation {\r\n  id: string;\r\n  fecha_hora: string;\r\n  paciente?: { id: string; nombre_completo: string; cedula: string } | null;\r\n  offline_patient?: {\r\n    id: string;\r\n    nombre_completo: string;\r\n    cedula: string;\r\n  } | null;\r\n  motivo: string;\r\n}\r\n\r\nexport function ActiveConsultationsWidget() {\r\n  const router = useRouter();\r\n  const [consultations, setConsultations] = useState<ActiveConsultation[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const fetchActiveConsultations = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const {\r\n        data: { user },\r\n      } = await supabase.auth.getUser();\r\n      if (!user) return;\r\n\r\n      // 1. Buscar citas básicas sin joins para evitar errores de relación\r\n      const { data: appointmentsData, error: appointmentsError } =\r\n        await supabase\r\n          .from(\"appointments\")\r\n          .select(\r\n            `\r\n          id,\r\n          fecha_hora,\r\n          motivo,\r\n          status,\r\n          medical_record_id,\r\n          paciente_id,\r\n          offline_patient_id\r\n        `,\r\n          )\r\n          .eq(\"medico_id\", user.id)\r\n          .not(\"medical_record_id\", \"is\", null)\r\n          .not(\"status\", \"in\", '(\"completada\",\"cancelada\",\"no_asistio\")')\r\n          .order(\"fecha_hora\", { ascending: false });\r\n\r\n      if (appointmentsError) throw appointmentsError;\r\n\r\n      if (!appointmentsData || appointmentsData.length === 0) {\r\n        setConsultations([]);\r\n        return;\r\n      }\r\n\r\n      // 2. Obtener IDs únicos\r\n      const patientIds = Array.from(\r\n        new Set(appointmentsData.map((a) => a.paciente_id).filter(Boolean)),\r\n      ) as string[];\r\n      const offlineIds = Array.from(\r\n        new Set(\r\n          appointmentsData.map((a) => a.offline_patient_id).filter(Boolean),\r\n        ),\r\n      ) as string[];\r\n\r\n      // 3. Consultar datos de pacientes en paralelo\r\n      const [patientsRes, offlineRes] = await Promise.all([\r\n        patientIds.length > 0\r\n          ? supabase\r\n              .from(\"profiles\")\r\n              .select(\"id, nombre_completo, cedula\")\r\n              .in(\"id\", patientIds)\r\n          : Promise.resolve({ data: [], error: null }),\r\n        offlineIds.length > 0\r\n          ? supabase\r\n              .from(\"offline_patients\")\r\n              .select(\"id, nombre_completo, cedula\")\r\n              .in(\"id\", offlineIds)\r\n          : Promise.resolve({ data: [], error: null }),\r\n      ]);\r\n\r\n      const patientsMap = new Map(patientsRes.data?.map((p) => [p.id, p]));\r\n      const offlineMap = new Map(offlineRes.data?.map((p) => [p.id, p]));\r\n\r\n      // 4. Combinar resultados\r\n      const combinedData = appointmentsData.map((apt) => ({\r\n        ...apt,\r\n        paciente: apt.paciente_id ? patientsMap.get(apt.paciente_id) : null,\r\n        offline_patient: apt.offline_patient_id\r\n          ? offlineMap.get(apt.offline_patient_id)\r\n          : null,\r\n      }));\r\n\r\n      setConsultations(combinedData as any[]);\r\n    } catch (err) {\r\n      console.error(\r\n        \"Error fetching active consultations:\",\r\n        JSON.stringify(err, null, 2),\r\n      );\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchActiveConsultations();\r\n  }, []);\r\n\r\n  if (!loading && consultations.length === 0) return null;\r\n\r\n  return (\r\n    <div className=\"mb-6 animate-in fade-in slide-in-from-top-4 duration-500\">\r\n      <div className=\"flex items-center justify-between mb-3\">\r\n        <div className=\"flex items-center gap-2\">\r\n          <div className=\"h-2 w-2 rounded-full bg-green-500 animate-pulse\" />\r\n          <h3 className=\"font-semibold text-lg text-green-700 dark:text-green-400\">\r\n            Consulta en Progreso\r\n          </h3>\r\n        </div>\r\n        <Button\r\n          variant=\"ghost\"\r\n          size=\"sm\"\r\n          onClick={fetchActiveConsultations}\r\n          className=\"h-8 w-8 p-0\"\r\n          disabled={loading}\r\n        >\r\n          <RefreshCw className={`h-4 w-4 ${loading ? \"animate-spin\" : \"\"}`} />\r\n        </Button>\r\n      </div>\r\n      <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\r\n        {consultations.map((consultation) => {\r\n          const patientName =\r\n            consultation.paciente?.nombre_completo ||\r\n            consultation.offline_patient?.nombre_completo ||\r\n            \"Paciente sin nombre\";\r\n          const patientCedula =\r\n            consultation.paciente?.cedula ||\r\n            consultation.offline_patient?.cedula;\r\n\r\n          return (\r\n            <Card\r\n              key={consultation.id}\r\n              className=\"border-green-200 dark:border-green-900 bg-green-50/50 dark:bg-green-900/10 shadow-sm hover:shadow-md transition-all\"\r\n            >\r\n              <CardContent className=\"p-4\">\r\n                <div className=\"flex justify-between items-start mb-2\">\r\n                  <div>\r\n                    <h4\r\n                      className=\"font-bold text-foreground truncate max-w-[200px]\"\r\n                      title={patientName}\r\n                    >\r\n                      {patientName}\r\n                    </h4>\r\n                    {patientCedula && (\r\n                      <p className=\"text-xs text-muted-foreground\">\r\n                        V-{patientCedula}\r\n                      </p>\r\n                    )}\r\n                  </div>\r\n                  <Badge\r\n                    variant=\"outline\"\r\n                    className=\"bg-green-100 text-green-700 border-green-200\"\r\n                  >\r\n                    En curso\r\n                  </Badge>\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-2 text-sm text-muted-foreground mb-4\">\r\n                  <CalendarClock className=\"h-3.5 w-3.5\" />\r\n                  <span>\r\n                    {format(\r\n                      new Date(consultation.fecha_hora),\r\n                      \"d MMM, h:mm a\",\r\n                      { locale: es },\r\n                    )}\r\n                  </span>\r\n                </div>\r\n\r\n                <Button\r\n                  className=\"w-full bg-green-600 hover:bg-green-700 text-white shadow-sm\"\r\n                  onClick={() =>\r\n                    router.push(\r\n                      `/dashboard/medico/pacientes/consulta?appointment_id=${consultation.id}&paciente_id=${consultation.paciente ? consultation.paciente.id : consultation.offline_patient?.id}`,\r\n                    )\r\n                  } // Ajustar lógica de ID\r\n                >\r\n                  <Play className=\"h-3.5 w-3.5 mr-2 fill-current\" />\r\n                  Continuar Consulta\r\n                </Button>\r\n              </CardContent>\r\n            </Card>\r\n          );\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\consulta\\widgets\\recent-patients.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2729,2732],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2729,2732],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Loader2, Clock, User } from \"lucide-react\";\r\nimport { formatDistanceToNow } from \"date-fns\";\r\nimport { es } from \"date-fns/locale\";\r\n\r\ninterface RecentPatient {\r\n  id: string;\r\n  nombre_completo: string;\r\n  cedula: string | null;\r\n  last_visit: string;\r\n  type: \"registered\" | \"offline\";\r\n  avatar_url?: string | null;\r\n}\r\n\r\nexport function RecentPatientsWidget() {\r\n  const router = useRouter();\r\n  const [patients, setPatients] = useState<RecentPatient[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const fetchRecentPatients = async () => {\r\n      try {\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user) return;\r\n\r\n        // Obtener últimas 20 citas para extraer pacientes únicos recientes\r\n        const { data: appointmentsData, error: appointmentsError } = await supabase\r\n          .from(\"appointments\")\r\n          .select(`\r\n            fecha_hora,\r\n            paciente_id,\r\n            offline_patient_id\r\n          `)\r\n          .eq(\"medico_id\", user.id)\r\n          .order(\"fecha_hora\", { ascending: false })\r\n          .limit(20);\r\n\r\n        if (appointmentsError) throw appointmentsError;\r\n\r\n        if (!appointmentsData || appointmentsData.length === 0) {\r\n            setPatients([]);\r\n            return;\r\n        }\r\n\r\n        // Obtener IDs\r\n        const patientIds = Array.from(new Set(appointmentsData.map(a => a.paciente_id).filter(Boolean))) as string[];\r\n        const offlineIds = Array.from(new Set(appointmentsData.map(a => a.offline_patient_id).filter(Boolean))) as string[];\r\n\r\n        // Fetch related\r\n        const [patientsRes, offlineRes] = await Promise.all([\r\n            patientIds.length > 0\r\n                ? supabase.from(\"profiles\").select(\"id, nombre_completo, cedula, avatar_url\").in(\"id\", patientIds)\r\n                : Promise.resolve({ data: [], error: null }),\r\n            offlineIds.length > 0\r\n                ? supabase.from(\"offline_patients\").select(\"id, nombre_completo, cedula\").in(\"id\", offlineIds)\r\n                : Promise.resolve({ data: [], error: null })\r\n        ]);\r\n\r\n        const patientsMap = new Map(patientsRes.data?.map(p => [p.id, p]));\r\n        const offlineMap = new Map(offlineRes.data?.map(p => [p.id, p]));\r\n\r\n        const uniquePatientsMap = new Map<string, RecentPatient>();\r\n\r\n        appointmentsData.forEach((apt: any) => {\r\n            if (apt.paciente_id) {\r\n                if (!uniquePatientsMap.has(apt.paciente_id)) {\r\n                    const profile = patientsMap.get(apt.paciente_id);\r\n                    if (profile) {\r\n                        uniquePatientsMap.set(apt.paciente_id, {\r\n                            id: apt.paciente_id,\r\n                            nombre_completo: profile.nombre_completo,\r\n                            cedula: profile.cedula,\r\n                            last_visit: apt.fecha_hora,\r\n                            type: \"registered\",\r\n                            avatar_url: profile.avatar_url\r\n                        });\r\n                    }\r\n                }\r\n            } else if (apt.offline_patient_id) {\r\n                if (!uniquePatientsMap.has(apt.offline_patient_id)) {\r\n                    const offlineP = offlineMap.get(apt.offline_patient_id);\r\n                    if (offlineP) {\r\n                        uniquePatientsMap.set(apt.offline_patient_id, {\r\n                            id: apt.offline_patient_id,\r\n                            nombre_completo: offlineP.nombre_completo,\r\n                            cedula: offlineP.cedula,\r\n                            last_visit: apt.fecha_hora,\r\n                            type: \"offline\"\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n        });\r\n\r\n        setPatients(Array.from(uniquePatientsMap.values()).slice(0, 5));\r\n      } catch (err) {\r\n        console.error(\"Error fetching recent patients:\", JSON.stringify(err, null, 2));\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchRecentPatients();\r\n  }, []);\r\n\r\n  const handlePatientClick = (patient: RecentPatient) => {\r\n      // Navegar al perfil del paciente o iniciar nueva consulta?\r\n      // El usuario quiere \"moverse a otras secciones... y volver\".\r\n      // Lo mejor es ir al detalle del paciente donde hay opción de \"Nueva Consulta\"\r\n      if (patient.type === \"registered\") {\r\n          // Asumiendo ruta de perfil de paciente\r\n           router.push(`/dashboard/medico/pacientes/${patient.id}`);\r\n      } else {\r\n           router.push(`/dashboard/medico/pacientes/offline/${patient.id}`);\r\n      }\r\n  };\r\n\r\n  if (loading) {\r\n      return (\r\n          <Card className=\"bg-muted/50 border-dashed h-full min-h-[200px] flex items-center justify-center\">\r\n              <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\r\n          </Card>\r\n      );\r\n  }\r\n\r\n  return (\r\n    <Card className=\"h-full flex flex-col\">\r\n      <CardHeader className=\"pb-3\">\r\n        <CardTitle className=\"text-base flex items-center gap-2\">\r\n            <Clock className=\"h-4 w-4 text-primary\" />\r\n            Pacientes Recientes\r\n        </CardTitle>\r\n      </CardHeader>\r\n      <CardContent className=\"flex-1 space-y-4\">\r\n        {patients.length === 0 ? (\r\n             <div className=\"text-center py-8 text-muted-foreground text-sm\">\r\n                No hay pacientes recientes.\r\n            </div>\r\n        ) : (\r\n            patients.map((patient) => (\r\n                <div \r\n                    key={patient.id} \r\n                    className=\"flex items-center justify-between group cursor-pointer hover:bg-muted/50 p-2 rounded-lg transition-colors -mx-2\"\r\n                    onClick={() => handlePatientClick(patient)}\r\n                >\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <Avatar className=\"h-9 w-9 border\">\r\n                            <AvatarImage src={patient.avatar_url || undefined} />\r\n                            <AvatarFallback>{patient.nombre_completo.substring(0, 2).toUpperCase()}</AvatarFallback>\r\n                        </Avatar>\r\n                        <div>\r\n                            <p className=\"text-sm font-medium leading-none group-hover:text-primary transition-colors\">{patient.nombre_completo}</p>\r\n                            <p className=\"text-xs text-muted-foreground mt-1\">\r\n                                {formatDistanceToNow(new Date(patient.last_visit), { addSuffix: true, locale: es })}\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n                    <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8 opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                        <User className=\"h-4 w-4\" />\r\n                    </Button>\r\n                </div>\r\n            ))\r\n        )}\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\consulta\\widgets\\todays-appointments.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Clock' is defined but never used.","line":9,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":34},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'es' is defined but never used.","line":11,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":82,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3203,3206],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3203,3206],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Loader2, Calendar, Clock, ChevronRight } from \"lucide-react\";\r\nimport { format } from \"date-fns\";\r\nimport { es } from \"date-fns/locale\";\r\n\r\ninterface Appointment {\r\n  id: string;\r\n  fecha_hora: string;\r\n  paciente?: { id: string; nombre_completo: string; cedula: string } | null;\r\n  offline_patient?: { id: string; nombre_completo: string; cedula: string } | null;\r\n  motivo: string;\r\n  status: string;\r\n}\r\n\r\nexport function TodaysAppointmentsWidget() {\r\n  const router = useRouter();\r\n  const [appointments, setAppointments] = useState<Appointment[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const fetchTodayAppointments = async () => {\r\n      try {\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user) return;\r\n\r\n        const today = new Date().toISOString().split('T')[0];\r\n\r\n        // 1. Fetch appointments sin joins\r\n        const { data: appointmentsData, error: appointmentsError } = await supabase\r\n          .from(\"appointments\")\r\n          .select(`\r\n            id,\r\n            fecha_hora,\r\n            motivo,\r\n            status,\r\n            paciente_id,\r\n            offline_patient_id\r\n          `)\r\n          .eq(\"medico_id\", user.id)\r\n          .gte(\"fecha_hora\", `${today}T00:00:00`)\r\n          .lte(\"fecha_hora\", `${today}T23:59:59`)\r\n          .order(\"fecha_hora\", { ascending: true });\r\n\r\n        if (appointmentsError) throw appointmentsError;\r\n\r\n        if (!appointmentsData || appointmentsData.length === 0) {\r\n            setAppointments([]);\r\n            return;\r\n        }\r\n\r\n        // 2. Extract IDs\r\n        const patientIds = Array.from(new Set(appointmentsData.map(a => a.paciente_id).filter(Boolean))) as string[];\r\n        const offlineIds = Array.from(new Set(appointmentsData.map(a => a.offline_patient_id).filter(Boolean))) as string[];\r\n\r\n        // 3. Fetch related data\r\n        const [patientsRes, offlineRes] = await Promise.all([\r\n            patientIds.length > 0\r\n                ? supabase.from(\"profiles\").select(\"id, nombre_completo, cedula\").in(\"id\", patientIds)\r\n                : Promise.resolve({ data: [], error: null }),\r\n            offlineIds.length > 0\r\n                ? supabase.from(\"offline_patients\").select(\"id, nombre_completo, cedula\").in(\"id\", offlineIds)\r\n                : Promise.resolve({ data: [], error: null })\r\n        ]);\r\n\r\n        const patientsMap = new Map(patientsRes.data?.map(p => [p.id, p]));\r\n        const offlineMap = new Map(offlineRes.data?.map(p => [p.id, p]));\r\n\r\n        // 4. Combine\r\n        const combinedData = appointmentsData.map(apt => ({\r\n            ...apt,\r\n            paciente: apt.paciente_id ? patientsMap.get(apt.paciente_id) : null,\r\n            offline_patient: apt.offline_patient_id ? offlineMap.get(apt.offline_patient_id) : null\r\n        }));\r\n\r\n        setAppointments(combinedData as any[]);\r\n      } catch (err) {\r\n        console.error(\"Error fetching today appointments:\", JSON.stringify(err, null, 2));\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchTodayAppointments();\r\n  }, []);\r\n\r\n  const getStatusBadge = (status: string) => {\r\n    switch (status) {\r\n        case 'completada':\r\n        case 'completed':\r\n            return <Badge variant=\"secondary\" className=\"bg-blue-100 text-blue-700\">Completada</Badge>;\r\n        case 'cancelada':\r\n        case 'cancelled':\r\n            return <Badge variant=\"destructive\" className=\"bg-red-100 text-red-700\">Cancelada</Badge>;\r\n        case 'confirmada':\r\n        case 'confirmed':\r\n            return <Badge variant=\"secondary\" className=\"bg-green-100 text-green-700\">Confirmada</Badge>;\r\n        default:\r\n            return <Badge variant=\"outline\" className=\"text-muted-foreground\">Pendiente</Badge>;\r\n    }\r\n  };\r\n\r\n  const handleStartConsultation = (apt: Appointment) => {\r\n    const patientId = apt.paciente?.id || apt.offline_patient?.id;\r\n    if (patientId) {\r\n        router.push(`/dashboard/medico/pacientes/consulta?appointment_id=${apt.id}&paciente_id=${patientId}&from=today`);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n      return (\r\n          <Card className=\"bg-muted/50 border-dashed h-full min-h-[200px] flex items-center justify-center\">\r\n              <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\r\n          </Card>\r\n      );\r\n  }\r\n\r\n  return (\r\n    <Card className=\"h-full flex flex-col\">\r\n      <CardHeader className=\"pb-3\">\r\n        <div className=\"flex items-center justify-between\">\r\n            <CardTitle className=\"text-base flex items-center gap-2\">\r\n                <Calendar className=\"h-4 w-4 text-primary\" />\r\n                Citas de Hoy\r\n            </CardTitle>\r\n            <Badge variant=\"secondary\" className=\"font-normal\">\r\n                {appointments.length}\r\n            </Badge>\r\n        </div>\r\n      </CardHeader>\r\n      <CardContent className=\"flex-1 overflow-y-auto max-h-[300px] space-y-3 pr-2 custom-scrollbar\">\r\n        {appointments.length === 0 ? (\r\n            <div className=\"text-center py-8 text-muted-foreground text-sm\">\r\n                No hay citas programadas para hoy.\r\n            </div>\r\n        ) : (\r\n            appointments.map((apt) => {\r\n                const patientName = apt.paciente?.nombre_completo || apt.offline_patient?.nombre_completo || \"Paciente sin nombre\";\r\n                const time = format(new Date(apt.fecha_hora), \"h:mm a\");\r\n                const isCompleted = apt.status === 'completada' || apt.status === 'completed';\r\n\r\n                return (\r\n                    <div key={apt.id} className=\"group flex items-center justify-between p-3 rounded-lg border bg-card hover:bg-accent/50 transition-colors\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"flex flex-col items-center justify-center h-10 w-12 rounded bg-primary/10 text-primary text-xs font-bold\">\r\n                                <span>{time}</span>\r\n                            </div>\r\n                            <div>\r\n                                <p className=\"font-medium text-sm leading-none\">{patientName}</p>\r\n                                <p className=\"text-xs text-muted-foreground mt-1 truncate max-w-[150px]\">{apt.motivo}</p>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2\">\r\n                            {getStatusBadge(apt.status)}\r\n                            {!isCompleted && apt.status !== 'cancelada' && apt.status !== 'cancelled' && (\r\n                                <Button size=\"icon\" variant=\"ghost\" className=\"h-8 w-8 opacity-0 group-hover:opacity-100 transition-opacity\" onClick={() => handleStartConsultation(apt)}>\r\n                                    <ChevronRight className=\"h-4 w-4\" />\r\n                                </Button>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                );\r\n            })\r\n        )}\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\dashboard-v2\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\dashboard\\DashboardControls.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'onModeChange' is defined but never used.","line":67,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":67,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'simpleWidgetCount' is assigned a value but never used.","line":72,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":72,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'proWidgetCount' is assigned a value but never used.","line":73,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":73,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file DashboardControls.tsx\r\n * @description Controles del dashboard médico para cambiar modo, personalizar widgets y opciones.\r\n * Integrado con el panel de personalización de widgets.\r\n *\r\n * @module Dashboard\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { motion } from \"framer-motion\";\r\nimport { LayoutGrid, Palette } from \"lucide-react\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport {\r\n  Tooltip,\r\n  TooltipContent,\r\n  TooltipProvider,\r\n  TooltipTrigger,\r\n} from \"@red-salud/ui\";\r\nimport type { DashboardMode, WidgetId } from \"@/lib/types/dashboard-types\";\r\nimport { WidgetCustomizationPanel } from \"./WidgetCustomizationPanel\";\r\n\r\n// ============================================================================\r\n// TIPOS\r\n// ============================================================================\r\n\r\ninterface DashboardControlsProps {\r\n  /** Modo actual del dashboard */\r\n  mode: DashboardMode;\r\n  /** Callback para cambiar modo */\r\n  onModeChange: (mode: DashboardMode) => void;\r\n  /** Callback para resetear layout */\r\n  onResetLayout: () => void;\r\n  /** Widgets ocultos */\r\n  hiddenWidgets?: WidgetId[];\r\n  /** Callback para toggle de visibilidad de widget */\r\n  onToggleWidget?: (widgetId: WidgetId) => void;\r\n  /** Callback para abrir editor de temas */\r\n  onOpenThemeEditor?: () => void;\r\n  /** Cantidad de widgets en modo simple */\r\n  simpleWidgetCount?: number;\r\n  /** Cantidad de widgets en modo pro */\r\n  proWidgetCount?: number;\r\n}\r\n\r\n// ============================================================================\r\n// COMPONENTE PRINCIPAL\r\n// ============================================================================\r\n\r\n/**\r\n * Controles del dashboard médico.\r\n * Incluye toggle de modo Simple/Pro, botón de widgets y resetear.\r\n *\r\n * @example\r\n * <DashboardControls\r\n *   mode=\"pro\"\r\n *   onModeChange={setMode}\r\n *   onResetLayout={resetLayout}\r\n *   hiddenWidgets={hiddenWidgets}\r\n *   onToggleWidget={toggleWidget}\r\n * />\r\n */\r\nexport function DashboardControls({\r\n  mode,\r\n  onModeChange,\r\n  onResetLayout,\r\n  hiddenWidgets = [],\r\n  onToggleWidget,\r\n  onOpenThemeEditor,\r\n  simpleWidgetCount = 0,\r\n  proWidgetCount = 0,\r\n}: DashboardControlsProps) {\r\n  // Estado del panel de personalización\r\n  const [isCustomizing, setIsCustomizing] = useState(false);\r\n\r\n  // Handler para toggle de widget\r\n  const handleToggleWidget = (widgetId: WidgetId) => {\r\n    onToggleWidget?.(widgetId);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <motion.div\r\n        initial={{ opacity: 0, y: -10 }}\r\n        animate={{ opacity: 1, y: 0 }}\r\n        className=\"flex items-center justify-end flex-wrap gap-4\"\r\n      >\r\n        {/* Actions */}\r\n        <div className=\"flex items-center gap-2\" data-tour=\"dashboard-actions\">\r\n          {/* Theme Button */}\r\n          {onOpenThemeEditor && (\r\n            <TooltipProvider>\r\n              <Tooltip>\r\n                <TooltipTrigger asChild>\r\n                  <Button\r\n                    variant=\"outline\"\r\n                    size=\"sm\"\r\n                    onClick={onOpenThemeEditor}\r\n                    className=\"gap-2\"\r\n                  >\r\n                    <Palette className=\"h-4 w-4\" />\r\n                    <span className=\"hidden sm:inline\">Tema</span>\r\n                  </Button>\r\n                </TooltipTrigger>\r\n                <TooltipContent>Personalizar colores y tema</TooltipContent>\r\n              </Tooltip>\r\n            </TooltipProvider>\r\n          )}\r\n\r\n          {/* Widgets Button */}\r\n          <TooltipProvider>\r\n            <Tooltip>\r\n              <TooltipTrigger asChild>\r\n                <Button\r\n                  variant=\"outline\"\r\n                  size=\"sm\"\r\n                  className=\"gap-2\"\r\n                  onClick={() => setIsCustomizing(true)}\r\n                >\r\n                  <LayoutGrid className=\"h-4 w-4\" />\r\n                  Widgets\r\n                  {hiddenWidgets.length > 0 && (\r\n                    <Badge\r\n                      variant=\"secondary\"\r\n                      className=\"ml-1 text-[10px] px-1.5 py-0\"\r\n                    >\r\n                      -{hiddenWidgets.length}\r\n                    </Badge>\r\n                  )}\r\n                </Button>\r\n              </TooltipTrigger>\r\n              <TooltipContent>Personalizar widgets visibles</TooltipContent>\r\n            </Tooltip>\r\n          </TooltipProvider>\r\n        </div>\r\n      </motion.div>\r\n\r\n      {/* Panel de Personalización */}\r\n      <WidgetCustomizationPanel\r\n        isOpen={isCustomizing}\r\n        onClose={() => setIsCustomizing(false)}\r\n        currentMode={mode}\r\n        hiddenWidgets={hiddenWidgets}\r\n        onToggleWidget={handleToggleWidget}\r\n        onResetLayout={onResetLayout}\r\n      />\r\n    </>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\dashboard\\SortableWidgetItem.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":129,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4232,4235],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4232,4235],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\n/**\r\n * @file SortableWidgetItem.tsx\r\n * @description Wrapper optimizado para widgets arrastrables con dnd-kit.\r\n * Optimizado para v1 con React.memo y animaciones mejoradas.\r\n *\r\n * @module Dashboard\r\n */\r\n\r\nimport React from \"react\";\r\nimport { useSortable } from \"@dnd-kit/sortable\";\r\nimport { CSS } from \"@dnd-kit/utilities\";\r\nimport { motion } from \"framer-motion\";\r\nimport { GripVertical } from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport type { WidgetPosition } from \"@/lib/types/dashboard-types\";\r\n\r\ninterface SortableWidgetItemProps {\r\n  /** ID único del widget */\r\n  id: string;\r\n  /** Posición del widget en el grid */\r\n  position: WidgetPosition;\r\n  /** Contenido del widget */\r\n  children: React.ReactNode;\r\n  /** Si este widget específico está siendo arrastrado (optimización) */\r\n  isDraggingFromParent?: boolean;\r\n}\r\n\r\n/**\r\n * Componente wrapper que hace a los widgets arrastrables.\r\n * Optimizado con React.memo para evitar renders innecesarios.\r\n *\r\n * @example\r\n * <SortableWidgetItem id=\"stats-overview\" position={position}>\r\n *   <StatsOverviewWidget />\r\n * </SortableWidgetItem>\r\n */\r\nfunction SortableWidgetItemComponent({\r\n  id,\r\n  position,\r\n  children,\r\n  isDraggingFromParent,\r\n}: SortableWidgetItemProps) {\r\n  const {\r\n    attributes,\r\n    listeners,\r\n    setNodeRef,\r\n    setActivatorNodeRef,\r\n    transform,\r\n    transition,\r\n    isDragging: isDraggingFromDnd,\r\n    isOver,\r\n  } = useSortable({ id });\r\n\r\n  // Usar el estado de dragging más preciso\r\n  const isDragging = isDraggingFromParent ?? isDraggingFromDnd;\r\n\r\n  // Transición CSS optimizada - más rápida para mejor responsiveness\r\n  const style = {\r\n    transform: CSS.Transform.toString(transform),\r\n    transition: transition || \"transform 200ms cubic-bezier(0.2, 0, 0, 1)\",\r\n    gridColumn: `span ${position.w}`,\r\n    gridRow: `span ${position.h}`,\r\n    zIndex: isDragging ? 50 : isOver ? 10 : undefined,\r\n  };\r\n\r\n  return (\r\n    <motion.div\r\n      ref={setNodeRef}\r\n      style={style}\r\n      data-widget={id}\r\n      layout=\"position\" // Solo animar posición, no layout completo (más rápido)\r\n      initial={{ opacity: 0, scale: 0.95, y: 10 }}\r\n      animate={{\r\n        opacity: isDragging ? 0.8 : 1,\r\n        scale: isDragging ? 1.02 : 1,\r\n        y: 0,\r\n      }}\r\n      transition={{\r\n        type: \"spring\",\r\n        stiffness: 500, // Más rápido\r\n        damping: 40,\r\n        mass: 0.4, // Más ligero\r\n      }}\r\n      className={cn(\r\n        \"relative h-full\",\r\n        \"will-change-transform\", // Hint para el navegador\r\n        isDragging && \"z-50 drop-shadow-xl\",\r\n        isOver &&\r\n          \"ring-2 ring-primary/30 ring-offset-2 ring-offset-background rounded-2xl\",\r\n      )}\r\n    >\r\n      {/* Drag Handle - simplificado para mejor rendimiento */}\r\n      <motion.button\r\n        ref={setActivatorNodeRef}\r\n        {...attributes}\r\n        {...listeners}\r\n        type=\"button\"\r\n        whileHover={{ scale: 1.05 }}\r\n        whileTap={{ scale: 0.95 }}\r\n        className={cn(\r\n          \"absolute top-3 left-3 z-20\",\r\n          \"flex items-center justify-center p-1.5 rounded-lg\",\r\n          \"bg-background/90 backdrop-blur-sm\",\r\n          \"border border-border/40\",\r\n          \"text-muted-foreground/50 hover:text-foreground\",\r\n          \"shadow-sm hover:shadow-md\",\r\n          \"transition-all duration-150\",\r\n          \"focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary\",\r\n          \"select-none touch-none\",\r\n          isDragging\r\n            ? \"text-primary bg-primary/15 border-primary/40 cursor-grabbing shadow-lg\"\r\n            : \"cursor-grab opacity-0 hover:opacity-100\", // Oculto por defecto, visible al hover\r\n        )}\r\n        title=\"Arrastrar para mover\"\r\n        aria-label=\"Arrastrar widget\"\r\n      >\r\n        <GripVertical className=\"h-4 w-4\" />\r\n      </motion.button>\r\n\r\n      {/* Indicador visual cuando otro widget está sobre este - sin AnimatePresence */}\r\n      {isOver && !isDragging && (\r\n        <div className=\"absolute inset-0 rounded-2xl bg-primary/5 pointer-events-none\" />\r\n      )}\r\n\r\n      {/* Widget content - sin animación de filter (costosa) */}\r\n      <div className=\"h-full\">\r\n        {React.cloneElement(children as React.ReactElement<any>, {\r\n          isDragging,\r\n        })}\r\n      </div>\r\n    </motion.div>\r\n  );\r\n}\r\n\r\n// Memoizar para evitar re-renders cuando otros widgets cambian\r\nexport const SortableWidgetItem = React.memo(\r\n  SortableWidgetItemComponent,\r\n  (prevProps, nextProps) => {\r\n    return (\r\n      prevProps.id === nextProps.id &&\r\n      prevProps.position === nextProps.position &&\r\n      prevProps.isDraggingFromParent === nextProps.isDraggingFromParent\r\n    );\r\n  },\r\n);\r\n\r\nSortableWidgetItem.displayName = \"SortableWidgetItem\";\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\dashboard\\WidgetCustomizationPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AnimatePresence' is defined but never used.","line":12,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SheetDescription' is defined but never used.","line":32,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":69,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2061,2064],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2061,2064],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":85,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2731,2734],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2731,2734],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\dashboard\\WidgetCustomizationPanel.tsx:128:22\n  126 |                     )}\n  127 |                 >\n> 128 |                     <Icon className=\"h-5 w-5\" />\n      |                      ^^^^ This component is created during render\n  129 |                 </div>\n  130 |                 <div className=\"flex flex-col min-w-0\">\n  131 |                     <span className={cn(\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\dashboard\\WidgetCustomizationPanel.tsx:105:18\n  103 |     matchSearch: boolean;\n  104 | }) {\n> 105 |     const Icon = getIcon(config.icon);\n      |                  ^^^^^^^^^^^^^^^^^^^^ The component is created during render here\n  106 |\n  107 |     if (!matchSearch) return null;\n  108 |","line":128,"column":22,"nodeType":null,"endLine":128,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setSearchQuery' is assigned a value but never used.","line":181,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":181,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'hasChanges' is assigned a value but never used.","line":182,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":182,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":204,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":204,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7472,7475],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7472,7475],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":279,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":279,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10831,10834],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10831,10834],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file WidgetCustomizationPanel.tsx\r\n * @description Panel drawer para personalización de widgets del dashboard.\r\n * Permite activar/desactivar, reordenar y configurar widgets.\r\n * \r\n * @module Dashboard/Customization\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useState, useCallback, useMemo } from \"react\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport {\r\n    Eye,\r\n    Settings2,\r\n    LayoutGrid,\r\n    Check,\r\n    RotateCcw,\r\n    BarChart3,\r\n    Calendar,\r\n    MessageSquare,\r\n    Zap,\r\n} from \"lucide-react\";\r\nimport * as LucideIcons from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Switch } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport {\r\n    Sheet,\r\n    SheetContent,\r\n    SheetDescription,\r\n    SheetHeader,\r\n    SheetTitle,\r\n    SheetFooter,\r\n} from \"@red-salud/ui\";\r\nimport { ScrollArea } from \"@red-salud/ui\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@red-salud/ui\";\r\nimport { Separator } from \"@red-salud/ui\";\r\nimport {\r\n    WIDGET_CONFIGS,\r\n    type WidgetId,\r\n    type DashboardMode,\r\n    type WidgetConfig,\r\n} from \"@/lib/types/dashboard-types\";\r\n\r\n// ============================================================================\r\n// TIPOS\r\n// ============================================================================\r\n\r\ninterface WidgetCustomizationPanelProps {\r\n    /** Si el panel está abierto */\r\n    isOpen: boolean;\r\n    /** Callback para cerrar el panel */\r\n    onClose: () => void;\r\n    /** Modo actual del dashboard */\r\n    currentMode: DashboardMode;\r\n    /** Widgets actualmente ocultos */\r\n    hiddenWidgets: WidgetId[];\r\n    /** Callback cuando se cambia la visibilidad de un widget */\r\n    onToggleWidget: (widgetId: WidgetId) => void;\r\n    /** Callback para resetear al layout por defecto */\r\n    onResetLayout: () => void;\r\n    /** Callback para guardar cambios */\r\n    onSave?: () => void;\r\n}\r\n\r\n// Mapeo de categorías a etiquetas en español e iconos\r\nconst CATEGORY_MAP: Record<string, { label: string; icon: any }> = {\r\n    stats: { label: \"Métricas\", icon: BarChart3 },\r\n    calendar: { label: \"Gestión de Citas\", icon: Calendar },\r\n    communication: { label: \"Comunicación\", icon: MessageSquare },\r\n    actions: { label: \"Utilidades\", icon: Zap },\r\n    analytics: { label: \"Rendimiento\", icon: LayoutGrid },\r\n};\r\n\r\n// ============================================================================\r\n// COMPONENTES AUXILIARES\r\n// ============================================================================\r\n\r\n/**\r\n * Obtiene un ícono de Lucide por nombre.\r\n */\r\nfunction getIcon(iconName: string): React.ComponentType<{ className?: string }> {\r\n    const Icon = (LucideIcons as any)[iconName];\r\n    return Icon || LucideIcons.Box;\r\n}\r\n\r\n/**\r\n * Tarjeta de widget simplificada y minimalista.\r\n */\r\nfunction WidgetCard({\r\n    config,\r\n    isVisible,\r\n    isAvailable,\r\n    onToggle,\r\n    matchSearch,\r\n}: {\r\n    config: WidgetConfig;\r\n    isVisible: boolean;\r\n    isAvailable: boolean;\r\n    onToggle: () => void;\r\n    matchSearch: boolean;\r\n}) {\r\n    const Icon = getIcon(config.icon);\r\n\r\n    if (!matchSearch) return null;\r\n\r\n    return (\r\n        <motion.div\r\n            initial={{ opacity: 0, scale: 0.95 }}\r\n            animate={{ opacity: isAvailable ? 1 : 0.6, scale: 1 }}\r\n            className={cn(\r\n                \"group flex items-center justify-between p-3 rounded-xl border transition-all duration-200 hover:bg-muted/50\",\r\n                isVisible && isAvailable\r\n                    ? \"bg-card border-border shadow-sm hover:shadow-md hover:border-primary/20\"\r\n                    : \"bg-muted/10 border-transparent hover:border-border/50\",\r\n                !isAvailable && \"opacity-50 grayscale\"\r\n            )}\r\n        >\r\n            <div className=\"flex items-center gap-3 min-w-0\">\r\n                <div\r\n                    className={cn(\r\n                        \"flex shrink-0 items-center justify-center w-10 h-10 rounded-full transition-colors\",\r\n                        isVisible && isAvailable ? \"bg-primary/10 text-primary\" : \"bg-muted text-muted-foreground\"\r\n                    )}\r\n                >\r\n                    <Icon className=\"h-5 w-5\" />\r\n                </div>\r\n                <div className=\"flex flex-col min-w-0\">\r\n                    <span className={cn(\r\n                        \"text-sm font-medium truncate\",\r\n                        isVisible ? \"text-foreground\" : \"text-muted-foreground\"\r\n                    )}>\r\n                        {config.title}\r\n                    </span>\r\n                    <span className=\"text-xs text-muted-foreground truncate hidden sm:block\">\r\n                        {config.description}\r\n                    </span>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"flex items-center gap-4\">\r\n                {/*  Etiqueta de tiempo real si aplica */}\r\n                {config.realtime && (\r\n                    <div className=\"hidden sm:flex items-center gap-1.5 px-2 py-0.5 rounded-full bg-emerald-500/10 border border-emerald-500/20\">\r\n                        <span className=\"relative flex h-1.5 w-1.5\">\r\n                            <span className=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75\"></span>\r\n                            <span className=\"relative inline-flex rounded-full h-1.5 w-1.5 bg-emerald-500\"></span>\r\n                        </span>\r\n                        <span className=\"text-[10px] font-medium text-emerald-600 dark:text-emerald-400\">\r\n                            En vivo\r\n                        </span>\r\n                    </div>\r\n                )}\r\n                <Switch\r\n                    checked={isVisible && isAvailable}\r\n                    onCheckedChange={onToggle}\r\n                    disabled={!isAvailable}\r\n                    className=\"data-[state=checked]:bg-primary\"\r\n                />\r\n            </div>\r\n        </motion.div>\r\n    );\r\n}\r\n\r\n// ============================================================================\r\n// COMPONENTE PRINCIPALRefactorizado\r\n// ============================================================================\r\n\r\nexport function WidgetCustomizationPanel({\r\n    isOpen,\r\n    onClose,\r\n    currentMode,\r\n    hiddenWidgets,\r\n    onToggleWidget,\r\n    onResetLayout,\r\n    onSave,\r\n}: WidgetCustomizationPanelProps) {\r\n    const [activeTab, setActiveTab] = useState<\"widgets\" | \"layout\">(\"widgets\");\r\n    const [searchQuery, setSearchQuery] = useState(\"\");\r\n    const [hasChanges, setHasChanges] = useState(false);\r\n\r\n    // Obtener widgets disponibles para el modo actual ordenados por categoría\r\n    const widgetsByCategory = useMemo(() => {\r\n        const available = Object.values(WIDGET_CONFIGS).filter((config) =>\r\n            config.modes.includes(currentMode)\r\n        );\r\n\r\n        // Agrupar por categoría\r\n        const grouped: Record<string, WidgetConfig[]> = {};\r\n\r\n        // Inicializar categorías en orden deseado para UI\r\n        const orderedCategories = ['stats', 'calendar', 'communication', 'actions', 'analytics'];\r\n        orderedCategories.forEach(cat => grouped[cat] = []);\r\n\r\n        available.forEach(widget => {\r\n            const cat = widget.category;\r\n            if (!grouped[cat]) grouped[cat] = [];\r\n            grouped[cat].push(widget);\r\n        });\r\n\r\n        // Filtrar categorías vacías\r\n        const result: { id: string; label: string; icon: any; widgets: WidgetConfig[] }[] = [];\r\n        orderedCategories.forEach(cat => {\r\n            if (grouped[cat] && grouped[cat].length > 0) {\r\n                const catInfo = CATEGORY_MAP[cat] || { label: cat, icon: LayoutGrid };\r\n                result.push({\r\n                    id: cat,\r\n                    label: catInfo.label,\r\n                    icon: catInfo.icon,\r\n                    widgets: grouped[cat]\r\n                });\r\n            }\r\n        });\r\n\r\n        return result;\r\n    }, [currentMode]);\r\n\r\n\r\n    const handleToggle = useCallback(\r\n        (widgetId: WidgetId) => {\r\n            onToggleWidget(widgetId);\r\n            setHasChanges(true);\r\n        },\r\n        [onToggleWidget]\r\n    );\r\n\r\n    const handleReset = useCallback(() => {\r\n        onResetLayout();\r\n        setHasChanges(false);\r\n    }, [onResetLayout]);\r\n\r\n    const handleSave = useCallback(() => {\r\n        onSave?.();\r\n        setHasChanges(false);\r\n        onClose();\r\n    }, [onSave, onClose]);\r\n\r\n    // Función para filtrar widgets según búsqueda\r\n    const doesMatchSearch = (widget: WidgetConfig) => {\r\n        if (!searchQuery) return true;\r\n        const query = searchQuery.toLowerCase();\r\n        return widget.title.toLowerCase().includes(query) ||\r\n            widget.description.toLowerCase().includes(query);\r\n    };\r\n\r\n    return (\r\n        <Sheet open={isOpen} onOpenChange={(open) => !open && onClose()}>\r\n            <SheetContent className=\"w-full sm:max-w-xl md:max-w-2xl p-0 flex flex-col bg-background/95 backdrop-blur-xl border-l-border/60\">\r\n                {/* Header Mejorado */}\r\n                <SheetHeader className=\"px-6 py-5 border-b sticky top-0 bg-background/50 z-10 backdrop-blur-md\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"flex items-center justify-center w-10 h-10 rounded-2xl bg-primary text-primary-foreground shadow-lg shadow-primary/20\">\r\n                                <LayoutGrid className=\"h-5 w-5\" />\r\n                            </div>\r\n                            <div className=\"space-y-1\">\r\n                                <SheetTitle className=\"text-xl font-bold tracking-tight\">\r\n                                    Personalizar\r\n                                </SheetTitle>\r\n                                <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\r\n                                    <span>Modo actual:</span>\r\n                                    <Badge variant=\"outline\" className={cn(\r\n                                        \"capitalize font-medium shadow-none\",\r\n                                        currentMode === 'pro' ? \"bg-indigo-500/10 text-indigo-600 border-indigo-200\" : \"bg-slate-100 text-slate-600\"\r\n                                    )}>\r\n                                        {currentMode === \"simple\" ? \"Básico\" : \"Profesional\"}\r\n                                    </Badge>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </SheetHeader>\r\n\r\n                {/* Tabs más limpias */}\r\n                <Tabs\r\n                    value={activeTab}\r\n                    onValueChange={(v) => setActiveTab(v as any)}\r\n                    className=\"flex-1 flex flex-col overflow-hidden\"\r\n                >\r\n                    <div className=\"px-6 pt-6 pb-2\">\r\n                        <TabsList className=\"w-full grid grid-cols-2 h-11 p-1 bg-muted/80 backdrop-blur-sm rounded-lg\">\r\n                            <TabsTrigger\r\n                                value=\"widgets\"\r\n                                className=\"rounded-md text-sm font-medium transition-all data-[state=active]:bg-background data-[state=active]:text-primary data-[state=active]:shadow-sm\"\r\n                            >\r\n                                <Eye className=\"h-4 w-4 mr-2\" />\r\n                                Widgets\r\n                            </TabsTrigger>\r\n                            <TabsTrigger\r\n                                value=\"layout\"\r\n                                className=\"rounded-md text-sm font-medium transition-all data-[state=active]:bg-background data-[state=active]:text-primary data-[state=active]:shadow-sm\"\r\n                            >\r\n                                <Settings2 className=\"h-4 w-4 mr-2\" />\r\n                                Configuración\r\n                            </TabsTrigger>\r\n                        </TabsList>\r\n                    </div>\r\n\r\n                    {/* Contenido Widgets */}\r\n                    <TabsContent\r\n                        value=\"widgets\"\r\n                        className=\"flex-1 overflow-hidden m-0 p-0 relative\"\r\n                    >\r\n                        <ScrollArea className=\"flex-1 h-full\">\r\n                            <div className=\"p-6 space-y-8\">\r\n                                {widgetsByCategory.map((category) => {\r\n                                    // Verificar si hay widgets que coincidan con la búsqueda en esta categoría\r\n                                    const matchingWidgets = category.widgets.filter(w => doesMatchSearch(w));\r\n                                    if (matchingWidgets.length === 0) return null;\r\n\r\n                                    return (\r\n                                        <div key={category.id} className=\"space-y-3\">\r\n                                            <div className=\"flex items-center gap-2 text-sm font-semibold text-foreground/80\">\r\n                                                <category.icon className=\"h-4 w-4 text-primary\" />\r\n                                                {category.label}\r\n                                            </div>\r\n                                            <div className=\"grid grid-cols-1 gap-3\">\r\n                                                {category.widgets.map((config) => (\r\n                                                    <WidgetCard\r\n                                                        key={config.id}\r\n                                                        config={config}\r\n                                                        isVisible={!hiddenWidgets.includes(config.id)}\r\n                                                        isAvailable={true}\r\n                                                        onToggle={() => handleToggle(config.id)}\r\n                                                        matchSearch={doesMatchSearch(config)}\r\n                                                    />\r\n                                                ))}\r\n                                            </div>\r\n                                        </div>\r\n                                    );\r\n                                })}\r\n\r\n                                <div className=\"h-10\" /> {/* Espaciador final */}\r\n                            </div>\r\n                        </ScrollArea>\r\n                    </TabsContent>\r\n\r\n                    {/* Contenido Configuración */}\r\n                    <TabsContent\r\n                        value=\"layout\"\r\n                        className=\"flex-1 overflow-hidden m-0 p-0 bg-muted/5\"\r\n                    >\r\n                        <ScrollArea className=\"flex-1 h-full\">\r\n                            <div className=\"p-6 max-w-xl mx-auto space-y-6\">\r\n                                {/* Resumen rápido */}\r\n                                <div className=\"rounded-xl border bg-muted/30 p-4\">\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                        <div className=\"text-2xl font-bold text-primary\">\r\n                                            {Object.values(WIDGET_CONFIGS).filter(w => w.modes.includes(currentMode)).length - hiddenWidgets.length}\r\n                                        </div>\r\n                                        <div className=\"text-sm text-muted-foreground\">\r\n                                            widgets activos de {Object.values(WIDGET_CONFIGS).filter(w => w.modes.includes(currentMode)).length} disponibles\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <Separator />\r\n\r\n                                {/* Gestión del Diseño */}\r\n                                <div className=\"space-y-4\">\r\n                                    <h3 className=\"text-lg font-semibold tracking-tight\">Gestión del Diseño</h3>\r\n\r\n                                    {/* Restablecer */}\r\n                                    <div className=\"group rounded-xl border bg-card p-5 hover:border-primary/50 transition-colors shadow-sm\">\r\n                                        <div className=\"flex items-start justify-between gap-4\">\r\n                                            <div className=\"space-y-1.5\">\r\n                                                <div className=\"flex items-center gap-2\">\r\n                                                    <div className=\"p-2 rounded-lg bg-red-500/10 text-red-600\">\r\n                                                        <RotateCcw className=\"h-4 w-4\" />\r\n                                                    </div>\r\n                                                    <h4 className=\"font-medium text-foreground\">Restablecer por defecto</h4>\r\n                                                </div>\r\n                                                <p className=\"text-sm text-muted-foreground pl-10 max-w-[300px]\">\r\n                                                    Vuelve a la disposición original de widgets recomendada para el modo\r\n                                                    <span className=\"font-medium text-foreground ml-1\">{currentMode === \"simple\" ? \"Básico\" : \"Profesional\"}</span>.\r\n                                                </p>\r\n                                            </div>\r\n                                            <Button\r\n                                                variant=\"outline\"\r\n                                                size=\"sm\"\r\n                                                onClick={handleReset}\r\n                                                className=\"shrink-0 hover:border-red-500/50 hover:bg-red-500/5 hover:text-red-600 transition-colors\"\r\n                                            >\r\n                                                Restablecer\r\n                                            </Button>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <Separator />\r\n\r\n                                {/* Info de sincronización */}\r\n                                <div className=\"text-xs text-muted-foreground text-center p-4 bg-muted/20 rounded-lg\">\r\n                                    <span className=\"inline-flex items-center gap-1\">\r\n                                        <Check className=\"h-3 w-3 text-green-500\" />\r\n                                        Tus preferencias se sincronizan automáticamente en todos tus dispositivos\r\n                                    </span>\r\n                                </div>\r\n                            </div>\r\n                        </ScrollArea>\r\n                    </TabsContent>\r\n                </Tabs>\r\n\r\n                {/* Footer Mejorado */}\r\n                <SheetFooter className=\"p-6 pt-4 border-t bg-background/50 backdrop-blur-md\">\r\n                    <div className=\"flex items-center gap-3 w-full\">\r\n                        <Button\r\n                            variant=\"outline\"\r\n                            className=\"flex-1 h-11 border-dashed hover:border-solid hover:bg-muted/50\"\r\n                            onClick={onClose}\r\n                        >\r\n                            Cancelar\r\n                        </Button>\r\n                        <Button\r\n                            className=\"flex-1 gap-2 h-11 shadow-lg shadow-primary/20 hover:shadow-primary/30 transition-all font-semibold\"\r\n                            onClick={handleSave}\r\n                        >\r\n                            <Check className=\"h-4 w-4\" />\r\n                            Aplicar Cambios\r\n                        </Button>\r\n                    </div>\r\n                </SheetFooter>\r\n            </SheetContent>\r\n        </Sheet>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\dashboard\\dashboard-skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\dashboard\\dashboard-widget-grid.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\dashboard\\dashboard-widget-grid.tsx:62:5\n  60 |   // Animación de transición entre modos\n  61 |   useEffect(() => {\n> 62 |     setIsTransitioning(true);\n     |     ^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  63 |     const timer = setTimeout(() => setIsTransitioning(false), 300);\n  64 |     return () => clearTimeout(timer);\n  65 |   }, [mode]);","line":62,"column":5,"nodeType":null,"endLine":62,"endColumn":23}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useMemo, useCallback, useEffect } from \"react\";\r\nimport {\r\n  DndContext,\r\n  closestCenter,\r\n  KeyboardSensor,\r\n  PointerSensor,\r\n  useSensor,\r\n  useSensors,\r\n  DragEndEvent,\r\n  DragStartEvent,\r\n  DragOverlay,\r\n} from \"@dnd-kit/core\";\r\nimport {\r\n  arrayMove,\r\n  SortableContext,\r\n  sortableKeyboardCoordinates,\r\n  rectSortingStrategy,\r\n} from \"@dnd-kit/sortable\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport type {\r\n  WidgetId,\r\n  DashboardMode,\r\n  WidgetPosition,\r\n} from \"@/lib/types/dashboard-types\";\r\nimport { WIDGET_CONFIGS } from \"@/lib/types/dashboard-types\";\r\n\r\n// Extracted components\r\nimport { SortableWidgetItem } from \"./SortableWidgetItem\";\r\nimport { renderWidget } from \"./widget-renderer\";\r\nimport { DashboardControls } from \"./DashboardControls\";\r\n\r\ninterface DashboardWidgetGridProps {\r\n  mode: DashboardMode;\r\n  positions: WidgetPosition[];\r\n  hiddenWidgets: WidgetId[];\r\n  onPositionsChange: (positions: WidgetPosition[]) => void;\r\n  onModeChange: (mode: DashboardMode) => void;\r\n  onResetLayout: () => void;\r\n  onToggleWidget?: (widgetId: WidgetId) => void;\r\n  doctorId?: string;\r\n}\r\n\r\nexport function DashboardWidgetGrid({\r\n  mode,\r\n  positions,\r\n  hiddenWidgets,\r\n  onPositionsChange,\r\n  onModeChange,\r\n  onResetLayout,\r\n  onToggleWidget,\r\n  doctorId,\r\n}: DashboardWidgetGridProps) {\r\n  const [activeId, setActiveId] = useState<string | null>(null);\r\n  const [isDragging, setIsDragging] = useState(false);\r\n  const [isTransitioning, setIsTransitioning] = useState(false);\r\n\r\n  // Animación de transición entre modos\r\n  useEffect(() => {\r\n    setIsTransitioning(true);\r\n    const timer = setTimeout(() => setIsTransitioning(false), 300);\r\n    return () => clearTimeout(timer);\r\n  }, [mode]);\r\n\r\n  const sensors = useSensors(\r\n    useSensor(PointerSensor, {\r\n      activationConstraint: {\r\n        distance: 5,\r\n      },\r\n    }),\r\n    useSensor(KeyboardSensor, {\r\n      coordinateGetter: sortableKeyboardCoordinates,\r\n    }),\r\n  );\r\n\r\n  // Filter visible widgets for current mode - memoized for performance\r\n  const visibleWidgets = useMemo(() => {\r\n    return positions.filter(\r\n      (pos) =>\r\n        !hiddenWidgets.includes(pos.id) &&\r\n        WIDGET_CONFIGS[pos.id]?.modes.includes(mode),\r\n    );\r\n  }, [positions, hiddenWidgets, mode]);\r\n\r\n  // Optimize drag handlers with useCallback\r\n  const handleDragStart = useCallback((event: DragStartEvent) => {\r\n    setActiveId(event.active.id as string);\r\n    setIsDragging(true);\r\n  }, []);\r\n\r\n  const handleDragEnd = useCallback(\r\n    (event: DragEndEvent) => {\r\n      const { active, over } = event;\r\n      setActiveId(null);\r\n      setIsDragging(false);\r\n\r\n      if (over && active.id !== over.id) {\r\n        const oldIndex = visibleWidgets.findIndex((w) => w.id === active.id);\r\n        const newIndex = visibleWidgets.findIndex((w) => w.id === over.id);\r\n\r\n        if (oldIndex !== -1 && newIndex !== -1) {\r\n          const newPositions = arrayMove(visibleWidgets, oldIndex, newIndex);\r\n          onPositionsChange(newPositions);\r\n        }\r\n      }\r\n    },\r\n    [visibleWidgets, onPositionsChange],\r\n  );\r\n\r\n  const activeWidget = activeId\r\n    ? visibleWidgets.find((w) => w.id === activeId)\r\n    : null;\r\n\r\n  // Contar widgets por modo para mostrar información\r\n  const simpleWidgetCount = useMemo(\r\n    () =>\r\n      positions.filter(\r\n        (pos) =>\r\n          !hiddenWidgets.includes(pos.id) &&\r\n          WIDGET_CONFIGS[pos.id]?.modes.includes(\"simple\"),\r\n      ).length,\r\n    [positions, hiddenWidgets],\r\n  );\r\n\r\n  const proWidgetCount = useMemo(\r\n    () =>\r\n      positions.filter(\r\n        (pos) =>\r\n          !hiddenWidgets.includes(pos.id) &&\r\n          WIDGET_CONFIGS[pos.id]?.modes.includes(\"pro\"),\r\n      ).length,\r\n    [positions, hiddenWidgets],\r\n  );\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Mode Switcher & Controls */}\r\n      <DashboardControls\r\n        mode={mode}\r\n        onModeChange={onModeChange}\r\n        onResetLayout={onResetLayout}\r\n        hiddenWidgets={hiddenWidgets}\r\n        onToggleWidget={onToggleWidget}\r\n        simpleWidgetCount={simpleWidgetCount}\r\n        proWidgetCount={proWidgetCount}\r\n      />\r\n\r\n      {/* Drag & Drop Grid */}\r\n      <DndContext\r\n        sensors={sensors}\r\n        collisionDetection={closestCenter}\r\n        onDragStart={handleDragStart}\r\n        onDragEnd={handleDragEnd}\r\n      >\r\n        <SortableContext\r\n          items={visibleWidgets.map((w) => w.id)}\r\n          strategy={rectSortingStrategy}\r\n        >\r\n          <div\r\n            className={cn(\r\n              \"grid gap-3 transition-all duration-300\",\r\n              \"grid-cols-1 md:grid-cols-2 lg:grid-cols-4\",\r\n              \"auto-rows-[minmax(170px,auto)]\",\r\n              isTransitioning && \"opacity-50 scale-[0.99]\",\r\n            )}\r\n            data-tour=\"dashboard-grid\"\r\n          >\r\n            <AnimatePresence mode=\"popLayout\">\r\n              {visibleWidgets.map((widget, index) => (\r\n                <motion.div\r\n                  key={widget.id}\r\n                  layout\r\n                  initial={{ opacity: 0, scale: 0.9, y: 20 }}\r\n                  animate={{\r\n                    opacity: 1,\r\n                    scale: 1,\r\n                    y: 0,\r\n                  }}\r\n                  exit={{\r\n                    opacity: 0,\r\n                    scale: 0.9,\r\n                    y: -10,\r\n                  }}\r\n                  transition={{\r\n                    type: \"spring\",\r\n                    stiffness: 400,\r\n                    damping: 30,\r\n                    delay: index * 0.03, // Stagger animation\r\n                  }}\r\n                >\r\n                  <SortableWidgetItem\r\n                    id={widget.id}\r\n                    position={widget}\r\n                    isDraggingFromParent={isDragging && activeId === widget.id}\r\n                  >\r\n                    {renderWidget(widget.id, {\r\n                      doctorId,\r\n                    })}\r\n                  </SortableWidgetItem>\r\n                </motion.div>\r\n              ))}\r\n            </AnimatePresence>\r\n          </div>\r\n        </SortableContext>\r\n\r\n        {/* Drag Overlay - Optimizado */}\r\n        <DragOverlay\r\n          dropAnimation={{\r\n            duration: 200,\r\n            easing: \"cubic-bezier(0.2, 0, 0, 1)\",\r\n          }}\r\n        >\r\n          {activeWidget ? (\r\n            <div\r\n              className={cn(\r\n                \"pointer-events-none\",\r\n                \"drop-shadow-xl\",\r\n                \"ring-2 ring-primary/50 ring-offset-2 ring-offset-background rounded-2xl\",\r\n                \"scale-105 opacity-90\",\r\n              )}\r\n              style={{\r\n                width: activeWidget.w\r\n                  ? `calc(${activeWidget.w * 25}% - 9px)`\r\n                  : undefined,\r\n              }}\r\n            >\r\n              {renderWidget(activeWidget.id, {\r\n                doctorId,\r\n              })}\r\n            </div>\r\n          ) : null}\r\n        </DragOverlay>\r\n      </DndContext>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\dashboard\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\dashboard\\widget-renderer.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'WidgetWrapper' is defined but never used.","line":39,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":39,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingUp' is defined but never used.","line":40,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":40,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Gauge' is defined but never used.","line":40,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":40,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file widget-renderer.tsx\r\n * @description Función central para renderizar widgets del dashboard según su ID.\r\n * Maneja la instanciación de todos los widgets disponibles.\r\n *\r\n * @module Dashboard\r\n */\r\n\r\n\"use client\";\r\n\r\nimport type { WidgetId } from \"@/lib/types/dashboard-types\";\r\n\r\n// Widget Components - Principales\r\nimport { StatsOverviewWidget } from \"./widgets/stats-overview-widget\";\r\nimport { TodayTimelineWidget } from \"./widgets/today-timeline-widget\";\r\nimport { WeekCalendarWidget } from \"./widgets/week-calendar-widget\";\r\nimport { QuickActionsWidget } from \"./widgets/quick-actions-widget\";\r\nimport { NotificationsWidget } from \"./widgets/notifications-widget\";\r\nimport { MessagesWidget } from \"./widgets/messages-widget\";\r\nimport { PendingPatientsWidget } from \"./widgets/pending-patients-widget\";\r\nimport { PerformanceChartWidget } from \"./widgets/performance-chart-widget\";\r\nimport { TasksWidget } from \"./widgets/tasks-widget\";\r\nimport { IncomeWidget } from \"./widgets/income-widget\";\r\nimport { PatientInsightsWidget } from \"./widgets/patient-insights-widget\";\r\n\r\n// Widget Components - Nuevos\r\nimport { FollowUpRemindersWidget } from \"./widgets/follow-up-reminders-widget\";\r\nimport { SatisfactionMetricsWidget } from \"./widgets/satisfaction-metrics-widget\";\r\nimport { UpcomingTelemedicineWidget } from \"./widgets/upcoming-telemedicine-widget\";\r\nimport { LabResultsPendingWidget } from \"./widgets/lab-results-pending-widget\";\r\nimport { PatientBirthdaysWidget } from \"./widgets/patient-birthdays-widget\";\r\nimport { MonthlyGoalsWidget } from \"./widgets/monthly-goals-widget\";\r\n\r\n// Widgets implementados recientemente\r\nimport { RevenueAnalyticsWidget } from \"./widgets/revenue-analytics-widget\";\r\nimport { ProductivityScoreWidget } from \"./widgets/productivity-score-widget\";\r\n\r\n// Placeholder para widgets en desarrollo\r\nimport { WidgetWrapper } from \"./widget-wrapper\";\r\nimport { TrendingUp, Gauge } from \"lucide-react\";\r\n\r\n// ============================================================================\r\n// TIPOS\r\n// ============================================================================\r\n\r\ninterface WidgetRenderProps {\r\n  /** ID del médico para datos personalizados */\r\n  doctorId?: string;\r\n}\r\n\r\n// ============================================================================\r\n// FUNCIÓN PRINCIPAL\r\n// ============================================================================\r\n\r\n/**\r\n * Renderiza un widget específico según su ID.\r\n *\r\n * @param id - Identificador del widget a renderizar\r\n * @param props - Props a pasar al widget\r\n * @returns Componente del widget o mensaje de error\r\n *\r\n * @example\r\n * renderWidget(\"stats-overview\", { doctorId: \"uuid\" });\r\n */\r\nexport function renderWidget(id: WidgetId, props: WidgetRenderProps) {\r\n  const { doctorId } = props;\r\n\r\n  switch (id) {\r\n    // Widgets principales\r\n    case \"stats-overview\":\r\n      return <StatsOverviewWidget doctorId={doctorId} />;\r\n\r\n    case \"today-timeline\":\r\n      return <TodayTimelineWidget doctorId={doctorId} />;\r\n\r\n    case \"week-calendar\":\r\n      return <WeekCalendarWidget doctorId={doctorId} />;\r\n\r\n    case \"quick-actions\":\r\n      return <QuickActionsWidget />;\r\n\r\n    case \"notifications\":\r\n      return <NotificationsWidget doctorId={doctorId} />;\r\n\r\n    case \"messages\":\r\n      return <MessagesWidget doctorId={doctorId} />;\r\n\r\n    case \"pending-patients\":\r\n      return <PendingPatientsWidget doctorId={doctorId} />;\r\n\r\n    case \"performance-chart\":\r\n      return <PerformanceChartWidget doctorId={doctorId} />;\r\n\r\n    case \"tasks\":\r\n      return <TasksWidget doctorId={doctorId} />;\r\n\r\n    case \"income\":\r\n      return <IncomeWidget doctorId={doctorId} />;\r\n\r\n    // Nuevos widgets\r\n    case \"patient-insights\":\r\n      return <PatientInsightsWidget doctorId={doctorId} />;\r\n\r\n    // ====================================================================\r\n    // WIDGETS NUEVOS (6 nuevos)\r\n    // ====================================================================\r\n\r\n    case \"follow-up-reminders\":\r\n      return <FollowUpRemindersWidget doctorId={doctorId} />;\r\n\r\n    case \"satisfaction-metrics\":\r\n      return <SatisfactionMetricsWidget doctorId={doctorId} />;\r\n\r\n    case \"upcoming-telemedicine\":\r\n      return <UpcomingTelemedicineWidget doctorId={doctorId} />;\r\n\r\n    case \"lab-results-pending\":\r\n      return <LabResultsPendingWidget doctorId={doctorId} />;\r\n\r\n    case \"patient-birthdays\":\r\n      return <PatientBirthdaysWidget doctorId={doctorId} />;\r\n\r\n    case \"monthly-goals\":\r\n      return <MonthlyGoalsWidget doctorId={doctorId} />;\r\n\r\n    // ====================================================================\r\n    // WIDGETS IMPLEMENTADOS RECIENTEMENTE\r\n    // ====================================================================\r\n\r\n    case \"revenue-analytics\":\r\n      return <RevenueAnalyticsWidget doctorId={doctorId} />;\r\n\r\n    case \"productivity-score\":\r\n      return <ProductivityScoreWidget doctorId={doctorId} />;\r\n\r\n    default:\r\n      return (\r\n        <div className=\"flex items-center justify-center h-full text-muted-foreground text-sm\">\r\n          Widget no encontrado: {id}\r\n        </div>\r\n      );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\dashboard\\widget-wrapper.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":51,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":51,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { forwardRef } from \"react\";\r\nimport { motion } from \"framer-motion\";\r\nimport { Minimize2, Maximize2, X, Settings, Expand, Shrink } from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport {\r\n    Tooltip,\r\n    TooltipContent,\r\n    TooltipProvider,\r\n    TooltipTrigger,\r\n} from \"@red-salud/ui\";\r\n\r\ninterface WidgetWrapperProps {\r\n    /** ID único del widget */\r\n    id: string;\r\n    /** Título del widget */\r\n    title: string;\r\n    /** Ícono opcional del widget */\r\n    icon?: React.ReactNode;\r\n    /** Contenido del widget */\r\n    children: React.ReactNode;\r\n    /** Clases adicionales para el contenedor */\r\n    className?: string;\r\n    /** Clases adicionales para el header */\r\n    headerClassName?: string;\r\n    /** Si el widget está siendo arrastrado */\r\n    isDragging?: boolean;\r\n    /** Si el widget está minimizado */\r\n    isMinimized?: boolean;\r\n    /** Modo actual del widget */\r\n    mode?: 'compact' | 'expanded';\r\n    /** Si mostrar los controles */\r\n    showControls?: boolean;\r\n    /** Callback al minimizar */\r\n    onMinimize?: () => void;\r\n    /** Callback al maximizar */\r\n    onMaximize?: () => void;\r\n    /** Callback al cambiar modo */\r\n    onModeChange?: () => void;\r\n    /** Callback al configurar */\r\n    onSettings?: () => void;\r\n    /** Callback al eliminar */\r\n    onRemove?: () => void;\r\n}\r\n\r\nexport const WidgetWrapper = forwardRef<HTMLDivElement, WidgetWrapperProps>(\r\n    (\r\n        {\r\n            id,\r\n            title,\r\n            icon,\r\n            children,\r\n            className,\r\n            headerClassName,\r\n            isDragging = false,\r\n            isMinimized = false,\r\n            mode = 'compact',\r\n            showControls = true,\r\n            onMinimize,\r\n            onMaximize,\r\n            onModeChange,\r\n            onSettings,\r\n            onRemove,\r\n        },\r\n        ref\r\n    ) => {\r\n        return (\r\n            <motion.div\r\n                ref={ref}\r\n                initial={{ opacity: 0, y: 20, scale: 0.95 }}\r\n                animate={{\r\n                    opacity: 1,\r\n                    y: 0,\r\n                    scale: isDragging ? 1.02 : 1,\r\n                    rotate: isDragging ? 1 : 0,\r\n                }}\r\n                exit={{ opacity: 0, scale: 0.95 }}\r\n                transition={{\r\n                    type: \"spring\",\r\n                    stiffness: 300,\r\n                    damping: 25\r\n                }}\r\n                className={cn(\r\n                    // Base styles\r\n                    \"relative overflow-hidden rounded-2xl\",\r\n                    // Glassmorphism effect con variables personalizadas\r\n                    \"bg-card/80 backdrop-blur-xl\",\r\n                    \"border border-border/50\",\r\n                    // Dark mode: usar variables de widget\r\n                    \"dark:bg-[hsl(var(--widget-bg))]/95\",\r\n                    \"dark:border-[hsl(var(--widget-border))]/60\",\r\n                    // Shadow\r\n                    \"shadow-lg hover:shadow-xl\",\r\n                    \"dark:shadow-black/60\", // Sombra más fuerte en dark\r\n                    // Hover glow effect\r\n                    \"before:absolute before:inset-0 before:rounded-2xl before:opacity-0 before:transition-opacity before:duration-300\",\r\n                    \"before:bg-gradient-to-br before:from-primary/5 before:to-secondary/5\",\r\n                    \"dark:before:from-primary/10 dark:before:to-secondary/10\",\r\n                    \"before:pointer-events-none\", // Permite que los clicks pasen a través del overlay\r\n                    \"hover:before:opacity-100\",\r\n                    // Dragging state\r\n                    isDragging && \"z-50 shadow-2xl ring-2 ring-primary/30 cursor-grabbing\",\r\n                    className\r\n                )}\r\n            >\r\n                {/* Header */}\r\n                <div\r\n                    className={cn(\r\n                        \"flex items-center justify-between px-4 py-3\",\r\n                        \"border-b border-border/30 dark:border-border/30\",\r\n                        \"bg-gradient-to-r from-muted/30 to-muted/10\",\r\n                        \"dark:from-muted/40 dark:to-muted/20\",\r\n                        headerClassName\r\n                    )}\r\n                >\r\n\r\n\r\n                    <div className=\"flex items-center gap-3\">\r\n                        {/* Icon */}\r\n                        {icon && (\r\n                            <div className=\"flex items-center justify-center w-8 h-8 rounded-lg bg-gradient-to-br from-primary/10 to-secondary/10\">\r\n                                {icon}\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Title */}\r\n                        <h3 className=\"font-semibold text-sm text-foreground\">{title}</h3>\r\n                    </div>\r\n\r\n                    {/* Controls */}\r\n                    {showControls && (\r\n                        <div className=\"flex items-center gap-1\">\r\n                            {onSettings && (\r\n                                <TooltipProvider>\r\n                                    <Tooltip>\r\n                                        <TooltipTrigger asChild>\r\n                                            <Button\r\n                                                variant=\"ghost\"\r\n                                                size=\"icon\"\r\n                                                className=\"h-7 w-7 text-muted-foreground hover:text-foreground\"\r\n                                                onClick={onSettings}\r\n                                            >\r\n                                                <Settings className=\"h-3.5 w-3.5\" />\r\n                                            </Button>\r\n                                        </TooltipTrigger>\r\n                                        <TooltipContent>\r\n                                            <p>Configurar widget</p>\r\n                                        </TooltipContent>\r\n                                    </Tooltip>\r\n                                </TooltipProvider>\r\n                            )}\r\n                            {onModeChange && (\r\n                                <TooltipProvider>\r\n                                    <Tooltip>\r\n                                        <TooltipTrigger asChild>\r\n                                            <Button\r\n                                                variant=\"ghost\"\r\n                                                size=\"icon\"\r\n                                                className=\"h-7 w-7 text-muted-foreground hover:text-foreground\"\r\n                                                onClick={onModeChange}\r\n                                            >\r\n                                                {mode === 'compact' ? (\r\n                                                    <Expand className=\"h-3.5 w-3.5\" />\r\n                                                ) : (\r\n                                                    <Shrink className=\"h-3.5 w-3.5\" />\r\n                                                )}\r\n                                            </Button>\r\n                                        </TooltipTrigger>\r\n                                        <TooltipContent>\r\n                                            <p>{mode === 'compact' ? 'Expandir widget' : 'Compactar widget'}</p>\r\n                                        </TooltipContent>\r\n                                    </Tooltip>\r\n                                </TooltipProvider>\r\n                            )}\r\n                            {(onMinimize || onMaximize) && (\r\n                                <TooltipProvider>\r\n                                    <Tooltip>\r\n                                        <TooltipTrigger asChild>\r\n                                            <Button\r\n                                                variant=\"ghost\"\r\n                                                size=\"icon\"\r\n                                                className=\"h-7 w-7 text-muted-foreground hover:text-foreground\"\r\n                                                onClick={isMinimized ? onMaximize : onMinimize}\r\n                                            >\r\n                                                {isMinimized ? (\r\n                                                    <Maximize2 className=\"h-3.5 w-3.5\" />\r\n                                                ) : (\r\n                                                    <Minimize2 className=\"h-3.5 w-3.5\" />\r\n                                                )}\r\n                                            </Button>\r\n                                        </TooltipTrigger>\r\n                                        <TooltipContent>\r\n                                            <p>{isMinimized ? 'Maximizar' : 'Minimizar'}</p>\r\n                                        </TooltipContent>\r\n                                    </Tooltip>\r\n                                </TooltipProvider>\r\n                            )}\r\n                            {onRemove && (\r\n                                <TooltipProvider>\r\n                                    <Tooltip>\r\n                                        <TooltipTrigger asChild>\r\n                                            <Button\r\n                                                variant=\"ghost\"\r\n                                                size=\"icon\"\r\n                                                className=\"h-7 w-7 text-muted-foreground hover:text-destructive\"\r\n                                                onClick={onRemove}\r\n                                            >\r\n                                                <X className=\"h-3.5 w-3.5\" />\r\n                                            </Button>\r\n                                        </TooltipTrigger>\r\n                                        <TooltipContent>\r\n                                            <p>Remover widget</p>\r\n                                        </TooltipContent>\r\n                                    </Tooltip>\r\n                                </TooltipProvider>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Content */}\r\n                <motion.div\r\n                    animate={{\r\n                        height: isMinimized ? 0 : \"auto\",\r\n                        opacity: isMinimized ? 0 : 1,\r\n                    }}\r\n                    transition={{ duration: 0.2 }}\r\n                    className=\"overflow-hidden\"\r\n                >\r\n                    <div className=\"p-4\">{children}</div>\r\n                </motion.div>\r\n            </motion.div>\r\n        );\r\n    }\r\n);\r\n\r\nWidgetWrapper.displayName = \"WidgetWrapper\";\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\dashboard\\widgets\\current-location-widget.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadTodaySchedules'. Either include it or remove the dependency array.","line":56,"column":8,"nodeType":"ArrayExpression","endLine":56,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [loadTodaySchedules]","fix":{"range":[1606,1608],"text":"[loadTodaySchedules]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file current-location-widget.tsx\r\n * @description Widget que muestra dónde está el médico hoy basado en sus horarios configurados.\r\n * Detecta automáticamente el consultorio activo según el día y hora actual.\r\n * @module Dashboard/Medico/Widgets\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { MapPin, Clock, Loader2, Calendar } from \"lucide-react\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { motion } from \"framer-motion\";\r\n\r\n/** Interfaz para consultorio */\r\ninterface Office {\r\n    id: string;\r\n    nombre: string;\r\n    direccion?: string;\r\n    ciudad?: string;\r\n}\r\n\r\n/** Interfaz para horario */\r\ninterface TimeSlot {\r\n    inicio: string;\r\n    fin: string;\r\n}\r\n\r\n/** Interfaz para horario del día */\r\ninterface TodaySchedule {\r\n    office: Office;\r\n    slots: TimeSlot[];\r\n    isCurrentlyActive: boolean;\r\n}\r\n\r\n/** Días de la semana en español */\r\nconst DAYS_MAP = ['domingo', 'lunes', 'martes', 'miercoles', 'jueves', 'viernes', 'sabado'];\r\n\r\n/**\r\n * Widget que muestra la ubicación actual del médico\r\n */\r\nexport function CurrentLocationWidget() {\r\n    const [loading, setLoading] = useState(true);\r\n    const [todaySchedules, setTodaySchedules] = useState<TodaySchedule[]>([]);\r\n    const [currentTime, setCurrentTime] = useState(new Date());\r\n\r\n    useEffect(() => {\r\n        loadTodaySchedules();\r\n\r\n        // Actualizar cada minuto para mantener el estado activo correcto\r\n        const interval = setInterval(() => {\r\n            setCurrentTime(new Date());\r\n        }, 60000);\r\n\r\n        return () => clearInterval(interval);\r\n    }, []);\r\n\r\n    /**\r\n     * Carga los horarios de hoy del médico\r\n     */\r\n    const loadTodaySchedules = async () => {\r\n        try {\r\n            const { data: { user } } = await supabase.auth.getUser();\r\n            if (!user) return;\r\n\r\n            const today = new Date();\r\n            const dayKey = DAYS_MAP[today.getDay()];\r\n\r\n            // Cargar todos los consultorios con horarios\r\n            const { data: schedulesData, error: schedulesError } = await supabase\r\n                .from(\"doctor_schedules\")\r\n                .select(`\r\n          *,\r\n          doctor_offices (\r\n            id,\r\n            nombre,\r\n            direccion,\r\n            ciudad\r\n          )\r\n        `)\r\n                .eq(\"doctor_id\", user.id);\r\n\r\n            if (schedulesError) throw schedulesError;\r\n\r\n            // Filtrar horarios de hoy\r\n            const todayData: TodaySchedule[] = [];\r\n\r\n            schedulesData?.forEach((schedule) => {\r\n                const daySchedule = schedule.horarios?.[dayKey];\r\n                if (daySchedule?.activo && daySchedule.horarios?.length > 0) {\r\n                    const isActive = checkIfCurrentlyActive(daySchedule.horarios, today);\r\n                    todayData.push({\r\n                        office: schedule.doctor_offices,\r\n                        slots: daySchedule.horarios,\r\n                        isCurrentlyActive: isActive,\r\n                    });\r\n                }\r\n            });\r\n\r\n            setTodaySchedules(todayData);\r\n        } catch (error) {\r\n            console.error(\"[CurrentLocationWidget] Error:\", error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Verifica si algún horario está activo en este momento\r\n     */\r\n    const checkIfCurrentlyActive = (slots: TimeSlot[], now: Date): boolean => {\r\n        const currentMinutes = now.getHours() * 60 + now.getMinutes();\r\n\r\n        return slots.some(slot => {\r\n            const [startH, startM] = slot.inicio.split(':').map(Number);\r\n            const [endH, endM] = slot.fin.split(':').map(Number);\r\n            const startMinutes = startH * 60 + startM;\r\n            const endMinutes = endH * 60 + endM;\r\n\r\n            return currentMinutes >= startMinutes && currentMinutes <= endMinutes;\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Formatea la hora para mostrar\r\n     */\r\n    const formatTime = (time: string) => {\r\n        const [h, m] = time.split(':');\r\n        const hour = parseInt(h);\r\n        return `${hour}:${m}`;\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"flex items-center justify-center p-6\">\r\n                <Loader2 className=\"h-6 w-6 animate-spin text-blue-600\" />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (todaySchedules.length === 0) {\r\n        return (\r\n            <div className=\"p-6 text-center\">\r\n                <Calendar className=\"h-12 w-12 text-gray-300 dark:text-gray-700 mx-auto mb-3\" />\r\n                <p className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                    No tienes consultorios activos hoy\r\n                </p>\r\n                <p className=\"text-xs text-gray-400 dark:text-gray-500 mt-1\">\r\n                    Descansa o configura tus horarios\r\n                </p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    const activeSchedule = todaySchedules.find(s => s.isCurrentlyActive);\r\n    const displaySchedule = activeSchedule || todaySchedules[0];\r\n\r\n    return (\r\n        <div className=\"space-y-4\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center gap-2\">\r\n                <MapPin className=\"h-4 w-4 text-blue-600\" />\r\n                <h3 className=\"text-sm font-semibold text-gray-900 dark:text-gray-100\">\r\n                    Dónde estás hoy\r\n                </h3>\r\n            </div>\r\n\r\n            {/* Current Office Card */}\r\n            <motion.div\r\n                initial={{ opacity: 0, y: 10 }}\r\n                animate={{ opacity: 1, y: 0 }}\r\n                className={`\r\n          p-4 rounded-xl border-2 transition-all\r\n          ${activeSchedule\r\n                        ? 'border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/10'\r\n                        : 'border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-900/10'\r\n                    }\r\n        `}\r\n            >\r\n                {/* Office Name */}\r\n                <div className=\"flex items-start gap-2 mb-2\">\r\n                    <div className=\"flex-1\">\r\n                        <h4 className=\"font-semibold text-gray-900 dark:text-gray-100\">\r\n                            {displaySchedule.office.nombre}\r\n                        </h4>\r\n                        {displaySchedule.office.direccion && (\r\n                            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-0.5\">\r\n                                {displaySchedule.office.direccion}\r\n                                {displaySchedule.office.ciudad && `, ${displaySchedule.office.ciudad}`}\r\n                            </p>\r\n                        )}\r\n                    </div>\r\n                    {activeSchedule && (\r\n                        <div className=\"flex items-center gap-1.5 px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 rounded-full\">\r\n                            <div className=\"h-2 w-2 bg-green-500 rounded-full animate-pulse\" />\r\n                            <span className=\"text-[10px] font-semibold\">Activo</span>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Today's Schedule */}\r\n                <div className=\"space-y-2 mt-3 pt-3 border-t border-gray-200 dark:border-gray-700\">\r\n                    <div className=\"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-400\">\r\n                        <Clock className=\"h-3.5 w-3.5\" />\r\n                        <span className=\"font-medium\">Horarios de hoy:</span>\r\n                    </div>\r\n                    <div className=\"grid grid-cols-2 gap-2\">\r\n                        {displaySchedule.slots.map((slot, idx) => {\r\n                            const isMorning = parseInt(slot.inicio.split(':')[0]) < 14;\r\n                            const currentMinutes = currentTime.getHours() * 60 + currentTime.getMinutes();\r\n                            const [startH, startM] = slot.inicio.split(':').map(Number);\r\n                            const [endH, endM] = slot.fin.split(':').map(Number);\r\n                            const startMinutes = startH * 60 + startM;\r\n                            const endMinutes = endH * 60 + endM;\r\n                            const isNowActive = currentMinutes >= startMinutes && currentMinutes <= endMinutes;\r\n\r\n                            return (\r\n                                <div\r\n                                    key={idx}\r\n                                    className={`\r\n                    text-xs px-2 py-1.5 rounded-lg flex items-center gap-1.5 transition-all\r\n                    ${isNowActive\r\n                                            ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 font-semibold ring-2 ring-green-300 dark:ring-green-700'\r\n                                            : 'bg-white dark:bg-gray-800 text-gray-600 dark:text-gray-400'\r\n                                        }\r\n                  `}\r\n                                >\r\n                                    <span>{isMorning ? '🌅' : '🌆'}</span>\r\n                                    <span>{formatTime(slot.inicio)} - {formatTime(slot.fin)}</span>\r\n                                </div>\r\n                            );\r\n                        })}\r\n                    </div>\r\n                </div>\r\n            </motion.div>\r\n\r\n            {/* Additional Offices Today */}\r\n            {todaySchedules.length > 1 && (\r\n                <div className=\"pt-2 border-t border-gray-200 dark:border-gray-800\">\r\n                    <p className=\"text-xs text-gray-500 dark:text-gray-400 mb-2\">\r\n                        También trabajas en:\r\n                    </p>\r\n                    <div className=\"space-y-1\">\r\n                        {todaySchedules\r\n                            .filter(s => s.office.id !== displaySchedule.office.id)\r\n                            .map((schedule, idx) => (\r\n                                <div\r\n                                    key={idx}\r\n                                    className=\"text-xs px-2 py-1 bg-gray-50 dark:bg-gray-900/30 rounded text-gray-600 dark:text-gray-400\"\r\n                                >\r\n                                    {schedule.office.nombre}\r\n                                </div>\r\n                            ))}\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\dashboard\\widgets\\follow-up-reminders-widget.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'User' is defined but never used.","line":19,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":9},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":165,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":165,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5031,5034],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5031,5034],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file follow-up-reminders-widget.tsx\r\n * @description Widget de recordatorios de seguimiento.\r\n * Muestra pacientes que necesitan seguimiento basado en su última cita.\r\n * \r\n * @module Dashboard/Widgets\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useMemo, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport {\r\n    Bell,\r\n    Calendar,\r\n    ChevronRight,\r\n    Loader2,\r\n    User,\r\n    Clock,\r\n    Send,\r\n    CheckCircle,\r\n    AlertCircle\r\n} from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@red-salud/ui\";\r\nimport {\r\n    Tooltip,\r\n    TooltipContent,\r\n    TooltipProvider,\r\n    TooltipTrigger\r\n} from \"@red-salud/ui\";\r\nimport { WidgetWrapper } from \"../widget-wrapper\";\r\nimport { useDashboardData } from \"@/hooks/use-dashboard-data\";\r\n\r\n// ============================================================================\r\n// TIPOS\r\n// ============================================================================\r\n\r\ninterface FollowUpRemindersWidgetProps {\r\n    /** ID del médico */\r\n    doctorId?: string;\r\n    /** Si está siendo arrastrado */\r\n    isDragging?: boolean;\r\n}\r\n\r\ninterface FollowUpPatient {\r\n    /** ID único del paciente */\r\n    id: string;\r\n    /** Nombre completo */\r\n    name: string;\r\n    /** URL del avatar */\r\n    avatar?: string;\r\n    /** Fecha de última cita */\r\n    lastAppointmentDate: Date;\r\n    /** Días desde última cita */\r\n    daysSinceLastVisit: number;\r\n    /** Motivo de la última cita */\r\n    lastReason?: string;\r\n    /** Nivel de urgencia: normal, moderate, urgent */\r\n    urgency: \"normal\" | \"moderate\" | \"urgent\";\r\n    /** Si ya se envió recordatorio */\r\n    reminderSent?: boolean;\r\n}\r\n\r\n// ============================================================================\r\n// HELPERS\r\n// ============================================================================\r\n\r\n/**\r\n * Obtiene las iniciales de un nombre.\r\n */\r\nfunction getInitials(name: string): string {\r\n    return name\r\n        .split(\" \")\r\n        .map(n => n[0])\r\n        .join(\"\")\r\n        .slice(0, 2)\r\n        .toUpperCase();\r\n}\r\n\r\n/**\r\n * Formatea cuántos días han pasado en texto legible.\r\n */\r\nfunction formatDaysAgo(days: number): string {\r\n    if (days === 0) return \"Hoy\";\r\n    if (days === 1) return \"Ayer\";\r\n    if (days < 7) return `Hace ${days} días`;\r\n    if (days < 30) {\r\n        const weeks = Math.floor(days / 7);\r\n        return `Hace ${weeks} ${weeks === 1 ? \"semana\" : \"semanas\"}`;\r\n    }\r\n    if (days < 365) {\r\n        const months = Math.floor(days / 30);\r\n        return `Hace ${months} ${months === 1 ? \"mes\" : \"meses\"}`;\r\n    }\r\n    const years = Math.floor(days / 365);\r\n    return `Hace ${years} ${years === 1 ? \"año\" : \"años\"}`;\r\n}\r\n\r\n/**\r\n * Calcula nivel de urgencia basado en días desde última visita.\r\n */\r\nfunction calculateUrgency(days: number): \"normal\" | \"moderate\" | \"urgent\" {\r\n    if (days >= 90) return \"urgent\";\r\n    if (days >= 60) return \"moderate\";\r\n    return \"normal\";\r\n}\r\n\r\n/**\r\n * Configuración de colores por nivel de urgencia.\r\n */\r\nconst urgencyConfig = {\r\n    normal: {\r\n        badge: \"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400\",\r\n        dot: \"bg-emerald-500\",\r\n        text: \"text-emerald-600 dark:text-emerald-400\"\r\n    },\r\n    moderate: {\r\n        badge: \"bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400\",\r\n        dot: \"bg-amber-500\",\r\n        text: \"text-amber-600 dark:text-amber-400\"\r\n    },\r\n    urgent: {\r\n        badge: \"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400\",\r\n        dot: \"bg-red-500 animate-pulse\",\r\n        text: \"text-red-600 dark:text-red-400\"\r\n    }\r\n};\r\n\r\n// ============================================================================\r\n// COMPONENTE PRINCIPAL\r\n// ============================================================================\r\n\r\n/**\r\n * Widget de recordatorios de seguimiento.\r\n * Muestra pacientes que no han visitado en mucho tiempo y necesitan seguimiento.\r\n * \r\n * @example\r\n * <FollowUpRemindersWidget doctorId=\"uuid-del-doctor\" />\r\n */\r\nexport function FollowUpRemindersWidget({\r\n    doctorId,\r\n    isDragging\r\n}: FollowUpRemindersWidgetProps) {\r\n    const router = useRouter();\r\n    const { appointments, isLoading } = useDashboardData(doctorId);\r\n    const [sentReminders, setSentReminders] = useState<Set<string>>(new Set());\r\n\r\n    // Calcular pacientes que necesitan seguimiento\r\n    const followUpPatients = useMemo<FollowUpPatient[]>(() => {\r\n        if (!appointments || appointments.length === 0) return [];\r\n\r\n        // Agrupar citas por paciente y encontrar la más reciente\r\n        const patientLastVisit = new Map<string, {\r\n            id: string;\r\n            name: string;\r\n            avatar?: string;\r\n            lastDate: Date;\r\n            lastReason?: string;\r\n        }>();\r\n\r\n        appointments.forEach((apt: any) => {\r\n            // Solo contar citas completadas\r\n            if (apt.status !== \"completed\") return;\r\n\r\n            const patientId = apt.patient_id;\r\n            const aptDate = new Date(`${apt.appointment_date}T${apt.appointment_time || \"00:00:00\"}`);\r\n\r\n            const existing = patientLastVisit.get(patientId);\r\n            if (!existing || aptDate > existing.lastDate) {\r\n                patientLastVisit.set(patientId, {\r\n                    id: patientId,\r\n                    name: apt.patient?.nombre_completo || \"Paciente\",\r\n                    avatar: apt.patient?.avatar_url,\r\n                    lastDate: aptDate,\r\n                    lastReason: apt.reason\r\n                });\r\n            }\r\n        });\r\n\r\n        // Convertir a array y calcular días\r\n        const now = new Date();\r\n        const patients: FollowUpPatient[] = [];\r\n\r\n        patientLastVisit.forEach((patient) => {\r\n            const diffTime = now.getTime() - patient.lastDate.getTime();\r\n            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));\r\n\r\n            // Solo incluir pacientes con más de 30 días sin visita\r\n            if (diffDays >= 30) {\r\n                patients.push({\r\n                    id: patient.id,\r\n                    name: patient.name,\r\n                    avatar: patient.avatar,\r\n                    lastAppointmentDate: patient.lastDate,\r\n                    daysSinceLastVisit: diffDays,\r\n                    lastReason: patient.lastReason,\r\n                    urgency: calculateUrgency(diffDays),\r\n                    reminderSent: sentReminders.has(patient.id)\r\n                });\r\n            }\r\n        });\r\n\r\n        // Ordenar por urgencia y días\r\n        return patients.sort((a, b) => {\r\n            const urgencyOrder = { urgent: 0, moderate: 1, normal: 2 };\r\n            if (urgencyOrder[a.urgency] !== urgencyOrder[b.urgency]) {\r\n                return urgencyOrder[a.urgency] - urgencyOrder[b.urgency];\r\n            }\r\n            return b.daysSinceLastVisit - a.daysSinceLastVisit;\r\n        }).slice(0, 5); // Máximo 5 pacientes\r\n\r\n    }, [appointments, sentReminders]);\r\n\r\n    // Handler para enviar recordatorio\r\n    const handleSendReminder = async (patientId: string) => {\r\n        // TODO: Integrar con sistema de notificaciones real\r\n        setSentReminders(prev => new Set([...prev, patientId]));\r\n    };\r\n\r\n    // Handler para agendar cita\r\n    const handleScheduleAppointment = (patientId: string) => {\r\n        router.push(`/dashboard/medico/citas/nueva?paciente=${patientId}`);\r\n    };\r\n\r\n    return (\r\n        <WidgetWrapper\r\n            id=\"follow-up-reminders\"\r\n            title=\"Seguimiento Pacientes\"\r\n            icon={<Bell className=\"h-4 w-4 text-primary\" />}\r\n            isDragging={isDragging}\r\n            showControls={false}\r\n        >\r\n            <div className=\"space-y-3\">\r\n                {/* Estado de carga */}\r\n                {isLoading ? (\r\n                    <div className=\"flex items-center justify-center py-8\">\r\n                        <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\r\n                    </div>\r\n                ) : (\r\n                    <>\r\n                        {/* Header con conteo */}\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <Badge\r\n                                variant=\"secondary\"\r\n                                className={cn(\r\n                                    \"text-[10px] gap-1\",\r\n                                    followUpPatients.some(p => p.urgency === \"urgent\") &&\r\n                                    \"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400\"\r\n                                )}\r\n                            >\r\n                                <AlertCircle className=\"h-2.5 w-2.5\" />\r\n                                {followUpPatients.length} pendientes\r\n                            </Badge>\r\n                            {followUpPatients.some(p => p.urgency === \"urgent\") && (\r\n                                <Badge variant=\"destructive\" className=\"text-[10px] animate-pulse\">\r\n                                    !Urgente\r\n                                </Badge>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Lista de pacientes */}\r\n                        <div className=\"space-y-2\">\r\n                            <AnimatePresence mode=\"popLayout\">\r\n                                {followUpPatients.length > 0 ? (\r\n                                    followUpPatients.map((patient, index) => (\r\n                                        <motion.div\r\n                                            key={patient.id}\r\n                                            initial={{ opacity: 0, y: -10 }}\r\n                                            animate={{ opacity: 1, y: 0 }}\r\n                                            exit={{ opacity: 0, x: -10 }}\r\n                                            transition={{ delay: index * 0.05 }}\r\n                                            className={cn(\r\n                                                \"flex items-center gap-2 p-2 rounded-lg\",\r\n                                                \"bg-muted/30 hover:bg-muted/50 transition-colors\",\r\n                                                \"border-l-2\",\r\n                                                patient.urgency === \"urgent\" && \"border-l-red-500\",\r\n                                                patient.urgency === \"moderate\" && \"border-l-amber-500\",\r\n                                                patient.urgency === \"normal\" && \"border-l-emerald-500\"\r\n                                            )}\r\n                                        >\r\n                                            {/* Avatar con indicador de urgencia */}\r\n                                            <div className=\"relative\">\r\n                                                <Avatar className=\"h-8 w-8\">\r\n                                                    {patient.avatar ? (\r\n                                                        <AvatarImage src={patient.avatar} alt={patient.name} />\r\n                                                    ) : null}\r\n                                                    <AvatarFallback className=\"text-xs bg-gradient-to-br from-primary/20 to-secondary/20\">\r\n                                                        {getInitials(patient.name)}\r\n                                                    </AvatarFallback>\r\n                                                </Avatar>\r\n                                                <div\r\n                                                    className={cn(\r\n                                                        \"absolute -bottom-0.5 -right-0.5 w-2.5 h-2.5 rounded-full border-2 border-background\",\r\n                                                        urgencyConfig[patient.urgency].dot\r\n                                                    )}\r\n                                                />\r\n                                            </div>\r\n\r\n                                            {/* Información del paciente */}\r\n                                            <div className=\"flex-1 min-w-0\">\r\n                                                <p className=\"text-xs font-medium truncate\">\r\n                                                    {patient.name}\r\n                                                </p>\r\n                                                <div className=\"flex items-center gap-1 text-[10px] text-muted-foreground\">\r\n                                                    <Clock className=\"h-2.5 w-2.5\" />\r\n                                                    <span className={urgencyConfig[patient.urgency].text}>\r\n                                                        {formatDaysAgo(patient.daysSinceLastVisit)}\r\n                                                    </span>\r\n                                                </div>\r\n                                            </div>\r\n\r\n                                            {/* Acciones */}\r\n                                            <div className=\"flex items-center gap-1\">\r\n                                                <TooltipProvider>\r\n                                                    <Tooltip>\r\n                                                        <TooltipTrigger asChild>\r\n                                                            <Button\r\n                                                                variant=\"ghost\"\r\n                                                                size=\"icon\"\r\n                                                                className={cn(\r\n                                                                    \"h-6 w-6\",\r\n                                                                    patient.reminderSent && \"text-emerald-500\"\r\n                                                                )}\r\n                                                                onClick={() => handleSendReminder(patient.id)}\r\n                                                                disabled={patient.reminderSent}\r\n                                                            >\r\n                                                                {patient.reminderSent ? (\r\n                                                                    <CheckCircle className=\"h-3 w-3\" />\r\n                                                                ) : (\r\n                                                                    <Send className=\"h-3 w-3\" />\r\n                                                                )}\r\n                                                            </Button>\r\n                                                        </TooltipTrigger>\r\n                                                        <TooltipContent>\r\n                                                            {patient.reminderSent\r\n                                                                ? \"Recordatorio enviado\"\r\n                                                                : \"Enviar recordatorio\"\r\n                                                            }\r\n                                                        </TooltipContent>\r\n                                                    </Tooltip>\r\n                                                </TooltipProvider>\r\n\r\n                                                <TooltipProvider>\r\n                                                    <Tooltip>\r\n                                                        <TooltipTrigger asChild>\r\n                                                            <Button\r\n                                                                variant=\"ghost\"\r\n                                                                size=\"icon\"\r\n                                                                className=\"h-6 w-6\"\r\n                                                                onClick={() => handleScheduleAppointment(patient.id)}\r\n                                                            >\r\n                                                                <Calendar className=\"h-3 w-3\" />\r\n                                                            </Button>\r\n                                                        </TooltipTrigger>\r\n                                                        <TooltipContent>\r\n                                                            Agendar cita\r\n                                                        </TooltipContent>\r\n                                                    </Tooltip>\r\n                                                </TooltipProvider>\r\n                                            </div>\r\n                                        </motion.div>\r\n                                    ))\r\n                                ) : (\r\n                                    <motion.div\r\n                                        initial={{ opacity: 0 }}\r\n                                        animate={{ opacity: 1 }}\r\n                                        className=\"text-center py-6 text-muted-foreground\"\r\n                                    >\r\n                                        <CheckCircle className=\"h-8 w-8 mx-auto mb-2 opacity-50 text-emerald-500\" />\r\n                                        <p className=\"text-xs\">¡Todos los pacientes al día!</p>\r\n                                        <p className=\"text-[10px] mt-1\">No hay seguimientos pendientes</p>\r\n                                    </motion.div>\r\n                                )}\r\n                            </AnimatePresence>\r\n                        </div>\r\n\r\n                        {/* Ver todos */}\r\n                        {followUpPatients.length > 0 && (\r\n                            <Button\r\n                                variant=\"outline\"\r\n                                className=\"w-full text-xs h-7\"\r\n                                onClick={() => router.push(\"/dashboard/medico/pacientes?filter=follow-up\")}\r\n                            >\r\n                                Ver todos los seguimientos\r\n                                <ChevronRight className=\"h-3 w-3 ml-1\" />\r\n                            </Button>\r\n                        )}\r\n                    </>\r\n                )}\r\n            </div>\r\n        </WidgetWrapper>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\dashboard\\widgets\\income-widget.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\dashboard\\widgets\\lab-results-pending-widget.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AlertCircle' is defined but never used.","line":16,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'User' is defined but never used.","line":22,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Clock' is defined but never used.","line":23,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":10},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":358,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":358,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16051,16054],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16051,16054],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":360,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":360,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16168,16171],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16168,16171],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":361,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":361,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16278,16281],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16278,16281],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":362,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":362,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16373,16376],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16373,16376],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file lab-results-pending-widget.tsx\r\n * @description Widget de resultados de laboratorio pendientes de revisión.\r\n * Muestra órdenes de lab con resultados nuevos que requieren atención del médico.\r\n * \r\n * @module Dashboard/Widgets\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport {\r\n    FlaskConical,\r\n    AlertCircle,\r\n    ChevronRight,\r\n    Loader2,\r\n    Eye,\r\n    CheckCircle,\r\n    FileText,\r\n    User,\r\n    Clock,\r\n    AlertTriangle\r\n} from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@red-salud/ui\";\r\nimport {\r\n    Tooltip,\r\n    TooltipContent,\r\n    TooltipProvider,\r\n    TooltipTrigger\r\n} from \"@red-salud/ui\";\r\nimport { WidgetWrapper } from \"../widget-wrapper\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\n\r\n// ============================================================================\r\n// TIPOS\r\n// ============================================================================\r\n\r\ninterface LabResultsPendingWidgetProps {\r\n    /** ID del médico */\r\n    doctorId?: string;\r\n    /** Si está siendo arrastrado */\r\n    isDragging?: boolean;\r\n}\r\n\r\ninterface PendingLabResult {\r\n    /** ID de la orden */\r\n    id: string;\r\n    /** ID del paciente */\r\n    patientId: string;\r\n    /** Nombre del paciente */\r\n    patientName: string;\r\n    /** Avatar del paciente */\r\n    patientAvatar?: string;\r\n    /** Tipos de exámenes */\r\n    testTypes: string[];\r\n    /** Fecha de los resultados */\r\n    resultDate: Date;\r\n    /** Si tiene valores anormales */\r\n    hasAbnormal: boolean;\r\n    /** Cantidad de valores anormales */\r\n    abnormalCount: number;\r\n    /** Estado: nuevo o revisado */\r\n    status: \"new\" | \"reviewed\";\r\n}\r\n\r\n// ============================================================================\r\n// HELPERS\r\n// ============================================================================\r\n\r\n/**\r\n * Obtiene las iniciales de un nombre.\r\n */\r\nfunction getInitials(name: string): string {\r\n    return name\r\n        .split(\" \")\r\n        .map(n => n[0])\r\n        .join(\"\")\r\n        .slice(0, 2)\r\n        .toUpperCase();\r\n}\r\n\r\n/**\r\n * Formatea fecha relativa.\r\n */\r\nfunction formatRelativeDate(date: Date): string {\r\n    const now = new Date();\r\n    const diffMs = now.getTime() - date.getTime();\r\n    const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));\r\n\r\n    if (diffDays === 0) return \"Hoy\";\r\n    if (diffDays === 1) return \"Ayer\";\r\n    if (diffDays < 7) return `Hace ${diffDays} días`;\r\n\r\n    return date.toLocaleDateString(\"es-ES\", {\r\n        day: \"numeric\",\r\n        month: \"short\"\r\n    });\r\n}\r\n\r\n// ============================================================================\r\n// COMPONENTE PRINCIPAL\r\n// ============================================================================\r\n\r\n/**\r\n * Widget de resultados de laboratorio pendientes.\r\n * Muestra órdenes con resultados listos para revisar.\r\n * \r\n * @example\r\n * <LabResultsPendingWidget doctorId=\"uuid-del-doctor\" />\r\n */\r\nexport function LabResultsPendingWidget({\r\n    doctorId,\r\n    isDragging\r\n}: LabResultsPendingWidgetProps) {\r\n    const router = useRouter();\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [pendingResults, setPendingResults] = useState<PendingLabResult[]>([]);\r\n    const [reviewedIds, setReviewedIds] = useState<Set<string>>(new Set());\r\n\r\n    // Cargar datos de laboratorio\r\n    useEffect(() => {\r\n        const loadLabResults = async () => {\r\n            if (!doctorId) {\r\n                setIsLoading(false);\r\n                return;\r\n            }\r\n\r\n            try {\r\n                // Intentar cargar órdenes de lab con resultados pendientes de revisar\r\n                const { data: orders, error } = await supabase\r\n                    .from(\"lab_orders\")\r\n                    .select(`\r\n                        id,\r\n                        paciente_id,\r\n                        status,\r\n                        created_at,\r\n                        lab_results (\r\n                            id,\r\n                            test_type:lab_test_types(nombre),\r\n                            lab_result_values (\r\n                                es_anormal\r\n                            )\r\n                        ),\r\n                        patient:profiles!lab_orders_paciente_id_fkey (\r\n                            nombre_completo,\r\n                            avatar_url\r\n                        )\r\n                    `)\r\n                    .eq(\"medico_id\", doctorId)\r\n                    .eq(\"status\", \"completada\")\r\n                    .order(\"created_at\", { ascending: false })\r\n                    .limit(20);\r\n\r\n                if (error) {\r\n                    // Si no existe la tabla, no mostrar nada\r\n                    console.log(\"[LabResultsPending] Error o sin tabla:\", error.message);\r\n                    setPendingResults([]);\r\n                } else if (orders && orders.length > 0) {\r\n                    // Procesar órdenes reales\r\n                    const processed = processLabOrders(orders);\r\n                    setPendingResults(processed);\r\n                } else {\r\n                    // Sin órdenes\r\n                    setPendingResults([]);\r\n                }\r\n            } catch (err) {\r\n                console.error(\"[LabResultsPending] Error:\", err);\r\n                setPendingResults([]);\r\n            } finally {\r\n                setIsLoading(false);\r\n            }\r\n        };\r\n\r\n        loadLabResults();\r\n    }, [doctorId]);\r\n\r\n    // Handler para ver resultado\r\n    const handleViewResult = (orderId: string) => {\r\n        router.push(`/dashboard/medico/laboratorio/orden/${orderId}`);\r\n    };\r\n\r\n    // Handler para marcar como revisado\r\n    const handleMarkReviewed = (orderId: string) => {\r\n        setReviewedIds(prev => new Set([...prev, orderId]));\r\n        // TODO: Actualizar en Supabase\r\n    };\r\n\r\n    // Filtrar resultados no revisados\r\n    const visibleResults = pendingResults.filter(r => !reviewedIds.has(r.id));\r\n    const hasAbnormalResults = visibleResults.some(r => r.hasAbnormal);\r\n\r\n    return (\r\n        <WidgetWrapper\r\n            id=\"lab-results-pending\"\r\n            title=\"Lab Pendientes\"\r\n            icon={<FlaskConical className=\"h-4 w-4 text-pink-500\" />}\r\n            isDragging={isDragging}\r\n            showControls={false}\r\n        >\r\n            <div className=\"space-y-3\">\r\n                {isLoading ? (\r\n                    <div className=\"flex items-center justify-center py-8\">\r\n                        <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\r\n                    </div>\r\n                ) : (\r\n                    <>\r\n                        {/* Header con conteo */}\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <Badge\r\n                                variant=\"secondary\"\r\n                                className={cn(\r\n                                    \"text-[10px] gap-1\",\r\n                                    hasAbnormalResults && \"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400\"\r\n                                )}\r\n                            >\r\n                                <FileText className=\"h-2.5 w-2.5\" />\r\n                                {visibleResults.length} por revisar\r\n                            </Badge>\r\n                            {hasAbnormalResults && (\r\n                                <Badge\r\n                                    variant=\"destructive\"\r\n                                    className=\"text-[10px] gap-1\"\r\n                                >\r\n                                    <AlertTriangle className=\"h-2.5 w-2.5\" />\r\n                                    Valores anormales\r\n                                </Badge>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Lista de resultados */}\r\n                        <div className=\"space-y-2\">\r\n                            <AnimatePresence mode=\"popLayout\">\r\n                                {visibleResults.length > 0 ? (\r\n                                    visibleResults.slice(0, 4).map((result, index) => (\r\n                                        <motion.div\r\n                                            key={result.id}\r\n                                            initial={{ opacity: 0, y: -10 }}\r\n                                            animate={{ opacity: 1, y: 0 }}\r\n                                            exit={{ opacity: 0, x: -20 }}\r\n                                            transition={{ delay: index * 0.05 }}\r\n                                            className={cn(\r\n                                                \"flex items-center gap-2 p-2 rounded-lg\",\r\n                                                \"bg-muted/30 hover:bg-muted/50 transition-colors\",\r\n                                                result.hasAbnormal && \"border-l-2 border-l-red-500\"\r\n                                            )}\r\n                                        >\r\n                                            {/* Avatar */}\r\n                                            <div className=\"relative\">\r\n                                                <Avatar className=\"h-8 w-8\">\r\n                                                    {result.patientAvatar ? (\r\n                                                        <AvatarImage src={result.patientAvatar} alt={result.patientName} />\r\n                                                    ) : null}\r\n                                                    <AvatarFallback className=\"text-xs bg-gradient-to-br from-pink-500/20 to-purple-500/20\">\r\n                                                        {getInitials(result.patientName)}\r\n                                                    </AvatarFallback>\r\n                                                </Avatar>\r\n                                                {result.hasAbnormal && (\r\n                                                    <div className=\"absolute -top-0.5 -right-0.5 w-3 h-3 rounded-full bg-red-500 border-2 border-background flex items-center justify-center\">\r\n                                                        <span className=\"text-[8px] text-white font-bold\">\r\n                                                            {result.abnormalCount}\r\n                                                        </span>\r\n                                                    </div>\r\n                                                )}\r\n                                            </div>\r\n\r\n                                            {/* Información */}\r\n                                            <div className=\"flex-1 min-w-0\">\r\n                                                <p className=\"text-xs font-medium truncate\">\r\n                                                    {result.patientName}\r\n                                                </p>\r\n                                                <div className=\"flex items-center gap-1 text-[10px] text-muted-foreground\">\r\n                                                    <span className=\"truncate max-w-[100px]\">\r\n                                                        {result.testTypes.slice(0, 2).join(\", \")}\r\n                                                        {result.testTypes.length > 2 && ` +${result.testTypes.length - 2}`}\r\n                                                    </span>\r\n                                                    <span className=\"text-border\">•</span>\r\n                                                    <span>{formatRelativeDate(result.resultDate)}</span>\r\n                                                </div>\r\n                                            </div>\r\n\r\n                                            {/* Acciones */}\r\n                                            <div className=\"flex items-center gap-1\">\r\n                                                <TooltipProvider>\r\n                                                    <Tooltip>\r\n                                                        <TooltipTrigger asChild>\r\n                                                            <Button\r\n                                                                variant=\"ghost\"\r\n                                                                size=\"icon\"\r\n                                                                className=\"h-6 w-6\"\r\n                                                                onClick={() => handleMarkReviewed(result.id)}\r\n                                                            >\r\n                                                                <CheckCircle className=\"h-3 w-3\" />\r\n                                                            </Button>\r\n                                                        </TooltipTrigger>\r\n                                                        <TooltipContent>\r\n                                                            Marcar como revisado\r\n                                                        </TooltipContent>\r\n                                                    </Tooltip>\r\n                                                </TooltipProvider>\r\n\r\n                                                <Button\r\n                                                    size=\"sm\"\r\n                                                    variant={result.hasAbnormal ? \"destructive\" : \"default\"}\r\n                                                    className=\"h-6 text-[10px] px-2\"\r\n                                                    onClick={() => handleViewResult(result.id)}\r\n                                                >\r\n                                                    <Eye className=\"h-2.5 w-2.5 mr-1\" />\r\n                                                    Ver\r\n                                                </Button>\r\n                                            </div>\r\n                                        </motion.div>\r\n                                    ))\r\n                                ) : (\r\n                                    <motion.div\r\n                                        initial={{ opacity: 0 }}\r\n                                        animate={{ opacity: 1 }}\r\n                                        className=\"text-center py-6 text-muted-foreground\"\r\n                                    >\r\n                                        <CheckCircle className=\"h-8 w-8 mx-auto mb-2 opacity-50 text-emerald-500\" />\r\n                                        <p className=\"text-xs\">¡Todo revisado!</p>\r\n                                        <p className=\"text-[10px] mt-1\">No hay resultados pendientes</p>\r\n                                    </motion.div>\r\n                                )}\r\n                            </AnimatePresence>\r\n                        </div>\r\n\r\n                        {/* Ver todos */}\r\n                        {visibleResults.length > 0 && (\r\n                            <Button\r\n                                variant=\"outline\"\r\n                                className=\"w-full text-xs h-7\"\r\n                                onClick={() => router.push(\"/dashboard/medico/laboratorio\")}\r\n                            >\r\n                                <FlaskConical className=\"h-3 w-3 mr-1\" />\r\n                                Ver laboratorio\r\n                                <ChevronRight className=\"h-3 w-3 ml-1\" />\r\n                            </Button>\r\n                        )}\r\n                    </>\r\n                )}\r\n            </div>\r\n        </WidgetWrapper>\r\n    );\r\n}\r\n\r\n// ============================================================================\r\n// HELPERS DE DATOS\r\n// ============================================================================\r\n\r\n/**\r\n * Procesa órdenes de laboratorio de Supabase.\r\n */\r\nfunction processLabOrders(orders: any[]): PendingLabResult[] {\r\n    return orders.map(order => {\r\n        const testTypes = order.lab_results?.map((r: any) => r.test_type?.nombre).filter(Boolean) || [];\r\n        const allValues = order.lab_results?.flatMap((r: any) => r.lab_result_values || []) || [];\r\n        const abnormalValues = allValues.filter((v: any) => v.es_anormal);\r\n\r\n        return {\r\n            id: order.id,\r\n            patientId: order.paciente_id,\r\n            patientName: order.patient?.nombre_completo || \"Paciente\",\r\n            patientAvatar: order.patient?.avatar_url,\r\n            testTypes: testTypes.length > 0 ? testTypes : [\"Exámenes\"],\r\n            resultDate: new Date(order.created_at),\r\n            hasAbnormal: abnormalValues.length > 0,\r\n            abnormalCount: abnormalValues.length,\r\n            status: \"new\" as const\r\n        };\r\n    }).filter(r => r.testTypes.length > 0);\r\n}\r\n\r\n/**\r\n * Genera datos de demostración.\r\n */\r\n// generateDemoResults eliminado para evitar datos falsos\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\dashboard\\widgets\\messages-widget.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\dashboard\\widgets\\monthly-goals-widget.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChevronRight' is defined but never used.","line":16,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Plus' is defined but never used.","line":19,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":9},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":198,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":198,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6385,6388],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6385,6388],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'monthRevenue' is assigned a value but never used.","line":204,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":204,"endColumn":27}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file monthly-goals-widget.tsx\r\n * @description Widget de metas mensuales del médico.\r\n * Permite configurar objetivos y visualizar el progreso.\r\n * \r\n * @module Dashboard/Widgets\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useState, useEffect, useMemo } from \"react\";\r\nimport { motion } from \"framer-motion\";\r\nimport {\r\n    Target,\r\n    TrendingUp,\r\n    ChevronRight,\r\n    Loader2,\r\n    CheckCircle,\r\n    Plus,\r\n    Edit,\r\n    Calendar,\r\n    Users,\r\n    DollarSign,\r\n    Star\r\n} from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Progress } from \"@red-salud/ui\";\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogHeader,\r\n    DialogTitle,\r\n    DialogTrigger\r\n} from \"@red-salud/ui\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { Label } from \"@red-salud/ui\";\r\nimport { WidgetWrapper } from \"../widget-wrapper\";\r\nimport { useDashboardData } from \"@/hooks/use-dashboard-data\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\n\r\n// ============================================================================\r\n// TIPOS\r\n// ============================================================================\r\n\r\ninterface MonthlyGoalsWidgetProps {\r\n    /** ID del médico */\r\n    doctorId?: string;\r\n    /** Si está siendo arrastrado */\r\n    isDragging?: boolean;\r\n}\r\n\r\ninterface Goal {\r\n    /** ID de la meta */\r\n    id: string;\r\n    /** Tipo de meta */\r\n    type: \"appointments\" | \"patients\" | \"revenue\" | \"rating\";\r\n    /** Etiqueta personalizada */\r\n    label: string;\r\n    /** Valor objetivo */\r\n    target: number;\r\n    /** Valor actual */\r\n    current: number;\r\n    /** Porcentaje completado */\r\n    percentage: number;\r\n    /** Ícono */\r\n    icon: React.ReactNode;\r\n    /** Color de la barra de progreso */\r\n    color: string;\r\n}\r\n\r\n// ============================================================================\r\n// CONFIGURACIÓN\r\n// ============================================================================\r\n\r\nconst goalTypeConfig = {\r\n    appointments: {\r\n        label: \"Citas del mes\",\r\n        icon: <Calendar className=\"h-3 w-3\" />,\r\n        color: \"bg-blue-500\",\r\n        progressColor: \"bg-blue-500\"\r\n    },\r\n    patients: {\r\n        label: \"Nuevos pacientes\",\r\n        icon: <Users className=\"h-3 w-3\" />,\r\n        color: \"bg-emerald-500\",\r\n        progressColor: \"bg-emerald-500\"\r\n    },\r\n    revenue: {\r\n        label: \"Ingresos\",\r\n        icon: <DollarSign className=\"h-3 w-3\" />,\r\n        color: \"bg-amber-500\",\r\n        progressColor: \"bg-amber-500\"\r\n    },\r\n    rating: {\r\n        label: \"Calificación promedio\",\r\n        icon: <Star className=\"h-3 w-3\" />,\r\n        color: \"bg-purple-500\",\r\n        progressColor: \"bg-purple-500\"\r\n    }\r\n};\r\n\r\n// ============================================================================\r\n// COMPONENTE PRINCIPAL\r\n// ============================================================================\r\n\r\n/**\r\n * Widget de metas mensuales.\r\n * Permite configurar y visualizar objetivos del mes.\r\n * \r\n * @example\r\n * <MonthlyGoalsWidget doctorId=\"uuid-del-doctor\" />\r\n */\r\nexport function MonthlyGoalsWidget({\r\n    doctorId,\r\n    isDragging\r\n}: MonthlyGoalsWidgetProps) {\r\n    const { stats, appointments, isLoading } = useDashboardData(doctorId);\r\n    const [goals, setGoals] = useState<Goal[]>([]);\r\n    const [isDialogOpen, setIsDialogOpen] = useState(false);\r\n    const [editingGoal, setEditingGoal] = useState<Goal | null>(null);\r\n    const [targetValue, setTargetValue] = useState(\"\");\r\n\r\n    // Cargar metas guardadas\r\n    useEffect(() => {\r\n        const loadGoals = async () => {\r\n            if (!doctorId) return;\r\n\r\n            try {\r\n                // Intentar cargar metas de Supabase para el mes actual\r\n                const now = new Date();\r\n                const year = now.getFullYear();\r\n                const month = now.getMonth() + 1;\r\n\r\n                const { data, error } = await supabase\r\n                    .from(\"doctor_goals\")\r\n                    .select(\"*\")\r\n                    .eq(\"doctor_id\", doctorId)\r\n                    .eq(\"year\", year)\r\n                    .eq(\"month\", month)\r\n                    .single();\r\n\r\n                if (!error && data) {\r\n                    // Mapear el registro único a nuestro array de metas\r\n                    const loadedGoals: Goal[] = [\r\n                        {\r\n                            id: \"appointments\",\r\n                            type: \"appointments\",\r\n                            target: data.target_appointments || 0,\r\n                            current: 0,\r\n                            percentage: 0,\r\n                            ...goalTypeConfig.appointments\r\n                        },\r\n                        {\r\n                            id: \"patients\",\r\n                            type: \"patients\",\r\n                            target: data.target_new_patients || 0,\r\n                            current: 0,\r\n                            percentage: 0,\r\n                            ...goalTypeConfig.patients\r\n                        },\r\n                        {\r\n                            id: \"revenue\",\r\n                            type: \"revenue\",\r\n                            target: data.target_revenue || 0,\r\n                            current: 0,\r\n                            percentage: 0,\r\n                            ...goalTypeConfig.revenue\r\n                        },\r\n                        {\r\n                            id: \"rating\",\r\n                            type: \"rating\",\r\n                            target: data.target_rating || 0,\r\n                            current: 0,\r\n                            percentage: 0,\r\n                            ...goalTypeConfig.rating\r\n                        }\r\n                    ];\r\n                    setGoals(loadedGoals);\r\n                }\r\n            } catch (err) {\r\n                console.error(\"[MonthlyGoals] Error loading goals:\", err);\r\n            }\r\n        };\r\n\r\n        loadGoals();\r\n    }, [doctorId]);\r\n\r\n    // Calcular valores actuales de las metas\r\n    useEffect(() => {\r\n        if (isLoading || !stats) return;\r\n\r\n        // Calcular métricas del mes actual\r\n        const now = new Date();\r\n        const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);\r\n\r\n        const monthAppointments = appointments?.filter((apt: any) => {\r\n            const aptDate = new Date(apt.appointment_date);\r\n            return aptDate >= startOfMonth && apt.status === \"completed\";\r\n        }).length || 0;\r\n\r\n        // Valor de muestra para ingresos (se puede conectar a billing real)\r\n        const monthRevenue = monthAppointments * 50; // Estimación básica\r\n\r\n        // Generar metas por defecto (0 si no hay guardadas)\r\n        const defaultGoals: Goal[] = [\r\n            {\r\n                id: \"appointments\",\r\n                type: \"appointments\",\r\n                label: goalTypeConfig.appointments.label,\r\n                target: 0,\r\n                current: monthAppointments,\r\n                percentage: 0,\r\n                icon: goalTypeConfig.appointments.icon,\r\n                color: goalTypeConfig.appointments.progressColor\r\n            },\r\n            {\r\n                id: \"patients\",\r\n                type: \"patients\",\r\n                label: goalTypeConfig.patients.label,\r\n                target: 0,\r\n                current: 0, // TODO: Calcular nuevos pacientes reales\r\n                percentage: 0,\r\n                icon: goalTypeConfig.patients.icon,\r\n                color: goalTypeConfig.patients.progressColor\r\n            },\r\n            {\r\n                id: \"revenue\",\r\n                type: \"revenue\",\r\n                label: goalTypeConfig.revenue.label,\r\n                target: 0,\r\n                current: 0, // Revenue en 0 por defecto\r\n                percentage: 0,\r\n                icon: goalTypeConfig.revenue.icon,\r\n                color: goalTypeConfig.revenue.progressColor\r\n            },\r\n            {\r\n                id: \"rating\",\r\n                type: \"rating\",\r\n                label: goalTypeConfig.rating.label,\r\n                target: 0,\r\n                current: stats.averageRating || 0,\r\n                percentage: 0,\r\n                icon: goalTypeConfig.rating.icon,\r\n                color: goalTypeConfig.rating.progressColor\r\n            }\r\n        ];\r\n\r\n        // Si ya cargamos metas de Supabase, combinar con los valores actuales calculados\r\n        setGoals(prev => {\r\n            if (prev.length === 0) return defaultGoals;\r\n\r\n            // Mantener targets cargados de Supabase, actualizar currents calculados\r\n            return prev.map(savedGoal => {\r\n                const calculated = defaultGoals.find(dg => dg.type === savedGoal.type);\r\n                if (calculated) {\r\n                    const percentage = savedGoal.target > 0\r\n                        ? Math.min(100, Math.round((calculated.current / savedGoal.target) * 100))\r\n                        : 0;\r\n                    return { ...savedGoal, current: calculated.current, percentage };\r\n                }\r\n                return savedGoal;\r\n            });\r\n        });\r\n\r\n    }, [stats, appointments, isLoading]);\r\n\r\n    // Handler para guardar meta\r\n    const handleSaveGoal = async () => {\r\n        if (!editingGoal || !targetValue || !doctorId) return;\r\n\r\n        const newTarget = parseFloat(targetValue);\r\n        if (isNaN(newTarget) || newTarget < 0) return;\r\n\r\n        try {\r\n            const now = new Date();\r\n            const year = now.getFullYear();\r\n            const month = now.getMonth() + 1;\r\n\r\n            // Mapear tipo de meta a columna de base de datos\r\n            const columnMap: Record<string, string> = {\r\n                appointments: 'target_appointments',\r\n                patients: 'target_new_patients',\r\n                revenue: 'target_revenue',\r\n                rating: 'target_rating'\r\n            };\r\n\r\n            const columnName = columnMap[editingGoal.type];\r\n\r\n            // 1. Obtener registro actual si existe\r\n            const { data: existing } = await supabase\r\n                .from('doctor_goals')\r\n                .select('*')\r\n                .eq('doctor_id', doctorId)\r\n                .eq('year', year)\r\n                .eq('month', month)\r\n                .single();\r\n\r\n            const upsertData = {\r\n                doctor_id: doctorId,\r\n                year,\r\n                month,\r\n                [columnName]: newTarget,\r\n                // Mantener otros valores si existen\r\n                ...(existing ? {} : {\r\n                    target_appointments: 0,\r\n                    target_new_patients: 0,\r\n                    target_revenue: 0,\r\n                    target_rating: 0\r\n                })\r\n            };\r\n\r\n            // 2. Guardar en Supabase\r\n            const { error } = await supabase\r\n                .from('doctor_goals')\r\n                .upsert(upsertData, { onConflict: 'doctor_id,year,month' });\r\n\r\n            if (error) throw error;\r\n\r\n            // 3. Actualizar estado local\r\n            setGoals(prev => prev.map(g => {\r\n                if (g.id === editingGoal.id) {\r\n                    const newPercentage = newTarget > 0\r\n                        ? Math.min(100, Math.round((g.current / newTarget) * 100))\r\n                        : 0;\r\n                    return { ...g, target: newTarget, percentage: newPercentage };\r\n                }\r\n                return g;\r\n            }));\r\n\r\n            setIsDialogOpen(false);\r\n            setEditingGoal(null);\r\n            setTargetValue(\"\");\r\n\r\n        } catch (error) {\r\n            console.error('[MonthlyGoals] Error saving goal:', error);\r\n            // Aquí podrías mostrar un toast de error\r\n        }\r\n    };\r\n\r\n    // Calcular progreso general\r\n    const overallProgress = useMemo(() => {\r\n        if (goals.length === 0) return 0;\r\n        return Math.round(goals.reduce((acc, g) => acc + g.percentage, 0) / goals.length);\r\n    }, [goals]);\r\n\r\n    // Metas completadas\r\n    const completedGoals = goals.filter(g => g.percentage >= 100).length;\r\n\r\n    // Obtener nombre del mes actual\r\n    const currentMonth = new Date().toLocaleDateString(\"es-ES\", { month: \"long\" });\r\n\r\n    return (\r\n        <WidgetWrapper\r\n            id=\"monthly-goals\"\r\n            title={`Metas de ${currentMonth.charAt(0).toUpperCase() + currentMonth.slice(1)}`}\r\n            icon={<Target className=\"h-4 w-4 text-primary\" />}\r\n            isDragging={isDragging}\r\n            showControls={false}\r\n        >\r\n            <div className=\"space-y-3\">\r\n                {isLoading ? (\r\n                    <div className=\"flex items-center justify-center py-8\">\r\n                        <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\r\n                    </div>\r\n                ) : (\r\n                    <>\r\n                        {/* Header con progreso general */}\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <Badge\r\n                                    variant=\"secondary\"\r\n                                    className={cn(\r\n                                        \"text-[10px] gap-1\",\r\n                                        overallProgress >= 100 && \"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400\"\r\n                                    )}\r\n                                >\r\n                                    <TrendingUp className=\"h-2.5 w-2.5\" />\r\n                                    {overallProgress}% completado\r\n                                </Badge>\r\n                            </div>\r\n                            {completedGoals > 0 && (\r\n                                <Badge\r\n                                    className=\"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400 text-[10px] gap-1\"\r\n                                >\r\n                                    <CheckCircle className=\"h-2.5 w-2.5\" />\r\n                                    {completedGoals}/{goals.length}\r\n                                </Badge>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Lista de metas */}\r\n                        <div className=\"space-y-2\">\r\n                            {goals.map((goal, index) => {\r\n                                const isComplete = goal.percentage >= 100;\r\n\r\n                                return (\r\n                                    <motion.div\r\n                                        key={goal.id}\r\n                                        initial={{ opacity: 0, y: -5 }}\r\n                                        animate={{ opacity: 1, y: 0 }}\r\n                                        transition={{ delay: index * 0.05 }}\r\n                                        className={cn(\r\n                                            \"p-2 rounded-lg\",\r\n                                            \"bg-muted/30 hover:bg-muted/50 transition-colors\",\r\n                                            isComplete && \"bg-emerald-500/5 ring-1 ring-emerald-500/20\"\r\n                                        )}\r\n                                    >\r\n                                        {/* Encabezado de la meta */}\r\n                                        <div className=\"flex items-center justify-between mb-1.5\">\r\n                                            <div className=\"flex items-center gap-1.5\">\r\n                                                <div className={cn(\r\n                                                    \"p-1 rounded\",\r\n                                                    isComplete ? \"bg-emerald-500/20 text-emerald-600\" : \"bg-muted text-muted-foreground\"\r\n                                                )}>\r\n                                                    {goal.icon}\r\n                                                </div>\r\n                                                <span className=\"text-xs font-medium\">{goal.label}</span>\r\n                                            </div>\r\n                                            <Dialog open={isDialogOpen && editingGoal?.id === goal.id} onOpenChange={(open) => {\r\n                                                setIsDialogOpen(open);\r\n                                                if (!open) setEditingGoal(null);\r\n                                            }}>\r\n                                                <DialogTrigger asChild>\r\n                                                    <Button\r\n                                                        variant=\"ghost\"\r\n                                                        size=\"icon\"\r\n                                                        className=\"h-5 w-5 opacity-0 group-hover:opacity-100 hover:opacity-100\"\r\n                                                        onClick={() => {\r\n                                                            setEditingGoal(goal);\r\n                                                            setTargetValue(goal.target.toString());\r\n                                                        }}\r\n                                                    >\r\n                                                        <Edit className=\"h-2.5 w-2.5\" />\r\n                                                    </Button>\r\n                                                </DialogTrigger>\r\n                                                <DialogContent className=\"sm:max-w-[425px]\">\r\n                                                    <DialogHeader>\r\n                                                        <DialogTitle>Editar meta: {goal.label}</DialogTitle>\r\n                                                    </DialogHeader>\r\n                                                    <div className=\"grid gap-4 py-4\">\r\n                                                        <div className=\"grid gap-2\">\r\n                                                            <Label htmlFor=\"target\">Valor objetivo</Label>\r\n                                                            <Input\r\n                                                                id=\"target\"\r\n                                                                type=\"number\"\r\n                                                                value={targetValue}\r\n                                                                onChange={(e) => setTargetValue(e.target.value)}\r\n                                                                placeholder={goal.target.toString()}\r\n                                                            />\r\n                                                        </div>\r\n                                                        <Button onClick={handleSaveGoal}>\r\n                                                            Guardar\r\n                                                        </Button>\r\n                                                    </div>\r\n                                                </DialogContent>\r\n                                            </Dialog>\r\n                                        </div>\r\n\r\n                                        {/* Barra de progreso */}\r\n                                        <div className=\"space-y-1\">\r\n                                            <Progress\r\n                                                value={goal.percentage}\r\n                                                className={cn(\r\n                                                    \"h-1.5\",\r\n                                                    isComplete && \"[&>div]:bg-emerald-500\"\r\n                                                )}\r\n                                            />\r\n                                            <div className=\"flex items-center justify-between text-[10px] text-muted-foreground\">\r\n                                                <span>\r\n                                                    {goal.type === \"revenue\"\r\n                                                        ? `$${goal.current.toLocaleString()}`\r\n                                                        : goal.type === \"rating\"\r\n                                                            ? goal.current.toFixed(1)\r\n                                                            : goal.current\r\n                                                    }\r\n                                                </span>\r\n                                                <span className={cn(\r\n                                                    \"font-medium\",\r\n                                                    isComplete && \"text-emerald-600 dark:text-emerald-400\"\r\n                                                )}>\r\n                                                    {goal.percentage}%\r\n                                                </span>\r\n                                                <span>\r\n                                                    {goal.type === \"revenue\"\r\n                                                        ? `$${goal.target.toLocaleString()}`\r\n                                                        : goal.type === \"rating\"\r\n                                                            ? goal.target.toFixed(1)\r\n                                                            : goal.target\r\n                                                    }\r\n                                                </span>\r\n                                            </div>\r\n                                        </div>\r\n                                    </motion.div>\r\n                                );\r\n                            })}\r\n                        </div>\r\n\r\n                        {/* Mensaje motivacional */}\r\n                        {overallProgress >= 100 ? (\r\n                            <div className=\"text-center p-2 bg-emerald-500/10 rounded-lg\">\r\n                                <p className=\"text-xs font-medium text-emerald-600 dark:text-emerald-400\">\r\n                                    🎉 ¡Felicidades! Has completado todas tus metas\r\n                                </p>\r\n                            </div>\r\n                        ) : overallProgress >= 75 ? (\r\n                            <div className=\"text-center p-2 bg-blue-500/10 rounded-lg\">\r\n                                <p className=\"text-xs text-blue-600 dark:text-blue-400\">\r\n                                    ¡Casi lo logras! Sigue así 💪\r\n                                </p>\r\n                            </div>\r\n                        ) : null}\r\n                    </>\r\n                )}\r\n            </div>\r\n        </WidgetWrapper>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\dashboard\\widgets\\notifications-widget.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useMemo' is defined but never used.","line":11,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AlertTriangle' is defined but never used.","line":17,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DoctorNotification' is defined but never used.","line":33,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":33}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file notifications-widget.tsx\r\n * @description Widget de notificaciones con datos reales de Supabase.\r\n * Muestra notificaciones en tiempo real con soporte para diferentes tipos.\r\n * \r\n * @module Dashboard/Widgets\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useMemo, useCallback } from \"react\";\r\nimport { motion } from \"framer-motion\";\r\nimport {\r\n    Bell,\r\n    Calendar,\r\n    MessageSquare,\r\n    AlertTriangle,\r\n    Clock,\r\n    X,\r\n    UserPlus,\r\n    Star,\r\n    Settings,\r\n    ShieldCheck,\r\n    Loader2,\r\n    CheckCheck\r\n} from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { WidgetWrapper } from \"../widget-wrapper\";\r\nimport { useDashboardData } from \"@/hooks/use-dashboard-data\";\r\nimport { markNotificationAsRead, markAllNotificationsAsRead } from \"@/lib/supabase/services/dashboard-preferences-service\";\r\nimport type { DoctorNotification, NotificationType } from \"@/lib/types/dashboard-types\";\r\n\r\n// ============================================================================\r\n// MAPAS DE CONFIGURACIÓN\r\n// ============================================================================\r\n\r\n/** Mapeo de tipos de notificación a iconos */\r\nconst iconMap: Record<NotificationType, typeof Bell> = {\r\n    appointment_new: Calendar,\r\n    appointment_cancelled: X,\r\n    appointment_reminder: Clock,\r\n    message_new: MessageSquare,\r\n    patient_new: UserPlus,\r\n    review_new: Star,\r\n    system_update: Settings,\r\n    verification_status: ShieldCheck,\r\n};\r\n\r\n/** Mapeo de tipos de notificación a colores */\r\nconst colorMap: Record<NotificationType, string> = {\r\n    appointment_new: \"bg-blue-500/10 text-blue-500\",\r\n    appointment_cancelled: \"bg-red-500/10 text-red-500\",\r\n    appointment_reminder: \"bg-yellow-500/10 text-yellow-500\",\r\n    message_new: \"bg-purple-500/10 text-purple-500\",\r\n    patient_new: \"bg-green-500/10 text-green-500\",\r\n    review_new: \"bg-amber-500/10 text-amber-500\",\r\n    system_update: \"bg-gray-500/10 text-gray-500\",\r\n    verification_status: \"bg-teal-500/10 text-teal-500\",\r\n};\r\n\r\n/** Tipos que se consideran urgentes */\r\nconst urgentTypes: NotificationType[] = [\"appointment_cancelled\"];\r\n\r\n// ============================================================================\r\n// HELPERS\r\n// ============================================================================\r\n\r\n/**\r\n * Formatea la fecha relativa de una notificación.\r\n */\r\nfunction formatRelativeTime(dateString: string): string {\r\n    const date = new Date(dateString);\r\n    const now = new Date();\r\n    const diffMs = now.getTime() - date.getTime();\r\n    const diffMins = Math.floor(diffMs / 60000);\r\n    const diffHours = Math.floor(diffMs / 3600000);\r\n    const diffDays = Math.floor(diffMs / 86400000);\r\n\r\n    if (diffMins < 1) return \"Ahora\";\r\n    if (diffMins < 60) return `Hace ${diffMins} min`;\r\n    if (diffHours < 24) return `Hace ${diffHours}h`;\r\n    if (diffDays === 1) return \"Ayer\";\r\n    if (diffDays < 7) return `Hace ${diffDays} días`;\r\n    return date.toLocaleDateString(\"es-VE\", { day: \"numeric\", month: \"short\" });\r\n}\r\n\r\n// ============================================================================\r\n// TIPOS\r\n// ============================================================================\r\n\r\ninterface NotificationsWidgetProps {\r\n    /** ID del médico */\r\n    doctorId?: string;\r\n    /** Si está siendo arrastrado */\r\n    isDragging?: boolean;\r\n}\r\n\r\n// ============================================================================\r\n// COMPONENTE PRINCIPAL\r\n// ============================================================================\r\n\r\n/**\r\n * Widget de notificaciones.\r\n * Muestra las notificaciones recientes del médico con soporte para\r\n * diferentes tipos y estados de lectura.\r\n * \r\n * @example\r\n * <NotificationsWidget doctorId=\"uuid-del-doctor\" />\r\n */\r\nexport function NotificationsWidget({\r\n    doctorId,\r\n    isDragging\r\n}: NotificationsWidgetProps) {\r\n    // Obtener datos reales del dashboard\r\n    const { notifications, stats, isLoading, refreshNotifications } = useDashboardData(doctorId);\r\n\r\n    // Conteo de notificaciones no leídas\r\n    const unreadCount = stats.unreadNotifications;\r\n\r\n    // Handler para marcar una notificación como leída\r\n    const handleMarkAsRead = useCallback(async (notificationId: string) => {\r\n        await markNotificationAsRead(notificationId);\r\n        refreshNotifications();\r\n    }, [refreshNotifications]);\r\n\r\n    // Handler para marcar todas como leídas\r\n    const handleMarkAllAsRead = useCallback(async () => {\r\n        if (!doctorId) return;\r\n        await markAllNotificationsAsRead(doctorId);\r\n        refreshNotifications();\r\n    }, [doctorId, refreshNotifications]);\r\n\r\n    return (\r\n        <WidgetWrapper\r\n            id=\"notifications\"\r\n            title=\"Notificaciones\"\r\n            icon={\r\n                <div className=\"relative\">\r\n                    <Bell className=\"h-4 w-4 text-primary\" />\r\n                    {unreadCount > 0 && (\r\n                        <span className=\"absolute -top-1 -right-1 w-2 h-2 rounded-full bg-red-500 animate-pulse\" />\r\n                    )}\r\n                </div>\r\n            }\r\n            isDragging={isDragging}\r\n            showControls={false}\r\n        >\r\n            <div className=\"space-y-3\">\r\n                {/* Estado de carga */}\r\n                {isLoading ? (\r\n                    <div className=\"flex items-center justify-center py-8\">\r\n                        <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\r\n                    </div>\r\n                ) : (\r\n                    <>\r\n                        {/* Header */}\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <Badge variant=\"secondary\" className=\"text-[10px]\">\r\n                                {unreadCount} sin leer\r\n                            </Badge>\r\n                            {unreadCount > 0 && (\r\n                                <Button\r\n                                    variant=\"ghost\"\r\n                                    size=\"sm\"\r\n                                    className=\"text-xs h-6 gap-1\"\r\n                                    onClick={handleMarkAllAsRead}\r\n                                >\r\n                                    <CheckCheck className=\"h-3 w-3\" />\r\n                                    Marcar leídas\r\n                                </Button>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Notifications List */}\r\n                        <div className=\"space-y-2 max-h-[200px] overflow-y-auto pr-1 scrollbar-thin\">\r\n                            {notifications.length > 0 ? (\r\n                                notifications.map((notification, index) => {\r\n                                    const Icon = iconMap[notification.type] || Bell;\r\n                                    const isUrgent = urgentTypes.includes(notification.type);\r\n\r\n                                    return (\r\n                                        <motion.div\r\n                                            key={notification.id}\r\n                                            initial={{ opacity: 0, x: -10 }}\r\n                                            animate={{ opacity: 1, x: 0 }}\r\n                                            transition={{ delay: index * 0.05 }}\r\n                                            className={cn(\r\n                                                \"flex items-start gap-2 p-2 rounded-lg\",\r\n                                                \"hover:bg-muted/50 transition-colors cursor-pointer\",\r\n                                                !notification.is_read && \"bg-primary/5\",\r\n                                                isUrgent && !notification.is_read && \"ring-1 ring-red-500/30\"\r\n                                            )}\r\n                                            onClick={() => !notification.is_read && handleMarkAsRead(notification.id)}\r\n                                        >\r\n                                            {/* Icon */}\r\n                                            <div className={cn(\r\n                                                \"flex items-center justify-center w-7 h-7 rounded-lg flex-shrink-0\",\r\n                                                colorMap[notification.type] || \"bg-gray-500/10 text-gray-500\"\r\n                                            )}>\r\n                                                <Icon className=\"h-3.5 w-3.5\" />\r\n                                            </div>\r\n\r\n                                            {/* Content */}\r\n                                            <div className=\"flex-1 min-w-0\">\r\n                                                <div className=\"flex items-center gap-1\">\r\n                                                    <p className={cn(\r\n                                                        \"text-xs font-medium truncate\",\r\n                                                        !notification.is_read && \"text-foreground\",\r\n                                                        notification.is_read && \"text-muted-foreground\"\r\n                                                    )}>\r\n                                                        {notification.title}\r\n                                                    </p>\r\n                                                    {isUrgent && !notification.is_read && (\r\n                                                        <Badge variant=\"destructive\" className=\"text-[8px] px-1 py-0\">\r\n                                                            Urgente\r\n                                                        </Badge>\r\n                                                    )}\r\n                                                </div>\r\n                                                <p className=\"text-[10px] text-muted-foreground truncate\">\r\n                                                    {notification.message}\r\n                                                </p>\r\n                                                <p className=\"text-[9px] text-muted-foreground mt-0.5\">\r\n                                                    {formatRelativeTime(notification.created_at)}\r\n                                                </p>\r\n                                            </div>\r\n\r\n                                            {/* Unread indicator */}\r\n                                            {!notification.is_read && (\r\n                                                <div className=\"w-2 h-2 rounded-full bg-primary flex-shrink-0 mt-1\" />\r\n                                            )}\r\n                                        </motion.div>\r\n                                    );\r\n                                })\r\n                            ) : (\r\n                                <motion.div\r\n                                    initial={{ opacity: 0 }}\r\n                                    animate={{ opacity: 1 }}\r\n                                    className=\"text-center py-6 text-muted-foreground\"\r\n                                >\r\n                                    <Bell className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\r\n                                    <p className=\"text-sm\">No hay notificaciones</p>\r\n                                </motion.div>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* View All */}\r\n                        {notifications.length > 0 && (\r\n                            <Button variant=\"outline\" className=\"w-full text-xs h-7\" asChild>\r\n                                <a href=\"/dashboard/medico/notificaciones\">\r\n                                    Ver todas las notificaciones\r\n                                </a>\r\n                            </Button>\r\n                        )}\r\n                    </>\r\n                )}\r\n            </div>\r\n        </WidgetWrapper>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\dashboard\\widgets\\patient-birthdays-widget.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":390,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":390,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17623,17626],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17623,17626],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":392,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":392,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17730,17733],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17730,17733],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file patient-birthdays-widget.tsx\r\n * @description Widget de cumpleaños de pacientes.\r\n * Muestra pacientes con cumpleaños próximos para enviar felicitaciones.\r\n * \r\n * @module Dashboard/Widgets\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useState, useEffect, useMemo } from \"react\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport {\r\n    Cake,\r\n    Gift,\r\n    ChevronRight,\r\n    Loader2,\r\n    Send,\r\n    CheckCircle,\r\n    PartyPopper,\r\n    Calendar\r\n} from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@red-salud/ui\";\r\nimport {\r\n    Tooltip,\r\n    TooltipContent,\r\n    TooltipProvider,\r\n    TooltipTrigger\r\n} from \"@red-salud/ui\";\r\nimport { WidgetWrapper } from \"../widget-wrapper\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\n\r\n// ============================================================================\r\n// TIPOS\r\n// ============================================================================\r\n\r\ninterface PatientBirthdaysWidgetProps {\r\n    /** ID del médico */\r\n    doctorId?: string;\r\n    /** Si está siendo arrastrado */\r\n    isDragging?: boolean;\r\n}\r\n\r\ninterface BirthdayPatient {\r\n    /** ID del paciente */\r\n    id: string;\r\n    /** Nombre completo */\r\n    name: string;\r\n    /** Avatar */\r\n    avatar?: string;\r\n    /** Fecha de cumpleaños */\r\n    birthDate: Date;\r\n    /** Edad que cumple */\r\n    turningAge: number;\r\n    /** Días hasta el cumpleaños (0 = hoy) */\r\n    daysUntil: number;\r\n    /** Si ya se envió felicitación */\r\n    greetingSent?: boolean;\r\n}\r\n\r\n// ============================================================================\r\n// HELPERS\r\n// ============================================================================\r\n\r\n/**\r\n * Obtiene las iniciales de un nombre.\r\n */\r\nfunction getInitials(name: string): string {\r\n    return name\r\n        .split(\" \")\r\n        .map(n => n[0])\r\n        .join(\"\")\r\n        .slice(0, 2)\r\n        .toUpperCase();\r\n}\r\n\r\n/**\r\n * Calcula días hasta el próximo cumpleaños.\r\n */\r\nfunction getDaysUntilBirthday(birthDate: Date): number {\r\n    const today = new Date();\r\n    const thisYear = today.getFullYear();\r\n\r\n    // Crear fecha de cumpleaños este año\r\n    let nextBirthday = new Date(thisYear, birthDate.getMonth(), birthDate.getDate());\r\n\r\n    // Si ya pasó, usar el del próximo año\r\n    if (nextBirthday < today) {\r\n        nextBirthday = new Date(thisYear + 1, birthDate.getMonth(), birthDate.getDate());\r\n    }\r\n\r\n    // Si es hoy\r\n    if (\r\n        today.getDate() === birthDate.getDate() &&\r\n        today.getMonth() === birthDate.getMonth()\r\n    ) {\r\n        return 0;\r\n    }\r\n\r\n    const diffTime = nextBirthday.getTime() - today.getTime();\r\n    return Math.ceil(diffTime / (1000 * 60 * 60 * 24));\r\n}\r\n\r\n/**\r\n * Calcula la edad que cumplirá.\r\n */\r\nfunction calculateTurningAge(birthDate: Date, daysUntil: number): number {\r\n    const today = new Date();\r\n    const birthYear = birthDate.getFullYear();\r\n\r\n    // Si el cumpleaños es hoy o ya pasó este año\r\n    if (daysUntil === 0) {\r\n        return today.getFullYear() - birthYear;\r\n    }\r\n\r\n    // Si el cumpleaños es este año pero aún no llega\r\n    const thisYearBirthday = new Date(today.getFullYear(), birthDate.getMonth(), birthDate.getDate());\r\n    if (thisYearBirthday > today) {\r\n        return today.getFullYear() - birthYear;\r\n    }\r\n\r\n    // El cumpleaños será el próximo año\r\n    return today.getFullYear() + 1 - birthYear;\r\n}\r\n\r\n/**\r\n * Formatea los días hasta el cumpleaños.\r\n */\r\nfunction formatDaysUntil(days: number): string {\r\n    if (days === 0) return \"¡Hoy!\";\r\n    if (days === 1) return \"Mañana\";\r\n    if (days <= 7) return `En ${days} días`;\r\n    return `En ${Math.ceil(days / 7)} semanas`;\r\n}\r\n\r\n// ============================================================================\r\n// COMPONENTE PRINCIPAL\r\n// ============================================================================\r\n\r\n/**\r\n * Widget de cumpleaños de pacientes.\r\n * Muestra los pacientes con cumpleaños próximos (7 días).\r\n * \r\n * @example\r\n * <PatientBirthdaysWidget doctorId=\"uuid-del-doctor\" />\r\n */\r\nexport function PatientBirthdaysWidget({\r\n    doctorId,\r\n    isDragging\r\n}: PatientBirthdaysWidgetProps) {\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [allPatients, setAllPatients] = useState<BirthdayPatient[]>([]);\r\n    const [sentGreetings, setSentGreetings] = useState<Set<string>>(new Set());\r\n\r\n    // Cargar pacientes con cumpleaños\r\n    useEffect(() => {\r\n        const loadBirthdays = async () => {\r\n            if (!doctorId) {\r\n                setIsLoading(false);\r\n                return;\r\n            }\r\n\r\n            try {\r\n                // Obtener pacientes del médico con fecha de nacimiento\r\n                const { data: patients, error } = await supabase\r\n                    .from(\"appointments\")\r\n                    .select(`\r\n                        patient:profiles!appointments_paciente_id_fkey (\r\n                            id,\r\n                            nombre_completo,\r\n                            avatar_url,\r\n                            fecha_nacimiento\r\n                        )\r\n                    `)\r\n                    .eq(\"medico_id\", doctorId)\r\n                    .not(\"patient.fecha_nacimiento\", \"is\", null);\r\n\r\n                if (error) {\r\n                    console.log(\"[PatientBirthdays] Error o sin datos:\", error.message);\r\n                    setAllPatients([]);\r\n                } else if (patients && patients.length > 0) {\r\n                    // Procesar pacientes únicos\r\n                    const processed = processPatients(patients);\r\n                    setAllPatients(processed);\r\n                } else {\r\n                    setAllPatients([]);\r\n                }\r\n            } catch (err) {\r\n                console.error(\"[PatientBirthdays] Error:\", err);\r\n                setAllPatients([]);\r\n            } finally {\r\n                setIsLoading(false);\r\n            }\r\n        };\r\n\r\n        loadBirthdays();\r\n    }, [doctorId]);\r\n\r\n    // Filtrar pacientes con cumpleaños próximo (7 días)\r\n    const upcomingBirthdays = useMemo(() => {\r\n        return allPatients\r\n            .filter(p => p.daysUntil <= 7)\r\n            .sort((a, b) => a.daysUntil - b.daysUntil)\r\n            .slice(0, 5);\r\n    }, [allPatients]);\r\n\r\n    // Handler para enviar felicitación\r\n    const handleSendGreeting = async (patientId: string) => {\r\n        setSentGreetings(prev => new Set([...prev, patientId]));\r\n        // TODO: Integrar con sistema de mensajería\r\n    };\r\n\r\n    // Verificar si hay cumpleaños hoy\r\n    const hasBirthdayToday = upcomingBirthdays.some(p => p.daysUntil === 0);\r\n\r\n    return (\r\n        <WidgetWrapper\r\n            id=\"patient-birthdays\"\r\n            title=\"Cumpleaños\"\r\n            icon={<Cake className=\"h-4 w-4 text-pink-500\" />}\r\n            isDragging={isDragging}\r\n            showControls={false}\r\n        >\r\n            <div className=\"space-y-3\">\r\n                {isLoading ? (\r\n                    <div className=\"flex items-center justify-center py-8\">\r\n                        <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\r\n                    </div>\r\n                ) : (\r\n                    <>\r\n                        {/* Header */}\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <Badge\r\n                                variant=\"secondary\"\r\n                                className={cn(\r\n                                    \"text-[10px] gap-1\",\r\n                                    hasBirthdayToday && \"bg-pink-100 text-pink-700 dark:bg-pink-900/30 dark:text-pink-400\"\r\n                                )}\r\n                            >\r\n                                <Gift className=\"h-2.5 w-2.5\" />\r\n                                {upcomingBirthdays.length} esta semana\r\n                            </Badge>\r\n                            {hasBirthdayToday && (\r\n                                <Badge\r\n                                    className=\"bg-gradient-to-r from-pink-500 to-purple-500 text-white text-[10px] gap-1 animate-pulse\"\r\n                                >\r\n                                    <PartyPopper className=\"h-2.5 w-2.5\" />\r\n                                    ¡Hoy!\r\n                                </Badge>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Lista de cumpleaños */}\r\n                        <div className=\"space-y-2\">\r\n                            <AnimatePresence mode=\"popLayout\">\r\n                                {upcomingBirthdays.length > 0 ? (\r\n                                    upcomingBirthdays.map((patient, index) => {\r\n                                        const isToday = patient.daysUntil === 0;\r\n                                        const greetingSent = sentGreetings.has(patient.id);\r\n\r\n                                        return (\r\n                                            <motion.div\r\n                                                key={patient.id}\r\n                                                initial={{ opacity: 0, scale: 0.95 }}\r\n                                                animate={{ opacity: 1, scale: 1 }}\r\n                                                transition={{ delay: index * 0.05 }}\r\n                                                className={cn(\r\n                                                    \"flex items-center gap-2 p-2 rounded-lg\",\r\n                                                    \"bg-muted/30 hover:bg-muted/50 transition-colors\",\r\n                                                    isToday && \"bg-gradient-to-r from-pink-500/10 to-purple-500/10 ring-1 ring-pink-500/30\"\r\n                                                )}\r\n                                            >\r\n                                                {/* Avatar con decoración */}\r\n                                                <div className=\"relative\">\r\n                                                    <Avatar className={cn(\r\n                                                        \"h-8 w-8\",\r\n                                                        isToday && \"ring-2 ring-pink-500 ring-offset-2 ring-offset-background\"\r\n                                                    )}>\r\n                                                        {patient.avatar ? (\r\n                                                            <AvatarImage src={patient.avatar} alt={patient.name} />\r\n                                                        ) : null}\r\n                                                        <AvatarFallback className=\"text-xs bg-gradient-to-br from-pink-500/20 to-purple-500/20\">\r\n                                                            {getInitials(patient.name)}\r\n                                                        </AvatarFallback>\r\n                                                    </Avatar>\r\n                                                    {isToday && (\r\n                                                        <div className=\"absolute -top-1 -right-1\">\r\n                                                            <span className=\"text-sm\">🎂</span>\r\n                                                        </div>\r\n                                                    )}\r\n                                                </div>\r\n\r\n                                                {/* Información */}\r\n                                                <div className=\"flex-1 min-w-0\">\r\n                                                    <p className=\"text-xs font-medium truncate\">\r\n                                                        {patient.name}\r\n                                                    </p>\r\n                                                    <div className=\"flex items-center gap-1 text-[10px] text-muted-foreground\">\r\n                                                        <span className={cn(\r\n                                                            isToday && \"text-pink-600 dark:text-pink-400 font-medium\"\r\n                                                        )}>\r\n                                                            {formatDaysUntil(patient.daysUntil)}\r\n                                                        </span>\r\n                                                        <span className=\"text-border\">•</span>\r\n                                                        <span>Cumple {patient.turningAge}</span>\r\n                                                    </div>\r\n                                                </div>\r\n\r\n                                                {/* Acción */}\r\n                                                <TooltipProvider>\r\n                                                    <Tooltip>\r\n                                                        <TooltipTrigger asChild>\r\n                                                            <Button\r\n                                                                variant={greetingSent ? \"ghost\" : isToday ? \"default\" : \"outline\"}\r\n                                                                size=\"sm\"\r\n                                                                className={cn(\r\n                                                                    \"h-6 text-[10px] px-2\",\r\n                                                                    greetingSent && \"text-emerald-600\",\r\n                                                                    isToday && !greetingSent && \"bg-gradient-to-r from-pink-500 to-purple-500 hover:from-pink-600 hover:to-purple-600\"\r\n                                                                )}\r\n                                                                onClick={() => handleSendGreeting(patient.id)}\r\n                                                                disabled={greetingSent}\r\n                                                            >\r\n                                                                {greetingSent ? (\r\n                                                                    <>\r\n                                                                        <CheckCircle className=\"h-2.5 w-2.5 mr-1\" />\r\n                                                                        Enviado\r\n                                                                    </>\r\n                                                                ) : (\r\n                                                                    <>\r\n                                                                        <Send className=\"h-2.5 w-2.5 mr-1\" />\r\n                                                                        Felicitar\r\n                                                                    </>\r\n                                                                )}\r\n                                                            </Button>\r\n                                                        </TooltipTrigger>\r\n                                                        <TooltipContent>\r\n                                                            {greetingSent\r\n                                                                ? \"Felicitación enviada\"\r\n                                                                : \"Enviar mensaje de cumpleaños\"\r\n                                                            }\r\n                                                        </TooltipContent>\r\n                                                    </Tooltip>\r\n                                                </TooltipProvider>\r\n                                            </motion.div>\r\n                                        );\r\n                                    })\r\n                                ) : (\r\n                                    <motion.div\r\n                                        initial={{ opacity: 0 }}\r\n                                        animate={{ opacity: 1 }}\r\n                                        className=\"text-center py-6 text-muted-foreground\"\r\n                                    >\r\n                                        <Calendar className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\r\n                                        <p className=\"text-xs\">Sin cumpleaños próximos</p>\r\n                                        <p className=\"text-[10px] mt-1\">Los cumpleaños de los próximos 7 días aparecerán aquí</p>\r\n                                    </motion.div>\r\n                                )}\r\n                            </AnimatePresence>\r\n                        </div>\r\n\r\n                        {/* Ver calendario */}\r\n                        {upcomingBirthdays.length > 0 && (\r\n                            <Button\r\n                                variant=\"outline\"\r\n                                className=\"w-full text-xs h-7\"\r\n                            >\r\n                                <Cake className=\"h-3 w-3 mr-1\" />\r\n                                Ver todos los cumpleaños\r\n                                <ChevronRight className=\"h-3 w-3 ml-1\" />\r\n                            </Button>\r\n                        )}\r\n                    </>\r\n                )}\r\n            </div>\r\n        </WidgetWrapper>\r\n    );\r\n}\r\n\r\n// ============================================================================\r\n// HELPERS DE DATOS\r\n// ============================================================================\r\n\r\n/**\r\n * Procesa pacientes de Supabase.\r\n */\r\nfunction processPatients(patients: any[]): BirthdayPatient[] {\r\n    // Eliminar duplicados por ID\r\n    const uniquePatients = new Map<string, any>();\r\n    patients.forEach(p => {\r\n        if (p.patient?.id && p.patient.fecha_nacimiento) {\r\n            uniquePatients.set(p.patient.id, {\r\n                ...p.patient\r\n            });\r\n        }\r\n    });\r\n\r\n    return Array.from(uniquePatients.values()).map(patient => {\r\n        const birthDate = new Date(patient.fecha_nacimiento);\r\n        const daysUntil = getDaysUntilBirthday(birthDate);\r\n        const turningAge = calculateTurningAge(birthDate, daysUntil);\r\n\r\n        return {\r\n            id: patient.id,\r\n            name: patient.nombre_completo || \"Paciente\",\r\n            avatar: patient.avatar_url,\r\n            birthDate,\r\n            turningAge,\r\n            daysUntil\r\n        };\r\n    });\r\n}\r\n\r\n/**\r\n * Genera datos de demostración.\r\n */\r\n// generateDemoBirthdays eliminado para evitar datos falsos\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\dashboard\\widgets\\patient-insights-widget.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'stats' is assigned a value but never used.","line":125,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":125,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file patient-insights-widget.tsx\r\n * @description Widget de resumen e insights de pacientes.\r\n * Muestra métricas clave sobre la cartera de pacientes del médico.\r\n * \r\n * @module Dashboard/Widgets\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useMemo } from \"react\";\r\nimport { motion } from \"framer-motion\";\r\nimport {\r\n    Users,\r\n    UserPlus,\r\n    UserCheck,\r\n    Clock,\r\n    TrendingUp,\r\n    TrendingDown,\r\n    Loader2\r\n} from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { WidgetWrapper } from \"../widget-wrapper\";\r\nimport { useDashboardData } from \"@/hooks/use-dashboard-data\";\r\n\r\n// ============================================================================\r\n// TIPOS\r\n// ============================================================================\r\n\r\ninterface PatientInsightsWidgetProps {\r\n    /** ID del médico */\r\n    doctorId?: string;\r\n    /** Si está siendo arrastrado */\r\n    isDragging?: boolean;\r\n}\r\n\r\ninterface MetricCardProps {\r\n    /** Título de la métrica */\r\n    title: string;\r\n    /** Valor principal */\r\n    value: number;\r\n    /** Icono del componente */\r\n    icon: React.ReactNode;\r\n    /** Cambio vs período anterior (opcional) */\r\n    change?: number;\r\n    /** Color del icono */\r\n    color: string;\r\n    /** Delay de animación */\r\n    delay?: number;\r\n}\r\n\r\n// ============================================================================\r\n// COMPONENTES AUXILIARES\r\n// ============================================================================\r\n\r\n/**\r\n * Tarjeta de métrica individual.\r\n */\r\nfunction MetricCard({\r\n    title,\r\n    value,\r\n    icon,\r\n    change,\r\n    color,\r\n    delay = 0\r\n}: MetricCardProps) {\r\n    return (\r\n        <motion.div\r\n            initial={{ opacity: 0, y: 10 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            transition={{ delay: delay * 0.1 }}\r\n            className=\"flex items-center gap-3 p-3 rounded-lg bg-muted/30 border border-border/30\"\r\n        >\r\n            <div className={cn(\r\n                \"flex items-center justify-center w-9 h-9 rounded-lg\",\r\n                color\r\n            )}>\r\n                {icon}\r\n            </div>\r\n            <div className=\"flex-1 min-w-0\">\r\n                <p className=\"text-[10px] text-muted-foreground truncate\">{title}</p>\r\n                <div className=\"flex items-baseline gap-1.5\">\r\n                    <span className=\"text-lg font-bold\">{value}</span>\r\n                    {change !== undefined && change !== 0 && (\r\n                        <Badge\r\n                            variant=\"outline\"\r\n                            className={cn(\r\n                                \"text-[9px] px-1 py-0 h-4\",\r\n                                change > 0\r\n                                    ? \"text-green-600 bg-green-50 border-green-200\"\r\n                                    : \"text-red-600 bg-red-50 border-red-200\"\r\n                            )}\r\n                        >\r\n                            {change > 0 ? (\r\n                                <TrendingUp className=\"w-2 h-2 mr-0.5\" />\r\n                            ) : (\r\n                                <TrendingDown className=\"w-2 h-2 mr-0.5\" />\r\n                            )}\r\n                            {change > 0 ? \"+\" : \"\"}{change}\r\n                        </Badge>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </motion.div>\r\n    );\r\n}\r\n\r\n// ============================================================================\r\n// COMPONENTE PRINCIPAL\r\n// ============================================================================\r\n\r\n/**\r\n * Widget de resumen e insights de pacientes.\r\n * Muestra métricas clave sobre la cartera de pacientes.\r\n * \r\n * @example\r\n * <PatientInsightsWidget doctorId=\"uuid-del-doctor\" />\r\n */\r\nexport function PatientInsightsWidget({\r\n    doctorId,\r\n    isDragging\r\n}: PatientInsightsWidgetProps) {\r\n    // Obtener datos del dashboard\r\n    const { appointments, stats, isLoading } = useDashboardData(doctorId);\r\n\r\n    // Calcular métricas de pacientes\r\n    const patientMetrics = useMemo(() => {\r\n        const now = new Date();\r\n        const thisMonth = new Date(now.getFullYear(), now.getMonth(), 1);\r\n        const lastMonth = new Date(now.getFullYear(), now.getMonth() - 1, 1);\r\n        const lastMonthEnd = new Date(now.getFullYear(), now.getMonth(), 0);\r\n        const thirtyDaysAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);\r\n\r\n        // Obtener IDs únicos de pacientes\r\n        const allPatientIds = new Set(appointments.map(apt => apt.patient_id));\r\n\r\n        // Pacientes con citas este mes\r\n        const thisMonthPatientIds = new Set(\r\n            appointments\r\n                .filter(apt => new Date(apt.appointment_date) >= thisMonth)\r\n                .map(apt => apt.patient_id)\r\n        );\r\n\r\n        // Pacientes con citas el mes pasado\r\n        const lastMonthPatientIds = new Set(\r\n            appointments\r\n                .filter(apt => {\r\n                    const date = new Date(apt.appointment_date);\r\n                    return date >= lastMonth && date <= lastMonthEnd;\r\n                })\r\n                .map(apt => apt.patient_id)\r\n        );\r\n\r\n        // Pacientes nuevos este mes (no tenían citas antes)\r\n        const newPatientsThisMonth = [...thisMonthPatientIds].filter(id => {\r\n            const firstAppointment = appointments\r\n                .filter(apt => apt.patient_id === id)\r\n                .sort((a, b) => new Date(a.appointment_date).getTime() - new Date(b.appointment_date).getTime())[0];\r\n            return firstAppointment && new Date(firstAppointment.appointment_date) >= thisMonth;\r\n        }).length;\r\n\r\n        // Pacientes nuevos el mes pasado\r\n        const newPatientsLastMonth = [...lastMonthPatientIds].filter(id => {\r\n            const firstAppointment = appointments\r\n                .filter(apt => apt.patient_id === id)\r\n                .sort((a, b) => new Date(a.appointment_date).getTime() - new Date(b.appointment_date).getTime())[0];\r\n            return firstAppointment &&\r\n                new Date(firstAppointment.appointment_date) >= lastMonth &&\r\n                new Date(firstAppointment.appointment_date) <= lastMonthEnd;\r\n        }).length;\r\n\r\n        // Pacientes recurrentes (más de 1 cita)\r\n        const patientAppointmentCounts = new Map<string, number>();\r\n        appointments.forEach(apt => {\r\n            const count = patientAppointmentCounts.get(apt.patient_id) || 0;\r\n            patientAppointmentCounts.set(apt.patient_id, count + 1);\r\n        });\r\n        const recurringPatients = [...patientAppointmentCounts.values()].filter(count => count > 1).length;\r\n\r\n        // Pacientes sin cita en 30+ días\r\n        const patientsWithRecentAppointments = new Set(\r\n            appointments\r\n                .filter(apt => new Date(apt.appointment_date) >= thirtyDaysAgo)\r\n                .map(apt => apt.patient_id)\r\n        );\r\n        const patientsNeedingFollowUp = allPatientIds.size - patientsWithRecentAppointments.size;\r\n\r\n        // Tasa de retención (pacientes recurrentes / total)\r\n        const retentionRate = allPatientIds.size > 0\r\n            ? Math.round((recurringPatients / allPatientIds.size) * 100)\r\n            : 0;\r\n\r\n        return {\r\n            totalPatients: allPatientIds.size,\r\n            newPatients: newPatientsThisMonth,\r\n            newPatientsChange: newPatientsThisMonth - newPatientsLastMonth,\r\n            activePatients: thisMonthPatientIds.size,\r\n            recurringPatients,\r\n            retentionRate,\r\n            needFollowUp: patientsNeedingFollowUp,\r\n        };\r\n    }, [appointments]);\r\n\r\n    return (\r\n        <WidgetWrapper\r\n            id=\"patient-insights\"\r\n            title=\"Resumen Pacientes\"\r\n            icon={<Users className=\"h-4 w-4 text-primary\" />}\r\n            isDragging={isDragging}\r\n            showControls={false}\r\n        >\r\n            <div className=\"space-y-3\">\r\n                {/* Estado de carga */}\r\n                {isLoading ? (\r\n                    <div className=\"flex items-center justify-center py-8\">\r\n                        <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\r\n                    </div>\r\n                ) : (\r\n                    <>\r\n                        {/* Grid de métricas */}\r\n                        <div className=\"grid grid-cols-2 gap-2\">\r\n                            <MetricCard\r\n                                title=\"Total Pacientes\"\r\n                                value={patientMetrics.totalPatients}\r\n                                icon={<Users className=\"h-4 w-4 text-white\" />}\r\n                                color=\"bg-blue-500\"\r\n                                delay={0}\r\n                            />\r\n                            <MetricCard\r\n                                title=\"Nuevos este mes\"\r\n                                value={patientMetrics.newPatients}\r\n                                icon={<UserPlus className=\"h-4 w-4 text-white\" />}\r\n                                change={patientMetrics.newPatientsChange}\r\n                                color=\"bg-green-500\"\r\n                                delay={1}\r\n                            />\r\n                            <MetricCard\r\n                                title=\"Activos (mes)\"\r\n                                value={patientMetrics.activePatients}\r\n                                icon={<UserCheck className=\"h-4 w-4 text-white\" />}\r\n                                color=\"bg-purple-500\"\r\n                                delay={2}\r\n                            />\r\n                            <MetricCard\r\n                                title=\"Necesitan seguimiento\"\r\n                                value={patientMetrics.needFollowUp}\r\n                                icon={<Clock className=\"h-4 w-4 text-white\" />}\r\n                                color=\"bg-amber-500\"\r\n                                delay={3}\r\n                            />\r\n                        </div>\r\n\r\n                        {/* Barra de retención */}\r\n                        <motion.div\r\n                            initial={{ opacity: 0 }}\r\n                            animate={{ opacity: 1 }}\r\n                            transition={{ delay: 0.4 }}\r\n                            className=\"p-3 rounded-lg bg-muted/30 border border-border/30\"\r\n                        >\r\n                            <div className=\"flex items-center justify-between mb-2\">\r\n                                <span className=\"text-xs text-muted-foreground\">Tasa de retención</span>\r\n                                <span className=\"text-sm font-bold\">{patientMetrics.retentionRate}%</span>\r\n                            </div>\r\n                            <div className=\"h-2 rounded-full bg-muted overflow-hidden\">\r\n                                <motion.div\r\n                                    initial={{ width: 0 }}\r\n                                    animate={{ width: `${patientMetrics.retentionRate}%` }}\r\n                                    transition={{ delay: 0.5, duration: 0.8 }}\r\n                                    className={cn(\r\n                                        \"h-full rounded-full\",\r\n                                        patientMetrics.retentionRate >= 70 && \"bg-green-500\",\r\n                                        patientMetrics.retentionRate >= 40 && patientMetrics.retentionRate < 70 && \"bg-yellow-500\",\r\n                                        patientMetrics.retentionRate < 40 && \"bg-red-500\"\r\n                                    )}\r\n                                />\r\n                            </div>\r\n                            <p className=\"text-[10px] text-muted-foreground mt-1\">\r\n                                {patientMetrics.recurringPatients} pacientes recurrentes\r\n                            </p>\r\n                        </motion.div>\r\n                    </>\r\n                )}\r\n            </div>\r\n        </WidgetWrapper>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\dashboard\\widgets\\pending-patients-widget.tsx","messages":[{"ruleId":"@next/next/no-html-link-for-pages","severity":2,"message":"Do not use an `<a>` element to navigate to `/dashboard/medico/pacientes/`. Use `<Link />` from `next/link` instead. See: https://nextjs.org/docs/messages/no-html-link-for-pages","line":201,"column":33,"nodeType":"JSXOpeningElement","endLine":201,"endColumn":71}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file pending-patients-widget.tsx\r\n * @description Widget de pacientes en sala de espera con datos reales de Supabase.\r\n * Muestra los pacientes que tienen citas pendientes del día.\r\n * \r\n * @module Dashboard/Widgets\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useMemo } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { motion } from \"framer-motion\";\r\nimport { Users, Clock, ChevronRight, UserCheck, Video, Loader2 } from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@red-salud/ui\";\r\nimport { WidgetWrapper } from \"../widget-wrapper\";\r\nimport { useDashboardData } from \"@/hooks/use-dashboard-data\";\r\n\r\n// ============================================================================\r\n// HELPERS\r\n// ============================================================================\r\n\r\n/**\r\n * Calcula el tiempo de espera de una cita.\r\n */\r\nfunction calculateWaitTime(appointmentTime: string): string {\r\n    const now = new Date();\r\n    const [hours, minutes] = appointmentTime.split(\":\").map(Number);\r\n    const aptTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hours, minutes);\r\n\r\n    const diffMs = now.getTime() - aptTime.getTime();\r\n    const diffMins = Math.max(0, Math.floor(diffMs / 60000));\r\n\r\n    if (diffMins === 0) return \"Ahora\";\r\n    if (diffMins < 60) return `${diffMins} min`;\r\n    const diffHours = Math.floor(diffMins / 60);\r\n    return `${diffHours}h ${diffMins % 60}min`;\r\n}\r\n\r\n/**\r\n * Obtiene las iniciales de un nombre.\r\n */\r\nfunction getInitials(name: string): string {\r\n    return name\r\n        .split(\" \")\r\n        .map(n => n[0])\r\n        .join(\"\")\r\n        .slice(0, 2)\r\n        .toUpperCase();\r\n}\r\n\r\n// ============================================================================\r\n// TIPOS\r\n// ============================================================================\r\n\r\ninterface PendingPatientsWidgetProps {\r\n    /** ID del médico */\r\n    doctorId?: string;\r\n    /** Si está siendo arrastrado */\r\n    isDragging?: boolean;\r\n}\r\n\r\n// ============================================================================\r\n// COMPONENTE PRINCIPAL\r\n// ============================================================================\r\n\r\n/**\r\n * Widget de pacientes en sala de espera.\r\n * Muestra los pacientes con citas pendientes del día actual.\r\n * \r\n * @example\r\n * <PendingPatientsWidget doctorId=\"uuid-del-doctor\" />\r\n */\r\nexport function PendingPatientsWidget({\r\n    doctorId,\r\n    isDragging\r\n}: PendingPatientsWidgetProps) {\r\n    const router = useRouter();\r\n\r\n    // Obtener datos reales del dashboard\r\n    const { todayAppointments, isLoading } = useDashboardData(doctorId);\r\n\r\n    // Filtrar solo citas pendientes\r\n    const pendingPatients = useMemo(() => {\r\n        return todayAppointments\r\n            .filter(apt => apt.status === \"pending\")\r\n            .map(apt => ({\r\n                id: apt.id,\r\n                name: apt.patient,\r\n                patientId: apt.patientId,\r\n                avatar: apt.patientAvatar,\r\n                waitTime: calculateWaitTime(apt.time),\r\n                type: apt.type,\r\n                reason: apt.motivo || \"Consulta general\",\r\n                time: apt.time,\r\n            }));\r\n    }, [todayAppointments]);\r\n\r\n    // Handler para atender paciente\r\n    const handleAttendPatient = (appointmentId: string) => {\r\n        router.push(`/dashboard/medico/consulta/${appointmentId}`);\r\n    };\r\n\r\n    return (\r\n        <WidgetWrapper\r\n            id=\"pending-patients\"\r\n            title=\"Sala de Espera\"\r\n            icon={<Users className=\"h-4 w-4 text-primary\" />}\r\n            isDragging={isDragging}\r\n            showControls={false}\r\n        >\r\n            <div className=\"space-y-3\">\r\n                {/* Estado de carga */}\r\n                {isLoading ? (\r\n                    <div className=\"flex items-center justify-center py-8\">\r\n                        <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\r\n                    </div>\r\n                ) : (\r\n                    <>\r\n                        {/* Header */}\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <Badge variant=\"secondary\" className=\"text-[10px] gap-1\">\r\n                                <Clock className=\"h-2.5 w-2.5\" />\r\n                                {pendingPatients.length} en espera\r\n                            </Badge>\r\n                        </div>\r\n\r\n                        {/* Patients List */}\r\n                        <div className=\"space-y-2\">\r\n                            {pendingPatients.length > 0 ? (\r\n                                pendingPatients.map((patient, index) => (\r\n                                    <motion.div\r\n                                        key={patient.id}\r\n                                        initial={{ opacity: 0, x: -10 }}\r\n                                        animate={{ opacity: 1, x: 0 }}\r\n                                        transition={{ delay: index * 0.05 }}\r\n                                        className={cn(\r\n                                            \"flex items-center gap-2 p-2 rounded-lg\",\r\n                                            \"bg-muted/30 hover:bg-muted/50 transition-colors\"\r\n                                        )}\r\n                                    >\r\n                                        {/* Avatar */}\r\n                                        <Avatar className=\"h-8 w-8\">\r\n                                            {patient.avatar ? (\r\n                                                <AvatarImage src={patient.avatar} alt={patient.name} />\r\n                                            ) : null}\r\n                                            <AvatarFallback className=\"text-xs bg-gradient-to-br from-primary/20 to-secondary/20\">\r\n                                                {getInitials(patient.name)}\r\n                                            </AvatarFallback>\r\n                                        </Avatar>\r\n\r\n                                        {/* Content */}\r\n                                        <div className=\"flex-1 min-w-0\">\r\n                                            <div className=\"flex items-center gap-1\">\r\n                                                <p className=\"text-xs font-medium truncate\">\r\n                                                    {patient.name}\r\n                                                </p>\r\n                                                {patient.type === \"telemedicina\" && (\r\n                                                    <Video className=\"h-3 w-3 text-secondary flex-shrink-0\" />\r\n                                                )}\r\n                                            </div>\r\n                                            <p className=\"text-[10px] text-muted-foreground truncate\">\r\n                                                {patient.reason}\r\n                                            </p>\r\n                                        </div>\r\n\r\n                                        {/* Wait Time & Action */}\r\n                                        <div className=\"flex flex-col items-end\">\r\n                                            <span className=\"text-[10px] font-medium text-muted-foreground\">\r\n                                                {patient.waitTime}\r\n                                            </span>\r\n                                            <Button\r\n                                                size=\"sm\"\r\n                                                className=\"h-5 text-[10px] px-2 mt-1\"\r\n                                                onClick={() => handleAttendPatient(patient.id)}\r\n                                            >\r\n                                                <UserCheck className=\"h-2.5 w-2.5 mr-1\" />\r\n                                                Atender\r\n                                            </Button>\r\n                                        </div>\r\n                                    </motion.div>\r\n                                ))\r\n                            ) : (\r\n                                <motion.div\r\n                                    initial={{ opacity: 0 }}\r\n                                    animate={{ opacity: 1 }}\r\n                                    className=\"text-center py-6 text-muted-foreground\"\r\n                                >\r\n                                    <Users className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\r\n                                    <p className=\"text-xs\">No hay pacientes en espera</p>\r\n                                </motion.div>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* View All */}\r\n                        {pendingPatients.length > 0 && (\r\n                            <Button variant=\"outline\" className=\"w-full text-xs h-7\" asChild>\r\n                                <a href=\"/dashboard/medico/pacientes\">\r\n                                    Ver todos los pacientes\r\n                                    <ChevronRight className=\"h-3 w-3 ml-1\" />\r\n                                </a>\r\n                            </Button>\r\n                        )}\r\n                    </>\r\n                )}\r\n            </div>\r\n        </WidgetWrapper>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\dashboard\\widgets\\performance-chart-widget.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AnimatePresence' is defined but never used.","line":12,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckCircle2' is defined but never used.","line":16,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'XCircle' is defined but never used.","line":17,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used.","line":24,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Legend' is defined but never used.","line":41,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":41,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used.","line":44,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":44,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file performance-chart-widget.tsx\r\n * @description Super Widget de rendimiento integral.\r\n * Combina métricas operativas, económicas, demográficas y clínicas.\r\n * \r\n * @module Dashboard/Widgets\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useMemo, useState } from \"react\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport {\r\n    BarChart3,\r\n    Loader2,\r\n    CheckCircle2,\r\n    XCircle,\r\n    Activity,\r\n    Wallet,\r\n    Users,\r\n    Stethoscope,\r\n    TrendingUp,\r\n    TrendingDown,\r\n    Calendar,\r\n    Baby,\r\n    PersonStanding\r\n} from \"lucide-react\";\r\nimport {\r\n    AreaChart,\r\n    Area,\r\n    BarChart,\r\n    Bar,\r\n    XAxis,\r\n    YAxis,\r\n    CartesianGrid,\r\n    Tooltip,\r\n    ResponsiveContainer,\r\n    PieChart,\r\n    Pie,\r\n    Cell,\r\n    Legend\r\n} from \"recharts\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Tabs, TabsList, TabsTrigger, TabsContent } from \"@red-salud/ui\";\r\nimport { WidgetWrapper } from \"../widget-wrapper\";\r\nimport { useDashboardData } from \"@/hooks/use-dashboard-data\";\r\n\r\n// ============================================================================\r\n// TIPOS\r\n// ============================================================================\r\n\r\ninterface PerformanceChartWidgetProps {\r\n    doctorId?: string;\r\n    isDragging?: boolean;\r\n    profile?: {\r\n        consultation_price?: number;\r\n    };\r\n}\r\n\r\ntype TabType = \"overview\" | \"income\" | \"patients\" | \"clinical\";\r\n\r\n// ============================================================================\r\n// HELPERS\r\n// ============================================================================\r\n\r\nfunction formatCurrency(amount: number): string {\r\n    return new Intl.NumberFormat(\"es-VE\", {\r\n        style: \"currency\",\r\n        currency: \"USD\",\r\n        maximumFractionDigits: 0,\r\n    }).format(amount);\r\n}\r\n\r\nfunction calculateAge(birthDateStr?: string): number | null {\r\n    if (!birthDateStr) return null;\r\n    const birthDate = new Date(birthDateStr);\r\n    const ageDifMs = Date.now() - birthDate.getTime();\r\n    const ageDate = new Date(ageDifMs);\r\n    return Math.abs(ageDate.getUTCFullYear() - 1970);\r\n}\r\n\r\n// ============================================================================\r\n// COMPONENTE PRINCIPAL\r\n// ============================================================================\r\n\r\nexport function PerformanceChartWidget({\r\n    doctorId,\r\n    isDragging,\r\n    profile\r\n}: PerformanceChartWidgetProps) {\r\n    const [activeTab, setActiveTab] = useState<TabType>(\"overview\");\r\n    const { appointments, isLoading } = useDashboardData(doctorId);\r\n    const consultationPrice = profile?.consultation_price || 60;\r\n\r\n    // ------------------------------------------------------------------------\r\n    // DATOS: RESUMEN (Overview)\r\n    // ------------------------------------------------------------------------\r\n    const overviewData = useMemo(() => {\r\n        const days = [\"Dom\", \"Lun\", \"Mar\", \"Mié\", \"Jue\", \"Vie\", \"Sáb\"];\r\n        const result = [];\r\n        for (let i = 6; i >= 0; i--) {\r\n            const d = new Date();\r\n            d.setDate(d.getDate() - i);\r\n            d.setHours(0, 0, 0, 0);\r\n            const dateStr = d.toISOString().split('T')[0];\r\n\r\n            const daysApts = appointments.filter(a => a.appointment_date === dateStr);\r\n\r\n            result.push({\r\n                name: days[d.getDay()],\r\n                total: daysApts.length,\r\n                completed: daysApts.filter(a => a.status === 'completed').length,\r\n                cancelled: daysApts.filter(a => a.status === 'cancelled').length,\r\n            });\r\n        }\r\n        return result;\r\n    }, [appointments]);\r\n\r\n    const overviewStats = useMemo(() => ({\r\n        total: appointments.length,\r\n        completed: appointments.filter(a => a.status === 'completed').length,\r\n        pending: appointments.filter(a => a.status === 'pending').length,\r\n        cancelled: appointments.filter(a => a.status === 'cancelled').length,\r\n    }), [appointments]);\r\n\r\n    // ------------------------------------------------------------------------\r\n    // DATOS: INGRESOS (Income)\r\n    // ------------------------------------------------------------------------\r\n    const incomeData = useMemo(() => {\r\n        const now = new Date();\r\n        const currentMonth = now.getMonth();\r\n        const currentYear = now.getFullYear();\r\n\r\n        // Ingresos este mes\r\n        const thisMonthApts = appointments.filter(a => {\r\n            const d = new Date(a.appointment_date);\r\n            return d.getMonth() === currentMonth &&\r\n                d.getFullYear() === currentYear &&\r\n                a.status === 'completed';\r\n        });\r\n        const currentRef = thisMonthApts.length * consultationPrice;\r\n\r\n        // Ingresos mes anterior\r\n        const lastMonthApts = appointments.filter(a => {\r\n            const d = new Date(a.appointment_date);\r\n            // Lógica simple mes anterior\r\n            const isLastMonth = currentMonth === 0\r\n                ? (d.getMonth() === 11 && d.getFullYear() === currentYear - 1)\r\n                : (d.getMonth() === currentMonth - 1 && d.getFullYear() === currentYear);\r\n            return isLastMonth && a.status === 'completed';\r\n        });\r\n        const prevRef = lastMonthApts.length * consultationPrice;\r\n\r\n        // Gráfico últimos 6 meses\r\n        const chart = [];\r\n        const monthNames = [\"Ene\", \"Feb\", \"Mar\", \"Abr\", \"May\", \"Jun\", \"Jul\", \"Ago\", \"Sep\", \"Oct\", \"Nov\", \"Dic\"];\r\n\r\n        for (let i = 5; i >= 0; i--) {\r\n            const d = new Date(now.getFullYear(), now.getMonth() - i, 1);\r\n            const m = d.getMonth();\r\n            const y = d.getFullYear();\r\n\r\n            const monthlyApts = appointments.filter(a => {\r\n                const ad = new Date(a.appointment_date);\r\n                return ad.getMonth() === m && ad.getFullYear() === y && a.status === 'completed';\r\n            });\r\n\r\n            chart.push({\r\n                name: monthNames[m],\r\n                value: monthlyApts.length * consultationPrice\r\n            });\r\n        }\r\n\r\n        return { current: currentRef, previous: prevRef, chart };\r\n    }, [appointments, consultationPrice]);\r\n\r\n    // ------------------------------------------------------------------------\r\n    // DATOS: PACIENTES (Demografía)\r\n    // ------------------------------------------------------------------------\r\n    const demographicsData = useMemo(() => {\r\n        const uniquePatients = new Map();\r\n        appointments.forEach(apt => {\r\n            if (apt.patient && !uniquePatients.has(apt.patient_id)) {\r\n                uniquePatients.set(apt.patient_id, apt.patient);\r\n            }\r\n        });\r\n        const patients = Array.from(uniquePatients.values());\r\n\r\n        // Edades\r\n        const ageGroups = { \"0-18\": 0, \"19-35\": 0, \"36-50\": 0, \"51+\": 0 };\r\n        patients.forEach(p => {\r\n            const age = calculateAge(p.fecha_nacimiento);\r\n            if (age !== null) {\r\n                if (age <= 18) ageGroups[\"0-18\"]++;\r\n                else if (age <= 35) ageGroups[\"19-35\"]++;\r\n                else if (age <= 50) ageGroups[\"36-50\"]++;\r\n                else ageGroups[\"51+\"]++;\r\n            }\r\n        });\r\n\r\n        const ageChart = [\r\n            { name: \"0-18\", value: ageGroups[\"0-18\"], color: \"#3b82f6\" },\r\n            { name: \"19-35\", value: ageGroups[\"19-35\"], color: \"#8b5cf6\" },\r\n            { name: \"36-50\", value: ageGroups[\"36-50\"], color: \"#ec4899\" },\r\n            { name: \"50+\", value: ageGroups[\"51+\"], color: \"#f97316\" },\r\n        ].filter(d => d.value > 0);\r\n\r\n        // Género\r\n        const genderStats = { M: 0, F: 0, Other: 0 };\r\n        patients.forEach(p => {\r\n            const g = p.genero?.toLowerCase() || 'other';\r\n            if (g === 'masculino' || g === 'm' || g === 'hombre') genderStats.M++;\r\n            else if (g === 'femenino' || g === 'f' || g === 'mujer') genderStats.F++;\r\n            else genderStats.Other++;\r\n        });\r\n\r\n        return { ageChart, genderStats, total: patients.length };\r\n    }, [appointments]);\r\n\r\n    // ------------------------------------------------------------------------\r\n    // DATOS: CLÍNICO (Diagnósticos/Motivos)\r\n    // ------------------------------------------------------------------------\r\n    const clinicalData = useMemo(() => {\r\n        const reasons: Record<string, number> = {};\r\n        appointments.forEach(apt => {\r\n            if (!apt.reason) return;\r\n            // Normalizar motivo básico\r\n            let r = apt.reason.trim();\r\n            // Agrupación super simple por palabras clave si no hay diagnósticos formales\r\n            const lower = r.toLowerCase();\r\n            if (lower.includes(\"consulta\") || lower.includes(\"control\")) r = \"Control General\";\r\n            else if (lower.includes(\"dolor\") || lower.includes(\"molestia\")) r = \"Dolor/Malestar\";\r\n            else if (lower.includes(\"fiebre\") || lower.includes(\"gripe\")) r = \"Infección/Viral\";\r\n            else if (lower.includes(\"examen\") || lower.includes(\"chequeo\")) r = \"Exámenes\";\r\n            else r = r.length > 15 ? r.substring(0, 15) + \"...\" : r; // Truncar largos\r\n\r\n            reasons[r] = (reasons[r] || 0) + 1;\r\n        });\r\n\r\n        return Object.entries(reasons)\r\n            .map(([name, count]) => ({ name, count }))\r\n            .sort((a, b) => b.count - a.count)\r\n            .slice(0, 5); // Top 5\r\n    }, [appointments]);\r\n\r\n\r\n    // ------------------------------------------------------------------------\r\n    // RENDER\r\n    // ------------------------------------------------------------------------\r\n\r\n    const renderTabTrigger = (value: TabType, label: string, Icon: React.ElementType) => (\r\n        <TabsTrigger\r\n            value={value}\r\n            className=\"flex items-center gap-1.5 text-[10px] sm:text-xs py-1.5 h-8 data-[state=active]:bg-background data-[state=active]:text-primary data-[state=active]:shadow-sm\"\r\n        >\r\n            <Icon className=\"w-3.5 h-3.5\" />\r\n            <span className=\"hidden sm:inline\">{label}</span>\r\n        </TabsTrigger>\r\n    );\r\n\r\n    return (\r\n        <WidgetWrapper\r\n            id=\"performance-super\"\r\n            title=\"Rendimiento y Estadísticas\"\r\n            icon={<Activity className=\"h-4 w-4 text-primary\" />}\r\n            isDragging={isDragging}\r\n            showControls={false}\r\n        >\r\n            <Tabs value={activeTab} onValueChange={(v) => setActiveTab(v as TabType)} className=\"w-full\">\r\n                <TabsList className=\"w-full h-auto p-1 bg-muted/40 grid grid-cols-4 mb-4\">\r\n                    {renderTabTrigger(\"overview\", \"Resumen\", BarChart3)}\r\n                    {renderTabTrigger(\"income\", \"Ingresos\", Wallet)}\r\n                    {renderTabTrigger(\"patients\", \"Pacientes\", Users)}\r\n                    {renderTabTrigger(\"clinical\", \"Clínico\", Stethoscope)}\r\n                </TabsList>\r\n\r\n                {isLoading ? (\r\n                    <div className=\"flex items-center justify-center h-[200px]\">\r\n                        <Loader2 className=\"h-8 w-8 animate-spin text-primary/50\" />\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"min-h-[220px]\">\r\n\r\n\r\n                        {/* --- VISTA RESUMEN --- */}\r\n                        <TabsContent key=\"overview\" value=\"overview\" className=\"mt-0 space-y-4 animate-in fade-in-50 zoom-in-95 duration-300\">\r\n                            <div className=\"grid grid-cols-3 gap-3\">\r\n                                {[\r\n                                    { label: \"Citas\", val: overviewStats.total, color: \"text-blue-500\", bg: \"bg-blue-500/10\" },\r\n                                    { label: \"Completadas\", val: overviewStats.completed, color: \"text-green-500\", bg: \"bg-green-500/10\" },\r\n                                    { label: \"Canceladas\", val: overviewStats.cancelled, color: \"text-red-500\", bg: \"bg-red-500/10\" },\r\n                                ].map((s, i) => (\r\n                                    <div key={i} className={cn(\"flex flex-col items-center justify-center p-2 rounded-lg border border-border/50\", s.bg)}>\r\n                                        <span className={cn(\"text-xl font-bold\", s.color)}>{s.val}</span>\r\n                                        <span className=\"text-[10px] text-muted-foreground uppercase tracking-wider font-semibold\">{s.label}</span>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                            <div className=\"h-[160px] w-full\">\r\n                                <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                    <AreaChart data={overviewData} margin={{ top: 5, right: 0, left: -20, bottom: 0 }}>\r\n                                        <defs>\r\n                                            <linearGradient id=\"colorTotal\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                                                <stop offset=\"5%\" stopColor=\"#3b82f6\" stopOpacity={0.2} />\r\n                                                <stop offset=\"95%\" stopColor=\"#3b82f6\" stopOpacity={0} />\r\n                                            </linearGradient>\r\n                                        </defs>\r\n                                        <CartesianGrid strokeDasharray=\"3 3\" vertical={false} opacity={0.2} />\r\n                                        <XAxis dataKey=\"name\" tick={{ fontSize: 10 }} axisLine={false} tickLine={false} />\r\n                                        <YAxis tick={{ fontSize: 10 }} axisLine={false} tickLine={false} />\r\n                                        <Tooltip\r\n                                            contentStyle={{ borderRadius: '8px', border: 'none', boxShadow: '0 4px 12px rgba(0,0,0,0.1)' }}\r\n                                            itemStyle={{ fontSize: '12px' }}\r\n                                        />\r\n                                        <Area type=\"monotone\" dataKey=\"total\" stroke=\"#3b82f6\" fill=\"url(#colorTotal)\" strokeWidth={2} name=\"Total\" />\r\n                                        <Area type=\"monotone\" dataKey=\"completed\" stroke=\"#22c55e\" fill=\"none\" strokeWidth={2} name=\"Completadas\" />\r\n                                    </AreaChart>\r\n                                </ResponsiveContainer>\r\n                            </div>\r\n                        </TabsContent>\r\n\r\n                        {/* --- VISTA INGRESOS --- */}\r\n                        <TabsContent key=\"income\" value=\"income\" className=\"mt-0 space-y-4 animate-in fade-in-50 zoom-in-95 duration-300\">\r\n                            <div className=\"flex items-center justify-between p-3 rounded-lg bg-gradient-to-r from-primary/10 via-primary/5 to-transparent border border-primary/10\">\r\n                                <div>\r\n                                    <p className=\"text-xs text-muted-foreground mb-1\">Ingresos este mes (Est.)</p>\r\n                                    <p className=\"text-2xl font-bold text-primary\">{formatCurrency(incomeData.current)}</p>\r\n                                </div>\r\n                                <div className=\"text-right\">\r\n                                    <Badge variant=\"outline\" className={cn(\r\n                                        \"gap-1\",\r\n                                        incomeData.current >= incomeData.previous ? \"text-green-600 bg-green-50\" : \"text-red-600 bg-red-50\"\r\n                                    )}>\r\n                                        {incomeData.current >= incomeData.previous ? <TrendingUp className=\"w-3 h-3\" /> : <TrendingDown className=\"w-3 h-3\" />}\r\n                                        {incomeData.previous > 0 ? Math.round(((incomeData.current - incomeData.previous) / incomeData.previous) * 100) : 0}%\r\n                                    </Badge>\r\n                                    <p className=\"text-[10px] text-muted-foreground mt-1\">vs mes anterior</p>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"h-[150px] w-full\">\r\n                                <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                    <BarChart data={incomeData.chart} margin={{ top: 10, right: 0, left: -20, bottom: 0 }}>\r\n                                        <XAxis dataKey=\"name\" tick={{ fontSize: 10 }} axisLine={false} tickLine={false} />\r\n                                        <YAxis tick={{ fontSize: 10 }} axisLine={false} tickLine={false} tickFormatter={(v) => `$${v}`} />\r\n                                        <Tooltip\r\n                                            cursor={{ fill: 'hsl(var(--muted)/0.3)' }}\r\n                                            contentStyle={{ borderRadius: '8px' }}\r\n                                            formatter={(value: number) => [formatCurrency(value), \"Ingresos\"]}\r\n                                        />\r\n                                        <Bar dataKey=\"value\" fill=\"hsl(var(--primary))\" radius={[4, 4, 0, 0]} />\r\n                                    </BarChart>\r\n                                </ResponsiveContainer>\r\n                            </div>\r\n                        </TabsContent>\r\n\r\n                        {/* --- VISTA PACIENTES --- */}\r\n                        <TabsContent key=\"patients\" value=\"patients\" className=\"mt-0 grid grid-cols-2 gap-4 animate-in fade-in-50 zoom-in-95 duration-300\">\r\n                            <div className=\"flex flex-col items-center justify-center p-2 bg-muted/20 rounded-lg\">\r\n                                <h4 className=\"text-xs font-semibold mb-2 flex items-center gap-1\">\r\n                                    <Baby className=\"w-3 h-3\" /> Distribución Edad\r\n                                </h4>\r\n                                <div className=\"h-[120px] w-full\">\r\n                                    <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                        <PieChart>\r\n                                            <Pie\r\n                                                data={demographicsData.ageChart}\r\n                                                cx=\"50%\"\r\n                                                cy=\"50%\"\r\n                                                innerRadius={25}\r\n                                                outerRadius={45}\r\n                                                paddingAngle={2}\r\n                                                dataKey=\"value\"\r\n                                            >\r\n                                                {demographicsData.ageChart.map((entry, index) => (\r\n                                                    <Cell key={`cell-${index}`} fill={entry.color} />\r\n                                                ))}\r\n                                            </Pie>\r\n                                            <Tooltip />\r\n                                        </PieChart>\r\n                                    </ResponsiveContainer>\r\n                                </div>\r\n                                <div className=\"flex flex-wrap justify-center gap-2 mt-2\">\r\n                                    {demographicsData.ageChart.map((d, i) => (\r\n                                        <div key={i} className=\"flex items-center gap-1 text-[9px]\">\r\n                                            <div className=\"w-2 h-2 rounded-full\" style={{ backgroundColor: d.color }} />\r\n                                            <span className=\"text-muted-foreground\">{d.name}</span>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"flex flex-col p-2 bg-muted/20 rounded-lg\">\r\n                                <h4 className=\"text-xs font-semibold mb-3 flex items-center gap-1\">\r\n                                    <PersonStanding className=\"w-3 h-3\" /> Género\r\n                                </h4>\r\n                                <div className=\"space-y-3 flex-1 flex flex-col justify-center\">\r\n                                    <div className=\"space-y-1\">\r\n                                        <div className=\"flex justify-between text-[10px]\">\r\n                                            <span>Masculino</span>\r\n                                            <span className=\"font-bold\">{demographicsData.genderStats.M}</span>\r\n                                        </div>\r\n                                        <div className=\"h-2 w-full bg-muted rounded-full overflow-hidden\">\r\n                                            <div\r\n                                                className=\"h-full bg-blue-500 rounded-full\"\r\n                                                style={{ width: `${(demographicsData.genderStats.M / Math.max(demographicsData.total, 1)) * 100}%` }}\r\n                                            />\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"space-y-1\">\r\n                                        <div className=\"flex justify-between text-[10px]\">\r\n                                            <span>Femenino</span>\r\n                                            <span className=\"font-bold\">{demographicsData.genderStats.F}</span>\r\n                                        </div>\r\n                                        <div className=\"h-2 w-full bg-muted rounded-full overflow-hidden\">\r\n                                            <div\r\n                                                className=\"h-full bg-pink-500 rounded-full\"\r\n                                                style={{ width: `${(demographicsData.genderStats.F / Math.max(demographicsData.total, 1)) * 100}%` }}\r\n                                            />\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </TabsContent>\r\n\r\n                        {/* --- VISTA CLÍNICO --- */}\r\n                        <TabsContent key=\"clinical\" value=\"clinical\" className=\"mt-0 animate-in fade-in-50 zoom-in-95 duration-300\">\r\n                            <h4 className=\"text-xs font-semibold mb-3 text-muted-foreground\">Motivos de consulta frecuentes</h4>\r\n                            <div className=\"space-y-3\">\r\n                                {clinicalData.length > 0 ? clinicalData.map((item, index) => (\r\n                                    <div key={index} className=\"group flex items-center gap-3\">\r\n                                        <span className=\"text-[10px] bg-muted w-5 h-5 flex items-center justify-center rounded-full font-bold text-muted-foreground group-hover:bg-primary group-hover:text-primary-foreground transition-colors\">\r\n                                            {index + 1}\r\n                                        </span>\r\n                                        <div className=\"flex-1\">\r\n                                            <div className=\"flex justify-between text-xs mb-1\">\r\n                                                <span className=\"font-medium group-hover:text-primary transition-colors\">{item.name}</span>\r\n                                                <span className=\"text-muted-foreground\">{item.count} citas</span>\r\n                                            </div>\r\n                                            <div className=\"h-1.5 w-full bg-muted rounded-full overflow-hidden\">\r\n                                                <motion.div\r\n                                                    initial={{ width: 0 }}\r\n                                                    animate={{ width: `${(item.count / Math.max(...clinicalData.map(c => c.count))) * 100}%` }}\r\n                                                    className=\"h-full bg-primary/70 rounded-full group-hover:bg-primary transition-colors\"\r\n                                                />\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                )) : (\r\n                                    <div className=\"text-center py-10 text-muted-foreground text-xs\">\r\n                                        No hay datos suficientes\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </TabsContent>\r\n\r\n\r\n                    </div>\r\n                )}\r\n            </Tabs>\r\n        </WidgetWrapper >\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\dashboard\\widgets\\productivity-score-widget.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Target' is defined but never used.","line":9,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[919,922],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[919,922],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadProductivityMetrics'. Either include it or remove the dependency array.","line":40,"column":6,"nodeType":"ArrayExpression","endLine":40,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [doctorId, loadProductivityMetrics]","fix":{"range":[1293,1303],"text":"[doctorId, loadProductivityMetrics]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'monthlyCompleted' is assigned a value but never used.","line":82,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":82,"endColumn":29}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { WidgetWrapper } from \"../widget-wrapper\";\r\nimport { Card, CardContent } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Progress } from \"@red-salud/ui\";\r\nimport { Gauge, Target, Clock, CheckCircle, TrendingUp, Calendar } from \"lucide-react\";\r\nimport { Skeleton } from \"@red-salud/ui\";\r\n\r\ninterface ProductivityMetrics {\r\n  overall_score: number;\r\n  consultations_completed: number;\r\n  consultations_target: number;\r\n  avg_consultation_time: number;\r\n  patient_satisfaction: number;\r\n  tasks_completed: number;\r\n  tasks_total: number;\r\n  weekly_goal_progress: number;\r\n  efficiency_rating: 'excellent' | 'good' | 'average' | 'needs_improvement';\r\n  streak_days: number;\r\n  best_day: string;\r\n}\r\n\r\ninterface ProductivityScoreWidgetProps {\r\n  doctorId?: string;\r\n  profile?: any;\r\n}\r\n\r\nexport function ProductivityScoreWidget({ doctorId }: ProductivityScoreWidgetProps) {\r\n  const [metrics, setMetrics] = useState<ProductivityMetrics | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (doctorId) {\r\n      loadProductivityMetrics();\r\n    }\r\n  }, [doctorId]);\r\n\r\n  const loadProductivityMetrics = async () => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n\r\n      // Calcular métricas de productividad desde datos reales\r\n      const now = new Date();\r\n      const startOfWeek = new Date(now.setDate(now.getDate() - now.getDay()));\r\n      const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);\r\n\r\n      // Consultas completadas esta semana\r\n      const { data: weeklyConsultations, error: weeklyError } = await supabase\r\n        .from(\"consultas\")\r\n        .select(\"id, fecha_hora, duracion_minutos, status\")\r\n        .eq(\"doctor_id\", doctorId)\r\n        .eq(\"status\", \"completada\")\r\n        .gte(\"fecha_hora\", startOfWeek.toISOString());\r\n\r\n      if (weeklyError) throw weeklyError;\r\n\r\n      // Consultas completadas este mes\r\n      const { data: monthlyConsultations, error: monthlyError } = await supabase\r\n        .from(\"consultas\")\r\n        .select(\"id, fecha_hora, duracion_minutos, status\")\r\n        .eq(\"doctor_id\", doctorId)\r\n        .eq(\"status\", \"completada\")\r\n        .gte(\"fecha_hora\", startOfMonth.toISOString());\r\n\r\n      if (monthlyError) throw monthlyError;\r\n\r\n      // Tareas completadas\r\n      const { data: tasks, error: tasksError } = await supabase\r\n        .from(\"doctor_tasks\")\r\n        .select(\"is_completed\")\r\n        .eq(\"doctor_id\", doctorId);\r\n\r\n      if (tasksError) throw tasksError;\r\n\r\n      // Calcular métricas\r\n      const consultationsCompleted = weeklyConsultations?.length || 0;\r\n      const monthlyCompleted = monthlyConsultations?.length || 0;\r\n      const avgConsultationTime = monthlyConsultations?.length\r\n        ? monthlyConsultations.reduce((sum, c) => sum + (c.duracion_minutos || 30), 0) / monthlyConsultations.length\r\n        : 30;\r\n\r\n      const tasksCompleted = tasks?.filter(t => t.is_completed).length || 0;\r\n      const tasksTotal = tasks?.length || 0;\r\n\r\n      // Meta semanal (asumir 20 consultas por semana)\r\n      const weeklyTarget = 20;\r\n      const weeklyProgress = (consultationsCompleted / weeklyTarget) * 100;\r\n\r\n      // Calificación de eficiencia\r\n      let efficiencyRating: ProductivityMetrics['efficiency_rating'] = 'needs_improvement';\r\n      if (weeklyProgress >= 90) efficiencyRating = 'excellent';\r\n      else if (weeklyProgress >= 75) efficiencyRating = 'good';\r\n      else if (weeklyProgress >= 50) efficiencyRating = 'average';\r\n\r\n      // Puntaje general (0-100)\r\n      const taskCompletionRate = tasksTotal > 0 ? (tasksCompleted / tasksTotal) * 100 : 100;\r\n      const timeEfficiency = Math.max(0, 100 - Math.abs(avgConsultationTime - 25)); // Meta: 25 min promedio\r\n      const overallScore = Math.round(\r\n        (weeklyProgress * 0.4) +\r\n        (taskCompletionRate * 0.3) +\r\n        (timeEfficiency * 0.3)\r\n      );\r\n\r\n      setMetrics({\r\n        overall_score: Math.min(100, Math.max(0, overallScore)),\r\n        consultations_completed: consultationsCompleted,\r\n        consultations_target: weeklyTarget,\r\n        avg_consultation_time: Math.round(avgConsultationTime),\r\n        patient_satisfaction: 85, // Placeholder - se calcularía desde reviews\r\n        tasks_completed: tasksCompleted,\r\n        tasks_total: tasksTotal,\r\n        weekly_goal_progress: Math.min(100, weeklyProgress),\r\n        efficiency_rating: efficiencyRating,\r\n        streak_days: 5, // Placeholder - se calcularía desde datos históricos\r\n        best_day: 'Lunes' // Placeholder\r\n      });\r\n\r\n    } catch (err) {\r\n      const errorMessage = err instanceof Error ? err.message : String(err);\r\n      console.error(\"Error loading productivity metrics:\", errorMessage);\r\n      setError(\"Error al cargar métricas de productividad\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const getScoreColor = (score: number) => {\r\n    if (score >= 85) return 'text-green-600 dark:text-green-400';\r\n    if (score >= 70) return 'text-blue-600 dark:text-blue-400';\r\n    if (score >= 50) return 'text-yellow-600 dark:text-yellow-400';\r\n    return 'text-red-600 dark:text-red-400';\r\n  };\r\n\r\n  const getScoreBgColor = (score: number) => {\r\n    if (score >= 85) return 'bg-green-50 dark:bg-green-950/20';\r\n    if (score >= 70) return 'bg-blue-50 dark:bg-blue-950/20';\r\n    if (score >= 50) return 'bg-yellow-50 dark:bg-yellow-950/20';\r\n    return 'bg-red-50 dark:bg-red-950/20';\r\n  };\r\n\r\n  const getEfficiencyBadgeVariant = (rating: string) => {\r\n    switch (rating) {\r\n      case 'excellent': return 'default';\r\n      case 'good': return 'secondary';\r\n      case 'average': return 'outline';\r\n      default: return 'destructive';\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <WidgetWrapper\r\n        id=\"productivity-score\"\r\n        title=\"Productividad\"\r\n        icon={<Gauge className=\"h-4 w-4 text-primary\" />}\r\n      >\r\n        <div className=\"space-y-4\">\r\n          <Skeleton className=\"h-20 w-full\" />\r\n          <div className=\"grid grid-cols-2 gap-3\">\r\n            <Skeleton className=\"h-16 w-full\" />\r\n            <Skeleton className=\"h-16 w-full\" />\r\n          </div>\r\n        </div>\r\n      </WidgetWrapper>\r\n    );\r\n  }\r\n\r\n  if (error || !metrics) {\r\n    return (\r\n      <WidgetWrapper\r\n        id=\"productivity-score\"\r\n        title=\"Productividad\"\r\n        icon={<Gauge className=\"h-4 w-4 text-primary\" />}\r\n      >\r\n        <div className=\"flex flex-col items-center justify-center h-full text-muted-foreground text-sm py-8\">\r\n          <Gauge className=\"h-8 w-8 mb-2 opacity-50\" />\r\n          <p>{error || \"No hay datos disponibles\"}</p>\r\n        </div>\r\n      </WidgetWrapper>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <WidgetWrapper\r\n      id=\"productivity-score\"\r\n      title=\"Productividad\"\r\n      icon={<Gauge className=\"h-4 w-4 text-primary\" />}\r\n    >\r\n      <div className=\"space-y-4\">\r\n        {/* Puntaje principal */}\r\n        <Card className={`border-0 ${getScoreBgColor(metrics.overall_score)}`}>\r\n          <CardContent className=\"p-4 text-center\">\r\n            <div className={`text-3xl font-bold mb-1 ${getScoreColor(metrics.overall_score)}`}>\r\n              {metrics.overall_score}\r\n            </div>\r\n            <div className=\"text-sm font-medium text-muted-foreground mb-2\">\r\n              Puntaje de Productividad\r\n            </div>\r\n            <Badge variant={getEfficiencyBadgeVariant(metrics.efficiency_rating)} className=\"capitalize\">\r\n              {metrics.efficiency_rating === 'excellent' ? 'Excelente' :\r\n               metrics.efficiency_rating === 'good' ? 'Bueno' :\r\n               metrics.efficiency_rating === 'average' ? 'Regular' : 'Mejorable'}\r\n            </Badge>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Progreso semanal */}\r\n        <div className=\"space-y-2\">\r\n          <div className=\"flex items-center justify-between text-sm\">\r\n            <span className=\"text-muted-foreground\">Meta Semanal</span>\r\n            <span className=\"font-medium\">\r\n              {metrics.consultations_completed}/{metrics.consultations_target}\r\n            </span>\r\n          </div>\r\n          <Progress value={metrics.weekly_goal_progress} className=\"h-2\" />\r\n          <div className=\"text-xs text-muted-foreground text-center\">\r\n            {metrics.weekly_goal_progress.toFixed(0)}% completado\r\n          </div>\r\n        </div>\r\n\r\n        {/* Métricas detalladas */}\r\n        <div className=\"grid grid-cols-2 gap-3\">\r\n          <Card className=\"border-0 bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-950/20 dark:to-cyan-950/20\">\r\n            <CardContent className=\"p-3\">\r\n              <div className=\"flex items-center gap-2 mb-1\">\r\n                <Clock className=\"h-3 w-3 text-blue-600\" />\r\n                <span className=\"text-xs font-medium text-blue-700 dark:text-blue-300\">\r\n                  Tiempo Promedio\r\n                </span>\r\n              </div>\r\n              <div className=\"text-lg font-bold text-blue-800 dark:text-blue-200\">\r\n                {metrics.avg_consultation_time}m\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card className=\"border-0 bg-gradient-to-br from-emerald-50 to-green-50 dark:from-emerald-950/20 dark:to-green-950/20\">\r\n            <CardContent className=\"p-3\">\r\n              <div className=\"flex items-center gap-2 mb-1\">\r\n                <CheckCircle className=\"h-3 w-3 text-emerald-600\" />\r\n                <span className=\"text-xs font-medium text-emerald-700 dark:text-emerald-300\">\r\n                  Tareas\r\n                </span>\r\n              </div>\r\n              <div className=\"text-lg font-bold text-emerald-800 dark:text-emerald-200\">\r\n                {metrics.tasks_completed}/{metrics.tasks_total}\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n\r\n        {/* Estadísticas adicionales */}\r\n        <div className=\"space-y-2 pt-2 border-t border-border/50\">\r\n          <div className=\"flex items-center justify-between text-xs\">\r\n            <span className=\"text-muted-foreground flex items-center gap-1\">\r\n              <TrendingUp className=\"h-3 w-3\" />\r\n              Racha actual\r\n            </span>\r\n            <span className=\"font-medium\">{metrics.streak_days} días</span>\r\n          </div>\r\n          <div className=\"flex items-center justify-between text-xs\">\r\n            <span className=\"text-muted-foreground flex items-center gap-1\">\r\n              <Calendar className=\"h-3 w-3\" />\r\n              Mejor día\r\n            </span>\r\n            <span className=\"font-medium\">{metrics.best_day}</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </WidgetWrapper>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\dashboard\\widgets\\quick-actions-widget.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Pill' is defined but never used.","line":12,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Settings' is defined but never used.","line":13,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingUp' is defined but never used.","line":15,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { motion } from \"framer-motion\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport {\r\n    Zap,\r\n    Calendar,\r\n    Users,\r\n    FileText,\r\n    Video,\r\n    MessageSquare,\r\n    Pill,\r\n    Settings,\r\n    FlaskConical,\r\n    TrendingUp\r\n} from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { WidgetWrapper } from \"../widget-wrapper\";\r\n\r\ninterface QuickAction {\r\n    id: string;\r\n    label: string;\r\n    icon: React.ReactNode;\r\n    href: string;\r\n    color: string;\r\n    description?: string;\r\n}\r\n\r\nconst quickActions: QuickAction[] = [\r\n    {\r\n        id: \"agenda\",\r\n        label: \"Agenda\",\r\n        icon: <Calendar className=\"h-4 w-4\" />,\r\n        href: \"/dashboard/medico/citas\",\r\n        color: \"from-blue-500 to-blue-600\",\r\n        description: \"Ver citas\",\r\n    },\r\n    {\r\n        id: \"pacientes\",\r\n        label: \"Pacientes\",\r\n        icon: <Users className=\"h-4 w-4\" />,\r\n        href: \"/dashboard/medico/pacientes\",\r\n        color: \"from-emerald-500 to-emerald-600\",\r\n        description: \"Lista de pacientes\",\r\n    },\r\n    {\r\n        id: \"Recipe\",\r\n        label: \"Recipe\",\r\n        icon: <FileText className=\"h-4 w-4\" />,\r\n        href: \"/dashboard/medico/Recipe\",\r\n        color: \"from-orange-500 to-orange-600\",\r\n        description: \"Prescripciones\",\r\n    },\r\n    {\r\n        id: \"telemedicina\",\r\n        label: \"Video\",\r\n        icon: <Video className=\"h-4 w-4\" />,\r\n        href: \"/dashboard/medico/telemedicina\",\r\n        color: \"from-teal-500 to-teal-600\",\r\n        description: \"Consultas online\",\r\n    },\r\n    {\r\n        id: \"mensajes\",\r\n        label: \"Mensajes\",\r\n        icon: <MessageSquare className=\"h-4 w-4\" />,\r\n        href: \"/dashboard/medico/mensajeria\",\r\n        color: \"from-purple-500 to-purple-600\",\r\n        description: \"Chat con pacientes\",\r\n    },\r\n    {\r\n        id: \"laboratorio\",\r\n        label: \"Lab\",\r\n        icon: <FlaskConical className=\"h-4 w-4\" />,\r\n        href: \"/dashboard/medico/laboratorio\",\r\n        color: \"from-pink-500 to-pink-600\",\r\n        description: \"Órdenes de lab\",\r\n    },\r\n];\r\n\r\ninterface QuickActionsWidgetProps {\r\n    isDragging?: boolean;\r\n}\r\n\r\nexport function QuickActionsWidget({\r\n    isDragging\r\n}: QuickActionsWidgetProps) {\r\n    const router = useRouter();\r\n\r\n    return (\r\n        <WidgetWrapper\r\n            id=\"quick-actions\"\r\n            title=\"Acciones Rápidas\"\r\n            icon={<Zap className=\"h-4 w-4 text-primary\" />}\r\n            isDragging={isDragging}\r\n            showControls={false}\r\n        >\r\n            <div className=\"grid grid-cols-3 gap-2\">\r\n                {quickActions.map((action, index) => (\r\n                    <motion.button\r\n                        key={action.id}\r\n                        initial={{ opacity: 0, scale: 0.9 }}\r\n                        animate={{ opacity: 1, scale: 1 }}\r\n                        transition={{ delay: index * 0.05 }}\r\n                        whileHover={{ scale: 1.05 }}\r\n                        whileTap={{ scale: 0.95 }}\r\n                        onClick={() => router.push(action.href)}\r\n                        className={cn(\r\n                            \"flex flex-col items-center justify-center p-3 rounded-xl\",\r\n                            \"bg-gradient-to-br from-muted/50 to-muted/20\",\r\n                            \"dark:from-muted/80 dark:to-muted/50\",\r\n                            \"border border-border/30 dark:border-border/50\",\r\n                            \"hover:shadow-md transition-all duration-200\",\r\n                            \"group\"\r\n                        )}\r\n                    >\r\n                        {/* Icon */}\r\n                        <div className={cn(\r\n                            \"flex items-center justify-center w-8 h-8 rounded-lg mb-1.5\",\r\n                            \"bg-gradient-to-br text-white\",\r\n                            action.color,\r\n                            \"group-hover:scale-110 transition-transform\"\r\n                        )}>\r\n                            {action.icon}\r\n                        </div>\r\n\r\n                        {/* Label */}\r\n                        <span className=\"text-[11px] font-medium text-foreground\">\r\n                            {action.label}\r\n                        </span>\r\n                    </motion.button>\r\n                ))}\r\n            </div>\r\n        </WidgetWrapper>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\dashboard\\widgets\\revenue-analytics-widget.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used.","line":8,"column":48,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":56},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'format' is defined but never used.","line":10,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'es' is defined but never used.","line":11,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":33,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[927,930],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[927,930],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadRevenueData'. Either include it or remove the dependency array.","line":45,"column":6,"nodeType":"ArrayExpression","endLine":45,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [doctorId, loadRevenueData]","fix":{"range":[1277,1287],"text":"[doctorId, loadRevenueData]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { WidgetWrapper } from \"../widget-wrapper\";\r\nimport { Card, CardContent } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { TrendingUp, TrendingDown, DollarSign, Calendar, Target, BarChart3 } from \"lucide-react\";\r\nimport { Skeleton } from \"@red-salud/ui\";\r\nimport { format } from \"date-fns\";\r\nimport { es } from \"date-fns/locale\";\r\n\r\ninterface RevenueData {\r\n  total_revenue: number;\r\n  monthly_revenue: number;\r\n  weekly_revenue: number;\r\n  revenue_growth: number;\r\n  projected_revenue: number;\r\n  top_services: Array<{\r\n    service: string;\r\n    revenue: number;\r\n    percentage: number;\r\n  }>;\r\n  revenue_by_month: Array<{\r\n    month: string;\r\n    revenue: number;\r\n    consultations: number;\r\n  }>;\r\n}\r\n\r\ninterface RevenueAnalyticsWidgetProps {\r\n  doctorId?: string;\r\n  profile?: any;\r\n}\r\n\r\nexport function RevenueAnalyticsWidget({ doctorId }: RevenueAnalyticsWidgetProps) {\r\n  const [data, setData] = useState<RevenueData | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (doctorId) {\r\n      loadRevenueData();\r\n    }\r\n  }, [doctorId]);\r\n\r\n  const loadRevenueData = async () => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n\r\n      // Cargar datos de ingresos del médico\r\n      const { data: revenueData, error: revenueError } = await supabase\r\n        .from(\"doctor_revenue_analytics\")\r\n        .select(\"*\")\r\n        .eq(\"doctor_id\", doctorId)\r\n        .single();\r\n\r\n      if (revenueError && revenueError.code !== 'PGRST116') {\r\n        throw revenueError;\r\n      }\r\n\r\n      // Si no hay datos, calcular desde consultas\r\n      if (!revenueData) {\r\n        const { data: consultations, error: consultationsError } = await supabase\r\n          .from(\"consultas\")\r\n          .select(`\r\n            precio_consulta,\r\n            fecha_hora,\r\n            tipo_cita,\r\n            status\r\n          `)\r\n          .eq(\"doctor_id\", doctorId)\r\n          .eq(\"status\", \"completada\")\r\n          .gte(\"fecha_hora\", new Date(Date.now() - 365 * 24 * 60 * 60 * 1000).toISOString());\r\n\r\n        if (consultationsError) throw consultationsError;\r\n\r\n        // Calcular métricas básicas\r\n        const totalRevenue = consultations?.reduce((sum, c) => sum + (c.precio_consulta || 0), 0) || 0;\r\n        const monthlyRevenue = consultations\r\n          ?.filter(c => new Date(c.fecha_hora) >= new Date(Date.now() - 30 * 24 * 60 * 60 * 1000))\r\n          .reduce((sum, c) => sum + (c.precio_consulta || 0), 0) || 0;\r\n\r\n        const weeklyRevenue = consultations\r\n          ?.filter(c => new Date(c.fecha_hora) >= new Date(Date.now() - 7 * 24 * 60 * 60 * 1000))\r\n          .reduce((sum, c) => sum + (c.precio_consulta || 0), 0) || 0;\r\n\r\n        // Calcular crecimiento (comparar con mes anterior)\r\n        const lastMonthRevenue = consultations\r\n          ?.filter(c => {\r\n            const date = new Date(c.fecha_hora);\r\n            const now = new Date();\r\n            const lastMonth = new Date(now.getFullYear(), now.getMonth() - 1, 1);\r\n            const thisMonth = new Date(now.getFullYear(), now.getMonth(), 1);\r\n            return date >= lastMonth && date < thisMonth;\r\n          })\r\n          .reduce((sum, c) => sum + (c.precio_consulta || 0), 0) || 0;\r\n\r\n        const revenueGrowth = lastMonthRevenue > 0\r\n          ? ((monthlyRevenue - lastMonthRevenue) / lastMonthRevenue) * 100\r\n          : 0;\r\n\r\n        setData({\r\n          total_revenue: totalRevenue,\r\n          monthly_revenue: monthlyRevenue,\r\n          weekly_revenue: weeklyRevenue,\r\n          revenue_growth: revenueGrowth,\r\n          projected_revenue: monthlyRevenue * 12, // Proyección simple\r\n          top_services: [],\r\n          revenue_by_month: []\r\n        });\r\n      } else {\r\n        setData(revenueData);\r\n      }\r\n    } catch (err) {\r\n      console.error(\"Error loading revenue data:\", err);\r\n      setError(\"Error al cargar datos de ingresos\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const formatCurrency = (amount: number) => {\r\n    return new Intl.NumberFormat('es-VE', {\r\n      style: 'currency',\r\n      currency: 'VES',\r\n      minimumFractionDigits: 0,\r\n      maximumFractionDigits: 0,\r\n    }).format(amount);\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <WidgetWrapper\r\n        id=\"revenue-analytics\"\r\n        title=\"Análisis Financiero\"\r\n        icon={<BarChart3 className=\"h-4 w-4 text-primary\" />}\r\n      >\r\n        <div className=\"space-y-4\">\r\n          <div className=\"grid grid-cols-2 gap-4\">\r\n            <Skeleton className=\"h-16 w-full\" />\r\n            <Skeleton className=\"h-16 w-full\" />\r\n          </div>\r\n          <Skeleton className=\"h-32 w-full\" />\r\n        </div>\r\n      </WidgetWrapper>\r\n    );\r\n  }\r\n\r\n  if (error || !data) {\r\n    return (\r\n      <WidgetWrapper\r\n        id=\"revenue-analytics\"\r\n        title=\"Análisis Financiero\"\r\n        icon={<BarChart3 className=\"h-4 w-4 text-primary\" />}\r\n      >\r\n        <div className=\"flex flex-col items-center justify-center h-full text-muted-foreground text-sm py-8\">\r\n          <BarChart3 className=\"h-8 w-8 mb-2 opacity-50\" />\r\n          <p>{error || \"No hay datos disponibles\"}</p>\r\n        </div>\r\n      </WidgetWrapper>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <WidgetWrapper\r\n      id=\"revenue-analytics\"\r\n      title=\"Análisis Financiero\"\r\n      icon={<BarChart3 className=\"h-4 w-4 text-primary\" />}\r\n    >\r\n      <div className=\"space-y-4\">\r\n        {/* Métricas principales */}\r\n        <div className=\"grid grid-cols-2 gap-3\">\r\n          <Card className=\"border-0 bg-gradient-to-br from-emerald-50 to-green-50 dark:from-emerald-950/20 dark:to-green-950/20\">\r\n            <CardContent className=\"p-3\">\r\n              <div className=\"flex items-center gap-2 mb-1\">\r\n                <DollarSign className=\"h-3 w-3 text-emerald-600\" />\r\n                <span className=\"text-xs font-medium text-emerald-700 dark:text-emerald-300\">\r\n                  Este Mes\r\n                </span>\r\n              </div>\r\n              <div className=\"text-lg font-bold text-emerald-800 dark:text-emerald-200\">\r\n                {formatCurrency(data.monthly_revenue)}\r\n              </div>\r\n              <div className=\"flex items-center gap-1 mt-1\">\r\n                {data.revenue_growth >= 0 ? (\r\n                  <TrendingUp className=\"h-3 w-3 text-green-600\" />\r\n                ) : (\r\n                  <TrendingDown className=\"h-3 w-3 text-red-600\" />\r\n                )}\r\n                <span className={`text-xs font-medium ${\r\n                  data.revenue_growth >= 0 ? 'text-green-600' : 'text-red-600'\r\n                }`}>\r\n                  {Math.abs(data.revenue_growth).toFixed(1)}%\r\n                </span>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card className=\"border-0 bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-950/20 dark:to-indigo-950/20\">\r\n            <CardContent className=\"p-3\">\r\n              <div className=\"flex items-center gap-2 mb-1\">\r\n                <Target className=\"h-3 w-3 text-blue-600\" />\r\n                <span className=\"text-xs font-medium text-blue-700 dark:text-blue-300\">\r\n                  Proyección Anual\r\n                </span>\r\n              </div>\r\n              <div className=\"text-lg font-bold text-blue-800 dark:text-blue-200\">\r\n                {formatCurrency(data.projected_revenue)}\r\n              </div>\r\n              <div className=\"text-xs text-blue-600 dark:text-blue-400 mt-1\">\r\n                Basado en este mes\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n\r\n        {/* Gráfico simple de tendencia */}\r\n        <Card className=\"border-0 bg-gradient-to-r from-primary/5 to-secondary/5\">\r\n          <CardContent className=\"p-3\">\r\n            <div className=\"flex items-center justify-between mb-2\">\r\n              <span className=\"text-xs font-medium text-muted-foreground\">Tendencia Mensual</span>\r\n              <Badge variant=\"secondary\" className=\"text-xs\">\r\n                Últimos 6 meses\r\n              </Badge>\r\n            </div>\r\n            <div className=\"flex items-end gap-1 h-12\">\r\n              {/* Simulación de barras de gráfico */}\r\n              {[0.6, 0.8, 0.7, 0.9, 0.85, 1].map((height, index) => (\r\n                <div\r\n                  key={index}\r\n                  className=\"flex-1 bg-primary/20 rounded-sm relative group\"\r\n                  style={{ height: `${height * 100}%` }}\r\n                >\r\n                  <div className=\"absolute inset-x-0 bottom-0 bg-primary rounded-sm transition-all group-hover:bg-primary/80\"\r\n                       style={{ height: '100%' }}>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n            <div className=\"flex justify-between mt-1 text-xs text-muted-foreground\">\r\n              {['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun'].map((month) => (\r\n                <span key={month}>{month}</span>\r\n              ))}\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Servicios principales */}\r\n        {data.top_services && data.top_services.length > 0 && (\r\n          <div className=\"space-y-2\">\r\n            <span className=\"text-xs font-medium text-muted-foreground\">Servicios Principales</span>\r\n            <div className=\"space-y-1\">\r\n              {data.top_services.slice(0, 3).map((service, index) => (\r\n                <div key={index} className=\"flex items-center justify-between text-xs\">\r\n                  <span className=\"truncate flex-1\">{service.service}</span>\r\n                  <div className=\"flex items-center gap-1\">\r\n                    <span className=\"font-medium\">{formatCurrency(service.revenue)}</span>\r\n                    <Badge variant=\"outline\" className=\"text-xs px-1 py-0\">\r\n                      {service.percentage.toFixed(0)}%\r\n                    </Badge>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </WidgetWrapper>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\dashboard\\widgets\\satisfaction-metrics-widget.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useMemo' is defined but never used.","line":11,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":17},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":284,"column":49,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[11526,11577],"text":"\r\n                                                &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[11526,11577],"text":"\r\n                                                &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[11526,11577],"text":"\r\n                                                &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[11526,11577],"text":"\r\n                                                &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":284,"column":66,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[11593,11640],"text":"&quot;\r\n                                            "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[11593,11640],"text":"&ldquo;\r\n                                            "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[11593,11640],"text":"&#34;\r\n                                            "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[11593,11640],"text":"&rdquo;\r\n                                            "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":310,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":310,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12490,12493],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12490,12493],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file satisfaction-metrics-widget.tsx\r\n * @description Widget de métricas de satisfacción del paciente.\r\n * Muestra calificación promedio, tendencias y reviews recientes.\r\n * \r\n * @module Dashboard/Widgets\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useMemo, useState, useEffect } from \"react\";\r\nimport { motion } from \"framer-motion\";\r\nimport {\r\n    Star,\r\n    TrendingUp,\r\n    TrendingDown,\r\n    MessageSquare,\r\n    Loader2,\r\n    Minus,\r\n    ThumbsUp,\r\n    ThumbsDown\r\n} from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Progress } from \"@red-salud/ui\";\r\nimport { WidgetWrapper } from \"../widget-wrapper\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\n\r\n// ============================================================================\r\n// TIPOS\r\n// ============================================================================\r\n\r\ninterface SatisfactionMetricsWidgetProps {\r\n    /** ID del médico */\r\n    doctorId?: string;\r\n    /** Si está siendo arrastrado */\r\n    isDragging?: boolean;\r\n}\r\n\r\ninterface ReviewData {\r\n    /** ID de la review */\r\n    id: string;\r\n    /** Calificación 1-5 */\r\n    rating: number;\r\n    /** Comentario opcional */\r\n    comment?: string;\r\n    /** Fecha de la review */\r\n    created_at: string;\r\n    /** Nombre del paciente */\r\n    patient_name?: string;\r\n}\r\n\r\ninterface SatisfactionStats {\r\n    /** Promedio de calificaciones */\r\n    average: number;\r\n    /** Total de reviews */\r\n    total: number;\r\n    /** Distribución por estrellas */\r\n    distribution: { stars: number; count: number; percentage: number }[];\r\n    /** Tendencia vs mes anterior */\r\n    trend: number;\r\n    /** Reviews recientes */\r\n    recentReviews: ReviewData[];\r\n}\r\n\r\n// ============================================================================\r\n// COMPONENTES AUXILIARES\r\n// ============================================================================\r\n\r\n/**\r\n * Renderiza estrellas de calificación.\r\n */\r\nfunction StarRating({ rating, size = \"sm\" }: { rating: number; size?: \"sm\" | \"md\" | \"lg\" }) {\r\n    const sizes = {\r\n        sm: \"h-3 w-3\",\r\n        md: \"h-4 w-4\",\r\n        lg: \"h-5 w-5\"\r\n    };\r\n\r\n    return (\r\n        <div className=\"flex items-center gap-0.5\">\r\n            {[1, 2, 3, 4, 5].map((star) => (\r\n                <Star\r\n                    key={star}\r\n                    className={cn(\r\n                        sizes[size],\r\n                        star <= rating\r\n                            ? \"fill-amber-400 text-amber-400\"\r\n                            : star - 0.5 <= rating\r\n                                ? \"fill-amber-400/50 text-amber-400\"\r\n                                : \"fill-muted text-muted\"\r\n                    )}\r\n                />\r\n            ))}\r\n        </div>\r\n    );\r\n}\r\n\r\n/**\r\n * Indicador de tendencia.\r\n */\r\nfunction TrendIndicator({ value }: { value: number }) {\r\n    if (value === 0) {\r\n        return (\r\n            <Badge variant=\"secondary\" className=\"text-[10px] gap-0.5\">\r\n                <Minus className=\"h-2.5 w-2.5\" />\r\n                Sin cambios\r\n            </Badge>\r\n        );\r\n    }\r\n\r\n    if (value > 0) {\r\n        return (\r\n            <Badge className=\"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400 text-[10px] gap-0.5\">\r\n                <TrendingUp className=\"h-2.5 w-2.5\" />\r\n                +{value.toFixed(1)}%\r\n            </Badge>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <Badge className=\"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400 text-[10px] gap-0.5\">\r\n            <TrendingDown className=\"h-2.5 w-2.5\" />\r\n            {value.toFixed(1)}%\r\n        </Badge>\r\n    );\r\n}\r\n\r\n// ============================================================================\r\n// COMPONENTE PRINCIPAL\r\n// ============================================================================\r\n\r\n/**\r\n * Widget de métricas de satisfacción del paciente.\r\n * Muestra calificación promedio, distribución y tendencias.\r\n * \r\n * @example\r\n * <SatisfactionMetricsWidget doctorId=\"uuid-del-doctor\" />\r\n */\r\nexport function SatisfactionMetricsWidget({\r\n    doctorId,\r\n    isDragging\r\n}: SatisfactionMetricsWidgetProps) {\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [stats, setStats] = useState<SatisfactionStats | null>(null);\r\n\r\n    // Cargar datos de reviews\r\n    useEffect(() => {\r\n        const loadReviews = async () => {\r\n            if (!doctorId) {\r\n                setIsLoading(false);\r\n                return;\r\n            }\r\n\r\n            try {\r\n                // Intentar cargar reviews reales desde la tabla ratings\r\n                // Filtramos por doctor_id a través de la tabla consultations\r\n                const { data: ratingsData, error } = await supabase\r\n                    .from(\"ratings\")\r\n                    .select(`\r\n                        id, \r\n                        rating, \r\n                        comment, \r\n                        created_at, \r\n                        patient:patients(full_name),\r\n                        consultation:consultations!inner(doctor_id)\r\n                    `)\r\n                    .eq(\"consultation.doctor_id\", doctorId)\r\n                    .order(\"created_at\", { ascending: false })\r\n                    .limit(50);\r\n\r\n                if (error) {\r\n                    console.error(\"[SatisfactionMetrics] Error loading ratings:\", error.message);\r\n                    setStats(generateEmptyStats());\r\n                } else if (ratingsData && ratingsData.length > 0) {\r\n                    // Procesar datos reales\r\n                    const processed = processRatings(ratingsData);\r\n                    setStats(processed);\r\n                } else {\r\n                    setStats(generateEmptyStats());\r\n                }\r\n            } catch (err) {\r\n                console.error(\"[SatisfactionMetrics] Error:\", err);\r\n                setStats(generateEmptyStats());\r\n            } finally {\r\n                setIsLoading(false);\r\n            }\r\n        };\r\n\r\n        loadReviews();\r\n    }, [doctorId]);\r\n\r\n    return (\r\n        <WidgetWrapper\r\n            id=\"satisfaction-metrics\"\r\n            title=\"Satisfacción\"\r\n            icon={<Star className=\"h-4 w-4 text-amber-500\" />}\r\n            isDragging={isDragging}\r\n            showControls={false}\r\n        >\r\n            <div className=\"space-y-3\">\r\n                {isLoading ? (\r\n                    <div className=\"flex items-center justify-center py-8\">\r\n                        <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\r\n                    </div>\r\n                ) : stats ? (\r\n                    <>\r\n                        {/* Score principal */}\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <motion.div\r\n                                    initial={{ scale: 0 }}\r\n                                    animate={{ scale: 1 }}\r\n                                    transition={{ type: \"spring\", stiffness: 200, damping: 15 }}\r\n                                    className=\"text-2xl font-bold text-foreground\"\r\n                                >\r\n                                    {stats.average.toFixed(1)}\r\n                                </motion.div>\r\n                                <div className=\"flex flex-col\">\r\n                                    <StarRating rating={stats.average} size=\"sm\" />\r\n                                    <span className=\"text-[10px] text-muted-foreground\">\r\n                                        {stats.total} {stats.total === 1 ? \"review\" : \"reviews\"}\r\n                                    </span>\r\n                                </div>\r\n                            </div>\r\n                            <TrendIndicator value={stats.trend} />\r\n                        </div>\r\n\r\n                        {/* Distribución de estrellas */}\r\n                        <div className=\"space-y-1.5\">\r\n                            {stats.distribution.map((item, index) => (\r\n                                <motion.div\r\n                                    key={item.stars}\r\n                                    initial={{ opacity: 0, x: -10 }}\r\n                                    animate={{ opacity: 1, x: 0 }}\r\n                                    transition={{ delay: index * 0.05 }}\r\n                                    className=\"flex items-center gap-2 group\"\r\n                                >\r\n                                    <span className=\"text-[10px] w-3 text-muted-foreground\">\r\n                                        {item.stars}\r\n                                    </span>\r\n                                    <Star className=\"h-2.5 w-2.5 fill-amber-400 text-amber-400\" />\r\n                                    <Progress\r\n                                        value={item.percentage}\r\n                                        className=\"h-1.5 flex-1\"\r\n                                    />\r\n                                    <span className=\"text-[10px] w-6 text-right text-muted-foreground\">\r\n                                        {item.count}\r\n                                    </span>\r\n                                </motion.div>\r\n                            ))}\r\n                        </div>\r\n\r\n                        {/* Reviews recientes */}\r\n                        {stats.recentReviews.length > 0 && (\r\n                            <div className=\"pt-2 border-t border-border/30 space-y-2\">\r\n                                <div className=\"flex items-center gap-1 text-[10px] text-muted-foreground\">\r\n                                    <MessageSquare className=\"h-3 w-3\" />\r\n                                    <span>Comentarios recientes</span>\r\n                                </div>\r\n                                {stats.recentReviews.slice(0, 2).map((review, index) => (\r\n                                    <motion.div\r\n                                        key={review.id}\r\n                                        initial={{ opacity: 0, y: 5 }}\r\n                                        animate={{ opacity: 1, y: 0 }}\r\n                                        transition={{ delay: 0.3 + index * 0.1 }}\r\n                                        className={cn(\r\n                                            \"p-2 rounded-lg bg-muted/30\",\r\n                                            \"border-l-2\",\r\n                                            review.rating >= 4 ? \"border-l-emerald-500\" :\r\n                                                review.rating >= 3 ? \"border-l-amber-500\" : \"border-l-red-500\"\r\n                                        )}\r\n                                    >\r\n                                        <div className=\"flex items-center justify-between mb-1\">\r\n                                            <StarRating rating={review.rating} size=\"sm\" />\r\n                                            {review.rating >= 4 ? (\r\n                                                <ThumbsUp className=\"h-2.5 w-2.5 text-emerald-500\" />\r\n                                            ) : review.rating <= 2 ? (\r\n                                                <ThumbsDown className=\"h-2.5 w-2.5 text-red-500\" />\r\n                                            ) : null}\r\n                                        </div>\r\n                                        {review.comment && (\r\n                                            <p className=\"text-[10px] text-muted-foreground line-clamp-2\">\r\n                                                \"{review.comment}\"\r\n                                            </p>\r\n                                        )}\r\n                                    </motion.div>\r\n                                ))}\r\n                            </div>\r\n                        )}\r\n                    </>\r\n                ) : (\r\n                    <div className=\"text-center py-6 text-muted-foreground\">\r\n                        <Star className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\r\n                        <p className=\"text-xs\">Sin datos de satisfacción</p>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </WidgetWrapper>\r\n    );\r\n}\r\n\r\n// ============================================================================\r\n// HELPERS\r\n// ============================================================================\r\n\r\n/**\r\n * Procesa ratings reales de Supabase.\r\n */\r\nfunction processRatings(ratings: any[]): SatisfactionStats {\r\n    const total = ratings.length;\r\n    const sum = ratings.reduce((acc, r) => acc + (r.rating || 0), 0);\r\n    const average = total > 0 ? sum / total : 0;\r\n\r\n    // Distribución por estrellas\r\n    const distribution = [5, 4, 3, 2, 1].map(stars => {\r\n        const count = ratings.filter(r => Math.round(r.rating) === stars).length;\r\n        return {\r\n            stars,\r\n            count,\r\n            percentage: total > 0 ? (count / total) * 100 : 0\r\n        };\r\n    });\r\n\r\n    // Calcular tendencia (últimos 30 días vs anteriores)\r\n    const now = new Date();\r\n    const thirtyDaysAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);\r\n    const sixtyDaysAgo = new Date(now.getTime() - 60 * 24 * 60 * 60 * 1000);\r\n\r\n    const recentRatings = ratings.filter(r =>\r\n        new Date(r.created_at) >= thirtyDaysAgo\r\n    );\r\n    const olderRatings = ratings.filter(r => {\r\n        const date = new Date(r.created_at);\r\n        return date >= sixtyDaysAgo && date < thirtyDaysAgo;\r\n    });\r\n\r\n    const recentAvg = recentRatings.length > 0\r\n        ? recentRatings.reduce((acc, r) => acc + (r.rating || 0), 0) / recentRatings.length\r\n        : average;\r\n    const olderAvg = olderRatings.length > 0\r\n        ? olderRatings.reduce((acc, r) => acc + (r.rating || 0), 0) / olderRatings.length\r\n        : recentAvg;\r\n\r\n    const trend = olderAvg > 0 ? ((recentAvg - olderAvg) / olderAvg) * 100 : 0;\r\n\r\n    // Reviews recientes con comentarios\r\n    const recentReviews = ratings\r\n        .filter(r => r.comment && r.comment.trim().length > 0)\r\n        .slice(0, 3)\r\n        .map(r => ({\r\n            id: r.id,\r\n            rating: r.rating,\r\n            comment: r.comment,\r\n            created_at: r.created_at,\r\n            patient_name: r.patient?.full_name || \"Paciente Anónimo\"\r\n        }));\r\n\r\n    return {\r\n        average,\r\n        total,\r\n        distribution,\r\n        trend,\r\n        recentReviews\r\n    };\r\n}\r\n\r\n/**\r\n * Genera estadísticas vacías cuando no hay datos.\r\n */\r\nfunction generateEmptyStats(): SatisfactionStats {\r\n    return {\r\n        average: 0,\r\n        total: 0,\r\n        distribution: [\r\n            { stars: 5, count: 0, percentage: 0 },\r\n            { stars: 4, count: 0, percentage: 0 },\r\n            { stars: 3, count: 0, percentage: 0 },\r\n            { stars: 2, count: 0, percentage: 0 },\r\n            { stars: 1, count: 0, percentage: 0 }\r\n        ],\r\n        trend: 0,\r\n        recentReviews: []\r\n    };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\dashboard\\widgets\\stats-overview-widget.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\dashboard\\widgets\\stats\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\dashboard\\widgets\\tasks-widget.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChevronRight' is defined but never used.","line":26,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file tasks-widget.tsx\r\n * @description Widget de tareas pendientes del médico con datos de Supabase.\r\n * Permite crear tareas con prioridad y fecha límite, completar, filtrar y eliminar.\r\n * \r\n * @module Dashboard/Widgets\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useState, useCallback, useMemo, useRef } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport {\r\n    CheckSquare,\r\n    Plus,\r\n    Check,\r\n    Trash2,\r\n    Clock,\r\n    AlertCircle,\r\n    AlertTriangle,\r\n    Zap,\r\n    Loader2,\r\n    X,\r\n    Calendar,\r\n    ChevronRight,\r\n    ExternalLink,\r\n} from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Popover, PopoverContent, PopoverTrigger } from \"@red-salud/ui\";\r\nimport { WidgetWrapper } from \"../widget-wrapper\";\r\nimport { useDashboardData } from \"@/hooks/use-dashboard-data\";\r\nimport {\r\n    createTask,\r\n    toggleTaskComplete,\r\n    deleteTask,\r\n} from \"@/lib/supabase/services/dashboard-preferences-service\";\r\nimport type { DoctorTask, TaskPriority } from \"@/lib/types/dashboard-types\";\r\n\r\n// ============================================================================\r\n// TIPOS\r\n// ============================================================================\r\n\r\ninterface TasksWidgetProps {\r\n    /** ID del médico */\r\n    doctorId?: string;\r\n    /** Si está siendo arrastrado */\r\n    isDragging?: boolean;\r\n}\r\n\r\n/** Tipo de filtro rápido */\r\ntype QuickFilter = 'all' | 'today' | 'week' | 'urgent';\r\n\r\n// ============================================================================\r\n// CONSTANTES Y HELPERS\r\n// ============================================================================\r\n\r\n/** Configuración de prioridades con iconos distintivos */\r\nconst PRIORITY_CONFIG: Record<TaskPriority, {\r\n    label: string;\r\n    shortLabel: string;\r\n    color: string;\r\n    bgColor: string;\r\n    hoverBg: string;\r\n    icon: typeof Clock;\r\n    description: string;\r\n}> = {\r\n    low: {\r\n        label: \"Baja\",\r\n        shortLabel: \"Baja\",\r\n        color: \"text-slate-500\",\r\n        bgColor: \"bg-slate-100 dark:bg-slate-800\",\r\n        hoverBg: \"hover:bg-slate-200 dark:hover:bg-slate-700\",\r\n        icon: Clock,\r\n        description: \"Sin prisa\",\r\n    },\r\n    medium: {\r\n        label: \"Media\",\r\n        shortLabel: \"Media\",\r\n        color: \"text-blue-600\",\r\n        bgColor: \"bg-blue-100 dark:bg-blue-900/50\",\r\n        hoverBg: \"hover:bg-blue-200 dark:hover:bg-blue-800\",\r\n        icon: AlertCircle,\r\n        description: \"Normal\",\r\n    },\r\n    high: {\r\n        label: \"Alta\",\r\n        shortLabel: \"Alta\",\r\n        color: \"text-orange-600\",\r\n        bgColor: \"bg-orange-100 dark:bg-orange-900/50\",\r\n        hoverBg: \"hover:bg-orange-200 dark:hover:bg-orange-800\",\r\n        icon: AlertTriangle,\r\n        description: \"Importante\",\r\n    },\r\n    urgent: {\r\n        label: \"Urgente\",\r\n        shortLabel: \"Urgente\",\r\n        color: \"text-red-600\",\r\n        bgColor: \"bg-red-100 dark:bg-red-900/50\",\r\n        hoverBg: \"hover:bg-red-200 dark:hover:bg-red-800\",\r\n        icon: Zap,\r\n        description: \"¡Ahora!\",\r\n    },\r\n};\r\n\r\n/** Orden de prioridades para ordenamiento */\r\nconst PRIORITY_ORDER: Record<TaskPriority, number> = {\r\n    urgent: 4,\r\n    high: 3,\r\n    medium: 2,\r\n    low: 1,\r\n};\r\n\r\n/** Opciones rápidas de fecha */\r\nconst QUICK_DATES = [\r\n    { label: \"Hoy\", getValue: () => new Date() },\r\n    { label: \"Mañana\", getValue: () => { const d = new Date(); d.setDate(d.getDate() + 1); return d; } },\r\n    { label: \"Esta semana\", getValue: () => { const d = new Date(); d.setDate(d.getDate() + (5 - d.getDay())); return d; } },\r\n    { label: \"Próxima semana\", getValue: () => { const d = new Date(); d.setDate(d.getDate() + 7); return d; } },\r\n];\r\n\r\n/**\r\n * Parsea una fecha string (YYYY-MM-DD) como hora LOCAL, no UTC.\r\n * Esto evita el bug donde \"2025-12-30\" se interpreta como UTC y\r\n * resulta en \"2025-12-29\" en zonas horarias negativas.\r\n */\r\nfunction parseLocalDate(dateString: string): Date {\r\n    // Forzar interpretación local agregando T00:00:00 sin Z\r\n    const [year, month, day] = dateString.split('-').map(Number);\r\n    return new Date(year, month - 1, day);\r\n}\r\n\r\n/**\r\n * Verifica si una tarea está vencida\r\n */\r\nfunction isOverdue(dueDate: string | null): boolean {\r\n    if (!dueDate) return false;\r\n    const today = new Date();\r\n    today.setHours(0, 0, 0, 0);\r\n    const due = parseLocalDate(dueDate);\r\n    return due < today;\r\n}\r\n\r\n/**\r\n * Verifica si la fecha límite es hoy\r\n */\r\nfunction isDueToday(dueDate: string | null): boolean {\r\n    if (!dueDate) return false;\r\n    const today = new Date();\r\n    const due = parseLocalDate(dueDate);\r\n    return today.toDateString() === due.toDateString();\r\n}\r\n\r\n/**\r\n * Verifica si la fecha límite es esta semana\r\n */\r\nfunction isDueThisWeek(dueDate: string | null): boolean {\r\n    if (!dueDate) return false;\r\n    const today = new Date();\r\n    const due = parseLocalDate(dueDate);\r\n    const weekEnd = new Date(today);\r\n    weekEnd.setDate(today.getDate() + (7 - today.getDay()));\r\n    return due <= weekEnd && due >= today;\r\n}\r\n\r\n/**\r\n * Formatea una fecha para mostrar\r\n */\r\nfunction formatDueDate(dueDate: string | null): string {\r\n    if (!dueDate) return \"\";\r\n    const date = parseLocalDate(dueDate);\r\n    const today = new Date();\r\n\r\n    if (date.toDateString() === today.toDateString()) {\r\n        return \"Hoy\";\r\n    }\r\n\r\n    const tomorrow = new Date(today);\r\n    tomorrow.setDate(today.getDate() + 1);\r\n    if (date.toDateString() === tomorrow.toDateString()) {\r\n        return \"Mañana\";\r\n    }\r\n\r\n    return date.toLocaleDateString(\"es\", { day: \"numeric\", month: \"short\" });\r\n}\r\n\r\n/**\r\n * Formatea fecha para input type=\"date\"\r\n */\r\nfunction formatDateForInput(date: Date): string {\r\n    const year = date.getFullYear();\r\n    const month = String(date.getMonth() + 1).padStart(2, '0');\r\n    const day = String(date.getDate()).padStart(2, '0');\r\n    return `${year}-${month}-${day}`;\r\n}\r\n\r\n// ============================================================================\r\n// COMPONENTES AUXILIARES\r\n// ============================================================================\r\n\r\n/**\r\n * Selector de prioridad mejorado con iconos grandes y labels\r\n */\r\nfunction PrioritySelector({\r\n    value,\r\n    onChange,\r\n}: {\r\n    value: TaskPriority;\r\n    onChange: (priority: TaskPriority) => void;\r\n}) {\r\n    const priorities: TaskPriority[] = ['low', 'medium', 'high', 'urgent'];\r\n\r\n    return (\r\n        <div className=\"grid grid-cols-4 gap-1.5\">\r\n            {priorities.map((p) => {\r\n                const config = PRIORITY_CONFIG[p];\r\n                const isSelected = value === p;\r\n                return (\r\n                    <button\r\n                        key={p}\r\n                        type=\"button\"\r\n                        onClick={() => onChange(p)}\r\n                        className={cn(\r\n                            \"flex flex-col items-center gap-1 p-2 rounded-lg transition-all border-2\",\r\n                            isSelected\r\n                                ? `${config.bgColor} ${config.color} border-current`\r\n                                : \"bg-muted/30 text-muted-foreground border-transparent hover:bg-muted/50\"\r\n                        )}\r\n                        title={config.description}\r\n                    >\r\n                        <config.icon className=\"h-4 w-4\" />\r\n                        <span className=\"text-[10px] font-medium\">{config.shortLabel}</span>\r\n                    </button>\r\n                );\r\n            })}\r\n        </div>\r\n    );\r\n}\r\n\r\n/**\r\n * Selector de fecha mejorado con opciones rápidas\r\n */\r\nfunction DateSelector({\r\n    value,\r\n    onChange,\r\n}: {\r\n    value: string;\r\n    onChange: (date: string) => void;\r\n}) {\r\n    const [isOpen, setIsOpen] = useState(false);\r\n\r\n    const handleQuickDate = (date: Date) => {\r\n        onChange(formatDateForInput(date));\r\n        setIsOpen(false);\r\n    };\r\n\r\n    const handleClear = () => {\r\n        onChange(\"\");\r\n        setIsOpen(false);\r\n    };\r\n\r\n    const displayValue = value ? formatDueDate(value) : null;\r\n\r\n    return (\r\n        <Popover open={isOpen} onOpenChange={setIsOpen}>\r\n            <PopoverTrigger asChild>\r\n                <button\r\n                    type=\"button\"\r\n                    className={cn(\r\n                        \"flex items-center gap-2 px-3 py-2 rounded-lg border transition-all text-sm\",\r\n                        value\r\n                            ? \"bg-primary/10 border-primary/30 text-primary\"\r\n                            : \"bg-muted/30 border-muted text-muted-foreground hover:bg-muted/50\"\r\n                    )}\r\n                >\r\n                    <Calendar className=\"h-4 w-4\" />\r\n                    <span>{displayValue || \"Fecha límite\"}</span>\r\n                </button>\r\n            </PopoverTrigger>\r\n            <PopoverContent className=\"w-56 p-2\" align=\"start\">\r\n                <div className=\"space-y-2\">\r\n                    {/* Opciones rápidas */}\r\n                    <div className=\"space-y-1\">\r\n                        {QUICK_DATES.map((option) => (\r\n                            <button\r\n                                key={option.label}\r\n                                type=\"button\"\r\n                                onClick={() => handleQuickDate(option.getValue())}\r\n                                className=\"w-full flex items-center gap-2 px-3 py-2 rounded-md text-sm hover:bg-muted transition-colors text-left\"\r\n                            >\r\n                                <Calendar className=\"h-4 w-4 text-muted-foreground\" />\r\n                                {option.label}\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n\r\n                    <div className=\"border-t pt-2\">\r\n                        {/* Selector de fecha manual */}\r\n                        <Input\r\n                            type=\"date\"\r\n                            value={value}\r\n                            onChange={(e) => {\r\n                                onChange(e.target.value);\r\n                                setIsOpen(false);\r\n                            }}\r\n                            className=\"w-full text-sm\"\r\n                        />\r\n                    </div>\r\n\r\n                    {value && (\r\n                        <Button\r\n                            variant=\"ghost\"\r\n                            size=\"sm\"\r\n                            className=\"w-full text-muted-foreground\"\r\n                            onClick={handleClear}\r\n                        >\r\n                            <X className=\"h-3 w-3 mr-1\" />\r\n                            Sin fecha límite\r\n                        </Button>\r\n                    )}\r\n                </div>\r\n            </PopoverContent>\r\n        </Popover>\r\n    );\r\n}\r\n\r\n/**\r\n * Formulario mejorado para nueva tarea\r\n */\r\nfunction NewTaskForm({\r\n    onSubmit,\r\n    onCancel,\r\n    isSubmitting,\r\n}: {\r\n    onSubmit: (title: string, priority: TaskPriority, dueDate: string) => void;\r\n    onCancel: () => void;\r\n    isSubmitting: boolean;\r\n}) {\r\n    const [title, setTitle] = useState(\"\");\r\n    const [priority, setPriority] = useState<TaskPriority>(\"medium\");\r\n    const [dueDate, setDueDate] = useState(\"\");\r\n    const inputRef = useRef<HTMLInputElement>(null);\r\n\r\n    const handleSubmit = () => {\r\n        if (title.trim()) {\r\n            onSubmit(title.trim(), priority, dueDate);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <motion.div\r\n            initial={{ opacity: 0, height: 0 }}\r\n            animate={{ opacity: 1, height: \"auto\" }}\r\n            exit={{ opacity: 0, height: 0 }}\r\n            className=\"space-y-3 p-3 rounded-xl bg-gradient-to-br from-muted/50 to-muted/30 border border-border/50\"\r\n        >\r\n            {/* Título */}\r\n            <Input\r\n                ref={inputRef}\r\n                placeholder=\"¿Qué necesitas hacer?\"\r\n                value={title}\r\n                onChange={(e) => setTitle(e.target.value)}\r\n                onKeyDown={(e) => e.key === \"Enter\" && handleSubmit()}\r\n                className=\"h-10 text-sm bg-background\"\r\n                autoFocus\r\n                disabled={isSubmitting}\r\n            />\r\n\r\n            {/* Prioridad */}\r\n            <div>\r\n                <label className=\"text-[10px] uppercase tracking-wide text-muted-foreground mb-1.5 block font-medium\">\r\n                    Prioridad\r\n                </label>\r\n                <PrioritySelector value={priority} onChange={setPriority} />\r\n            </div>\r\n\r\n            {/* Fecha y acciones */}\r\n            <div className=\"flex items-center justify-between gap-2\">\r\n                <DateSelector value={dueDate} onChange={setDueDate} />\r\n\r\n                <div className=\"flex gap-1.5\">\r\n                    <Button\r\n                        variant=\"ghost\"\r\n                        size=\"sm\"\r\n                        onClick={onCancel}\r\n                        disabled={isSubmitting}\r\n                        className=\"h-9 px-3\"\r\n                    >\r\n                        Cancelar\r\n                    </Button>\r\n                    <Button\r\n                        size=\"sm\"\r\n                        onClick={handleSubmit}\r\n                        disabled={!title.trim() || isSubmitting}\r\n                        className=\"h-9 px-4 gap-1.5\"\r\n                    >\r\n                        {isSubmitting ? (\r\n                            <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                        ) : (\r\n                            <>\r\n                                <Plus className=\"h-4 w-4\" />\r\n                                Agregar\r\n                            </>\r\n                        )}\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n        </motion.div>\r\n    );\r\n}\r\n\r\n/**\r\n * Item de tarea individual\r\n */\r\nfunction TaskItem({\r\n    task,\r\n    onToggle,\r\n    onDelete,\r\n    index\r\n}: {\r\n    task: DoctorTask;\r\n    onToggle: (taskId: string, currentState: boolean) => void;\r\n    onDelete: (taskId: string) => void;\r\n    index: number;\r\n}) {\r\n    const config = PRIORITY_CONFIG[task.priority];\r\n    const overdue = isOverdue(task.due_date);\r\n    const dueToday = isDueToday(task.due_date);\r\n\r\n    return (\r\n        <motion.div\r\n            initial={{ opacity: 0, x: -10 }}\r\n            animate={{ opacity: 1, x: 0 }}\r\n            exit={{ opacity: 0, x: 10, height: 0 }}\r\n            transition={{ delay: index * 0.02 }}\r\n            className={cn(\r\n                \"flex items-center gap-2 p-2 rounded-lg group\",\r\n                \"bg-muted/30 hover:bg-muted/50 transition-colors\",\r\n                overdue && !task.is_completed && \"bg-red-500/5 border border-red-500/20\"\r\n            )}\r\n        >\r\n            {/* Checkbox */}\r\n            <button\r\n                className={cn(\r\n                    \"flex items-center justify-center w-5 h-5 rounded-md border-2 transition-all flex-shrink-0\",\r\n                    task.is_completed\r\n                        ? \"bg-primary border-primary\"\r\n                        : \"border-muted-foreground/30 hover:border-primary hover:bg-primary/10\"\r\n                )}\r\n                onClick={() => onToggle(task.id, task.is_completed)}\r\n            >\r\n                {task.is_completed && (\r\n                    <Check className=\"h-3 w-3 text-primary-foreground\" />\r\n                )}\r\n            </button>\r\n\r\n            {/* Content */}\r\n            <div className=\"flex-1 min-w-0\">\r\n                <p\r\n                    className={cn(\r\n                        \"text-xs truncate\",\r\n                        task.is_completed && \"line-through text-muted-foreground\"\r\n                    )}\r\n                >\r\n                    {task.title}\r\n                </p>\r\n                {task.due_date && !task.is_completed && (\r\n                    <div className={cn(\r\n                        \"flex items-center gap-1 mt-0.5\",\r\n                        overdue ? \"text-red-500\" : dueToday ? \"text-orange-500\" : \"text-muted-foreground\"\r\n                    )}>\r\n                        <Calendar className=\"h-2.5 w-2.5\" />\r\n                        <span className=\"text-[10px]\">\r\n                            {overdue ? \"Vencida\" : formatDueDate(task.due_date)}\r\n                        </span>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Priority indicator */}\r\n            <div\r\n                className={cn(\r\n                    \"flex items-center justify-center w-5 h-5 rounded flex-shrink-0\",\r\n                    config.bgColor,\r\n                    config.color\r\n                )}\r\n                title={config.label}\r\n            >\r\n                <config.icon className=\"h-3 w-3\" />\r\n            </div>\r\n\r\n            {/* Delete button */}\r\n            <button\r\n                className=\"opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0\"\r\n                onClick={() => onDelete(task.id)}\r\n            >\r\n                <Trash2 className=\"h-3 w-3 text-muted-foreground hover:text-destructive transition-colors\" />\r\n            </button>\r\n        </motion.div>\r\n    );\r\n}\r\n\r\n// ============================================================================\r\n// COMPONENTE PRINCIPAL\r\n// ============================================================================\r\n\r\n/**\r\n * Widget de tareas pendientes mejorado.\r\n * Permite crear tareas con prioridad y fecha límite, filtrar y gestionar.\r\n * \r\n * @example\r\n * <TasksWidget doctorId=\"uuid-del-doctor\" />\r\n */\r\nexport function TasksWidget({\r\n    doctorId,\r\n    isDragging,\r\n}: TasksWidgetProps) {\r\n    const router = useRouter();\r\n\r\n    // Estado local\r\n    const [isAdding, setIsAdding] = useState(false);\r\n    const [isSubmitting, setIsSubmitting] = useState(false);\r\n    const [activeFilter, setActiveFilter] = useState<QuickFilter>(\"all\");\r\n\r\n    // Datos del dashboard\r\n    const { tasks, isLoading, refresh } = useDashboardData(doctorId);\r\n\r\n    // Filtrar y ordenar tareas\r\n    const filteredTasks = useMemo(() => {\r\n        let filtered = tasks.filter((t) => !t.is_completed);\r\n\r\n        // Aplicar filtro activo\r\n        switch (activeFilter) {\r\n            case 'today':\r\n                filtered = filtered.filter((t) => isDueToday(t.due_date));\r\n                break;\r\n            case 'week':\r\n                filtered = filtered.filter((t) => isDueThisWeek(t.due_date));\r\n                break;\r\n            case 'urgent':\r\n                filtered = filtered.filter((t) => t.priority === 'urgent' || t.priority === 'high');\r\n                break;\r\n        }\r\n\r\n        // Ordenar: vencidas primero, luego por prioridad, luego por fecha\r\n        return filtered.sort((a, b) => {\r\n            // Vencidas primero\r\n            const aOverdue = isOverdue(a.due_date);\r\n            const bOverdue = isOverdue(b.due_date);\r\n            if (aOverdue && !bOverdue) return -1;\r\n            if (!aOverdue && bOverdue) return 1;\r\n\r\n            // Luego por prioridad\r\n            const priorityDiff = PRIORITY_ORDER[b.priority] - PRIORITY_ORDER[a.priority];\r\n            if (priorityDiff !== 0) return priorityDiff;\r\n\r\n            // Luego por fecha límite\r\n            if (a.due_date && b.due_date) {\r\n                return new Date(a.due_date).getTime() - new Date(b.due_date).getTime();\r\n            }\r\n            if (a.due_date) return -1;\r\n            if (b.due_date) return 1;\r\n\r\n            return 0;\r\n        });\r\n    }, [tasks, activeFilter]);\r\n\r\n    // Estadísticas rápidas\r\n    const stats = useMemo(() => {\r\n        const pending = tasks.filter((t) => !t.is_completed);\r\n        return {\r\n            total: pending.length,\r\n            overdue: pending.filter((t) => isOverdue(t.due_date)).length,\r\n            urgent: pending.filter((t) => t.priority === 'urgent' || t.priority === 'high').length,\r\n        };\r\n    }, [tasks]);\r\n\r\n    // Handler para agregar tarea\r\n    const handleAddTask = useCallback(async (title: string, priority: TaskPriority, dueDate: string) => {\r\n        if (!doctorId) return;\r\n\r\n        setIsSubmitting(true);\r\n        try {\r\n            await createTask(doctorId, {\r\n                title,\r\n                priority,\r\n                due_date: dueDate || undefined,\r\n            });\r\n            setIsAdding(false);\r\n            refresh();\r\n        } catch (error) {\r\n            console.error(\"[TasksWidget] Error creating task:\", error);\r\n        } finally {\r\n            setIsSubmitting(false);\r\n        }\r\n    }, [doctorId, refresh]);\r\n\r\n    // Handler para completar tarea\r\n    const handleToggleComplete = useCallback(\r\n        async (taskId: string, currentState: boolean) => {\r\n            try {\r\n                await toggleTaskComplete(taskId, !currentState);\r\n                refresh();\r\n            } catch (error) {\r\n                console.error(\"[TasksWidget] Error toggling task:\", error);\r\n            }\r\n        },\r\n        [refresh]\r\n    );\r\n\r\n    // Handler para eliminar tarea\r\n    const handleDelete = useCallback(\r\n        async (taskId: string) => {\r\n            try {\r\n                await deleteTask(taskId);\r\n                refresh();\r\n            } catch (error) {\r\n                console.error(\"[TasksWidget] Error deleting task:\", error);\r\n            }\r\n        },\r\n        [refresh]\r\n    );\r\n\r\n    // Navegar a página de tareas\r\n    const handleViewAll = useCallback(() => {\r\n        router.push(\"/dashboard/medico/tareas\");\r\n    }, [router]);\r\n\r\n    return (\r\n        <WidgetWrapper\r\n            id=\"tasks\"\r\n            title=\"Tareas\"\r\n            icon={<CheckSquare className=\"h-4 w-4 text-primary\" />}\r\n            isDragging={isDragging}\r\n            showControls={false}\r\n        >\r\n            <div className=\"space-y-3\">\r\n                {/* Estado de carga */}\r\n                {isLoading ? (\r\n                    <div className=\"flex items-center justify-center py-8\">\r\n                        <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\r\n                    </div>\r\n                ) : (\r\n                    <>\r\n                        {/* Header con estadísticas y acciones */}\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <Badge variant=\"secondary\" className=\"text-[10px]\">\r\n                                    {stats.total} pendientes\r\n                                </Badge>\r\n                                {stats.overdue > 0 && (\r\n                                    <Badge variant=\"destructive\" className=\"text-[10px]\">\r\n                                        {stats.overdue} vencidas\r\n                                    </Badge>\r\n                                )}\r\n                            </div>\r\n                            <div className=\"flex items-center gap-1\">\r\n                                <Button\r\n                                    variant=\"ghost\"\r\n                                    size=\"sm\"\r\n                                    className=\"h-6 w-6 p-0\"\r\n                                    onClick={handleViewAll}\r\n                                    title=\"Ver todas las tareas\"\r\n                                >\r\n                                    <ExternalLink className=\"h-3.5 w-3.5\" />\r\n                                </Button>\r\n                                <Button\r\n                                    variant=\"ghost\"\r\n                                    size=\"sm\"\r\n                                    className=\"h-6 text-xs gap-1\"\r\n                                    onClick={() => setIsAdding(true)}\r\n                                >\r\n                                    <Plus className=\"h-3 w-3\" />\r\n                                    Nueva\r\n                                </Button>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Filtros rápidos */}\r\n                        <div className=\"flex gap-1\">\r\n                            {[\r\n                                { id: 'all' as QuickFilter, label: 'Todas' },\r\n                                { id: 'today' as QuickFilter, label: 'Hoy' },\r\n                                { id: 'week' as QuickFilter, label: 'Semana' },\r\n                                { id: 'urgent' as QuickFilter, label: 'Urgentes' },\r\n                            ].map((filter) => (\r\n                                <Button\r\n                                    key={filter.id}\r\n                                    variant={activeFilter === filter.id ? \"default\" : \"ghost\"}\r\n                                    size=\"sm\"\r\n                                    className={cn(\r\n                                        \"h-6 text-[10px] px-2\",\r\n                                        activeFilter === filter.id && \"bg-primary/90\"\r\n                                    )}\r\n                                    onClick={() => setActiveFilter(filter.id)}\r\n                                >\r\n                                    {filter.label}\r\n                                </Button>\r\n                            ))}\r\n                        </div>\r\n\r\n                        {/* Formulario para nueva tarea */}\r\n                        <AnimatePresence>\r\n                            {isAdding && (\r\n                                <NewTaskForm\r\n                                    onSubmit={handleAddTask}\r\n                                    onCancel={() => setIsAdding(false)}\r\n                                    isSubmitting={isSubmitting}\r\n                                />\r\n                            )}\r\n                        </AnimatePresence>\r\n\r\n                        {/* Lista de tareas */}\r\n                        <div className=\"space-y-1.5 max-h-[200px] overflow-y-auto pr-1 scrollbar-thin\">\r\n                            <AnimatePresence mode=\"popLayout\">\r\n                                {filteredTasks.length > 0 ? (\r\n                                    filteredTasks.slice(0, 6).map((task, index) => (\r\n                                        <TaskItem\r\n                                            key={task.id}\r\n                                            task={task}\r\n                                            onToggle={handleToggleComplete}\r\n                                            onDelete={handleDelete}\r\n                                            index={index}\r\n                                        />\r\n                                    ))\r\n                                ) : (\r\n                                    <motion.div\r\n                                        initial={{ opacity: 0 }}\r\n                                        animate={{ opacity: 1 }}\r\n                                        className=\"text-center py-6 text-muted-foreground\"\r\n                                    >\r\n                                        <CheckSquare className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\r\n                                        <p className=\"text-xs\">\r\n                                            {activeFilter !== 'all'\r\n                                                ? \"Sin tareas en este filtro\"\r\n                                                : \"No hay tareas pendientes\"}\r\n                                        </p>\r\n                                        {activeFilter === 'all' && (\r\n                                            <Button\r\n                                                variant=\"link\"\r\n                                                className=\"text-xs mt-1\"\r\n                                                onClick={() => setIsAdding(true)}\r\n                                            >\r\n                                                Agregar una tarea\r\n                                            </Button>\r\n                                        )}\r\n                                    </motion.div>\r\n                                )}\r\n                            </AnimatePresence>\r\n                        </div>\r\n\r\n                        {/* Botón para ver todas */}\r\n                        <Button\r\n                            variant=\"outline\"\r\n                            size=\"sm\"\r\n                            className=\"w-full h-8 text-xs gap-1.5 mt-2\"\r\n                            onClick={handleViewAll}\r\n                        >\r\n                            <ExternalLink className=\"h-3.5 w-3.5\" />\r\n                            Ver todas las tareas\r\n                            {stats.total > 0 && (\r\n                                <Badge variant=\"secondary\" className=\"ml-1 text-[10px]\">\r\n                                    {stats.total}\r\n                                </Badge>\r\n                            )}\r\n                        </Button>\r\n                    </>\r\n                )}\r\n            </div>\r\n        </WidgetWrapper>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\dashboard\\widgets\\tasks\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\dashboard\\widgets\\tasks\\task-constants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\dashboard\\widgets\\today-timeline-widget.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'User' is defined but never used.","line":18,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":9}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file today-timeline-widget.tsx\r\n * @description Widget de timeline de citas del día con datos reales de Supabase.\r\n * Muestra las citas programadas para hoy con estados en tiempo real.\r\n * \r\n * @module Dashboard/Widgets\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useMemo } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { motion } from \"framer-motion\";\r\nimport {\r\n    Calendar,\r\n    Clock,\r\n    Video,\r\n    User,\r\n    ChevronRight,\r\n    Play,\r\n    CheckCircle2,\r\n    Loader2,\r\n    XCircle\r\n} from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@red-salud/ui\";\r\nimport { WidgetWrapper } from \"../widget-wrapper\";\r\nimport { useDashboardData, type TodayAppointment } from \"@/hooks/use-dashboard-data\";\r\n\r\n// ============================================================================\r\n// TIPOS\r\n// ============================================================================\r\n\r\ninterface TodayTimelineWidgetProps {\r\n    /** ID del médico para obtener sus citas */\r\n    doctorId?: string;\r\n    /** Si el widget está siendo arrastrado */\r\n    isDragging?: boolean;\r\n    /** Ref para el handle de arrastre */\r\n    /** Listeners para el handle de arrastre */\r\n    /** Atributos para el handle de arrastre */\r\n}\r\n\r\n// ============================================================================\r\n// COMPONENTE DE ITEM DE TIMELINE\r\n// ============================================================================\r\n\r\n/**\r\n * Item individual en el timeline de citas.\r\n */\r\nfunction TimelineItem({\r\n    appointment,\r\n    index,\r\n    onStartConsultation\r\n}: {\r\n    appointment: TodayAppointment;\r\n    index: number;\r\n    onStartConsultation?: (id: string) => void;\r\n}) {\r\n    const isActive = appointment.status === \"in-progress\";\r\n    const isCompleted = appointment.status === \"completed\";\r\n    const isPending = appointment.status === \"pending\";\r\n    const isCancelled = appointment.status === \"cancelled\";\r\n\r\n    return (\r\n        <motion.div\r\n            initial={{ opacity: 0, x: -20 }}\r\n            animate={{ opacity: 1, x: 0 }}\r\n            transition={{ delay: index * 0.08 }}\r\n            className={cn(\r\n                \"relative flex items-start gap-3 pl-6 pb-4\",\r\n                \"border-l-2 last:border-l-0 last:pb-0\",\r\n                isActive && \"border-primary\",\r\n                isCompleted && \"border-green-500\",\r\n                isCancelled && \"border-red-300\",\r\n                isPending && \"border-border\"\r\n            )}\r\n        >\r\n            {/* Timeline Dot */}\r\n            <div\r\n                className={cn(\r\n                    \"absolute left-0 -translate-x-1/2 w-3 h-3 rounded-full border-2\",\r\n                    isActive && \"bg-primary border-primary animate-pulse\",\r\n                    isCompleted && \"bg-green-500 border-green-500\",\r\n                    isCancelled && \"bg-red-400 border-red-400\",\r\n                    isPending && \"bg-background border-muted-foreground\"\r\n                )}\r\n            />\r\n\r\n            {/* Content */}\r\n            <div className=\"flex-1 min-w-0\">\r\n                <div className=\"flex items-center gap-2 mb-1\">\r\n                    <span className=\"text-sm font-mono font-medium text-foreground\">\r\n                        {appointment.time}\r\n                    </span>\r\n                    {appointment.type === \"telemedicina\" && (\r\n                        <Badge variant=\"secondary\" className=\"text-[10px] px-1.5 py-0 gap-1\">\r\n                            <Video className=\"h-2.5 w-2.5\" />\r\n                            Video\r\n                        </Badge>\r\n                    )}\r\n                    {isActive && (\r\n                        <Badge className=\"text-[10px] px-1.5 py-0 bg-primary animate-pulse\">\r\n                            En curso\r\n                        </Badge>\r\n                    )}\r\n                    {isCancelled && (\r\n                        <Badge variant=\"destructive\" className=\"text-[10px] px-1.5 py-0\">\r\n                            Cancelada\r\n                        </Badge>\r\n                    )}\r\n                </div>\r\n\r\n                <div className=\"flex items-center justify-between gap-2\">\r\n                    <div className=\"flex items-center gap-2 min-w-0\">\r\n                        {/* Avatar del paciente */}\r\n                        <Avatar className=\"h-6 w-6\">\r\n                            {appointment.patientAvatar ? (\r\n                                <AvatarImage src={appointment.patientAvatar} alt={appointment.patient} />\r\n                            ) : null}\r\n                            <AvatarFallback className=\"text-[10px] bg-muted\">\r\n                                {appointment.patient.split(\" \").map(n => n[0]).join(\"\").slice(0, 2)}\r\n                            </AvatarFallback>\r\n                        </Avatar>\r\n\r\n                        <div className=\"min-w-0\">\r\n                            <span className={cn(\r\n                                \"text-sm truncate block\",\r\n                                isCompleted && \"text-muted-foreground line-through\",\r\n                                isCancelled && \"text-muted-foreground line-through\",\r\n                                isActive && \"font-medium text-foreground\",\r\n                                isPending && \"text-foreground\"\r\n                            )}>\r\n                                {appointment.patient}\r\n                            </span>\r\n                            {appointment.motivo && (\r\n                                <span className=\"text-[10px] text-muted-foreground truncate block\">\r\n                                    {appointment.motivo}\r\n                                </span>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Action Button */}\r\n                    {isActive && (\r\n                        <Button\r\n                            size=\"sm\"\r\n                            className=\"h-6 text-xs gap-1\"\r\n                            onClick={() => onStartConsultation?.(appointment.id)}\r\n                        >\r\n                            <Play className=\"h-3 w-3\" />\r\n                            Consultar\r\n                        </Button>\r\n                    )}\r\n                    {isCompleted && (\r\n                        <CheckCircle2 className=\"h-4 w-4 text-green-500 flex-shrink-0\" />\r\n                    )}\r\n                    {isCancelled && (\r\n                        <XCircle className=\"h-4 w-4 text-red-400 flex-shrink-0\" />\r\n                    )}\r\n                    {isPending && (\r\n                        <Button variant=\"ghost\" size=\"sm\" className=\"h-6 w-6 p-0\">\r\n                            <ChevronRight className=\"h-4 w-4\" />\r\n                        </Button>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </motion.div>\r\n    );\r\n}\r\n\r\n// ============================================================================\r\n// COMPONENTE PRINCIPAL\r\n// ============================================================================\r\n\r\n/**\r\n * Widget de citas del día.\r\n * Muestra un timeline con todas las citas programadas para hoy,\r\n * con estados de completado, en progreso y pendiente.\r\n * \r\n * @example\r\n * <TodayTimelineWidget doctorId=\"uuid-del-doctor\" />\r\n */\r\nexport function TodayTimelineWidget({\r\n    doctorId,\r\n    isDragging\r\n}: TodayTimelineWidgetProps) {\r\n    const router = useRouter();\r\n\r\n    // Obtener datos reales del dashboard\r\n    const { todayAppointments, isLoading } = useDashboardData(doctorId);\r\n\r\n    // Calcular estadísticas\r\n    const stats = useMemo(() => {\r\n        const completed = todayAppointments.filter(a => a.status === \"completed\").length;\r\n        const cancelled = todayAppointments.filter(a => a.status === \"cancelled\").length;\r\n        const total = todayAppointments.length - cancelled; // No contar canceladas en el total\r\n        const inProgress = todayAppointments.find(a => a.status === \"in-progress\");\r\n        const nextPending = todayAppointments.find(a => a.status === \"pending\");\r\n\r\n        return { completed, total, inProgress, nextPending };\r\n    }, [todayAppointments]);\r\n\r\n    // Handler para iniciar consulta\r\n    const handleStartConsultation = (appointmentId: string) => {\r\n        router.push(`/dashboard/medico/consulta/${appointmentId}`);\r\n    };\r\n\r\n    return (\r\n        <WidgetWrapper\r\n            id=\"today-timeline\"\r\n            title=\"Citas de Hoy\"\r\n            icon={<Calendar className=\"h-4 w-4 text-primary\" />}\r\n            isDragging={isDragging}\r\n            showControls={false}\r\n        >\r\n            <div className=\"space-y-4\">\r\n                {/* Estado de carga */}\r\n                {isLoading ? (\r\n                    <div className=\"flex items-center justify-center py-8\">\r\n                        <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\r\n                    </div>\r\n                ) : (\r\n                    <>\r\n                        {/* Progress Summary */}\r\n                        <div className=\"flex items-center justify-between text-xs\">\r\n                            <span className=\"text-muted-foreground\">\r\n                                {stats.completed}/{stats.total} completadas\r\n                            </span>\r\n                            <div className=\"flex items-center gap-1 text-muted-foreground\">\r\n                                <Clock className=\"h-3 w-3\" />\r\n                                {stats.nextPending ? (\r\n                                    <span>Próxima: {stats.nextPending.time}</span>\r\n                                ) : stats.inProgress ? (\r\n                                    <span className=\"text-primary\">En consulta</span>\r\n                                ) : (\r\n                                    <span>Sin citas pendientes</span>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Progress Bar */}\r\n                        <div className=\"h-1.5 rounded-full bg-muted overflow-hidden\">\r\n                            <motion.div\r\n                                initial={{ width: 0 }}\r\n                                animate={{\r\n                                    width: stats.total > 0\r\n                                        ? `${(stats.completed / stats.total) * 100}%`\r\n                                        : \"0%\"\r\n                                }}\r\n                                transition={{ duration: 1, ease: \"easeOut\" }}\r\n                                className=\"h-full rounded-full bg-gradient-to-r from-green-500 to-emerald-500\"\r\n                            />\r\n                        </div>\r\n\r\n                        {/* Timeline */}\r\n                        <div className=\"space-y-0 max-h-[280px] overflow-y-auto pr-2 scrollbar-thin\">\r\n                            {todayAppointments.length > 0 ? (\r\n                                todayAppointments.map((appointment, index) => (\r\n                                    <TimelineItem\r\n                                        key={appointment.id}\r\n                                        appointment={appointment}\r\n                                        index={index}\r\n                                        onStartConsultation={handleStartConsultation}\r\n                                    />\r\n                                ))\r\n                            ) : (\r\n                                <motion.div\r\n                                    initial={{ opacity: 0 }}\r\n                                    animate={{ opacity: 1 }}\r\n                                    className=\"text-center py-8 text-muted-foreground\"\r\n                                >\r\n                                    <Calendar className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\r\n                                    <p className=\"text-sm\">No hay citas programadas para hoy</p>\r\n                                    <Button\r\n                                        variant=\"link\"\r\n                                        className=\"text-xs mt-1\"\r\n                                        onClick={() => router.push(\"/dashboard/medico/citas/nueva\")}\r\n                                    >\r\n                                        Programar una cita\r\n                                    </Button>\r\n                                </motion.div>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* View All Button */}\r\n                        {todayAppointments.length > 0 && (\r\n                            <Button variant=\"outline\" className=\"w-full text-xs h-8\" asChild>\r\n                                <a href=\"/dashboard/medico/citas\">\r\n                                    Ver agenda completa\r\n                                    <ChevronRight className=\"h-3 w-3 ml-1\" />\r\n                                </a>\r\n                            </Button>\r\n                        )}\r\n                    </>\r\n                )}\r\n            </div>\r\n        </WidgetWrapper>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\dashboard\\widgets\\upcoming-telemedicine-widget.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'User' is defined but never used.","line":20,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used.","line":21,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleViewPatient' is assigned a value but never used.","line":156,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":156,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file upcoming-telemedicine-widget.tsx\r\n * @description Widget de próximas videoconsultas del día.\r\n * Muestra las citas de telemedicina con acceso rápido a iniciar videollamada.\r\n * \r\n * @module Dashboard/Widgets\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useMemo } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { motion } from \"framer-motion\";\r\nimport {\r\n    Video,\r\n    Clock,\r\n    ChevronRight,\r\n    Loader2,\r\n    Play,\r\n    User,\r\n    Calendar,\r\n    VideoOff\r\n} from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@red-salud/ui\";\r\nimport { WidgetWrapper } from \"../widget-wrapper\";\r\nimport { useDashboardData } from \"@/hooks/use-dashboard-data\";\r\n\r\n// ============================================================================\r\n// TIPOS\r\n// ============================================================================\r\n\r\ninterface UpcomingTelemedicineWidgetProps {\r\n    /** ID del médico */\r\n    doctorId?: string;\r\n    /** Si está siendo arrastrado */\r\n    isDragging?: boolean;\r\n}\r\n\r\ninterface TelemedicineAppointment {\r\n    /** ID de la cita */\r\n    id: string;\r\n    /** Hora de la cita (HH:mm) */\r\n    time: string;\r\n    /** Nombre del paciente */\r\n    patientName: string;\r\n    /** ID del paciente */\r\n    patientId: string;\r\n    /** Avatar del paciente */\r\n    patientAvatar?: string;\r\n    /** Motivo de consulta */\r\n    reason?: string;\r\n    /** Estado de la cita */\r\n    status: \"pending\" | \"in-progress\" | \"completed\" | \"cancelled\";\r\n    /** URL de la videollamada */\r\n    meetingUrl?: string;\r\n    /** Minutos hasta la cita (negativo si ya pasó) */\r\n    minutesUntil: number;\r\n}\r\n\r\n// ============================================================================\r\n// HELPERS\r\n// ============================================================================\r\n\r\n/**\r\n * Obtiene las iniciales de un nombre.\r\n */\r\nfunction getInitials(name: string): string {\r\n    return name\r\n        .split(\" \")\r\n        .map(n => n[0])\r\n        .join(\"\")\r\n        .slice(0, 2)\r\n        .toUpperCase();\r\n}\r\n\r\n/**\r\n * Calcula los minutos hasta una hora específica.\r\n */\r\nfunction calculateMinutesUntil(time: string): number {\r\n    const now = new Date();\r\n    const [hours, minutes] = time.split(\":\").map(Number);\r\n    const aptTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hours, minutes);\r\n    return Math.floor((aptTime.getTime() - now.getTime()) / 60000);\r\n}\r\n\r\n/**\r\n * Formatea el tiempo restante para mostrar.\r\n */\r\nfunction formatTimeUntil(minutes: number): string {\r\n    if (minutes < -30) return \"Atrasada\";\r\n    if (minutes < 0) return \"Ahora\";\r\n    if (minutes < 60) return `En ${minutes} min`;\r\n    const hours = Math.floor(minutes / 60);\r\n    const mins = minutes % 60;\r\n    return mins > 0 ? `En ${hours}h ${mins}m` : `En ${hours}h`;\r\n}\r\n\r\n/**\r\n * Obtiene el estado visual basado en minutos hasta la cita.\r\n */\r\nfunction getTimeStatus(minutes: number): { color: string; urgent: boolean } {\r\n    if (minutes < 0) return { color: \"text-amber-600 dark:text-amber-400\", urgent: true };\r\n    if (minutes <= 15) return { color: \"text-red-600 dark:text-red-400\", urgent: true };\r\n    if (minutes <= 30) return { color: \"text-amber-600 dark:text-amber-400\", urgent: false };\r\n    return { color: \"text-muted-foreground\", urgent: false };\r\n}\r\n\r\n// ============================================================================\r\n// COMPONENTE PRINCIPAL\r\n// ============================================================================\r\n\r\n/**\r\n * Widget de próximas videoconsultas.\r\n * Muestra las citas de telemedicina del día con acceso rápido.\r\n * \r\n * @example\r\n * <UpcomingTelemedicineWidget doctorId=\"uuid-del-doctor\" />\r\n */\r\nexport function UpcomingTelemedicineWidget({\r\n    doctorId,\r\n    isDragging\r\n}: UpcomingTelemedicineWidgetProps) {\r\n    const router = useRouter();\r\n    const { todayAppointments, isLoading } = useDashboardData(doctorId);\r\n\r\n    // Filtrar solo citas de telemedicina pendientes o en progreso\r\n    const telemedicineCitas = useMemo<TelemedicineAppointment[]>(() => {\r\n        return todayAppointments\r\n            .filter(apt =>\r\n                apt.type === \"telemedicina\" &&\r\n                (apt.status === \"pending\" || apt.status === \"in-progress\")\r\n            )\r\n            .map(apt => ({\r\n                id: apt.id,\r\n                time: apt.time,\r\n                patientName: apt.patient,\r\n                patientId: apt.patientId,\r\n                patientAvatar: apt.patientAvatar,\r\n                reason: apt.motivo,\r\n                status: apt.status,\r\n                meetingUrl: undefined, // Se obtiene del registro completo\r\n                minutesUntil: calculateMinutesUntil(apt.time)\r\n            }))\r\n            .sort((a, b) => a.minutesUntil - b.minutesUntil);\r\n    }, [todayAppointments]);\r\n\r\n    // Handler para iniciar videollamada\r\n    const handleStartCall = (appointmentId: string) => {\r\n        router.push(`/dashboard/medico/telemedicina/sala/${appointmentId}`);\r\n    };\r\n\r\n    // Handler para ver detalles del paciente\r\n    const handleViewPatient = (patientId: string) => {\r\n        router.push(`/dashboard/medico/pacientes/${patientId}`);\r\n    };\r\n\r\n    // Encontrar la próxima cita urgente\r\n    const nextUrgent = telemedicineCitas.find(c => c.minutesUntil <= 15 && c.minutesUntil >= -30);\r\n\r\n    return (\r\n        <WidgetWrapper\r\n            id=\"upcoming-telemedicine\"\r\n            title=\"Videoconsultas\"\r\n            icon={<Video className=\"h-4 w-4 text-teal-500\" />}\r\n            isDragging={isDragging}\r\n            showControls={false}\r\n        >\r\n            <div className=\"space-y-3\">\r\n                {isLoading ? (\r\n                    <div className=\"flex items-center justify-center py-8\">\r\n                        <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\r\n                    </div>\r\n                ) : (\r\n                    <>\r\n                        {/* Header con conteo */}\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <Badge\r\n                                variant=\"secondary\"\r\n                                className={cn(\r\n                                    \"text-[10px] gap-1\",\r\n                                    nextUrgent && \"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400\"\r\n                                )}\r\n                            >\r\n                                <Video className=\"h-2.5 w-2.5\" />\r\n                                {telemedicineCitas.length} hoy\r\n                            </Badge>\r\n                            {nextUrgent && (\r\n                                <Badge\r\n                                    variant=\"destructive\"\r\n                                    className=\"text-[10px] gap-1 animate-pulse\"\r\n                                >\r\n                                    <Clock className=\"h-2.5 w-2.5\" />\r\n                                    {formatTimeUntil(nextUrgent.minutesUntil)}\r\n                                </Badge>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Lista de citas */}\r\n                        <div className=\"space-y-2\">\r\n                            {telemedicineCitas.length > 0 ? (\r\n                                telemedicineCitas.slice(0, 4).map((cita, index) => {\r\n                                    const timeStatus = getTimeStatus(cita.minutesUntil);\r\n                                    const isNow = cita.minutesUntil <= 5 && cita.minutesUntil >= -30;\r\n\r\n                                    return (\r\n                                        <motion.div\r\n                                            key={cita.id}\r\n                                            initial={{ opacity: 0, y: -10 }}\r\n                                            animate={{ opacity: 1, y: 0 }}\r\n                                            transition={{ delay: index * 0.05 }}\r\n                                            className={cn(\r\n                                                \"flex items-center gap-2 p-2 rounded-lg\",\r\n                                                \"bg-muted/30 hover:bg-muted/50 transition-colors\",\r\n                                                isNow && \"ring-1 ring-teal-500/50 bg-teal-500/5\"\r\n                                            )}\r\n                                        >\r\n                                            {/* Avatar */}\r\n                                            <div className=\"relative\">\r\n                                                <Avatar className=\"h-8 w-8\">\r\n                                                    {cita.patientAvatar ? (\r\n                                                        <AvatarImage src={cita.patientAvatar} alt={cita.patientName} />\r\n                                                    ) : null}\r\n                                                    <AvatarFallback className=\"text-xs bg-gradient-to-br from-teal-500/20 to-cyan-500/20\">\r\n                                                        {getInitials(cita.patientName)}\r\n                                                    </AvatarFallback>\r\n                                                </Avatar>\r\n                                                {cita.status === \"in-progress\" && (\r\n                                                    <div className=\"absolute -bottom-0.5 -right-0.5 w-2.5 h-2.5 rounded-full bg-emerald-500 border-2 border-background animate-pulse\" />\r\n                                                )}\r\n                                            </div>\r\n\r\n                                            {/* Información */}\r\n                                            <div className=\"flex-1 min-w-0\">\r\n                                                <div className=\"flex items-center gap-1\">\r\n                                                    <p className=\"text-xs font-medium truncate\">\r\n                                                        {cita.patientName}\r\n                                                    </p>\r\n                                                </div>\r\n                                                <div className=\"flex items-center gap-2 text-[10px]\">\r\n                                                    <span className=\"text-muted-foreground\">\r\n                                                        {cita.time}\r\n                                                    </span>\r\n                                                    <span className={cn(\"font-medium\", timeStatus.color)}>\r\n                                                        {formatTimeUntil(cita.minutesUntil)}\r\n                                                    </span>\r\n                                                </div>\r\n                                            </div>\r\n\r\n                                            {/* Botón de acción */}\r\n                                            <Button\r\n                                                size=\"sm\"\r\n                                                className={cn(\r\n                                                    \"h-7 text-[10px] px-2\",\r\n                                                    isNow && \"bg-teal-600 hover:bg-teal-700\"\r\n                                                )}\r\n                                                onClick={() => handleStartCall(cita.id)}\r\n                                            >\r\n                                                <Play className=\"h-2.5 w-2.5 mr-1\" />\r\n                                                {cita.status === \"in-progress\" ? \"Continuar\" : \"Iniciar\"}\r\n                                            </Button>\r\n                                        </motion.div>\r\n                                    );\r\n                                })\r\n                            ) : (\r\n                                <motion.div\r\n                                    initial={{ opacity: 0 }}\r\n                                    animate={{ opacity: 1 }}\r\n                                    className=\"text-center py-6 text-muted-foreground\"\r\n                                >\r\n                                    <VideoOff className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\r\n                                    <p className=\"text-xs\">Sin videoconsultas hoy</p>\r\n                                    <p className=\"text-[10px] mt-1\">Las citas virtuales aparecerán aquí</p>\r\n                                </motion.div>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Ver agenda completa */}\r\n                        {telemedicineCitas.length > 0 && (\r\n                            <Button\r\n                                variant=\"outline\"\r\n                                className=\"w-full text-xs h-7\"\r\n                                onClick={() => router.push(\"/dashboard/medico/telemedicina\")}\r\n                            >\r\n                                <Video className=\"h-3 w-3 mr-1\" />\r\n                                Ir a telemedicina\r\n                                <ChevronRight className=\"h-3 w-3 ml-1\" />\r\n                            </Button>\r\n                        )}\r\n                    </>\r\n                )}\r\n            </div>\r\n        </WidgetWrapper>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\dashboard\\widgets\\week-calendar-widget.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'endOfWeek' is assigned a value but never used.","line":205,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":205,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file week-calendar-widget.tsx\r\n * @description Widget de calendario semanal con navegación temporal y datos reales de Supabase.\r\n * Muestra la carga de citas por día con capacidad de navegar entre semanas.\r\n * \r\n * @module Dashboard/Widgets\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useState, useMemo, useCallback } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport { CalendarDays, ChevronLeft, ChevronRight, RotateCcw, Loader2 } from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { WidgetWrapper } from \"../widget-wrapper\";\r\nimport { useDashboardData } from \"@/hooks/use-dashboard-data\";\r\n\r\n// ============================================================================\r\n// TIPOS\r\n// ============================================================================\r\n\r\ninterface WeekCalendarWidgetProps {\r\n    /** ID del médico */\r\n    doctorId?: string;\r\n    /** Si está siendo arrastrado */\r\n    isDragging?: boolean;\r\n}\r\n\r\ninterface DayData {\r\n    /** Fecha del día */\r\n    date: Date;\r\n    /** String de fecha YYYY-MM-DD */\r\n    dateStr: string;\r\n    /** Número de citas programadas */\r\n    appointments: number;\r\n    /** Número de citas completadas */\r\n    completed: number;\r\n    /** Si es el día actual */\r\n    isToday: boolean;\r\n    /** Si es un día pasado */\r\n    isPast: boolean;\r\n}\r\n\r\n// ============================================================================\r\n// CONSTANTES\r\n// ============================================================================\r\n\r\n/** Nombres cortos de los días de la semana */\r\nconst dayNames = [\"Dom\", \"Lun\", \"Mar\", \"Mié\", \"Jue\", \"Vie\", \"Sáb\"];\r\n\r\n/** Nombres de meses */\r\nconst monthNames = [\"Ene\", \"Feb\", \"Mar\", \"Abr\", \"May\", \"Jun\", \"Jul\", \"Ago\", \"Sep\", \"Oct\", \"Nov\", \"Dic\"];\r\n\r\n// ============================================================================\r\n// HELPERS\r\n// ============================================================================\r\n\r\n/**\r\n * Formatea un rango de fechas para mostrar.\r\n * @example \"22-28 Dic\" o \"28 Dic - 3 Ene\"\r\n */\r\nfunction formatDateRange(startDate: Date, endDate: Date): string {\r\n    const startDay = startDate.getDate();\r\n    const endDay = endDate.getDate();\r\n    const startMonth = monthNames[startDate.getMonth()];\r\n    const endMonth = monthNames[endDate.getMonth()];\r\n\r\n    if (startDate.getMonth() === endDate.getMonth()) {\r\n        return `${startDay}-${endDay} ${startMonth}`;\r\n    }\r\n    return `${startDay} ${startMonth} - ${endDay} ${endMonth}`;\r\n}\r\n\r\n// ============================================================================\r\n// COMPONENTES AUXILIARES\r\n// ============================================================================\r\n\r\n/**\r\n * Celda individual de día en el calendario.\r\n */\r\nfunction DayCell({\r\n    date,\r\n    dateStr,\r\n    appointments,\r\n    completed,\r\n    isToday,\r\n    isPast,\r\n    index,\r\n    onDayClick\r\n}: DayData & { index: number; onDayClick: (dateStr: string) => void }) {\r\n    const dayName = dayNames[date.getDay()];\r\n    const dayNumber = date.getDate();\r\n    const loadPercentage = Math.min((appointments / 10) * 100, 100);\r\n\r\n    return (\r\n        <motion.div\r\n            initial={{ opacity: 0, y: 10 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            transition={{ delay: index * 0.03 }}\r\n            onClick={() => onDayClick(dateStr)}\r\n            role=\"button\"\r\n            tabIndex={0}\r\n            onKeyDown={(e) => e.key === 'Enter' && onDayClick(dateStr)}\r\n            aria-label={`Ver citas del ${date.getDate()} de ${date.toLocaleDateString('es', { month: 'long' })}`}\r\n            className={cn(\r\n                \"relative flex flex-col items-center p-2 rounded-xl cursor-pointer\",\r\n                \"transition-all duration-200\",\r\n                \"hover:bg-primary/20 hover:scale-105\",\r\n                \"focus:outline-none focus:ring-2 focus:ring-primary/50\",\r\n                isToday && \"bg-primary/10 ring-2 ring-primary/30\"\r\n            )}\r\n        >\r\n            {/* Nombre del día */}\r\n            <span className={cn(\r\n                \"text-[10px] font-medium uppercase tracking-wide\",\r\n                isToday ? \"text-primary\" : \"text-muted-foreground\"\r\n            )}>\r\n                {dayName}\r\n            </span>\r\n\r\n            {/* Número del día */}\r\n            <span className={cn(\r\n                \"text-lg font-bold mt-0.5\",\r\n                isToday && \"text-primary\",\r\n                isPast && !isToday && \"text-muted-foreground\"\r\n            )}>\r\n                {dayNumber}\r\n            </span>\r\n\r\n            {/* Indicador de carga */}\r\n            <div className=\"w-full mt-2 space-y-1\">\r\n                <div className=\"h-1 rounded-full bg-muted overflow-hidden\">\r\n                    <motion.div\r\n                        initial={{ width: 0 }}\r\n                        animate={{ width: `${loadPercentage}%` }}\r\n                        transition={{ delay: 0.2 + index * 0.03, duration: 0.4 }}\r\n                        className={cn(\r\n                            \"h-full rounded-full\",\r\n                            appointments === 0 && \"bg-transparent\",\r\n                            appointments > 0 && appointments <= 3 && \"bg-green-500\",\r\n                            appointments > 3 && appointments <= 6 && \"bg-yellow-500\",\r\n                            appointments > 6 && \"bg-red-500\"\r\n                        )}\r\n                    />\r\n                </div>\r\n\r\n                {/* Conteo de citas */}\r\n                {appointments > 0 && (\r\n                    <div className=\"text-[10px] text-center text-muted-foreground\">\r\n                        {isPast || isToday ? (\r\n                            <span>{completed}/{appointments}</span>\r\n                        ) : (\r\n                            <span>{appointments}</span>\r\n                        )}\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Indicador de día actual */}\r\n            {isToday && (\r\n                <motion.div\r\n                    initial={{ scale: 0 }}\r\n                    animate={{ scale: 1 }}\r\n                    className=\"absolute -top-1 -right-1 w-2 h-2 rounded-full bg-primary\"\r\n                />\r\n            )}\r\n        </motion.div>\r\n    );\r\n}\r\n\r\n// ============================================================================\r\n// COMPONENTE PRINCIPAL\r\n// ============================================================================\r\n\r\n/**\r\n * Widget de calendario semanal con navegación temporal.\r\n * Permite navegar entre semanas pasadas y futuras.\r\n * \r\n * @example\r\n * <WeekCalendarWidget doctorId=\"uuid-del-doctor\" />\r\n */\r\nexport function WeekCalendarWidget({\r\n    doctorId,\r\n    isDragging\r\n}: WeekCalendarWidgetProps) {\r\n    // Router para navegación\r\n    const router = useRouter();\r\n\r\n    // Estado para offset de semana (0 = semana actual, -1 = semana pasada, 1 = próxima)\r\n    const [weekOffset, setWeekOffset] = useState(0);\r\n\r\n    // Obtener datos reales del dashboard\r\n    const { appointments, isLoading } = useDashboardData(doctorId);\r\n\r\n    // Fecha de hoy (referencia fija)\r\n    const today = useMemo(() => {\r\n        const d = new Date();\r\n        d.setHours(0, 0, 0, 0);\r\n        return d;\r\n    }, []);\r\n\r\n    // Calcular inicio y fin de la semana actual + offset\r\n    const { startOfWeek, endOfWeek, dateRange } = useMemo(() => {\r\n        // Obtenemos el domingo de la semana actual\r\n        const start = new Date(today);\r\n        const day = today.getDay(); // 0 (Dom) a 6 (Sáb)\r\n\r\n        // Ajustamos al domingo de la semana base (esta semana)\r\n        start.setDate(today.getDate() - day);\r\n\r\n        // Aplicamos el offset de semanas\r\n        start.setDate(start.getDate() + (weekOffset * 7));\r\n        start.setHours(0, 0, 0, 0);\r\n\r\n        const end = new Date(start);\r\n        end.setDate(start.getDate() + 6);\r\n        end.setHours(23, 59, 59, 999);\r\n\r\n        return {\r\n            startOfWeek: start,\r\n            endOfWeek: end,\r\n            dateRange: formatDateRange(start, end),\r\n        };\r\n    }, [today, weekOffset]);\r\n\r\n    // Calcular datos de la semana\r\n    const weekData = useMemo(() => {\r\n        const days: DayData[] = [];\r\n\r\n        for (let i = 0; i < 7; i++) {\r\n            const date = new Date(startOfWeek);\r\n            date.setDate(startOfWeek.getDate() + i);\r\n\r\n            // IMPORTANTE: Usar formato local YYYY-MM-DD para comparar con la base de datos\r\n            // sin desfases de UTC\r\n            const yyyy = date.getFullYear();\r\n            const mm = String(date.getMonth() + 1).padStart(2, '0');\r\n            const dd = String(date.getDate()).padStart(2, '0');\r\n            const dateStr = `${yyyy}-${mm}-${dd}`;\r\n\r\n            // Filtrar citas para este día\r\n            const dayAppointments = appointments.filter(apt =>\r\n                apt.appointment_date === dateStr\r\n            );\r\n\r\n            const completedCount = dayAppointments.filter(apt =>\r\n                apt.status === 'completed'\r\n            ).length;\r\n\r\n            days.push({\r\n                date,\r\n                dateStr,\r\n                appointments: dayAppointments.length,\r\n                completed: completedCount,\r\n                isToday: date.toDateString() === today.toDateString(),\r\n                isPast: date < today,\r\n            });\r\n        }\r\n\r\n        return days;\r\n    }, [appointments, startOfWeek, today]);\r\n\r\n    // Calcular totales de la semana\r\n    const totalThisWeek = weekData.reduce((sum, d) => sum + d.appointments, 0);\r\n\r\n    // Handlers de navegación\r\n    const goToPreviousWeek = useCallback(() => {\r\n        setWeekOffset(prev => prev - 1);\r\n    }, []);\r\n\r\n    const goToNextWeek = useCallback(() => {\r\n        setWeekOffset(prev => prev + 1);\r\n    }, []);\r\n\r\n    const goToCurrentWeek = useCallback(() => {\r\n        setWeekOffset(0);\r\n    }, []);\r\n\r\n    // ¿Estamos en la semana actual?\r\n    const isCurrentWeek = weekOffset === 0;\r\n\r\n    /**\r\n     * Handler para navegar a la página de citas con la fecha seleccionada\r\n     * @param dateStr - Fecha en formato YYYY-MM-DD\r\n     */\r\n    const handleDayClick = useCallback((dateStr: string) => {\r\n        router.push(`/dashboard/medico/citas?date=${dateStr}&view=day`);\r\n    }, [router]);\r\n\r\n    return (\r\n        <WidgetWrapper\r\n            id=\"week-calendar\"\r\n            title=\"Calendario Semanal\"\r\n            icon={<CalendarDays className=\"h-4 w-4 text-primary\" />}\r\n            isDragging={isDragging}\r\n            showControls={false}\r\n        >\r\n            <div className=\"space-y-3\">\r\n                {/* Estado de carga */}\r\n                {isLoading ? (\r\n                    <div className=\"flex items-center justify-center py-8\">\r\n                        <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\r\n                    </div>\r\n                ) : (\r\n                    <>\r\n                        {/* Header con navegación */}\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <span className=\"text-sm font-medium\">{dateRange}</span>\r\n                                {!isCurrentWeek && (\r\n                                    <Button\r\n                                        variant=\"ghost\"\r\n                                        size=\"sm\"\r\n                                        className=\"h-5 px-1.5 text-[10px] gap-1\"\r\n                                        onClick={goToCurrentWeek}\r\n                                    >\r\n                                        <RotateCcw className=\"h-3 w-3\" />\r\n                                        Hoy\r\n                                    </Button>\r\n                                )}\r\n                            </div>\r\n                            <div className=\"flex items-center gap-0.5\">\r\n                                <Button\r\n                                    variant=\"ghost\"\r\n                                    size=\"icon\"\r\n                                    className=\"h-6 w-6\"\r\n                                    onClick={goToPreviousWeek}\r\n                                    aria-label=\"Semana anterior\"\r\n                                >\r\n                                    <ChevronLeft className=\"h-3 w-3\" />\r\n                                </Button>\r\n                                <Button\r\n                                    variant=\"ghost\"\r\n                                    size=\"icon\"\r\n                                    className=\"h-6 w-6\"\r\n                                    onClick={goToNextWeek}\r\n                                    aria-label=\"Semana siguiente\"\r\n                                >\r\n                                    <ChevronRight className=\"h-3 w-3\" />\r\n                                </Button>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Stats rápidos */}\r\n                        <div className=\"text-xs text-muted-foreground\">\r\n                            <span className=\"font-medium text-foreground\">{totalThisWeek}</span> citas\r\n                            {isCurrentWeek ? \" esta semana\" : \"\"}\r\n                        </div>\r\n\r\n                        {/* Grid de la semana con animación */}\r\n                        <AnimatePresence mode=\"wait\">\r\n                            <motion.div\r\n                                key={weekOffset}\r\n                                initial={{ opacity: 0, x: weekOffset > 0 ? 20 : -20 }}\r\n                                animate={{ opacity: 1, x: 0 }}\r\n                                exit={{ opacity: 0, x: weekOffset > 0 ? -20 : 20 }}\r\n                                transition={{ duration: 0.2 }}\r\n                                className=\"grid grid-cols-7 gap-1\"\r\n                            >\r\n                                {weekData.map((day, index) => (\r\n                                    <DayCell\r\n                                        key={day.dateStr}\r\n                                        date={day.date}\r\n                                        dateStr={day.dateStr}\r\n                                        appointments={day.appointments}\r\n                                        completed={day.completed}\r\n                                        isToday={day.isToday}\r\n                                        isPast={day.isPast}\r\n                                        index={index}\r\n                                        onDayClick={handleDayClick}\r\n                                    />\r\n                                ))}\r\n                            </motion.div>\r\n                        </AnimatePresence>\r\n\r\n                        {/* Leyenda */}\r\n                        <div className=\"flex items-center justify-center gap-4 text-[10px] text-muted-foreground\">\r\n                            <div className=\"flex items-center gap-1\">\r\n                                <div className=\"w-2 h-2 rounded-full bg-green-500\" />\r\n                                <span>1-3</span>\r\n                            </div>\r\n                            <div className=\"flex items-center gap-1\">\r\n                                <div className=\"w-2 h-2 rounded-full bg-yellow-500\" />\r\n                                <span>4-6</span>\r\n                            </div>\r\n                            <div className=\"flex items-center gap-1\">\r\n                                <div className=\"w-2 h-2 rounded-full bg-red-500\" />\r\n                                <span>7+</span>\r\n                            </div>\r\n                        </div>\r\n                    </>\r\n                )}\r\n            </div>\r\n        </WidgetWrapper>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\dashboard\\widgets\\week-calendar\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\dashboard\\widgets\\week-calendar\\use-week-calendar.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\demos\\icd11-demo.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[595,598],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[595,598],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[786,789],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[786,789],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Search, CheckCircle2, XCircle, Loader2, Info } from \"lucide-react\";\r\n\r\n/**\r\n * Componente de demostración de la API ICD-11\r\n * Muestra las capacidades de búsqueda y validación\r\n */\r\nexport function ICD11Demo() {\r\n  const [searchQuery, setSearchQuery] = useState(\"\");\r\n  const [searchResults, setSearchResults] = useState<any[]>([]);\r\n  const [isSearching, setIsSearching] = useState(false);\r\n  \r\n  const [validateCode, setValidateCode] = useState(\"\");\r\n  const [validationResult, setValidationResult] = useState<any>(null);\r\n  const [isValidating, setIsValidating] = useState(false);\r\n\r\n  const handleSearch = async () => {\r\n    if (!searchQuery) return;\r\n    \r\n    setIsSearching(true);\r\n    try {\r\n      const response = await fetch(\r\n        `/api/icd11/search?q=${encodeURIComponent(searchQuery)}`\r\n      );\r\n      const data = await response.json();\r\n      \r\n      if (data.success) {\r\n        setSearchResults(data.data);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error searching:\", error);\r\n    } finally {\r\n      setIsSearching(false);\r\n    }\r\n  };\r\n\r\n  const handleValidate = async () => {\r\n    if (!validateCode) return;\r\n    \r\n    setIsValidating(true);\r\n    try {\r\n      const response = await fetch(\r\n        `/api/icd11/validate?code=${encodeURIComponent(validateCode)}`\r\n      );\r\n      const data = await response.json();\r\n      setValidationResult(data);\r\n    } catch (error) {\r\n      console.error(\"Error validating:\", error);\r\n    } finally {\r\n      setIsValidating(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6 p-6\">\r\n      <div className=\"flex items-center gap-3\">\r\n        <Info className=\"h-6 w-6 text-blue-600\" />\r\n        <div>\r\n          <h2 className=\"text-2xl font-bold\">Demo ICD-11 API</h2>\r\n          <p className=\"text-sm text-gray-600\">\r\n            Prueba la integración con la API oficial de la OMS\r\n          </p>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Búsqueda */}\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle>Búsqueda de Códigos</CardTitle>\r\n          <CardDescription>\r\n            Busca códigos ICD-11 por término médico en español o inglés\r\n          </CardDescription>\r\n        </CardHeader>\r\n        <CardContent className=\"space-y-4\">\r\n          <div className=\"flex gap-2\">\r\n            <Input\r\n              placeholder=\"Ej: diabetes, hipertensión, asma...\"\r\n              value={searchQuery}\r\n              onChange={(e) => setSearchQuery(e.target.value)}\r\n              onKeyDown={(e) => e.key === \"Enter\" && handleSearch()}\r\n            />\r\n            <Button onClick={handleSearch} disabled={isSearching || !searchQuery}>\r\n              {isSearching ? (\r\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n              ) : (\r\n                <Search className=\"h-4 w-4\" />\r\n              )}\r\n              Buscar\r\n            </Button>\r\n          </div>\r\n\r\n          {searchResults.length > 0 && (\r\n            <div className=\"space-y-2\">\r\n              <p className=\"text-sm font-medium\">\r\n                Resultados ({searchResults.length}):\r\n              </p>\r\n              {searchResults.map((result) => (\r\n                <Card key={result.id} className=\"p-3\">\r\n                  <div className=\"flex items-start justify-between gap-3\">\r\n                    <div className=\"flex-1\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <Badge variant=\"outline\" className=\"font-mono\">\r\n                          {result.code}\r\n                        </Badge>\r\n                        {result.score && (\r\n                          <Badge variant=\"secondary\" className=\"text-xs\">\r\n                            {Math.round(result.score * 100)}% relevancia\r\n                          </Badge>\r\n                        )}\r\n                      </div>\r\n                      <p className=\"mt-1 font-medium\">{result.title}</p>\r\n                      {result.chapter && (\r\n                        <p className=\"text-xs text-gray-500 mt-1\">\r\n                          {result.chapter}\r\n                        </p>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                </Card>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Validación */}\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle>Validación de Código</CardTitle>\r\n          <CardDescription>\r\n            Verifica si un código ICD-11 existe y obtén sus detalles\r\n          </CardDescription>\r\n        </CardHeader>\r\n        <CardContent className=\"space-y-4\">\r\n          <div className=\"flex gap-2\">\r\n            <Input\r\n              placeholder=\"Ej: 5A11, BA00, 1A00...\"\r\n              value={validateCode}\r\n              onChange={(e) => setValidateCode(e.target.value.toUpperCase())}\r\n              onKeyDown={(e) => e.key === \"Enter\" && handleValidate()}\r\n              className=\"font-mono\"\r\n            />\r\n            <Button onClick={handleValidate} disabled={isValidating || !validateCode}>\r\n              {isValidating ? (\r\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n              ) : (\r\n                <CheckCircle2 className=\"h-4 w-4\" />\r\n              )}\r\n              Validar\r\n            </Button>\r\n          </div>\r\n\r\n          {validationResult && (\r\n            <Card className={validationResult.valid ? \"border-green-200 bg-green-50\" : \"border-red-200 bg-red-50\"}>\r\n              <CardContent className=\"pt-4\">\r\n                <div className=\"flex items-start gap-3\">\r\n                  {validationResult.valid ? (\r\n                    <CheckCircle2 className=\"h-5 w-5 text-green-600 mt-0.5\" />\r\n                  ) : (\r\n                    <XCircle className=\"h-5 w-5 text-red-600 mt-0.5\" />\r\n                  )}\r\n                  <div className=\"flex-1\">\r\n                    <p className={`font-medium ${validationResult.valid ? \"text-green-900\" : \"text-red-900\"}`}>\r\n                      {validationResult.valid ? \"Código válido\" : \"Código no encontrado\"}\r\n                    </p>\r\n                    {validationResult.data && (\r\n                      <div className=\"mt-2 space-y-1\">\r\n                        <p className=\"text-sm\">\r\n                          <span className=\"font-mono font-semibold\">\r\n                            {validationResult.data.code}\r\n                          </span>\r\n                        </p>\r\n                        <p className=\"text-sm\">{validationResult.data.title}</p>\r\n                        {validationResult.data.chapter && (\r\n                          <p className=\"text-xs text-gray-600\">\r\n                            {validationResult.data.chapter}\r\n                          </p>\r\n                        )}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Ejemplos */}\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle>Ejemplos de Búsqueda</CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-2\">\r\n            {[\"diabetes\", \"hipertensión\", \"asma\", \"covid\", \"neumonía\", \"gripe\", \"anemia\", \"migraña\"].map((term) => (\r\n              <Button\r\n                key={term}\r\n                variant=\"outline\"\r\n                size=\"sm\"\r\n                onClick={() => {\r\n                  setSearchQuery(term);\r\n                  setTimeout(() => handleSearch(), 100);\r\n                }}\r\n              >\r\n                {term}\r\n              </Button>\r\n            ))}\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\demos\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\estadisticas\\charts\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\estadisticas\\estadisticas-mega-menu-config.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\estadisticas\\filters\\filters-toolbar.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Select' is defined but never used.","line":38,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SelectContent' is defined but never used.","line":39,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":39,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SelectItem' is defined but never used.","line":40,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":40,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SelectTrigger' is defined but never used.","line":41,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":41,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SelectValue' is defined but never used.","line":42,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":42,"endColumn":14}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file filters-toolbar.tsx\r\n * @description Componente de filtros globales para la página de estadísticas.\r\n * Incluye selector de rango de fechas, filtros de ubicación, tipo de consulta,\r\n * comparativas y exportación de datos.\r\n *\r\n * @module Estadisticas/Filters\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useState, useMemo } from \"react\";\r\nimport { format } from \"date-fns\";\r\nimport { es } from \"date-fns/locale\";\r\nimport {\r\n  Calendar,\r\n  Download,\r\n  RefreshCw,\r\n  Filter,\r\n  ChevronDown,\r\n  FileText,\r\n  FileSpreadsheet,\r\n  File,\r\n  TrendingUp,\r\n} from \"lucide-react\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Card, CardContent } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport {\r\n  DropdownMenu,\r\n  DropdownMenuContent,\r\n  DropdownMenuItem,\r\n  DropdownMenuLabel,\r\n  DropdownMenuSeparator,\r\n  DropdownMenuTrigger,\r\n} from \"@red-salud/ui\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@red-salud/ui\";\r\nimport { Checkbox } from \"@red-salud/ui\";\r\n\r\n// ============================================================================\r\n// TIPOS\r\n// ============================================================================\r\n\r\nexport interface DateRangePreset {\r\n  label: string;\r\n  value: string;\r\n  getRange: () => { start: Date; end: Date };\r\n}\r\n\r\nexport interface StatisticsFilters {\r\n  dateRange: { start: Date; end: Date };\r\n  locations: string[];\r\n  consultationTypes: string[];\r\n  statuses: string[];\r\n  compareWithPrevious: boolean;\r\n}\r\n\r\ninterface FiltersToolbarProps {\r\n  filters: StatisticsFilters;\r\n  onFiltersChange: (filters: StatisticsFilters) => void;\r\n  onRefresh: () => void;\r\n  onExport: (format: \"pdf\" | \"excel\" | \"csv\") => void;\r\n  lastRefresh?: Date;\r\n  isLoading?: boolean;\r\n}\r\n\r\n// ============================================================================\r\n// PRESETS DE RANGO DE FECHAS\r\n// ============================================================================\r\n\r\nconst DATE_PRESETS: DateRangePreset[] = [\r\n  {\r\n    label: \"Hoy\",\r\n    value: \"today\",\r\n    getRange: () => {\r\n      const now = new Date();\r\n      const start = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0, 0, 0);\r\n      const end = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59);\r\n      return { start, end };\r\n    },\r\n  },\r\n  {\r\n    label: \"Ayer\",\r\n    value: \"yesterday\",\r\n    getRange: () => {\r\n      const now = new Date();\r\n      const start = new Date(now.getFullYear(), now.getMonth(), now.getDate() - 1, 0, 0, 0);\r\n      const end = new Date(now.getFullYear(), now.getMonth(), now.getDate() - 1, 23, 59, 59);\r\n      return { start, end };\r\n    },\r\n  },\r\n  {\r\n    label: \"Últimos 7 días\",\r\n    value: \"last7days\",\r\n    getRange: () => {\r\n      const now = new Date();\r\n      const end = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59);\r\n      const start = new Date(end);\r\n      start.setDate(start.getDate() - 7);\r\n      start.setHours(0, 0, 0, 0);\r\n      return { start, end };\r\n    },\r\n  },\r\n  {\r\n    label: \"Últimos 30 días\",\r\n    value: \"last30days\",\r\n    getRange: () => {\r\n      const now = new Date();\r\n      const end = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59);\r\n      const start = new Date(end);\r\n      start.setDate(start.getDate() - 30);\r\n      start.setHours(0, 0, 0, 0);\r\n      return { start, end };\r\n    },\r\n  },\r\n  {\r\n    label: \"Este mes\",\r\n    value: \"thismonth\",\r\n    getRange: () => {\r\n      const now = new Date();\r\n      const start = new Date(now.getFullYear(), now.getMonth(), 1, 0, 0, 0);\r\n      const end = new Date(now.getFullYear(), now.getMonth() + 1, 0, 23, 59, 59);\r\n      return { start, end };\r\n    },\r\n  },\r\n  {\r\n    label: \"Mes anterior\",\r\n    value: \"lastmonth\",\r\n    getRange: () => {\r\n      const now = new Date();\r\n      const start = new Date(now.getFullYear(), now.getMonth() - 1, 1, 0, 0, 0);\r\n      const end = new Date(now.getFullYear(), now.getMonth(), 0, 23, 59, 59);\r\n      return { start, end };\r\n    },\r\n  },\r\n  {\r\n    label: \"Este año\",\r\n    value: \"thisyear\",\r\n    getRange: () => {\r\n      const now = new Date();\r\n      const start = new Date(now.getFullYear(), 0, 1, 0, 0, 0);\r\n      const end = new Date(now.getFullYear(), 11, 31, 23, 59, 59);\r\n      return { start, end };\r\n    },\r\n  },\r\n  {\r\n    label: \"Últimos 12 meses\",\r\n    value: \"last12months\",\r\n    getRange: () => {\r\n      const now = new Date();\r\n      const end = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59);\r\n      const start = new Date(end);\r\n      start.setMonth(start.getMonth() - 12);\r\n      start.setHours(0, 0, 0, 0);\r\n      return { start, end };\r\n    },\r\n  },\r\n];\r\n\r\nconst CONSULTATION_TYPES = [\r\n  { label: \"Presencial\", value: \"presencial\" },\r\n  { label: \"Telemedicina\", value: \"video\" },\r\n  { label: \"Teléfono\", value: \"phone\" },\r\n];\r\n\r\nconst STATUS_OPTIONS = [\r\n  { label: \"Completada\", value: \"completed\" },\r\n  { label: \"Pendiente\", value: \"pending\" },\r\n  { label: \"Cancelada\", value: \"cancelled\" },\r\n  { label: \"No Show\", value: \"no-show\" },\r\n];\r\n\r\n// ============================================================================\r\n// COMPONENTE PRINCIPAL\r\n// ============================================================================\r\n\r\nexport function FiltersToolbar({\r\n  filters,\r\n  onFiltersChange,\r\n  onRefresh,\r\n  onExport,\r\n  lastRefresh,\r\n  isLoading = false,\r\n}: FiltersToolbarProps) {\r\n  const [activePreset, setActivePreset] = useState<string>(\"last30days\");\r\n\r\n  // Determinar el preset activo basado en el rango actual\r\n  const currentPresetLabel = useMemo(() => {\r\n    const preset = DATE_PRESETS.find((p) => p.value === activePreset);\r\n    return preset?.label || \"Personalizado\";\r\n  }, [activePreset]);\r\n\r\n  const handleDatePresetChange = (presetValue: string) => {\r\n    const preset = DATE_PRESETS.find((p) => p.value === presetValue);\r\n    if (preset) {\r\n      setActivePreset(presetValue);\r\n      onFiltersChange({\r\n        ...filters,\r\n        dateRange: preset.getRange(),\r\n      });\r\n    }\r\n  };\r\n\r\n  const handleConsultationTypeToggle = (type: string) => {\r\n    const newTypes = filters.consultationTypes.includes(type)\r\n      ? filters.consultationTypes.filter((t) => t !== type)\r\n      : [...filters.consultationTypes, type];\r\n\r\n    onFiltersChange({\r\n      ...filters,\r\n      consultationTypes: newTypes,\r\n    });\r\n  };\r\n\r\n  const handleStatusToggle = (status: string) => {\r\n    const newStatuses = filters.statuses.includes(status)\r\n      ? filters.statuses.filter((s) => s !== status)\r\n      : [...filters.statuses, status];\r\n\r\n    onFiltersChange({\r\n      ...filters,\r\n      statuses: newStatuses,\r\n    });\r\n  };\r\n\r\n  const handleCompareToggle = () => {\r\n    onFiltersChange({\r\n      ...filters,\r\n      compareWithPrevious: !filters.compareWithPrevious,\r\n    });\r\n  };\r\n\r\n  return (\r\n    <Card className=\"border-border/50 shadow-sm\">\r\n      <CardContent className=\"p-4\">\r\n        <div className=\"flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between\">\r\n          {/* Filtros principales */}\r\n          <div className=\"flex flex-wrap items-center gap-3\">\r\n            {/* Selector de rango de fechas */}\r\n            <DropdownMenu>\r\n              <DropdownMenuTrigger asChild>\r\n                <Button variant=\"outline\" className=\"gap-2 min-w-[200px] justify-start\">\r\n                  <Calendar className=\"h-4 w-4 text-muted-foreground\" />\r\n                  <span className=\"truncate\">{currentPresetLabel}</span>\r\n                  <ChevronDown className=\"h-4 w-4 ml-auto opacity-50\" />\r\n                </Button>\r\n              </DropdownMenuTrigger>\r\n              <DropdownMenuContent align=\"start\" className=\"w-56\">\r\n                <DropdownMenuLabel>Rango de fechas</DropdownMenuLabel>\r\n                <DropdownMenuSeparator />\r\n                {DATE_PRESETS.map((preset) => (\r\n                  <DropdownMenuItem\r\n                    key={preset.value}\r\n                    onClick={() => handleDatePresetChange(preset.value)}\r\n                    className={activePreset === preset.value ? \"bg-accent\" : \"\"}\r\n                  >\r\n                    {preset.label}\r\n                  </DropdownMenuItem>\r\n                ))}\r\n              </DropdownMenuContent>\r\n            </DropdownMenu>\r\n\r\n            {/* Filtro de tipos de consulta */}\r\n            <DropdownMenu>\r\n              <DropdownMenuTrigger asChild>\r\n                <Button variant=\"outline\" className=\"gap-2\">\r\n                  <Filter className=\"h-4 w-4\" />\r\n                  <span>Tipos</span>\r\n                  {filters.consultationTypes.length > 0 && (\r\n                    <Badge variant=\"secondary\" className=\"ml-1\">\r\n                      {filters.consultationTypes.length}\r\n                    </Badge>\r\n                  )}\r\n                  <ChevronDown className=\"h-4 w-4 opacity-50\" />\r\n                </Button>\r\n              </DropdownMenuTrigger>\r\n              <DropdownMenuContent align=\"start\" className=\"w-56\">\r\n                <DropdownMenuLabel>Tipo de consulta</DropdownMenuLabel>\r\n                <DropdownMenuSeparator />\r\n                {CONSULTATION_TYPES.map((type) => (\r\n                  <DropdownMenuItem\r\n                    key={type.value}\r\n                    onClick={() => handleConsultationTypeToggle(type.value)}\r\n                    className=\"flex items-center gap-2\"\r\n                  >\r\n                    <Checkbox\r\n                      checked={filters.consultationTypes.includes(type.value)}\r\n                    />\r\n                    {type.label}\r\n                  </DropdownMenuItem>\r\n                ))}\r\n              </DropdownMenuContent>\r\n            </DropdownMenu>\r\n\r\n            {/* Filtro de estados */}\r\n            <DropdownMenu>\r\n              <DropdownMenuTrigger asChild>\r\n                <Button variant=\"outline\" className=\"gap-2\">\r\n                  <Filter className=\"h-4 w-4\" />\r\n                  <span>Estados</span>\r\n                  {filters.statuses.length > 0 && (\r\n                    <Badge variant=\"secondary\" className=\"ml-1\">\r\n                      {filters.statuses.length}\r\n                    </Badge>\r\n                  )}\r\n                  <ChevronDown className=\"h-4 w-4 opacity-50\" />\r\n                </Button>\r\n              </DropdownMenuTrigger>\r\n              <DropdownMenuContent align=\"start\" className=\"w-56\">\r\n                <DropdownMenuLabel>Estado de cita</DropdownMenuLabel>\r\n                <DropdownMenuSeparator />\r\n                {STATUS_OPTIONS.map((status) => (\r\n                  <DropdownMenuItem\r\n                    key={status.value}\r\n                    onClick={() => handleStatusToggle(status.value)}\r\n                    className=\"flex items-center gap-2\"\r\n                  >\r\n                    <Checkbox\r\n                      checked={filters.statuses.includes(status.value)}\r\n                    />\r\n                    {status.label}\r\n                  </DropdownMenuItem>\r\n                ))}\r\n              </DropdownMenuContent>\r\n            </DropdownMenu>\r\n\r\n            {/* Toggle comparación */}\r\n            <Button\r\n              variant={filters.compareWithPrevious ? \"default\" : \"outline\"}\r\n              size=\"sm\"\r\n              className=\"gap-2\"\r\n              onClick={handleCompareToggle}\r\n            >\r\n              <TrendingUp className=\"h-4 w-4\" />\r\n              <span className=\"hidden sm:inline\">Comparar</span>\r\n            </Button>\r\n          </div>\r\n\r\n          {/* Acciones */}\r\n          <div className=\"flex items-center gap-2\">\r\n            {/* Timestamp de última actualización */}\r\n            {lastRefresh && (\r\n              <div className=\"hidden md:block text-xs text-muted-foreground mr-2\">\r\n                Actualizado: {format(lastRefresh, \"HH:mm:ss\")}\r\n              </div>\r\n            )}\r\n\r\n            {/* Botón de refresh */}\r\n            <Button\r\n              variant=\"outline\"\r\n              size=\"icon\"\r\n              onClick={onRefresh}\r\n              disabled={isLoading}\r\n              title=\"Recargar datos\"\r\n            >\r\n              <RefreshCw className={`h-4 w-4 ${isLoading ? \"animate-spin\" : \"\"}`} />\r\n            </Button>\r\n\r\n            {/* Dropdown de exportación */}\r\n            <DropdownMenu>\r\n              <DropdownMenuTrigger asChild>\r\n                <Button variant=\"outline\" className=\"gap-2\">\r\n                  <Download className=\"h-4 w-4\" />\r\n                  <span className=\"hidden sm:inline\">Exportar</span>\r\n                  <ChevronDown className=\"h-4 w-4 opacity-50\" />\r\n                </Button>\r\n              </DropdownMenuTrigger>\r\n              <DropdownMenuContent align=\"end\" className=\"w-48\">\r\n                <DropdownMenuLabel>Exportar datos</DropdownMenuLabel>\r\n                <DropdownMenuSeparator />\r\n                <DropdownMenuItem onClick={() => onExport(\"pdf\")} className=\"gap-2\">\r\n                  <FileText className=\"h-4 w-4\" />\r\n                  <span>PDF</span>\r\n                </DropdownMenuItem>\r\n                <DropdownMenuItem onClick={() => onExport(\"excel\")} className=\"gap-2\">\r\n                  <FileSpreadsheet className=\"h-4 w-4\" />\r\n                  <span>Excel</span>\r\n                </DropdownMenuItem>\r\n                <DropdownMenuItem onClick={() => onExport(\"csv\")} className=\"gap-2\">\r\n                  <File className=\"h-4 w-4\" />\r\n                  <span>CSV</span>\r\n                </DropdownMenuItem>\r\n              </DropdownMenuContent>\r\n            </DropdownMenu>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Rango de fechas seleccionado */}\r\n        <div className=\"mt-3 flex items-center gap-2 text-xs text-muted-foreground\">\r\n          <span>Desde:</span>\r\n          <span className=\"font-medium\">\r\n            {format(filters.dateRange.start, \"dd MMM yyyy\", { locale: es })}\r\n          </span>\r\n          <span>hasta:</span>\r\n          <span className=\"font-medium\">\r\n            {format(filters.dateRange.end, \"dd MMM yyyy\", { locale: es })}\r\n          </span>\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n}\r\n\r\n// ============================================================================\r\n// DEFAULT FILTERS\r\n// ============================================================================\r\n\r\nexport function getDefaultFilters(): StatisticsFilters {\r\n  const preset = DATE_PRESETS.find((p) => p.value === \"last30days\")!;\r\n  return {\r\n    dateRange: preset.getRange(),\r\n    locations: [],\r\n    consultationTypes: [],\r\n    statuses: [],\r\n    compareWithPrevious: false,\r\n  };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\estadisticas\\filters\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\estadisticas\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\estadisticas\\kpi\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\estadisticas\\sections\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\estadisticas\\tabs\\brotes-tab.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'detectarBrotes'. Either include it or remove the dependency array.","line":33,"column":6,"nodeType":"ArrayExpression","endLine":33,"endColumn":27,"suggestions":[{"desc":"Update the dependencies array to be: [doctorId, dateRange, detectarBrotes]","fix":{"range":[924,945],"text":"[doctorId, dateRange, detectarBrotes]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file brotes-tab.tsx\r\n * @description Tab 8: Detección de Brotes Epidemiológicos conectado a Supabase\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport { Skeleton } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { AlertTriangle, TrendingUp, Activity } from \"lucide-react\";\r\n\r\ninterface BrotesTabProps {\r\n  doctorId: string;\r\n  dateRange: { start: Date; end: Date };\r\n}\r\n\r\ninterface BroteDetectado {\r\n  diagnostico: string;\r\n  casos: number;\r\n  tendencia: number;\r\n  nivel: 'bajo' | 'medio' | 'alto';\r\n}\r\n\r\nexport function BrotesTab({ doctorId, dateRange }: BrotesTabProps) {\r\n  const [brotes, setBrotes] = useState<BroteDetectado[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    detectarBrotes();\r\n  }, [doctorId, dateRange]);\r\n\r\n  const detectarBrotes = async () => {\r\n    try {\r\n      setLoading(true);\r\n\r\n      // Obtener diagnósticos del período actual\r\n      const { data: recordsActuales } = await supabase\r\n        .from('medical_records')\r\n        .select('diagnosis, created_at')\r\n        .eq('doctor_id', doctorId)\r\n        .not('diagnosis', 'is', null)\r\n        .gte('created_at', dateRange.start.toISOString())\r\n        .lte('created_at', dateRange.end.toISOString());\r\n\r\n      // Obtener diagnósticos del período anterior (mismo rango de tiempo)\r\n      const diasPeriodo = Math.ceil((dateRange.end.getTime() - dateRange.start.getTime()) / (1000 * 60 * 60 * 24));\r\n      const periodoAnteriorStart = new Date(dateRange.start);\r\n      periodoAnteriorStart.setDate(periodoAnteriorStart.getDate() - diasPeriodo);\r\n      const periodoAnteriorEnd = new Date(dateRange.start);\r\n\r\n      const { data: recordsAnteriores } = await supabase\r\n        .from('medical_records')\r\n        .select('diagnosis')\r\n        .eq('doctor_id', doctorId)\r\n        .not('diagnosis', 'is', null)\r\n        .gte('created_at', periodoAnteriorStart.toISOString())\r\n        .lte('created_at', periodoAnteriorEnd.toISOString());\r\n\r\n      // Contar casos actuales\r\n      const casosActuales = new Map<string, number>();\r\n      recordsActuales?.forEach(record => {\r\n        if (record.diagnosis) {\r\n          casosActuales.set(record.diagnosis, (casosActuales.get(record.diagnosis) || 0) + 1);\r\n        }\r\n      });\r\n\r\n      // Contar casos anteriores\r\n      const casosAnteriores = new Map<string, number>();\r\n      recordsAnteriores?.forEach(record => {\r\n        if (record.diagnosis) {\r\n          casosAnteriores.set(record.diagnosis, (casosAnteriores.get(record.diagnosis) || 0) + 1);\r\n        }\r\n      });\r\n\r\n      // Detectar brotes (incremento significativo)\r\n      const brotesDetectados: BroteDetectado[] = [];\r\n      \r\n      casosActuales.forEach((casosNuevos, diagnostico) => {\r\n        const casosViejos = casosAnteriores.get(diagnostico) || 0;\r\n        const incremento = casosViejos > 0 ? ((casosNuevos - casosViejos) / casosViejos) * 100 : 100;\r\n\r\n        // Solo considerar brotes si hay al menos 3 casos y un incremento > 50%\r\n        if (casosNuevos >= 3 && incremento > 50) {\r\n          let nivel: 'bajo' | 'medio' | 'alto' = 'bajo';\r\n          if (incremento > 200) nivel = 'alto';\r\n          else if (incremento > 100) nivel = 'medio';\r\n\r\n          brotesDetectados.push({\r\n            diagnostico,\r\n            casos: casosNuevos,\r\n            tendencia: incremento,\r\n            nivel,\r\n          });\r\n        }\r\n      });\r\n\r\n      // Ordenar por nivel de alerta y casos\r\n      brotesDetectados.sort((a, b) => {\r\n        const nivelOrder = { alto: 3, medio: 2, bajo: 1 };\r\n        if (nivelOrder[a.nivel] !== nivelOrder[b.nivel]) {\r\n          return nivelOrder[b.nivel] - nivelOrder[a.nivel];\r\n        }\r\n        return b.casos - a.casos;\r\n      });\r\n\r\n      setBrotes(brotesDetectados);\r\n    } catch (error) {\r\n      console.error(\"Error detecting brotes:\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"space-y-6\">\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <Skeleton className=\"h-64 w-full\" />\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const getNivelColor = (nivel: string) => {\r\n    switch (nivel) {\r\n      case 'alto': return 'bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400';\r\n      case 'medio': return 'bg-orange-100 text-orange-800 dark:bg-orange-900/20 dark:text-orange-400';\r\n      case 'bajo': return 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400';\r\n      default: return 'bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-400';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Resumen */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">\r\n                  Brotes Detectados\r\n                </p>\r\n                <p className=\"text-2xl font-bold text-gray-900 dark:text-gray-100 mt-1\">\r\n                  {brotes.length}\r\n                </p>\r\n              </div>\r\n              <div className=\"p-3 bg-red-50 dark:bg-red-900/20 rounded-lg\">\r\n                <AlertTriangle className=\"h-6 w-6 text-red-600 dark:text-red-400\" />\r\n              </div>\r\n            </div>\r\n            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n              En el período actual\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">\r\n                  Nivel Alto\r\n                </p>\r\n                <p className=\"text-2xl font-bold text-gray-900 dark:text-gray-100 mt-1\">\r\n                  {brotes.filter(b => b.nivel === 'alto').length}\r\n                </p>\r\n              </div>\r\n              <div className=\"p-3 bg-red-50 dark:bg-red-900/20 rounded-lg\">\r\n                <TrendingUp className=\"h-6 w-6 text-red-600 dark:text-red-400\" />\r\n              </div>\r\n            </div>\r\n            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n              Requieren atención inmediata\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">\r\n                  En Monitoreo\r\n                </p>\r\n                <p className=\"text-2xl font-bold text-gray-900 dark:text-gray-100 mt-1\">\r\n                  {brotes.filter(b => b.nivel === 'medio' || b.nivel === 'bajo').length}\r\n                </p>\r\n              </div>\r\n              <div className=\"p-3 bg-orange-50 dark:bg-orange-900/20 rounded-lg\">\r\n                <Activity className=\"h-6 w-6 text-orange-600 dark:text-orange-400\" />\r\n              </div>\r\n            </div>\r\n            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n              Nivel medio y bajo\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Lista de Brotes */}\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"flex items-center gap-2\">\r\n            <AlertTriangle className=\"h-5 w-5\" />\r\n            Brotes Epidemiológicos Detectados\r\n          </CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          {brotes.length > 0 ? (\r\n            <div className=\"space-y-4\">\r\n              {brotes.map((brote, index) => (\r\n                <div\r\n                  key={index}\r\n                  className=\"flex items-center justify-between p-4 border dark:border-gray-800 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-900/50 transition-colors\"\r\n                >\r\n                  <div className=\"flex-1\">\r\n                    <div className=\"flex items-center gap-3 mb-2\">\r\n                      <h4 className=\"font-semibold text-gray-900 dark:text-gray-100\">\r\n                        {brote.diagnostico}\r\n                      </h4>\r\n                      <Badge className={getNivelColor(brote.nivel)}>\r\n                        {brote.nivel.toUpperCase()}\r\n                      </Badge>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400\">\r\n                      <span className=\"flex items-center gap-1\">\r\n                        <Activity className=\"h-4 w-4\" />\r\n                        {brote.casos} casos\r\n                      </span>\r\n                      <span className=\"flex items-center gap-1\">\r\n                        <TrendingUp className=\"h-4 w-4\" />\r\n                        +{brote.tendencia.toFixed(0)}% vs período anterior\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          ) : (\r\n            <div className=\"text-center py-12\">\r\n              <div className=\"inline-flex items-center justify-center w-16 h-16 rounded-full bg-green-50 dark:bg-green-900/20 mb-4\">\r\n                <Activity className=\"h-8 w-8 text-green-600 dark:text-green-400\" />\r\n              </div>\r\n              <h3 className=\"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2\">\r\n                No se detectaron brotes\r\n              </h3>\r\n              <p className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                No hay incrementos significativos en diagnósticos durante este período\r\n              </p>\r\n            </div>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Información del Algoritmo */}\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle>Sobre la Detección de Brotes</CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"space-y-2 text-sm text-gray-600 dark:text-gray-400\">\r\n            <p>\r\n              El sistema detecta brotes comparando el número de casos en el período actual\r\n              con el período anterior de igual duración.\r\n            </p>\r\n            <p className=\"font-medium text-gray-900 dark:text-gray-100\">Criterios de detección:</p>\r\n            <ul className=\"list-disc list-inside space-y-1 ml-2\">\r\n              <li>Mínimo 3 casos en el período actual</li>\r\n              <li>Incremento mayor al 50% respecto al período anterior</li>\r\n              <li><span className=\"font-semibold text-red-600\">Alto:</span> Incremento &gt; 200%</li>\r\n              <li><span className=\"font-semibold text-orange-600\">Medio:</span> Incremento 100-200%</li>\r\n              <li><span className=\"font-semibold text-yellow-600\">Bajo:</span> Incremento 50-100%</li>\r\n            </ul>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\estadisticas\\tabs\\eficiencia-tab.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadEficiencia'. Either include it or remove the dependency array.","line":36,"column":6,"nodeType":"ArrayExpression","endLine":36,"endColumn":27,"suggestions":[{"desc":"Update the dependencies array to be: [doctorId, dateRange, loadEficiencia]","fix":{"range":[1009,1030],"text":"[doctorId, dateRange, loadEficiencia]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file eficiencia-tab.tsx\r\n * @description Tab 7: Eficiencia Operativa conectado a Supabase\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport { Skeleton } from \"@red-salud/ui\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { TrendingUp, Clock, XCircle, CheckCircle } from \"lucide-react\";\r\n\r\ninterface EficienciaTabProps {\r\n  doctorId: string;\r\n  dateRange: { start: Date; end: Date };\r\n}\r\n\r\ninterface EficienciaStats {\r\n  consultasPorDia: number;\r\n  tasaNoShows: number;\r\n  tasaCancelaciones: number;\r\n  tasaCompletadas: number;\r\n  totalCitas: number;\r\n  citasCompletadas: number;\r\n  citasCanceladas: number;\r\n  citasNoShow: number;\r\n}\r\n\r\nexport function EficienciaTab({ doctorId, dateRange }: EficienciaTabProps) {\r\n  const [stats, setStats] = useState<EficienciaStats | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    loadEficiencia();\r\n  }, [doctorId, dateRange]);\r\n\r\n  const loadEficiencia = async () => {\r\n    try {\r\n      setLoading(true);\r\n\r\n      // Total de citas en el período\r\n      const { count: totalCitas } = await supabase\r\n        .from('appointments')\r\n        .select('*', { count: 'exact', head: true })\r\n        .eq('doctor_id', doctorId)\r\n        .gte('appointment_date', dateRange.start.toISOString())\r\n        .lte('appointment_date', dateRange.end.toISOString());\r\n\r\n      // Citas completadas\r\n      const { count: citasCompletadas } = await supabase\r\n        .from('appointments')\r\n        .select('*', { count: 'exact', head: true })\r\n        .eq('doctor_id', doctorId)\r\n        .eq('status', 'completed')\r\n        .gte('appointment_date', dateRange.start.toISOString())\r\n        .lte('appointment_date', dateRange.end.toISOString());\r\n\r\n      // Citas canceladas\r\n      const { count: citasCanceladas } = await supabase\r\n        .from('appointments')\r\n        .select('*', { count: 'exact', head: true })\r\n        .eq('doctor_id', doctorId)\r\n        .eq('status', 'cancelled')\r\n        .gte('appointment_date', dateRange.start.toISOString())\r\n        .lte('appointment_date', dateRange.end.toISOString());\r\n\r\n      // No-shows (simulado como citas no completadas ni canceladas)\r\n      const citasNoShow = (totalCitas || 0) - (citasCompletadas || 0) - (citasCanceladas || 0);\r\n\r\n      // Calcular días en el período\r\n      const dias = Math.ceil((dateRange.end.getTime() - dateRange.start.getTime()) / (1000 * 60 * 60 * 24));\r\n      const consultasPorDia = dias > 0 ? (totalCitas || 0) / dias : 0;\r\n\r\n      const tasaCompletadas = totalCitas ? ((citasCompletadas || 0) / totalCitas) * 100 : 0;\r\n      const tasaCancelaciones = totalCitas ? ((citasCanceladas || 0) / totalCitas) * 100 : 0;\r\n      const tasaNoShows = totalCitas ? (citasNoShow / totalCitas) * 100 : 0;\r\n\r\n      setStats({\r\n        consultasPorDia,\r\n        tasaNoShows,\r\n        tasaCancelaciones,\r\n        tasaCompletadas,\r\n        totalCitas: totalCitas || 0,\r\n        citasCompletadas: citasCompletadas || 0,\r\n        citasCanceladas: citasCanceladas || 0,\r\n        citasNoShow,\r\n      });\r\n    } catch (error) {\r\n      console.error(\"Error loading eficiencia:\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"space-y-6\">\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n          {[1, 2, 3, 4].map((i) => (\r\n            <Card key={i}>\r\n              <CardContent className=\"pt-6\">\r\n                <Skeleton className=\"h-4 w-24 mb-2\" />\r\n                <Skeleton className=\"h-8 w-16 mb-2\" />\r\n                <Skeleton className=\"h-3 w-full\" />\r\n              </CardContent>\r\n            </Card>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!stats) return null;\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">\r\n                  Consultas/Día\r\n                </p>\r\n                <p className=\"text-2xl font-bold text-gray-900 dark:text-gray-100 mt-1\">\r\n                  {stats.consultasPorDia.toFixed(1)}\r\n                </p>\r\n              </div>\r\n              <div className=\"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg\">\r\n                <TrendingUp className=\"h-6 w-6 text-blue-600 dark:text-blue-400\" />\r\n              </div>\r\n            </div>\r\n            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n              Promedio del período\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">\r\n                  Tasa Completadas\r\n                </p>\r\n                <p className=\"text-2xl font-bold text-gray-900 dark:text-gray-100 mt-1\">\r\n                  {stats.tasaCompletadas.toFixed(1)}%\r\n                </p>\r\n              </div>\r\n              <div className=\"p-3 bg-green-50 dark:bg-green-900/20 rounded-lg\">\r\n                <CheckCircle className=\"h-6 w-6 text-green-600 dark:text-green-400\" />\r\n              </div>\r\n            </div>\r\n            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n              {stats.citasCompletadas} de {stats.totalCitas} citas\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">\r\n                  Tasa Cancelación\r\n                </p>\r\n                <p className=\"text-2xl font-bold text-gray-900 dark:text-gray-100 mt-1\">\r\n                  {stats.tasaCancelaciones.toFixed(1)}%\r\n                </p>\r\n              </div>\r\n              <div className=\"p-3 bg-orange-50 dark:bg-orange-900/20 rounded-lg\">\r\n                <XCircle className=\"h-6 w-6 text-orange-600 dark:text-orange-400\" />\r\n              </div>\r\n            </div>\r\n            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n              {stats.citasCanceladas} citas canceladas\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">\r\n                  Tasa No-Show\r\n                </p>\r\n                <p className=\"text-2xl font-bold text-gray-900 dark:text-gray-100 mt-1\">\r\n                  {stats.tasaNoShows.toFixed(1)}%\r\n                </p>\r\n              </div>\r\n              <div className=\"p-3 bg-red-50 dark:bg-red-900/20 rounded-lg\">\r\n                <Clock className=\"h-6 w-6 text-red-600 dark:text-red-400\" />\r\n              </div>\r\n            </div>\r\n            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n              {stats.citasNoShow} pacientes no asistieron\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle>Resumen de Eficiencia</CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"space-y-4\">\r\n            <div className=\"space-y-2\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <span className=\"text-sm text-gray-600 dark:text-gray-400\">Citas Completadas</span>\r\n                <span className=\"text-sm font-semibold text-green-600\">\r\n                  {stats.citasCompletadas} ({stats.tasaCompletadas.toFixed(1)}%)\r\n                </span>\r\n              </div>\r\n              <div className=\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2\">\r\n                <div\r\n                  className=\"bg-green-600 h-2 rounded-full transition-all\"\r\n                  style={{ width: `${stats.tasaCompletadas}%` }}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"space-y-2\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <span className=\"text-sm text-gray-600 dark:text-gray-400\">Citas Canceladas</span>\r\n                <span className=\"text-sm font-semibold text-orange-600\">\r\n                  {stats.citasCanceladas} ({stats.tasaCancelaciones.toFixed(1)}%)\r\n                </span>\r\n              </div>\r\n              <div className=\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2\">\r\n                <div\r\n                  className=\"bg-orange-600 h-2 rounded-full transition-all\"\r\n                  style={{ width: `${stats.tasaCancelaciones}%` }}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"space-y-2\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <span className=\"text-sm text-gray-600 dark:text-gray-400\">No-Shows</span>\r\n                <span className=\"text-sm font-semibold text-red-600\">\r\n                  {stats.citasNoShow} ({stats.tasaNoShows.toFixed(1)}%)\r\n                </span>\r\n              </div>\r\n              <div className=\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2\">\r\n                <div\r\n                  className=\"bg-red-600 h-2 rounded-full transition-all\"\r\n                  style={{ width: `${stats.tasaNoShows}%` }}\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\estadisticas\\tabs\\enfermedades-tab.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadEnfermedades'. Either include it or remove the dependency array.","line":30,"column":6,"nodeType":"ArrayExpression","endLine":30,"endColumn":27,"suggestions":[{"desc":"Update the dependencies array to be: [doctorId, dateRange, loadEnfermedades]","fix":{"range":[852,873],"text":"[doctorId, dateRange, loadEnfermedades]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file enfermedades-tab.tsx\r\n * @description Tab 3: Enfermedades & Epidemiología conectado a Supabase\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport { Skeleton } from \"@red-salud/ui\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { Activity, AlertCircle } from \"lucide-react\";\r\n\r\ninterface EnfermedadesTabProps {\r\n  doctorId: string;\r\n  dateRange: { start: Date; end: Date };\r\n}\r\n\r\ninterface DiagnosticoCount {\r\n  diagnostico: string;\r\n  count: number;\r\n}\r\n\r\nexport function EnfermedadesTab({ doctorId, dateRange }: EnfermedadesTabProps) {\r\n  const [topDiagnosticos, setTopDiagnosticos] = useState<DiagnosticoCount[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    loadEnfermedades();\r\n  }, [doctorId, dateRange]);\r\n\r\n  const loadEnfermedades = async () => {\r\n    try {\r\n      setLoading(true);\r\n\r\n      // Obtener diagnósticos de las consultas médicas\r\n      const { data: records } = await supabase\r\n        .from('medical_records')\r\n        .select('diagnosis')\r\n        .eq('doctor_id', doctorId)\r\n        .not('diagnosis', 'is', null)\r\n        .gte('created_at', dateRange.start.toISOString())\r\n        .lte('created_at', dateRange.end.toISOString());\r\n\r\n      if (records) {\r\n        // Contar diagnósticos\r\n        const diagnosticosMap = new Map<string, number>();\r\n        records.forEach(record => {\r\n          if (record.diagnosis) {\r\n            const count = diagnosticosMap.get(record.diagnosis) || 0;\r\n            diagnosticosMap.set(record.diagnosis, count + 1);\r\n          }\r\n        });\r\n\r\n        // Convertir a array y ordenar\r\n        const sorted = Array.from(diagnosticosMap.entries())\r\n          .map(([diagnostico, count]) => ({ diagnostico, count }))\r\n          .sort((a, b) => b.count - a.count)\r\n          .slice(0, 10);\r\n\r\n        setTopDiagnosticos(sorted);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error loading enfermedades:\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"space-y-6\">\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <Skeleton className=\"h-64 w-full\" />\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"flex items-center gap-2\">\r\n            <Activity className=\"h-5 w-5\" />\r\n            Top 10 Diagnósticos\r\n          </CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          {topDiagnosticos.length > 0 ? (\r\n            <div className=\"space-y-4\">\r\n              {topDiagnosticos.map((item, index) => (\r\n                <div key={index} className=\"space-y-2\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <span className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                      {index + 1}. {item.diagnostico}\r\n                    </span>\r\n                    <span className=\"text-sm font-semibold text-gray-900 dark:text-gray-100\">\r\n                      {item.count} casos\r\n                    </span>\r\n                  </div>\r\n                  <div className=\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2\">\r\n                    <div\r\n                      className=\"bg-gradient-to-r from-blue-500 to-purple-600 h-2 rounded-full transition-all\"\r\n                      style={{ \r\n                        width: `${topDiagnosticos[0] ? (item.count / topDiagnosticos[0].count) * 100 : 0}%` \r\n                      }}\r\n                    />\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          ) : (\r\n            <div className=\"flex items-center gap-2 text-gray-500\">\r\n              <AlertCircle className=\"h-5 w-5\" />\r\n              <p>No hay datos de diagnósticos en el período seleccionado</p>\r\n            </div>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\estadisticas\\tabs\\finanzas-tab.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadFinanzas'. Either include it or remove the dependency array.","line":35,"column":6,"nodeType":"ArrayExpression","endLine":35,"endColumn":27,"suggestions":[{"desc":"Update the dependencies array to be: [doctorId, dateRange, loadFinanzas]","fix":{"range":[967,988],"text":"[doctorId, dateRange, loadFinanzas]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file finanzas-tab.tsx\r\n * @description Tab 4: Finanzas & RCM conectado a Supabase\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport { Skeleton } from \"@red-salud/ui\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { DollarSign, TrendingUp, CreditCard, Clock } from \"lucide-react\";\r\n\r\ninterface FinanzasTabProps {\r\n  doctorId: string;\r\n  dateRange: { start: Date; end: Date };\r\n}\r\n\r\ninterface FinanzasStats {\r\n  ingresosTotal: number;\r\n  ingresosMesActual: number;\r\n  ingresosMesAnterior: number;\r\n  ticketPromedio: number;\r\n  citasPagadas: number;\r\n  citasPendientes: number;\r\n  tasaCobro: number;\r\n}\r\n\r\nexport function FinanzasTab({ doctorId, dateRange }: FinanzasTabProps) {\r\n  const [stats, setStats] = useState<FinanzasStats | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    loadFinanzas();\r\n  }, [doctorId, dateRange]);\r\n\r\n  const loadFinanzas = async () => {\r\n    try {\r\n      setLoading(true);\r\n\r\n      const now = new Date();\r\n      const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);\r\n      const startOfLastMonth = new Date(now.getFullYear(), now.getMonth() - 1, 1);\r\n      const endOfLastMonth = new Date(now.getFullYear(), now.getMonth(), 0);\r\n\r\n      // Ingresos totales\r\n      const { data: todasCitas } = await supabase\r\n        .from('appointments')\r\n        .select('price, status')\r\n        .eq('doctor_id', doctorId)\r\n        .eq('status', 'completed');\r\n\r\n      const ingresosTotal = todasCitas?.reduce((sum, cita) => sum + (cita.price || 0), 0) || 0;\r\n\r\n      // Ingresos mes actual\r\n      const { data: citasMesActual } = await supabase\r\n        .from('appointments')\r\n        .select('price')\r\n        .eq('doctor_id', doctorId)\r\n        .eq('status', 'completed')\r\n        .gte('appointment_date', startOfMonth.toISOString());\r\n\r\n      const ingresosMesActual = citasMesActual?.reduce((sum, cita) => sum + (cita.price || 0), 0) || 0;\r\n\r\n      // Ingresos mes anterior\r\n      const { data: citasMesAnterior } = await supabase\r\n        .from('appointments')\r\n        .select('price')\r\n        .eq('doctor_id', doctorId)\r\n        .eq('status', 'completed')\r\n        .gte('appointment_date', startOfLastMonth.toISOString())\r\n        .lte('appointment_date', endOfLastMonth.toISOString());\r\n\r\n      const ingresosMesAnterior = citasMesAnterior?.reduce((sum, cita) => sum + (cita.price || 0), 0) || 0;\r\n\r\n      // Citas pagadas y pendientes\r\n      const { count: citasPagadas } = await supabase\r\n        .from('appointments')\r\n        .select('*', { count: 'exact', head: true })\r\n        .eq('doctor_id', doctorId)\r\n        .eq('status', 'completed');\r\n\r\n      const { count: citasPendientes } = await supabase\r\n        .from('appointments')\r\n        .select('*', { count: 'exact', head: true })\r\n        .eq('doctor_id', doctorId)\r\n        .eq('status', 'scheduled');\r\n\r\n      const ticketPromedio = citasPagadas && citasPagadas > 0 ? ingresosTotal / citasPagadas : 0;\r\n      const tasaCobro = (citasPagadas || 0) + (citasPendientes || 0) > 0\r\n        ? ((citasPagadas || 0) / ((citasPagadas || 0) + (citasPendientes || 0))) * 100\r\n        : 0;\r\n\r\n      setStats({\r\n        ingresosTotal,\r\n        ingresosMesActual,\r\n        ingresosMesAnterior,\r\n        ticketPromedio,\r\n        citasPagadas: citasPagadas || 0,\r\n        citasPendientes: citasPendientes || 0,\r\n        tasaCobro,\r\n      });\r\n    } catch (error) {\r\n      console.error(\"Error loading finanzas:\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"space-y-6\">\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n          {[1, 2, 3, 4].map((i) => (\r\n            <Card key={i}>\r\n              <CardContent className=\"pt-6\">\r\n                <Skeleton className=\"h-4 w-24 mb-2\" />\r\n                <Skeleton className=\"h-8 w-16 mb-2\" />\r\n                <Skeleton className=\"h-3 w-full\" />\r\n              </CardContent>\r\n            </Card>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!stats) return null;\r\n\r\n  const cambioIngresos = stats.ingresosMesAnterior > 0\r\n    ? ((stats.ingresosMesActual - stats.ingresosMesAnterior) / stats.ingresosMesAnterior) * 100\r\n    : 0;\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">\r\n                  Ingresos Totales\r\n                </p>\r\n                <p className=\"text-2xl font-bold text-gray-900 dark:text-gray-100 mt-1\">\r\n                  ${stats.ingresosTotal.toLocaleString()}\r\n                </p>\r\n              </div>\r\n              <div className=\"p-3 bg-green-50 dark:bg-green-900/20 rounded-lg\">\r\n                <DollarSign className=\"h-6 w-6 text-green-600 dark:text-green-400\" />\r\n              </div>\r\n            </div>\r\n            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n              Histórico completo\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">\r\n                  Mes Actual\r\n                </p>\r\n                <p className=\"text-2xl font-bold text-gray-900 dark:text-gray-100 mt-1\">\r\n                  ${stats.ingresosMesActual.toLocaleString()}\r\n                </p>\r\n              </div>\r\n              <div className=\"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg\">\r\n                <TrendingUp className=\"h-6 w-6 text-blue-600 dark:text-blue-400\" />\r\n              </div>\r\n            </div>\r\n            <p className={`text-xs mt-2 ${cambioIngresos >= 0 ? 'text-green-600' : 'text-red-600'}`}>\r\n              {cambioIngresos >= 0 ? '+' : ''}{cambioIngresos.toFixed(1)}% vs mes anterior\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">\r\n                  Ticket Promedio\r\n                </p>\r\n                <p className=\"text-2xl font-bold text-gray-900 dark:text-gray-100 mt-1\">\r\n                  ${Math.round(stats.ticketPromedio).toLocaleString()}\r\n                </p>\r\n              </div>\r\n              <div className=\"p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg\">\r\n                <CreditCard className=\"h-6 w-6 text-purple-600 dark:text-purple-400\" />\r\n              </div>\r\n            </div>\r\n            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n              Por consulta\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">\r\n                  Tasa de Cobro\r\n                </p>\r\n                <p className=\"text-2xl font-bold text-gray-900 dark:text-gray-100 mt-1\">\r\n                  {stats.tasaCobro.toFixed(1)}%\r\n                </p>\r\n              </div>\r\n              <div className=\"p-3 bg-orange-50 dark:bg-orange-900/20 rounded-lg\">\r\n                <Clock className=\"h-6 w-6 text-orange-600 dark:text-orange-400\" />\r\n              </div>\r\n            </div>\r\n            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n              Citas cobradas\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle>Resumen Financiero</CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"space-y-3\">\r\n            <div className=\"flex items-center justify-between py-2 border-b dark:border-gray-800\">\r\n              <span className=\"text-sm text-gray-600 dark:text-gray-400\">Citas pagadas</span>\r\n              <span className=\"text-sm font-semibold text-gray-900 dark:text-gray-100\">\r\n                {stats.citasPagadas}\r\n              </span>\r\n            </div>\r\n            <div className=\"flex items-center justify-between py-2 border-b dark:border-gray-800\">\r\n              <span className=\"text-sm text-gray-600 dark:text-gray-400\">Citas pendientes</span>\r\n              <span className=\"text-sm font-semibold text-gray-900 dark:text-gray-100\">\r\n                {stats.citasPendientes}\r\n              </span>\r\n            </div>\r\n            <div className=\"flex items-center justify-between py-2\">\r\n              <span className=\"text-sm text-gray-600 dark:text-gray-400\">Ingresos mes anterior</span>\r\n              <span className=\"text-sm font-semibold text-gray-900 dark:text-gray-100\">\r\n                ${stats.ingresosMesAnterior.toLocaleString()}\r\n              </span>\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\estadisticas\\tabs\\laboratorio-tab.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadLaboratorio'. Either include it or remove the dependency array.","line":32,"column":6,"nodeType":"ArrayExpression","endLine":32,"endColumn":27,"suggestions":[{"desc":"Update the dependencies array to be: [doctorId, dateRange, loadLaboratorio]","fix":{"range":[960,981],"text":"[doctorId, dateRange, loadLaboratorio]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file laboratorio-tab.tsx\r\n * @description Tab 6: Laboratorio & Medicamentos conectado a Supabase\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport { Skeleton } from \"@red-salud/ui\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { FlaskConical, Pill, AlertCircle } from \"lucide-react\";\r\n\r\ninterface LaboratorioTabProps {\r\n  doctorId: string;\r\n  dateRange: { start: Date; end: Date };\r\n}\r\n\r\ninterface LabStats {\r\n  totalExamenes: number;\r\n  totalMedicamentos: number;\r\n  topExamenes: Array<{ nombre: string; count: number }>;\r\n  topMedicamentos: Array<{ nombre: string; count: number }>;\r\n}\r\n\r\nexport function LaboratorioTab({ doctorId, dateRange }: LaboratorioTabProps) {\r\n  const [stats, setStats] = useState<LabStats | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    loadLaboratorio();\r\n  }, [doctorId, dateRange]);\r\n\r\n  const loadLaboratorio = async () => {\r\n    try {\r\n      setLoading(true);\r\n\r\n      // Obtener exámenes de laboratorio\r\n      const { data: labResults } = await supabase\r\n        .from('laboratory_results')\r\n        .select('test_name')\r\n        .eq('doctor_id', doctorId)\r\n        .gte('created_at', dateRange.start.toISOString())\r\n        .lte('created_at', dateRange.end.toISOString());\r\n\r\n      // Obtener medicamentos recipedos\r\n      const { data: medications } = await supabase\r\n        .from('medications')\r\n        .select('name')\r\n        .eq('doctor_id', doctorId)\r\n        .gte('created_at', dateRange.start.toISOString())\r\n        .lte('created_at', dateRange.end.toISOString());\r\n\r\n      // Procesar exámenes\r\n      const examenesMap = new Map<string, number>();\r\n      labResults?.forEach(result => {\r\n        if (result.test_name) {\r\n          examenesMap.set(result.test_name, (examenesMap.get(result.test_name) || 0) + 1);\r\n        }\r\n      });\r\n\r\n      const topExamenes = Array.from(examenesMap.entries())\r\n        .map(([nombre, count]) => ({ nombre, count }))\r\n        .sort((a, b) => b.count - a.count)\r\n        .slice(0, 10);\r\n\r\n      // Procesar medicamentos\r\n      const medicamentosMap = new Map<string, number>();\r\n      medications?.forEach(med => {\r\n        if (med.name) {\r\n          medicamentosMap.set(med.name, (medicamentosMap.get(med.name) || 0) + 1);\r\n        }\r\n      });\r\n\r\n      const topMedicamentos = Array.from(medicamentosMap.entries())\r\n        .map(([nombre, count]) => ({ nombre, count }))\r\n        .sort((a, b) => b.count - a.count)\r\n        .slice(0, 10);\r\n\r\n      setStats({\r\n        totalExamenes: labResults?.length || 0,\r\n        totalMedicamentos: medications?.length || 0,\r\n        topExamenes,\r\n        topMedicamentos,\r\n      });\r\n    } catch (error) {\r\n      console.error(\"Error loading laboratorio:\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"space-y-6\">\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n          {[1, 2].map((i) => (\r\n            <Card key={i}>\r\n              <CardContent className=\"pt-6\">\r\n                <Skeleton className=\"h-64 w-full\" />\r\n              </CardContent>\r\n            </Card>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!stats) return null;\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n        {/* Exámenes de Laboratorio */}\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <FlaskConical className=\"h-5 w-5\" />\r\n              Exámenes Más Solicitados\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            {stats.topExamenes.length > 0 ? (\r\n              <div className=\"space-y-4\">\r\n                {stats.topExamenes.map((item, index) => (\r\n                  <div key={index} className=\"space-y-2\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <span className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                        {index + 1}. {item.nombre}\r\n                      </span>\r\n                      <span className=\"text-sm font-semibold text-gray-900 dark:text-gray-100\">\r\n                        {item.count}\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2\">\r\n                      <div\r\n                        className=\"bg-blue-600 h-2 rounded-full transition-all\"\r\n                        style={{ \r\n                          width: `${stats.topExamenes[0] ? (item.count / stats.topExamenes[0].count) * 100 : 0}%` \r\n                        }}\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n                <div className=\"pt-4 border-t dark:border-gray-800\">\r\n                  <p className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                    Total de exámenes: <span className=\"font-semibold\">{stats.totalExamenes}</span>\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"flex items-center gap-2 text-gray-500\">\r\n                <AlertCircle className=\"h-5 w-5\" />\r\n                <p>No hay datos de exámenes en el período</p>\r\n              </div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Medicamentos */}\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <Pill className=\"h-5 w-5\" />\r\n              Medicamentos Más recipedos\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            {stats.topMedicamentos.length > 0 ? (\r\n              <div className=\"space-y-4\">\r\n                {stats.topMedicamentos.map((item, index) => (\r\n                  <div key={index} className=\"space-y-2\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <span className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                        {index + 1}. {item.nombre}\r\n                      </span>\r\n                      <span className=\"text-sm font-semibold text-gray-900 dark:text-gray-100\">\r\n                        {item.count}\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2\">\r\n                      <div\r\n                        className=\"bg-green-600 h-2 rounded-full transition-all\"\r\n                        style={{ \r\n                          width: `${stats.topMedicamentos[0] ? (item.count / stats.topMedicamentos[0].count) * 100 : 0}%` \r\n                        }}\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n                <div className=\"pt-4 border-t dark:border-gray-800\">\r\n                  <p className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                    Total de recipe: <span className=\"font-semibold\">{stats.totalMedicamentos}</span>\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"flex items-center gap-2 text-gray-500\">\r\n                <AlertCircle className=\"h-5 w-5\" />\r\n                <p>No hay datos de medicamentos en el período</p>\r\n              </div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\estadisticas\\tabs\\pacientes-tab.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadDemografia'. Either include it or remove the dependency array.","line":34,"column":6,"nodeType":"ArrayExpression","endLine":34,"endColumn":27,"suggestions":[{"desc":"Update the dependencies array to be: [doctorId, dateRange, loadDemografia]","fix":{"range":[1001,1022],"text":"[doctorId, dateRange, loadDemografia]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file pacientes-tab.tsx\r\n * @description Tab 2: Pacientes & Demografía conectado a Supabase\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport { Skeleton } from \"@red-salud/ui\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { Users, MapPin, Heart, Activity } from \"lucide-react\";\r\n\r\ninterface PacientesTabProps {\r\n  doctorId: string;\r\n  dateRange: { start: Date; end: Date };\r\n}\r\n\r\ninterface DemografiaStats {\r\n  totalPacientes: number;\r\n  porGenero: { masculino: number; femenino: number; otro: number };\r\n  porEdad: { [key: string]: number };\r\n  pacientesActivos: number;\r\n  pacientesNuevos: number;\r\n  promedioEdad: number;\r\n}\r\n\r\nexport function PacientesTab({ doctorId, dateRange }: PacientesTabProps) {\r\n  const [stats, setStats] = useState<DemografiaStats | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    loadDemografia();\r\n  }, [doctorId, dateRange]);\r\n\r\n  const loadDemografia = async () => {\r\n    try {\r\n      setLoading(true);\r\n\r\n      // Obtener todos los pacientes del médico\r\n      const { data: appointments } = await supabase\r\n        .from('appointments')\r\n        .select(`\r\n          patient_id,\r\n          created_at,\r\n          patients:patient_id (\r\n            id,\r\n            gender,\r\n            date_of_birth\r\n          )\r\n        `)\r\n        .eq('doctor_id', doctorId)\r\n        .not('patient_id', 'is', null);\r\n\r\n      if (!appointments) {\r\n        setStats({\r\n          totalPacientes: 0,\r\n          porGenero: { masculino: 0, femenino: 0, otro: 0 },\r\n          porEdad: {},\r\n          pacientesActivos: 0,\r\n          pacientesNuevos: 0,\r\n          promedioEdad: 0,\r\n        });\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      // Obtener pacientes únicos\r\n      const pacientesUnicos = new Map();\r\n      appointments.forEach(apt => {\r\n        if (apt.patients && !pacientesUnicos.has(apt.patient_id)) {\r\n          pacientesUnicos.set(apt.patient_id, {\r\n            ...apt.patients,\r\n            firstVisit: apt.created_at\r\n          });\r\n        }\r\n      });\r\n\r\n      const pacientes = Array.from(pacientesUnicos.values());\r\n\r\n      // Calcular estadísticas por género\r\n      const porGenero = {\r\n        masculino: pacientes.filter(p => p.gender === 'male').length,\r\n        femenino: pacientes.filter(p => p.gender === 'female').length,\r\n        otro: pacientes.filter(p => p.gender !== 'male' && p.gender !== 'female').length,\r\n      };\r\n\r\n      // Calcular distribución por edad\r\n      const porEdad: { [key: string]: number } = {\r\n        '0-17': 0,\r\n        '18-30': 0,\r\n        '31-45': 0,\r\n        '46-60': 0,\r\n        '61+': 0,\r\n      };\r\n\r\n      let sumaEdades = 0;\r\n      let countEdades = 0;\r\n\r\n      pacientes.forEach(p => {\r\n        if (p.date_of_birth) {\r\n          const edad = new Date().getFullYear() - new Date(p.date_of_birth).getFullYear();\r\n          sumaEdades += edad;\r\n          countEdades++;\r\n\r\n          if (edad < 18) porEdad['0-17']++;\r\n          else if (edad <= 30) porEdad['18-30']++;\r\n          else if (edad <= 45) porEdad['31-45']++;\r\n          else if (edad <= 60) porEdad['46-60']++;\r\n          else porEdad['61+']++;\r\n        }\r\n      });\r\n\r\n      // Pacientes activos (con cita en los últimos 90 días)\r\n      const hace90Dias = new Date();\r\n      hace90Dias.setDate(hace90Dias.getDate() - 90);\r\n      \r\n      const { count: pacientesActivos } = await supabase\r\n        .from('appointments')\r\n        .select('patient_id', { count: 'exact', head: true })\r\n        .eq('doctor_id', doctorId)\r\n        .gte('appointment_date', hace90Dias.toISOString());\r\n\r\n      // Pacientes nuevos (primer cita en el rango de fechas)\r\n      const pacientesNuevos = pacientes.filter(p => {\r\n        const firstVisit = new Date(p.firstVisit);\r\n        return firstVisit >= dateRange.start && firstVisit <= dateRange.end;\r\n      }).length;\r\n\r\n      setStats({\r\n        totalPacientes: pacientes.length,\r\n        porGenero,\r\n        porEdad,\r\n        pacientesActivos: pacientesActivos || 0,\r\n        pacientesNuevos,\r\n        promedioEdad: countEdades > 0 ? Math.round(sumaEdades / countEdades) : 0,\r\n      });\r\n    } catch (error) {\r\n      console.error(\"Error loading demografia:\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"space-y-6\">\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n          {[1, 2, 3, 4].map((i) => (\r\n            <Card key={i}>\r\n              <CardContent className=\"pt-6\">\r\n                <Skeleton className=\"h-4 w-24 mb-2\" />\r\n                <Skeleton className=\"h-8 w-16 mb-2\" />\r\n                <Skeleton className=\"h-3 w-full\" />\r\n              </CardContent>\r\n            </Card>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!stats) return null;\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* KPIs Principales */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">\r\n                  Total Pacientes\r\n                </p>\r\n                <p className=\"text-2xl font-bold text-gray-900 dark:text-gray-100 mt-1\">\r\n                  {stats.totalPacientes}\r\n                </p>\r\n              </div>\r\n              <div className=\"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg\">\r\n                <Users className=\"h-6 w-6 text-blue-600 dark:text-blue-400\" />\r\n              </div>\r\n            </div>\r\n            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n              Pacientes únicos\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">\r\n                  Pacientes Activos\r\n                </p>\r\n                <p className=\"text-2xl font-bold text-gray-900 dark:text-gray-100 mt-1\">\r\n                  {stats.pacientesActivos}\r\n                </p>\r\n              </div>\r\n              <div className=\"p-3 bg-green-50 dark:bg-green-900/20 rounded-lg\">\r\n                <Activity className=\"h-6 w-6 text-green-600 dark:text-green-400\" />\r\n              </div>\r\n            </div>\r\n            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n              Últimos 90 días\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">\r\n                  Nuevos Pacientes\r\n                </p>\r\n                <p className=\"text-2xl font-bold text-gray-900 dark:text-gray-100 mt-1\">\r\n                  {stats.pacientesNuevos}\r\n                </p>\r\n              </div>\r\n              <div className=\"p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg\">\r\n                <Heart className=\"h-6 w-6 text-purple-600 dark:text-purple-400\" />\r\n              </div>\r\n            </div>\r\n            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n              En el período\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">\r\n                  Edad Promedio\r\n                </p>\r\n                <p className=\"text-2xl font-bold text-gray-900 dark:text-gray-100 mt-1\">\r\n                  {stats.promedioEdad} años\r\n                </p>\r\n              </div>\r\n              <div className=\"p-3 bg-orange-50 dark:bg-orange-900/20 rounded-lg\">\r\n                <MapPin className=\"h-6 w-6 text-orange-600 dark:text-orange-400\" />\r\n              </div>\r\n            </div>\r\n            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n              De todos los pacientes\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Distribución por Género */}\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle>Distribución por Género</CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"space-y-4\">\r\n            <div className=\"space-y-2\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <span className=\"text-sm text-gray-600 dark:text-gray-400\">Masculino</span>\r\n                <span className=\"text-sm font-semibold text-gray-900 dark:text-gray-100\">\r\n                  {stats.porGenero.masculino} ({stats.totalPacientes > 0 ? ((stats.porGenero.masculino / stats.totalPacientes) * 100).toFixed(1) : 0}%)\r\n                </span>\r\n              </div>\r\n              <div className=\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2\">\r\n                <div\r\n                  className=\"bg-blue-600 h-2 rounded-full transition-all\"\r\n                  style={{ width: `${stats.totalPacientes > 0 ? (stats.porGenero.masculino / stats.totalPacientes) * 100 : 0}%` }}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"space-y-2\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <span className=\"text-sm text-gray-600 dark:text-gray-400\">Femenino</span>\r\n                <span className=\"text-sm font-semibold text-gray-900 dark:text-gray-100\">\r\n                  {stats.porGenero.femenino} ({stats.totalPacientes > 0 ? ((stats.porGenero.femenino / stats.totalPacientes) * 100).toFixed(1) : 0}%)\r\n                </span>\r\n              </div>\r\n              <div className=\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2\">\r\n                <div\r\n                  className=\"bg-pink-600 h-2 rounded-full transition-all\"\r\n                  style={{ width: `${stats.totalPacientes > 0 ? (stats.porGenero.femenino / stats.totalPacientes) * 100 : 0}%` }}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {stats.porGenero.otro > 0 && (\r\n              <div className=\"space-y-2\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <span className=\"text-sm text-gray-600 dark:text-gray-400\">Otro</span>\r\n                  <span className=\"text-sm font-semibold text-gray-900 dark:text-gray-100\">\r\n                    {stats.porGenero.otro} ({stats.totalPacientes > 0 ? ((stats.porGenero.otro / stats.totalPacientes) * 100).toFixed(1) : 0}%)\r\n                  </span>\r\n                </div>\r\n                <div className=\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2\">\r\n                  <div\r\n                    className=\"bg-purple-600 h-2 rounded-full transition-all\"\r\n                    style={{ width: `${stats.totalPacientes > 0 ? (stats.porGenero.otro / stats.totalPacientes) * 100 : 0}%` }}\r\n                  />\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Distribución por Edad */}\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle>Distribución por Edad</CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"space-y-4\">\r\n            {Object.entries(stats.porEdad).map(([rango, cantidad]) => (\r\n              <div key={rango} className=\"space-y-2\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <span className=\"text-sm text-gray-600 dark:text-gray-400\">{rango} años</span>\r\n                  <span className=\"text-sm font-semibold text-gray-900 dark:text-gray-100\">\r\n                    {cantidad} ({stats.totalPacientes > 0 ? ((cantidad / stats.totalPacientes) * 100).toFixed(1) : 0}%)\r\n                  </span>\r\n                </div>\r\n                <div className=\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2\">\r\n                  <div\r\n                    className=\"bg-gradient-to-r from-blue-500 to-purple-600 h-2 rounded-full transition-all\"\r\n                    style={{ width: `${stats.totalPacientes > 0 ? (cantidad / stats.totalPacientes) * 100 : 0}%` }}\r\n                  />\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\estadisticas\\tabs\\patrones-tab.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadPatrones'. Either include it or remove the dependency array.","line":36,"column":6,"nodeType":"ArrayExpression","endLine":36,"endColumn":27,"suggestions":[{"desc":"Update the dependencies array to be: [doctorId, dateRange, loadPatrones]","fix":{"range":[950,971],"text":"[doctorId, dateRange, loadPatrones]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file patrones-tab.tsx\r\n * @description Tab 5: Patrones Temporales conectado a Supabase\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport { Skeleton } from \"@red-salud/ui\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { Clock, Calendar } from \"lucide-react\";\r\n\r\ninterface PatronesTabProps {\r\n  doctorId: string;\r\n  dateRange: { start: Date; end: Date };\r\n}\r\n\r\ninterface PatronHorario {\r\n  hora: number;\r\n  count: number;\r\n}\r\n\r\ninterface PatronDiario {\r\n  dia: string;\r\n  count: number;\r\n}\r\n\r\nexport function PatronesTab({ doctorId, dateRange }: PatronesTabProps) {\r\n  const [patronesHorarios, setPatronesHorarios] = useState<PatronHorario[]>([]);\r\n  const [patronesDiarios, setPatronesDiarios] = useState<PatronDiario[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    loadPatrones();\r\n  }, [doctorId, dateRange]);\r\n\r\n  const loadPatrones = async () => {\r\n    try {\r\n      setLoading(true);\r\n\r\n      const { data: appointments } = await supabase\r\n        .from('appointments')\r\n        .select('appointment_date')\r\n        .eq('doctor_id', doctorId)\r\n        .gte('appointment_date', dateRange.start.toISOString())\r\n        .lte('appointment_date', dateRange.end.toISOString());\r\n\r\n      if (appointments) {\r\n        // Patrones horarios\r\n        const horariosMap = new Map<number, number>();\r\n        const diasMap = new Map<string, number>();\r\n        const diasSemana = ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'];\r\n\r\n        appointments.forEach(apt => {\r\n          const fecha = new Date(apt.appointment_date);\r\n          const hora = fecha.getHours();\r\n          const dia = diasSemana[fecha.getDay()];\r\n\r\n          horariosMap.set(hora, (horariosMap.get(hora) || 0) + 1);\r\n          diasMap.set(dia, (diasMap.get(dia) || 0) + 1);\r\n        });\r\n\r\n        const horarios = Array.from(horariosMap.entries())\r\n          .map(([hora, count]) => ({ hora, count }))\r\n          .sort((a, b) => a.hora - b.hora);\r\n\r\n        const dias = diasSemana.map(dia => ({\r\n          dia,\r\n          count: diasMap.get(dia) || 0\r\n        }));\r\n\r\n        setPatronesHorarios(horarios);\r\n        setPatronesDiarios(dias);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error loading patrones:\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"space-y-6\">\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <Skeleton className=\"h-64 w-full\" />\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const maxHorario = Math.max(...patronesHorarios.map(p => p.count), 1);\r\n  const maxDiario = Math.max(...patronesDiarios.map(p => p.count), 1);\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"flex items-center gap-2\">\r\n            <Clock className=\"h-5 w-5\" />\r\n            Distribución Horaria\r\n          </CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"space-y-3\">\r\n            {patronesHorarios.map((patron) => (\r\n              <div key={patron.hora} className=\"space-y-1\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <span className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                    {patron.hora.toString().padStart(2, '0')}:00\r\n                  </span>\r\n                  <span className=\"text-sm font-semibold text-gray-900 dark:text-gray-100\">\r\n                    {patron.count} citas\r\n                  </span>\r\n                </div>\r\n                <div className=\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2\">\r\n                  <div\r\n                    className=\"bg-blue-600 h-2 rounded-full transition-all\"\r\n                    style={{ width: `${(patron.count / maxHorario) * 100}%` }}\r\n                  />\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"flex items-center gap-2\">\r\n            <Calendar className=\"h-5 w-5\" />\r\n            Distribución Semanal\r\n          </CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"space-y-3\">\r\n            {patronesDiarios.map((patron) => (\r\n              <div key={patron.dia} className=\"space-y-1\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <span className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                    {patron.dia}\r\n                  </span>\r\n                  <span className=\"text-sm font-semibold text-gray-900 dark:text-gray-100\">\r\n                    {patron.count} citas\r\n                  </span>\r\n                </div>\r\n                <div className=\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2\">\r\n                  <div\r\n                    className=\"bg-purple-600 h-2 rounded-full transition-all\"\r\n                    style={{ width: `${(patron.count / maxDiario) * 100}%` }}\r\n                  />\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\estadisticas\\tabs\\resumen-tab.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadStats'. Either include it or remove the dependency array.","line":47,"column":6,"nodeType":"ArrayExpression","endLine":47,"endColumn":27,"suggestions":[{"desc":"Update the dependencies array to be: [doctorId, dateRange, loadStats]","fix":{"range":[1134,1155],"text":"[doctorId, dateRange, loadStats]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file resumen-tab.tsx\r\n * @description Tab 1: Resumen Ejecutivo con KPIs principales conectado a Supabase\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport { Skeleton } from \"@red-salud/ui\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { \r\n  Users, \r\n  Calendar, \r\n  DollarSign, \r\n  TrendingUp, \r\n  Clock, \r\n  Activity,\r\n  AlertCircle,\r\n  CheckCircle\r\n} from \"lucide-react\";\r\n\r\ninterface ResumenTabProps {\r\n  doctorId: string;\r\n  dateRange: { start: Date; end: Date };\r\n}\r\n\r\ninterface ResumenStats {\r\n  totalPacientes: number;\r\n  citasHoy: number;\r\n  citasSemana: number;\r\n  citasMes: number;\r\n  ingresosEsteMes: number;\r\n  ingresosMesAnterior: number;\r\n  pacientesNuevos: number;\r\n  tasaAsistencia: number;\r\n  promedioConsultas: number;\r\n  consultasPendientes: number;\r\n}\r\n\r\nexport function ResumenTab({ doctorId, dateRange }: ResumenTabProps) {\r\n  const [stats, setStats] = useState<ResumenStats | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    loadStats();\r\n  }, [doctorId, dateRange]);\r\n\r\n  const loadStats = async () => {\r\n    try {\r\n      setLoading(true);\r\n\r\n      const now = new Date();\r\n      const startOfToday = new Date(now.setHours(0, 0, 0, 0));\r\n      const endOfToday = new Date(now.setHours(23, 59, 59, 999));\r\n      const startOfWeek = new Date(now.setDate(now.getDate() - now.getDay()));\r\n      const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);\r\n      const startOfLastMonth = new Date(now.getFullYear(), now.getMonth() - 1, 1);\r\n      const endOfLastMonth = new Date(now.getFullYear(), now.getMonth(), 0);\r\n\r\n      // Total de pacientes únicos\r\n      const { count: totalPacientes } = await supabase\r\n        .from('appointments')\r\n        .select('patient_id', { count: 'exact', head: true })\r\n        .eq('doctor_id', doctorId)\r\n        .not('patient_id', 'is', null);\r\n\r\n      // Citas de hoy\r\n      const { count: citasHoy } = await supabase\r\n        .from('appointments')\r\n        .select('*', { count: 'exact', head: true })\r\n        .eq('doctor_id', doctorId)\r\n        .gte('appointment_date', startOfToday.toISOString())\r\n        .lte('appointment_date', endOfToday.toISOString());\r\n\r\n      // Citas de esta semana\r\n      const { count: citasSemana } = await supabase\r\n        .from('appointments')\r\n        .select('*', { count: 'exact', head: true })\r\n        .eq('doctor_id', doctorId)\r\n        .gte('appointment_date', startOfWeek.toISOString());\r\n\r\n      // Citas de este mes\r\n      const { count: citasMes } = await supabase\r\n        .from('appointments')\r\n        .select('*', { count: 'exact', head: true })\r\n        .eq('doctor_id', doctorId)\r\n        .gte('appointment_date', startOfMonth.toISOString());\r\n\r\n      // Ingresos este mes (simulado - ajustar según tu estructura)\r\n      const { data: citasEsteMes } = await supabase\r\n        .from('appointments')\r\n        .select('price')\r\n        .eq('doctor_id', doctorId)\r\n        .eq('status', 'completed')\r\n        .gte('appointment_date', startOfMonth.toISOString());\r\n\r\n      const ingresosEsteMes = citasEsteMes?.reduce((sum, cita) => sum + (cita.price || 0), 0) || 0;\r\n\r\n      // Ingresos mes anterior\r\n      const { data: citasMesAnterior } = await supabase\r\n        .from('appointments')\r\n        .select('price')\r\n        .eq('doctor_id', doctorId)\r\n        .eq('status', 'completed')\r\n        .gte('appointment_date', startOfLastMonth.toISOString())\r\n        .lte('appointment_date', endOfLastMonth.toISOString());\r\n\r\n      const ingresosMesAnterior = citasMesAnterior?.reduce((sum, cita) => sum + (cita.price || 0), 0) || 0;\r\n\r\n      // Pacientes nuevos este mes\r\n      const { count: pacientesNuevos } = await supabase\r\n        .from('appointments')\r\n        .select('patient_id', { count: 'exact', head: true })\r\n        .eq('doctor_id', doctorId)\r\n        .gte('created_at', startOfMonth.toISOString());\r\n\r\n      // Tasa de asistencia\r\n      const { count: citasCompletadas } = await supabase\r\n        .from('appointments')\r\n        .select('*', { count: 'exact', head: true })\r\n        .eq('doctor_id', doctorId)\r\n        .eq('status', 'completed')\r\n        .gte('appointment_date', startOfMonth.toISOString());\r\n\r\n      const tasaAsistencia = citasMes ? ((citasCompletadas || 0) / citasMes) * 100 : 0;\r\n\r\n      // Consultas pendientes\r\n      const { count: consultasPendientes } = await supabase\r\n        .from('appointments')\r\n        .select('*', { count: 'exact', head: true })\r\n        .eq('doctor_id', doctorId)\r\n        .eq('status', 'scheduled')\r\n        .gte('appointment_date', new Date().toISOString());\r\n\r\n      setStats({\r\n        totalPacientes: totalPacientes || 0,\r\n        citasHoy: citasHoy || 0,\r\n        citasSemana: citasSemana || 0,\r\n        citasMes: citasMes || 0,\r\n        ingresosEsteMes,\r\n        ingresosMesAnterior,\r\n        pacientesNuevos: pacientesNuevos || 0,\r\n        tasaAsistencia,\r\n        promedioConsultas: citasMes ? Math.round(citasMes / 30) : 0,\r\n        consultasPendientes: consultasPendientes || 0,\r\n      });\r\n    } catch (error) {\r\n      console.error(\"Error loading stats:\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"space-y-6\">\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n          {[1, 2, 3, 4, 5, 6, 7, 8].map((i) => (\r\n            <Card key={i}>\r\n              <CardContent className=\"pt-6\">\r\n                <Skeleton className=\"h-4 w-24 mb-2\" />\r\n                <Skeleton className=\"h-8 w-16 mb-2\" />\r\n                <Skeleton className=\"h-3 w-full\" />\r\n              </CardContent>\r\n            </Card>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!stats) {\r\n    return (\r\n      <Card>\r\n        <CardContent className=\"pt-6\">\r\n          <div className=\"flex items-center gap-2 text-amber-600\">\r\n            <AlertCircle className=\"h-5 w-5\" />\r\n            <p>No se pudieron cargar las estadísticas</p>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  const cambioIngresos = stats.ingresosMesAnterior > 0\r\n    ? ((stats.ingresosEsteMes - stats.ingresosMesAnterior) / stats.ingresosMesAnterior) * 100\r\n    : 0;\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* KPIs Grid */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n        {/* Total Pacientes */}\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">\r\n                  Total Pacientes\r\n                </p>\r\n                <p className=\"text-2xl font-bold text-gray-900 dark:text-gray-100 mt-1\">\r\n                  {stats.totalPacientes}\r\n                </p>\r\n              </div>\r\n              <div className=\"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg\">\r\n                <Users className=\"h-6 w-6 text-blue-600 dark:text-blue-400\" />\r\n              </div>\r\n            </div>\r\n            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n              Pacientes únicos atendidos\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Citas Hoy */}\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">\r\n                  Citas Hoy\r\n                </p>\r\n                <p className=\"text-2xl font-bold text-gray-900 dark:text-gray-100 mt-1\">\r\n                  {stats.citasHoy}\r\n                </p>\r\n              </div>\r\n              <div className=\"p-3 bg-green-50 dark:bg-green-900/20 rounded-lg\">\r\n                <Calendar className=\"h-6 w-6 text-green-600 dark:text-green-400\" />\r\n              </div>\r\n            </div>\r\n            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n              Programadas para hoy\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Citas Esta Semana */}\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">\r\n                  Esta Semana\r\n                </p>\r\n                <p className=\"text-2xl font-bold text-gray-900 dark:text-gray-100 mt-1\">\r\n                  {stats.citasSemana}\r\n                </p>\r\n              </div>\r\n              <div className=\"p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg\">\r\n                <Clock className=\"h-6 w-6 text-purple-600 dark:text-purple-400\" />\r\n              </div>\r\n            </div>\r\n            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n              Citas programadas\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Citas Este Mes */}\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">\r\n                  Este Mes\r\n                </p>\r\n                <p className=\"text-2xl font-bold text-gray-900 dark:text-gray-100 mt-1\">\r\n                  {stats.citasMes}\r\n                </p>\r\n              </div>\r\n              <div className=\"p-3 bg-orange-50 dark:bg-orange-900/20 rounded-lg\">\r\n                <Activity className=\"h-6 w-6 text-orange-600 dark:text-orange-400\" />\r\n              </div>\r\n            </div>\r\n            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n              Total del mes actual\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Ingresos Este Mes */}\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">\r\n                  Ingresos Mes\r\n                </p>\r\n                <p className=\"text-2xl font-bold text-gray-900 dark:text-gray-100 mt-1\">\r\n                  ${stats.ingresosEsteMes.toLocaleString()}\r\n                </p>\r\n              </div>\r\n              <div className=\"p-3 bg-emerald-50 dark:bg-emerald-900/20 rounded-lg\">\r\n                <DollarSign className=\"h-6 w-6 text-emerald-600 dark:text-emerald-400\" />\r\n              </div>\r\n            </div>\r\n            <div className=\"flex items-center gap-1 mt-2\">\r\n              <TrendingUp className={`h-3 w-3 ${cambioIngresos >= 0 ? 'text-green-600' : 'text-red-600'}`} />\r\n              <p className={`text-xs ${cambioIngresos >= 0 ? 'text-green-600' : 'text-red-600'}`}>\r\n                {cambioIngresos >= 0 ? '+' : ''}{cambioIngresos.toFixed(1)}% vs mes anterior\r\n              </p>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Pacientes Nuevos */}\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">\r\n                  Nuevos Pacientes\r\n                </p>\r\n                <p className=\"text-2xl font-bold text-gray-900 dark:text-gray-100 mt-1\">\r\n                  {stats.pacientesNuevos}\r\n                </p>\r\n              </div>\r\n              <div className=\"p-3 bg-cyan-50 dark:bg-cyan-900/20 rounded-lg\">\r\n                <Users className=\"h-6 w-6 text-cyan-600 dark:text-cyan-400\" />\r\n              </div>\r\n            </div>\r\n            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n              Este mes\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Tasa de Asistencia */}\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">\r\n                  Tasa Asistencia\r\n                </p>\r\n                <p className=\"text-2xl font-bold text-gray-900 dark:text-gray-100 mt-1\">\r\n                  {stats.tasaAsistencia.toFixed(1)}%\r\n                </p>\r\n              </div>\r\n              <div className=\"p-3 bg-teal-50 dark:bg-teal-900/20 rounded-lg\">\r\n                <CheckCircle className=\"h-6 w-6 text-teal-600 dark:text-teal-400\" />\r\n              </div>\r\n            </div>\r\n            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n              Citas completadas\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Consultas Pendientes */}\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">\r\n                  Pendientes\r\n                </p>\r\n                <p className=\"text-2xl font-bold text-gray-900 dark:text-gray-100 mt-1\">\r\n                  {stats.consultasPendientes}\r\n                </p>\r\n              </div>\r\n              <div className=\"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg\">\r\n                <Clock className=\"h-6 w-6 text-amber-600 dark:text-amber-400\" />\r\n              </div>\r\n            </div>\r\n            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n              Por atender\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Resumen Adicional */}\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle>Resumen del Período</CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"space-y-3\">\r\n            <div className=\"flex items-center justify-between py-2 border-b dark:border-gray-800\">\r\n              <span className=\"text-sm text-gray-600 dark:text-gray-400\">Promedio de consultas diarias</span>\r\n              <span className=\"text-sm font-semibold text-gray-900 dark:text-gray-100\">\r\n                {stats.promedioConsultas} citas/día\r\n              </span>\r\n            </div>\r\n            <div className=\"flex items-center justify-between py-2 border-b dark:border-gray-800\">\r\n              <span className=\"text-sm text-gray-600 dark:text-gray-400\">Ingreso promedio por consulta</span>\r\n              <span className=\"text-sm font-semibold text-gray-900 dark:text-gray-100\">\r\n                ${stats.citasMes > 0 ? Math.round(stats.ingresosEsteMes / stats.citasMes).toLocaleString() : 0}\r\n              </span>\r\n            </div>\r\n            <div className=\"flex items-center justify-between py-2\">\r\n              <span className=\"text-sm text-gray-600 dark:text-gray-400\">Crecimiento de pacientes</span>\r\n              <span className=\"text-sm font-semibold text-green-600 dark:text-green-400\">\r\n                +{stats.pacientesNuevos} este mes\r\n              </span>\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\features\\ai-medical-assistant.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Copy' is defined but never used.","line":16,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":7},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":84,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2511,2514],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2511,2514],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":95,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2806,2809],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2806,2809],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":128,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3724,3727],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3724,3727],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Textarea } from \"@red-salud/ui\";\r\nimport { Label } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { \r\n  Sparkles, \r\n  Loader2, \r\n  Wand2, \r\n  FileText, \r\n  AlertCircle,\r\n  CheckCircle2,\r\n  Copy,\r\n  RefreshCw\r\n} from \"lucide-react\";\r\nimport { Alert, AlertDescription } from \"@red-salud/ui\";\r\n\r\ninterface AIAssistantProps {\r\n  onNotaGenerada: (nota: string) => void;\r\n  onCodigosICD11Sugeridos: (codigos: string[]) => void;\r\n  notaActual?: string;\r\n  alergias?: string[];\r\n  condicionesCronicas?: string[];\r\n  medicamentosActuales?: string[];\r\n}\r\n\r\nexport function AIMedicalAssistant({\r\n  onNotaGenerada,\r\n  onCodigosICD11Sugeridos,\r\n  notaActual = \"\",\r\n  alergias = [],\r\n  condicionesCronicas = [],\r\n  medicamentosActuales = [],\r\n}: AIAssistantProps) {\r\n  const [isGenerating, setIsGenerating] = useState(false);\r\n  const [isImproving, setIsImproving] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [success, setSuccess] = useState<string | null>(null);\r\n\r\n  // Campos del formulario de síntomas\r\n  const [motivoConsulta, setMotivoConsulta] = useState(\"\");\r\n  const [sintomas, setSintomas] = useState(\"\");\r\n  const [duracion, setDuracion] = useState(\"\");\r\n\r\n  const handleGenerateNote = async () => {\r\n    if (!motivoConsulta && !sintomas) {\r\n      setError(\"Ingresa al menos el motivo de consulta o los síntomas\");\r\n      return;\r\n    }\r\n\r\n    setIsGenerating(true);\r\n    setError(null);\r\n    setSuccess(null);\r\n\r\n    try {\r\n      const response = await fetch(\"/api/gemini/generate-note\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({\r\n          motivoConsulta,\r\n          sintomas,\r\n          duracion,\r\n          antecedentesMedicos: condicionesCronicas,\r\n          alergias,\r\n          medicamentosActuales,\r\n        }),\r\n      });\r\n\r\n      const data = await response.json();\r\n\r\n      if (!data.success) {\r\n        throw new Error(data.error || \"Error al generar la nota\");\r\n      }\r\n\r\n      // Aplicar la nota generada\r\n      onNotaGenerada(data.data.notaCompleta);\r\n\r\n      // Sugerir códigos ICD-11 si hay\r\n      if (data.data.codigosICD11Sugeridos && data.data.codigosICD11Sugeridos.length > 0) {\r\n        const codigos = data.data.codigosICD11Sugeridos.map(\r\n          (c: any) => `${c.codigo} - ${c.descripcion}`\r\n        );\r\n        onCodigosICD11Sugeridos(codigos);\r\n      }\r\n\r\n      setSuccess(\"✨ Nota médica generada exitosamente\");\r\n      \r\n      // Limpiar campos\r\n      setMotivoConsulta(\"\");\r\n      setSintomas(\"\");\r\n      setDuracion(\"\");\r\n    } catch (err: any) {\r\n      console.error(\"Error generando nota:\", err);\r\n      setError(err.message || \"Error al generar la nota médica\");\r\n    } finally {\r\n      setIsGenerating(false);\r\n    }\r\n  };\r\n\r\n  const handleImproveNote = async () => {\r\n    if (!notaActual) {\r\n      setError(\"No hay nota para mejorar. Escribe algo primero.\");\r\n      return;\r\n    }\r\n\r\n    setIsImproving(true);\r\n    setError(null);\r\n    setSuccess(null);\r\n\r\n    try {\r\n      const response = await fetch(\"/api/gemini/improve-note\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ nota: notaActual }),\r\n      });\r\n\r\n      const data = await response.json();\r\n\r\n      if (!data.success) {\r\n        throw new Error(data.error || \"Error al mejorar la nota\");\r\n      }\r\n\r\n      onNotaGenerada(data.data.notaMejorada);\r\n      setSuccess(\"✨ Nota mejorada y estructurada\");\r\n    } catch (err: any) {\r\n      console.error(\"Error mejorando nota:\", err);\r\n      setError(err.message || \"Error al mejorar la nota\");\r\n    } finally {\r\n      setIsImproving(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Card className=\"border-purple-200 bg-gradient-to-br from-purple-50 to-blue-50\">\r\n      <CardHeader className=\"pb-3\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <div className=\"h-8 w-8 rounded-lg bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center\">\r\n              <Sparkles className=\"h-4 w-4 text-white\" />\r\n            </div>\r\n            <div>\r\n              <CardTitle className=\"text-base\">Asistente IA Médico</CardTitle>\r\n              <CardDescription className=\"text-xs\">\r\n                Powered by Google Gemini\r\n              </CardDescription>\r\n            </div>\r\n          </div>\r\n          <Badge variant=\"secondary\" className=\"text-xs\">\r\n            Beta\r\n          </Badge>\r\n        </div>\r\n      </CardHeader>\r\n      <CardContent className=\"space-y-4\">\r\n        {error && (\r\n          <Alert variant=\"destructive\">\r\n            <AlertCircle className=\"h-4 w-4\" />\r\n            <AlertDescription className=\"text-xs\">{error}</AlertDescription>\r\n          </Alert>\r\n        )}\r\n\r\n        {success && (\r\n          <Alert className=\"border-green-200 bg-green-50\">\r\n            <CheckCircle2 className=\"h-4 w-4 text-green-600\" />\r\n            <AlertDescription className=\"text-xs text-green-800\">\r\n              {success}\r\n            </AlertDescription>\r\n          </Alert>\r\n        )}\r\n\r\n        {/* Opción 1: Generar desde síntomas */}\r\n        <div className=\"space-y-3\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <Wand2 className=\"h-4 w-4 text-purple-600\" />\r\n            <Label className=\"text-sm font-semibold\">Generar Nota desde Síntomas</Label>\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <div>\r\n              <Label htmlFor=\"motivo\" className=\"text-xs\">\r\n                Motivo de Consulta\r\n              </Label>\r\n              <Textarea\r\n                id=\"motivo\"\r\n                placeholder=\"Ej: Dolor abdominal, Fiebre, Tos...\"\r\n                value={motivoConsulta}\r\n                onChange={(e) => setMotivoConsulta(e.target.value)}\r\n                rows={2}\r\n                className=\"text-sm\"\r\n              />\r\n            </div>\r\n\r\n            <div>\r\n              <Label htmlFor=\"sintomas\" className=\"text-xs\">\r\n                Síntomas Detallados\r\n              </Label>\r\n              <Textarea\r\n                id=\"sintomas\"\r\n                placeholder=\"Ej: Dolor en epigastrio, tipo ardor, que aumenta después de comer...\"\r\n                value={sintomas}\r\n                onChange={(e) => setSintomas(e.target.value)}\r\n                rows={3}\r\n                className=\"text-sm\"\r\n              />\r\n            </div>\r\n\r\n            <div>\r\n              <Label htmlFor=\"duracion\" className=\"text-xs\">\r\n                Duración (opcional)\r\n              </Label>\r\n              <Textarea\r\n                id=\"duracion\"\r\n                placeholder=\"Ej: 3 días, 2 semanas...\"\r\n                value={duracion}\r\n                onChange={(e) => setDuracion(e.target.value)}\r\n                rows={1}\r\n                className=\"text-sm\"\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          <Button\r\n            onClick={handleGenerateNote}\r\n            disabled={isGenerating || (!motivoConsulta && !sintomas)}\r\n            className=\"w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700\"\r\n            size=\"sm\"\r\n          >\r\n            {isGenerating ? (\r\n              <>\r\n                <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\r\n                Generando con IA...\r\n              </>\r\n            ) : (\r\n              <>\r\n                <Sparkles className=\"h-4 w-4 mr-2\" />\r\n                Generar Nota Completa\r\n              </>\r\n            )}\r\n          </Button>\r\n        </div>\r\n\r\n        <div className=\"relative\">\r\n          <div className=\"absolute inset-0 flex items-center\">\r\n            <span className=\"w-full border-t border-gray-300\" />\r\n          </div>\r\n          <div className=\"relative flex justify-center text-xs uppercase\">\r\n            <span className=\"bg-gradient-to-br from-purple-50 to-blue-50 px-2 text-gray-500\">\r\n              o\r\n            </span>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Opción 2: Mejorar nota existente */}\r\n        <div className=\"space-y-3\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <FileText className=\"h-4 w-4 text-blue-600\" />\r\n            <Label className=\"text-sm font-semibold\">Mejorar Nota Existente</Label>\r\n          </div>\r\n\r\n          <p className=\"text-xs text-gray-600\">\r\n            La IA estructurará y mejorará la nota que ya escribiste, siguiendo el formato SOAP profesional.\r\n          </p>\r\n\r\n          <Button\r\n            onClick={handleImproveNote}\r\n            disabled={isImproving || !notaActual}\r\n            variant=\"outline\"\r\n            className=\"w-full border-blue-300 hover:bg-blue-50\"\r\n            size=\"sm\"\r\n          >\r\n            {isImproving ? (\r\n              <>\r\n                <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\r\n                Mejorando...\r\n              </>\r\n            ) : (\r\n              <>\r\n                <RefreshCw className=\"h-4 w-4 mr-2\" />\r\n                Mejorar y Estructurar Nota\r\n              </>\r\n            )}\r\n          </Button>\r\n        </div>\r\n\r\n        {/* Info */}\r\n        <div className=\"pt-2 border-t border-purple-200\">\r\n          <p className=\"text-xs text-gray-600\">\r\n            💡 <strong>Tip:</strong> La IA usa la información médica del paciente (alergias, condiciones, medicamentos) para generar notas más precisas.\r\n          </p>\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\features\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\features\\patient-quick-actions.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileText' is defined but never used.","line":16,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { Button } from \"@red-salud/ui\";\r\nimport {\r\n  DropdownMenu,\r\n  DropdownMenuContent,\r\n  DropdownMenuItem,\r\n  DropdownMenuLabel,\r\n  DropdownMenuSeparator,\r\n  DropdownMenuTrigger,\r\n} from \"@red-salud/ui\";\r\nimport {\r\n  Eye,\r\n  MessageSquare,\r\n  Calendar,\r\n  FileText,\r\n  Pill,\r\n  MoreVertical,\r\n  Phone,\r\n  Video,\r\n  Stethoscope,\r\n} from \"lucide-react\";\r\nimport { useRouter } from \"next/navigation\";\r\n\r\ninterface PatientQuickActionsProps {\r\n  patientId: string;\r\n  patientName: string;\r\n  isOffline?: boolean;\r\n}\r\n\r\nexport function PatientQuickActions({\r\n  patientId,\r\n  patientName,\r\n  isOffline = false,\r\n}: PatientQuickActionsProps) {\r\n  const router = useRouter();\r\n\r\n  const handleAction = (action: string) => {\r\n    switch (action) {\r\n      case \"view\":\r\n        if (isOffline) {\r\n          router.push(`/dashboard/medico/pacientes/offline/${patientId}`);\r\n        } else {\r\n          router.push(`/dashboard/medico/pacientes/${patientId}`);\r\n        }\r\n        break;\r\n      case \"message\":\r\n        if (!isOffline) {\r\n          router.push(`/dashboard/medico/mensajeria?patient=${patientId}`);\r\n        }\r\n        break;\r\n      case \"appointment\":\r\n        if (!isOffline) {\r\n          router.push(`/dashboard/medico/citas/nueva?patient=${patientId}`);\r\n        }\r\n        break;\r\n      case \"prescription\":\r\n        if (!isOffline) {\r\n          router.push(`/dashboard/medico/recipes/nueva?patient=${patientId}`);\r\n        }\r\n        break;\r\n      case \"consultation\":\r\n        if (!isOffline) {\r\n          router.push(`/dashboard/medico/consultas/nueva?patient=${patientId}`);\r\n        }\r\n        break;\r\n      case \"call\":\r\n        // Implementar llamada telefónica\r\n        console.log(\"Iniciar llamada con:\", patientName);\r\n        break;\r\n      case \"video\":\r\n        if (!isOffline) {\r\n          router.push(`/dashboard/medico/videollamada?patient=${patientId}`);\r\n        }\r\n        break;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex items-center gap-2\">\r\n      {/* Primary Actions */}\r\n      <Button\r\n        variant=\"ghost\"\r\n        size=\"sm\"\r\n        onClick={() => handleAction(\"view\")}\r\n      >\r\n        <Eye className=\"h-4 w-4 mr-1\" />\r\n        Ver\r\n      </Button>\r\n\r\n      {!isOffline && (\r\n        <Button\r\n          variant=\"ghost\"\r\n          size=\"sm\"\r\n          onClick={() => handleAction(\"message\")}\r\n        >\r\n          <MessageSquare className=\"h-4 w-4 mr-1\" />\r\n          Mensaje\r\n        </Button>\r\n      )}\r\n\r\n      {/* More Actions Dropdown */}\r\n      <DropdownMenu>\r\n        <DropdownMenuTrigger asChild>\r\n          <Button variant=\"ghost\" size=\"sm\">\r\n            <MoreVertical className=\"h-4 w-4\" />\r\n          </Button>\r\n        </DropdownMenuTrigger>\r\n        <DropdownMenuContent align=\"end\" className=\"w-56\">\r\n          <DropdownMenuLabel>Acciones Rápidas</DropdownMenuLabel>\r\n          <DropdownMenuSeparator />\r\n          \r\n          {!isOffline && (\r\n            <>\r\n              <DropdownMenuItem onClick={() => handleAction(\"appointment\")}>\r\n                <Calendar className=\"h-4 w-4 mr-2\" />\r\n                Agendar Cita\r\n              </DropdownMenuItem>\r\n              <DropdownMenuItem onClick={() => handleAction(\"prescription\")}>\r\n                <Pill className=\"h-4 w-4 mr-2\" />\r\n                Crear Recipe\r\n              </DropdownMenuItem>\r\n              <DropdownMenuItem onClick={() => handleAction(\"consultation\")}>\r\n                <Stethoscope className=\"h-4 w-4 mr-2\" />\r\n                Nueva Consulta\r\n              </DropdownMenuItem>\r\n              <DropdownMenuSeparator />\r\n              <DropdownMenuItem onClick={() => handleAction(\"video\")}>\r\n                <Video className=\"h-4 w-4 mr-2\" />\r\n                Videollamada\r\n              </DropdownMenuItem>\r\n              <DropdownMenuItem onClick={() => handleAction(\"call\")}>\r\n                <Phone className=\"h-4 w-4 mr-2\" />\r\n                Llamar\r\n              </DropdownMenuItem>\r\n            </>\r\n          )}\r\n          \r\n          {isOffline && (\r\n            <DropdownMenuItem onClick={() => handleAction(\"view\")}>\r\n              <Eye className=\"h-4 w-4 mr-2\" />\r\n              Ver Detalles Completos\r\n            </DropdownMenuItem>\r\n          )}\r\n        </DropdownMenuContent>\r\n      </DropdownMenu>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\features\\patients-stats.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardHeader' is defined but never used.","line":3,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardTitle' is defined but never used.","line":3,"column":41,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":50}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Users, TrendingUp, TrendingDown, Activity } from \"lucide-react\";\r\n\r\ninterface PatientsStatsProps {\r\n  totalPatients: number;\r\n  registeredPatients: number;\r\n  offlinePatients: number;\r\n  totalConsultations: number;\r\n  monthlyConsultations: number;\r\n  previousMonthConsultations?: number;\r\n}\r\n\r\nexport function PatientsStats({\r\n  totalPatients,\r\n  registeredPatients,\r\n  offlinePatients,\r\n  totalConsultations,\r\n  monthlyConsultations,\r\n  previousMonthConsultations = 0,\r\n}: PatientsStatsProps) {\r\n  const consultationsTrend = monthlyConsultations - previousMonthConsultations;\r\n  const trendPercentage = previousMonthConsultations > 0\r\n    ? Math.round((consultationsTrend / previousMonthConsultations) * 100)\r\n    : 0;\r\n\r\n  return (\r\n    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n      {/* Total Patients */}\r\n      <Card>\r\n        <CardContent className=\"p-6\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <p className=\"text-sm font-medium text-gray-600\">Total Pacientes</p>\r\n              <p className=\"text-3xl font-bold text-gray-900 mt-2\">{totalPatients}</p>\r\n              <div className=\"flex items-center gap-2 mt-2\">\r\n                <Badge variant=\"outline\" className=\"text-xs\">\r\n                  {registeredPatients} registrados\r\n                </Badge>\r\n                <Badge variant=\"secondary\" className=\"text-xs\">\r\n                  {offlinePatients} sin cuenta\r\n                </Badge>\r\n              </div>\r\n            </div>\r\n            <div className=\"h-12 w-12 rounded-full bg-blue-100 flex items-center justify-center\">\r\n              <Users className=\"h-6 w-6 text-blue-600\" />\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Registered Patients */}\r\n      <Card>\r\n        <CardContent className=\"p-6\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <p className=\"text-sm font-medium text-gray-600\">Registrados</p>\r\n              <p className=\"text-3xl font-bold text-gray-900 mt-2\">{registeredPatients}</p>\r\n              <p className=\"text-xs text-gray-500 mt-2\">\r\n                {totalPatients > 0\r\n                  ? `${Math.round((registeredPatients / totalPatients) * 100)}% del total`\r\n                  : \"0% del total\"}\r\n              </p>\r\n            </div>\r\n            <div className=\"h-12 w-12 rounded-full bg-green-100 flex items-center justify-center\">\r\n              <Users className=\"h-6 w-6 text-green-600\" />\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Total Consultations */}\r\n      <Card>\r\n        <CardContent className=\"p-6\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <p className=\"text-sm font-medium text-gray-600\">Total Consultas</p>\r\n              <p className=\"text-3xl font-bold text-gray-900 mt-2\">{totalConsultations}</p>\r\n              <p className=\"text-xs text-gray-500 mt-2\">\r\n                {registeredPatients > 0\r\n                  ? `${(totalConsultations / registeredPatients).toFixed(1)} promedio por paciente`\r\n                  : \"Sin consultas\"}\r\n              </p>\r\n            </div>\r\n            <div className=\"h-12 w-12 rounded-full bg-purple-100 flex items-center justify-center\">\r\n              <Activity className=\"h-6 w-6 text-purple-600\" />\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Monthly Consultations */}\r\n      <Card>\r\n        <CardContent className=\"p-6\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <p className=\"text-sm font-medium text-gray-600\">Este Mes</p>\r\n              <p className=\"text-3xl font-bold text-gray-900 mt-2\">{monthlyConsultations}</p>\r\n              {previousMonthConsultations > 0 && (\r\n                <div className=\"flex items-center gap-1 mt-2\">\r\n                  {consultationsTrend >= 0 ? (\r\n                    <>\r\n                      <TrendingUp className=\"h-4 w-4 text-green-600\" />\r\n                      <span className=\"text-xs text-green-600 font-medium\">\r\n                        +{trendPercentage}%\r\n                      </span>\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <TrendingDown className=\"h-4 w-4 text-red-600\" />\r\n                      <span className=\"text-xs text-red-600 font-medium\">\r\n                        {trendPercentage}%\r\n                      </span>\r\n                    </>\r\n                  )}\r\n                  <span className=\"text-xs text-gray-500\">vs mes anterior</span>\r\n                </div>\r\n              )}\r\n            </div>\r\n            <div className=\"h-12 w-12 rounded-full bg-amber-100 flex items-center justify-center\">\r\n              <Activity className=\"h-6 w-6 text-amber-600\" />\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\features\\verification-guard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\inputs\\icd10-autocomplete.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cn' is defined but never used.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":12}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect, useRef } from \"react\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Card } from \"@red-salud/ui\";\r\nimport { Search, Sparkles, X, Loader2 } from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\ninterface ICD11Code {\r\n  id: string;\r\n  code: string;\r\n  title: string;\r\n  definition?: string;\r\n  chapter?: string;\r\n  score?: number;\r\n}\r\n\r\ninterface ICD10AutocompleteProps {\r\n  value: string[];\r\n  onChange: (codes: string[]) => void;\r\n  placeholder?: string;\r\n}\r\n\r\nexport function ICD10Autocomplete({ value, onChange, placeholder }: ICD10AutocompleteProps) {\r\n  const [searchQuery, setSearchQuery] = useState(\"\");\r\n  const [suggestions, setSuggestions] = useState<ICD11Code[]>([]);\r\n  const [showSuggestions, setShowSuggestions] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const inputRef = useRef<HTMLInputElement>(null);\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (containerRef.current && !containerRef.current.contains(event.target as Node)) {\r\n        setShowSuggestions(false);\r\n      }\r\n    };\r\n\r\n    document.addEventListener(\"mousedown\", handleClickOutside);\r\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const search = async () => {\r\n      if (searchQuery.length >= 3) {\r\n        setIsLoading(true);\r\n        setError(null);\r\n        \r\n        try {\r\n          const response = await fetch(\r\n            `/api/icd11/search?q=${encodeURIComponent(searchQuery)}&mode=suggestions`\r\n          );\r\n          \r\n          if (!response.ok) {\r\n            throw new Error(\"Error al buscar códigos ICD-11\");\r\n          }\r\n          \r\n          const data = await response.json();\r\n          \r\n          if (data.success) {\r\n            setSuggestions(data.data);\r\n            setShowSuggestions(true);\r\n          } else {\r\n            setError(data.error || \"Error desconocido\");\r\n            setSuggestions([]);\r\n          }\r\n        } catch (err) {\r\n          console.error(\"Error searching ICD-11:\", err);\r\n          setError(\"Error al conectar con la API de ICD-11\");\r\n          setSuggestions([]);\r\n        } finally {\r\n          setIsLoading(false);\r\n        }\r\n      } else {\r\n        setSuggestions([]);\r\n        setShowSuggestions(false);\r\n      }\r\n    };\r\n\r\n    const debounce = setTimeout(search, 500);\r\n    return () => clearTimeout(debounce);\r\n  }, [searchQuery]);\r\n\r\n  const addCode = (code: ICD11Code) => {\r\n    const codeString = `${code.code} - ${code.title}`;\r\n    if (!value.includes(codeString)) {\r\n      onChange([...value, codeString]);\r\n    }\r\n    setSearchQuery(\"\");\r\n    setSuggestions([]);\r\n    setShowSuggestions(false);\r\n  };\r\n\r\n  const removeCode = (codeToRemove: string) => {\r\n    onChange(value.filter((c) => c !== codeToRemove));\r\n  };\r\n\r\n  return (\r\n    <div ref={containerRef} className=\"space-y-3\">\r\n      {/* Selected Codes */}\r\n      {value.length > 0 && (\r\n        <div className=\"flex flex-wrap gap-2\">\r\n          {value.map((code) => (\r\n            <Badge key={code} variant=\"secondary\" className=\"text-sm py-1.5 px-3\">\r\n              {code}\r\n              <button\r\n                onClick={() => removeCode(code)}\r\n                className=\"ml-2 hover:bg-black/10 rounded-full p-0.5\"\r\n              >\r\n                <X className=\"h-3 w-3\" />\r\n              </button>\r\n            </Badge>\r\n          ))}\r\n        </div>\r\n      )}\r\n\r\n      {/* Search Input */}\r\n      <div className=\"relative\">\r\n        <div className=\"relative flex-1\">\r\n          {isLoading ? (\r\n            <Loader2 className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400 animate-spin\" />\r\n          ) : (\r\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400\" />\r\n          )}\r\n          <Input\r\n            ref={inputRef}\r\n            value={searchQuery}\r\n            onChange={(e) => setSearchQuery(e.target.value)}\r\n            onFocus={() => suggestions.length > 0 && setShowSuggestions(true)}\r\n            placeholder={placeholder || \"Buscar código ICD-11 (CIE-11) - API OMS...\"}\r\n            className=\"pl-10\"\r\n            disabled={isLoading}\r\n          />\r\n        </div>\r\n\r\n        {/* Error Message */}\r\n        {error && (\r\n          <Card className=\"absolute z-50 w-full mt-2 p-3 shadow-lg bg-red-50 border-red-200\">\r\n            <p className=\"text-sm text-red-600\">{error}</p>\r\n          </Card>\r\n        )}\r\n\r\n        {/* Suggestions Dropdown */}\r\n        {showSuggestions && suggestions.length > 0 && (\r\n          <Card className=\"absolute z-50 w-full mt-2 max-h-96 overflow-y-auto shadow-lg\">\r\n            <div className=\"p-2\">\r\n              <div className=\"flex items-center gap-2 px-2 py-1 mb-2 text-xs font-medium text-blue-900 bg-blue-50 rounded\">\r\n                <Sparkles className=\"h-3 w-3\" />\r\n                Resultados de ICD-11 API (OMS)\r\n              </div>\r\n              {suggestions.map((code) => (\r\n                <button\r\n                  key={code.id}\r\n                  onClick={() => addCode(code)}\r\n                  className=\"w-full text-left px-3 py-2 hover:bg-gray-100 rounded-md transition-colors\"\r\n                >\r\n                  <div className=\"flex items-start justify-between gap-2\">\r\n                    <div className=\"flex-1\">\r\n                      <div className=\"font-mono text-sm font-semibold text-gray-900\">\r\n                        {code.code}\r\n                      </div>\r\n                      <div className=\"text-sm text-gray-600\">{code.title}</div>\r\n                      {code.chapter && (\r\n                        <div className=\"text-xs text-gray-500 mt-1\">\r\n                          Capítulo: {code.chapter}\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                    {code.score && (\r\n                      <Badge variant=\"outline\" className=\"text-xs\">\r\n                        {Math.round(code.score * 100)}%\r\n                      </Badge>\r\n                    )}\r\n                  </div>\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </Card>\r\n        )}\r\n      </div>\r\n\r\n      <p className=\"text-xs text-gray-500\">\r\n        Busca códigos ICD-11 (CIE-11) usando la API oficial de la OMS. Escribe al menos 3 caracteres.\r\n      </p>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\inputs\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\inputs\\medical-chip-input.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\inputs\\medical-chip-input.tsx:33:7\n  31 |         s.toLowerCase().includes(inputValue.toLowerCase())\n  32 |       );\n> 33 |       setFilteredSuggestions(filtered.slice(0, 8)); // Máximo 8 sugerencias\n     |       ^^^^^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  34 |       setShowSuggestions(filtered.length > 0);\n  35 |     } else {\n  36 |       setFilteredSuggestions([]);","line":33,"column":7,"nodeType":null,"endLine":33,"endColumn":29}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { X, Plus } from \"lucide-react\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\n\r\ninterface MedicalChipInputProps {\r\n  value: string[];\r\n  onChange: (value: string[]) => void;\r\n  suggestions: string[];\r\n  placeholder: string;\r\n  disabled?: boolean;\r\n}\r\n\r\nexport function MedicalChipInput({\r\n  value,\r\n  onChange,\r\n  suggestions,\r\n  placeholder,\r\n  disabled = false,\r\n}: MedicalChipInputProps) {\r\n  const [inputValue, setInputValue] = useState(\"\");\r\n  const [showSuggestions, setShowSuggestions] = useState(false);\r\n  const [filteredSuggestions, setFilteredSuggestions] = useState<string[]>([]);\r\n\r\n  useEffect(() => {\r\n    if (inputValue.trim().length >= 2) {\r\n      const filtered = suggestions.filter((s) =>\r\n        s.toLowerCase().includes(inputValue.toLowerCase())\r\n      );\r\n      setFilteredSuggestions(filtered.slice(0, 8)); // Máximo 8 sugerencias\r\n      setShowSuggestions(filtered.length > 0);\r\n    } else {\r\n      setFilteredSuggestions([]);\r\n      setShowSuggestions(false);\r\n    }\r\n  }, [inputValue, suggestions]);\r\n\r\n  const handleAdd = (item: string) => {\r\n    const trimmed = item.trim();\r\n    if (trimmed && !value.includes(trimmed)) {\r\n      onChange([...value, trimmed]);\r\n      setInputValue(\"\");\r\n      setShowSuggestions(false);\r\n    }\r\n  };\r\n\r\n  const handleRemove = (index: number) => {\r\n    onChange(value.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const handleKeyDown = (e: React.KeyboardEvent) => {\r\n    if (e.key === \"Enter\" && inputValue.trim()) {\r\n      e.preventDefault();\r\n      handleAdd(inputValue);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-2\">\r\n      {/* Input con sugerencias */}\r\n      <div className=\"relative\">\r\n        <div className=\"flex gap-2\">\r\n          <Input\r\n            value={inputValue}\r\n            onChange={(e) => setInputValue(e.target.value)}\r\n            onKeyDown={handleKeyDown}\r\n            onFocus={() => inputValue.length >= 2 && setShowSuggestions(true)}\r\n            onBlur={() => setTimeout(() => setShowSuggestions(false), 200)}\r\n            placeholder={placeholder}\r\n            disabled={disabled}\r\n            className=\"flex-1\"\r\n          />\r\n          <Button\r\n            type=\"button\"\r\n            onClick={() => handleAdd(inputValue)}\r\n            disabled={!inputValue.trim() || disabled}\r\n            size=\"sm\"\r\n            variant=\"outline\"\r\n          >\r\n            <Plus className=\"h-4 w-4\" />\r\n          </Button>\r\n        </div>\r\n\r\n        {/* Sugerencias dropdown */}\r\n        {showSuggestions && filteredSuggestions.length > 0 && (\r\n          <div className=\"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-48 overflow-y-auto\">\r\n            {filteredSuggestions.map((suggestion, idx) => (\r\n              <button\r\n                key={idx}\r\n                type=\"button\"\r\n                onMouseDown={(e) => {\r\n                  e.preventDefault();\r\n                  handleAdd(suggestion);\r\n                }}\r\n                className=\"w-full px-3 py-2 text-left text-sm hover:bg-blue-50 focus:bg-blue-50 focus:outline-none transition-colors\"\r\n              >\r\n                {suggestion}\r\n              </button>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Chips/Badges */}\r\n      {value.length > 0 && (\r\n        <div className=\"flex flex-wrap gap-2\">\r\n          {value.map((item, idx) => (\r\n            <Badge\r\n              key={idx}\r\n              variant=\"secondary\"\r\n              className=\"text-sm py-1.5 px-3 flex items-center gap-1\"\r\n            >\r\n              <span>{item}</span>\r\n              {!disabled && (\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => handleRemove(idx)}\r\n                  className=\"hover:bg-gray-300 rounded-full p-0.5 ml-1\"\r\n                >\r\n                  <X className=\"h-3 w-3\" />\r\n                </button>\r\n              )}\r\n            </Badge>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\inputs\\medication-input.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\inputs\\medication-input.tsx:98:7\n   96 |         med.name.toLowerCase().includes(currentMed.name!.toLowerCase())\n   97 |       );\n>  98 |       setSuggestions(filtered);\n      |       ^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n   99 |       setShowSuggestions(filtered.length > 0);\n  100 |     } else {\n  101 |       setShowSuggestions(false);","line":98,"column":7,"nodeType":null,"endLine":98,"endColumn":21}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect, useRef } from \"react\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { X, Plus, Pill, Clock, Droplet } from \"lucide-react\";\r\n\r\ninterface Medication {\r\n  id: string;\r\n  name: string;\r\n  dose: string;\r\n  frequency: string;\r\n  duration: string;\r\n}\r\n\r\ninterface MedicationSuggestion {\r\n  name: string;\r\n  commonDoses: string[];\r\n  commonFrequencies: string[];\r\n}\r\n\r\nconst COMMON_MEDICATIONS: MedicationSuggestion[] = [\r\n  {\r\n    name: \"Paracetamol\",\r\n    commonDoses: [\"500mg\", \"1g\"],\r\n    commonFrequencies: [\"cada 8 horas\", \"cada 6 horas\"],\r\n  },\r\n  {\r\n    name: \"Ibuprofeno\",\r\n    commonDoses: [\"400mg\", \"600mg\"],\r\n    commonFrequencies: [\"cada 8 horas\", \"cada 12 horas\"],\r\n  },\r\n  {\r\n    name: \"Amoxicilina\",\r\n    commonDoses: [\"500mg\", \"875mg\"],\r\n    commonFrequencies: [\"cada 8 horas\", \"cada 12 horas\"],\r\n  },\r\n  {\r\n    name: \"Omeprazol\",\r\n    commonDoses: [\"20mg\", \"40mg\"],\r\n    commonFrequencies: [\"cada 24 horas\", \"cada 12 horas\"],\r\n  },\r\n  {\r\n    name: \"Losartán\",\r\n    commonDoses: [\"50mg\", \"100mg\"],\r\n    commonFrequencies: [\"cada 24 horas\"],\r\n  },\r\n  {\r\n    name: \"Metformina\",\r\n    commonDoses: [\"500mg\", \"850mg\", \"1000mg\"],\r\n    commonFrequencies: [\"cada 12 horas\", \"cada 8 horas\"],\r\n  },\r\n  {\r\n    name: \"Atorvastatina\",\r\n    commonDoses: [\"10mg\", \"20mg\", \"40mg\"],\r\n    commonFrequencies: [\"cada 24 horas\"],\r\n  },\r\n  {\r\n    name: \"Enalapril\",\r\n    commonDoses: [\"5mg\", \"10mg\", \"20mg\"],\r\n    commonFrequencies: [\"cada 12 horas\", \"cada 24 horas\"],\r\n  },\r\n  {\r\n    name: \"Salbutamol\",\r\n    commonDoses: [\"100mcg\", \"2 puff\"],\r\n    commonFrequencies: [\"cada 6 horas\", \"SOS\"],\r\n  },\r\n  {\r\n    name: \"Loratadina\",\r\n    commonDoses: [\"10mg\"],\r\n    commonFrequencies: [\"cada 24 horas\"],\r\n  },\r\n];\r\n\r\ninterface MedicationInputProps {\r\n  medications: string[];\r\n  onChange: (medications: string[]) => void;\r\n}\r\n\r\nexport function MedicationInput({ medications, onChange }: MedicationInputProps) {\r\n  const [currentMed, setCurrentMed] = useState<Partial<Medication>>({\r\n    name: \"\",\r\n    dose: \"\",\r\n    frequency: \"\",\r\n    duration: \"\",\r\n  });\r\n  const [suggestions, setSuggestions] = useState<MedicationSuggestion[]>([]);\r\n  const [showSuggestions, setShowSuggestions] = useState(false);\r\n  const [selectedSuggestion, setSelectedSuggestion] = useState<MedicationSuggestion | null>(null);\r\n  const inputRef = useRef<HTMLInputElement>(null);\r\n\r\n  useEffect(() => {\r\n    if (currentMed.name && currentMed.name.length > 1) {\r\n      const filtered = COMMON_MEDICATIONS.filter((med) =>\r\n        med.name.toLowerCase().includes(currentMed.name!.toLowerCase())\r\n      );\r\n      setSuggestions(filtered);\r\n      setShowSuggestions(filtered.length > 0);\r\n    } else {\r\n      setShowSuggestions(false);\r\n    }\r\n  }, [currentMed.name]);\r\n\r\n  const handleSelectMedication = (med: MedicationSuggestion) => {\r\n    setCurrentMed({\r\n      ...currentMed,\r\n      name: med.name,\r\n    });\r\n    setSelectedSuggestion(med);\r\n    setShowSuggestions(false);\r\n  };\r\n\r\n  const handleAddMedication = () => {\r\n    if (!currentMed.name || !currentMed.dose || !currentMed.frequency) {\r\n      return;\r\n    }\r\n\r\n    const medString = `${currentMed.name} ${currentMed.dose} ${currentMed.frequency}${\r\n      currentMed.duration ? ` por ${currentMed.duration}` : \"\"\r\n    }`;\r\n\r\n    onChange([...medications, medString]);\r\n    \r\n    // Reset\r\n    setCurrentMed({\r\n      name: \"\",\r\n      dose: \"\",\r\n      frequency: \"\",\r\n      duration: \"\",\r\n    });\r\n    setSelectedSuggestion(null);\r\n    inputRef.current?.focus();\r\n  };\r\n\r\n  const handleRemoveMedication = (index: number) => {\r\n    onChange(medications.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const handleKeyPress = (e: React.KeyboardEvent, field: string) => {\r\n    if (e.key === \"Enter\") {\r\n      e.preventDefault();\r\n      if (field === \"name\" && showSuggestions && suggestions.length > 0) {\r\n        handleSelectMedication(suggestions[0]);\r\n      } else if (field === \"duration\" || (field === \"frequency\" && !currentMed.duration)) {\r\n        handleAddMedication();\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      {/* Lista de medicamentos agregados */}\r\n      {medications.length > 0 && (\r\n        <div className=\"space-y-2\">\r\n          <p className=\"text-sm font-semibold text-gray-700\">Medicamentos Prescritos:</p>\r\n          {medications.map((med, index) => (\r\n            <div\r\n              key={index}\r\n              className=\"flex items-center justify-between p-3 bg-blue-50 border border-blue-200 rounded-lg group hover:bg-blue-100 transition-colors\"\r\n            >\r\n              <div className=\"flex items-center gap-2 flex-1\">\r\n                <Pill className=\"h-4 w-4 text-blue-600 flex-shrink-0\" />\r\n                <span className=\"text-sm text-gray-900\">{med}</span>\r\n              </div>\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                onClick={() => handleRemoveMedication(index)}\r\n                className=\"h-8 w-8 p-0 opacity-0 group-hover:opacity-100 transition-opacity\"\r\n              >\r\n                <X className=\"h-4 w-4\" />\r\n              </Button>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n\r\n      {/* Formulario de agregar medicamento */}\r\n      <div className=\"p-4 border-2 border-dashed border-gray-300 rounded-lg space-y-3\">\r\n        <p className=\"text-sm font-semibold text-gray-700 flex items-center gap-2\">\r\n          <Plus className=\"h-4 w-4\" />\r\n          Agregar Medicamento\r\n        </p>\r\n\r\n        {/* Nombre del medicamento */}\r\n        <div className=\"relative\">\r\n          <Input\r\n            ref={inputRef}\r\n            value={currentMed.name || \"\"}\r\n            onChange={(e) => setCurrentMed({ ...currentMed, name: e.target.value })}\r\n            onKeyPress={(e) => handleKeyPress(e, \"name\")}\r\n            placeholder=\"Nombre del medicamento...\"\r\n            className=\"pr-10\"\r\n          />\r\n          <Pill className=\"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400\" />\r\n\r\n          {/* Sugerencias */}\r\n          {showSuggestions && (\r\n            <div className=\"absolute top-full left-0 right-0 mt-1 bg-white border rounded-lg shadow-lg z-20 max-h-48 overflow-y-auto\">\r\n              {suggestions.map((med, index) => (\r\n                <button\r\n                  key={index}\r\n                  onClick={() => handleSelectMedication(med)}\r\n                  className=\"w-full text-left px-4 py-2 hover:bg-blue-50 flex items-center gap-2 text-sm\"\r\n                >\r\n                  <Pill className=\"h-4 w-4 text-blue-600\" />\r\n                  <span className=\"font-medium\">{med.name}</span>\r\n                  <Badge variant=\"secondary\" className=\"text-xs ml-auto\">\r\n                    {med.commonDoses[0]}\r\n                  </Badge>\r\n                </button>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Dosis */}\r\n        {currentMed.name && (\r\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\r\n            <div className=\"relative\">\r\n              <Input\r\n                value={currentMed.dose || \"\"}\r\n                onChange={(e) => setCurrentMed({ ...currentMed, dose: e.target.value })}\r\n                onKeyPress={(e) => handleKeyPress(e, \"dose\")}\r\n                placeholder=\"Dosis (ej: 500mg)\"\r\n                className=\"pr-10\"\r\n              />\r\n              <Droplet className=\"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400\" />\r\n              \r\n              {/* Sugerencias de dosis */}\r\n              {selectedSuggestion && (\r\n                <div className=\"flex flex-wrap gap-1 mt-1\">\r\n                  {selectedSuggestion.commonDoses.map((dose, i) => (\r\n                    <Badge\r\n                      key={i}\r\n                      variant=\"outline\"\r\n                      className=\"text-xs cursor-pointer hover:bg-blue-50\"\r\n                      onClick={() => setCurrentMed({ ...currentMed, dose })}\r\n                    >\r\n                      {dose}\r\n                    </Badge>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* Frecuencia */}\r\n            <div className=\"relative\">\r\n              <Input\r\n                value={currentMed.frequency || \"\"}\r\n                onChange={(e) => setCurrentMed({ ...currentMed, frequency: e.target.value })}\r\n                onKeyPress={(e) => handleKeyPress(e, \"frequency\")}\r\n                placeholder=\"Frecuencia\"\r\n                className=\"pr-10\"\r\n              />\r\n              <Clock className=\"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400\" />\r\n              \r\n              {/* Sugerencias de frecuencia */}\r\n              {selectedSuggestion && (\r\n                <div className=\"flex flex-wrap gap-1 mt-1\">\r\n                  {selectedSuggestion.commonFrequencies.map((freq, i) => (\r\n                    <Badge\r\n                      key={i}\r\n                      variant=\"outline\"\r\n                      className=\"text-xs cursor-pointer hover:bg-blue-50\"\r\n                      onClick={() => setCurrentMed({ ...currentMed, frequency: freq })}\r\n                    >\r\n                      {freq}\r\n                    </Badge>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* Duración */}\r\n            <Input\r\n              value={currentMed.duration || \"\"}\r\n              onChange={(e) => setCurrentMed({ ...currentMed, duration: e.target.value })}\r\n              onKeyPress={(e) => handleKeyPress(e, \"duration\")}\r\n              placeholder=\"Duración (ej: 7 días)\"\r\n            />\r\n          </div>\r\n        )}\r\n\r\n        {/* Botón agregar */}\r\n        {currentMed.name && currentMed.dose && currentMed.frequency && (\r\n          <Button\r\n            onClick={handleAddMedication}\r\n            className=\"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700\"\r\n          >\r\n            <Plus className=\"h-4 w-4 mr-2\" />\r\n            Agregar Medicamento\r\n          </Button>\r\n        )}\r\n      </div>\r\n\r\n      {/* Ayuda */}\r\n      <div className=\"text-xs text-gray-500 space-y-1\">\r\n        <p>💡 <strong>Tip:</strong> Escribe el nombre del medicamento y selecciona de las sugerencias</p>\r\n        <p>⌨️ Presiona <kbd className=\"px-1 py-0.5 bg-gray-100 border rounded text-xs\">Enter</kbd> para avanzar entre campos</p>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\medical-workspace.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'supabase' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":18},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\medical-workspace.tsx:83:7\n  81 |   useEffect(() => {\n  82 |     if (activeTab === \"notas\") {\n> 83 |       setFreeNotesContent(notasMedicas);\n     |       ^^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  84 |     }\n  85 |   }, [activeTab, notasMedicas]);\n  86 |","line":83,"column":7,"nodeType":null,"endLine":83,"endColumn":26}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { Tabs, TabsContent } from \"@red-salud/ui\";\r\nimport { StructuredTemplate } from \"@/lib/templates/structured-templates\";\r\nimport { WorkspaceHeader } from \"./workspace/workspace-header\";\r\nimport { TabsHeader } from \"./workspace/tabs-header\";\r\nimport { FreeNotesEditor } from \"./workspace/free-notes-editor\";\r\nimport { ICDSearchTab } from \"./workspace/icd-search-tab\";\r\nimport { HistorialPanel } from \"./workspace/historial-panel\";\r\nimport { AIRecommendationsPanel } from \"./workspace/ai-recommendations-panel\";\r\nimport { HistorialDetailDialog } from \"./workspace/historial-detail-dialog\";\r\nimport { StructuredTemplateEditor } from \"./templates/structured-template-editor\";\r\nimport { StructuredTemplateMarketplace } from \"./templates/structured-template-marketplace\";\r\nimport { useAutocomplete } from \"./workspace/use-autocomplete\";\r\nimport { useHistorial } from \"./workspace/use-historial\";\r\nimport { useAIAnalysis } from \"./workspace/use-ai-analysis\";\r\nimport { ScrollArea } from \"@red-salud/ui\";\r\n\r\ninterface MedicalWorkspaceProps {\r\n  paciente: {\r\n    cedula: string;\r\n    nombre_completo: string;\r\n    edad: number | null;\r\n    genero: string;\r\n  };\r\n  alergias: string[];\r\n  setAlergias: (value: string[]) => void;\r\n  condicionesCronicas: string[];\r\n  setCondicionesCronicas: (value: string[]) => void;\r\n  medicamentosActuales: string[];\r\n  setMedicamentosActuales: (value: string[]) => void;\r\n  notasMedicas: string;\r\n  setNotasMedicas: (value: string) => void;\r\n  diagnosticos: string[];\r\n  setDiagnosticos: (value: string[]) => void;\r\n  onSave: () => void;\r\n  onBack: () => void;\r\n  loading: boolean;\r\n}\r\n\r\nexport function MedicalWorkspace({\r\n  paciente,\r\n  alergias,\r\n  condicionesCronicas,\r\n  medicamentosActuales,\r\n  setMedicamentosActuales,\r\n  notasMedicas,\r\n  setNotasMedicas,\r\n  diagnosticos,\r\n  setDiagnosticos,\r\n  onSave,\r\n  onBack,\r\n  loading,\r\n}: MedicalWorkspaceProps) {\r\n  const [activeTab, setActiveTab] = useState(\"notas\");\r\n  const [showHistorial, setShowHistorial] = useState(true);\r\n  const [showStructuredMarketplace, setShowStructuredMarketplace] = useState(false);\r\n  const [selectedStructuredTemplate, setSelectedStructuredTemplate] = useState<StructuredTemplate | null>(null);\r\n  const [freeNotesContent, setFreeNotesContent] = useState(notasMedicas);\r\n  const [structuredNotesContent, setStructuredNotesContent] = useState(\"\");\r\n\r\n  // Custom hooks\r\n  const autocomplete = useAutocomplete({ notasMedicas: freeNotesContent });\r\n  const historial = useHistorial(paciente.cedula);\r\n  const aiAnalysis = useAIAnalysis({\r\n    notasMedicas,\r\n    paciente,\r\n    alergias,\r\n    condicionesCronicas,\r\n    medicamentosActuales,\r\n    diagnosticos,\r\n    setDiagnosticos,\r\n  });\r\n\r\n\r\n\r\n\r\n\r\n  useEffect(() => {\r\n    if (activeTab === \"notas\") {\r\n      setFreeNotesContent(notasMedicas);\r\n    }\r\n  }, [activeTab, notasMedicas]);\r\n\r\n  const handleFreeNotesChange = (value: string) => {\r\n    setFreeNotesContent(value);\r\n    if (activeTab === \"notas\") {\r\n      setNotasMedicas(value);\r\n    }\r\n  };\r\n\r\n  const handleStructuredNotesChange = (value: string) => {\r\n    setStructuredNotesContent(value);\r\n    if (activeTab === \"estructurado\") {\r\n      setNotasMedicas(value);\r\n    }\r\n  };\r\n\r\n  const handleTabChange = (value: string) => {\r\n    if (value === \"notas\") {\r\n      setNotasMedicas(freeNotesContent);\r\n    }\r\n    if (value === \"estructurado\") {\r\n      setNotasMedicas(structuredNotesContent);\r\n    }\r\n    setActiveTab(value);\r\n  };\r\n\r\n  const handlePrint = () => {\r\n    window.print();\r\n  };\r\n\r\n  return (\r\n    <div className=\"h-screen w-full flex flex-col bg-gray-50 overflow-hidden\">\r\n      <WorkspaceHeader\r\n        paciente={paciente}\r\n        loading={loading}\r\n        onBack={onBack}\r\n        onSave={onSave}\r\n        onPrint={handlePrint}\r\n      />\r\n\r\n      <div className=\"flex-1 flex min-h-0\">\r\n        <div className=\"flex-1 flex flex-col min-w-0 bg-white\">\r\n          <Tabs value={activeTab} onValueChange={handleTabChange} className=\"flex-1 flex flex-col\">\r\n            <TabsHeader\r\n              activeTab={activeTab}\r\n              selectedStructuredTemplate={selectedStructuredTemplate}\r\n              notasMedicas={notasMedicas}\r\n              isAnalyzing={aiAnalysis.isAnalyzing}\r\n              onShowStructuredMarketplace={() => setShowStructuredMarketplace(true)}\r\n              onAnalyzeWithAI={aiAnalysis.handleAnalyzeWithAI}\r\n            />\r\n\r\n            {activeTab === \"estructurado\" && (\r\n              <TabsContent value=\"estructurado\" className=\"flex-1 m-0 flex flex-col overflow-hidden\">\r\n                <div className=\"flex-1 flex overflow-hidden\">\r\n                  <ScrollArea className=\"flex-1 bg-white\">\r\n                    <StructuredTemplateEditor\r\n                      template={selectedStructuredTemplate}\r\n                      onChange={handleStructuredNotesChange}\r\n                      paciente={paciente}\r\n                      medications={medicamentosActuales}\r\n                      onMedicationsChange={setMedicamentosActuales}\r\n                    />\r\n                  </ScrollArea>\r\n\r\n                  {aiAnalysis.showRecommendations && aiAnalysis.aiAnalysis && (\r\n                    <AIRecommendationsPanel\r\n                      aiAnalysis={aiAnalysis.aiAnalysis}\r\n                      onClose={() => aiAnalysis.setShowRecommendations(false)}\r\n                    />\r\n                  )}\r\n                </div>\r\n              </TabsContent>\r\n            )}\r\n\r\n            {activeTab === \"notas\" && (\r\n              <TabsContent value=\"notas\" className=\"flex-1 m-0 flex flex-col overflow-hidden\">\r\n                <div className=\"flex-1 flex overflow-hidden\">\r\n                  <FreeNotesEditor\r\n                    notasMedicas={freeNotesContent}\r\n                    setNotasMedicas={handleFreeNotesChange}\r\n                    autocomplete={autocomplete}\r\n                  />\r\n\r\n                  {aiAnalysis.showRecommendations && aiAnalysis.aiAnalysis && (\r\n                    <AIRecommendationsPanel\r\n                      aiAnalysis={aiAnalysis.aiAnalysis}\r\n                      onClose={() => aiAnalysis.setShowRecommendations(false)}\r\n                    />\r\n                  )}\r\n                </div>\r\n              </TabsContent>\r\n            )}\r\n\r\n            {activeTab === \"icd\" && (\r\n              <TabsContent value=\"icd\" className=\"flex-1 m-0 overflow-hidden\">\r\n                <ICDSearchTab\r\n                  diagnosticos={diagnosticos}\r\n                  notasMedicas={notasMedicas}\r\n                  onAddDiagnostico={(codigo, descripcion) => {\r\n                    const diagnostico = `${codigo} - ${descripcion}`;\r\n                    if (!diagnosticos.includes(diagnostico)) {\r\n                      setDiagnosticos([...diagnosticos, diagnostico]);\r\n                    }\r\n                  }}\r\n                  onRemoveDiagnostico={(index) => {\r\n                    setDiagnosticos(diagnosticos.filter((_, i) => i !== index));\r\n                  }}\r\n                />\r\n              </TabsContent>\r\n            )}\r\n          </Tabs>\r\n        </div>\r\n\r\n        <HistorialPanel\r\n          historialClinico={historial.historialClinico}\r\n          showHistorial={showHistorial}\r\n          onToggle={() => setShowHistorial(!showHistorial)}\r\n          onSelectItem={historial.setSelectedHistorial}\r\n        />\r\n      </div>\r\n\r\n      <HistorialDetailDialog\r\n        historial={historial.selectedHistorial}\r\n        onClose={() => historial.setSelectedHistorial(null)}\r\n      />\r\n\r\n      <StructuredTemplateMarketplace\r\n        open={showStructuredMarketplace}\r\n        onClose={() => setShowStructuredMarketplace(false)}\r\n        onSelectTemplate={(template) => {\r\n          setSelectedStructuredTemplate(template);\r\n          setShowStructuredMarketplace(false);\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\office-quick-selector-dropdown.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\office-quick-selector-modal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\pacientes\\consultation-action-button.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'checkActiveConsultation'. Either include it or remove the dependency array.","line":24,"column":6,"nodeType":"ArrayExpression","endLine":24,"endColumn":30,"suggestions":[{"desc":"Update the dependencies array to be: [checkActiveConsultation, patientId, patientType]","fix":{"range":[855,879],"text":"[checkActiveConsultation, patientId, patientType]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":85,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2855,2858],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2855,2858],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Stethoscope, Loader2, Play } from \"lucide-react\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { toast } from \"sonner\";\r\n\r\ninterface ConsultationActionButtonProps {\r\n  patientId: string;\r\n  patientType: \"registered\" | \"offline\";\r\n  className?: string;\r\n}\r\n\r\nexport function ConsultationActionButton({ patientId, patientType, className }: ConsultationActionButtonProps) {\r\n  const router = useRouter();\r\n  const [loading, setLoading] = useState(true);\r\n  const [actionLoading, setActionLoading] = useState(false);\r\n  const [activeAppointment, setActiveAppointment] = useState<{ id: string; status: string } | null>(null);\r\n\r\n  useEffect(() => {\r\n    checkActiveConsultation();\r\n  }, [patientId, patientType]);\r\n\r\n  const checkActiveConsultation = async () => {\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) return;\r\n\r\n      const query = supabase\r\n        .from(\"appointments\")\r\n        .select(\"id, status\")\r\n        .eq(\"medico_id\", user.id)\r\n        .not(\"status\", \"in\", '(\"completada\",\"cancelada\",\"completed\",\"cancelled\")'); // Excluir finalizadas\r\n\r\n      if (patientType === \"registered\") {\r\n        query.eq(\"paciente_id\", patientId);\r\n      } else {\r\n        query.eq(\"offline_patient_id\", patientId);\r\n      }\r\n\r\n      // Ordenar por fecha para obtener la más reciente si hay múltiples (aunque no debería)\r\n      const { data, error } = await query.order(\"fecha_hora\", { ascending: false }).limit(1).single();\r\n\r\n      if (error && error.code !== \"PGRST116\") { // Ignorar error si no encuentra registros\r\n        console.error(\"Error checking active consultation:\", error);\r\n      }\r\n\r\n      if (data) {\r\n        setActiveAppointment(data);\r\n      } else {\r\n        setActiveAppointment(null);\r\n      }\r\n    } catch (err) {\r\n      console.error(\"Error in checkActiveConsultation:\", err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleStartOrResume = async () => {\r\n    setActionLoading(true);\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) {\r\n        router.push(\"/login/medico\");\r\n        return;\r\n      }\r\n\r\n      // 1. Si ya hay una activa, navegar a ella\r\n      if (activeAppointment) {\r\n        const params = new URLSearchParams();\r\n        params.set(\"appointment_id\", activeAppointment.id);\r\n        params.set(\"paciente_id\", patientId);\r\n        params.set(\"from\", \"patient_profile\");\r\n        \r\n        router.push(`/dashboard/medico/pacientes/consulta?${params.toString()}`);\r\n        return;\r\n      }\r\n\r\n      // 2. Si no, crear una nueva \"en_consulta\" inmediatamente\r\n      const now = new Date();\r\n      \r\n      const newAppointmentData: any = {\r\n        medico_id: user.id,\r\n        fecha_hora: now.toISOString(),\r\n        duracion_minutos: 30, // Default\r\n        status: \"en_consulta\",\r\n        motivo: \"Consulta Iniciada desde Perfil\",\r\n        tipo_cita: \"presencial\",\r\n      };\r\n\r\n      if (patientType === \"registered\") {\r\n        newAppointmentData.paciente_id = patientId;\r\n      } else {\r\n        newAppointmentData.offline_patient_id = patientId;\r\n      }\r\n\r\n      const { data: newAppt, error: createError } = await supabase\r\n        .from(\"appointments\")\r\n        .insert(newAppointmentData)\r\n        .select()\r\n        .single();\r\n\r\n      if (createError) throw createError;\r\n\r\n      // Navegar a la nueva consulta\r\n      const params = new URLSearchParams();\r\n      params.set(\"appointment_id\", newAppt.id);\r\n      params.set(\"paciente_id\", patientId);\r\n      params.set(\"from\", \"patient_profile\");\r\n      \r\n      router.push(`/dashboard/medico/pacientes/consulta?${params.toString()}`);\r\n\r\n    } catch (err) {\r\n      console.error(\"Error starting consultation:\", err);\r\n      toast.error(\"Error\", {\r\n        description: \"No se pudo iniciar la consulta: \" + (err instanceof Error ? err.message : \"Error desconocido\"),\r\n      });\r\n    } finally {\r\n      setActionLoading(false);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <Button disabled variant=\"outline\" className={`h-auto py-4 ${className}`}>\r\n        <Loader2 className=\"h-6 w-6 animate-spin\" />\r\n      </Button>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Button\r\n      onClick={handleStartOrResume}\r\n      disabled={actionLoading}\r\n      className={`h-auto py-4 ${activeAppointment ? \"bg-green-600 hover:bg-green-700 text-white\" : \"\"} ${className}`}\r\n      variant={activeAppointment ? \"default\" : \"outline\"}\r\n    >\r\n      <div className=\"flex flex-col items-center gap-2\">\r\n        {actionLoading ? (\r\n          <Loader2 className=\"h-6 w-6 animate-spin\" />\r\n        ) : activeAppointment ? (\r\n          <Play className=\"h-6 w-6 fill-current\" />\r\n        ) : (\r\n          <Stethoscope className=\"h-6 w-6\" />\r\n        )}\r\n        <span>{activeAppointment ? \"Continuar Consulta\" : \"Iniciar Consulta\"}</span>\r\n      </div>\r\n    </Button>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\pacientes\\quick-registration-modal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[664,667],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[664,667],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { Label } from \"@red-salud/ui\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@red-salud/ui\";\r\nimport { Loader2 } from \"lucide-react\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\n\r\ninterface QuickRegistrationModalProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  cedula: string;\r\n  nombre: string;\r\n  onSuccess: (patientId: string, patientData: any) => void;\r\n}\r\n\r\nexport function QuickRegistrationModal({\r\n  open,\r\n  onOpenChange,\r\n  cedula,\r\n  nombre,\r\n  onSuccess,\r\n}: QuickRegistrationModalProps) {\r\n  const [loading, setLoading] = useState(false);\r\n  const [formData, setFormData] = useState({\r\n    nombre_completo: nombre || \"\",\r\n    cedula: cedula || \"\",\r\n    genero: \"\",\r\n    fecha_nacimiento: \"\",\r\n    telefono: \"\",\r\n    email: \"\",\r\n  });\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) throw new Error(\"No autenticado\");\r\n\r\n      // Crear paciente offline\r\n      const { data, error } = await supabase\r\n        .from(\"offline_patients\")\r\n        .insert({\r\n          doctor_id: user.id,\r\n          cedula: formData.cedula,\r\n          nombre_completo: formData.nombre_completo,\r\n          genero: formData.genero || null,\r\n          fecha_nacimiento: formData.fecha_nacimiento || null,\r\n          telefono: formData.telefono || null,\r\n          email: formData.email || null,\r\n          status: \"offline\",\r\n        })\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      await supabase.from(\"user_activity_log\").insert({\r\n        user_id: user.id,\r\n        activity_type: \"offline_patient_created\",\r\n        description: `Paciente rápido registrado: ${formData.nombre_completo}`,\r\n        status: \"success\",\r\n      });\r\n\r\n      onSuccess(data.id, data);\r\n      onOpenChange(false);\r\n    } catch (error) {\r\n      console.error(\"Error registering patient:\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={onOpenChange}>\r\n      <DialogContent className=\"sm:max-w-[500px]\">\r\n        <DialogHeader>\r\n          <DialogTitle>Registrar Paciente Nuevo</DialogTitle>\r\n          <DialogDescription>\r\n            Este paciente no está registrado. Completa los datos básicos para continuar.\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n\r\n        <form onSubmit={handleSubmit} className=\"space-y-4 py-4\">\r\n          <div className=\"grid grid-cols-2 gap-4\">\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"cedula\">Cédula</Label>\r\n              <Input\r\n                id=\"cedula\"\r\n                value={formData.cedula}\r\n                onChange={(e) => setFormData({ ...formData, cedula: e.target.value })}\r\n                required\r\n              />\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"genero\">Género</Label>\r\n              <Select\r\n                value={formData.genero}\r\n                onValueChange={(val) => setFormData({ ...formData, genero: val })}\r\n                required\r\n              >\r\n                <SelectTrigger>\r\n                  <SelectValue placeholder=\"Seleccionar\" />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  <SelectItem value=\"Masculino\">Masculino</SelectItem>\r\n                  <SelectItem value=\"Femenino\">Femenino</SelectItem>\r\n                  <SelectItem value=\"Otro\">Otro</SelectItem>\r\n                </SelectContent>\r\n              </Select>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"nombre\">Nombre Completo</Label>\r\n            <Input\r\n              id=\"nombre\"\r\n              value={formData.nombre_completo}\r\n              onChange={(e) => setFormData({ ...formData, nombre_completo: e.target.value })}\r\n              required\r\n            />\r\n          </div>\r\n\r\n          <div className=\"grid grid-cols-2 gap-4\">\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"fecha_nacimiento\">Fecha Nacimiento</Label>\r\n              <Input\r\n                id=\"fecha_nacimiento\"\r\n                type=\"date\"\r\n                value={formData.fecha_nacimiento}\r\n                onChange={(e) => setFormData({ ...formData, fecha_nacimiento: e.target.value })}\r\n              />\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"telefono\">Teléfono (Opcional)</Label>\r\n              <Input\r\n                id=\"telefono\"\r\n                type=\"tel\"\r\n                value={formData.telefono}\r\n                onChange={(e) => setFormData({ ...formData, telefono: e.target.value })}\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          <DialogFooter className=\"pt-4\">\r\n            <Button type=\"submit\" disabled={loading}>\r\n              {loading && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n              Registrar y Continuar\r\n            </Button>\r\n          </DialogFooter>\r\n        </form>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\patients\\filters-bar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\patients\\hooks\\usePatientsList.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":28,"column":6,"nodeType":"ArrayExpression","endLine":28,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [doctorId, loadData]","fix":{"range":[1355,1365],"text":"[doctorId, loadData]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'filterAndSortPatients'. Either include it or remove the dependency array.","line":52,"column":6,"nodeType":"ArrayExpression","endLine":52,"endColumn":87,"suggestions":[{"desc":"Update the dependencies array to be: [searchQuery, filterGender, filterAgeRange, filterLastVisit, sortBy, allPatients, filterAndSortPatients]","fix":{"range":[2198,2279],"text":"[searchQuery, filterGender, filterAgeRange, filterLastVisit, sortBy, allPatients, filterAndSortPatients]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { startOfDay } from \"date-fns\";\r\nimport type { RegisteredPatient, OfflinePatient } from \"../utils\";\r\n\r\nexport type ViewMode = \"table\" | \"grid\";\r\n\r\nexport function usePatientsList(doctorId: string | null) {\r\n  const [loading, setLoading] = useState(true);\r\n  const [patients, setPatients] = useState<RegisteredPatient[]>([]);\r\n  const [offlinePatients, setOfflinePatients] = useState<OfflinePatient[]>([]);\r\n  const [allPatients, setAllPatients] = useState<(RegisteredPatient | OfflinePatient)[]>([]);\r\n  const [filteredPatients, setFilteredPatients] = useState<(RegisteredPatient | OfflinePatient)[]>([]);\r\n  const [searchQuery, setSearchQuery] = useState(\"\");\r\n  const [filterGender, setFilterGender] = useState<string>(\"all\");\r\n  const [filterAgeRange, setFilterAgeRange] = useState<string>(\"all\");\r\n  const [filterLastVisit, setFilterLastVisit] = useState<string>(\"all\");\r\n  const [sortBy, setSortBy] = useState<string>(\"recent\");\r\n  const [viewMode, setViewMode] = useState<ViewMode>(\"table\");\r\n  const [todayAppointments, setTodayAppointments] = useState<number>(0);\r\n  const [newPatientsThisMonth, setNewPatientsThisMonth] = useState<number>(0);\r\n\r\n  useEffect(() => {\r\n    if (!doctorId) return;\r\n    loadData(doctorId);\r\n  }, [doctorId]);\r\n\r\n  useEffect(() => {\r\n    const combined = [\r\n      ...patients.map((p) => ({ ...p, type: \"registered\" as const })),\r\n      ...offlinePatients.map((p) => ({ ...p, type: \"offline\" as const })),\r\n    ];\r\n    setAllPatients(combined);\r\n\r\n    // Calculate new patients this month\r\n    const now = new Date();\r\n    const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);\r\n    const newCount = combined.filter(p => {\r\n      const createdAtStr = \"patient\" in p ? (p as RegisteredPatient).created_at : (p as OfflinePatient).created_at;\r\n      if (!createdAtStr) return false;\r\n      const createdDate = new Date(createdAtStr);\r\n      return createdDate >= startOfMonth;\r\n    }).length;\r\n    setNewPatientsThisMonth(newCount);\r\n\r\n  }, [patients, offlinePatients]);\r\n\r\n  useEffect(() => {\r\n    filterAndSortPatients();\r\n  }, [searchQuery, filterGender, filterAgeRange, filterLastVisit, sortBy, allPatients]);\r\n\r\n  const loadData = async (id: string) => {\r\n    try {\r\n      setLoading(true);\r\n      await Promise.all([loadPatients(id), loadOfflinePatients(id), loadTodayAppointments(id)]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const loadTodayAppointments = async (id: string) => {\r\n    const today = startOfDay(new Date()).toISOString();\r\n    const { data, error } = await supabase\r\n      .from(\"appointments\")\r\n      .select(\"id\")\r\n      .eq(\"doctor_id\", id)\r\n      .gte(\"appointment_date\", today)\r\n      .lt(\"appointment_date\", new Date(new Date().setDate(new Date().getDate() + 1)).toISOString())\r\n      .in(\"status\", [\"scheduled\", \"confirmed\"]);\r\n    if (!error && data) setTodayAppointments(data.length);\r\n  };\r\n\r\n  const loadPatients = async (id: string) => {\r\n    const { data, error } = await supabase\r\n      .from(\"doctor_patients\")\r\n      .select(`*,\r\n        patient:profiles!doctor_patients_patient_id_fkey(\r\n          id,\r\n          nombre_completo,\r\n          email,\r\n          avatar_url,\r\n          fecha_nacimiento,\r\n          genero,\r\n          telefono\r\n        )`)\r\n      .eq(\"doctor_id\", id)\r\n      .eq(\"status\", \"active\")\r\n      .order(\"last_consultation_date\", { ascending: false, nullsFirst: false });\r\n    if (!error && data) setPatients(data as unknown as RegisteredPatient[]);\r\n  };\r\n\r\n  const loadOfflinePatients = async (id: string) => {\r\n    const { data, error } = await supabase\r\n      .from(\"offline_patients\")\r\n      .select(\"*\")\r\n      .eq(\"doctor_id\", id)\r\n      .eq(\"status\", \"offline\")\r\n      .order(\"created_at\", { ascending: false });\r\n    if (!error && data) setOfflinePatients(data as unknown as OfflinePatient[]);\r\n  };\r\n\r\n  const filterAndSortPatients = () => {\r\n    const filtered = allPatients.filter((p) => {\r\n      const isRegistered = \"patient\" in p;\r\n      const pData = isRegistered ? (p as RegisteredPatient).patient : (p as OfflinePatient);\r\n      const name = pData.nombre_completo;\r\n      const email = pData.email || \"\";\r\n      const phone = pData.telefono;\r\n      const cedula = !isRegistered ? (p as OfflinePatient).cedula : \"\";\r\n      const gender = pData.genero;\r\n\r\n      // Calculate Age\r\n      let age = 0;\r\n      if (pData.fecha_nacimiento) {\r\n        const birthDate = new Date(pData.fecha_nacimiento);\r\n        const today = new Date();\r\n        age = today.getFullYear() - birthDate.getFullYear();\r\n        const m = today.getMonth() - birthDate.getMonth();\r\n        if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {\r\n          age--;\r\n        }\r\n      }\r\n\r\n      // Calculate Last Visit\r\n      const lastVisitDate = isRegistered && (p as RegisteredPatient).last_consultation_date\r\n        ? new Date((p as RegisteredPatient).last_consultation_date!)\r\n        : new Date((p as OfflinePatient).created_at); // Fallback to created_at for offline or if no consultation\r\n\r\n      const now = new Date();\r\n      const monthsSinceLastVisit = (now.getFullYear() - lastVisitDate.getFullYear()) * 12 + (now.getMonth() - lastVisitDate.getMonth());\r\n\r\n      const q = searchQuery.trim().toLowerCase();\r\n      const matchesSearch = !q ||\r\n        name.toLowerCase().includes(q) ||\r\n        email.toLowerCase().includes(q) ||\r\n        (phone ?? \"\").toLowerCase().includes(q) ||\r\n        cedula.toLowerCase().includes(q);\r\n\r\n      const matchesGender = filterGender === \"all\" || gender === filterGender;\r\n\r\n      const matchesAge = filterAgeRange === \"all\" ||\r\n        (filterAgeRange === \"0-18\" && age <= 18) ||\r\n        (filterAgeRange === \"19-60\" && age > 18 && age <= 60) ||\r\n        (filterAgeRange === \"60+\" && age > 60);\r\n\r\n      const matchesLastVisit = filterLastVisit === \"all\" ||\r\n        (filterLastVisit === \"recent\" && monthsSinceLastVisit < 1) ||\r\n        (filterLastVisit === \"medium\" && monthsSinceLastVisit >= 1 && monthsSinceLastVisit <= 6) ||\r\n        (filterLastVisit === \"long\" && monthsSinceLastVisit > 6);\r\n\r\n      return matchesSearch && matchesGender && matchesAge && matchesLastVisit;\r\n    });\r\n\r\n    if (sortBy === \"recent\") {\r\n      filtered.sort((a, b) => {\r\n        const isARegistered = \"patient\" in a;\r\n        const isBRegistered = \"patient\" in b;\r\n        const dateA = isARegistered && (a as RegisteredPatient).last_consultation_date\r\n          ? new Date((a as RegisteredPatient).last_consultation_date!).getTime()\r\n          : !isARegistered\r\n            ? new Date((a as OfflinePatient).created_at).getTime()\r\n            : 0;\r\n        const dateB = isBRegistered && (b as RegisteredPatient).last_consultation_date\r\n          ? new Date((b as RegisteredPatient).last_consultation_date!).getTime()\r\n          : !isBRegistered\r\n            ? new Date((b as OfflinePatient).created_at).getTime()\r\n            : 0;\r\n        return dateB - dateA;\r\n      });\r\n    } else if (sortBy === \"name\") {\r\n      filtered.sort((a, b) => {\r\n        const nameA = \"patient\" in a ? (a as RegisteredPatient).patient.nombre_completo : (a as OfflinePatient).nombre_completo;\r\n        const nameB = \"patient\" in b ? (b as RegisteredPatient).patient.nombre_completo : (b as OfflinePatient).nombre_completo;\r\n        return nameA.localeCompare(nameB);\r\n      });\r\n    } else if (sortBy === \"consultations\") {\r\n      filtered.sort((a, b) => {\r\n        const consultA = \"patient\" in a ? (a as RegisteredPatient).total_consultations : 0;\r\n        const consultB = \"patient\" in b ? (b as RegisteredPatient).total_consultations : 0;\r\n        return consultB - consultA;\r\n      });\r\n    }\r\n\r\n    setFilteredPatients(filtered);\r\n  };\r\n\r\n  return {\r\n    state: {\r\n      loading,\r\n      patients,\r\n      offlinePatients,\r\n      filteredPatients,\r\n      searchQuery,\r\n      filterGender,\r\n      filterAgeRange,\r\n      filterLastVisit,\r\n      sortBy,\r\n      viewMode,\r\n      todayAppointments,\r\n      newPatientsThisMonth,\r\n    },\r\n    actions: {\r\n      setSearchQuery,\r\n      setFilterGender,\r\n      setFilterAgeRange,\r\n      setFilterLastVisit,\r\n      setSortBy,\r\n      setViewMode,\r\n    },\r\n  };\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\patients\\metrics-modal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[160,163],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[160,163],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":99,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":102,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2093,2096],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2093,2096],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { Card, CardContent } from \"@red-salud/ui\";\r\n\r\ninterface MetricsModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    data: any;\r\n}\r\n\r\nexport function MetricsModal({ isOpen, onClose, data }: MetricsModalProps) {\r\n    if (!isOpen || !data) return null;\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\r\n            <Card className=\"w-full max-w-2xl max-h-[80vh] overflow-y-auto\">\r\n                <CardContent className=\"p-6\">\r\n                    <div className=\"flex items-center justify-between mb-6\">\r\n                        <h3 className=\"text-xl font-bold\">Métricas de Tiempo de Consulta</h3>\r\n                        <button\r\n                            onClick={onClose}\r\n                            className=\"text-gray-400 hover:text-gray-600\"\r\n                        >\r\n                            ✕\r\n                        </button>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-6\">\r\n                        {/* Resumen General */}\r\n                        <div className=\"bg-purple-50 p-4 rounded-lg\">\r\n                            <p className=\"text-sm text-gray-600 mb-1\">Tiempo Promedio General</p>\r\n                            <p className=\"text-4xl font-bold text-purple-600\">\r\n                                {data.avg_minutes || 0} minutos\r\n                            </p>\r\n                            <p className=\"text-sm text-gray-500 mt-1\">\r\n                                Basado en {data.total_consultations || 0} consultas completadas\r\n                            </p>\r\n                        </div>\r\n\r\n                        {/* Desglose por Motivo */}\r\n                        <div>\r\n                            <h4 className=\"font-semibold mb-3\">Tiempo por Motivo de Consulta</h4>\r\n                            {data.by_motivo && Object.keys(data.by_motivo).length > 0 ? (\r\n                                <div className=\"space-y-2\">\r\n                                    {Object.entries(data.by_motivo).map(([motivo, data]: [string, any]) => (\r\n                                        <div key={motivo} className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\r\n                                            <div className=\"flex-1\">\r\n                                                <p className=\"font-medium text-gray-900\">{motivo}</p>\r\n                                                <p className=\"text-xs text-gray-500\">{data.count} consultas</p>\r\n                                            </div>\r\n                                            <div className=\"text-right\">\r\n                                                <p className=\"text-lg font-bold text-purple-600\">{data.avg_minutes}min</p>\r\n                                            </div>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            ) : (\r\n                                <p className=\"text-gray-500 text-center py-4\">\r\n                                    No hay suficientes datos para mostrar desglose por motivo\r\n                                </p>\r\n                            )}\r\n                        </div>\r\n\r\n                        <div className=\"pt-4 border-t\">\r\n                            <p className=\"text-xs text-gray-500 text-center\">\r\n                                Datos de los últimos 30 días • Actualizado en tiempo real\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n                </CardContent>\r\n            </Card>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\patients\\patients-grid.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":60,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2466,2469],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2466,2469],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { Card, CardContent } from \"@red-salud/ui\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Eye, Mail, Phone, MessageSquare } from \"lucide-react\";\r\nimport { calculateAge, getInitials, RegisteredPatient, OfflinePatient } from \"./utils\";\r\n\r\nimport { Skeleton } from \"@red-salud/ui\";\r\n\r\ninterface PatientsGridProps {\r\n  patients: (RegisteredPatient | OfflinePatient)[];\r\n  onView: (p: RegisteredPatient | OfflinePatient) => void;\r\n  onMessage: (p: RegisteredPatient) => void;\r\n  loading?: boolean;\r\n}\r\n\r\nexport function PatientsGrid({ patients, onView, onMessage, loading = false }: PatientsGridProps) {\r\n  return (\r\n    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n      {loading ? (\r\n        Array.from({ length: 6 }).map((_, i) => (\r\n          <Card key={i} className=\"hover:shadow-md transition-shadow\">\r\n            <CardContent className=\"p-5\">\r\n              <div className=\"flex items-start gap-3 mb-4\">\r\n                <Skeleton className=\"h-12 w-12 rounded-full\" />\r\n                <div className=\"flex-1 min-w-0 space-y-2\">\r\n                  <Skeleton className=\"h-5 w-32\" />\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Skeleton className=\"h-5 w-16\" />\r\n                    <Skeleton className=\"h-4 w-12\" />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"space-y-2 mb-4\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <Skeleton className=\"h-3 w-3\" />\r\n                  <Skeleton className=\"h-3 w-24\" />\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <Skeleton className=\"h-3 w-3\" />\r\n                  <Skeleton className=\"h-3 w-32\" />\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"flex gap-2\">\r\n                <Skeleton className=\"h-9 flex-1\" />\r\n                <Skeleton className=\"h-9 flex-1\" />\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        ))\r\n      ) : (\r\n        patients.map((patient) => {\r\n          const isRegistered = \"patient\" in patient;\r\n          const pData = isRegistered ? (patient as RegisteredPatient).patient : (patient as OfflinePatient);\r\n          const age = calculateAge(pData.fecha_nacimiento);\r\n          return (\r\n            <Card key={(patient as any).id} className=\"hover:shadow-md transition-shadow\">\r\n              <CardContent className=\"p-5\">\r\n                <div className=\"flex items-start gap-3 mb-4\">\r\n                  <Avatar className=\"h-12 w-12\">\r\n                    {isRegistered && \"avatar_url\" in pData && (\r\n                      <AvatarImage src={pData.avatar_url || undefined} />\r\n                    )}\r\n                    <AvatarFallback className=\"text-sm\">{getInitials(pData.nombre_completo)}</AvatarFallback>\r\n                  </Avatar>\r\n                  <div className=\"flex-1 min-w-0\">\r\n                    <h3 className=\"font-semibold text-gray-900 truncate\">{pData.nombre_completo}</h3>\r\n                    <div className=\"flex items-center gap-2 mt-1 text-sm text-gray-500\">\r\n                      {age && <span>{age} años</span>}\r\n                      {age && pData.genero && <span>•</span>}\r\n                      {pData.genero && (\r\n                        <span>{pData.genero === \"M\" ? \"Masculino\" : \"Femenino\"}</span>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"space-y-2 mb-4\">\r\n                  {!isRegistered && (patient as OfflinePatient).cedula && (\r\n                    <div className=\"flex items-center gap-2 text-sm text-gray-600\">\r\n                      <span className=\"font-mono text-xs\">{(patient as OfflinePatient).cedula}</span>\r\n                    </div>\r\n                  )}\r\n                  {pData.telefono && (\r\n                    <div className=\"flex items-center gap-2 text-sm text-gray-600\">\r\n                      <Phone className=\"h-3 w-3 flex-shrink-0\" />\r\n                      <span className=\"truncate\">{pData.telefono}</span>\r\n                    </div>\r\n                  )}\r\n                  {pData.email && (\r\n                    <div className=\"flex items-center gap-2 text-sm text-gray-600\">\r\n                      <Mail className=\"h-3 w-3 flex-shrink-0\" />\r\n                      <span className=\"truncate\">{pData.email}</span>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                <div className=\"flex gap-2\">\r\n                  <Button variant=\"outline\" size=\"sm\" className=\"flex-1\" onClick={() => onView(patient)}>\r\n                    <Eye className=\"h-3 w-3 mr-1\" />\r\n                    Ver\r\n                  </Button>\r\n                  {isRegistered && (\r\n                    <Button variant=\"outline\" size=\"sm\" className=\"flex-1\" onClick={() => onMessage(patient as RegisteredPatient)}>\r\n                      <MessageSquare className=\"h-3 w-3 mr-1\" />\r\n                      Mensaje\r\n                    </Button>\r\n                  )}\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          );\r\n        })\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\patients\\patients-table.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":98,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3997,4000],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3997,4000],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport {\r\n  Table,\r\n  TableBody,\r\n  TableCell,\r\n  TableHead,\r\n  TableHeader,\r\n  TableRow,\r\n} from \"@red-salud/ui\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Eye, Mail, Phone, MessageSquare } from \"lucide-react\";\r\nimport { format } from \"date-fns\";\r\nimport { es } from \"date-fns/locale\";\r\nimport { calculateAge, getInitials, RegisteredPatient, OfflinePatient } from \"./utils\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport { Skeleton } from \"@red-salud/ui\";\r\n\r\ninterface PatientsTableProps {\r\n  patients: (RegisteredPatient | OfflinePatient)[];\r\n  onView: (p: RegisteredPatient | OfflinePatient) => void;\r\n  onMessage: (p: RegisteredPatient) => void;\r\n  loading?: boolean;\r\n}\r\n\r\nexport function PatientsTable({ patients, onView, onMessage, loading = false }: PatientsTableProps) {\r\n  return (\r\n    <Card>\r\n      <CardHeader>\r\n        <CardTitle>Mis Pacientes</CardTitle>\r\n        <CardDescription>\r\n          {loading ? (\r\n            <Skeleton className=\"h-4 w-32\" />\r\n          ) : (\r\n            `${patients.length} pacientes encontrados`\r\n          )}\r\n        </CardDescription>\r\n      </CardHeader>\r\n      <CardContent>\r\n        <div className=\"rounded-md border\">\r\n          <Table>\r\n            <TableHeader>\r\n              <TableRow>\r\n                <TableHead>Paciente</TableHead>\r\n                <TableHead>Contacto</TableHead>\r\n                <TableHead>Edad/Género</TableHead>\r\n                <TableHead>Última Actividad</TableHead>\r\n                <TableHead className=\"text-right\">Acciones</TableHead>\r\n              </TableRow>\r\n            </TableHeader>\r\n            <TableBody>\r\n              {loading ? (\r\n                Array.from({ length: 5 }).map((_, i) => (\r\n                  <TableRow key={i}>\r\n                    <TableCell>\r\n                      <div className=\"flex items-center gap-3\">\r\n                        <Skeleton className=\"h-10 w-10 rounded-full\" />\r\n                        <div className=\"space-y-2\">\r\n                          <Skeleton className=\"h-4 w-32\" />\r\n                          <Skeleton className=\"h-3 w-20\" />\r\n                        </div>\r\n                      </div>\r\n                    </TableCell>\r\n                    <TableCell>\r\n                      <div className=\"space-y-2\">\r\n                        <Skeleton className=\"h-4 w-24\" />\r\n                        <Skeleton className=\"h-3 w-32\" />\r\n                      </div>\r\n                    </TableCell>\r\n                    <TableCell>\r\n                      <div className=\"space-y-2\">\r\n                        <Skeleton className=\"h-4 w-16\" />\r\n                        <Skeleton className=\"h-3 w-8\" />\r\n                      </div>\r\n                    </TableCell>\r\n                    <TableCell>\r\n                      <div className=\"space-y-2\">\r\n                        <Skeleton className=\"h-4 w-24\" />\r\n                        <Skeleton className=\"h-3 w-16\" />\r\n                      </div>\r\n                    </TableCell>\r\n                    <TableCell className=\"text-right\">\r\n                      <Skeleton className=\"h-8 w-8 rounded-full ml-auto\" />\r\n                    </TableCell>\r\n                  </TableRow>\r\n                ))\r\n              ) : (\r\n                patients.map((patient) => {\r\n                  const isRegistered = \"patient\" in patient;\r\n                  const pData = isRegistered ? (patient as RegisteredPatient).patient : (patient as OfflinePatient);\r\n                  const age = calculateAge(pData.fecha_nacimiento);\r\n                  const lastActivity = isRegistered && (patient as RegisteredPatient).last_consultation_date\r\n                    ? new Date((patient as RegisteredPatient).last_consultation_date!)\r\n                    : new Date((patient as OfflinePatient).created_at);\r\n\r\n                  return (\r\n                    <TableRow key={(patient as any).id}>\r\n                      <TableCell>\r\n                        <div className=\"flex items-center gap-3\">\r\n                          <Avatar>\r\n                            {isRegistered && \"avatar_url\" in pData && (\r\n                              <AvatarImage src={pData.avatar_url || undefined} />\r\n                            )}\r\n                            <AvatarFallback>{getInitials(pData.nombre_completo)}</AvatarFallback>\r\n                          </Avatar>\r\n                          <div>\r\n                            <div className=\"font-medium\">{pData.nombre_completo}</div>\r\n                            {!isRegistered && (patient as OfflinePatient).cedula && (\r\n                              <div className=\"text-xs text-muted-foreground\">\r\n                                {(patient as OfflinePatient).cedula}\r\n                              </div>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                      </TableCell>\r\n                      <TableCell>\r\n                        <div className=\"flex flex-col gap-1 text-sm text-muted-foreground\">\r\n                          {pData.telefono && (\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <Phone className=\"h-3 w-3\" />\r\n                              {pData.telefono}\r\n                            </div>\r\n                          )}\r\n                          {pData.email && (\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <Mail className=\"h-3 w-3\" />\r\n                              {pData.email}\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                      </TableCell>\r\n                      <TableCell>\r\n                        <div className=\"flex flex-col text-sm\">\r\n                          <span>{age ? `${age} años` : \"N/A\"}</span>\r\n                          <span className=\"text-muted-foreground\">\r\n                            {pData.genero === \"M\" ? \"Masculino\" : pData.genero === \"F\" ? \"Femenino\" : \"N/A\"}\r\n                          </span>\r\n                        </div>\r\n                      </TableCell>\r\n                      <TableCell>\r\n                        <div className=\"flex flex-col text-sm\">\r\n                          <span>{format(lastActivity, \"dd/MM/yyyy\", { locale: es })}</span>\r\n                          <span className=\"text-xs text-muted-foreground\">\r\n                            {isRegistered && (patient as RegisteredPatient).last_consultation_date\r\n                              ? \"Última consulta\"\r\n                              : \"Registrado\"}\r\n                          </span>\r\n                        </div>\r\n                      </TableCell>\r\n                      <TableCell className=\"text-right\">\r\n                        <div className=\"flex justify-end gap-2\">\r\n                          <Button variant=\"ghost\" size=\"icon\" onClick={() => onView(patient)}>\r\n                            <Eye className=\"h-4 w-4\" />\r\n                          </Button>\r\n                          {isRegistered && (\r\n                            <Button variant=\"ghost\" size=\"icon\" onClick={() => onMessage(patient as RegisteredPatient)}>\r\n                              <MessageSquare className=\"h-4 w-4\" />\r\n                            </Button>\r\n                          )}\r\n                        </div>\r\n                      </TableCell>\r\n                    </TableRow>\r\n                  );\r\n                })\r\n              )}\r\n            </TableBody>\r\n          </Table>\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\patients\\stats-cards.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'registeredCount' is defined but never used.","line":32,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'offlineCount' is defined but never used.","line":33,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Card, CardContent } from \"@red-salud/ui\";\r\nimport {\r\n    Users,\r\n    CalendarClock,\r\n    TrendingUp,\r\n    ChevronDown,\r\n    ChevronUp,\r\n    UserPlus\r\n} from \"lucide-react\";\r\nimport { Skeleton } from \"@red-salud/ui\";\r\n\r\ninterface StatsCardsProps {\r\n    todayCount: number;\r\n    completedToday: number;\r\n    waiting: number;\r\n    totalPatients: number;\r\n    registeredCount: number;\r\n    offlineCount: number;\r\n    newPatientsThisMonth: number;\r\n    avgConsultationTime: number;\r\n    expandedSection: string | null;\r\n    onToggleSection: (section: string) => void;\r\n    onShowMetrics: () => void;\r\n    loading?: boolean;\r\n}\r\n\r\nexport function StatsCards({\r\n    todayCount,\r\n    completedToday,\r\n    waiting,\r\n    totalPatients,\r\n    registeredCount,\r\n    offlineCount,\r\n    newPatientsThisMonth,\r\n    avgConsultationTime,\r\n    expandedSection,\r\n    onToggleSection,\r\n    onShowMetrics,\r\n    loading = false,\r\n}: StatsCardsProps) {\r\n    return (\r\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n            {/* Pacientes de Hoy */}\r\n            <Card\r\n                className=\"border-l-4 border-l-green-500 cursor-pointer hover:shadow-lg transition-shadow\"\r\n                onClick={() => onToggleSection(\"today\")}\r\n            >\r\n                <CardContent className=\"p-6\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <div className=\"flex-1\">\r\n                            <div className=\"flex items-center justify-between mb-2\">\r\n                                <p className=\"text-sm font-medium text-gray-600\">Pacientes de Hoy</p>\r\n                                {expandedSection === \"today\" ? (\r\n                                    <ChevronUp className=\"h-4 w-4 text-gray-400\" />\r\n                                ) : (\r\n                                    <ChevronDown className=\"h-4 w-4 text-gray-400\" />\r\n                                )}\r\n                            </div>\r\n                            {loading ? (\r\n                                <Skeleton className=\"h-9 w-16 mb-2\" />\r\n                            ) : (\r\n                                <p className=\"text-3xl font-bold text-gray-900\">{todayCount}</p>\r\n                            )}\r\n                            <p className=\"text-xs text-gray-500 mt-1\">\r\n                                {loading ? (\r\n                                    <Skeleton className=\"h-4 w-32\" />\r\n                                ) : (\r\n                                    `${completedToday} completadas • ${waiting} esperando`\r\n                                )}\r\n                            </p>\r\n                        </div>\r\n                        <div className=\"h-14 w-14 rounded-full bg-green-100 flex items-center justify-center\">\r\n                            <CalendarClock className=\"h-7 w-7 text-green-600\" />\r\n                        </div>\r\n                    </div>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            {/* Total de Pacientes */}\r\n            <Card\r\n                className=\"border-l-4 border-l-blue-500 cursor-pointer hover:shadow-lg transition-shadow\"\r\n                onClick={() => onToggleSection(\"all\")}\r\n            >\r\n                <CardContent className=\"p-6\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <div className=\"flex-1\">\r\n                            <div className=\"flex items-center justify-between mb-2\">\r\n                                <p className=\"text-sm font-medium text-gray-600\">Total de Pacientes</p>\r\n                                {expandedSection === \"all\" ? (\r\n                                    <ChevronUp className=\"h-4 w-4 text-gray-400\" />\r\n                                ) : (\r\n                                    <ChevronDown className=\"h-4 w-4 text-gray-400\" />\r\n                                )}\r\n                            </div>\r\n                            {loading ? (\r\n                                <Skeleton className=\"h-9 w-16 mb-2\" />\r\n                            ) : (\r\n                                <p className=\"text-3xl font-bold text-gray-900\">\r\n                                    {totalPatients}\r\n                                </p>\r\n                            )}\r\n                            <p className=\"text-xs text-gray-500 mt-1\">\r\n                                {loading ? (\r\n                                    <Skeleton className=\"h-4 w-32\" />\r\n                                ) : (\r\n                                    \"Pacientes activos\"\r\n                                )}\r\n                            </p>\r\n                        </div>\r\n                        <div className=\"h-14 w-14 rounded-full bg-blue-100 flex items-center justify-center\">\r\n                            <Users className=\"h-7 w-7 text-blue-600\" />\r\n                        </div>\r\n                    </div>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            {/* Nuevos este Mes */}\r\n            <Card className=\"border-l-4 border-l-indigo-500\">\r\n                <CardContent className=\"p-6\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <div>\r\n                            <p className=\"text-sm font-medium text-gray-600\">Nuevos este Mes</p>\r\n                            {loading ? (\r\n                                <Skeleton className=\"h-9 w-16 mt-2 mb-2\" />\r\n                            ) : (\r\n                                <p className=\"text-3xl font-bold text-gray-900 mt-2\">{newPatientsThisMonth}</p>\r\n                            )}\r\n                            <p className=\"text-xs text-gray-500 mt-1\">Crecimiento mensual</p>\r\n                        </div>\r\n                        <div className=\"h-14 w-14 rounded-full bg-indigo-100 flex items-center justify-center\">\r\n                            <UserPlus className=\"h-7 w-7 text-indigo-600\" />\r\n                        </div>\r\n                    </div>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            {/* Promedio Tiempo */}\r\n            <Card\r\n                className=\"border-l-4 border-l-purple-500 cursor-pointer hover:shadow-lg transition-shadow\"\r\n                onClick={onShowMetrics}\r\n            >\r\n                <CardContent className=\"p-6\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <div className=\"flex-1\">\r\n                            <div className=\"flex items-center justify-between mb-2\">\r\n                                <p className=\"text-sm font-medium text-gray-600\">Tiempo Promedio</p>\r\n                                <ChevronDown className=\"h-4 w-4 text-gray-400\" />\r\n                            </div>\r\n                            {loading ? (\r\n                                <Skeleton className=\"h-9 w-24 mb-2\" />\r\n                            ) : (\r\n                                <p className=\"text-3xl font-bold text-gray-900\">\r\n                                    {avgConsultationTime > 0 ? `${avgConsultationTime}min` : \"--\"}\r\n                                </p>\r\n                            )}\r\n                            <p className=\"text-xs text-gray-500 mt-1\">\r\n                                Click para ver detalles por motivo\r\n                            </p>\r\n                        </div>\r\n                        <div className=\"h-14 w-14 rounded-full bg-purple-100 flex items-center justify-center\">\r\n                            <TrendingUp className=\"h-7 w-7 text-purple-600\" />\r\n                        </div>\r\n                    </div>\r\n                </CardContent>\r\n            </Card>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\patients\\today-appointments.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\patients\\today-patients-section.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'UserX' is defined but never used.","line":14,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":8},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadTodayAppointments'. Either include it or remove the dependency array.","line":132,"column":6,"nodeType":"ArrayExpression","endLine":132,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [doctorId, loadTodayAppointments]","fix":{"range":[4186,4196],"text":"[doctorId, loadTodayAppointments]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":347,"column":84,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":347,"endColumn":87,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11236,11239],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11236,11239],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":353,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":353,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11549,11552],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11549,11552],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@red-salud/ui\";\r\nimport { \r\n  CalendarClock, \r\n  Clock, \r\n  Play, \r\n  CheckCircle2, \r\n  UserX,\r\n  Loader2,\r\n  AlertCircle\r\n} from \"lucide-react\";\r\nimport { format } from \"date-fns\";\r\nimport { es } from \"date-fns/locale\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\n\r\n// Funciones locales para evitar problemas de importación\r\nasync function changeAppointmentStatus(\r\n  appointmentId: string,\r\n  newStatus: string,\r\n  userId: string,\r\n  reason?: string\r\n) {\r\n  try {\r\n    const { data, error } = await supabase.rpc(\"change_appointment_status\", {\r\n      p_appointment_id: appointmentId,\r\n      p_new_status: newStatus,\r\n      p_user_id: userId,\r\n      p_reason: reason || null,\r\n    });\r\n\r\n    if (error) {\r\n      console.error(\"Error changing appointment status:\", error);\r\n      return { success: false, error: error.message };\r\n    }\r\n\r\n    return data as { success: boolean; error?: string };\r\n  } catch (err) {\r\n    console.error(\"Exception changing appointment status:\", err);\r\n    return { success: false, error: err instanceof Error ? err.message : \"Error desconocido\" };\r\n  }\r\n}\r\n\r\nasync function getTodayAppointments(doctorId: string, date?: Date) {\r\n  try {\r\n    const targetDate = date || new Date();\r\n    const dateStr = targetDate.toISOString().split(\"T\")[0];\r\n\r\n    const { data, error } = await supabase.rpc(\"get_today_appointments\", {\r\n      p_doctor_id: doctorId,\r\n      p_date: dateStr,\r\n    });\r\n\r\n    if (error) {\r\n      console.error(\"Error getting today appointments:\", error);\r\n      return { data: null, error };\r\n    }\r\n\r\n    return { data, error: null };\r\n  } catch (err) {\r\n    console.error(\"Exception getting today appointments:\", err);\r\n    return { data: null, error: err };\r\n  }\r\n}\r\n\r\nfunction getStatusColor(status: string): string {\r\n  const colors: Record<string, string> = {\r\n    pendiente: \"bg-yellow-100 text-yellow-800 border-yellow-300\",\r\n    confirmada: \"bg-blue-100 text-blue-800 border-blue-300\",\r\n    en_espera: \"bg-purple-100 text-purple-800 border-purple-300\",\r\n    en_consulta: \"bg-indigo-100 text-indigo-800 border-indigo-300\",\r\n    completada: \"bg-green-100 text-green-800 border-green-300\",\r\n    no_asistio: \"bg-orange-100 text-orange-800 border-orange-300\",\r\n    cancelada: \"bg-red-100 text-red-800 border-red-300\",\r\n    rechazada: \"bg-gray-100 text-gray-800 border-gray-300\",\r\n  };\r\n  return colors[status] || colors.pendiente;\r\n}\r\n\r\nfunction getStatusLabel(status: string): string {\r\n  const labels: Record<string, string> = {\r\n    pendiente: \"Pendiente\",\r\n    confirmada: \"Confirmada\",\r\n    en_espera: \"En Espera\",\r\n    en_consulta: \"En Consulta\",\r\n    completada: \"Completada\",\r\n    no_asistio: \"No Asistió\",\r\n    cancelada: \"Cancelada\",\r\n    rechazada: \"Rechazada\",\r\n  };\r\n  return labels[status] || status;\r\n}\r\nimport { Alert, AlertDescription } from \"@red-salud/ui\";\r\n\r\ninterface TodayAppointment {\r\n  id: string;\r\n  paciente_id: string | null;\r\n  offline_patient_id: string | null;\r\n  paciente_nombre: string;\r\n  paciente_avatar: string | null;\r\n  fecha_hora: string;\r\n  duracion_minutos: number;\r\n  motivo: string;\r\n  status: string;\r\n  tipo_cita: string;\r\n  started_at: string | null;\r\n  completed_at: string | null;\r\n  patient_arrived_at: string | null;\r\n}\r\n\r\ninterface TodayPatientsSectionProps {\r\n  doctorId: string;\r\n}\r\n\r\nexport function TodayPatientsSection({ doctorId }: TodayPatientsSectionProps) {\r\n  const router = useRouter();\r\n  const [appointments, setAppointments] = useState<TodayAppointment[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [actionLoading, setActionLoading] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    loadTodayAppointments();\r\n    // Recargar cada 30 segundos\r\n    const interval = setInterval(loadTodayAppointments, 30000);\r\n    return () => clearInterval(interval);\r\n  }, [doctorId]);\r\n\r\n  const loadTodayAppointments = async () => {\r\n    try {\r\n      const { data, error } = await getTodayAppointments(doctorId);\r\n      if (error) throw error;\r\n      setAppointments(data || []);\r\n      setError(null);\r\n    } catch (err) {\r\n      console.error(\"Error loading today appointments:\", err);\r\n      setError(\"Error al cargar las citas del día\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleStartConsultation = async (appointment: TodayAppointment) => {\r\n    setActionLoading(appointment.id);\r\n    try {\r\n      // Cambiar estado a \"en_consulta\"\r\n      const result = await changeAppointmentStatus(\r\n        appointment.id,\r\n        \"en_consulta\",\r\n        doctorId\r\n      );\r\n\r\n      if (!result.success) {\r\n        throw new Error(result.error || \"Error al iniciar consulta\");\r\n      }\r\n\r\n      // Redirigir al editor de consulta\r\n      const params = new URLSearchParams({\r\n        appointment_id: appointment.id,\r\n        paciente_id: appointment.paciente_id || appointment.offline_patient_id || \"\",\r\n        from: \"today\",\r\n      });\r\n\r\n      router.push(`/dashboard/medico/pacientes/consulta?${params.toString()}`);\r\n    } catch (err) {\r\n      console.error(\"Error starting consultation:\", err);\r\n      alert(err instanceof Error ? err.message : \"Error al iniciar la consulta\");\r\n    } finally {\r\n      setActionLoading(null);\r\n    }\r\n  };\r\n\r\n  const handleMarkArrival = async (appointment: TodayAppointment) => {\r\n    setActionLoading(appointment.id);\r\n    try {\r\n      const result = await changeAppointmentStatus(\r\n        appointment.id,\r\n        \"en_espera\",\r\n        doctorId\r\n      );\r\n\r\n      if (!result.success) {\r\n        throw new Error(result.error || \"Error al marcar llegada\");\r\n      }\r\n\r\n      await loadTodayAppointments();\r\n    } catch (err) {\r\n      console.error(\"Error marking arrival:\", err);\r\n      alert(err instanceof Error ? err.message : \"Error al marcar la llegada\");\r\n    } finally {\r\n      setActionLoading(null);\r\n    }\r\n  };\r\n\r\n  const getInitials = (name: string) => {\r\n    return name\r\n      .split(\" \")\r\n      .map((n) => n[0])\r\n      .join(\"\")\r\n      .toUpperCase()\r\n      .slice(0, 2);\r\n  };\r\n\r\n  const getActionButton = (appointment: TodayAppointment) => {\r\n    const isLoading = actionLoading === appointment.id;\r\n\r\n    switch (appointment.status) {\r\n      case \"confirmada\":\r\n        return (\r\n          <Button\r\n            size=\"sm\"\r\n            variant=\"outline\"\r\n            onClick={() => handleMarkArrival(appointment)}\r\n            disabled={isLoading}\r\n            className=\"text-purple-600 border-purple-300 hover:bg-purple-50\"\r\n          >\r\n            {isLoading ? (\r\n              <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n            ) : (\r\n              <>\r\n                <Clock className=\"h-4 w-4 mr-1\" />\r\n                Marcar Llegada\r\n              </>\r\n            )}\r\n          </Button>\r\n        );\r\n      case \"en_espera\":\r\n        return (\r\n          <Button\r\n            size=\"sm\"\r\n            onClick={() => handleStartConsultation(appointment)}\r\n            disabled={isLoading}\r\n            className=\"bg-indigo-600 hover:bg-indigo-700\"\r\n          >\r\n            {isLoading ? (\r\n              <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n            ) : (\r\n              <>\r\n                <Play className=\"h-4 w-4 mr-1\" />\r\n                Iniciar Consulta\r\n              </>\r\n            )}\r\n          </Button>\r\n        );\r\n      case \"en_consulta\":\r\n        return (\r\n          <Button\r\n            size=\"sm\"\r\n            variant=\"outline\"\r\n            onClick={() => handleStartConsultation(appointment)}\r\n            disabled={isLoading}\r\n            className=\"text-indigo-600 border-indigo-300 hover:bg-indigo-50\"\r\n          >\r\n            Continuar Consulta\r\n          </Button>\r\n        );\r\n      case \"completada\":\r\n        return (\r\n          <Badge className=\"bg-green-100 text-green-800 border-green-300\">\r\n            <CheckCircle2 className=\"h-3 w-3 mr-1\" />\r\n            Completada\r\n          </Badge>\r\n        );\r\n      default:\r\n        return null;\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"flex items-center gap-2\">\r\n            <CalendarClock className=\"h-5 w-5\" />\r\n            Pacientes de Hoy\r\n          </CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"flex items-center justify-center py-8\">\r\n            <Loader2 className=\"h-8 w-8 animate-spin text-gray-400\" />\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Card>\r\n      <CardHeader>\r\n        <div className=\"flex items-center justify-between\">\r\n          <CardTitle className=\"flex items-center gap-2\">\r\n            <CalendarClock className=\"h-5 w-5\" />\r\n            Pacientes de Hoy\r\n          </CardTitle>\r\n          <Badge variant=\"outline\" className=\"text-sm\">\r\n            {appointments.length} {appointments.length === 1 ? \"paciente\" : \"pacientes\"}\r\n          </Badge>\r\n        </div>\r\n      </CardHeader>\r\n      <CardContent>\r\n        {error && (\r\n          <Alert variant=\"destructive\" className=\"mb-4\">\r\n            <AlertCircle className=\"h-4 w-4\" />\r\n            <AlertDescription>{error}</AlertDescription>\r\n          </Alert>\r\n        )}\r\n\r\n        {appointments.length === 0 ? (\r\n          <div className=\"text-center py-8\">\r\n            <CalendarClock className=\"h-12 w-12 text-gray-300 mx-auto mb-3\" />\r\n            <p className=\"text-gray-500 text-sm\">\r\n              No hay pacientes programados para hoy\r\n            </p>\r\n          </div>\r\n        ) : (\r\n          <div className=\"space-y-3\">\r\n            {appointments.map((appointment) => (\r\n              <div\r\n                key={appointment.id}\r\n                className={`\r\n                  flex items-center justify-between p-4 border rounded-lg \r\n                  transition-all hover:shadow-md\r\n                  ${appointment.status === \"en_consulta\" ? \"bg-indigo-50 border-indigo-200\" : \"\"}\r\n                  ${appointment.status === \"en_espera\" ? \"bg-purple-50 border-purple-200\" : \"\"}\r\n                `}\r\n              >\r\n                <div className=\"flex items-center gap-3 flex-1 min-w-0\">\r\n                  <Avatar className=\"h-10 w-10 flex-shrink-0\">\r\n                    <AvatarImage src={appointment.paciente_avatar || undefined} />\r\n                    <AvatarFallback className=\"text-sm\">\r\n                      {getInitials(appointment.paciente_nombre)}\r\n                    </AvatarFallback>\r\n                  </Avatar>\r\n                  \r\n                  <div className=\"flex-1 min-w-0\">\r\n                    <div className=\"flex items-center gap-2 mb-1\">\r\n                      <p className=\"font-medium text-gray-900 truncate\">\r\n                        {appointment.paciente_nombre}\r\n                      </p>\r\n                      <Badge \r\n                        variant=\"outline\" \r\n                        className={`text-xs ${getStatusColor(appointment.status as any)} ${\r\n                          (appointment.status === \"en_espera\" || appointment.status === \"en_consulta\") \r\n                            ? \"animate-pulse\" \r\n                            : \"\"\r\n                        }`}\r\n                      >\r\n                        {getStatusLabel(appointment.status as any)}\r\n                      </Badge>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-3 text-sm text-gray-600\">\r\n                      <span className=\"flex items-center gap-1\">\r\n                        <Clock className=\"h-3 w-3\" />\r\n                        {format(new Date(appointment.fecha_hora), \"HH:mm\", { locale: es })}\r\n                      </span>\r\n                      <span className=\"truncate\">{appointment.motivo}</span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"flex-shrink-0 ml-3\">\r\n                  {getActionButton(appointment)}\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\patients\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\professional\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\profile-setup\\hooks\\useProfileSetup.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":104,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3208,3211],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3208,3211],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\n\r\nexport interface Specialty {\r\n  id: string;\r\n  name: string;\r\n  description: string | null;\r\n  active: boolean;\r\n}\r\n\r\nexport interface VerificationResult {\r\n  success: boolean;\r\n  verified: boolean;\r\n  data?: {\r\n    cedula: string;\r\n    tipo_documento: string;\r\n    nombre_completo: string;\r\n    profesion_principal: string;\r\n    matricula_principal: string;\r\n    especialidad_display: string;\r\n    es_medico_humano: boolean;\r\n    es_veterinario: boolean;\r\n    tiene_postgrados: boolean;\r\n    profesiones: Array<{\r\n      profesion: string;\r\n      matricula: string;\r\n      especialidad?: string;\r\n    }>;\r\n    postgrados: Array<{\r\n      titulo: string;\r\n      institucion: string;\r\n      fecha: string;\r\n    }>;\r\n  };\r\n  message: string;\r\n  razon_rechazo?: string;\r\n  error?: string;\r\n}\r\n\r\nexport function useProfileSetup() {\r\n  const [step, setStep] = useState(1);\r\n  const [loading, setLoading] = useState(false);\r\n  const [userId, setUserId] = useState<string | null>(null);\r\n\r\n  const [cedula, setCedula] = useState(\"\");\r\n  const [tipoDocumento, setTipoDocumento] = useState<\"V\" | \"E\">(\"V\");\r\n  const [verificationResult, setVerificationResult] = useState<VerificationResult | null>(null);\r\n  const [verifying, setVerifying] = useState(false);\r\n\r\n  const [specialtyId, setSpecialtyId] = useState(\"\");\r\n  const [specialties, setSpecialties] = useState<Specialty[]>([]);\r\n  const [filteredSpecialties, setFilteredSpecialties] = useState<Specialty[]>([]);\r\n  const [specialtySearch, setSpecialtySearch] = useState(\"\");\r\n  const [recommendedSpecialty, setRecommendedSpecialty] = useState<Specialty | null>(null);\r\n  const [licenseNumber, setLicenseNumber] = useState(\"\");\r\n  const [yearsExperience, setYearsExperience] = useState(\"\");\r\n  const [bio, setBio] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    checkAuth();\r\n    loadSpecialties();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!specialtySearch.trim()) {\r\n      setFilteredSpecialties(specialties);\r\n      return;\r\n    }\r\n    const query = specialtySearch.toLowerCase();\r\n    const filtered = specialties.filter((specialty: Specialty) =>\r\n      specialty.name.toLowerCase().includes(query) ||\r\n      specialty.description?.toLowerCase().includes(query)\r\n    );\r\n    setFilteredSpecialties(filtered);\r\n  }, [specialtySearch, specialties]);\r\n\r\n  const checkAuth = async () => {\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    if (user) setUserId(user.id);\r\n  };\r\n\r\n  const loadSpecialties = async () => {\r\n    const { data, error } = await supabase\r\n      .from(\"specialties\")\r\n      .select(\"*\")\r\n      .eq(\"active\", true)\r\n      .order(\"name\");\r\n    if (!error && data) {\r\n      setSpecialties(data);\r\n      setFilteredSpecialties(data);\r\n    }\r\n  };\r\n\r\n  const handleVerifySACS = async () => {\r\n    if (!cedula || cedula.length < 6) return;\r\n    setVerifying(true);\r\n    setVerificationResult(null);\r\n    try {\r\n      const { data, error } = await supabase.functions.invoke(\"verify-doctor-sacs\", {\r\n        body: { cedula, tipo_documento: tipoDocumento, user_id: userId },\r\n      });\r\n      if (error) throw error as any;\r\n      setVerificationResult(data as VerificationResult);\r\n      if ((data as VerificationResult).verified && (data as VerificationResult).data) {\r\n        setLicenseNumber((data as VerificationResult).data!.matricula_principal);\r\n        const match = specialties.find(\r\n          (s: Specialty) => s.name.toUpperCase().includes((data as VerificationResult).data!.especialidad_display.toUpperCase()) ||\r\n            (data as VerificationResult).data!.especialidad_display.toUpperCase().includes(s.name.toUpperCase())\r\n        );\r\n        if (match) {\r\n          setRecommendedSpecialty(match);\r\n          setSpecialtyId(match.id);\r\n        }\r\n      }\r\n    } catch (err) {\r\n      setVerificationResult({\r\n        success: false,\r\n        verified: false,\r\n        error: err instanceof Error ? err.message : \"Error al verificar con SACS\",\r\n        message: \"No se pudo conectar con el servicio de verificación. Por favor intenta más tarde.\",\r\n      });\r\n    } finally {\r\n      setVerifying(false);\r\n    }\r\n  };\r\n\r\n  const handleCompleteSetup = async () => {\r\n    if (!verificationResult?.verified) return;\r\n    if (!specialtyId || !licenseNumber || !yearsExperience) return;\r\n    setLoading(true);\r\n    try {\r\n      const { error: profileError } = await supabase\r\n        .from(\"doctor_details\")\r\n        .insert({\r\n          profile_id: userId,\r\n          especialidad_id: specialtyId,\r\n          licencia_medica: verificationResult?.data?.matricula_principal,\r\n          anos_experiencia: parseInt(yearsExperience),\r\n          verified: true,\r\n          sacs_verified: true,\r\n          sacs_data: verificationResult?.data,\r\n        })\r\n        .select()\r\n        .single();\r\n      if (profileError) throw new Error(profileError.message || \"Error al crear perfil de médico\");\r\n\r\n      const { error: updateError } = await supabase\r\n        .from(\"profiles\")\r\n        .update({\r\n          nombre_completo: verificationResult?.data?.nombre_completo,\r\n          cedula: verificationResult?.data?.cedula,\r\n          cedula_verificada: true,\r\n          sacs_verificado: true,\r\n          sacs_nombre: verificationResult?.data?.nombre_completo,\r\n          sacs_matricula: verificationResult?.data?.matricula_principal,\r\n          sacs_especialidad: verificationResult?.data?.especialidad_display,\r\n          sacs_fecha_verificacion: new Date().toISOString(),\r\n        })\r\n        .eq(\"id\", userId);\r\n      if (updateError) throw new Error(updateError.message || \"Error al actualizar perfil\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return {\r\n    state: {\r\n      step,\r\n      loading,\r\n      userId,\r\n      cedula,\r\n      tipoDocumento,\r\n      verificationResult,\r\n      verifying,\r\n      specialtyId,\r\n      specialties,\r\n      filteredSpecialties,\r\n      specialtySearch,\r\n      recommendedSpecialty,\r\n      licenseNumber,\r\n      yearsExperience,\r\n      bio,\r\n    },\r\n    actions: {\r\n      setStep,\r\n      setCedula,\r\n      setTipoDocumento,\r\n      setSpecialtyId,\r\n      setSpecialtySearch,\r\n      setYearsExperience,\r\n      setBio,\r\n      handleVerifySACS,\r\n      handleCompleteSetup,\r\n    },\r\n  };\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\profile-setup\\profile-form.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[488,491],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[488,491],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[519,522],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[519,522],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":19,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[603,606],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[603,606],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'specialties' is defined but never used.","line":31,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":14},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":105,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4442,4445],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4442,4445],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { Label } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Stethoscope, CheckCircle, Loader2, Search, ArrowLeft } from \"lucide-react\";\r\n\r\ninterface Props {\r\n  verificationData?: {\r\n    nombre_completo?: string;\r\n    matricula_principal?: string;\r\n  };\r\n  specialties: any[];\r\n  filteredSpecialties: any[];\r\n  specialtyId: string;\r\n  specialtySearch: string;\r\n  recommendedSpecialty: any;\r\n  yearsExperience: string;\r\n  loading: boolean;\r\n  onBack: () => void;\r\n  onComplete: () => void;\r\n  onSelectSpecialtyId: (id: string) => void;\r\n  onSetSpecialtySearch: (v: string) => void;\r\n  onSetYearsExperience: (v: string) => void;\r\n}\r\n\r\nexport function ProfileForm({\r\n  verificationData,\r\n  specialties,\r\n  filteredSpecialties,\r\n  specialtyId,\r\n  specialtySearch,\r\n  recommendedSpecialty,\r\n  yearsExperience,\r\n  loading,\r\n  onBack,\r\n  onComplete,\r\n  onSelectSpecialtyId,\r\n  onSetSpecialtySearch,\r\n  onSetYearsExperience,\r\n}: Props) {\r\n  return (\r\n    <Card>\r\n      <CardHeader>\r\n        <div className=\"flex items-center gap-3 mb-2\">\r\n          <div className=\"h-12 w-12 bg-purple-100 rounded-full flex items-center justify-center\">\r\n            <Stethoscope className=\"h-6 w-6 text-purple-600\" />\r\n          </div>\r\n          <div>\r\n            <CardTitle>Información Profesional</CardTitle>\r\n            <CardDescription>Completa tu perfil médico para comenzar a usar Red-Salud</CardDescription>\r\n          </div>\r\n        </div>\r\n      </CardHeader>\r\n      <CardContent className=\"space-y-6\">\r\n        <div className=\"bg-blue-50 rounded-lg p-4 space-y-3\">\r\n          <h3 className=\"font-semibold text-blue-900 text-sm\">Datos Verificados del SACS</h3>\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm\">\r\n            <div>\r\n              <span className=\"text-gray-600\">Nombre Completo:</span>\r\n              <p className=\"font-medium text-gray-900\">{verificationData?.nombre_completo}</p>\r\n            </div>\r\n            <div>\r\n              <span className=\"text-gray-600\">Matrícula:</span>\r\n              <p className=\"font-medium text-gray-900\">{verificationData?.matricula_principal}</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"space-y-4\">\r\n          {recommendedSpecialty && !specialtySearch && (\r\n            <div>\r\n              <Label>Especialidad Recomendada (según SACS)</Label>\r\n              <Card className=\"mt-2 cursor-pointer hover:shadow-md transition-shadow border-2 border-green-500 bg-green-50\" onClick={() => {\r\n                onSelectSpecialtyId(recommendedSpecialty.id);\r\n                onSetSpecialtySearch(recommendedSpecialty.name);\r\n              }}>\r\n                <CardContent className=\"p-4\">\r\n                  <div className=\"flex items-start gap-3\">\r\n                    <div className=\"h-10 w-10 bg-green-100 rounded-full flex items-center justify-center shrink-0\">\r\n                      <CheckCircle className=\"h-5 w-5 text-green-600\" />\r\n                    </div>\r\n                    <div className=\"flex-1\">\r\n                      <h3 className=\"font-semibold text-green-900\">{recommendedSpecialty.name}</h3>\r\n                      <p className=\"text-sm text-green-700 mt-1\">{recommendedSpecialty.description}</p>\r\n                      <Badge className=\"mt-2 bg-green-600\">Recomendada según tu registro SACS</Badge>\r\n                    </div>\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n            </div>\r\n          )}\r\n\r\n          <div>\r\n            <Label htmlFor=\"specialty-search\">{recommendedSpecialty && !specialtySearch ? \"O busca otra especialidad\" : \"Especialidad *\"}</Label>\r\n            <div className=\"relative\">\r\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400\" />\r\n              <Input id=\"specialty-search\" placeholder=\"Buscar especialidad...\" value={specialtySearch} onChange={(e) => onSetSpecialtySearch(e.target.value)} className=\"pl-10\" />\r\n            </div>\r\n            {specialtySearch && (\r\n              <div className=\"mt-3 space-y-2\">\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3\">\r\n                  {filteredSpecialties.slice(0, 8).map((specialty: any) => (\r\n                    <Card key={specialty.id} className={`cursor-pointer hover:shadow-md transition-all ${specialtyId === specialty.id ? \"border-2 border-blue-500 bg-blue-50\" : \"hover:border-blue-300\"}`} onClick={() => {\r\n                      onSelectSpecialtyId(specialty.id);\r\n                      onSetSpecialtySearch(specialty.name);\r\n                    }}>\r\n                      <CardContent className=\"p-4\">\r\n                        <h3 className=\"font-semibold text-sm mb-1\">{specialty.name}</h3>\r\n                        {specialty.description && (<p className=\"text-xs text-gray-600 line-clamp-2\">{specialty.description}</p>)}\r\n                        {specialtyId === specialty.id && (<Badge className=\"mt-2 bg-blue-600\">Seleccionada</Badge>)}\r\n                      </CardContent>\r\n                    </Card>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          <div>\r\n            <Label htmlFor=\"experience\">Años de Experiencia *</Label>\r\n            <Input id=\"experience\" type=\"number\" min=\"0\" max=\"60\" value={yearsExperience} onChange={(e) => onSetYearsExperience(e.target.value)} placeholder=\"5\" />\r\n            <p className=\"text-xs text-gray-500 mt-1\">Años de experiencia profesional en el área de la salud</p>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"bg-gray-50 rounded-lg p-4\">\r\n          <p className=\"text-sm text-gray-600\"><strong>Nota:</strong> Podrás agregar más información como ubicación, horarios, tarifas y biografía desde tu perfil después de completar el registro.</p>\r\n        </div>\r\n\r\n        <div className=\"flex gap-3\">\r\n          <Button variant=\"outline\" onClick={onBack} className=\"flex-1\">\r\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />Atrás\r\n          </Button>\r\n          <Button onClick={onComplete} disabled={loading} className=\"flex-1\" size=\"lg\">\r\n            {loading ? (<><Loader2 className=\"h-5 w-5 mr-2 animate-spin\" />Guardando...</>) : (<><CheckCircle className=\"h-5 w-5 mr-2\" />Completar Registro</>)}\r\n          </Button>\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\profile-setup\\verification-section.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\shared\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\shared\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\templates\\custom-template-creator.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setTemplateSpecialty' is assigned a value but never used.","line":47,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":47,"endColumn":49},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":103,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2956,2959],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2956,2959],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":228,"column":99,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":228,"endColumn":102,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8175,8178],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8175,8178],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useRef } from \"react\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { Label } from \"@red-salud/ui\";\r\nimport { Textarea } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { ScrollArea } from \"@red-salud/ui\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from \"@red-salud/ui\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@red-salud/ui\";\r\nimport { \r\n  Plus, \r\n  X, \r\n  GripVertical, \r\n  Save, \r\n  Trash2\r\n} from \"lucide-react\";\r\nimport { StructuredTemplate, StructuredTemplateField } from \"@/lib/templates/structured-templates\";\r\n\r\ninterface CustomTemplateCreatorProps {\r\n  open: boolean;\r\n  onClose: () => void;\r\n  onSave: (template: StructuredTemplate) => void;\r\n}\r\n\r\nexport function CustomTemplateCreator({\r\n  open,\r\n  onClose,\r\n  onSave,\r\n}: CustomTemplateCreatorProps) {\r\n  const [templateName, setTemplateName] = useState(\"\");\r\n  const [templateDescription, setTemplateDescription] = useState(\"\");\r\n  const [templateCategory, setTemplateCategory] = useState(\"custom\");\r\n  const [templateSpecialty, setTemplateSpecialty] = useState(\"\");\r\n  const [templateTags, setTemplateTags] = useState(\"\");\r\n  const [fields, setFields] = useState<StructuredTemplateField[]>([]);\r\n  const [currentField, setCurrentField] = useState({\r\n    label: \"\",\r\n    type: \"textarea\" as const,\r\n    placeholder: \"\",\r\n    required: false,\r\n    rows: 3,\r\n  });\r\n  const fieldCounterRef = useRef(0);\r\n  const templateCounterRef = useRef(0);\r\n\r\n  const addField = () => {\r\n    if (!currentField.label) return;\r\n\r\n    const newField: StructuredTemplateField = {\r\n      id: `field_${++fieldCounterRef.current}`,\r\n      label: currentField.label,\r\n      type: currentField.type,\r\n      placeholder: currentField.placeholder,\r\n      required: currentField.required || false,\r\n      rows: currentField.rows || 3,\r\n    };\r\n\r\n    setFields([...fields, newField]);\r\n    setCurrentField({\r\n      label: \"\",\r\n      type: \"textarea\",\r\n      placeholder: \"\",\r\n      required: false,\r\n      rows: 3,\r\n    });\r\n  };\r\n\r\n  const removeField = (index: number) => {\r\n    setFields(fields.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const moveField = (index: number, direction: 'up' | 'down') => {\r\n    const newFields = [...fields];\r\n    const targetIndex = direction === 'up' ? index - 1 : index + 1;\r\n    \r\n    if (targetIndex < 0 || targetIndex >= fields.length) return;\r\n    \r\n    [newFields[index], newFields[targetIndex]] = [newFields[targetIndex], newFields[index]];\r\n    setFields(newFields);\r\n  };\r\n\r\n  const handleSave = () => {\r\n    if (!templateName || fields.length === 0) return;\r\n\r\n    const template: StructuredTemplate = {\r\n      id: `custom_${++templateCounterRef.current}`,\r\n      name: templateName,\r\n      description: templateDescription,\r\n      category: templateCategory as any,\r\n      icon: 'FileText',\r\n      color: 'blue',\r\n      author: 'custom',\r\n      tags: templateTags.split(',').map(t => t.trim()).filter(Boolean),\r\n      specialty: templateSpecialty || undefined,\r\n      fields,\r\n      isCustom: true,\r\n      createdAt: new Date().toISOString(),\r\n    };\r\n\r\n    onSave(template);\r\n    handleReset();\r\n    onClose();\r\n  };\r\n\r\n  const handleReset = () => {\r\n    setTemplateName(\"\");\r\n    setTemplateDescription(\"\");\r\n    setTemplateCategory(\"custom\");\r\n    setTemplateTags(\"\");\r\n    setFields([]);\r\n    setCurrentField({\r\n      label: \"\",\r\n      type: \"textarea\",\r\n      placeholder: \"\",\r\n      required: false,\r\n      rows: 3,\r\n    });\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={onClose}>\r\n      <DialogContent className=\"max-w-6xl h-[90vh] p-0 gap-0\">\r\n        <DialogHeader className=\"px-6 py-4 border-b\">\r\n          <DialogTitle className=\"text-xl flex items-center gap-2\">\r\n            <div className=\"h-10 w-10 rounded-lg bg-gradient-to-br from-green-500 to-emerald-600 flex items-center justify-center\">\r\n              <Plus className=\"h-5 w-5 text-white\" />\r\n            </div>\r\n            Crear Template Personalizado\r\n          </DialogTitle>\r\n          <DialogDescription>\r\n            Diseña tu propio template con los campos que necesites\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n\r\n        <div className=\"flex-1 flex overflow-hidden\">\r\n          {/* Left Panel - Template Info & Field Creator */}\r\n          <div className=\"w-1/2 border-r flex flex-col\">\r\n            <ScrollArea className=\"flex-1 p-6\">\r\n              <div className=\"space-y-6\">\r\n                {/* Template Info */}\r\n                <div className=\"space-y-4\">\r\n                  <h3 className=\"font-semibold text-sm\">Información del Template</h3>\r\n                  \r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"templateName\">Nombre del Template *</Label>\r\n                    <Input\r\n                      id=\"templateName\"\r\n                      value={templateName}\r\n                      onChange={(e) => setTemplateName(e.target.value)}\r\n                      placeholder=\"Ej: Consulta de Medicina Familiar\"\r\n                      className=\"w-full\"\r\n                    />\r\n                  </div>\r\n\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"templateDescription\">Descripción</Label>\r\n                    <Textarea\r\n                      id=\"templateDescription\"\r\n                      value={templateDescription}\r\n                      onChange={(e) => setTemplateDescription(e.target.value)}\r\n                      placeholder=\"Describe para qué sirve este template...\"\r\n                      rows={2}\r\n                      className=\"w-full\"\r\n                    />\r\n                  </div>\r\n\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"templateCategory\">Categoría</Label>\r\n                    <Select value={templateCategory} onValueChange={setTemplateCategory}>\r\n                      <SelectTrigger className=\"w-full\">\r\n                        <SelectValue />\r\n                      </SelectTrigger>\r\n                      <SelectContent>\r\n                        <SelectItem value=\"custom\">Personalizado</SelectItem>\r\n                        <SelectItem value=\"general\">General</SelectItem>\r\n                        <SelectItem value=\"especialidad\">Especialidad</SelectItem>\r\n                        <SelectItem value=\"control\">Control</SelectItem>\r\n                        <SelectItem value=\"emergencia\">Emergencia</SelectItem>\r\n                      </SelectContent>\r\n                    </Select>\r\n                  </div>\r\n\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"templateTags\">Etiquetas (separadas por comas)</Label>\r\n                    <Input\r\n                      id=\"templateTags\"\r\n                      value={templateTags}\r\n                      onChange={(e) => setTemplateTags(e.target.value)}\r\n                      placeholder=\"Ej: medicina-familiar, consulta-rapida\"\r\n                      className=\"w-full\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Field Creator */}\r\n                <div className=\"space-y-4 pt-6 border-t\">\r\n                  <h3 className=\"font-semibold text-sm\">Agregar Campo</h3>\r\n                  \r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"fieldLabel\">Nombre del Campo *</Label>\r\n                    <Input\r\n                      id=\"fieldLabel\"\r\n                      value={currentField.label}\r\n                      onChange={(e) => setCurrentField({ ...currentField, label: e.target.value })}\r\n                      placeholder=\"Ej: MOTIVO DE CONSULTA\"\r\n                      className=\"w-full\"\r\n                    />\r\n                  </div>\r\n\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"fieldType\">Tipo de Campo</Label>\r\n                    <Select \r\n                      value={currentField.type} \r\n                      onValueChange={(value) => setCurrentField({ ...currentField, type: value as any })}\r\n                    >\r\n                      <SelectTrigger className=\"w-full\">\r\n                        <SelectValue />\r\n                      </SelectTrigger>\r\n                      <SelectContent>\r\n                        <SelectItem value=\"textarea\">Área de Texto</SelectItem>\r\n                        <SelectItem value=\"input\">Texto Corto</SelectItem>\r\n                        <SelectItem value=\"vitals\">Signos Vitales</SelectItem>\r\n                        <SelectItem value=\"medications\">Medicamentos</SelectItem>\r\n                      </SelectContent>\r\n                    </Select>\r\n                  </div>\r\n\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"fieldPlaceholder\">Placeholder (opcional)</Label>\r\n                    <Input\r\n                      id=\"fieldPlaceholder\"\r\n                      value={currentField.placeholder}\r\n                      onChange={(e) => setCurrentField({ ...currentField, placeholder: e.target.value })}\r\n                      placeholder=\"Texto de ayuda para el campo...\"\r\n                      className=\"w-full\"\r\n                    />\r\n                  </div>\r\n\r\n                  {currentField.type === 'textarea' && (\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"fieldRows\">Filas</Label>\r\n                      <Input\r\n                        id=\"fieldRows\"\r\n                        type=\"number\"\r\n                        min=\"1\"\r\n                        max=\"10\"\r\n                        value={currentField.rows}\r\n                        onChange={(e) => setCurrentField({ ...currentField, rows: parseInt(e.target.value) })}\r\n                        className=\"w-full\"\r\n                      />\r\n                    </div>\r\n                  )}\r\n\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <input\r\n                      type=\"checkbox\"\r\n                      id=\"fieldRequired\"\r\n                      checked={currentField.required}\r\n                      onChange={(e) => setCurrentField({ ...currentField, required: e.target.checked })}\r\n                      className=\"rounded\"\r\n                    />\r\n                    <Label htmlFor=\"fieldRequired\" className=\"cursor-pointer\">\r\n                      Campo requerido\r\n                    </Label>\r\n                  </div>\r\n\r\n                  <Button onClick={addField} className=\"w-full\" disabled={!currentField.label}>\r\n                    <Plus className=\"h-4 w-4 mr-2\" />\r\n                    Agregar Campo\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n            </ScrollArea>\r\n          </div>\r\n\r\n          {/* Right Panel - Preview */}\r\n          <div className=\"w-1/2 flex flex-col\">\r\n            <div className=\"px-6 py-4 border-b bg-gray-50\">\r\n              <h3 className=\"font-semibold text-sm\">Vista Previa ({fields.length} campos)</h3>\r\n            </div>\r\n            \r\n            <ScrollArea className=\"flex-1 p-6\">\r\n              {fields.length === 0 ? (\r\n                <div className=\"text-center py-12 text-gray-500\">\r\n                  <p className=\"text-sm\">Agrega campos para ver la vista previa</p>\r\n                </div>\r\n              ) : (\r\n                <div className=\"space-y-3\">\r\n                  {fields.map((field, index) => (\r\n                    <div\r\n                      key={index}\r\n                      className=\"group border rounded-lg p-3 bg-white hover:shadow-md transition-all\"\r\n                    >\r\n                      <div className=\"flex items-start gap-2\">\r\n                        <div className=\"flex flex-col gap-1 mt-1\">\r\n                          <button\r\n                            onClick={() => moveField(index, 'up')}\r\n                            disabled={index === 0}\r\n                            className=\"p-1 hover:bg-gray-100 rounded disabled:opacity-30\"\r\n                          >\r\n                            <GripVertical className=\"h-3 w-3\" />\r\n                          </button>\r\n                          <button\r\n                            onClick={() => moveField(index, 'down')}\r\n                            disabled={index === fields.length - 1}\r\n                            className=\"p-1 hover:bg-gray-100 rounded disabled:opacity-30\"\r\n                          >\r\n                            <GripVertical className=\"h-3 w-3\" />\r\n                          </button>\r\n                        </div>\r\n                        \r\n                        <div className=\"flex-1 min-w-0\">\r\n                          <div className=\"flex items-center gap-2 mb-1\">\r\n                            <p className=\"font-semibold text-sm\">{field.label}</p>\r\n                            {field.required && (\r\n                              <Badge variant=\"destructive\" className=\"text-xs h-5\">\r\n                                Requerido\r\n                              </Badge>\r\n                            )}\r\n                            <Badge variant=\"outline\" className=\"text-xs h-5\">\r\n                              {field.type === 'textarea' ? 'Área de texto' :\r\n                               field.type === 'input' ? 'Texto corto' :\r\n                               field.type === 'vitals' ? 'Signos vitales' :\r\n                               'Medicamentos'}\r\n                            </Badge>\r\n                          </div>\r\n                          {field.placeholder && (\r\n                            <p className=\"text-xs text-gray-500 italic\">{field.placeholder}</p>\r\n                          )}\r\n                        </div>\r\n\r\n                        <Button\r\n                          size=\"sm\"\r\n                          variant=\"ghost\"\r\n                          onClick={() => removeField(index)}\r\n                          className=\"opacity-0 group-hover:opacity-100 transition-opacity\"\r\n                        >\r\n                          <Trash2 className=\"h-4 w-4 text-red-500\" />\r\n                        </Button>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </ScrollArea>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Footer */}\r\n        <div className=\"px-6 py-4 border-t bg-gray-50 flex items-center justify-between\">\r\n          <div className=\"text-sm text-gray-600\">\r\n            {fields.length} campo{fields.length !== 1 ? 's' : ''} agregado{fields.length !== 1 ? 's' : ''}\r\n          </div>\r\n          <div className=\"flex gap-2\">\r\n            <Button variant=\"outline\" onClick={handleReset}>\r\n              <X className=\"h-4 w-4 mr-2\" />\r\n              Limpiar\r\n            </Button>\r\n            <Button \r\n              onClick={handleSave}\r\n              disabled={!templateName || fields.length === 0}\r\n              className=\"bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700\"\r\n            >\r\n              <Save className=\"h-4 w-4 mr-2\" />\r\n              Guardar Template\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\templates\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\templates\\structured-template-editor.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'paciente' is defined but never used.","line":33,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":11},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":52,"column":39,"nodeType":"Identifier","endLine":52,"endColumn":47},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useRef\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":86,"column":21,"nodeType":"Identifier","endLine":86,"endColumn":27},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":88,"column":3,"nodeType":"Identifier","endLine":88,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_' is defined but never used.","line":360,"column":55,"nodeType":null,"messageId":"unusedVar","endLine":360,"endColumn":56}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect, useRef } from \"react\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { Label } from \"@red-salud/ui\";\r\nimport { Textarea } from \"@red-salud/ui\";\r\nimport { AlertCircle, CheckCircle, AlertTriangle } from \"lucide-react\";\r\nimport { StructuredTemplate } from \"@/lib/templates/structured-templates\";\r\nimport { getAllTemplates } from \"@/lib/templates/extended-templates\";\r\nimport { MedicationInput } from \"../inputs/medication-input\";\r\n\r\ninterface VitalSign {\r\n  value: string;\r\n  unit: string;\r\n  normalRange: { min: number; max: number };\r\n  label: string;\r\n}\r\n\r\ninterface StructuredTemplateEditorProps {\r\n  template: StructuredTemplate | null;\r\n  onChange: (content: string) => void;\r\n  paciente: {\r\n    edad: number | null;\r\n    genero: string;\r\n  };\r\n  medications: string[];\r\n  onMedicationsChange: (medications: string[]) => void;\r\n}\r\n\r\nexport function StructuredTemplateEditor({\r\n  template,\r\n  onChange,\r\n  paciente,\r\n  medications,\r\n  onMedicationsChange,\r\n}: StructuredTemplateEditorProps) {\r\n  // Usar template por defecto si no hay uno seleccionado\r\n  const allTemplates = getAllTemplates();\r\n  const activeTemplate = template || allTemplates[0];\r\n  \r\n  const [fields, setFields] = useState<Record<string, string>>({});\r\n\r\n  // Si no hay template disponible, mostrar mensaje\r\n  if (!activeTemplate) {\r\n    return (\r\n      <div className=\"p-6 text-center\">\r\n        <p className=\"text-gray-500\">No hay templates disponibles. Por favor, selecciona un template.</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const [vitalSigns, setVitalSigns] = useState<Record<string, VitalSign>>({\r\n    pa: {\r\n      value: \"\",\r\n      unit: \"mmHg\",\r\n      normalRange: { min: 90, max: 140 },\r\n      label: \"PA\",\r\n    },\r\n    fc: {\r\n      value: \"\",\r\n      unit: \"lpm\",\r\n      normalRange: { min: 60, max: 100 },\r\n      label: \"FC\",\r\n    },\r\n    fr: {\r\n      value: \"\",\r\n      unit: \"rpm\",\r\n      normalRange: { min: 12, max: 20 },\r\n      label: \"FR\",\r\n    },\r\n    temp: {\r\n      value: \"\",\r\n      unit: \"°C\",\r\n      normalRange: { min: 36, max: 37.5 },\r\n      label: \"Temp\",\r\n    },\r\n    satO2: {\r\n      value: \"\",\r\n      unit: \"%\",\r\n      normalRange: { min: 95, max: 100 },\r\n      label: \"Sat O2\",\r\n    },\r\n  });\r\n\r\n  // Generar contenido del template dinámicamente\r\n  const isMounted = useRef(false);\r\n\r\n  useEffect(() => {\r\n    if (!isMounted.current) {\r\n      isMounted.current = true;\r\n      return;\r\n    }\r\n\r\n    let content = \"\";\r\n    \r\n    activeTemplate.fields.forEach((field) => {\r\n      if (field.type === 'vitals') {\r\n        content += `\\n${field.label}:\\n`;\r\n        content += `- PA: ${vitalSigns.pa.value || \"___\"} mmHg\\n`;\r\n        content += `- FC: ${vitalSigns.fc.value || \"___\"} lpm\\n`;\r\n        content += `- FR: ${vitalSigns.fr.value || \"___\"} rpm\\n`;\r\n        content += `- Temp: ${vitalSigns.temp.value || \"___\"} °C\\n`;\r\n        content += `- Sat O2: ${vitalSigns.satO2.value || \"___\"} %\\n`;\r\n        if (fields.peso) content += `- Peso: ${fields.peso} kg\\n`;\r\n        if (fields.talla) content += `- Talla: ${fields.talla} cm\\n`;\r\n      } else if (field.type === 'medications') {\r\n        content += `\\n${field.label}:\\n`;\r\n        if (medications.length > 0) {\r\n          medications.forEach((med, i) => {\r\n            content += `${i + 1}. ${med}\\n`;\r\n          });\r\n        } else {\r\n          content += \"[Sin medicamentos]\\n\";\r\n        }\r\n      } else {\r\n        const value = fields[field.id] || \"[Pendiente]\";\r\n        content += `\\n${field.label}:\\n${value}\\n`;\r\n      }\r\n    });\r\n\r\n    onChange(content.trim());\r\n  }, [fields, vitalSigns, medications, activeTemplate, onChange]);\r\n\r\n  const handleFieldChange = (field: string, value: string) => {\r\n    setFields((prev) => ({ ...prev, [field]: value }));\r\n  };\r\n\r\n  const handleVitalSignChange = (key: string, value: string) => {\r\n    // Solo permitir números y punto decimal\r\n    const numericValue = value.replace(/[^0-9./]/g, \"\");\r\n    \r\n    setVitalSigns((prev) => ({\r\n      ...prev,\r\n      [key]: { ...prev[key], value: numericValue },\r\n    }));\r\n  };\r\n\r\n  const getVitalSignStatus = (key: string): \"normal\" | \"warning\" | \"danger\" | null => {\r\n    const vital = vitalSigns[key];\r\n    if (!vital.value) return null;\r\n\r\n    let numValue: number;\r\n    \r\n    // Para PA, tomar el valor sistólico (primer número)\r\n    if (key === \"pa\") {\r\n      const systolic = parseInt(vital.value.split(\"/\")[0]);\r\n      if (isNaN(systolic)) return null;\r\n      numValue = systolic;\r\n    } else {\r\n      numValue = parseFloat(vital.value);\r\n      if (isNaN(numValue)) return null;\r\n    }\r\n\r\n    if (numValue < vital.normalRange.min || numValue > vital.normalRange.max) {\r\n      // Valores muy fuera de rango\r\n      if (numValue < vital.normalRange.min * 0.8 || numValue > vital.normalRange.max * 1.2) {\r\n        return \"danger\";\r\n      }\r\n      return \"warning\";\r\n    }\r\n\r\n    return \"normal\";\r\n  };\r\n\r\n  const getStatusIcon = (status: \"normal\" | \"warning\" | \"danger\" | null) => {\r\n    if (!status) return null;\r\n    \r\n    switch (status) {\r\n      case \"normal\":\r\n        return <CheckCircle className=\"h-4 w-4 text-green-600\" />;\r\n      case \"warning\":\r\n        return <AlertTriangle className=\"h-4 w-4 text-yellow-600\" />;\r\n      case \"danger\":\r\n        return <AlertCircle className=\"h-4 w-4 text-red-600\" />;\r\n    }\r\n  };\r\n\r\n  const getStatusColor = (status: \"normal\" | \"warning\" | \"danger\" | null) => {\r\n    if (!status) return \"border-gray-300\";\r\n    \r\n    switch (status) {\r\n      case \"normal\":\r\n        return \"border-green-500 bg-green-50\";\r\n      case \"warning\":\r\n        return \"border-yellow-500 bg-yellow-50\";\r\n      case \"danger\":\r\n        return \"border-red-500 bg-red-50\";\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6 p-6\">\r\n      {/* Template Info */}\r\n      <div className=\"pb-4 border-b\">\r\n        <h2 className=\"text-lg font-semibold text-gray-900\">{activeTemplate.name}</h2>\r\n        <p className=\"text-sm text-gray-600\">{activeTemplate.description}</p>\r\n      </div>\r\n\r\n      {/* Render fields dynamically */}\r\n      {activeTemplate.fields.map((field) => {\r\n        if (field.type === 'vitals') {\r\n          return (\r\n            <div key={field.id} className=\"space-y-4\">\r\n              <Label className=\"text-sm font-semibold text-gray-700 uppercase tracking-wide\">\r\n                {field.label}\r\n                {field.required && <span className=\"text-red-500 ml-1\">*</span>}\r\n              </Label>\r\n              \r\n              <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4\">\r\n                {/* PA */}\r\n                <div className=\"space-y-1\">\r\n                  <Label className=\"text-xs text-gray-600\">Presión Arterial</Label>\r\n                  <div className=\"relative\">\r\n                    <Input\r\n                      value={vitalSigns.pa.value}\r\n                      onChange={(e) => handleVitalSignChange(\"pa\", e.target.value)}\r\n                      placeholder=\"120/80\"\r\n                      className={`pr-16 ${getStatusColor(getVitalSignStatus(\"pa\"))}`}\r\n                    />\r\n                    <div className=\"absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-1\">\r\n                      {getStatusIcon(getVitalSignStatus(\"pa\"))}\r\n                      <span className=\"text-xs text-gray-500\">mmHg</span>\r\n                    </div>\r\n                  </div>\r\n                  {getVitalSignStatus(\"pa\") && (\r\n                    <p className=\"text-xs text-gray-500\">\r\n                      Normal: {vitalSigns.pa.normalRange.min}-{vitalSigns.pa.normalRange.max} mmHg\r\n                    </p>\r\n                  )}\r\n                </div>\r\n\r\n                {/* FC */}\r\n                <div className=\"space-y-1\">\r\n                  <Label className=\"text-xs text-gray-600\">Frecuencia Cardíaca</Label>\r\n                  <div className=\"relative\">\r\n                    <Input\r\n                      value={vitalSigns.fc.value}\r\n                      onChange={(e) => handleVitalSignChange(\"fc\", e.target.value)}\r\n                      placeholder=\"72\"\r\n                      type=\"number\"\r\n                      className={`pr-16 ${getStatusColor(getVitalSignStatus(\"fc\"))}`}\r\n                    />\r\n                    <div className=\"absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-1\">\r\n                      {getStatusIcon(getVitalSignStatus(\"fc\"))}\r\n                      <span className=\"text-xs text-gray-500\">lpm</span>\r\n                    </div>\r\n                  </div>\r\n                  {getVitalSignStatus(\"fc\") && (\r\n                    <p className=\"text-xs text-gray-500\">\r\n                      Normal: {vitalSigns.fc.normalRange.min}-{vitalSigns.fc.normalRange.max} lpm\r\n                    </p>\r\n                  )}\r\n                </div>\r\n\r\n                {/* FR */}\r\n                <div className=\"space-y-1\">\r\n                  <Label className=\"text-xs text-gray-600\">Frecuencia Respiratoria</Label>\r\n                  <div className=\"relative\">\r\n                    <Input\r\n                      value={vitalSigns.fr.value}\r\n                      onChange={(e) => handleVitalSignChange(\"fr\", e.target.value)}\r\n                      placeholder=\"16\"\r\n                      type=\"number\"\r\n                      className={`pr-16 ${getStatusColor(getVitalSignStatus(\"fr\"))}`}\r\n                    />\r\n                    <div className=\"absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-1\">\r\n                      {getStatusIcon(getVitalSignStatus(\"fr\"))}\r\n                      <span className=\"text-xs text-gray-500\">rpm</span>\r\n                    </div>\r\n                  </div>\r\n                  {getVitalSignStatus(\"fr\") && (\r\n                    <p className=\"text-xs text-gray-500\">\r\n                      Normal: {vitalSigns.fr.normalRange.min}-{vitalSigns.fr.normalRange.max} rpm\r\n                    </p>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Temperatura */}\r\n                <div className=\"space-y-1\">\r\n                  <Label className=\"text-xs text-gray-600\">Temperatura</Label>\r\n                  <div className=\"relative\">\r\n                    <Input\r\n                      value={vitalSigns.temp.value}\r\n                      onChange={(e) => handleVitalSignChange(\"temp\", e.target.value)}\r\n                      placeholder=\"36.5\"\r\n                      type=\"number\"\r\n                      step=\"0.1\"\r\n                      className={`pr-16 ${getStatusColor(getVitalSignStatus(\"temp\"))}`}\r\n                    />\r\n                    <div className=\"absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-1\">\r\n                      {getStatusIcon(getVitalSignStatus(\"temp\"))}\r\n                      <span className=\"text-xs text-gray-500\">°C</span>\r\n                    </div>\r\n                  </div>\r\n                  {getVitalSignStatus(\"temp\") && (\r\n                    <p className=\"text-xs text-gray-500\">\r\n                      Normal: {vitalSigns.temp.normalRange.min}-{vitalSigns.temp.normalRange.max} °C\r\n                    </p>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Saturación O2 */}\r\n                <div className=\"space-y-1\">\r\n                  <Label className=\"text-xs text-gray-600\">Saturación O2</Label>\r\n                  <div className=\"relative\">\r\n                    <Input\r\n                      value={vitalSigns.satO2.value}\r\n                      onChange={(e) => handleVitalSignChange(\"satO2\", e.target.value)}\r\n                      placeholder=\"98\"\r\n                      type=\"number\"\r\n                      className={`pr-16 ${getStatusColor(getVitalSignStatus(\"satO2\"))}`}\r\n                    />\r\n                    <div className=\"absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-1\">\r\n                      {getStatusIcon(getVitalSignStatus(\"satO2\"))}\r\n                      <span className=\"text-xs text-gray-500\">%</span>\r\n                    </div>\r\n                  </div>\r\n                  {getVitalSignStatus(\"satO2\") && (\r\n                    <p className=\"text-xs text-gray-500\">\r\n                      Normal: {vitalSigns.satO2.normalRange.min}-{vitalSigns.satO2.normalRange.max} %\r\n                    </p>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Peso y Talla (opcionales) */}\r\n                <div className=\"space-y-1\">\r\n                  <Label className=\"text-xs text-gray-600\">Peso (opcional)</Label>\r\n                  <div className=\"relative\">\r\n                    <Input\r\n                      value={fields.peso || \"\"}\r\n                      onChange={(e) => handleFieldChange(\"peso\", e.target.value.replace(/[^0-9.]/g, \"\"))}\r\n                      placeholder=\"70\"\r\n                      type=\"number\"\r\n                      className=\"pr-12\"\r\n                    />\r\n                    <span className=\"absolute right-3 top-1/2 -translate-y-1/2 text-xs text-gray-500\">\r\n                      kg\r\n                    </span>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"space-y-1\">\r\n                  <Label className=\"text-xs text-gray-600\">Talla (opcional)</Label>\r\n                  <div className=\"relative\">\r\n                    <Input\r\n                      value={fields.talla || \"\"}\r\n                      onChange={(e) => handleFieldChange(\"talla\", e.target.value.replace(/[^0-9.]/g, \"\"))}\r\n                      placeholder=\"170\"\r\n                      type=\"number\"\r\n                      className=\"pr-12\"\r\n                    />\r\n                    <span className=\"absolute right-3 top-1/2 -translate-y-1/2 text-xs text-gray-500\">\r\n                      cm\r\n                    </span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Alertas de signos vitales */}\r\n              {Object.entries(vitalSigns).some(([key, _]) => getVitalSignStatus(key) === \"danger\") && (\r\n                <div className=\"p-3 bg-red-50 border border-red-200 rounded-lg flex items-start gap-2\">\r\n                  <AlertCircle className=\"h-5 w-5 text-red-600 flex-shrink-0 mt-0.5\" />\r\n                  <div>\r\n                    <p className=\"text-sm font-semibold text-red-900\">Signos vitales fuera de rango</p>\r\n                    <p className=\"text-xs text-red-700 mt-1\">\r\n                      Algunos signos vitales están significativamente fuera del rango normal. Considere evaluación inmediata.\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n          );\r\n        }\r\n\r\n        if (field.type === 'medications') {\r\n          return (\r\n            <div key={field.id} className=\"space-y-2\">\r\n              <Label className=\"text-sm font-semibold text-gray-700 uppercase tracking-wide\">\r\n                {field.label}\r\n                {field.required && <span className=\"text-red-500 ml-1\">*</span>}\r\n              </Label>\r\n              <MedicationInput\r\n                medications={medications}\r\n                onChange={onMedicationsChange}\r\n              />\r\n            </div>\r\n          );\r\n        }\r\n\r\n        if (field.type === 'textarea') {\r\n          return (\r\n            <div key={field.id} className=\"space-y-2\">\r\n              <Label className=\"text-sm font-semibold text-gray-700 uppercase tracking-wide\">\r\n                {field.label}\r\n                {field.required && <span className=\"text-red-500 ml-1\">*</span>}\r\n              </Label>\r\n              <Textarea\r\n                value={fields[field.id] || \"\"}\r\n                onChange={(e) => handleFieldChange(field.id, e.target.value)}\r\n                placeholder={field.placeholder}\r\n                className=\"resize-none border-0 border-b-2 border-gray-200 rounded-none focus:border-blue-500 focus:ring-0 bg-transparent\"\r\n                rows={field.rows || 3}\r\n              />\r\n            </div>\r\n          );\r\n        }\r\n\r\n        if (field.type === 'input') {\r\n          return (\r\n            <div key={field.id} className=\"space-y-2\">\r\n              <Label className=\"text-sm font-semibold text-gray-700 uppercase tracking-wide\">\r\n                {field.label}\r\n                {field.required && <span className=\"text-red-500 ml-1\">*</span>}\r\n              </Label>\r\n              <Input\r\n                value={fields[field.id] || \"\"}\r\n                onChange={(e) => handleFieldChange(field.id, e.target.value)}\r\n                placeholder={field.placeholder}\r\n                className=\"border-0 border-b-2 border-gray-200 rounded-none focus:border-blue-500 focus:ring-0 bg-transparent\"\r\n              />\r\n            </div>\r\n          );\r\n        }\r\n\r\n        return null;\r\n      })}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\templates\\structured-template-marketplace.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1084,1087],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1084,1087],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setSearchQuery' is assigned a value but never used.","line":79,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":79,"endColumn":37},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`loadCustomTemplates` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\templates\\structured-template-marketplace.tsx:89:34\n  87 |     // Cargar templates del sistema y personalizados\n  88 |     const systemTemplates = getAllTemplates();\n> 89 |     const savedCustomTemplates = loadCustomTemplates();\n     |                                  ^^^^^^^^^^^^^^^^^^^ `loadCustomTemplates` accessed before it is declared\n  90 |     setCustomTemplates(savedCustomTemplates);\n  91 |     setAllTemplates([...systemTemplates, ...savedCustomTemplates]);\n  92 |   }, []);\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\templates\\structured-template-marketplace.tsx:94:3\n   92 |   }, []);\n   93 |\n>  94 |   const loadCustomTemplates = (): StructuredTemplate[] => {\n      |   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n>  95 |     if (typeof window === 'undefined') return [];\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n>  96 |     const saved = localStorage.getItem('customTemplates');\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n>  97 |     return saved ? JSON.parse(saved) : [];\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n>  98 |   };\n      | ^^^^^ `loadCustomTemplates` is declared here\n   99 |\n  100 |   const saveCustomTemplate = (template: StructuredTemplate) => {\n  101 |     const updated = [...customTemplates, template];","line":89,"column":34,"nodeType":null,"endLine":89,"endColumn":53},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'categories' is assigned a value but never used.","line":131,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":131,"endColumn":19}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { ScrollArea } from \"@red-salud/ui\";\r\nimport { Tabs, TabsList, TabsTrigger } from \"@red-salud/ui\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from \"@red-salud/ui\";\r\nimport {\r\n  FileText,\r\n  Stethoscope,\r\n  Activity,\r\n  AlertCircle,\r\n  Heart,\r\n  Plus,\r\n  Eye,\r\n  Sparkles,\r\n  CheckCircle,\r\n  Zap,\r\n  Baby,\r\n  User,\r\n  Scan,\r\n  Ear,\r\n  Bone,\r\n  Brain,\r\n  Wind,\r\n  Droplet,\r\n  Bug,\r\n  Scissors,\r\n  ClipboardCheck,\r\n  UserPlus,\r\n  AlertTriangle,\r\n  Star,\r\n} from \"lucide-react\";\r\nimport { StructuredTemplate } from \"@/lib/templates/structured-templates\";\r\nimport { getAllTemplates } from \"@/lib/templates/extended-templates\";\r\nimport { CustomTemplateCreator } from \"./custom-template-creator\";\r\n\r\ninterface StructuredTemplateMarketplaceProps {\r\n  open: boolean;\r\n  onClose: () => void;\r\n  onSelectTemplate: (template: StructuredTemplate) => void;\r\n}\r\n\r\nconst iconMap: Record<string, any> = {\r\n  FileText,\r\n  Stethoscope,\r\n  Activity,\r\n  AlertCircle,\r\n  Heart,\r\n  Zap,\r\n  Baby,\r\n  User,\r\n  Scan,\r\n  Eye,\r\n  Ear,\r\n  Bone,\r\n  Brain,\r\n  Wind,\r\n  Droplet,\r\n  Bug,\r\n  Scissors,\r\n  ClipboardCheck,\r\n  UserPlus,\r\n  AlertTriangle,\r\n};\r\n\r\nexport function StructuredTemplateMarketplace({\r\n  open,\r\n  onClose,\r\n  onSelectTemplate,\r\n}: StructuredTemplateMarketplaceProps) {\r\n  const [searchQuery, setSearchQuery] = useState(\"\");\r\n  const [selectedCategory, setSelectedCategory] = useState<string>(\"all\");\r\n  const [previewTemplate, setPreviewTemplate] = useState<StructuredTemplate | null>(null);\r\n  const [showCustomCreator, setShowCustomCreator] = useState(false);\r\n  const [customTemplates, setCustomTemplates] = useState<StructuredTemplate[]>([]);\r\n  const [allTemplates, setAllTemplates] = useState<StructuredTemplate[]>([]);\r\n\r\n  useEffect(() => {\r\n    // Cargar templates del sistema y personalizados\r\n    const systemTemplates = getAllTemplates();\r\n    const savedCustomTemplates = loadCustomTemplates();\r\n    setCustomTemplates(savedCustomTemplates);\r\n    setAllTemplates([...systemTemplates, ...savedCustomTemplates]);\r\n  }, []);\r\n\r\n  const loadCustomTemplates = (): StructuredTemplate[] => {\r\n    if (typeof window === 'undefined') return [];\r\n    const saved = localStorage.getItem('customTemplates');\r\n    return saved ? JSON.parse(saved) : [];\r\n  };\r\n\r\n  const saveCustomTemplate = (template: StructuredTemplate) => {\r\n    const updated = [...customTemplates, template];\r\n    setCustomTemplates(updated);\r\n    setAllTemplates([...getAllTemplates(), ...updated]);\r\n    localStorage.setItem('customTemplates', JSON.stringify(updated));\r\n  };\r\n\r\n  const filteredTemplates = allTemplates.filter((template) => {\r\n    const matchesSearch =\r\n      searchQuery === \"\" ||\r\n      template.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n      template.description.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n      template.tags.some((tag) => tag.toLowerCase().includes(searchQuery.toLowerCase())) ||\r\n      (template.specialty && template.specialty.toLowerCase().includes(searchQuery.toLowerCase()));\r\n\r\n    const matchesCategory =\r\n      selectedCategory === \"all\" || template.category === selectedCategory;\r\n\r\n    return matchesSearch && matchesCategory;\r\n  });\r\n\r\n  const handleUseTemplate = (template: StructuredTemplate) => {\r\n    onSelectTemplate(template);\r\n    onClose();\r\n  };\r\n\r\n  const IconComponent = (iconName: string) => {\r\n    const Icon = iconMap[iconName] || FileText;\r\n    return Icon;\r\n  };\r\n\r\n  const categories = [\r\n    { value: 'all', label: 'Todos' },\r\n    { value: 'general', label: 'General' },\r\n    { value: 'especialidad', label: 'Especialidad' },\r\n    { value: 'emergencia', label: 'Emergencia' },\r\n    { value: 'control', label: 'Control' },\r\n    { value: 'pediatria', label: 'Pediatría' },\r\n    { value: 'ginecologia', label: 'Ginecología' },\r\n    { value: 'quirurgico', label: 'Quirúrgico' },\r\n    { value: 'custom', label: 'Personalizados' },\r\n  ];\r\n\r\n  return (\r\n    <>\r\n      <Dialog open={open} onOpenChange={onClose}>\r\n      <DialogContent className=\"w-[98vw] max-w-[98vw] sm:max-w-[98vw] h-[95vh] p-0 gap-0 flex flex-col\">\r\n          <DialogHeader className=\"px-6 py-4 border-b flex-shrink-0\">\r\n            <DialogTitle className=\"text-xl flex items-center gap-2\">\r\n              <div className=\"h-10 w-10 rounded-lg bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center\">\r\n                <FileText className=\"h-5 w-5 text-white\" />\r\n              </div>\r\n              Marketplace de Templates\r\n            </DialogTitle>\r\n            <DialogDescription>\r\n              Explora y usa templates médicos creados por RED-SALUD y la comunidad\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n\r\n          <div className=\"flex-1 flex flex-col overflow-hidden min-h-0\">\r\n            {/* Search and Filters */}\r\n            <div className=\"px-6 py-4 border-b space-y-4 bg-gray-50/50\">\r\n              <Tabs value={selectedCategory} onValueChange={setSelectedCategory} className=\"w-full\">\r\n                <TabsList className=\"w-full justify-start h-auto p-1 bg-gray-200/50 flex flex-wrap gap-1\">\r\n                  <TabsTrigger value=\"all\" className=\"flex-1 min-w-[100px] text-xs py-2 data-[state=active]:bg-white data-[state=active]:shadow-sm\">\r\n                    Todos\r\n                  </TabsTrigger>\r\n                  <TabsTrigger value=\"favorites\" className=\"flex-1 min-w-[100px] text-xs py-2 data-[state=active]:bg-white data-[state=active]:shadow-sm\">\r\n                    <Star className=\"h-3 w-3 mr-1\" />\r\n                    Favoritos\r\n                  </TabsTrigger>\r\n                  <TabsTrigger value=\"general\" className=\"flex-1 min-w-[100px] text-xs py-2 data-[state=active]:bg-white data-[state=active]:shadow-sm\">\r\n                    General\r\n                  </TabsTrigger>\r\n                  <TabsTrigger value=\"especialidad\" className=\"flex-1 min-w-[100px] text-xs py-2 data-[state=active]:bg-white data-[state=active]:shadow-sm\">\r\n                    Especialidad\r\n                  </TabsTrigger>\r\n                  <TabsTrigger value=\"emergencia\" className=\"flex-1 min-w-[100px] text-xs py-2 data-[state=active]:bg-white data-[state=active]:shadow-sm\">\r\n                    Emergencia\r\n                  </TabsTrigger>\r\n                  <TabsTrigger value=\"control\" className=\"flex-1 min-w-[100px] text-xs py-2 data-[state=active]:bg-white data-[state=active]:shadow-sm\">\r\n                    Control\r\n                  </TabsTrigger>\r\n                  <TabsTrigger value=\"custom\" className=\"flex-1 min-w-[100px] text-xs py-2 data-[state=active]:bg-white data-[state=active]:shadow-sm\">\r\n                    <User className=\"h-3 w-3 mr-1\" />\r\n                    Mis Templates\r\n                  </TabsTrigger>\r\n                </TabsList>\r\n              </Tabs>\r\n            </div>\r\n\r\n            {/* Templates Grid */}\r\n            <ScrollArea className=\"flex-1\">\r\n              <div className=\"p-6\">\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\r\n                {filteredTemplates.map((template) => {\r\n                  const Icon = IconComponent(template.icon);\r\n                  \r\n                  return (\r\n                    <div\r\n                      key={template.id}\r\n                      className=\"group relative border rounded-lg p-4 hover:shadow-lg transition-all bg-white\"\r\n                    >\r\n                      {/* Header */}\r\n                      <div className=\"flex items-start justify-between mb-3\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                          <div className={`h-12 w-12 rounded-lg flex items-center justify-center bg-${template.color}-100`}>\r\n                            <Icon className={`h-6 w-6 text-${template.color}-600`} />\r\n                          </div>\r\n                          <div className=\"flex-1 min-w-0\">\r\n                            <h3 className=\"font-semibold text-sm text-gray-900\">\r\n                              {template.name}\r\n                            </h3>\r\n                            <p className=\"text-xs text-gray-500\">\r\n                              {template.fields.length} campos\r\n                              {template.specialty && ` • ${template.specialty}`}\r\n                            </p>\r\n                          </div>\r\n                        </div>\r\n                        {template.isCustom && (\r\n                          <Badge variant=\"secondary\" className=\"text-xs\">\r\n                            Personalizado\r\n                          </Badge>\r\n                        )}\r\n                      </div>\r\n\r\n                      {/* Description */}\r\n                      <p className=\"text-xs text-gray-600 mb-3\">\r\n                        {template.description}\r\n                      </p>\r\n\r\n                      {/* Tags */}\r\n                      <div className=\"flex flex-wrap gap-1 mb-3\">\r\n                        {template.tags.slice(0, 3).map((tag) => (\r\n                          <Badge key={tag} variant=\"secondary\" className=\"text-xs\">\r\n                            {tag}\r\n                          </Badge>\r\n                        ))}\r\n                        <Badge variant=\"outline\" className=\"text-xs border-purple-300 text-purple-600\">\r\n                          <Sparkles className=\"h-3 w-3 mr-1\" />\r\n                          Estructurado\r\n                        </Badge>\r\n                      </div>\r\n\r\n                      {/* Fields Preview */}\r\n                      <div className=\"mb-3 p-2 bg-gray-50 rounded text-xs space-y-1\">\r\n                        <p className=\"font-semibold text-gray-700\">Campos incluidos:</p>\r\n                        {template.fields.slice(0, 3).map((field) => (\r\n                          <div key={field.id} className=\"flex items-center gap-1 text-gray-600\">\r\n                            <CheckCircle className=\"h-3 w-3 text-green-600\" />\r\n                            <span>{field.label}</span>\r\n                            {field.required && <span className=\"text-red-500\">*</span>}\r\n                          </div>\r\n                        ))}\r\n                        {template.fields.length > 3 && (\r\n                          <p className=\"text-gray-500\">\r\n                            +{template.fields.length - 3} campos más...\r\n                          </p>\r\n                        )}\r\n                      </div>\r\n\r\n                      {/* Actions */}\r\n                      <div className=\"flex gap-2\">\r\n                        <Button\r\n                          size=\"sm\"\r\n                          variant=\"outline\"\r\n                          className=\"flex-1 h-8\"\r\n                          onClick={() => setPreviewTemplate(template)}\r\n                        >\r\n                          <Eye className=\"h-3 w-3 mr-1\" />\r\n                          Vista Previa\r\n                        </Button>\r\n                        <Button\r\n                          size=\"sm\"\r\n                          className=\"flex-1 h-8 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700\"\r\n                          onClick={() => handleUseTemplate(template)}\r\n                        >\r\n                          <Plus className=\"h-3 w-3 mr-1\" />\r\n                          Usar\r\n                        </Button>\r\n                      </div>\r\n                    </div>\r\n                  );\r\n                })}\r\n              </div>\r\n\r\n              {filteredTemplates.length === 0 && (\r\n                <div className=\"text-center py-12\">\r\n                  <FileText className=\"h-12 w-12 text-gray-400 mx-auto mb-3\" />\r\n                  <p className=\"text-sm text-gray-600 mb-1\">No se encontraron templates</p>\r\n                  <p className=\"text-xs text-gray-500\">\r\n                    Intenta con otros términos de búsqueda\r\n                  </p>\r\n                </div>\r\n              )}\r\n            </div>\r\n            </ScrollArea>\r\n\r\n            {/* Footer */}\r\n            <div className=\"px-6 py-4 border-t bg-gray-50 flex items-center justify-between\">\r\n              <div className=\"flex items-center gap-2 text-xs text-gray-600\">\r\n                <FileText className=\"h-4 w-4\" />\r\n                <span>{filteredTemplates.length} templates disponibles</span>\r\n              </div>\r\n              <div className=\"flex gap-2\">\r\n                <Button \r\n                  variant=\"outline\" \r\n                  size=\"sm\" \r\n                  onClick={() => setShowCustomCreator(true)}\r\n                  className=\"bg-gradient-to-r from-green-50 to-emerald-50 border-green-200 hover:from-green-100 hover:to-emerald-100\"\r\n                >\r\n                  <Plus className=\"h-4 w-4 mr-2\" />\r\n                  Crear Template\r\n                </Button>\r\n                <Button variant=\"outline\" size=\"sm\" onClick={onClose}>\r\n                  Cerrar\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* Preview Dialog */}\r\n      <Dialog open={!!previewTemplate} onOpenChange={() => setPreviewTemplate(null)}>\r\n        <DialogContent className=\"w-[90vw] max-w-[90vw] h-[85vh] flex flex-col\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"flex items-center gap-3\">\r\n              {previewTemplate && (\r\n                <>\r\n                  <div className={`h-10 w-10 rounded-lg flex items-center justify-center bg-${previewTemplate.color}-100`}>\r\n                    {(() => {\r\n                      const Icon = IconComponent(previewTemplate.icon);\r\n                      return <Icon className={`h-5 w-5 text-${previewTemplate.color}-600`} />;\r\n                    })()}\r\n                  </div>\r\n                  <div>\r\n                    <div className=\"font-semibold\">{previewTemplate.name}</div>\r\n                    <div className=\"text-sm text-gray-500 font-normal\">\r\n                      {previewTemplate.description}\r\n                    </div>\r\n                  </div>\r\n                </>\r\n              )}\r\n            </DialogTitle>\r\n          </DialogHeader>\r\n\r\n          {previewTemplate && (\r\n            <div className=\"flex-1 flex flex-col overflow-hidden\">\r\n              {/* Template Info */}\r\n              <div className=\"grid grid-cols-3 gap-4 mb-4 p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg border border-blue-200\">\r\n                <div className=\"text-center\">\r\n                  <p className=\"text-2xl font-bold text-blue-600\">{previewTemplate.fields.length}</p>\r\n                  <p className=\"text-xs text-gray-600\">Campos Totales</p>\r\n                </div>\r\n                <div className=\"text-center\">\r\n                  <p className=\"text-2xl font-bold text-purple-600\">\r\n                    {previewTemplate.fields.filter(f => f.required).length}\r\n                  </p>\r\n                  <p className=\"text-xs text-gray-600\">Campos Requeridos</p>\r\n                </div>\r\n                <div className=\"text-center\">\r\n                  <p className=\"text-2xl font-bold text-green-600\">\r\n                    {previewTemplate.fields.filter(f => f.type === 'vitals' || f.type === 'medications').length}\r\n                  </p>\r\n                  <p className=\"text-xs text-gray-600\">Campos Especiales</p>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Tags */}\r\n              <div className=\"flex flex-wrap gap-2 mb-4\">\r\n                {previewTemplate.tags.map((tag) => (\r\n                  <Badge key={tag} variant=\"secondary\">\r\n                    {tag}\r\n                  </Badge>\r\n                ))}\r\n                {previewTemplate.specialty && (\r\n                  <Badge variant=\"outline\" className=\"border-blue-300 text-blue-700\">\r\n                    {previewTemplate.specialty}\r\n                  </Badge>\r\n                )}\r\n              </div>\r\n\r\n              {/* Fields Preview */}\r\n              <ScrollArea className=\"flex-1 border rounded-lg bg-white\">\r\n                <div className=\"p-6 space-y-6\">\r\n                  {previewTemplate.fields.map((field, index) => (\r\n                    <div key={field.id} className=\"space-y-2 pb-4 border-b last:border-b-0\">\r\n                      <div className=\"flex items-start justify-between\">\r\n                        <div className=\"flex-1\">\r\n                          <div className=\"flex items-center gap-2 mb-1\">\r\n                            <span className=\"flex items-center justify-center h-6 w-6 rounded-full bg-blue-100 text-blue-600 text-xs font-semibold\">\r\n                              {index + 1}\r\n                            </span>\r\n                            <p className=\"text-sm font-semibold text-gray-900\">\r\n                              {field.label}\r\n                            </p>\r\n                            {field.required && (\r\n                              <Badge variant=\"destructive\" className=\"text-xs h-5\">\r\n                                Requerido\r\n                              </Badge>\r\n                            )}\r\n                          </div>\r\n                          {field.placeholder && (\r\n                            <p className=\"text-xs text-gray-500 italic ml-8\">\r\n                              Ejemplo: {field.placeholder}\r\n                            </p>\r\n                          )}\r\n                        </div>\r\n                        <div className=\"flex flex-col gap-1\">\r\n                          {field.type === 'vitals' && (\r\n                            <Badge variant=\"outline\" className=\"text-xs border-green-300 text-green-700\">\r\n                              <Activity className=\"h-3 w-3 mr-1\" />\r\n                              Signos Vitales\r\n                            </Badge>\r\n                          )}\r\n                          {field.type === 'medications' && (\r\n                            <Badge variant=\"outline\" className=\"text-xs border-purple-300 text-purple-700\">\r\n                              <Sparkles className=\"h-3 w-3 mr-1\" />\r\n                              Autocompletado\r\n                            </Badge>\r\n                          )}\r\n                          {field.type === 'textarea' && (\r\n                            <Badge variant=\"outline\" className=\"text-xs border-gray-300 text-gray-700\">\r\n                              Texto Largo\r\n                            </Badge>\r\n                          )}\r\n                          {field.type === 'input' && (\r\n                            <Badge variant=\"outline\" className=\"text-xs border-gray-300 text-gray-700\">\r\n                              Texto Corto\r\n                            </Badge>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                      \r\n                      {/* Visual representation */}\r\n                      <div className=\"ml-8 mt-2\">\r\n                        {field.type === 'textarea' && (\r\n                          <div className=\"border rounded-md p-3 bg-gray-50 min-h-[80px] text-xs text-gray-400\">\r\n                            {field.placeholder || 'Área de texto...'}\r\n                          </div>\r\n                        )}\r\n                        {field.type === 'input' && (\r\n                          <div className=\"border rounded-md p-2 bg-gray-50 text-xs text-gray-400\">\r\n                            {field.placeholder || 'Campo de texto...'}\r\n                          </div>\r\n                        )}\r\n                        {field.type === 'select' && (\r\n                          <div className=\"border rounded-md p-2 bg-gray-50 text-xs text-gray-400\">\r\n                            Selector de opciones\r\n                          </div>\r\n                        )}\r\n                        {field.type === 'checkbox' && (\r\n                          <div className=\"border rounded-md p-2 bg-gray-50 text-xs text-gray-400\">\r\n                            Casilla de verificación\r\n                          </div>\r\n                        )}\r\n                        {field.type === 'vitals' && (\r\n                          <div className=\"grid grid-cols-3 gap-2\">\r\n                            <div className=\"border rounded-md p-2 bg-green-50 text-xs\">\r\n                              <p className=\"font-semibold text-green-700\">PA</p>\r\n                              <p className=\"text-gray-500\">120/80 mmHg</p>\r\n                            </div>\r\n                            <div className=\"border rounded-md p-2 bg-green-50 text-xs\">\r\n                              <p className=\"font-semibold text-green-700\">FC</p>\r\n                              <p className=\"text-gray-500\">72 lpm</p>\r\n                            </div>\r\n                            <div className=\"border rounded-md p-2 bg-green-50 text-xs\">\r\n                              <p className=\"font-semibold text-green-700\">Temp</p>\r\n                              <p className=\"text-gray-500\">36.5°C</p>\r\n                            </div>\r\n                          </div>\r\n                        )}\r\n                        {field.type === 'medications' && (\r\n                          <div className=\"border rounded-md p-2 bg-purple-50 text-xs\">\r\n                            <div className=\"flex items-center gap-2 text-purple-700\">\r\n                              <Sparkles className=\"h-3 w-3\" />\r\n                              <span>Búsqueda inteligente de medicamentos</span>\r\n                            </div>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </ScrollArea>\r\n\r\n              <div className=\"flex gap-2 mt-4\">\r\n                <Button\r\n                  variant=\"outline\"\r\n                  className=\"flex-1\"\r\n                  onClick={() => setPreviewTemplate(null)}\r\n                >\r\n                  Cerrar\r\n                </Button>\r\n                <Button\r\n                  className=\"flex-1 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700\"\r\n                  onClick={() => {\r\n                    handleUseTemplate(previewTemplate);\r\n                    setPreviewTemplate(null);\r\n                  }}\r\n                >\r\n                  <Plus className=\"h-4 w-4 mr-2\" />\r\n                  Usar este Template\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* Custom Template Creator */}\r\n      <CustomTemplateCreator\r\n        open={showCustomCreator}\r\n        onClose={() => setShowCustomCreator(false)}\r\n        onSave={saveCustomTemplate}\r\n      />\r\n    </>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\templates\\template-marketplace.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TabsContent' is defined but never used.","line":8,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":39,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[912,915],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[912,915],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setTemplates' is assigned a value but never used.","line":57,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":57,"endColumn":33},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\templates\\template-marketplace.tsx:62:7\n  60 |     if (open) {\n  61 |       const userFavorites = getFavoriteTemplates(userId);\n> 62 |       setFavorites(userFavorites);\n     |       ^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  63 |     }\n  64 |   }, [open, userId]);\n  65 |","line":62,"column":7,"nodeType":null,"endLine":62,"endColumn":19}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { ScrollArea } from \"@red-salud/ui\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@red-salud/ui\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from \"@red-salud/ui\";\r\nimport {\r\n  Search,\r\n  Star,\r\n  FileText,\r\n  Stethoscope,\r\n  Activity,\r\n  AlertCircle,\r\n  Heart,\r\n  Plus,\r\n  Eye,\r\n  Sparkles,\r\n  TrendingUp,\r\n  Users,\r\n} from \"lucide-react\";\r\nimport { OFFICIAL_TEMPLATES, MedicalTemplate, getFavoriteTemplates, toggleFavorite } from \"@/lib/templates/medical-templates\";\r\n\r\ninterface TemplateMarketplaceProps {\r\n  open: boolean;\r\n  onClose: () => void;\r\n  onSelectTemplate: (content: string) => void;\r\n  userId: string;\r\n}\r\n\r\nconst iconMap: Record<string, any> = {\r\n  FileText,\r\n  Stethoscope,\r\n  Activity,\r\n  AlertCircle,\r\n  Heart,\r\n};\r\n\r\nexport function TemplateMarketplace({\r\n  open,\r\n  onClose,\r\n  onSelectTemplate,\r\n  userId,\r\n}: TemplateMarketplaceProps) {\r\n  const [searchQuery, setSearchQuery] = useState(\"\");\r\n  const [selectedCategory, setSelectedCategory] = useState<string>(\"all\");\r\n  const [favorites, setFavorites] = useState<string[]>([]);\r\n  const [previewTemplate, setPreviewTemplate] = useState<MedicalTemplate | null>(null);\r\n  const [templates, setTemplates] = useState<MedicalTemplate[]>(OFFICIAL_TEMPLATES);\r\n\r\n  useEffect(() => {\r\n    if (open) {\r\n      const userFavorites = getFavoriteTemplates(userId);\r\n      setFavorites(userFavorites);\r\n    }\r\n  }, [open, userId]);\r\n\r\n  const handleToggleFavorite = (templateId: string) => {\r\n    toggleFavorite(userId, templateId);\r\n    const userFavorites = getFavoriteTemplates(userId);\r\n    setFavorites(userFavorites);\r\n  };\r\n\r\n  const filteredTemplates = templates.filter((template) => {\r\n    const matchesSearch =\r\n      template.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n      template.description.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n      template.tags.some((tag) => tag.toLowerCase().includes(searchQuery.toLowerCase()));\r\n\r\n    const matchesCategory =\r\n      selectedCategory === \"all\" ||\r\n      selectedCategory === \"favorites\" && favorites.includes(template.id) ||\r\n      template.category === selectedCategory;\r\n\r\n    return matchesSearch && matchesCategory;\r\n  });\r\n\r\n  const handleUseTemplate = (template: MedicalTemplate) => {\r\n    onSelectTemplate(template.content);\r\n    onClose();\r\n  };\r\n\r\n  const IconComponent = (iconName: string) => {\r\n    const Icon = iconMap[iconName] || FileText;\r\n    return Icon;\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Dialog open={open} onOpenChange={onClose}>\r\n        <DialogContent className=\"max-w-6xl h-[85vh] p-0 gap-0\">\r\n          <DialogHeader className=\"px-6 py-4 border-b\">\r\n            <DialogTitle className=\"text-xl flex items-center gap-2\">\r\n              <div className=\"h-10 w-10 rounded-lg bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center\">\r\n                <FileText className=\"h-5 w-5 text-white\" />\r\n              </div>\r\n              Marketplace de Templates\r\n            </DialogTitle>\r\n            <DialogDescription>\r\n              Explora y usa templates médicos creados por RED-SALUD y la comunidad\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n\r\n          <div className=\"flex-1 flex flex-col overflow-hidden\">\r\n            {/* Search and Filters */}\r\n            <div className=\"px-6 py-4 border-b space-y-4\">\r\n              <div className=\"relative\">\r\n                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400\" />\r\n                <Input\r\n                  placeholder=\"Buscar templates por nombre, descripción o etiquetas...\"\r\n                  value={searchQuery}\r\n                  onChange={(e) => setSearchQuery(e.target.value)}\r\n                  className=\"pl-10\"\r\n                />\r\n              </div>\r\n\r\n              <Tabs value={selectedCategory} onValueChange={setSelectedCategory}>\r\n                <TabsList className=\"grid w-full grid-cols-6\">\r\n                  <TabsTrigger value=\"all\" className=\"text-xs\">\r\n                    Todos\r\n                  </TabsTrigger>\r\n                  <TabsTrigger value=\"favorites\" className=\"text-xs\">\r\n                    <Star className=\"h-3 w-3 mr-1\" />\r\n                    Favoritos\r\n                  </TabsTrigger>\r\n                  <TabsTrigger value=\"general\" className=\"text-xs\">\r\n                    General\r\n                  </TabsTrigger>\r\n                  <TabsTrigger value=\"especialidad\" className=\"text-xs\">\r\n                    Especialidad\r\n                  </TabsTrigger>\r\n                  <TabsTrigger value=\"emergencia\" className=\"text-xs\">\r\n                    Emergencia\r\n                  </TabsTrigger>\r\n                  <TabsTrigger value=\"control\" className=\"text-xs\">\r\n                    Control\r\n                  </TabsTrigger>\r\n                </TabsList>\r\n              </Tabs>\r\n            </div>\r\n\r\n            {/* Templates Grid */}\r\n            <ScrollArea className=\"flex-1 px-6 py-4\">\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 pb-4\">\r\n                {filteredTemplates.map((template) => {\r\n                  const Icon = IconComponent(template.icon);\r\n                  const isFavorite = favorites.includes(template.id);\r\n                  \r\n                  return (\r\n                    <div\r\n                      key={template.id}\r\n                      className=\"group relative border rounded-lg p-4 hover:shadow-lg transition-all bg-white\"\r\n                    >\r\n                      {/* Header */}\r\n                      <div className=\"flex items-start justify-between mb-3\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                          <div\r\n                            className={`h-10 w-10 rounded-lg flex items-center justify-center bg-${template.color}-100`}\r\n                          >\r\n                            <Icon className={`h-5 w-5 text-${template.color}-600`} />\r\n                          </div>\r\n                          <div className=\"flex-1 min-w-0\">\r\n                            <h3 className=\"font-semibold text-sm text-gray-900 truncate\">\r\n                              {template.name}\r\n                            </h3>\r\n                            <p className=\"text-xs text-gray-500\">\r\n                              {template.author === 'red-salud' ? 'RED-SALUD' : template.authorName}\r\n                            </p>\r\n                          </div>\r\n                        </div>\r\n                        <Button\r\n                          variant=\"ghost\"\r\n                          size=\"sm\"\r\n                          className=\"h-8 w-8 p-0\"\r\n                          onClick={() => handleToggleFavorite(template.id)}\r\n                        >\r\n                          <Star\r\n                            className={`h-4 w-4 ${\r\n                              isFavorite ? 'fill-yellow-400 text-yellow-400' : 'text-gray-400'\r\n                            }`}\r\n                          />\r\n                        </Button>\r\n                      </div>\r\n\r\n                      {/* Description */}\r\n                      <p className=\"text-xs text-gray-600 mb-3 line-clamp-2\">\r\n                        {template.description}\r\n                      </p>\r\n\r\n                      {/* Tags */}\r\n                      <div className=\"flex flex-wrap gap-1 mb-3\">\r\n                        {template.tags.slice(0, 3).map((tag) => (\r\n                          <Badge key={tag} variant=\"secondary\" className=\"text-xs\">\r\n                            {tag}\r\n                          </Badge>\r\n                        ))}\r\n                        {template.aiEnabled && (\r\n                          <Badge variant=\"outline\" className=\"text-xs border-purple-300 text-purple-600\">\r\n                            <Sparkles className=\"h-3 w-3 mr-1\" />\r\n                            IA\r\n                          </Badge>\r\n                        )}\r\n                      </div>\r\n\r\n                      {/* Actions */}\r\n                      <div className=\"flex gap-2\">\r\n                        <Button\r\n                          size=\"sm\"\r\n                          variant=\"outline\"\r\n                          className=\"flex-1 h-8\"\r\n                          onClick={() => setPreviewTemplate(template)}\r\n                        >\r\n                          <Eye className=\"h-3 w-3 mr-1\" />\r\n                          Vista Previa\r\n                        </Button>\r\n                        <Button\r\n                          size=\"sm\"\r\n                          className=\"flex-1 h-8 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700\"\r\n                          onClick={() => handleUseTemplate(template)}\r\n                        >\r\n                          <Plus className=\"h-3 w-3 mr-1\" />\r\n                          Usar\r\n                        </Button>\r\n                      </div>\r\n\r\n                      {/* Stats */}\r\n                      {template.usageCount && (\r\n                        <div className=\"mt-2 pt-2 border-t flex items-center justify-between text-xs text-gray-500\">\r\n                          <div className=\"flex items-center gap-1\">\r\n                            <TrendingUp className=\"h-3 w-3\" />\r\n                            <span>{template.usageCount} usos</span>\r\n                          </div>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  );\r\n                })}\r\n              </div>\r\n\r\n              {filteredTemplates.length === 0 && (\r\n                <div className=\"text-center py-12\">\r\n                  <FileText className=\"h-12 w-12 text-gray-400 mx-auto mb-3\" />\r\n                  <p className=\"text-sm text-gray-600 mb-1\">No se encontraron templates</p>\r\n                  <p className=\"text-xs text-gray-500\">\r\n                    Intenta con otros términos de búsqueda o cambia el filtro\r\n                  </p>\r\n                </div>\r\n              )}\r\n            </ScrollArea>\r\n\r\n            {/* Footer */}\r\n            <div className=\"px-6 py-4 border-t bg-gray-50 flex items-center justify-between\">\r\n              <div className=\"flex items-center gap-2 text-xs text-gray-600\">\r\n                <Users className=\"h-4 w-4\" />\r\n                <span>{filteredTemplates.length} templates disponibles</span>\r\n              </div>\r\n              <Button variant=\"outline\" size=\"sm\" onClick={onClose}>\r\n                Cerrar\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* Preview Dialog */}\r\n      <Dialog open={!!previewTemplate} onOpenChange={() => setPreviewTemplate(null)}>\r\n        <DialogContent className=\"max-w-4xl h-[80vh] flex flex-col\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"flex items-center gap-3\">\r\n              {previewTemplate && (\r\n                <>\r\n                  <div className={`h-10 w-10 rounded-lg flex items-center justify-center bg-${previewTemplate.color}-100`}>\r\n                    {(() => {\r\n                      const Icon = IconComponent(previewTemplate.icon);\r\n                      return <Icon className={`h-5 w-5 text-${previewTemplate.color}-600`} />;\r\n                    })()}\r\n                  </div>\r\n                  <div>\r\n                    <div className=\"font-semibold\">{previewTemplate.name}</div>\r\n                    <div className=\"text-sm text-gray-500 font-normal\">\r\n                      {previewTemplate.description}\r\n                    </div>\r\n                  </div>\r\n                </>\r\n              )}\r\n            </DialogTitle>\r\n          </DialogHeader>\r\n\r\n          {previewTemplate && (\r\n            <div className=\"flex-1 flex flex-col overflow-hidden\">\r\n              <div className=\"flex-1 border rounded-lg bg-gray-50 overflow-hidden\">\r\n                <ScrollArea className=\"h-full\">\r\n                  <pre className=\"p-6 text-sm font-mono whitespace-pre-wrap text-gray-700\">\r\n                    {previewTemplate.content || \"Template en blanco\"}\r\n                  </pre>\r\n                </ScrollArea>\r\n              </div>\r\n\r\n              <div className=\"flex gap-2 mt-4\">\r\n                <Button\r\n                  variant=\"outline\"\r\n                  className=\"flex-1\"\r\n                  onClick={() => setPreviewTemplate(null)}\r\n                >\r\n                  Cerrar\r\n                </Button>\r\n                <Button\r\n                  className=\"flex-1 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700\"\r\n                  onClick={() => {\r\n                    handleUseTemplate(previewTemplate);\r\n                    setPreviewTemplate(null);\r\n                  }}\r\n                >\r\n                  <Plus className=\"h-4 w-4 mr-2\" />\r\n                  Usar este Template\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </DialogContent>\r\n      </Dialog>\r\n    </>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\workspace\\ai-recommendations-panel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\workspace\\autocomplete-suggestions.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\workspace\\diagnostics-panel.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Badge' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { X } from \"lucide-react\";\r\n\r\ninterface DiagnosticsPanelProps {\r\n  diagnosticos: string[];\r\n  onRemove: (index: number) => void;\r\n}\r\n\r\nexport function DiagnosticsPanel({ diagnosticos, onRemove }: DiagnosticsPanelProps) {\r\n  if (diagnosticos.length === 0) return null;\r\n\r\n  return (\r\n    <div className=\"space-y-2\">\r\n      <h3 className=\"text-sm font-semibold text-gray-900\">Diagnósticos Seleccionados</h3>\r\n      {diagnosticos.map((diagnostico, index) => (\r\n        <div\r\n          key={index}\r\n          className=\"p-3 border rounded-lg bg-blue-50 border-blue-200 flex items-start justify-between\"\r\n        >\r\n          <p className=\"text-sm font-medium text-gray-900 flex-1\">{diagnostico}</p>\r\n          <Button\r\n            size=\"sm\"\r\n            variant=\"ghost\"\r\n            onClick={() => onRemove(index)}\r\n            className=\"flex-shrink-0 ml-2 h-6 w-6 p-0\"\r\n          >\r\n            <X className=\"h-4 w-4\" />\r\n          </Button>\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\workspace\\free-notes-editor.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\workspace\\historial-detail-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\workspace\\historial-panel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\workspace\\icd-search-tab.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'selectedCategory' is assigned a value but never used.","line":74,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":74,"endColumn":26},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'handleSearchICD'. Either include it or remove the dependency array.","line":109,"column":6,"nodeType":"ArrayExpression","endLine":109,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [handleSearchICD, icdSearchQuery]","fix":{"range":[3431,3447],"text":"[handleSearchICD, icdSearchQuery]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect, useCallback } from \"react\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Search, Loader2, X, Plus, AlertCircle, Sparkles, Clock, TrendingUp, Heart, Brain, Stethoscope, Activity } from \"lucide-react\";\r\nimport { ScrollArea } from \"@red-salud/ui\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\ninterface ICDSearchTabProps {\r\n  diagnosticos: string[];\r\n  onAddDiagnostico: (codigo: string, descripcion: string) => void;\r\n  onRemoveDiagnostico: (index: number) => void;\r\n  notasMedicas?: string;\r\n}\r\n\r\ninterface ICDResult {\r\n  id: string;\r\n  code: string;\r\n  title: string;\r\n  definition?: string;\r\n  chapter?: string;\r\n  score?: number;\r\n}\r\n\r\n// Categorías comunes de diagnósticos\r\nconst COMMON_CATEGORIES = [\r\n  {\r\n    name: \"Respiratorio\",\r\n    icon: Activity,\r\n    color: \"bg-blue-100 text-blue-700 hover:bg-blue-200\",\r\n    searches: [\"asma\", \"neumonía\", \"bronquitis\", \"gripe\", \"COVID-19\"]\r\n  },\r\n  {\r\n    name: \"Cardiovascular\",\r\n    icon: Heart,\r\n    color: \"bg-red-100 text-red-700 hover:bg-red-200\",\r\n    searches: [\"hipertensión\", \"arritmia\", \"insuficiencia cardíaca\", \"angina\"]\r\n  },\r\n  {\r\n    name: \"Digestivo\",\r\n    icon: Stethoscope,\r\n    color: \"bg-green-100 text-green-700 hover:bg-green-200\",\r\n    searches: [\"gastritis\", \"colitis\", \"reflujo\", \"diarrea\", \"estreñimiento\"]\r\n  },\r\n  {\r\n    name: \"Endocrino\",\r\n    icon: TrendingUp,\r\n    color: \"bg-purple-100 text-purple-700 hover:bg-purple-200\",\r\n    searches: [\"diabetes\", \"hipotiroidismo\", \"hipertiroidismo\", \"obesidad\"]\r\n  },\r\n  {\r\n    name: \"Neurológico\",\r\n    icon: Brain,\r\n    color: \"bg-indigo-100 text-indigo-700 hover:bg-indigo-200\",\r\n    searches: [\"migraña\", \"cefalea\", \"epilepsia\", \"vértigo\", \"mareo\"]\r\n  }\r\n];\r\n\r\nexport function ICDSearchTab({\r\n  diagnosticos,\r\n  onAddDiagnostico,\r\n  onRemoveDiagnostico,\r\n  notasMedicas = \"\",\r\n}: ICDSearchTabProps) {\r\n  const [icdSearchQuery, setIcdSearchQuery] = useState(\"\");\r\n  const [icdResults, setIcdResults] = useState<ICDResult[]>([]);\r\n  const [isSearchingICD, setIsSearchingICD] = useState(false);\r\n  const [aiSuggestions, setAiSuggestions] = useState<ICDResult[]>([]);\r\n  const [isLoadingAI, setIsLoadingAI] = useState(false);\r\n  const [recentSearches, setRecentSearches] = useState<string[]>([]);\r\n  const [apiError, setApiError] = useState<string | null>(null);\r\n  const [selectedCategory, setSelectedCategory] = useState<string | null>(null);\r\n\r\n  // Cargar búsquedas recientes del localStorage\r\n  useEffect(() => {\r\n    const saved = localStorage.getItem(\"icd_recent_searches\");\r\n    if (saved) {\r\n      try {\r\n        setRecentSearches(JSON.parse(saved));\r\n      } catch (e) {\r\n        console.error(\"Error loading recent searches:\", e);\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  // Guardar búsqueda reciente\r\n  const saveRecentSearch = useCallback((query: string) => {\r\n    setRecentSearches(prev => {\r\n      const updated = [query, ...prev.filter(q => q !== query)].slice(0, 5);\r\n      localStorage.setItem(\"icd_recent_searches\", JSON.stringify(updated));\r\n      return updated;\r\n    });\r\n  }, []);\r\n\r\n  // Búsqueda con debounce\r\n  useEffect(() => {\r\n    if (!icdSearchQuery.trim() || icdSearchQuery.length < 2) {\r\n      setIcdResults([]);\r\n      return;\r\n    }\r\n\r\n    const timer = setTimeout(() => {\r\n      handleSearchICD();\r\n    }, 500);\r\n\r\n    return () => clearTimeout(timer);\r\n  }, [icdSearchQuery]);\r\n\r\n  const handleSearchICD = async (query?: string) => {\r\n    const searchQuery = query || icdSearchQuery;\r\n    if (!searchQuery.trim()) return;\r\n\r\n    setIsSearchingICD(true);\r\n    setApiError(null);\r\n    \r\n    try {\r\n      const response = await fetch(`/api/icd11/search?q=${encodeURIComponent(searchQuery)}`);\r\n      const data = await response.json();\r\n\r\n      if (data.success && data.data) {\r\n        setIcdResults(data.data.slice(0, 15));\r\n        saveRecentSearch(searchQuery);\r\n      } else {\r\n        setIcdResults([]);\r\n        setApiError(data.message || \"No se encontraron resultados\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error searching ICD-11:\", error);\r\n      setIcdResults([]);\r\n      setApiError(\"Error de conexión. Verifica tu configuración de ICD-11 API.\");\r\n    } finally {\r\n      setIsSearchingICD(false);\r\n    }\r\n  };\r\n\r\n  // Obtener sugerencias de IA basadas en las notas\r\n  const handleAISuggestions = async () => {\r\n    if (!notasMedicas.trim()) {\r\n      alert(\"Escribe algunas notas médicas primero para obtener sugerencias de IA\");\r\n      return;\r\n    }\r\n\r\n    setIsLoadingAI(true);\r\n    try {\r\n      const response = await fetch(\"/api/gemini/suggest-icd11\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ text: notasMedicas }),\r\n      });\r\n\r\n      const data = await response.json();\r\n      \r\n      if (data.success && data.suggestions) {\r\n        // Buscar cada sugerencia en ICD-11\r\n        const suggestions: ICDResult[] = [];\r\n        for (const suggestion of data.suggestions.slice(0, 5)) {\r\n          const searchResponse = await fetch(`/api/icd11/search?q=${encodeURIComponent(suggestion.descripcion)}`);\r\n          const searchData = await searchResponse.json();\r\n          if (searchData.success && searchData.data && searchData.data.length > 0) {\r\n            suggestions.push(searchData.data[0]);\r\n          }\r\n        }\r\n        setAiSuggestions(suggestions);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error getting AI suggestions:\", error);\r\n      alert(\"Error al obtener sugerencias de IA\");\r\n    } finally {\r\n      setIsLoadingAI(false);\r\n    }\r\n  };\r\n\r\n  const handleCategoryClick = (searches: string[]) => {\r\n    setSelectedCategory(searches[0]);\r\n    setIcdSearchQuery(searches[0]);\r\n  };\r\n\r\n  return (\r\n    <div className=\"h-full flex flex-col\">\r\n      <div className=\"p-6 space-y-4 border-b bg-gray-50\">\r\n        {/* Barra de búsqueda principal */}\r\n        <div className=\"flex gap-2\">\r\n          <div className=\"relative flex-1\">\r\n            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400\" />\r\n            <Input\r\n              placeholder=\"Buscar código o diagnóstico... (ej: gastritis, diabetes, K29)\"\r\n              value={icdSearchQuery}\r\n              onChange={(e) => setIcdSearchQuery(e.target.value)}\r\n              onKeyDown={(e) => {\r\n                if (e.key === \"Enter\") {\r\n                  handleSearchICD();\r\n                }\r\n              }}\r\n              className=\"pl-10\"\r\n            />\r\n          </div>\r\n          <Button \r\n            onClick={handleAISuggestions} \r\n            disabled={isLoadingAI || !notasMedicas.trim()}\r\n            variant=\"outline\"\r\n            className=\"gap-2\"\r\n          >\r\n            {isLoadingAI ? (\r\n              <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n            ) : (\r\n              <Sparkles className=\"h-4 w-4\" />\r\n            )}\r\n            IA\r\n          </Button>\r\n        </div>\r\n\r\n        {/* Búsquedas recientes */}\r\n        {recentSearches.length > 0 && !icdSearchQuery && (\r\n          <div className=\"flex items-center gap-2 flex-wrap\">\r\n            <Clock className=\"h-3 w-3 text-gray-400\" />\r\n            <span className=\"text-xs text-gray-500\">Recientes:</span>\r\n            {recentSearches.map((search, idx) => (\r\n              <Badge\r\n                key={idx}\r\n                variant=\"secondary\"\r\n                className=\"cursor-pointer hover:bg-gray-300\"\r\n                onClick={() => setIcdSearchQuery(search)}\r\n              >\r\n                {search}\r\n              </Badge>\r\n            ))}\r\n          </div>\r\n        )}\r\n\r\n        {/* Error de API */}\r\n        {apiError && (\r\n          <div className=\"flex items-center gap-2 p-3 bg-yellow-50 border border-yellow-200 rounded-lg text-sm text-yellow-800\">\r\n            <AlertCircle className=\"h-4 w-4 flex-shrink-0\" />\r\n            <div className=\"flex-1\">\r\n              <p className=\"font-medium\">Usando base de datos local</p>\r\n              <p className=\"text-xs mt-1\">La API de ICD-11 no está disponible. Mostrando diagnósticos comunes de la base de datos local.</p>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      <ScrollArea className=\"flex-1\">\r\n        <div className=\"p-6 space-y-6\">\r\n          {/* Diagnósticos seleccionados */}\r\n          {diagnosticos.length > 0 && (\r\n            <div className=\"space-y-3\">\r\n              <h3 className=\"text-sm font-semibold text-gray-900 flex items-center gap-2\">\r\n                <Badge variant=\"default\" className=\"rounded-full\">\r\n                  {diagnosticos.length}\r\n                </Badge>\r\n                Diagnósticos Seleccionados\r\n              </h3>\r\n              <div className=\"space-y-2\">\r\n                {diagnosticos.map((diagnostico, index) => (\r\n                  <div\r\n                    key={index}\r\n                    className=\"p-3 border rounded-lg bg-blue-50 border-blue-200 flex items-start justify-between group hover:bg-blue-100 transition-colors\"\r\n                  >\r\n                    <p className=\"text-sm font-medium text-gray-900 flex-1\">{diagnostico}</p>\r\n                    <Button\r\n                      size=\"sm\"\r\n                      variant=\"ghost\"\r\n                      onClick={() => onRemoveDiagnostico(index)}\r\n                      className=\"flex-shrink-0 ml-2 h-6 w-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity\"\r\n                    >\r\n                      <X className=\"h-4 w-4\" />\r\n                    </Button>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Sugerencias de IA */}\r\n          {aiSuggestions.length > 0 && (\r\n            <div className=\"space-y-3\">\r\n              <h3 className=\"text-sm font-semibold text-gray-900 flex items-center gap-2\">\r\n                <Sparkles className=\"h-4 w-4 text-purple-600\" />\r\n                Sugerencias de IA\r\n              </h3>\r\n              <div className=\"space-y-2\">\r\n                {aiSuggestions.map((result, index) => (\r\n                  <div\r\n                    key={index}\r\n                    className=\"p-4 border rounded-lg hover:bg-purple-50 cursor-pointer flex items-start justify-between transition-colors border-purple-200 bg-purple-50/50\"\r\n                    onClick={() => onAddDiagnostico(result.code, result.title)}\r\n                  >\r\n                    <div className=\"flex-1\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <Badge variant=\"outline\" className=\"text-xs bg-white\">\r\n                          {result.code}\r\n                        </Badge>\r\n                        <h3 className=\"font-medium text-sm\">{result.title}</h3>\r\n                      </div>\r\n                      {result.definition && (\r\n                        <p className=\"text-xs text-gray-600 mt-1 line-clamp-2\">{result.definition}</p>\r\n                      )}\r\n                    </div>\r\n                    <Button size=\"sm\" variant=\"ghost\" className=\"flex-shrink-0\">\r\n                      <Plus className=\"h-4 w-4\" />\r\n                    </Button>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Categorías comunes */}\r\n          {!icdSearchQuery && !isSearchingICD && icdResults.length === 0 && (\r\n            <div className=\"space-y-3\">\r\n              <h3 className=\"text-sm font-semibold text-gray-900\">Categorías Comunes</h3>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\r\n                {COMMON_CATEGORIES.map((category) => (\r\n                  <div\r\n                    key={category.name}\r\n                    className={cn(\r\n                      \"p-4 rounded-lg border cursor-pointer transition-all\",\r\n                      category.color\r\n                    )}\r\n                    onClick={() => handleCategoryClick(category.searches)}\r\n                  >\r\n                    <div className=\"flex items-center gap-3 mb-2\">\r\n                      <category.icon className=\"h-5 w-5\" />\r\n                      <h4 className=\"font-semibold text-sm\">{category.name}</h4>\r\n                    </div>\r\n                    <div className=\"flex flex-wrap gap-1\">\r\n                      {category.searches.slice(0, 3).map((search, idx) => (\r\n                        <Badge\r\n                          key={idx}\r\n                          variant=\"secondary\"\r\n                          className=\"text-xs bg-white/50\"\r\n                        >\r\n                          {search}\r\n                        </Badge>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Resultados de búsqueda */}\r\n          {isSearchingICD && (\r\n            <div className=\"flex items-center justify-center py-12\">\r\n              <div className=\"text-center\">\r\n                <Loader2 className=\"h-8 w-8 animate-spin text-blue-600 mx-auto mb-2\" />\r\n                <p className=\"text-sm text-gray-600\">Buscando en ICD-11...</p>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {!isSearchingICD && icdResults.length > 0 && (\r\n            <div className=\"space-y-3\">\r\n              <h3 className=\"text-sm font-semibold text-gray-900\">\r\n                Resultados ({icdResults.length})\r\n              </h3>\r\n              <div className=\"space-y-2\">\r\n                {icdResults.map((result, index) => (\r\n                  <div\r\n                    key={index}\r\n                    className=\"p-4 border rounded-lg hover:bg-gray-50 cursor-pointer flex items-start justify-between transition-colors group\"\r\n                    onClick={() => onAddDiagnostico(result.code, result.title)}\r\n                  >\r\n                    <div className=\"flex-1\">\r\n                      <div className=\"flex items-center gap-2 mb-1\">\r\n                        <Badge variant=\"outline\" className=\"text-xs font-mono\">\r\n                          {result.code}\r\n                        </Badge>\r\n                        {result.chapter && (\r\n                          <Badge variant=\"secondary\" className=\"text-xs\">\r\n                            {result.chapter}\r\n                          </Badge>\r\n                        )}\r\n                      </div>\r\n                      <h3 className=\"font-medium text-sm mb-1\">{result.title}</h3>\r\n                      {result.definition && (\r\n                        <p className=\"text-xs text-gray-600 line-clamp-2\">{result.definition}</p>\r\n                      )}\r\n                    </div>\r\n                    <Button \r\n                      size=\"sm\" \r\n                      variant=\"ghost\" \r\n                      className=\"flex-shrink-0 opacity-0 group-hover:opacity-100 transition-opacity\"\r\n                    >\r\n                      <Plus className=\"h-4 w-4\" />\r\n                    </Button>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {!isSearchingICD && icdSearchQuery && icdResults.length === 0 && !apiError && (\r\n            <div className=\"text-center py-12\">\r\n              <AlertCircle className=\"h-12 w-12 text-gray-400 mx-auto mb-3\" />\r\n              <p className=\"text-sm font-medium text-gray-900 mb-1\">No se encontraron resultados</p>\r\n              <p className=\"text-xs text-gray-500\">\r\n                Intenta con otros términos o usa las sugerencias de IA\r\n              </p>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </ScrollArea>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\workspace\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\workspace\\tabs-header.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\workspace\\use-ai-analysis.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\workspace\\use-autocomplete.ts","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\workspace\\use-autocomplete.ts:74:9\n  72 |       \n  73 |       if (filtered.length > 0) {\n> 74 |         setSuggestions(filtered.slice(0, 8));\n     |         ^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  75 |       } else {\n  76 |         setSuggestions([]);\n  77 |       }","line":74,"column":9,"nodeType":null,"endLine":74,"endColumn":23},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'medicalPhrases'. Either include it or remove the dependency array.","line":81,"column":6,"nodeType":"ArrayExpression","endLine":81,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [medicalPhrases, notasMedicas]","fix":{"range":[1993,2007],"text":"[medicalPhrases, notasMedicas]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\r\n\r\ninterface UseAutocompleteProps {\r\n  notasMedicas: string;\r\n}\r\n\r\nexport function useAutocomplete({ notasMedicas }: UseAutocompleteProps) {\r\n  const [suggestions, setSuggestions] = useState<string[]>([]);\r\n\r\n  const medicalPhrases = [\r\n    \"MOTIVO DE CONSULTA:\",\r\n    \"HISTORIA DE LA ENFERMEDAD ACTUAL:\",\r\n    \"ANTECEDENTES PERSONALES:\",\r\n    \"ANTECEDENTES FAMILIARES:\",\r\n    \"EXAMEN FÍSICO:\",\r\n    \"SIGNOS VITALES:\",\r\n    \"IMPRESIÓN DIAGNÓSTICA:\",\r\n    \"PLAN DE TRATAMIENTO:\",\r\n    \"INDICACIONES:\",\r\n    \"RECOMENDACIONES:\",\r\n    \"CONTROL:\",\r\n    \"EVOLUCIÓN:\",\r\n    \"LABORATORIOS:\",\r\n    \"IMÁGENES:\",\r\n    \"Estado General:\",\r\n    \"Cabeza y Cuello:\",\r\n    \"Tórax:\",\r\n    \"Abdomen:\",\r\n    \"Extremidades:\",\r\n    \"Neurológico:\",\r\n    \"Piel y Faneras:\",\r\n    \"PA: [___] mmHg\",\r\n    \"FC: [___] lpm\",\r\n    \"FR: [___] rpm\",\r\n    \"Temp: [___] °C\",\r\n    \"Sat O2: [___] %\",\r\n    \"Peso: [___] kg\",\r\n    \"Talla: [___] cm\",\r\n    \"IMC: [___]\",\r\n    \"Paciente refiere\",\r\n    \"Paciente niega\",\r\n    \"Al examen físico se evidencia\",\r\n    \"Se indica\",\r\n    \"Se prescribe\",\r\n    \"Control en\",\r\n    \"Signos de alarma:\",\r\n    \"Dieta:\",\r\n    \"Reposo:\",\r\n    \"consciente\",\r\n    \"orientado\",\r\n    \"hidratado\",\r\n    \"afebril\",\r\n    \"normotenso\",\r\n    \"taquicárdico\",\r\n    \"bradicárdico\",\r\n    \"eupneico\",\r\n    \"taquipneico\",\r\n  ];\r\n\r\n  useEffect(() => {\r\n    const lines = notasMedicas.split('\\n');\r\n    const currentLine = lines[lines.length - 1] || '';\r\n    \r\n    const words = currentLine.split(/\\s+/);\r\n    const lastWord = words[words.length - 1] || '';\r\n    \r\n    if (lastWord.length > 1) {\r\n      const filtered = medicalPhrases.filter((p) =>\r\n        p.toLowerCase().startsWith(lastWord.toLowerCase()) && \r\n        p.toLowerCase() !== lastWord.toLowerCase()\r\n      );\r\n      \r\n      if (filtered.length > 0) {\r\n        setSuggestions(filtered.slice(0, 8));\r\n      } else {\r\n        setSuggestions([]);\r\n      }\r\n    } else {\r\n      setSuggestions([]);\r\n    }\r\n  }, [notasMedicas]);\r\n\r\n  return {\r\n    suggestions,\r\n  };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\workspace\\use-historial.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1244,1247],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1244,1247],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2152,2155],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2152,2155],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\n\r\ninterface HistorialItem {\r\n  id: string;\r\n  fecha: string;\r\n  diagnostico: string;\r\n  notas: string;\r\n  doctor: string;\r\n}\r\n\r\nexport function useHistorial(cedula: string) {\r\n  const [historialClinico, setHistorialClinico] = useState<HistorialItem[]>([]);\r\n  const [selectedHistorial, setSelectedHistorial] = useState<HistorialItem | null>(null);\r\n\r\n  useEffect(() => {\r\n    const loadHistorialClinico = async () => {\r\n      try {\r\n        const { data: profileData } = await supabase\r\n          .from('profiles')\r\n          .select('id')\r\n          .eq('cedula', cedula)\r\n          .single();\r\n\r\n        if (!profileData) {\r\n          const { data: offlineData } = await supabase\r\n            .from('offline_patients')\r\n            .select('notas_medico, created_at, doctor:profiles!offline_patients_doctor_id_fkey(nombre_completo)')\r\n            .eq('cedula', cedula)\r\n            .order('created_at', { ascending: false })\r\n            .limit(10);\r\n\r\n          if (offlineData && offlineData.length > 0) {\r\n            const historial: HistorialItem[] = offlineData\r\n              .filter(item => item.notas_medico)\r\n              .map((item: any) => ({\r\n                id: crypto.randomUUID(),\r\n                fecha: item.created_at,\r\n                diagnostico: 'Consulta previa',\r\n                notas: item.notas_medico || 'Sin notas',\r\n                doctor: item.doctor?.nombre_completo || 'Desconocido',\r\n              }));\r\n            setHistorialClinico(historial);\r\n          }\r\n          return;\r\n        }\r\n\r\n        const { data: notasData } = await supabase\r\n          .from('medical_notes')\r\n          .select(`\r\n            id,\r\n            created_at,\r\n            diagnosis,\r\n            content,\r\n            doctor:profiles!medical_notes_doctor_id_fkey(nombre_completo)\r\n          `)\r\n          .eq('patient_id', profileData.id)\r\n          .order('created_at', { ascending: false })\r\n          .limit(10);\r\n\r\n        if (notasData && notasData.length > 0) {\r\n          const historial: HistorialItem[] = notasData.map((nota: any) => ({\r\n            id: nota.id,\r\n            fecha: nota.created_at,\r\n            diagnostico: nota.diagnosis || 'Sin diagnóstico',\r\n            notas: nota.content || 'Sin notas',\r\n            doctor: nota.doctor?.nombre_completo || 'Desconocido',\r\n          }));\r\n          setHistorialClinico(historial);\r\n        }\r\n      } catch (error) {\r\n        console.error('Error loading historial:', error);\r\n      }\r\n    };\r\n\r\n    if (cedula) {\r\n      loadHistorialClinico();\r\n    }\r\n  }, [cedula]);\r\n\r\n  return {\r\n    historialClinico,\r\n    selectedHistorial,\r\n    setSelectedHistorial,\r\n  };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\medico\\workspace\\workspace-header.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\paciente\\components\\appointment-summary.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Card' is defined but never used.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardContent' is defined but never used.","line":3,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { Card, CardContent } from \"@red-salud/ui\";\r\n\r\ninterface Props {\r\n  doctorName?: string;\r\n  doctorFee?: number | null;\r\n  date?: Date;\r\n  time?: string;\r\n  type: \"video\" | \"presencial\" | \"telefono\";\r\n}\r\n\r\nexport function AppointmentSummary({ doctorName, doctorFee, date, time, type }: Props) {\r\n  return (\r\n    <div className=\"p-4 bg-muted rounded-lg space-y-2\">\r\n      <h3 className=\"font-semibold mb-3\">Resumen de la Cita</h3>\r\n      <div className=\"text-sm space-y-1\">\r\n        <p><span className=\"text-muted-foreground\">Doctor:</span> {doctorName}</p>\r\n        <p><span className=\"text-muted-foreground\">Fecha:</span> {date?.toLocaleDateString(\"es-ES\")}</p>\r\n        <p><span className=\"text-muted-foreground\">Hora:</span> {time?.slice(0, 5)}</p>\r\n        <p><span className=\"text-muted-foreground\">Tipo:</span> {type === \"video\" ? \"Videollamada\" : type === \"presencial\" ? \"Presencial\" : \"Teléfono\"}</p>\r\n        {doctorFee != null && (<p className=\"font-semibold mt-2\">Total: ${doctorFee.toFixed(2)}</p>)}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\paciente\\components\\consultation-type-selector.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\paciente\\components\\date-time-picker.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\paciente\\components\\doctor-selector.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":54,"column":25,"nodeType":"JSXOpeningElement","endLine":54,"endColumn":163}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { User, MapPin, Phone, Clock } from \"lucide-react\";\r\n\r\ninterface Doctor {\r\n  id: string;\r\n  verified?: boolean;\r\n  anos_experiencia?: number;\r\n  tarifa_consulta?: number;\r\n  direccion?: string | null;\r\n  ciudad?: string | null;\r\n  estado?: string | null;\r\n  telefono?: string | null;\r\n  horario?: string | null;\r\n  biografia?: string | null;\r\n  profile?: { nombre_completo?: string; avatar_url?: string | null } | null;\r\n  specialty?: { name?: string } | null;\r\n}\r\n\r\ninterface Props {\r\n  doctors: Doctor[];\r\n  selectedDoctor: string;\r\n  selectedSpecialtyName?: string;\r\n  onSelect: (id: string) => void;\r\n  onBack: () => void;\r\n  onContinue: () => void;\r\n}\r\n\r\nexport function DoctorSelector({ doctors, selectedDoctor, selectedSpecialtyName, onSelect, onBack, onContinue }: Props) {\r\n  return (\r\n    <Card>\r\n      <CardHeader>\r\n        <CardTitle>Selecciona un Doctor</CardTitle>\r\n        <CardDescription>\r\n          {doctors.length} doctor{doctors.length !== 1 ? \"es\" : \"\"} disponible{doctors.length !== 1 ? \"s\" : \"\"}{selectedSpecialtyName ? ` en ${selectedSpecialtyName}` : \"\"}\r\n        </CardDescription>\r\n      </CardHeader>\r\n      <CardContent className=\"space-y-4\">\r\n        {doctors.length > 0 ? (\r\n          <>\r\n            <div className=\"space-y-3\">\r\n              {doctors.map((doctor) => (\r\n                <button\r\n                  key={doctor.id}\r\n                  onClick={() => onSelect(doctor.id)}\r\n                  className={`w-full p-4 border-2 rounded-lg text-left transition-all ${selectedDoctor === doctor.id ? \"border-primary bg-primary/5 shadow-md\" : \"hover:border-primary/50 hover:shadow\"}`}\r\n                >\r\n                  <div className=\"flex items-start gap-4\">\r\n                    <div className=\"h-16 w-16 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0 overflow-hidden\">\r\n                      {doctor.profile?.avatar_url ? (\r\n                        <img src={doctor.profile.avatar_url!} alt={doctor.profile?.nombre_completo || \"Doctor\"} className=\"h-16 w-16 rounded-full object-cover\" />\r\n                      ) : (\r\n                        <span className=\"text-2xl font-semibold text-primary\">{doctor.profile?.nombre_completo?.charAt(0) || \"D\"}</span>\r\n                      )}\r\n                    </div>\r\n                    <div className=\"flex-1\">\r\n                      <div className=\"flex items-start justify-between\">\r\n                        <div>\r\n                          <h3 className=\"font-semibold text-lg\">Dr. {doctor.profile?.nombre_completo || \"Médico\"}</h3>\r\n                          <p className=\"text-sm text-muted-foreground\">{doctor.specialty?.name}</p>\r\n                        </div>\r\n                        {doctor.verified && (<Badge className=\"bg-green-100 text-green-800\">Verificado</Badge>)}\r\n                      </div>\r\n                      <div className=\"mt-2 space-y-1\">\r\n                        {doctor.anos_experiencia && doctor.anos_experiencia > 0 && (<p className=\"text-sm text-gray-600\">⭐ {doctor.anos_experiencia} años de experiencia</p>)}\r\n                        {doctor.tarifa_consulta && (<p className=\"text-sm font-medium text-green-600\">💵 ${doctor.tarifa_consulta.toFixed(2)} por consulta</p>)}\r\n                        {(doctor.direccion || doctor.ciudad) && (\r\n                          <p className=\"text-sm text-gray-600 flex items-center gap-1\"><MapPin className=\"h-3 w-3\" />{doctor.ciudad && doctor.estado ? `${doctor.ciudad}, ${doctor.estado}` : doctor.direccion || doctor.ciudad || doctor.estado}</p>\r\n                        )}\r\n                        {doctor.telefono && (<p className=\"text-sm text-gray-600 flex items-center gap-1\"><Phone className=\"h-3 w-3\" />{doctor.telefono}</p>)}\r\n                        {doctor.horario && (<p className=\"text-sm text-gray-600 flex items-center gap-1\"><Clock className=\"h-3 w-3\" />Horarios disponibles</p>)}\r\n                        {doctor.biografia && (<p className=\"text-sm text-gray-600 line-clamp-2 mt-2\">{doctor.biografia}</p>)}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </button>\r\n              ))}\r\n            </div>\r\n            <div className=\"flex gap-2\">\r\n              <Button variant=\"outline\" onClick={onBack} className=\"flex-1\">Atrás</Button>\r\n              <Button onClick={onContinue} disabled={!selectedDoctor} className=\"flex-1\">Continuar</Button>\r\n            </div>\r\n          </>\r\n        ) : (\r\n          <div className=\"text-center py-12\">\r\n            <User className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\r\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">No hay médicos disponibles</h3>\r\n            <p className=\"text-gray-600 mb-4\">Aún no hay médicos verificados en esta especialidad</p>\r\n            <Button variant=\"outline\" onClick={onBack}>Elegir Otra Especialidad</Button>\r\n          </div>\r\n        )}\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\paciente\\components\\specialty-grid.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\paciente\\components\\specialty-grid.tsx:28:7\n  26 |   useEffect(() => {\n  27 |     if (!searchQuery.trim()) {\n> 28 |       setFilteredSpecialties(specialties);\n     |       ^^^^^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  29 |       return;\n  30 |     }\n  31 |     const q = searchQuery.toLowerCase();","line":28,"column":7,"nodeType":null,"endLine":28,"endColumn":29},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":81,"column":101,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[3339,3391],"text":"No se encontraron especialidades que coincidan con &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[3339,3391],"text":"No se encontraron especialidades que coincidan con &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[3339,3391],"text":"No se encontraron especialidades que coincidan con &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[3339,3391],"text":"No se encontraron especialidades que coincidan con &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":81,"column":115,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[3404,3405],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[3404,3405],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[3404,3405],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[3404,3405],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Search } from \"lucide-react\";\r\nimport { useEffect, useState } from \"react\";\r\n\r\ninterface Specialty {\r\n  id: string;\r\n  name?: string;\r\n  description?: string | null;\r\n}\r\n\r\ninterface Props {\r\n  specialties: Specialty[];\r\n  selectedSpecialty: string;\r\n  onSelected: (id: string) => void;\r\n  onContinue: () => void;\r\n}\r\n\r\nexport function SpecialtyGrid({ specialties, selectedSpecialty, onSelected, onContinue }: Props) {\r\n  const [searchQuery, setSearchQuery] = useState(\"\");\r\n  const [filteredSpecialties, setFilteredSpecialties] = useState<Specialty[]>(specialties);\r\n\r\n  useEffect(() => {\r\n    if (!searchQuery.trim()) {\r\n      setFilteredSpecialties(specialties);\r\n      return;\r\n    }\r\n    const q = searchQuery.toLowerCase();\r\n    setFilteredSpecialties(\r\n      specialties.filter((s) => (s.name?.toLowerCase().includes(q) || s.description?.toLowerCase().includes(q)))\r\n    );\r\n  }, [searchQuery, specialties]);\r\n\r\n  return (\r\n    <Card>\r\n      <CardHeader>\r\n        <CardTitle>Selecciona una Especialidad</CardTitle>\r\n        <CardDescription>Elige el tipo de consulta que necesitas</CardDescription>\r\n      </CardHeader>\r\n      <CardContent className=\"space-y-4\">\r\n        <div className=\"relative\">\r\n          <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground\" />\r\n          <Input\r\n            placeholder=\"Buscar especialidad (ej: Cardiología, Pediatría, Dermatología...)\"\r\n            value={searchQuery}\r\n            onChange={(e) => setSearchQuery(e.target.value)}\r\n            className=\"pl-10\"\r\n          />\r\n        </div>\r\n        <div className=\"flex items-center justify-between text-sm text-muted-foreground\">\r\n          <span>\r\n            {filteredSpecialties.length} especialidad{filteredSpecialties.length !== 1 ? \"es\" : \"\"} disponible{filteredSpecialties.length !== 1 ? \"s\" : \"\"}\r\n          </span>\r\n          {searchQuery && (\r\n            <Button variant=\"ghost\" size=\"sm\" onClick={() => setSearchQuery(\"\")} className=\"h-auto p-0 text-primary hover:text-primary/80\">\r\n              Limpiar búsqueda\r\n            </Button>\r\n          )}\r\n        </div>\r\n        {filteredSpecialties.length > 0 ? (\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3\">\r\n            {filteredSpecialties.slice(0, 12).map((specialty) => (\r\n              <button\r\n                key={specialty.id}\r\n                onClick={() => onSelected(specialty.id)}\r\n                className={`p-4 border rounded-lg text-left transition-colors ${selectedSpecialty === specialty.id ? \"border-primary bg-primary/5\" : \"hover:border-primary/50\"}`}\r\n              >\r\n                <h3 className=\"font-semibold text-sm\">{specialty.name}</h3>\r\n                {specialty.description && (\r\n                  <p className=\"text-xs text-muted-foreground mt-1 line-clamp-2\">{specialty.description}</p>\r\n                )}\r\n              </button>\r\n            ))}\r\n          </div>\r\n        ) : (\r\n          <div className=\"text-center py-12\">\r\n            <Search className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\r\n            <p className=\"text-muted-foreground\">No se encontraron especialidades que coincidan con \"{searchQuery}\"</p>\r\n            <Button variant=\"outline\" onClick={() => setSearchQuery(\"\")} className=\"mt-4\">Ver todas las especialidades</Button>\r\n          </div>\r\n        )}\r\n        <Button onClick={onContinue} disabled={!selectedSpecialty} className=\"w-full\">Continuar</Button>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\paciente\\module-placeholder.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\paciente\\telemedicina\\session\\chat-panel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\paciente\\telemedicina\\session\\info-card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\paciente\\telemedicina\\session\\notes-panel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\paciente\\telemedicina\\session\\participants-panel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\paciente\\telemedicina\\session\\session-header.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\paciente\\telemedicina\\session\\video-panel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\secretaria\\doctor-selector.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\components\\cedula-photo-upload.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[343,346],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[343,346],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1058,1061],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1058,1061],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":134,"column":17,"nodeType":"JSXOpeningElement","endLine":138,"endColumn":19},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":183,"column":17,"nodeType":"JSXOpeningElement","endLine":187,"endColumn":19}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { Upload, CheckCircle, AlertCircle, Loader2, Camera } from \"lucide-react\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Label } from \"@red-salud/ui\";\r\n\r\ninterface CedulaPhotoUploadProps {\r\n  expectedCedula?: string;\r\n  expectedNombre?: string;\r\n  onVerificationComplete: (data: any) => void;\r\n}\r\n\r\nexport function CedulaPhotoUpload({\r\n  expectedCedula,\r\n  expectedNombre,\r\n  onVerificationComplete,\r\n}: CedulaPhotoUploadProps) {\r\n  const [frontImage, setFrontImage] = useState<File | null>(null);\r\n  const [backImage, setBackImage] = useState<File | null>(null);\r\n  const [frontPreview, setFrontPreview] = useState<string>(\"\");\r\n  const [backPreview, setBackPreview] = useState<string>(\"\");\r\n  const [isVerifying, setIsVerifying] = useState(false);\r\n  const [verificationStatus, setVerificationStatus] = useState<\r\n    \"idle\" | \"success\" | \"error\"\r\n  >(\"idle\");\r\n  const [verificationMessage, setVerificationMessage] = useState(\"\");\r\n  const [verificationData, setVerificationData] = useState<any>(null);\r\n\r\n  const handleFrontImageChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (file) {\r\n      setFrontImage(file);\r\n      const reader = new FileReader();\r\n      reader.onloadend = () => {\r\n        setFrontPreview(reader.result as string);\r\n      };\r\n      reader.readAsDataURL(file);\r\n      setVerificationStatus(\"idle\");\r\n    }\r\n  };\r\n\r\n  const handleBackImageChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (file) {\r\n      setBackImage(file);\r\n      const reader = new FileReader();\r\n      reader.onloadend = () => {\r\n        setBackPreview(reader.result as string);\r\n      };\r\n      reader.readAsDataURL(file);\r\n    }\r\n  };\r\n\r\n  const handleVerify = async () => {\r\n    if (!frontImage) {\r\n      setVerificationStatus(\"error\");\r\n      setVerificationMessage(\"Por favor sube la imagen frontal de tu cédula\");\r\n      return;\r\n    }\r\n\r\n    setIsVerifying(true);\r\n    setVerificationStatus(\"idle\");\r\n    setVerificationMessage(\"\");\r\n\r\n    try {\r\n      const formData = new FormData();\r\n      formData.append(\"front_image\", frontImage);\r\n      if (backImage) {\r\n        formData.append(\"back_image\", backImage);\r\n      }\r\n      if (expectedCedula) {\r\n        formData.append(\"expected_cedula\", expectedCedula);\r\n      }\r\n      if (expectedNombre) {\r\n        formData.append(\"expected_nombre\", expectedNombre);\r\n      }\r\n\r\n      const response = await fetch(\"/api/verify-cedula-photo\", {\r\n        method: \"POST\",\r\n        body: formData,\r\n      });\r\n\r\n      const result = await response.json();\r\n\r\n      if (result.error) {\r\n        setVerificationStatus(\"error\");\r\n        setVerificationMessage(result.message || \"Error al verificar la cédula\");\r\n        return;\r\n      }\r\n\r\n      if (result.verified) {\r\n        setVerificationStatus(\"success\");\r\n        setVerificationMessage(result.message);\r\n        setVerificationData(result);\r\n        onVerificationComplete(result);\r\n      } else {\r\n        setVerificationStatus(\"error\");\r\n        setVerificationMessage(\r\n          result.validations?.warnings?.join(\". \") || result.message\r\n        );\r\n        setVerificationData(result);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error verifying cedula:\", error);\r\n      setVerificationStatus(\"error\");\r\n      setVerificationMessage(\"Error al conectar con el servicio de verificación\");\r\n    } finally {\r\n      setIsVerifying(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\r\n        <h3 className=\"font-semibold text-blue-900 mb-2\">\r\n          📸 Verificación de Cédula con Foto\r\n        </h3>\r\n        <p className=\"text-sm text-blue-800\">\r\n          Sube una foto clara de tu cédula para verificar tu identidad. Los datos\r\n          de la foto deben coincidir con la cédula que ingresaste.\r\n        </p>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n        {/* Imagen Frontal */}\r\n        <div>\r\n          <Label htmlFor=\"front-image\" className=\"mb-2 block\">\r\n            Foto Frontal de la Cédula *\r\n          </Label>\r\n          <div className=\"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-500 transition-colors\">\r\n            {frontPreview ? (\r\n              <div className=\"space-y-4\">\r\n                <img\r\n                  src={frontPreview}\r\n                  alt=\"Vista previa frontal\"\r\n                  className=\"max-h-48 mx-auto rounded\"\r\n                />\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"outline\"\r\n                  size=\"sm\"\r\n                  onClick={() => {\r\n                    setFrontImage(null);\r\n                    setFrontPreview(\"\");\r\n                  }}\r\n                >\r\n                  Cambiar imagen\r\n                </Button>\r\n              </div>\r\n            ) : (\r\n              <label\r\n                htmlFor=\"front-image\"\r\n                className=\"cursor-pointer flex flex-col items-center\"\r\n              >\r\n                <Camera className=\"h-12 w-12 text-gray-400 mb-2\" />\r\n                <span className=\"text-sm text-gray-600\">\r\n                  Haz clic para subir la foto frontal\r\n                </span>\r\n                <span className=\"text-xs text-gray-500 mt-1\">\r\n                  PNG, JPG hasta 10MB\r\n                </span>\r\n              </label>\r\n            )}\r\n            <input\r\n              id=\"front-image\"\r\n              type=\"file\"\r\n              accept=\"image/*\"\r\n              onChange={handleFrontImageChange}\r\n              className=\"hidden\"\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Imagen Trasera (Opcional) */}\r\n        <div>\r\n          <Label htmlFor=\"back-image\" className=\"mb-2 block\">\r\n            Foto Trasera de la Cédula (Opcional)\r\n          </Label>\r\n          <div className=\"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-500 transition-colors\">\r\n            {backPreview ? (\r\n              <div className=\"space-y-4\">\r\n                <img\r\n                  src={backPreview}\r\n                  alt=\"Vista previa trasera\"\r\n                  className=\"max-h-48 mx-auto rounded\"\r\n                />\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"outline\"\r\n                  size=\"sm\"\r\n                  onClick={() => {\r\n                    setBackImage(null);\r\n                    setBackPreview(\"\");\r\n                  }}\r\n                >\r\n                  Cambiar imagen\r\n                </Button>\r\n              </div>\r\n            ) : (\r\n              <label\r\n                htmlFor=\"back-image\"\r\n                className=\"cursor-pointer flex flex-col items-center\"\r\n              >\r\n                <Camera className=\"h-12 w-12 text-gray-400 mb-2\" />\r\n                <span className=\"text-sm text-gray-600\">\r\n                  Haz clic para subir la foto trasera\r\n                </span>\r\n                <span className=\"text-xs text-gray-500 mt-1\">\r\n                  PNG, JPG hasta 10MB\r\n                </span>\r\n              </label>\r\n            )}\r\n            <input\r\n              id=\"back-image\"\r\n              type=\"file\"\r\n              accept=\"image/*\"\r\n              onChange={handleBackImageChange}\r\n              className=\"hidden\"\r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Botón de Verificación */}\r\n      <div className=\"flex justify-center\">\r\n        <Button\r\n          onClick={handleVerify}\r\n          disabled={!frontImage || isVerifying}\r\n          className=\"min-w-[200px]\"\r\n        >\r\n          {isVerifying ? (\r\n            <>\r\n              <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\r\n              Verificando...\r\n            </>\r\n          ) : (\r\n            <>\r\n              <Upload className=\"h-4 w-4 mr-2\" />\r\n              Verificar Cédula\r\n            </>\r\n          )}\r\n        </Button>\r\n      </div>\r\n\r\n      {/* Resultado de la Verificación */}\r\n      {verificationStatus !== \"idle\" && (\r\n        <div\r\n          className={`rounded-lg p-4 ${\r\n            verificationStatus === \"success\"\r\n              ? \"bg-green-50 border border-green-200\"\r\n              : \"bg-red-50 border border-red-200\"\r\n          }`}\r\n        >\r\n          <div className=\"flex items-start gap-3\">\r\n            {verificationStatus === \"success\" ? (\r\n              <CheckCircle className=\"h-5 w-5 text-green-600 mt-0.5\" />\r\n            ) : (\r\n              <AlertCircle className=\"h-5 w-5 text-red-600 mt-0.5\" />\r\n            )}\r\n            <div className=\"flex-1\">\r\n              <p\r\n                className={`font-semibold ${\r\n                  verificationStatus === \"success\"\r\n                    ? \"text-green-900\"\r\n                    : \"text-red-900\"\r\n                }`}\r\n              >\r\n                {verificationStatus === \"success\"\r\n                  ? \"✅ Verificación Exitosa\"\r\n                  : \"❌ Verificación Fallida\"}\r\n              </p>\r\n              <p\r\n                className={`text-sm mt-1 ${\r\n                  verificationStatus === \"success\"\r\n                    ? \"text-green-800\"\r\n                    : \"text-red-800\"\r\n                }`}\r\n              >\r\n                {verificationMessage}\r\n              </p>\r\n              {verificationData && verificationData.extractedData && (\r\n                <div className=\"mt-3 text-sm\">\r\n                  <p className=\"font-semibold mb-1\">Datos extraídos:</p>\r\n                  <ul className=\"space-y-1 text-gray-700\">\r\n                    <li>\r\n                      <strong>Cédula:</strong>{\" \"}\r\n                      {verificationData.extractedData.documentNumber}\r\n                    </li>\r\n                    <li>\r\n                      <strong>Nombre:</strong>{\" \"}\r\n                      {verificationData.extractedData.fullName}\r\n                    </li>\r\n                    {verificationData.extractedData.dateOfBirth && (\r\n                      <li>\r\n                        <strong>Fecha de Nacimiento:</strong>{\" \"}\r\n                        {verificationData.extractedData.dateOfBirth}\r\n                      </li>\r\n                    )}\r\n                  </ul>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\components\\emergency-contact-card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\components\\emergency-contact-modal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\components\\medical-chip-input.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\components\\medical-chip-input.tsx:38:7\n  36 |         s.toLowerCase().includes(inputValue.toLowerCase())\n  37 |       );\n> 38 |       setFilteredSuggestions(filtered);\n     |       ^^^^^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  39 |       setShowSuggestions(filtered.length > 0);\n  40 |     } else {\n  41 |       setFilteredSuggestions([]);","line":38,"column":7,"nodeType":null,"endLine":38,"endColumn":29}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useRef, useEffect } from \"react\";\r\nimport { X, ChevronLeft, ChevronRight, Plus } from \"lucide-react\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Input } from \"@red-salud/ui\";\r\n\r\ninterface MedicalChipInputProps {\r\n  value: string[];\r\n  onChange: (value: string[]) => void;\r\n  suggestions: string[];\r\n  placeholder: string;\r\n  maxLength?: number;\r\n  disabled?: boolean;\r\n  template?: string;\r\n}\r\n\r\nexport function MedicalChipInput({\r\n  value,\r\n  onChange,\r\n  suggestions,\r\n  placeholder,\r\n  maxLength = 50,\r\n  disabled = false,\r\n  template,\r\n}: MedicalChipInputProps) {\r\n  const [inputValue, setInputValue] = useState(\"\");\r\n  const [showSuggestions, setShowSuggestions] = useState(false);\r\n  const [filteredSuggestions, setFilteredSuggestions] = useState<string[]>([]);\r\n  const scrollRef = useRef<HTMLDivElement>(null);\r\n  const inputRef = useRef<HTMLInputElement>(null);\r\n\r\n  useEffect(() => {\r\n    if (inputValue.trim()) {\r\n      const filtered = suggestions.filter((s) =>\r\n        s.toLowerCase().includes(inputValue.toLowerCase())\r\n      );\r\n      setFilteredSuggestions(filtered);\r\n      setShowSuggestions(filtered.length > 0);\r\n    } else {\r\n      setFilteredSuggestions([]);\r\n      setShowSuggestions(false);\r\n    }\r\n  }, [inputValue, suggestions]);\r\n\r\n  const handleAdd = (item: string) => {\r\n    const trimmed = item.trim();\r\n    if (trimmed && !value.includes(trimmed)) {\r\n      onChange([...value, trimmed]);\r\n      setInputValue(\"\");\r\n      setShowSuggestions(false);\r\n    }\r\n  };\r\n\r\n  const handleRemove = (index: number) => {\r\n    onChange(value.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const handleKeyDown = (e: React.KeyboardEvent) => {\r\n    if (e.key === \"Enter\" && inputValue.trim()) {\r\n      e.preventDefault();\r\n      handleAdd(inputValue);\r\n    }\r\n  };\r\n\r\n  const scroll = (direction: \"left\" | \"right\") => {\r\n    if (scrollRef.current) {\r\n      const scrollAmount = 200;\r\n      scrollRef.current.scrollBy({\r\n        left: direction === \"left\" ? -scrollAmount : scrollAmount,\r\n        behavior: \"smooth\",\r\n      });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-2\">\r\n      {/* Input con sugerencias */}\r\n      <div className=\"relative\">\r\n        <div className=\"flex gap-2\">\r\n          <Input\r\n            ref={inputRef}\r\n            value={inputValue}\r\n            onChange={(e) => setInputValue(e.target.value)}\r\n            onKeyDown={handleKeyDown}\r\n            placeholder={placeholder}\r\n            maxLength={maxLength}\r\n            disabled={disabled}\r\n            className=\"flex-1\"\r\n          />\r\n          <Button\r\n            type=\"button\"\r\n            onClick={() => handleAdd(inputValue)}\r\n            disabled={!inputValue.trim() || disabled}\r\n            size=\"sm\"\r\n            variant=\"outline\"\r\n          >\r\n            <Plus className=\"h-4 w-4\" />\r\n          </Button>\r\n        </div>\r\n\r\n        {/* Template hint */}\r\n        {template && !inputValue && (\r\n          <p className=\"text-xs text-gray-500 mt-1\">\r\n            Formato: {template}\r\n          </p>\r\n        )}\r\n\r\n        {/* Sugerencias */}\r\n        {showSuggestions && (\r\n          <div className=\"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-48 overflow-y-auto\">\r\n            {filteredSuggestions.map((suggestion, idx) => (\r\n              <button\r\n                key={idx}\r\n                type=\"button\"\r\n                onClick={() => handleAdd(suggestion)}\r\n                className=\"w-full px-3 py-2 text-left text-sm hover:bg-blue-50 focus:bg-blue-50 focus:outline-none\"\r\n              >\r\n                {suggestion}\r\n              </button>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Chips horizontales con scroll */}\r\n      {value.length > 0 && (\r\n        <div className=\"relative\">\r\n          <div className=\"flex items-center gap-2\">\r\n            {value.length > 3 && (\r\n              <Button\r\n                type=\"button\"\r\n                onClick={() => scroll(\"left\")}\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                className=\"flex-shrink-0 h-8 w-8 p-0\"\r\n              >\r\n                <ChevronLeft className=\"h-4 w-4\" />\r\n              </Button>\r\n            )}\r\n\r\n            <div\r\n              ref={scrollRef}\r\n              className=\"flex gap-2 overflow-x-auto scrollbar-hide flex-1\"\r\n              style={{ scrollbarWidth: \"none\", msOverflowStyle: \"none\" }}\r\n            >\r\n              {value.map((item, idx) => (\r\n                <div\r\n                  key={idx}\r\n                  className=\"flex items-center gap-1 bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm whitespace-nowrap flex-shrink-0\"\r\n                >\r\n                  <span>{item}</span>\r\n                  {!disabled && (\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={() => handleRemove(idx)}\r\n                      className=\"hover:bg-blue-200 rounded-full p-0.5\"\r\n                    >\r\n                      <X className=\"h-3 w-3\" />\r\n                    </button>\r\n                  )}\r\n                </div>\r\n              ))}\r\n            </div>\r\n\r\n            {value.length > 3 && (\r\n              <Button\r\n                type=\"button\"\r\n                onClick={() => scroll(\"right\")}\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                className=\"flex-shrink-0 h-8 w-8 p-0\"\r\n              >\r\n                <ChevronRight className=\"h-4 w-4\" />\r\n              </Button>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\components\\medication-input-improved.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\components\\medication-input-improved.tsx:45:7\n  43 |     if (nombreInput.trim()) {\n  44 |       const filtered = buscarMedicamento(nombreInput);\n> 45 |       setFilteredMeds(filtered);\n     |       ^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  46 |       setShowSuggestions(filtered.length > 0);\n  47 |     } else {\n  48 |       setFilteredMeds([]);","line":45,"column":7,"nodeType":null,"endLine":45,"endColumn":22},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":211,"column":22,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[6978,7002],"text":"\r\n                Usar &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[6978,7002],"text":"\r\n                Usar &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[6978,7002],"text":"\r\n                Usar &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[6978,7002],"text":"\r\n                Usar &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":211,"column":36,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[7015,7054],"text":"&quot; (no está en la lista)\r\n              "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[7015,7054],"text":"&ldquo; (no está en la lista)\r\n              "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[7015,7054],"text":"&#34; (no está en la lista)\r\n              "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[7015,7054],"text":"&rdquo; (no está en la lista)\r\n              "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect, useRef } from \"react\";\r\nimport { X, Pill } from \"lucide-react\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { Label } from \"@red-salud/ui\";\r\nimport {\r\n  MEDICAMENTOS_COMUNES,\r\n  FRECUENCIAS_COMUNES,\r\n  buscarMedicamento,\r\n  obtenerDosisComunes,\r\n  obtenerFrecuenciasComunes,\r\n} from \"../constants/medication-database\";\r\n\r\nexport interface Medication {\r\n  nombre: string;\r\n  dosis: string;\r\n  frecuencia: string;\r\n}\r\n\r\ninterface MedicationInputImprovedProps {\r\n  value: Medication[];\r\n  onChange: (value: Medication[]) => void;\r\n  disabled?: boolean;\r\n}\r\n\r\nexport function MedicationInputImproved({\r\n  value,\r\n  onChange,\r\n  disabled = false,\r\n}: MedicationInputImprovedProps) {\r\n  const [step, setStep] = useState<\"nombre\" | \"dosis\" | \"frecuencia\" | \"lista\">(\"lista\");\r\n  const [nombreInput, setNombreInput] = useState(\"\");\r\n  const [showSuggestions, setShowSuggestions] = useState(false);\r\n  const [filteredMeds, setFilteredMeds] = useState(MEDICAMENTOS_COMUNES);\r\n  const [selectedMed, setSelectedMed] = useState<string>(\"\");\r\n  const [selectedDosis, setSelectedDosis] = useState<string>(\"\");\r\n  const [dosisDisponibles, setDosisDisponibles] = useState<string[]>([]);\r\n  const [frecuenciasDisponibles, setFrecuenciasDisponibles] = useState<string[]>(FRECUENCIAS_COMUNES);\r\n  const inputRef = useRef<HTMLInputElement>(null);\r\n\r\n  useEffect(() => {\r\n    if (nombreInput.trim()) {\r\n      const filtered = buscarMedicamento(nombreInput);\r\n      setFilteredMeds(filtered);\r\n      setShowSuggestions(filtered.length > 0);\r\n    } else {\r\n      setFilteredMeds([]);\r\n      setShowSuggestions(false);\r\n    }\r\n  }, [nombreInput]);\r\n\r\n  const handleSelectNombre = (nombre: string) => {\r\n    setSelectedMed(nombre);\r\n    setNombreInput(\"\");\r\n    setShowSuggestions(false);\r\n    \r\n    // Obtener dosis y frecuencias para este medicamento\r\n    const dosis = obtenerDosisComunes(nombre);\r\n    const frecuencias = obtenerFrecuenciasComunes(nombre);\r\n    \r\n    setDosisDisponibles(dosis);\r\n    setFrecuenciasDisponibles(frecuencias);\r\n    setStep(\"dosis\");\r\n  };\r\n\r\n  const handleSelectDosis = (dosis: string) => {\r\n    setSelectedDosis(dosis);\r\n    setStep(\"frecuencia\");\r\n  };\r\n\r\n  const handleSelectFrecuencia = (frecuencia: string) => {\r\n    // Agregar medicamento completo\r\n    const newMed: Medication = {\r\n      nombre: selectedMed,\r\n      dosis: selectedDosis,\r\n      frecuencia: frecuencia,\r\n    };\r\n    \r\n    onChange([...value, newMed]);\r\n    \r\n    // Reset\r\n    setStep(\"lista\");\r\n    setSelectedMed(\"\");\r\n    setSelectedDosis(\"\");\r\n    setNombreInput(\"\");\r\n  };\r\n\r\n  const handleRemove = (index: number) => {\r\n    onChange(value.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const handleCancel = () => {\r\n    setStep(\"lista\");\r\n    setSelectedMed(\"\");\r\n    setSelectedDosis(\"\");\r\n    setNombreInput(\"\");\r\n    setShowSuggestions(false);\r\n  };\r\n\r\n  const handleCustomNombre = () => {\r\n    if (nombreInput.trim()) {\r\n      setSelectedMed(nombreInput.trim());\r\n      setNombreInput(\"\");\r\n      setShowSuggestions(false);\r\n      setDosisDisponibles([]);\r\n      setFrecuenciasDisponibles(FRECUENCIAS_COMUNES);\r\n      setStep(\"dosis\");\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-3\">\r\n      {/* Lista de medicamentos */}\r\n      {step === \"lista\" && (\r\n        <>\r\n          {value.length > 0 && (\r\n            <div className=\"space-y-2 mb-3\">\r\n              {value.map((med, idx) => (\r\n                <div\r\n                  key={idx}\r\n                  className=\"flex items-start gap-3 p-2.5 bg-purple-50 border border-purple-200 rounded-lg\"\r\n                >\r\n                  <Pill className=\"h-4 w-4 text-purple-600 mt-0.5 flex-shrink-0\" />\r\n                  <div className=\"flex-1 min-w-0\">\r\n                    <p className=\"font-medium text-sm text-gray-900\">{med.nombre}</p>\r\n                    <p className=\"text-xs text-gray-600\">\r\n                      {med.dosis} • {med.frecuencia}\r\n                    </p>\r\n                  </div>\r\n                  {!disabled && (\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={() => handleRemove(idx)}\r\n                      className=\"text-red-600 hover:text-red-800 flex-shrink-0\"\r\n                    >\r\n                      <X className=\"h-3.5 w-3.5\" />\r\n                    </button>\r\n                  )}\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n\r\n          {!disabled && (\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => setStep(\"nombre\")}\r\n              className=\"w-full px-3 py-2 border-2 border-dashed border-gray-300 rounded-lg text-sm text-gray-600 hover:border-purple-400 hover:text-purple-600 transition-colors\"\r\n            >\r\n              + Agregar Medicamento\r\n            </button>\r\n          )}\r\n\r\n          {value.length === 0 && disabled && (\r\n            <p className=\"text-sm text-gray-500 italic\">\r\n              No hay medicamentos registrados\r\n            </p>\r\n          )}\r\n        </>\r\n      )}\r\n\r\n      {/* Paso 1: Seleccionar Nombre */}\r\n      {step === \"nombre\" && (\r\n        <div className=\"border-2 border-purple-300 rounded-lg p-4 bg-purple-50/50\">\r\n          <div className=\"flex items-center justify-between mb-3\">\r\n            <Label className=\"text-sm font-semibold text-purple-900\">\r\n              1. Nombre del Medicamento\r\n            </Label>\r\n            <button\r\n              type=\"button\"\r\n              onClick={handleCancel}\r\n              className=\"text-gray-500 hover:text-gray-700\"\r\n            >\r\n              <X className=\"h-4 w-4\" />\r\n            </button>\r\n          </div>\r\n\r\n          <div className=\"relative\">\r\n            <Input\r\n              ref={inputRef}\r\n              value={nombreInput}\r\n              onChange={(e) => setNombreInput(e.target.value)}\r\n              onFocus={() => setShowSuggestions(true)}\r\n              placeholder=\"Escribe el nombre del medicamento...\"\r\n              className=\"mb-2\"\r\n              autoFocus\r\n            />\r\n\r\n            {showSuggestions && filteredMeds.length > 0 && (\r\n              <div className=\"absolute z-10 w-full bg-white border border-gray-300 rounded-md shadow-lg max-h-48 overflow-y-auto\">\r\n                {filteredMeds.slice(0, 10).map((med, idx) => (\r\n                  <button\r\n                    key={idx}\r\n                    type=\"button\"\r\n                    onClick={() => handleSelectNombre(med.nombre)}\r\n                    className=\"w-full px-3 py-2 text-left text-sm hover:bg-purple-50 focus:bg-purple-50 focus:outline-none\"\r\n                  >\r\n                    {med.nombre}\r\n                  </button>\r\n                ))}\r\n              </div>\r\n            )}\r\n\r\n            {nombreInput.trim() && (\r\n              <button\r\n                type=\"button\"\r\n                onClick={handleCustomNombre}\r\n                className=\"text-xs text-purple-600 hover:text-purple-800 underline\"\r\n              >\r\n                Usar \"{nombreInput}\" (no está en la lista)\r\n              </button>\r\n            )}\r\n          </div>\r\n\r\n          <p className=\"text-xs text-gray-500 mt-2\">\r\n            Escribe para buscar o selecciona de la lista\r\n          </p>\r\n        </div>\r\n      )}\r\n\r\n      {/* Paso 2: Seleccionar Dosis */}\r\n      {step === \"dosis\" && (\r\n        <div className=\"border-2 border-purple-300 rounded-lg p-4 bg-purple-50/50\">\r\n          <div className=\"flex items-center justify-between mb-3\">\r\n            <div>\r\n              <Label className=\"text-sm font-semibold text-purple-900\">\r\n                2. Dosis de {selectedMed}\r\n              </Label>\r\n              <p className=\"text-xs text-gray-600 mt-0.5\">\r\n                Selecciona la dosis o escribe una personalizada\r\n              </p>\r\n            </div>\r\n            <button\r\n              type=\"button\"\r\n              onClick={handleCancel}\r\n              className=\"text-gray-500 hover:text-gray-700\"\r\n            >\r\n              <X className=\"h-4 w-4\" />\r\n            </button>\r\n          </div>\r\n\r\n          {dosisDisponibles.length > 0 ? (\r\n            <div className=\"grid grid-cols-4 gap-2 mb-3\">\r\n              {dosisDisponibles.map((dosis, idx) => (\r\n                <button\r\n                  key={idx}\r\n                  type=\"button\"\r\n                  onClick={() => handleSelectDosis(dosis)}\r\n                  className=\"px-3 py-2 text-sm border-2 border-purple-300 rounded-md hover:border-purple-600 hover:bg-purple-100 transition-all font-medium text-gray-700 hover:text-purple-900\"\r\n                >\r\n                  {dosis}\r\n                </button>\r\n              ))}\r\n            </div>\r\n          ) : null}\r\n\r\n          <div className=\"relative\">\r\n            <Input\r\n              placeholder=\"O escribe la dosis (ej: 50mg)\"\r\n              onKeyDown={(e) => {\r\n                if (e.key === \"Enter\" && e.currentTarget.value.trim()) {\r\n                  handleSelectDosis(e.currentTarget.value.trim());\r\n                }\r\n              }}\r\n              className=\"text-sm\"\r\n            />\r\n            <p className=\"text-xs text-gray-500 mt-1\">\r\n              Presiona Enter para continuar\r\n            </p>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Paso 3: Seleccionar Frecuencia */}\r\n      {step === \"frecuencia\" && (\r\n        <div className=\"border-2 border-purple-300 rounded-lg p-4 bg-purple-50/50\">\r\n          <div className=\"flex items-center justify-between mb-3\">\r\n            <div>\r\n              <Label className=\"text-sm font-semibold text-purple-900\">\r\n                3. Frecuencia\r\n              </Label>\r\n              <p className=\"text-xs text-gray-600 mt-0.5\">\r\n                {selectedMed} {selectedDosis}\r\n              </p>\r\n            </div>\r\n            <button\r\n              type=\"button\"\r\n              onClick={handleCancel}\r\n              className=\"text-gray-500 hover:text-gray-700\"\r\n            >\r\n              <X className=\"h-4 w-4\" />\r\n            </button>\r\n          </div>\r\n\r\n          <div className=\"grid grid-cols-2 gap-2\">\r\n            {frecuenciasDisponibles.map((freq, idx) => (\r\n              <button\r\n                key={idx}\r\n                type=\"button\"\r\n                onClick={() => handleSelectFrecuencia(freq)}\r\n                className=\"px-3 py-2 text-sm border-2 border-purple-300 rounded-md hover:border-purple-600 hover:bg-purple-100 transition-all font-medium text-gray-700 hover:text-purple-900 text-left\"\r\n              >\r\n                {freq}\r\n              </button>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\components\\medication-input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\components\\modal-header.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\components\\security\\active-sessions-modal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\components\\security\\change-password-modal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userEmail' is defined but never used.","line":13,"column":56,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":65},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":76,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":76,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport { X, Eye, EyeOff, Lock, Loader2, Check, AlertCircle } from \"lucide-react\";\r\n\r\ninterface ChangePasswordModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  userEmail: string;\r\n}\r\n\r\nexport function ChangePasswordModal({ isOpen, onClose, userEmail }: ChangePasswordModalProps) {\r\n  const [currentPassword, setCurrentPassword] = useState(\"\");\r\n  const [newPassword, setNewPassword] = useState(\"\");\r\n  const [confirmPassword, setConfirmPassword] = useState(\"\");\r\n  const [showCurrent, setShowCurrent] = useState(false);\r\n  const [showNew, setShowNew] = useState(false);\r\n  const [showConfirm, setShowConfirm] = useState(false);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n  const [success, setSuccess] = useState(false);\r\n\r\n  const passwordStrength = (password: string) => {\r\n    let strength = 0;\r\n    if (password.length >= 8) strength++;\r\n    if (password.length >= 12) strength++;\r\n    if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;\r\n    if (/\\d/.test(password)) strength++;\r\n    if (/[^a-zA-Z\\d]/.test(password)) strength++;\r\n    return strength;\r\n  };\r\n\r\n  const strength = passwordStrength(newPassword);\r\n  const strengthLabels = [\"Muy débil\", \"Débil\", \"Regular\", \"Buena\", \"Fuerte\", \"Muy fuerte\"];\r\n  const strengthColors = [\"bg-red-500\", \"bg-orange-500\", \"bg-yellow-500\", \"bg-lime-500\", \"bg-green-500\", \"bg-emerald-500\"];\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setError(\"\");\r\n\r\n    if (newPassword !== confirmPassword) {\r\n      setError(\"Las contraseñas no coinciden\");\r\n      return;\r\n    }\r\n\r\n    if (newPassword.length < 8) {\r\n      setError(\"La contraseña debe tener al menos 8 caracteres\");\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n\r\n    try {\r\n      const response = await fetch(\"/api/security/change-password\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ currentPassword, newPassword }),\r\n      });\r\n\r\n      const data = await response.json();\r\n\r\n      if (!data.success) {\r\n        setError(data.message || \"Error al cambiar la contraseña\");\r\n        return;\r\n      }\r\n\r\n      setSuccess(true);\r\n      setTimeout(() => {\r\n        onClose();\r\n        setCurrentPassword(\"\");\r\n        setNewPassword(\"\");\r\n        setConfirmPassword(\"\");\r\n        setSuccess(false);\r\n      }, 2000);\r\n    } catch (error) {\r\n      setError(\"Error al conectar con el servidor\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <AnimatePresence>\r\n      {isOpen && (\r\n        <>\r\n          <motion.div\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            exit={{ opacity: 0 }}\r\n            onClick={onClose}\r\n            className=\"fixed inset-0 bg-black/50 z-[200]\"\r\n          />\r\n          <motion.div\r\n            initial={{ opacity: 0, scale: 0.95, y: 20 }}\r\n            animate={{ opacity: 1, scale: 1, y: 0 }}\r\n            exit={{ opacity: 0, scale: 0.95, y: 20 }}\r\n            className=\"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md bg-white rounded-xl shadow-2xl z-[201] p-6\"\r\n          >\r\n            <div className=\"flex items-center justify-between mb-6\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"p-2 bg-blue-100 rounded-lg\">\r\n                  <Lock className=\"h-5 w-5 text-blue-600\" />\r\n                </div>\r\n                <h3 className=\"text-lg font-semibold text-gray-900\">\r\n                  Cambiar Contraseña\r\n                </h3>\r\n              </div>\r\n              <button\r\n                onClick={onClose}\r\n                className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\r\n              >\r\n                <X className=\"h-5 w-5 text-gray-500\" />\r\n              </button>\r\n            </div>\r\n\r\n            {success ? (\r\n              <div className=\"flex flex-col items-center justify-center py-8\">\r\n                <div className=\"p-3 bg-green-100 rounded-full mb-4\">\r\n                  <Check className=\"h-8 w-8 text-green-600\" />\r\n                </div>\r\n                <p className=\"text-lg font-medium text-gray-900 mb-2\">\r\n                  ¡Contraseña actualizada!\r\n                </p>\r\n                <p className=\"text-sm text-gray-500 text-center\">\r\n                  Tu contraseña ha sido cambiada exitosamente\r\n                </p>\r\n              </div>\r\n            ) : (\r\n              <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n                {error && (\r\n                  <div className=\"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-lg\">\r\n                    <AlertCircle className=\"h-5 w-5 text-red-600 flex-shrink-0\" />\r\n                    <p className=\"text-sm text-red-700\">{error}</p>\r\n                  </div>\r\n                )}\r\n\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                    Contraseña Actual\r\n                  </label>\r\n                  <div className=\"relative\">\r\n                    <input\r\n                      type={showCurrent ? \"text\" : \"password\"}\r\n                      value={currentPassword}\r\n                      onChange={(e) => setCurrentPassword(e.target.value)}\r\n                      className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent pr-10\"\r\n                      required\r\n                    />\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={() => setShowCurrent(!showCurrent)}\r\n                      className=\"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600\"\r\n                    >\r\n                      {showCurrent ? <EyeOff className=\"h-5 w-5\" /> : <Eye className=\"h-5 w-5\" />}\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                    Nueva Contraseña\r\n                  </label>\r\n                  <div className=\"relative\">\r\n                    <input\r\n                      type={showNew ? \"text\" : \"password\"}\r\n                      value={newPassword}\r\n                      onChange={(e) => setNewPassword(e.target.value)}\r\n                      className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent pr-10\"\r\n                      required\r\n                    />\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={() => setShowNew(!showNew)}\r\n                      className=\"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600\"\r\n                    >\r\n                      {showNew ? <EyeOff className=\"h-5 w-5\" /> : <Eye className=\"h-5 w-5\" />}\r\n                    </button>\r\n                  </div>\r\n                  {newPassword && (\r\n                    <div className=\"mt-2\">\r\n                      <div className=\"flex gap-1 mb-1\">\r\n                        {[...Array(6)].map((_, i) => (\r\n                          <div\r\n                            key={i}\r\n                            className={`h-1 flex-1 rounded-full ${\r\n                              i < strength ? strengthColors[strength] : \"bg-gray-200\"\r\n                            }`}\r\n                          />\r\n                        ))}\r\n                      </div>\r\n                      <p className=\"text-xs text-gray-600\">\r\n                        Fortaleza: {strengthLabels[strength]}\r\n                      </p>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                    Confirmar Nueva Contraseña\r\n                  </label>\r\n                  <div className=\"relative\">\r\n                    <input\r\n                      type={showConfirm ? \"text\" : \"password\"}\r\n                      value={confirmPassword}\r\n                      onChange={(e) => setConfirmPassword(e.target.value)}\r\n                      className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent pr-10\"\r\n                      required\r\n                    />\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={() => setShowConfirm(!showConfirm)}\r\n                      className=\"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600\"\r\n                    >\r\n                      {showConfirm ? <EyeOff className=\"h-5 w-5\" /> : <Eye className=\"h-5 w-5\" />}\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"flex gap-3 pt-4\">\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={onClose}\r\n                    className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors\"\r\n                  >\r\n                    Cancelar\r\n                  </button>\r\n                  <button\r\n                    type=\"submit\"\r\n                    disabled={loading}\r\n                    className=\"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\r\n                  >\r\n                    {loading ? (\r\n                      <>\r\n                        <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                        Guardando...\r\n                      </>\r\n                    ) : (\r\n                      \"Cambiar Contraseña\"\r\n                    )}\r\n                  </button>\r\n                </div>\r\n              </form>\r\n            )}\r\n          </motion.div>\r\n        </>\r\n      )}\r\n    </AnimatePresence>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\components\\security\\security-events-modal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\components\\security\\security-questions-modal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used.","line":3,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":74,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":74,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport { X, Key, Loader2, Check, AlertCircle } from \"lucide-react\";\r\n\r\ninterface SecurityQuestionsModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n}\r\n\r\nconst AVAILABLE_QUESTIONS = [\r\n  \"¿Cuál es el nombre de tu primera mascota?\",\r\n  \"¿En qué ciudad naciste?\",\r\n  \"¿Cuál es el nombre de soltera de tu madre?\",\r\n  \"¿Cuál fue tu primer trabajo?\",\r\n  \"¿Cuál es tu comida favorita?\",\r\n  \"¿Cuál es el nombre de tu mejor amigo de la infancia?\",\r\n  \"¿En qué calle vivías cuando eras niño?\",\r\n  \"¿Cuál es tu libro favorito?\",\r\n  \"¿Cuál fue el modelo de tu primer carro?\",\r\n  \"¿Cuál es el nombre de tu escuela primaria?\",\r\n];\r\n\r\nexport function SecurityQuestionsModal({ isOpen, onClose }: SecurityQuestionsModalProps) {\r\n  const [questions, setQuestions] = useState([\r\n    { question: \"\", answer: \"\" },\r\n    { question: \"\", answer: \"\" },\r\n    { question: \"\", answer: \"\" },\r\n  ]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n  const [success, setSuccess] = useState(false);\r\n\r\n  const handleSave = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n    setError(\"\");\r\n\r\n    // Validar que todas las preguntas sean diferentes\r\n    const selectedQuestions = questions.map(q => q.question);\r\n    if (new Set(selectedQuestions).size !== 3) {\r\n      setError(\"Debes seleccionar 3 preguntas diferentes\");\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    // Validar que todas las respuestas estén completas\r\n    if (questions.some(q => !q.answer.trim())) {\r\n      setError(\"Debes responder todas las preguntas\");\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(\"/api/security/questions/save\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ questions }),\r\n      });\r\n\r\n      const data = await response.json();\r\n\r\n      if (!data.success) {\r\n        setError(data.message || \"Error al guardar preguntas\");\r\n        return;\r\n      }\r\n\r\n      setSuccess(true);\r\n      setTimeout(() => {\r\n        onClose();\r\n        setSuccess(false);\r\n      }, 2000);\r\n    } catch (error) {\r\n      setError(\"Error al conectar con el servidor\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <AnimatePresence>\r\n      {isOpen && (\r\n        <>\r\n          <motion.div\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            exit={{ opacity: 0 }}\r\n            onClick={onClose}\r\n            className=\"fixed inset-0 bg-black/50 z-[200]\"\r\n          />\r\n          <motion.div\r\n            initial={{ opacity: 0, scale: 0.95, y: 20 }}\r\n            animate={{ opacity: 1, scale: 1, y: 0 }}\r\n            exit={{ opacity: 0, scale: 0.95, y: 20 }}\r\n            className=\"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-2xl bg-white rounded-xl shadow-2xl z-[201] p-6 max-h-[90vh] overflow-y-auto\"\r\n          >\r\n            <div className=\"flex items-center justify-between mb-6\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"p-2 bg-red-100 rounded-lg\">\r\n                  <Key className=\"h-5 w-5 text-red-600\" />\r\n                </div>\r\n                <h3 className=\"text-lg font-semibold text-gray-900\">\r\n                  Preguntas de Seguridad\r\n                </h3>\r\n              </div>\r\n              <button onClick={onClose} className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\">\r\n                <X className=\"h-5 w-5 text-gray-500\" />\r\n              </button>\r\n            </div>\r\n\r\n            {success ? (\r\n              <div className=\"flex flex-col items-center justify-center py-8\">\r\n                <div className=\"p-3 bg-green-100 rounded-full mb-4\">\r\n                  <Check className=\"h-8 w-8 text-green-600\" />\r\n                </div>\r\n                <p className=\"text-lg font-medium text-gray-900 mb-2\">\r\n                  ¡Preguntas Guardadas!\r\n                </p>\r\n                <p className=\"text-sm text-gray-500 text-center\">\r\n                  Tus preguntas de seguridad han sido configuradas\r\n                </p>\r\n              </div>\r\n            ) : (\r\n              <form onSubmit={handleSave} className=\"space-y-6\">\r\n                <p className=\"text-sm text-gray-600\">\r\n                  Configura 3 preguntas de seguridad para recuperar tu cuenta en caso de olvido de contraseña.\r\n                </p>\r\n\r\n                {error && (\r\n                  <div className=\"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-lg\">\r\n                    <AlertCircle className=\"h-5 w-5 text-red-600 flex-shrink-0\" />\r\n                    <p className=\"text-sm text-red-700\">{error}</p>\r\n                  </div>\r\n                )}\r\n\r\n                {questions.map((q, index) => (\r\n                  <div key={index} className=\"space-y-3 p-4 bg-gray-50 rounded-lg\">\r\n                    <div>\r\n                      <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                        Pregunta {index + 1}\r\n                      </label>\r\n                      <select\r\n                        value={q.question}\r\n                        onChange={(e) => {\r\n                          const newQuestions = [...questions];\r\n                          newQuestions[index].question = e.target.value;\r\n                          setQuestions(newQuestions);\r\n                        }}\r\n                        className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent\"\r\n                        required\r\n                      >\r\n                        <option value=\"\">Selecciona una pregunta</option>\r\n                        {AVAILABLE_QUESTIONS.map((question, i) => (\r\n                          <option key={i} value={question}>\r\n                            {question}\r\n                          </option>\r\n                        ))}\r\n                      </select>\r\n                    </div>\r\n\r\n                    <div>\r\n                      <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                        Respuesta\r\n                      </label>\r\n                      <input\r\n                        type=\"text\"\r\n                        value={q.answer}\r\n                        onChange={(e) => {\r\n                          const newQuestions = [...questions];\r\n                          newQuestions[index].answer = e.target.value;\r\n                          setQuestions(newQuestions);\r\n                        }}\r\n                        className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent\"\r\n                        placeholder=\"Tu respuesta\"\r\n                        required\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n\r\n                <div className=\"flex gap-3 pt-4\">\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={onClose}\r\n                    className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors\"\r\n                  >\r\n                    Cancelar\r\n                  </button>\r\n                  <button\r\n                    type=\"submit\"\r\n                    disabled={loading}\r\n                    className=\"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\r\n                  >\r\n                    {loading ? (\r\n                      <>\r\n                        <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                        Guardando...\r\n                      </>\r\n                    ) : (\r\n                      \"Guardar Preguntas\"\r\n                    )}\r\n                  </button>\r\n                </div>\r\n              </form>\r\n            )}\r\n          </motion.div>\r\n        </>\r\n      )}\r\n    </AnimatePresence>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\components\\security\\setup-2fa-modal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'has2FA' is defined but never used.","line":14,"column":50,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":56},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":43,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":43,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":75,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":75,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport { X, Shield, Loader2, Check, AlertCircle, Copy, Download } from \"lucide-react\";\r\nimport Image from \"next/image\";\r\n\r\ninterface Setup2FAModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  has2FA: boolean;\r\n}\r\n\r\nexport function Setup2FAModal({ isOpen, onClose, has2FA }: Setup2FAModalProps) {\r\n  const [step, setStep] = useState<\"setup\" | \"verify\" | \"success\">(\"setup\");\r\n  const [qrCode, setQrCode] = useState(\"\");\r\n  const [secret, setSecret] = useState(\"\");\r\n  const [backupCodes, setBackupCodes] = useState<string[]>([]);\r\n  const [verificationCode, setVerificationCode] = useState(\"\");\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n\r\n  const handleSetup = async () => {\r\n    setLoading(true);\r\n    setError(\"\");\r\n\r\n    try {\r\n      const response = await fetch(\"/api/security/2fa/setup\", {\r\n        method: \"POST\",\r\n      });\r\n\r\n      const data = await response.json();\r\n\r\n      if (!data.success) {\r\n        setError(data.message || \"Error al configurar 2FA\");\r\n        return;\r\n      }\r\n\r\n      setQrCode(data.qrCode);\r\n      setSecret(data.secret);\r\n      setBackupCodes(data.backupCodes);\r\n      setStep(\"verify\");\r\n    } catch (error) {\r\n      setError(\"Error al conectar con el servidor\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleVerify = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n    setError(\"\");\r\n\r\n    try {\r\n      const response = await fetch(\"/api/security/2fa/verify\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ token: verificationCode }),\r\n      });\r\n\r\n      const data = await response.json();\r\n\r\n      if (!data.success) {\r\n        setError(data.message || \"Código inválido\");\r\n        return;\r\n      }\r\n\r\n      setStep(\"success\");\r\n      setTimeout(() => {\r\n        onClose();\r\n        setStep(\"setup\");\r\n        setVerificationCode(\"\");\r\n      }, 3000);\r\n    } catch (error) {\r\n      setError(\"Error al verificar código\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const copyToClipboard = (text: string) => {\r\n    navigator.clipboard.writeText(text);\r\n  };\r\n\r\n  const downloadBackupCodes = () => {\r\n    const content = `Códigos de Respaldo 2FA - Red-Salud\\n\\n${backupCodes.join(\"\\n\")}\\n\\nGuarda estos códigos en un lugar seguro.`;\r\n    const blob = new Blob([content], { type: \"text/plain\" });\r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement(\"a\");\r\n    a.href = url;\r\n    a.download = \"red-salud-backup-codes.txt\";\r\n    a.click();\r\n  };\r\n\r\n  return (\r\n    <AnimatePresence>\r\n      {isOpen && (\r\n        <>\r\n          <motion.div\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            exit={{ opacity: 0 }}\r\n            onClick={onClose}\r\n            className=\"fixed inset-0 bg-black/50 z-[200]\"\r\n          />\r\n          <motion.div\r\n            initial={{ opacity: 0, scale: 0.95, y: 20 }}\r\n            animate={{ opacity: 1, scale: 1, y: 0 }}\r\n            exit={{ opacity: 0, scale: 0.95, y: 20 }}\r\n            className=\"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-lg bg-white rounded-xl shadow-2xl z-[201] p-6 max-h-[90vh] overflow-y-auto\"\r\n          >\r\n            <div className=\"flex items-center justify-between mb-6\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"p-2 bg-purple-100 rounded-lg\">\r\n                  <Shield className=\"h-5 w-5 text-purple-600\" />\r\n                </div>\r\n                <h3 className=\"text-lg font-semibold text-gray-900\">\r\n                  Autenticación de Dos Factores\r\n                </h3>\r\n              </div>\r\n              <button\r\n                onClick={onClose}\r\n                className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\r\n              >\r\n                <X className=\"h-5 w-5 text-gray-500\" />\r\n              </button>\r\n            </div>\r\n\r\n            {step === \"setup\" && (\r\n              <div className=\"space-y-4\">\r\n                <p className=\"text-sm text-gray-600\">\r\n                  La autenticación de dos factores agrega una capa extra de seguridad a tu cuenta.\r\n                  Necesitarás una aplicación de autenticación como Google Authenticator o Authy.\r\n                </p>\r\n\r\n                {error && (\r\n                  <div className=\"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-lg\">\r\n                    <AlertCircle className=\"h-5 w-5 text-red-600 flex-shrink-0\" />\r\n                    <p className=\"text-sm text-red-700\">{error}</p>\r\n                  </div>\r\n                )}\r\n\r\n                <button\r\n                  onClick={handleSetup}\r\n                  disabled={loading}\r\n                  className=\"w-full px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\r\n                >\r\n                  {loading ? (\r\n                    <>\r\n                      <Loader2 className=\"h-5 w-5 animate-spin\" />\r\n                      Configurando...\r\n                    </>\r\n                  ) : (\r\n                    \"Configurar 2FA\"\r\n                  )}\r\n                </button>\r\n              </div>\r\n            )}\r\n\r\n            {step === \"verify\" && (\r\n              <div className=\"space-y-4\">\r\n                <div className=\"text-center\">\r\n                  <p className=\"text-sm text-gray-600 mb-4\">\r\n                    Escanea este código QR con tu aplicación de autenticación:\r\n                  </p>\r\n                  {qrCode && (\r\n                    <div className=\"inline-block p-4 bg-white border-2 border-gray-200 rounded-lg\">\r\n                      <Image src={qrCode} alt=\"QR Code\" width={200} height={200} />\r\n                    </div>\r\n                  )}\r\n                  <div className=\"mt-4 p-3 bg-gray-50 rounded-lg\">\r\n                    <p className=\"text-xs text-gray-500 mb-1\">O ingresa este código manualmente:</p>\r\n                    <div className=\"flex items-center justify-center gap-2\">\r\n                      <code className=\"text-sm font-mono text-gray-900\">{secret}</code>\r\n                      <button\r\n                        onClick={() => copyToClipboard(secret)}\r\n                        className=\"p-1 hover:bg-gray-200 rounded\"\r\n                      >\r\n                        <Copy className=\"h-4 w-4 text-gray-600\" />\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"bg-yellow-50 border border-yellow-200 rounded-lg p-4\">\r\n                  <p className=\"text-sm font-medium text-yellow-900 mb-2\">\r\n                    Códigos de Respaldo\r\n                  </p>\r\n                  <div className=\"grid grid-cols-2 gap-2 mb-3\">\r\n                    {backupCodes.map((code, i) => (\r\n                      <code key={i} className=\"text-xs font-mono bg-white px-2 py-1 rounded\">\r\n                        {code}\r\n                      </code>\r\n                    ))}\r\n                  </div>\r\n                  <button\r\n                    onClick={downloadBackupCodes}\r\n                    className=\"text-xs text-yellow-700 hover:text-yellow-800 flex items-center gap-1\"\r\n                  >\r\n                    <Download className=\"h-3 w-3\" />\r\n                    Descargar códigos\r\n                  </button>\r\n                </div>\r\n\r\n                {error && (\r\n                  <div className=\"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-lg\">\r\n                    <AlertCircle className=\"h-5 w-5 text-red-600 flex-shrink-0\" />\r\n                    <p className=\"text-sm text-red-700\">{error}</p>\r\n                  </div>\r\n                )}\r\n\r\n                <form onSubmit={handleVerify} className=\"space-y-4\">\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                      Código de Verificación\r\n                    </label>\r\n                    <input\r\n                      type=\"text\"\r\n                      value={verificationCode}\r\n                      onChange={(e) => setVerificationCode(e.target.value.replace(/\\D/g, \"\"))}\r\n                      maxLength={6}\r\n                      className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-center text-2xl tracking-widest font-mono\"\r\n                      placeholder=\"000000\"\r\n                      required\r\n                    />\r\n                  </div>\r\n\r\n                  <button\r\n                    type=\"submit\"\r\n                    disabled={loading || verificationCode.length !== 6}\r\n                    className=\"w-full px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\r\n                  >\r\n                    {loading ? (\r\n                      <>\r\n                        <Loader2 className=\"h-5 w-5 animate-spin\" />\r\n                        Verificando...\r\n                      </>\r\n                    ) : (\r\n                      \"Verificar y Activar\"\r\n                    )}\r\n                  </button>\r\n                </form>\r\n              </div>\r\n            )}\r\n\r\n            {step === \"success\" && (\r\n              <div className=\"flex flex-col items-center justify-center py-8\">\r\n                <div className=\"p-3 bg-green-100 rounded-full mb-4\">\r\n                  <Check className=\"h-8 w-8 text-green-600\" />\r\n                </div>\r\n                <p className=\"text-lg font-medium text-gray-900 mb-2\">\r\n                  ¡2FA Activado!\r\n                </p>\r\n                <p className=\"text-sm text-gray-500 text-center\">\r\n                  Tu cuenta ahora está protegida con autenticación de dos factores\r\n                </p>\r\n              </div>\r\n            )}\r\n          </motion.div>\r\n        </>\r\n      )}\r\n    </AnimatePresence>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\components\\security\\verify-phone-modal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":41,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":41,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":74,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":74,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport { X, Smartphone, Loader2, Check, AlertCircle } from \"lucide-react\";\r\n\r\ninterface VerifyPhoneModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n}\r\n\r\nexport function VerifyPhoneModal({ isOpen, onClose }: VerifyPhoneModalProps) {\r\n  const [step, setStep] = useState<\"phone\" | \"code\" | \"success\">(\"phone\");\r\n  const [phoneNumber, setPhoneNumber] = useState(\"\");\r\n  const [code, setCode] = useState(\"\");\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n  const [devCode, setDevCode] = useState(\"\");\r\n\r\n  const handleSendCode = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n    setError(\"\");\r\n\r\n    try {\r\n      const response = await fetch(\"/api/security/phone/send-code\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ phoneNumber }),\r\n      });\r\n\r\n      const data = await response.json();\r\n\r\n      if (!data.success) {\r\n        setError(data.message || \"Error al enviar código\");\r\n        return;\r\n      }\r\n\r\n      if (data.devCode) setDevCode(data.devCode);\r\n      setStep(\"code\");\r\n    } catch (error) {\r\n      setError(\"Error al conectar con el servidor\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleVerifyCode = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n    setError(\"\");\r\n\r\n    try {\r\n      const response = await fetch(\"/api/security/phone/verify-code\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ phoneNumber, code }),\r\n      });\r\n\r\n      const data = await response.json();\r\n\r\n      if (!data.success) {\r\n        setError(data.message || \"Código inválido\");\r\n        return;\r\n      }\r\n\r\n      setStep(\"success\");\r\n      setTimeout(() => {\r\n        onClose();\r\n        setStep(\"phone\");\r\n        setPhoneNumber(\"\");\r\n        setCode(\"\");\r\n      }, 2000);\r\n    } catch (error) {\r\n      setError(\"Error al verificar código\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <AnimatePresence>\r\n      {isOpen && (\r\n        <>\r\n          <motion.div\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            exit={{ opacity: 0 }}\r\n            onClick={onClose}\r\n            className=\"fixed inset-0 bg-black/50 z-[200]\"\r\n          />\r\n          <motion.div\r\n            initial={{ opacity: 0, scale: 0.95, y: 20 }}\r\n            animate={{ opacity: 1, scale: 1, y: 0 }}\r\n            exit={{ opacity: 0, scale: 0.95, y: 20 }}\r\n            className=\"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md bg-white rounded-xl shadow-2xl z-[201] p-6\"\r\n          >\r\n            <div className=\"flex items-center justify-between mb-6\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"p-2 bg-orange-100 rounded-lg\">\r\n                  <Smartphone className=\"h-5 w-5 text-orange-600\" />\r\n                </div>\r\n                <h3 className=\"text-lg font-semibold text-gray-900\">\r\n                  Verificar Teléfono\r\n                </h3>\r\n              </div>\r\n              <button onClick={onClose} className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\">\r\n                <X className=\"h-5 w-5 text-gray-500\" />\r\n              </button>\r\n            </div>\r\n\r\n            {step === \"phone\" && (\r\n              <form onSubmit={handleSendCode} className=\"space-y-4\">\r\n                {error && (\r\n                  <div className=\"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-lg\">\r\n                    <AlertCircle className=\"h-5 w-5 text-red-600 flex-shrink-0\" />\r\n                    <p className=\"text-sm text-red-700\">{error}</p>\r\n                  </div>\r\n                )}\r\n\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                    Número de Teléfono\r\n                  </label>\r\n                  <input\r\n                    type=\"tel\"\r\n                    value={phoneNumber}\r\n                    onChange={(e) => setPhoneNumber(e.target.value)}\r\n                    placeholder=\"+58 412 1234567\"\r\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent\"\r\n                    required\r\n                  />\r\n                </div>\r\n\r\n                <button\r\n                  type=\"submit\"\r\n                  disabled={loading}\r\n                  className=\"w-full px-4 py-3 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\r\n                >\r\n                  {loading ? (\r\n                    <>\r\n                      <Loader2 className=\"h-5 w-5 animate-spin\" />\r\n                      Enviando...\r\n                    </>\r\n                  ) : (\r\n                    \"Enviar Código\"\r\n                  )}\r\n                </button>\r\n              </form>\r\n            )}\r\n\r\n            {step === \"code\" && (\r\n              <form onSubmit={handleVerifyCode} className=\"space-y-4\">\r\n                <p className=\"text-sm text-gray-600\">\r\n                  Hemos enviado un código de verificación a <strong>{phoneNumber}</strong>\r\n                </p>\r\n\r\n                {devCode && (\r\n                  <div className=\"p-3 bg-blue-50 border border-blue-200 rounded-lg\">\r\n                    <p className=\"text-xs text-blue-600 mb-1\">Código de desarrollo:</p>\r\n                    <code className=\"text-lg font-mono text-blue-900\">{devCode}</code>\r\n                  </div>\r\n                )}\r\n\r\n                {error && (\r\n                  <div className=\"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-lg\">\r\n                    <AlertCircle className=\"h-5 w-5 text-red-600 flex-shrink-0\" />\r\n                    <p className=\"text-sm text-red-700\">{error}</p>\r\n                  </div>\r\n                )}\r\n\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                    Código de Verificación\r\n                  </label>\r\n                  <input\r\n                    type=\"text\"\r\n                    value={code}\r\n                    onChange={(e) => setCode(e.target.value.replace(/\\D/g, \"\"))}\r\n                    maxLength={6}\r\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-center text-2xl tracking-widest font-mono\"\r\n                    placeholder=\"000000\"\r\n                    required\r\n                  />\r\n                </div>\r\n\r\n                <div className=\"flex gap-3\">\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => setStep(\"phone\")}\r\n                    className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors\"\r\n                  >\r\n                    Atrás\r\n                  </button>\r\n                  <button\r\n                    type=\"submit\"\r\n                    disabled={loading || code.length !== 6}\r\n                    className=\"flex-1 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\r\n                  >\r\n                    {loading ? (\r\n                      <>\r\n                        <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                        Verificando...\r\n                      </>\r\n                    ) : (\r\n                      \"Verificar\"\r\n                    )}\r\n                  </button>\r\n                </div>\r\n              </form>\r\n            )}\r\n\r\n            {step === \"success\" && (\r\n              <div className=\"flex flex-col items-center justify-center py-8\">\r\n                <div className=\"p-3 bg-green-100 rounded-full mb-4\">\r\n                  <Check className=\"h-8 w-8 text-green-600\" />\r\n                </div>\r\n                <p className=\"text-lg font-medium text-gray-900 mb-2\">\r\n                  ¡Teléfono Verificado!\r\n                </p>\r\n                <p className=\"text-sm text-gray-500 text-center\">\r\n                  Tu número de teléfono ha sido verificado exitosamente\r\n                </p>\r\n              </div>\r\n            )}\r\n          </motion.div>\r\n        </>\r\n      )}\r\n    </AnimatePresence>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\components\\tab-navigation.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\constants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\constants\\medical-suggestions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\constants\\medication-database.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\doctor\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\doctor\\tabs\\documents-tab-doctor.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\doctor\\tabs\\medical-tab-doctor.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\doctor\\tabs\\profile-tab-doctor.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\doctor\\user-profile-modal-doctor.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isSaving' is assigned a value but never used.","line":68,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":68,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":99,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3463,3466],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3463,3466],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":100,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3515,3518],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3515,3518],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":140,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":140,"endColumn":19}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport {\r\n  User,\r\n  Stethoscope,\r\n  FileText,\r\n  Shield,\r\n  Settings,\r\n  Eye,\r\n  Activity,\r\n  CreditCard,\r\n  Star,\r\n} from \"lucide-react\";\r\nimport { ModalHeader } from \"../components/modal-header\";\r\nimport { TabNavigation } from \"../components/tab-navigation\";\r\nimport { ProfileTabDoctor } from \"./tabs/profile-tab-doctor\";\r\nimport { MedicalTabDoctor } from \"./tabs/medical-tab-doctor\";\r\nimport { DocumentsTabDoctor } from \"./tabs/documents-tab-doctor\";\r\nimport { SecurityTabNew as SecurityTab } from \"../tabs/security-tab-new\";\r\nimport { PreferencesTab } from \"../tabs/preferences-tab\";\r\nimport { PrivacyTab } from \"../tabs/privacy-tab\";\r\nimport { ActivityTab } from \"../tabs/activity-tab\";\r\nimport { BillingTab } from \"../tabs/billing-tab\";\r\nimport { useAvatarUpload } from \"../hooks/use-avatar-upload\";\r\nimport { useThemeColor } from \"@/hooks/use-theme-color\";\r\nimport { Toast, type ToastType } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@red-salud/ui\";\r\nimport { useDoctorProfile } from \"@/hooks/use-doctor-profile\";\r\nimport type { TabType, TabConfig, DoctorProfileData } from \"../types\";\r\n\r\nconst TABS: TabConfig[] = [\r\n  { id: \"profile\", label: \"Mi Perfil\", icon: User },\r\n  { id: \"medical\", label: \"Info. Profesional\", icon: Stethoscope },\r\n  { id: \"documents\", label: \"Documentos\", icon: FileText },\r\n  { id: \"security\", label: \"Seguridad\", icon: Shield },\r\n  { id: \"preferences\", label: \"Preferencias\", icon: Settings },\r\n  { id: \"privacy\", label: \"Privacidad\", icon: Eye },\r\n  { id: \"activity\", label: \"Actividad\", icon: Activity },\r\n  { id: \"billing\", label: \"Facturación\", icon: CreditCard },\r\n];\r\n\r\ninterface UserProfileModalDoctorProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  userName: string;\r\n  userEmail: string;\r\n  userId?: string;\r\n}\r\n\r\nexport function UserProfileModalDoctor({\r\n  isOpen,\r\n  onClose,\r\n  userName,\r\n  userEmail,\r\n  userId,\r\n}: UserProfileModalDoctorProps) {\r\n  const router = useRouter();\r\n  const [activeTab, setActiveTab] = useState<TabType>(\"profile\");\r\n  const { themeColor, setThemeColor } = useThemeColor();\r\n  const [toastMessage, setToastMessage] = useState(\"\");\r\n  const [toastType, setToastType] = useState<ToastType>(\"info\");\r\n  const [showToast, setShowToast] = useState(false);\r\n  const [isEditing, setIsEditing] = useState(false);\r\n  const [isSaving, setIsSaving] = useState(false);\r\n  \r\n  // Verificar si el médico tiene perfil\r\n  const { profile: doctorProfile, loading: profileLoading } = useDoctorProfile(userId);\r\n\r\n  // Estado del perfil del médico\r\n  const [formData, setFormData] = useState<DoctorProfileData>({\r\n    nombre_completo: userName,\r\n    email: userEmail,\r\n    telefono: \"\",\r\n    cedula: \"\",\r\n    mpps: \"\",\r\n    especialidad: \"\",\r\n    universidad: \"\",\r\n    anos_experiencia: 0,\r\n    bio: \"\",\r\n    subespecialidades: \"\",\r\n    certificaciones: \"\",\r\n    idiomas: \"\",\r\n  });\r\n\r\n  const showNotification = (message: string, type: ToastType = \"info\") => {\r\n    setToastMessage(message);\r\n    setToastType(type);\r\n    setShowToast(true);\r\n  };\r\n\r\n  // Cargar datos del perfil cuando el doctorProfile cambia\r\n  useEffect(() => {\r\n    if (doctorProfile) {\r\n      // Extraer datos SACS si existen\r\n      const sacsData = (doctorProfile.sacs_data as any) || {};\r\n      const profile = doctorProfile as any;\r\n      \r\n      setFormData({\r\n        nombre_completo: profile.nombre_completo || sacsData.nombre_completo || userName,\r\n        email: profile.email || userEmail,\r\n        telefono: doctorProfile.professional_phone || \"\",\r\n        cedula: profile.cedula || sacsData.cedula || \"\",\r\n        mpps: doctorProfile.license_number || sacsData.matricula_principal || \"\",\r\n        especialidad: doctorProfile.specialty?.name || sacsData.especialidad_display || \"\",\r\n        universidad: profile.universidad || \"\",\r\n        anos_experiencia: doctorProfile.years_experience || 0,\r\n        bio: doctorProfile.bio || \"\",\r\n        subespecialidades: \"\",\r\n        certificaciones: \"\",\r\n        idiomas: Array.isArray(doctorProfile.languages) ? doctorProfile.languages.join(\", \") : \"\",\r\n      });\r\n    }\r\n  }, [doctorProfile, userName, userEmail]);\r\n\r\n  const {\r\n    avatarHover,\r\n    setAvatarHover,\r\n    fileInputRef,\r\n    handleAvatarClick,\r\n    handleFileChange,\r\n  } = useAvatarUpload(async (file) => {\r\n    if (!userId) {\r\n      showNotification(\"Error: Usuario no identificado\", \"error\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      showNotification(\"Subiendo imagen...\", \"info\");\r\n      // TODO: Implementar subida con Supabase Storage\r\n      console.log(\"Uploading file:\", file, \"for user:\", userId);\r\n      await new Promise((resolve) => setTimeout(resolve, 1000));\r\n      showNotification(\r\n        \"Imagen subida correctamente (pendiente implementación)\",\r\n        \"warning\"\r\n      );\r\n    } catch (error) {\r\n      showNotification(\"Error al subir la imagen\", \"error\");\r\n    }\r\n  });\r\n\r\n  const handleSave = async () => {\r\n    if (!userId) {\r\n      showNotification(\"Error: Usuario no identificado\", \"error\");\r\n      return { success: false, error: \"Usuario no identificado\" };\r\n    }\r\n\r\n    setIsSaving(true);\r\n    try {\r\n      const response = await fetch(\"/api/doctor/profile/update\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify({\r\n          userId,\r\n          ...formData,\r\n        }),\r\n      });\r\n\r\n      const result = await response.json();\r\n\r\n      if (!response.ok) {\r\n        const errorMessage = result.message || \"Error al guardar el perfil\";\r\n        showNotification(errorMessage, \"error\");\r\n        return { success: false, error: errorMessage };\r\n      }\r\n\r\n      setIsEditing(false);\r\n      showNotification(\"Perfil actualizado correctamente\", \"success\");\r\n      \r\n      // Recargar datos usando el hook\r\n      // El hook se actualizará automáticamente\r\n\r\n      return { success: true };\r\n    } catch (error) {\r\n      console.error(\"Error saving:\", error);\r\n      const errorMessage =\r\n        error instanceof Error\r\n          ? error.message\r\n          : \"Error al conectar con el servidor\";\r\n      showNotification(errorMessage, \"error\");\r\n      return { success: false, error: errorMessage };\r\n    } finally {\r\n      setIsSaving(false);\r\n    }\r\n  };\r\n\r\n  const handleTabChange = (tab: TabType) => {\r\n    setActiveTab(tab);\r\n    setIsEditing(false);\r\n  };\r\n\r\n  const handleVerificationRedirect = () => {\r\n    onClose();\r\n    router.push(\"/dashboard/medico/perfil/setup\");\r\n  };\r\n\r\n  // Si no tiene perfil, mostrar mensaje de verificación\r\n  const needsVerification = !profileLoading && !doctorProfile;\r\n\r\n  // Debug logging\r\n  console.log('UserProfileModalDoctor state:', {\r\n    userId,\r\n    profileLoading,\r\n    hasDoctorProfile: !!doctorProfile,\r\n    needsVerification,\r\n    doctorProfileId: doctorProfile?.id,\r\n  });\r\n\r\n  return (\r\n    <>\r\n      <Toast\r\n        message={toastMessage}\r\n        type={toastType}\r\n        isVisible={showToast}\r\n        onClose={() => setShowToast(false)}\r\n      />\r\n\r\n      <AnimatePresence>\r\n        {isOpen && (\r\n          <>\r\n            <motion.div\r\n              initial={{ opacity: 0 }}\r\n              animate={{ opacity: 1 }}\r\n              exit={{ opacity: 0 }}\r\n              onClick={onClose}\r\n              className=\"fixed inset-0 bg-black/50 z-100\"\r\n              aria-hidden=\"true\"\r\n            />\r\n\r\n            {needsVerification ? (\r\n              // Modal de verificación requerida\r\n              <motion.dialog\r\n                initial={{ opacity: 0, scale: 0.95 }}\r\n                animate={{ opacity: 1, scale: 1 }}\r\n                exit={{ opacity: 0, scale: 0.95 }}\r\n                open={isOpen}\r\n                className=\"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-2xl bg-white rounded-xl shadow-2xl z-101 overflow-hidden\"\r\n                style={{ translateX: \"-50%\", translateY: \"-50%\" }}\r\n                aria-labelledby=\"verification-modal-title\"\r\n                aria-modal=\"true\"\r\n              >\r\n                <Card className=\"border-0 shadow-none\">\r\n                  <CardHeader className=\"text-center pb-4\">\r\n                    <div className=\"mx-auto w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-4\">\r\n                      <Activity className=\"h-8 w-8 text-blue-600\" />\r\n                    </div>\r\n                    <CardTitle className=\"text-2xl\" id=\"verification-modal-title\">\r\n                      Completa tu Perfil Profesional\r\n                    </CardTitle>\r\n                    <p className=\"text-gray-600 mt-2\">\r\n                      Para acceder a tu perfil completo, necesitas verificar tu identidad\r\n                      como profesional de la salud en Venezuela\r\n                    </p>\r\n                  </CardHeader>\r\n                  <CardContent className=\"space-y-6\">\r\n                    {/* Beneficios */}\r\n                    <div className=\"bg-blue-50 rounded-lg p-4 space-y-3\">\r\n                      <h3 className=\"font-semibold text-blue-900 flex items-center gap-2\">\r\n                        <Star className=\"h-5 w-5\" />\r\n                        ¿Qué obtendrás?\r\n                      </h3>\r\n                      <ul className=\"space-y-2 text-sm text-blue-800\">\r\n                        <li className=\"flex items-start gap-2\">\r\n                          <span className=\"text-blue-600 mt-0.5\">✓</span>\r\n                          <span>Gestión completa de tu agenda y citas</span>\r\n                        </li>\r\n                        <li className=\"flex items-start gap-2\">\r\n                          <span className=\"text-blue-600 mt-0.5\">✓</span>\r\n                          <span>Acceso a historiales clínicos de tus pacientes</span>\r\n                        </li>\r\n                        <li className=\"flex items-start gap-2\">\r\n                          <span className=\"text-blue-600 mt-0.5\">✓</span>\r\n                          <span>Sistema de telemedicina integrado</span>\r\n                        </li>\r\n                        <li className=\"flex items-start gap-2\">\r\n                          <span className=\"text-blue-600 mt-0.5\">✓</span>\r\n                          <span>Emisión de Recipe y órdenes médicas digitales</span>\r\n                        </li>\r\n                      </ul>\r\n                    </div>\r\n\r\n                    {/* Proceso de verificación */}\r\n                    <div className=\"space-y-3\">\r\n                      <h3 className=\"font-semibold text-gray-900\">\r\n                        Proceso de Verificación\r\n                      </h3>\r\n                      <div className=\"space-y-2 text-sm text-gray-600\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                          <div className=\"w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-semibold\">\r\n                            1\r\n                          </div>\r\n                          <span>Ingresa tu número de cédula venezolana</span>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-3\">\r\n                          <div className=\"w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-semibold\">\r\n                            2\r\n                          </div>\r\n                          <span>Verificamos tu registro en el SACS automáticamente</span>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-3\">\r\n                          <div className=\"w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-semibold\">\r\n                            3\r\n                          </div>\r\n                          <span>Completa tu información profesional</span>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Botones */}\r\n                    <div className=\"flex gap-3\">\r\n                      <Button\r\n                        variant=\"outline\"\r\n                        onClick={onClose}\r\n                        className=\"flex-1\"\r\n                      >\r\n                        Cancelar\r\n                      </Button>\r\n                      <Button\r\n                        onClick={handleVerificationRedirect}\r\n                        className=\"flex-1\"\r\n                      >\r\n                        Comenzar Verificación\r\n                      </Button>\r\n                    </div>\r\n\r\n                    <p className=\"text-xs text-center text-gray-500\">\r\n                      La verificación es instantánea y utiliza datos públicos del SACS\r\n                      (Sistema de Atención al Ciudadano en Salud)\r\n                    </p>\r\n                  </CardContent>\r\n                </Card>\r\n              </motion.dialog>\r\n            ) : (\r\n              // Modal normal de perfil\r\n              <motion.dialog\r\n                initial={{ opacity: 0, scale: 0.95 }}\r\n                animate={{ opacity: 1, scale: 1 }}\r\n                exit={{ opacity: 0, scale: 0.95 }}\r\n                open={isOpen}\r\n                className=\"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-7xl h-[95vh] bg-white rounded-xl shadow-2xl z-101 overflow-hidden flex flex-col\"\r\n                style={{ translateX: \"-50%\", translateY: \"-50%\" }}\r\n                aria-labelledby=\"profile-modal-title\"\r\n                aria-modal=\"true\"\r\n              >\r\n              <ModalHeader\r\n                userName={userName}\r\n                userEmail={userEmail}\r\n                onClose={onClose}\r\n                avatarHover={avatarHover}\r\n                onAvatarHover={setAvatarHover}\r\n                onAvatarClick={handleAvatarClick}\r\n                fileInputRef={fileInputRef}\r\n                onFileChange={handleFileChange}\r\n                themeColor={themeColor}\r\n                onThemeColorChange={setThemeColor}\r\n              />\r\n\r\n              <TabNavigation\r\n                tabs={TABS}\r\n                activeTab={activeTab}\r\n                onTabChange={handleTabChange}\r\n              />\r\n\r\n              <main className=\"flex-1 overflow-y-auto\">\r\n                <div className=\"p-8\">\r\n                  {profileLoading ? (\r\n                    <div className=\"flex items-center justify-center h-64\">\r\n                      <div className=\"text-center space-y-3\">\r\n                        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto\"></div>\r\n                        <p className=\"text-gray-600\">Cargando perfil...</p>\r\n                      </div>\r\n                    </div>\r\n                  ) : (\r\n                    <AnimatePresence mode=\"wait\">\r\n                      {activeTab === \"profile\" && (\r\n                        <ProfileTabDoctor\r\n                          formData={formData}\r\n                          setFormData={setFormData}\r\n                          isEditing={isEditing}\r\n                          setIsEditing={setIsEditing}\r\n                          handleSave={handleSave}\r\n                        />\r\n                      )}\r\n                      {activeTab === \"medical\" && (\r\n                        <MedicalTabDoctor\r\n                          formData={formData}\r\n                          setFormData={setFormData}\r\n                          isEditing={isEditing}\r\n                          setIsEditing={setIsEditing}\r\n                          handleSave={handleSave}\r\n                        />\r\n                      )}\r\n                      {activeTab === \"documents\" && <DocumentsTabDoctor />}\r\n                      {activeTab === \"security\" && userId && (\r\n                        <SecurityTab userEmail={userEmail} userId={userId} />\r\n                      )}\r\n                      {activeTab === \"preferences\" && <PreferencesTab />}\r\n                      {activeTab === \"privacy\" && userId && <PrivacyTab userId={userId} />}\r\n                      {activeTab === \"activity\" && userId && <ActivityTab userId={userId} />}\r\n                      {activeTab === \"billing\" && userId && <BillingTab userId={userId} />}\r\n                    </AnimatePresence>\r\n                  )}\r\n                </div>\r\n              </main>\r\n              </motion.dialog>\r\n            )}\r\n          </>\r\n        )}\r\n      </AnimatePresence>\r\n    </>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\hooks\\use-avatar-upload.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\hooks\\use-profile-form.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\MedicalClinicalSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\MedicalFormSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\activity-tab.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[519,522],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[519,522],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[575,578],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[575,578],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`loadData` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\activity-tab.tsx:26:7\n  24 |   useEffect(() => {\n  25 |     if (userId) {\n> 26 |       loadData();\n     |       ^^^^^^^^ `loadData` accessed before it is declared\n  27 |     }\n  28 |   }, [userId]);\n  29 |\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\activity-tab.tsx:30:3\n  28 |   }, [userId]);\n  29 |\n> 30 |   const loadData = async () => {\n     |   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 31 |     if (!userId) return;\n     | ^^^^^^^^^^^^^^^^^^^^^^^^\n> 32 |     \n     …\n     | ^^^^^^^^^^^^^^^^^^^^^^^^\n> 45 |     setLoading(false);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^\n> 46 |   };\n     | ^^^^^ `loadData` is declared here\n  47 |\n  48 |   return (\n  49 |     <motion.article","line":26,"column":7,"nodeType":null,"endLine":26,"endColumn":15},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":28,"column":6,"nodeType":"ArrayExpression","endLine":28,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [loadData, userId]","fix":{"range":[710,718],"text":"[loadData, userId]"}}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\r\nimport { motion } from \"framer-motion\";\r\nimport {\r\n  Monitor,\r\n  Smartphone,\r\n  MapPin,\r\n  Clock,\r\n  Check,\r\n  Activity as ActivityIcon,\r\n  LogOut,\r\n} from \"lucide-react\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { getUserActivity, getUserSessions } from \"@/lib/supabase/services/activity-service\";\r\n\r\ninterface ActivityTabProps {\r\n  userId?: string;\r\n}\r\n\r\nexport function ActivityTab({ userId }: ActivityTabProps) {\r\n  const [activities, setActivities] = useState<any[]>([]);\r\n  const [sessions, setSessions] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    if (userId) {\r\n      loadData();\r\n    }\r\n  }, [userId]);\r\n\r\n  const loadData = async () => {\r\n    if (!userId) return;\r\n    \r\n    setLoading(true);\r\n    const [activityResult, sessionsResult] = await Promise.all([\r\n      getUserActivity(userId, 10),\r\n      getUserSessions(userId),\r\n    ]);\r\n\r\n    if (activityResult.success) {\r\n      setActivities(activityResult.data || []);\r\n    }\r\n    if (sessionsResult.success) {\r\n      setSessions(sessionsResult.data || []);\r\n    }\r\n    setLoading(false);\r\n  };\r\n\r\n  return (\r\n    <motion.article\r\n      key=\"activity\"\r\n      initial={{ opacity: 0, x: -20 }}\r\n      animate={{ opacity: 1, x: 0 }}\r\n      exit={{ opacity: 0, x: 20 }}\r\n    >\r\n      <header className=\"mb-6\">\r\n        <h2 className=\"text-xl font-semibold text-gray-900 dark:text-gray-100\">\r\n          Actividad de la Cuenta\r\n        </h2>\r\n        <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\r\n          Revisa el historial de accesos y sesiones activas\r\n        </p>\r\n      </header>\r\n\r\n      <div className=\"grid grid-cols-2 gap-6\">\r\n        {/* Sesiones Activas */}\r\n        <section className=\"space-y-4\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <h3 className=\"font-semibold text-gray-900 dark:text-gray-100\">\r\n              Sesiones Activas\r\n            </h3>\r\n            <Button variant=\"outline\" size=\"sm\">\r\n              Cerrar Todas\r\n            </Button>\r\n          </div>\r\n\r\n          {loading ? (\r\n            <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\">\r\n              Cargando...\r\n            </div>\r\n          ) : sessions.length === 0 ? (\r\n            <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\">\r\n              No hay sesiones activas\r\n            </div>\r\n          ) : (\r\n            sessions.map((session, index) => (\r\n              <article\r\n                key={session.id || index}\r\n                className=\"border border-gray-200 dark:border-gray-700 rounded-lg p-4 dark:bg-gray-800\"\r\n              >\r\n                <div className=\"flex items-start justify-between\">\r\n                  <div className=\"flex items-start gap-3\">\r\n                    <div className=\"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg\">\r\n                      {session.device?.includes(\"Mobile\") ? (\r\n                        <Smartphone className=\"h-5 w-5 text-blue-600 dark:text-blue-400\" />\r\n                      ) : (\r\n                        <Monitor className=\"h-5 w-5 text-blue-600 dark:text-blue-400\" />\r\n                      )}\r\n                    </div>\r\n                    <div>\r\n                      <p className=\"text-sm font-medium text-gray-900 dark:text-gray-100\">\r\n                        {session.device || \"Dispositivo desconocido\"}\r\n                      </p>\r\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\r\n                        <MapPin className=\"h-3 w-3 inline mr-1\" />\r\n                        {session.location || \"Ubicación desconocida\"}\r\n                      </p>\r\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\r\n                        <Clock className=\"h-3 w-3 inline mr-1\" />\r\n                        {session.last_active_at\r\n                          ? new Date(session.last_active_at).toLocaleString(\"es-VE\")\r\n                          : \"Ahora\"}\r\n                      </p>\r\n                      {session.is_current && (\r\n                        <span className=\"inline-flex items-center gap-1 text-xs font-medium text-green-700 dark:text-green-400 bg-green-100 dark:bg-green-900/30 px-2 py-0.5 rounded-full mt-2\">\r\n                          <Check className=\"h-3 w-3\" />\r\n                          Sesión Actual\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                  {!session.is_current && (\r\n                    <button\r\n                      className=\"text-red-600 hover:text-red-700 dark:text-red-400\"\r\n                      aria-label=\"Cerrar sesión\"\r\n                    >\r\n                      <LogOut className=\"h-4 w-4\" />\r\n                    </button>\r\n                  )}\r\n                </div>\r\n              </article>\r\n            ))\r\n          )}\r\n\r\n          <aside className=\"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4\">\r\n            <p className=\"text-sm text-yellow-800 dark:text-yellow-300\">\r\n              <strong>Consejo de Seguridad:</strong> Si ves una sesión que no\r\n              reconoces, ciérrala inmediatamente y cambia tu contraseña.\r\n            </p>\r\n          </aside>\r\n        </section>\r\n\r\n        {/* Historial de Actividad */}\r\n        <section className=\"space-y-4\">\r\n          <h3 className=\"font-semibold text-gray-900 dark:text-gray-100\">\r\n            Historial de Actividad\r\n          </h3>\r\n\r\n          {loading ? (\r\n            <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\">\r\n              Cargando...\r\n            </div>\r\n          ) : activities.length === 0 ? (\r\n            <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\">\r\n              No hay actividad reciente\r\n            </div>\r\n          ) : (\r\n            <div className=\"space-y-3\">\r\n              {activities.map((activity, index) => (\r\n                <article\r\n                  key={activity.id || index}\r\n                  className=\"border border-gray-200 dark:border-gray-700 rounded-lg p-4 dark:bg-gray-800\"\r\n                >\r\n                  <div className=\"flex items-start gap-3\">\r\n                    <div\r\n                      className={`p-2 rounded-lg ${\r\n                        activity.status === \"success\"\r\n                          ? \"bg-green-100 dark:bg-green-900/30\"\r\n                          : \"bg-red-100 dark:bg-red-900/30\"\r\n                      }`}\r\n                    >\r\n                      {activity.status === \"success\" ? (\r\n                        <Check className=\"h-4 w-4 text-green-600 dark:text-green-400\" />\r\n                      ) : (\r\n                        <ActivityIcon className=\"h-4 w-4 text-red-600 dark:text-red-400\" />\r\n                      )}\r\n                    </div>\r\n                    <div className=\"flex-1\">\r\n                      <p className=\"text-sm font-medium text-gray-900 dark:text-gray-100\">\r\n                        {activity.description || activity.activity_type}\r\n                      </p>\r\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\r\n                        {activity.created_at\r\n                          ? new Date(activity.created_at).toLocaleString(\"es-VE\")\r\n                          : \"Fecha desconocida\"}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                </article>\r\n              ))}\r\n            </div>\r\n          )}\r\n\r\n          <Button variant=\"outline\" className=\"w-full\">\r\n            Ver Historial Completo\r\n          </Button>\r\n        </section>\r\n      </div>\r\n    </motion.article>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\billing-tab.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":19,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[494,497],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[494,497],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[558,561],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[558,561],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`loadData` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\billing-tab.tsx:25:7\n  23 |   useEffect(() => {\n  24 |     if (userId) {\n> 25 |       loadData();\n     |       ^^^^^^^^ `loadData` accessed before it is declared\n  26 |     }\n  27 |   }, [userId]);\n  28 |\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\billing-tab.tsx:29:3\n  27 |   }, [userId]);\n  28 |\n> 29 |   const loadData = async () => {\n     |   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 30 |     if (!userId) return;\n     | ^^^^^^^^^^^^^^^^^^^^^^^^\n> 31 |     \n     …\n     | ^^^^^^^^^^^^^^^^^^^^^^^^\n> 44 |     setLoading(false);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^\n> 45 |   };\n     | ^^^^^ `loadData` is declared here\n  46 |\n  47 |   const totalSpent = transactions\n  48 |     .filter((t) => t.status === \"paid\")","line":25,"column":7,"nodeType":null,"endLine":25,"endColumn":15},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":27,"column":6,"nodeType":"ArrayExpression","endLine":27,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [loadData, userId]","fix":{"range":[693,701],"text":"[loadData, userId]"}}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\r\nimport { motion } from \"framer-motion\";\r\nimport {\r\n  CreditCard,\r\n  Plus,\r\n  Edit2,\r\n  Check,\r\n  Clock,\r\n  Download,\r\n} from \"lucide-react\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { getPaymentMethods, getTransactions } from \"@/lib/supabase/services/billing-service\";\r\n\r\ninterface BillingTabProps {\r\n  userId?: string;\r\n}\r\n\r\nexport function BillingTab({ userId }: BillingTabProps) {\r\n  const [paymentMethods, setPaymentMethods] = useState<any[]>([]);\r\n  const [transactions, setTransactions] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    if (userId) {\r\n      loadData();\r\n    }\r\n  }, [userId]);\r\n\r\n  const loadData = async () => {\r\n    if (!userId) return;\r\n    \r\n    setLoading(true);\r\n    const [methodsResult, transactionsResult] = await Promise.all([\r\n      getPaymentMethods(userId),\r\n      getTransactions(userId, 10),\r\n    ]);\r\n\r\n    if (methodsResult.success) {\r\n      setPaymentMethods(methodsResult.data || []);\r\n    }\r\n    if (transactionsResult.success) {\r\n      setTransactions(transactionsResult.data || []);\r\n    }\r\n    setLoading(false);\r\n  };\r\n\r\n  const totalSpent = transactions\r\n    .filter((t) => t.status === \"paid\")\r\n    .reduce((sum, t) => sum + (t.amount || 0), 0);\r\n\r\n  const pendingAmount = transactions\r\n    .filter((t) => t.status === \"pending\")\r\n    .reduce((sum, t) => sum + (t.amount || 0), 0);\r\n\r\n  return (\r\n    <motion.article\r\n      key=\"billing\"\r\n      initial={{ opacity: 0, x: -20 }}\r\n      animate={{ opacity: 1, x: 0 }}\r\n      exit={{ opacity: 0, x: 20 }}\r\n    >\r\n      <header className=\"mb-6\">\r\n        <h2 className=\"text-xl font-semibold text-gray-900 dark:text-gray-100\">\r\n          Facturación y Pagos\r\n        </h2>\r\n        <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\r\n          Gestiona tus métodos de pago e historial de transacciones\r\n        </p>\r\n      </header>\r\n\r\n      <div className=\"grid grid-cols-2 gap-6\">\r\n        {/* Métodos de Pago */}\r\n        <section className=\"space-y-4\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <h3 className=\"font-semibold text-gray-900 dark:text-gray-100\">\r\n              Métodos de Pago\r\n            </h3>\r\n            <Button size=\"sm\">\r\n              <Plus className=\"h-4 w-4 mr-2\" />\r\n              Agregar\r\n            </Button>\r\n          </div>\r\n\r\n          {loading ? (\r\n            <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\">\r\n              Cargando...\r\n            </div>\r\n          ) : paymentMethods.length === 0 ? (\r\n            <div className=\"text-center py-8\">\r\n              <p className=\"text-gray-500 dark:text-gray-400 mb-4\">\r\n                No tienes métodos de pago registrados\r\n              </p>\r\n              <Button>\r\n                <Plus className=\"h-4 w-4 mr-2\" />\r\n                Agregar Método de Pago\r\n              </Button>\r\n            </div>\r\n          ) : (\r\n            paymentMethods.map((method) => (\r\n              <article\r\n                key={method.id}\r\n                className=\"border border-gray-200 dark:border-gray-700 rounded-lg p-4 dark:bg-gray-800\"\r\n              >\r\n                <div className=\"flex items-start justify-between\">\r\n                  <div className=\"flex items-start gap-3\">\r\n                    <div className=\"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg\">\r\n                      <CreditCard className=\"h-5 w-5 text-blue-600 dark:text-blue-400\" />\r\n                    </div>\r\n                    <div>\r\n                      <p className=\"text-sm font-medium text-gray-900 dark:text-gray-100\">\r\n                        {method.card_brand} •••• {method.last_four}\r\n                      </p>\r\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\r\n                        Vence {method.exp_month}/{method.exp_year}\r\n                      </p>\r\n                      {method.is_default && (\r\n                        <span className=\"inline-flex items-center gap-1 text-xs font-medium text-green-700 dark:text-green-400 bg-green-100 dark:bg-green-900/30 px-2 py-0.5 rounded-full mt-2\">\r\n                          <Check className=\"h-3 w-3\" />\r\n                          Predeterminada\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                  <button\r\n                    className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\r\n                    aria-label=\"Editar método de pago\"\r\n                  >\r\n                    <Edit2 className=\"h-4 w-4\" />\r\n                  </button>\r\n                </div>\r\n              </article>\r\n            ))\r\n          )}\r\n\r\n          <button className=\"w-full border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 hover:border-blue-500 dark:hover:border-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors\">\r\n            <Plus className=\"h-6 w-6 text-gray-400 dark:text-gray-500 mx-auto mb-2\" />\r\n            <p className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\r\n              Agregar Método de Pago\r\n            </p>\r\n            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\r\n              Tarjeta de crédito, débito o transferencia\r\n            </p>\r\n          </button>\r\n\r\n          <aside className=\"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4\">\r\n            <h4 className=\"font-semibold text-blue-900 dark:text-blue-200 mb-2\">\r\n              Pagos Seguros\r\n            </h4>\r\n            <p className=\"text-sm text-blue-700 dark:text-blue-300\">\r\n              Todos los pagos están encriptados y protegidos. No almacenamos\r\n              información completa de tarjetas.\r\n            </p>\r\n          </aside>\r\n        </section>\r\n\r\n        {/* Historial de Transacciones */}\r\n        <section className=\"space-y-4\">\r\n          <h3 className=\"font-semibold text-gray-900 dark:text-gray-100\">\r\n            Historial de Transacciones\r\n          </h3>\r\n\r\n          {loading ? (\r\n            <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\">\r\n              Cargando...\r\n            </div>\r\n          ) : transactions.length === 0 ? (\r\n            <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\">\r\n              No hay transacciones registradas\r\n            </div>\r\n          ) : (\r\n            <div className=\"space-y-3\">\r\n              {transactions.map((transaction) => (\r\n                <article\r\n                  key={transaction.id}\r\n                  className=\"border border-gray-200 dark:border-gray-700 rounded-lg p-4 dark:bg-gray-800\"\r\n                >\r\n                  <div className=\"flex items-start justify-between\">\r\n                    <div className=\"flex-1\">\r\n                      <p className=\"text-sm font-medium text-gray-900 dark:text-gray-100\">\r\n                        {transaction.description}\r\n                      </p>\r\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\r\n                        {transaction.created_at\r\n                          ? new Date(transaction.created_at).toLocaleDateString(\"es-VE\", {\r\n                              year: \"numeric\",\r\n                              month: \"long\",\r\n                              day: \"numeric\",\r\n                            })\r\n                          : \"Fecha desconocida\"}\r\n                      </p>\r\n                      {transaction.invoice_number && (\r\n                        <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                          Factura: {transaction.invoice_number}\r\n                        </p>\r\n                      )}\r\n                    </div>\r\n                    <div className=\"text-right\">\r\n                      <p className=\"text-sm font-bold text-gray-900 dark:text-gray-100\">\r\n                        ${(transaction.amount || 0).toFixed(2)}\r\n                      </p>\r\n                      {transaction.status === \"paid\" ? (\r\n                        <span className=\"inline-flex items-center gap-1 text-xs font-medium text-green-700 dark:text-green-400 bg-green-100 dark:bg-green-900/30 px-2 py-0.5 rounded-full mt-1\">\r\n                          <Check className=\"h-3 w-3\" />\r\n                          Pagado\r\n                        </span>\r\n                      ) : (\r\n                        <span className=\"inline-flex items-center gap-1 text-xs font-medium text-yellow-700 dark:text-yellow-400 bg-yellow-100 dark:bg-yellow-900/30 px-2 py-0.5 rounded-full mt-1\">\r\n                          <Clock className=\"h-3 w-3\" />\r\n                          Pendiente\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"mt-3 flex gap-2\">\r\n                    <Button size=\"sm\" variant=\"outline\" className=\"flex-1\">\r\n                      <Download className=\"h-3 w-3 mr-2\" />\r\n                      Descargar\r\n                    </Button>\r\n                    {transaction.status === \"pending\" && (\r\n                      <Button size=\"sm\" className=\"flex-1\">\r\n                        Pagar Ahora\r\n                      </Button>\r\n                    )}\r\n                  </div>\r\n                </article>\r\n              ))}\r\n            </div>\r\n          )}\r\n\r\n          <Button variant=\"outline\" className=\"w-full\">\r\n            Ver Todas las Transacciones\r\n          </Button>\r\n\r\n          <aside className=\"bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4 mt-4\">\r\n            <h4 className=\"font-semibold text-gray-900 dark:text-gray-100 mb-2\">\r\n              Resumen del Mes\r\n            </h4>\r\n            <div className=\"space-y-2\">\r\n              <div className=\"flex justify-between text-sm\">\r\n                <span className=\"text-gray-600 dark:text-gray-400\">Total Gastado:</span>\r\n                <span className=\"font-semibold text-gray-900 dark:text-gray-100\">\r\n                  ${totalSpent.toFixed(2)}\r\n                </span>\r\n              </div>\r\n              <div className=\"flex justify-between text-sm\">\r\n                <span className=\"text-gray-600 dark:text-gray-400\">Consultas:</span>\r\n                <span className=\"font-semibold text-gray-900 dark:text-gray-100\">\r\n                  {transactions.filter((t) => t.status === \"paid\").length}\r\n                </span>\r\n              </div>\r\n              <div className=\"flex justify-between text-sm\">\r\n                <span className=\"text-gray-600 dark:text-gray-400\">Pendiente:</span>\r\n                <span className=\"font-semibold text-yellow-600 dark:text-yellow-400\">\r\n                  ${pendingAmount.toFixed(2)}\r\n                </span>\r\n              </div>\r\n            </div>\r\n          </aside>\r\n        </section>\r\n      </div>\r\n    </motion.article>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\components\\clinical-info-section.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\components\\lifestyle-habits-section.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[724,727],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[724,727],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[753,756],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[753,756],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[780,783],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[780,783],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { Label } from \"@red-salud/ui\";\r\n\r\nconst OPCIONES_FUMA = [\r\n  { value: \"no\", label: \"No fumo\" },\r\n  { value: \"si\", label: \"Sí, fumo actualmente\" },\r\n  { value: \"ex-fumador\", label: \"Ex-fumador\" },\r\n];\r\n\r\nconst OPCIONES_ALCOHOL = [\r\n  { value: \"no\", label: \"No consumo\" },\r\n  { value: \"ocasional\", label: \"Ocasional\" },\r\n  { value: \"regular\", label: \"Regular\" },\r\n  { value: \"frecuente\", label: \"Frecuente\" },\r\n];\r\n\r\nconst OPCIONES_ACTIVIDAD = [\r\n  { value: \"sedentario\", label: \"Sedentario\" },\r\n  { value: \"ligera\", label: \"Ligera\" },\r\n  { value: \"moderada\", label: \"Moderada\" },\r\n  { value: \"intensa\", label: \"Intensa\" },\r\n];\r\n\r\ninterface LifestyleHabitsProps {\r\n  isEditing: boolean;\r\n  localData: any;\r\n  setLocalData: (data: any) => void;\r\n  formData: any;\r\n}\r\n\r\nexport function LifestyleHabitsSection({\r\n  isEditing,\r\n  localData,\r\n  setLocalData,\r\n  formData,\r\n}: LifestyleHabitsProps) {\r\n  return (\r\n    <div className=\"bg-orange-50 border border-orange-200 rounded-lg p-4 space-y-3\">\r\n      <h4 className=\"font-semibold text-orange-900 text-sm\">\r\n        Hábitos de Vida\r\n      </h4>\r\n\r\n      {/* Tabaquismo */}\r\n      <div>\r\n        <Label htmlFor=\"fuma\" className=\"text-xs\">\r\n          Tabaquismo\r\n        </Label>\r\n        {isEditing ? (\r\n          <div className=\"grid grid-cols-3 gap-2 mt-1\">\r\n            {OPCIONES_FUMA.map((opt) => (\r\n              <button\r\n                key={opt.value}\r\n                type=\"button\"\r\n                onClick={() =>\r\n                  setLocalData({ ...localData, fuma: opt.value })\r\n                }\r\n                className={`px-2 py-1.5 rounded-md border-2 transition-all text-xs font-medium ${\r\n                  localData.fuma === opt.value\r\n                    ? \"border-orange-600 bg-orange-100 text-orange-900\"\r\n                    : \"border-gray-300 hover:border-gray-400 text-gray-700\"\r\n                }`}\r\n              >\r\n                {opt.label}\r\n              </button>\r\n            ))}\r\n          </div>\r\n        ) : (\r\n          <p className=\"text-sm font-medium text-gray-900 mt-1\">\r\n            {OPCIONES_FUMA.find((o) => o.value === formData.fuma)?.label ||\r\n              \"No registrado\"}\r\n          </p>\r\n        )}\r\n      </div>\r\n\r\n      {/* Alcohol */}\r\n      <div>\r\n        <Label htmlFor=\"consumeAlcohol\" className=\"text-xs\">\r\n          Alcohol\r\n        </Label>\r\n        {isEditing ? (\r\n          <div className=\"grid grid-cols-2 gap-2 mt-1\">\r\n            {OPCIONES_ALCOHOL.map((opt) => (\r\n              <button\r\n                key={opt.value}\r\n                type=\"button\"\r\n                onClick={() =>\r\n                  setLocalData({\r\n                    ...localData,\r\n                    consumeAlcohol: opt.value,\r\n                  })\r\n                }\r\n                className={`px-2 py-1.5 rounded-md border-2 transition-all text-xs font-medium ${\r\n                  localData.consumeAlcohol === opt.value\r\n                    ? \"border-orange-600 bg-orange-100 text-orange-900\"\r\n                    : \"border-gray-300 hover:border-gray-400 text-gray-700\"\r\n                }`}\r\n              >\r\n                {opt.label}\r\n              </button>\r\n            ))}\r\n          </div>\r\n        ) : (\r\n          <p className=\"text-sm font-medium text-gray-900 mt-1\">\r\n            {OPCIONES_ALCOHOL.find(\r\n              (o) => o.value === formData.consumeAlcohol\r\n            )?.label || \"No registrado\"}\r\n          </p>\r\n        )}\r\n      </div>\r\n\r\n      {/* Actividad Física */}\r\n      <div>\r\n        <Label htmlFor=\"actividadFisica\" className=\"text-xs\">\r\n          Actividad Física\r\n        </Label>\r\n        {isEditing ? (\r\n          <div className=\"grid grid-cols-2 gap-2 mt-1\">\r\n            {OPCIONES_ACTIVIDAD.map((opt) => (\r\n              <button\r\n                key={opt.value}\r\n                type=\"button\"\r\n                onClick={() =>\r\n                  setLocalData({\r\n                    ...localData,\r\n                    actividadFisica: opt.value,\r\n                  })\r\n                }\r\n                className={`px-2 py-1.5 rounded-md border-2 transition-all text-xs font-medium ${\r\n                  localData.actividadFisica === opt.value\r\n                    ? \"border-orange-600 bg-orange-100 text-orange-900\"\r\n                    : \"border-gray-300 hover:border-gray-400 text-gray-700\"\r\n                }`}\r\n              >\r\n                {opt.label}\r\n              </button>\r\n            ))}\r\n          </div>\r\n        ) : (\r\n          <p className=\"text-sm font-medium text-gray-900 mt-1\">\r\n            {OPCIONES_ACTIVIDAD.find(\r\n              (o) => o.value === formData.actividadFisica\r\n            )?.label || \"No registrado\"}\r\n          </p>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\components\\vital-data-section.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":16},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[371,374],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[371,374],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[400,403],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[400,403],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[427,430],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[427,430],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { Activity, Droplet } from \"lucide-react\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { Label } from \"@red-salud/ui\";\r\nimport { TIPOS_SANGRE } from \"../../constants\";\r\nimport { useImcCalculation } from \"../hooks/use-imc-calculation\";\r\n\r\ninterface VitalDataProps {\r\n  isEditing: boolean;\r\n  localData: any;\r\n  setLocalData: (data: any) => void;\r\n  formData: any;\r\n}\r\n\r\nexport function VitalDataSection({\r\n  isEditing,\r\n  localData,\r\n  setLocalData,\r\n  formData,\r\n}: VitalDataProps) {\r\n  const { imc, imcCategoria } = useImcCalculation(\r\n    localData.peso,\r\n    localData.altura\r\n  );\r\n\r\n  return (\r\n    <fieldset className=\"space-y-5\">\r\n      <legend className=\"font-semibold text-gray-900 mb-3 flex items-center gap-2\">\r\n        <Activity className=\"h-5 w-5 text-blue-600\" />\r\n        Datos Vitales y Físicos\r\n      </legend>\r\n\r\n      {/* Sexo Biológico */}\r\n      <div>\r\n        <Label htmlFor=\"sexoBiologico\">Sexo Biológico *</Label>\r\n        {isEditing ? (\r\n          <div className=\"flex gap-2 mt-2\">\r\n            <button\r\n              type=\"button\"\r\n              onClick={() =>\r\n                setLocalData({ ...localData, sexoBiologico: \"masculino\" })\r\n              }\r\n              className={`flex-1 px-3 py-2 rounded-md border-2 transition-all text-sm font-medium ${\r\n                localData.sexoBiologico === \"masculino\"\r\n                  ? \"border-blue-600 bg-blue-50 text-blue-900\"\r\n                  : \"border-gray-300 hover:border-gray-400 text-gray-700\"\r\n              }`}\r\n            >\r\n              Masculino\r\n            </button>\r\n            <button\r\n              type=\"button\"\r\n              onClick={() =>\r\n                setLocalData({ ...localData, sexoBiologico: \"femenino\" })\r\n              }\r\n              className={`flex-1 px-3 py-2 rounded-md border-2 transition-all text-sm font-medium ${\r\n                localData.sexoBiologico === \"femenino\"\r\n                  ? \"border-pink-600 bg-pink-50 text-pink-900\"\r\n                  : \"border-gray-300 hover:border-gray-400 text-gray-700\"\r\n              }`}\r\n            >\r\n              Femenino\r\n            </button>\r\n          </div>\r\n        ) : (\r\n          <p className=\"text-base font-medium text-gray-900 mt-1\">\r\n            {localData.sexoBiologico\r\n              ? localData.sexoBiologico.charAt(0).toUpperCase() +\r\n                localData.sexoBiologico.slice(1)\r\n              : \"No registrado\"}\r\n          </p>\r\n        )}\r\n      </div>\r\n\r\n      {/* Tipo de Sangre */}\r\n      <div>\r\n        <Label className=\"flex items-center gap-2\">\r\n          <Droplet className=\"h-4 w-4 text-red-600\" />\r\n          Tipo de Sangre *\r\n        </Label>\r\n        {isEditing ? (\r\n          <div className=\"grid grid-cols-4 gap-2 mt-2\">\r\n            {TIPOS_SANGRE.map((tipo) => (\r\n              <button\r\n                key={tipo}\r\n                type=\"button\"\r\n                onClick={() =>\r\n                  setLocalData({ ...localData, tipoSangre: tipo })\r\n                }\r\n                className={`px-2 py-1.5 rounded-md border-2 font-semibold text-sm transition-all ${\r\n                  localData.tipoSangre === tipo\r\n                    ? \"border-red-600 bg-red-50 text-red-900\"\r\n                    : \"border-gray-300 hover:border-gray-400 text-gray-700\"\r\n                }`}\r\n              >\r\n                {tipo}\r\n              </button>\r\n            ))}\r\n          </div>\r\n        ) : (\r\n          <p className=\"text-base font-medium text-gray-900 mt-1\">\r\n            {formData.tipoSangre || \"No registrado\"}\r\n          </p>\r\n        )}\r\n      </div>\r\n\r\n      {/* Donante de Sangre */}\r\n      <div>\r\n        <Label htmlFor=\"donanteSangre\">¿Donante de Sangre?</Label>\r\n        {isEditing ? (\r\n          <div className=\"flex gap-2 mt-2\">\r\n            <button\r\n              type=\"button\"\r\n              onClick={() =>\r\n                setLocalData({ ...localData, donanteSangre: \"si\" })\r\n              }\r\n              className={`flex-1 px-3 py-2 rounded-md border-2 transition-all text-sm font-medium ${\r\n                localData.donanteSangre === \"si\"\r\n                  ? \"border-green-600 bg-green-50 text-green-900\"\r\n                  : \"border-gray-300 hover:border-gray-400 text-gray-700\"\r\n              }`}\r\n            >\r\n              Sí\r\n            </button>\r\n            <button\r\n              type=\"button\"\r\n              onClick={() =>\r\n                setLocalData({ ...localData, donanteSangre: \"no\" })\r\n              }\r\n              className={`flex-1 px-3 py-2 rounded-md border-2 transition-all text-sm font-medium ${\r\n                localData.donanteSangre === \"no\"\r\n                  ? \"border-gray-600 bg-gray-50 text-gray-900\"\r\n                  : \"border-gray-300 hover:border-gray-400 text-gray-700\"\r\n              }`}\r\n            >\r\n              No\r\n            </button>\r\n          </div>\r\n        ) : (\r\n          <p className=\"text-base font-medium text-gray-900 mt-1\">\r\n            {localData.donanteSangre === \"si\"\r\n              ? \"Sí\"\r\n              : localData.donanteSangre === \"no\"\r\n              ? \"No\"\r\n              : \"No especificado\"}\r\n          </p>\r\n        )}\r\n      </div>\r\n\r\n      {/* Peso y Altura */}\r\n      <div className=\"grid grid-cols-2 gap-3\">\r\n        <div>\r\n          <Label htmlFor=\"peso\">Peso (kg) *</Label>\r\n          {isEditing ? (\r\n            <Input\r\n              id=\"peso\"\r\n              type=\"number\"\r\n              step=\"0.1\"\r\n              placeholder=\"70.5\"\r\n              value={localData.peso || \"\"}\r\n              onChange={(e) =>\r\n                setLocalData({ ...localData, peso: e.target.value })\r\n              }\r\n              required\r\n            />\r\n          ) : (\r\n            <p className=\"text-base font-medium text-gray-900 mt-1\">\r\n              {formData.peso ? `${formData.peso} kg` : \"No registrado\"}\r\n            </p>\r\n          )}\r\n        </div>\r\n        <div>\r\n          <Label htmlFor=\"altura\">Altura (cm) *</Label>\r\n          {isEditing ? (\r\n            <Input\r\n              id=\"altura\"\r\n              type=\"number\"\r\n              placeholder=\"170\"\r\n              value={localData.altura || \"\"}\r\n              onChange={(e) =>\r\n                setLocalData({ ...localData, altura: e.target.value })\r\n              }\r\n              required\r\n            />\r\n          ) : (\r\n            <p className=\"text-base font-medium text-gray-900 mt-1\">\r\n              {formData.altura ? `${formData.altura} cm` : \"No registrado\"}\r\n            </p>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* IMC */}\r\n      {imc && (\r\n        <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-3\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <p className=\"text-xs text-blue-700 font-medium\">IMC</p>\r\n              <p className=\"text-2xl font-bold text-blue-900 mt-1\">\r\n                {imc.toFixed(1)}\r\n              </p>\r\n            </div>\r\n            <span\r\n              className={`px-3 py-1 rounded-full text-xs font-semibold ${\r\n                imcCategoria === \"Normal\"\r\n                  ? \"bg-green-100 text-green-800\"\r\n                  : imcCategoria === \"Bajo peso\"\r\n                  ? \"bg-yellow-100 text-yellow-800\"\r\n                  : \"bg-orange-100 text-orange-800\"\r\n              }`}\r\n            >\r\n              {imcCategoria}\r\n            </span>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Presión Arterial */}\r\n      <div>\r\n        <Label>Presión Arterial (mmHg)</Label>\r\n        <div className=\"grid grid-cols-2 gap-3 mt-1\">\r\n          <div>\r\n            {isEditing ? (\r\n              <Input\r\n                type=\"number\"\r\n                placeholder=\"120\"\r\n                value={localData.presionSistolica || \"\"}\r\n                onChange={(e) =>\r\n                  setLocalData({\r\n                    ...localData,\r\n                    presionSistolica: e.target.value,\r\n                  })\r\n                }\r\n              />\r\n            ) : (\r\n              <p className=\"text-base font-medium text-gray-900\">\r\n                {formData.presionSistolica || \"--\"}\r\n              </p>\r\n            )}\r\n            <p className=\"text-xs text-gray-500 mt-1\">Sistólica</p>\r\n          </div>\r\n          <div>\r\n            {isEditing ? (\r\n              <Input\r\n                type=\"number\"\r\n                placeholder=\"80\"\r\n                value={localData.presionDiastolica || \"\"}\r\n                onChange={(e) =>\r\n                  setLocalData({\r\n                    ...localData,\r\n                    presionDiastolica: e.target.value,\r\n                  })\r\n                }\r\n              />\r\n            ) : (\r\n              <p className=\"text-base font-medium text-gray-900\">\r\n                {formData.presionDiastolica || \"--\"}\r\n              </p>\r\n            )}\r\n            <p className=\"text-xs text-gray-500 mt-1\">Diastólica</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Donante de Órganos */}\r\n      <div>\r\n        <Label htmlFor=\"donanteOrganos\">¿Donante de Órganos?</Label>\r\n        {isEditing ? (\r\n          <div className=\"grid grid-cols-3 gap-2 mt-2\">\r\n            <button\r\n              type=\"button\"\r\n              onClick={() =>\r\n                setLocalData({ ...localData, donanteOrganos: \"si\" })\r\n              }\r\n              className={`px-3 py-2 rounded-md border-2 transition-all text-sm font-medium ${\r\n                localData.donanteOrganos === \"si\"\r\n                  ? \"border-green-600 bg-green-50 text-green-900\"\r\n                  : \"border-gray-300 hover:border-gray-400 text-gray-700\"\r\n              }`}\r\n            >\r\n              Sí\r\n            </button>\r\n            <button\r\n              type=\"button\"\r\n              onClick={() =>\r\n                setLocalData({ ...localData, donanteOrganos: \"no\" })\r\n              }\r\n              className={`px-3 py-2 rounded-md border-2 transition-all text-sm font-medium ${\r\n                localData.donanteOrganos === \"no\"\r\n                  ? \"border-gray-600 bg-gray-50 text-gray-900\"\r\n                  : \"border-gray-300 hover:border-gray-400 text-gray-700\"\r\n              }`}\r\n            >\r\n              No\r\n            </button>\r\n            <button\r\n              type=\"button\"\r\n              onClick={() =>\r\n                setLocalData({\r\n                  ...localData,\r\n                  donanteOrganos: \"no_especificado\",\r\n                })\r\n              }\r\n              className={`px-3 py-2 rounded-md border-2 transition-all text-sm font-medium ${\r\n                localData.donanteOrganos === \"no_especificado\"\r\n                  ? \"border-gray-600 bg-gray-50 text-gray-900\"\r\n                  : \"border-gray-300 hover:border-gray-400 text-gray-700\"\r\n              }`}\r\n            >\r\n              No especificar\r\n            </button>\r\n          </div>\r\n        ) : (\r\n          <p className=\"text-base font-medium text-gray-900 mt-1\">\r\n            {localData.donanteOrganos === \"si\"\r\n              ? \"Sí\"\r\n              : localData.donanteOrganos === \"no\"\r\n              ? \"No\"\r\n              : \"No especificado\"}\r\n          </p>\r\n        )}\r\n      </div>\r\n    </fieldset>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\components\\women-health-section.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[125,128],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[125,128],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[154,157],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[154,157],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[181,184],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[181,184],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { Label } from \"@red-salud/ui\";\r\n\r\ninterface WomenHealthProps {\r\n  isEditing: boolean;\r\n  localData: any;\r\n  setLocalData: (data: any) => void;\r\n  formData: any;\r\n}\r\n\r\nexport function WomenHealthSection({\r\n  isEditing,\r\n  localData,\r\n  setLocalData,\r\n  formData,\r\n}: WomenHealthProps) {\r\n  return (\r\n    <div className=\"bg-pink-50 border border-pink-200 rounded-lg p-4 space-y-3\">\r\n      <h4 className=\"font-semibold text-pink-900 text-sm\">\r\n        Información Específica\r\n      </h4>\r\n\r\n      <div className=\"grid grid-cols-2 gap-3\">\r\n        <div>\r\n          <Label htmlFor=\"embarazada\" className=\"text-xs\">\r\n            ¿Embarazada?\r\n          </Label>\r\n          {isEditing ? (\r\n            <select\r\n              id=\"embarazada\"\r\n              value={localData.embarazada ? \"si\" : \"no\"}\r\n              onChange={(e) =>\r\n                setLocalData({\r\n                  ...localData,\r\n                  embarazada: e.target.value === \"si\",\r\n                })\r\n              }\r\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-md text-sm\"\r\n            >\r\n              <option value=\"no\">No</option>\r\n              <option value=\"si\">Sí</option>\r\n            </select>\r\n          ) : (\r\n            <p className=\"text-sm font-medium text-gray-900 mt-1\">\r\n              {formData.embarazada ? \"Sí\" : \"No\"}\r\n            </p>\r\n          )}\r\n        </div>\r\n\r\n        <div>\r\n          <Label htmlFor=\"lactancia\" className=\"text-xs\">\r\n            ¿Lactancia?\r\n          </Label>\r\n          {isEditing ? (\r\n            <select\r\n              id=\"lactancia\"\r\n              value={localData.lactancia ? \"si\" : \"no\"}\r\n              onChange={(e) =>\r\n                setLocalData({\r\n                  ...localData,\r\n                  lactancia: e.target.value === \"si\",\r\n                })\r\n              }\r\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-md text-sm\"\r\n            >\r\n              <option value=\"no\">No</option>\r\n              <option value=\"si\">Sí</option>\r\n            </select>\r\n          ) : (\r\n            <p className=\"text-sm font-medium text-gray-900 mt-1\">\r\n              {formData.lactancia ? \"Sí\" : \"No\"}\r\n            </p>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\documents-tab-didit.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'parentLoading' is defined but never used.","line":21,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { motion } from \"framer-motion\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport {\r\n  FileText,\r\n  Check,\r\n  Clock,\r\n  XCircle,\r\n  AlertCircle,\r\n  ExternalLink,\r\n  Shield,\r\n  Loader2,\r\n} from \"lucide-react\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport type { TabComponentProps } from \"../types\";\r\n\r\nexport function DocumentsTabDidit({\r\n  formData,\r\n  isLoading: parentLoading,\r\n}: Omit<TabComponentProps, \"setFormData\" | \"isEditing\" | \"setIsEditing\" | \"handleSave\">) {\r\n  const [isCreatingSession, setIsCreatingSession] = useState(false);\r\n  const [sessionUrl, setSessionUrl] = useState<string | null>(null);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [isPolling, setIsPolling] = useState(false);\r\n  const router = useRouter();\r\n\r\n  // Polling para verificar si el estado cambió\r\n  useEffect(() => {\r\n    if (!isPolling) return;\r\n\r\n    const checkAndSync = async () => {\r\n      try {\r\n        console.log(\"🔄 Verificando y sincronizando estado...\");\r\n        \r\n        // Primero verificar el estado\r\n        const checkResponse = await fetch(\"/api/didit/check-status\");\r\n        if (checkResponse.ok) {\r\n          const checkData = await checkResponse.json();\r\n          console.log(\"📊 Estado actual:\", checkData);\r\n          \r\n          // Si está aprobado en Didit pero no localmente, forzar sincronización\r\n          if (checkData.needs_update) {\r\n            console.log(\"⚠️ Estado desincronizado, sincronizando...\");\r\n            // Aquí necesitaríamos el userId, lo obtendremos del formData si está disponible\r\n            // Por ahora, solo refrescamos\r\n          }\r\n          \r\n          // Si está completado, detener polling\r\n          if (checkData.didit_status === \"Approved\" && checkData.local_photo_verified) {\r\n            console.log(\"✅ Verificación completada y sincronizada\");\r\n            setIsPolling(false);\r\n          }\r\n        }\r\n        \r\n        router.refresh(); // Recargar datos del servidor\r\n      } catch (error) {\r\n        console.error(\"Error al verificar estado:\", error);\r\n      }\r\n    };\r\n\r\n    // Verificar inmediatamente\r\n    checkAndSync();\r\n    \r\n    // Luego cada 3 segundos (más frecuente para mejor UX)\r\n    const interval = setInterval(checkAndSync, 3000);\r\n\r\n    return () => clearInterval(interval);\r\n  }, [isPolling, router]);\r\n\r\n  const handleStartVerification = async () => {\r\n    setIsCreatingSession(true);\r\n    setError(null);\r\n\r\n    try {\r\n      console.log(\"🚀 Iniciando verificación...\");\r\n      \r\n      const response = await fetch(\"/api/didit/create-session\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n      });\r\n\r\n      console.log(\"📥 Respuesta recibida:\", response.status);\r\n\r\n      if (!response.ok) {\r\n        const errorData = await response.json();\r\n        console.error(\"❌ Error en respuesta:\", errorData);\r\n        throw new Error(errorData.error || \"Error al crear sesión de verificación\");\r\n      }\r\n\r\n      const data = await response.json();\r\n      console.log(\"📦 Datos recibidos:\", data);\r\n      \r\n      if (data.session_url) {\r\n        console.log(\"✅ Abriendo URL:\", data.session_url);\r\n        setSessionUrl(data.session_url);\r\n        \r\n        // Iniciar polling para verificar actualizaciones\r\n        setIsPolling(true);\r\n        \r\n        // Abrir en ventana emergente (popup) centrada - más ancha\r\n        const width = 700;\r\n        const height = 700;\r\n        const left = (window.screen.width - width) / 2;\r\n        const top = (window.screen.height - height) / 2;\r\n        const features = `width=${width},height=${height},left=${left},top=${top},resizable=yes,scrollbars=yes`;\r\n        \r\n        const newWindow = window.open(data.session_url, \"DiditVerification\", features);\r\n        if (!newWindow) {\r\n          setError(\"No se pudo abrir la ventana. Por favor, permite ventanas emergentes.\");\r\n          setIsPolling(false);\r\n        } else {\r\n          // Detectar cuando se cierra la ventana o cuando se completa la verificación\r\n          const checkClosed = setInterval(() => {\r\n            if (newWindow.closed) {\r\n              console.log(\"🔄 Ventana cerrada, actualizando datos...\");\r\n              clearInterval(checkClosed);\r\n              setIsPolling(false);\r\n              router.refresh();\r\n            }\r\n          }, 1000);\r\n          \r\n          // Escuchar mensajes de la ventana de Didit para cerrar automáticamente\r\n          const handleMessage = (event: MessageEvent) => {\r\n            // Verificar que el mensaje viene de Didit\r\n            if (event.origin === \"https://verify.didit.me\") {\r\n              console.log(\"📨 Mensaje de Didit:\", event.data);\r\n              if (event.data.type === \"verification_complete\" || event.data.status === \"completed\") {\r\n                console.log(\"✅ Verificación completada, cerrando ventana...\");\r\n                newWindow.close();\r\n                clearInterval(checkClosed);\r\n                setIsPolling(false);\r\n                router.refresh();\r\n              }\r\n            }\r\n          };\r\n          \r\n          window.addEventListener(\"message\", handleMessage);\r\n          \r\n          // Limpiar listener cuando se cierre la ventana\r\n          const cleanupInterval = setInterval(() => {\r\n            if (newWindow.closed) {\r\n              window.removeEventListener(\"message\", handleMessage);\r\n              clearInterval(cleanupInterval);\r\n            }\r\n          }, 1000);\r\n        }\r\n      } else {\r\n        console.warn(\"⚠️ No se recibió session_url en la respuesta\");\r\n        setError(\"No se recibió la URL de verificación. Intenta nuevamente.\");\r\n      }\r\n    } catch (err) {\r\n      console.error(\"❌ Error:\", err);\r\n      setError(err instanceof Error ? err.message : \"Error desconocido\");\r\n    } finally {\r\n      setIsCreatingSession(false);\r\n    }\r\n  };\r\n\r\n  const getStatusBadge = () => {\r\n    if (formData.photoVerified) {\r\n      return (\r\n        <span className=\"inline-flex items-center gap-1 text-xs font-medium text-green-700 bg-green-100 px-2 py-1 rounded-full\">\r\n          <Check className=\"h-3 w-3\" aria-hidden=\"true\" />\r\n          Verificado\r\n        </span>\r\n      );\r\n    }\r\n    if (formData.cedulaVerificada) {\r\n      return (\r\n        <span className=\"inline-flex items-center gap-1 text-xs font-medium text-yellow-700 bg-yellow-100 px-2 py-1 rounded-full\">\r\n          <Clock className=\"h-3 w-3\" aria-hidden=\"true\" />\r\n          Pendiente\r\n        </span>\r\n      );\r\n    }\r\n    return (\r\n      <span className=\"inline-flex items-center gap-1 text-xs font-medium text-gray-700 bg-gray-100 px-2 py-1 rounded-full\">\r\n        <XCircle className=\"h-3 w-3\" aria-hidden=\"true\" />\r\n        No Verificado\r\n      </span>\r\n    );\r\n  };\r\n\r\n  const progressPercentage = formData.photoVerified ? 100 : formData.cedulaVerificada ? 50 : 0;\r\n\r\n  return (\r\n    <motion.article\r\n      key=\"documents\"\r\n      initial={{ opacity: 0, x: -20 }}\r\n      animate={{ opacity: 1, x: 0 }}\r\n      exit={{ opacity: 0, x: 20 }}\r\n      className=\"max-h-full\"\r\n    >\r\n      <header className=\"mb-2\">\r\n        <div className=\"flex items-center gap-2 mb-0.5\">\r\n          <Shield className=\"h-5 w-5 text-blue-600\" />\r\n          <h2 className=\"text-lg font-semibold text-gray-900\">\r\n            Verificación de Identidad\r\n          </h2>\r\n        </div>\r\n        <p className=\"text-xs text-gray-500\">\r\n          Verifica tu identidad de forma segura con tecnología AI\r\n        </p>\r\n      </header>\r\n\r\n      {/* Top Row: 3 Cards */}\r\n      <div className=\"grid grid-cols-3 gap-2 mb-3\">\r\n        {/* Estado de Verificación */}\r\n        <aside className=\"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-2.5\">\r\n          <h3 className=\"font-semibold text-xs text-blue-900 mb-0.5\">\r\n            Estado de Verificación\r\n          </h3>\r\n          <p className=\"text-xs text-blue-700 mb-1.5\">\r\n            {formData.photoVerified\r\n              ? \"✅ Completado\"\r\n              : formData.cedulaVerificada\r\n              ? \"⏳ En proceso\"\r\n              : \"🔒 Pendiente\"}\r\n          </p>\r\n          <div className=\"flex items-end justify-between mb-1\">\r\n            <div className=\"text-2xl font-bold text-blue-600\">\r\n              {progressPercentage}%\r\n            </div>\r\n            <p className=\"text-xs text-blue-700 mb-0.5\">Completado</p>\r\n          </div>\r\n          <div className=\"w-full bg-blue-200 rounded-full h-1.5\">\r\n            <div\r\n              className=\"bg-blue-600 h-1.5 rounded-full transition-all duration-500\"\r\n              style={{ width: `${progressPercentage}%` }}\r\n              role=\"progressbar\"\r\n              aria-valuenow={progressPercentage}\r\n              aria-valuemin={0}\r\n              aria-valuemax={100}\r\n            />\r\n          </div>\r\n        </aside>\r\n\r\n        {/* Documento de Identidad */}\r\n        <article className=\"border border-gray-200 rounded-lg p-2.5 hover:border-blue-300 transition-colors\">\r\n          <div className=\"flex items-start gap-2\">\r\n            <div className=\"p-1.5 bg-gradient-to-br from-blue-100 to-indigo-100 rounded-lg flex-shrink-0\">\r\n              <FileText className=\"h-4 w-4 text-blue-600\" />\r\n            </div>\r\n            <div className=\"flex-1 min-w-0\">\r\n              <h4 className=\"font-medium text-xs text-gray-900 mb-0.5\">\r\n                Documento de Identidad\r\n              </h4>\r\n              <p className=\"text-xs text-gray-500 mb-1 truncate\">\r\n                {formData.photoVerified\r\n                  ? `Verificado el ${formData.cedulaPhotoVerifiedAt ? new Date(formData.cedulaPhotoVerifiedAt).toLocaleDateString(\"es-VE\") : \"recientemente\"}`\r\n                  : formData.cedulaVerificada\r\n                  ? \"Verificación en proceso\"\r\n                  : \"Pendiente de verificación\"}\r\n              </p>\r\n              {getStatusBadge()}\r\n            </div>\r\n          </div>\r\n        </article>\r\n\r\n        {/* Info Section */}\r\n        <aside className=\"bg-gray-50 border border-gray-200 rounded-lg p-2.5\">\r\n          <h5 className=\"font-medium text-gray-900 text-xs mb-0.5\">\r\n            ℹ️ ¿Por qué verificar?\r\n          </h5>\r\n          <p className=\"text-xs text-gray-600 leading-snug\">\r\n            Requerido por regulaciones de salud para garantizar seguridad y cumplir con normativas médicas.\r\n          </p>\r\n        </aside>\r\n      </div>\r\n\r\n      {/* Error Message */}\r\n      {error && (\r\n        <aside className=\"bg-red-50 border border-red-200 rounded-lg p-2.5 mb-3\">\r\n          <div className=\"flex items-start gap-2\">\r\n            <AlertCircle className=\"h-4 w-4 text-red-600 mt-0.5\" />\r\n            <div>\r\n              <h4 className=\"font-semibold text-xs text-red-900\">Error</h4>\r\n              <p className=\"text-xs text-red-800 mt-0.5\">{error}</p>\r\n            </div>\r\n          </div>\r\n        </aside>\r\n      )}\r\n\r\n      {/* Action Section */}\r\n      {formData.photoVerified ? (\r\n        <aside className=\"bg-green-50 border border-green-200 rounded-lg p-3\">\r\n          <div className=\"flex items-start gap-2\">\r\n            <Check className=\"h-5 w-5 text-green-600 mt-0.5\" />\r\n            <div className=\"flex-1\">\r\n              <h4 className=\"font-semibold text-green-900 text-sm\">\r\n                ✅ Verificación Completa\r\n              </h4>\r\n              <p className=\"text-xs text-green-800 mt-0.5\">\r\n                Tu identidad ha sido verificada exitosamente. Puedes acceder a todos los servicios.\r\n              </p>\r\n              {formData.cedula && (\r\n                <div className=\"mt-1.5 p-1.5 bg-white rounded-md border border-green-200\">\r\n                  <p className=\"text-xs text-green-700 font-medium\">Documento Verificado</p>\r\n                  <p className=\"text-xs text-gray-900 mt-0.5\">Cédula: {formData.cedula}</p>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </aside>\r\n      ) : (\r\n        <aside className=\"bg-white border-2 border-blue-200 rounded-lg p-3\">\r\n          <div className=\"flex items-start gap-2\">\r\n            <div className=\"p-1.5 bg-blue-100 rounded-lg flex-shrink-0\">\r\n              <Shield className=\"h-5 w-5 text-blue-600\" />\r\n            </div>\r\n            <div className=\"flex-1\">\r\n              <h4 className=\"font-semibold text-gray-900 text-sm mb-0.5\">\r\n                Verificación de Identidad con Didit\r\n              </h4>\r\n              <p className=\"text-xs text-gray-600 mb-1.5\">\r\n                Verifica tu identidad de forma rápida y segura. El proceso incluye:\r\n              </p>\r\n              <div className=\"grid grid-cols-2 gap-x-2 gap-y-0.5 mb-2\">\r\n                <div className=\"flex items-start gap-1\">\r\n                  <Check className=\"h-3 w-3 text-green-600 mt-0.5 flex-shrink-0\" />\r\n                  <span className=\"text-xs text-gray-600\">Captura de documento de identidad</span>\r\n                </div>\r\n                <div className=\"flex items-start gap-1\">\r\n                  <Check className=\"h-3 w-3 text-green-600 mt-0.5 flex-shrink-0\" />\r\n                  <span className=\"text-xs text-gray-600\">Verificación de autenticidad con IA</span>\r\n                </div>\r\n                <div className=\"flex items-start gap-1\">\r\n                  <Check className=\"h-3 w-3 text-green-600 mt-0.5 flex-shrink-0\" />\r\n                  <span className=\"text-xs text-gray-600\">Detección de vida para prevenir fraude</span>\r\n                </div>\r\n                <div className=\"flex items-start gap-1\">\r\n                  <Check className=\"h-3 w-3 text-green-600 mt-0.5 flex-shrink-0\" />\r\n                  <span className=\"text-xs text-gray-600\">Comparación facial con el documento</span>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"bg-blue-50 border border-blue-200 rounded-md p-1.5 mb-2\">\r\n                <p className=\"text-xs text-blue-900 font-medium mb-0.5\">\r\n                  🔒 Proceso Seguro y Privado\r\n                </p>\r\n                <p className=\"text-xs text-blue-800\">\r\n                  Encriptación nivel bancario. Toma 2-3 minutos.\r\n                </p>\r\n              </div>\r\n\r\n              <div className=\"flex justify-center mb-1.5\">\r\n                <Button\r\n                  onClick={handleStartVerification}\r\n                  disabled={isCreatingSession}\r\n                  className=\"px-4 h-8 text-xs\"\r\n                  size=\"sm\"\r\n                >\r\n                  {isCreatingSession ? (\r\n                    <>\r\n                      <Loader2 className=\"h-4 w-4 mr-1.5 animate-spin\" />\r\n                      Iniciando...\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <Shield className=\"h-4 w-4 mr-1.5\" />\r\n                      Iniciar Verificación\r\n                      <ExternalLink className=\"h-3 w-3 ml-1.5\" />\r\n                    </>\r\n                  )}\r\n                </Button>\r\n              </div>\r\n\r\n              {sessionUrl && (\r\n                <div className=\"mt-1.5 p-1.5 bg-yellow-50 border border-yellow-200 rounded-md\">\r\n                  <p className=\"text-xs text-yellow-900 font-medium mb-0.5\">\r\n                    📱 Ventana Abierta\r\n                  </p>\r\n                  <a\r\n                    href={sessionUrl}\r\n                    target=\"_blank\"\r\n                    rel=\"noopener noreferrer\"\r\n                    className=\"text-xs text-blue-600 hover:text-blue-800 underline flex items-center gap-1\"\r\n                  >\r\n                    Abrir verificación\r\n                    <ExternalLink className=\"h-3 w-3\" />\r\n                  </a>\r\n                </div>\r\n              )}\r\n\r\n              <p className=\"text-xs text-gray-500 mt-1.5 text-center\">\r\n                Al continuar, aceptas el procesamiento de datos para verificación\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </aside>\r\n      )}\r\n\r\n\r\n    </motion.article>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\documents-tab.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[424,427],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[424,427],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1536,1539],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1536,1539],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":252,"column":37,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[9151,9178],"text":"Ir a la sección &quot;Mi Perfil\""},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[9151,9178],"text":"Ir a la sección &ldquo;Mi Perfil\""},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[9151,9178],"text":"Ir a la sección &#34;Mi Perfil\""},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[9151,9178],"text":"Ir a la sección &rdquo;Mi Perfil\""},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":252,"column":47,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[9151,9178],"text":"Ir a la sección \"Mi Perfil&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[9151,9178],"text":"Ir a la sección \"Mi Perfil&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[9151,9178],"text":"Ir a la sección \"Mi Perfil&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[9151,9178],"text":"Ir a la sección \"Mi Perfil&rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":255,"column":35,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[9322,9367],"text":"Hacer clic en &quot;Guardar\" para anclar tu cédula"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[9322,9367],"text":"Hacer clic en &ldquo;Guardar\" para anclar tu cédula"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[9322,9367],"text":"Hacer clic en &#34;Guardar\" para anclar tu cédula"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[9322,9367],"text":"Hacer clic en &rdquo;Guardar\" para anclar tu cédula"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":255,"column":43,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[9322,9367],"text":"Hacer clic en \"Guardar&quot; para anclar tu cédula"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[9322,9367],"text":"Hacer clic en \"Guardar&ldquo; para anclar tu cédula"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[9322,9367],"text":"Hacer clic en \"Guardar&#34; para anclar tu cédula"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[9322,9367],"text":"Hacer clic en \"Guardar&rdquo; para anclar tu cédula"},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\r\nimport { motion } from \"framer-motion\";\r\nimport {\r\n  FileText,\r\n  Check,\r\n  Clock,\r\n  XCircle,\r\n  AlertCircle,\r\n} from \"lucide-react\";\r\nimport { CedulaPhotoUpload } from \"../components/cedula-photo-upload\";\r\n\r\ninterface DocumentsTabProps {\r\n  userId?: string;\r\n}\r\n\r\nexport function DocumentsTab({ userId }: DocumentsTabProps) {\r\n  const [profileData, setProfileData] = useState<any>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [daysRemaining, setDaysRemaining] = useState<number | null>(null);\r\n\r\n  useEffect(() => {\r\n    loadProfileData();\r\n  }, [userId]);\r\n\r\n  const loadProfileData = async () => {\r\n    setIsLoading(true);\r\n    try {\r\n      const response = await fetch(\"/api/profile/get\");\r\n      if (response.ok) {\r\n        const result = await response.json();\r\n        if (!result.error && result.data) {\r\n          setProfileData(result.data);\r\n          \r\n          // Calcular días restantes\r\n          if (result.data.photoUploadDeadline) {\r\n            const deadline = new Date(result.data.photoUploadDeadline);\r\n            const now = new Date();\r\n            const diff = deadline.getTime() - now.getTime();\r\n            const days = Math.ceil(diff / (1000 * 60 * 60 * 24));\r\n            setDaysRemaining(days > 0 ? days : 0);\r\n          }\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error loading profile:\", error);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleVerificationComplete = async (data: any) => {\r\n    if (data.verified) {\r\n      // Actualizar el perfil con la verificación de foto\r\n      try {\r\n        const response = await fetch(\"/api/profile/update\", {\r\n          method: \"POST\",\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n          },\r\n          body: JSON.stringify({\r\n            userId,\r\n            photoVerified: true,\r\n            diditRequestId: data.requestId,\r\n          }),\r\n        });\r\n\r\n        if (response.ok) {\r\n          await loadProfileData();\r\n          alert(\"¡Cédula verificada exitosamente con foto!\");\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error updating profile:\", error);\r\n      }\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <motion.article\r\n        key=\"documents\"\r\n        initial={{ opacity: 0, x: -20 }}\r\n        animate={{ opacity: 1, x: 0 }}\r\n        exit={{ opacity: 0, x: 20 }}\r\n      >\r\n        <p className=\"text-center text-gray-500\">Cargando...</p>\r\n      </motion.article>\r\n    );\r\n  }\r\n\r\n  const getStatusBadge = () => {\r\n    if (profileData?.photoVerified) {\r\n      return (\r\n        <span className=\"inline-flex items-center gap-1 text-xs font-medium text-green-700 bg-green-100 px-2 py-1 rounded-full\">\r\n          <Check className=\"h-3 w-3\" aria-hidden=\"true\" />\r\n          Verificado\r\n        </span>\r\n      );\r\n    }\r\n    if (profileData?.cedulaVerificada) {\r\n      return (\r\n        <span className=\"inline-flex items-center gap-1 text-xs font-medium text-yellow-700 bg-yellow-100 px-2 py-1 rounded-full\">\r\n          <Clock className=\"h-3 w-3\" aria-hidden=\"true\" />\r\n          Pendiente\r\n        </span>\r\n      );\r\n    }\r\n    return (\r\n      <span className=\"inline-flex items-center gap-1 text-xs font-medium text-gray-700 bg-gray-100 px-2 py-1 rounded-full\">\r\n        <XCircle className=\"h-3 w-3\" aria-hidden=\"true\" />\r\n        No Disponible\r\n      </span>\r\n    );\r\n  };\r\n\r\n  const progressPercentage = profileData?.photoVerified ? 100 : profileData?.cedulaVerificada ? 50 : 0;\r\n\r\n  return (\r\n    <motion.article\r\n      key=\"documents\"\r\n      initial={{ opacity: 0, x: -20 }}\r\n      animate={{ opacity: 1, x: 0 }}\r\n      exit={{ opacity: 0, x: 20 }}\r\n    >\r\n      <header className=\"mb-6\">\r\n        <h2 className=\"text-xl font-semibold text-gray-900\">\r\n          Verificación de Cédula con Foto\r\n        </h2>\r\n        <p className=\"text-sm text-gray-500 mt-1\">\r\n          Verifica tu identidad subiendo una foto de tu cédula\r\n        </p>\r\n      </header>\r\n\r\n      {/* Verification Status */}\r\n      <aside className=\"bg-blue-50 border border-blue-200 rounded-lg p-6 mb-6\">\r\n        <div className=\"flex items-center justify-between mb-4\">\r\n          <div>\r\n            <h3 className=\"font-semibold text-blue-900\">\r\n              Estado de Verificación\r\n            </h3>\r\n            <p className=\"text-sm text-blue-700 mt-1\">\r\n              {profileData?.photoVerified\r\n                ? \"Cédula verificada con foto\"\r\n                : profileData?.cedulaVerificada\r\n                ? \"Cédula anclada - Falta verificación con foto\"\r\n                : \"Primero debes anclar tu cédula en Mi Perfil\"}\r\n            </p>\r\n          </div>\r\n          <div className=\"text-right\">\r\n            <div className=\"text-3xl font-bold text-blue-600\">\r\n              {progressPercentage}%\r\n            </div>\r\n            <p className=\"text-xs text-blue-700\">Completado</p>\r\n          </div>\r\n        </div>\r\n        <div className=\"w-full bg-blue-200 rounded-full h-2\">\r\n          <div\r\n            className=\"bg-blue-600 h-2 rounded-full transition-all\"\r\n            style={{ width: `${progressPercentage}%` }}\r\n            role=\"progressbar\"\r\n            aria-valuenow={progressPercentage}\r\n            aria-valuemin={0}\r\n            aria-valuemax={100}\r\n          />\r\n        </div>\r\n      </aside>\r\n\r\n      {/* Deadline Warning */}\r\n      {profileData?.cedulaVerificada && !profileData?.photoVerified && daysRemaining !== null && (\r\n        <aside className={`border rounded-lg p-4 mb-6 ${\r\n          daysRemaining <= 7\r\n            ? \"bg-red-50 border-red-200\"\r\n            : \"bg-yellow-50 border-yellow-200\"\r\n        }`}>\r\n          <div className=\"flex items-start gap-3\">\r\n            <AlertCircle className={`h-5 w-5 mt-0.5 ${\r\n              daysRemaining <= 7 ? \"text-red-600\" : \"text-yellow-600\"\r\n            }`} />\r\n            <div>\r\n              <h4 className={`font-semibold ${\r\n                daysRemaining <= 7 ? \"text-red-900\" : \"text-yellow-900\"\r\n              }`}>\r\n                {daysRemaining <= 7 ? \"⚠️ Tiempo Limitado\" : \"📅 Recordatorio\"}\r\n              </h4>\r\n              <p className={`text-sm mt-1 ${\r\n                daysRemaining <= 7 ? \"text-red-800\" : \"text-yellow-800\"\r\n              }`}>\r\n                Te quedan <strong>{daysRemaining} días</strong> para subir la foto de tu cédula.\r\n                {daysRemaining <= 7 && \" ¡Hazlo pronto para evitar restricciones en tu cuenta!\"}\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </aside>\r\n      )}\r\n\r\n      {/* Document Status */}\r\n      <section className=\"space-y-4 mb-6\">\r\n        <article className=\"border border-gray-200 rounded-lg p-4\">\r\n          <div className=\"flex items-start gap-4\">\r\n            <div className=\"p-3 bg-gray-100 rounded-lg\">\r\n              <FileText className=\"h-6 w-6 text-gray-600\" />\r\n            </div>\r\n            <div className=\"flex-1\">\r\n              <h4 className=\"font-medium text-gray-900\">\r\n                Foto de Cédula de Identidad\r\n              </h4>\r\n              <p className=\"text-sm text-gray-500 mt-1\">\r\n                {profileData?.photoVerified\r\n                  ? `Verificada el ${new Date(profileData.cedulaPhotoVerifiedAt || \"\").toLocaleDateString(\"es-VE\")}`\r\n                  : profileData?.cedulaVerificada\r\n                  ? \"Pendiente de verificación\"\r\n                  : \"No disponible - Ancla tu cédula primero\"}\r\n              </p>\r\n              <div className=\"mt-2\">{getStatusBadge()}</div>\r\n            </div>\r\n          </div>\r\n        </article>\r\n      </section>\r\n\r\n      {/* Upload Section */}\r\n      {profileData?.cedulaVerificada && !profileData?.photoVerified ? (\r\n        <CedulaPhotoUpload\r\n          expectedCedula={profileData.cedula}\r\n          expectedNombre={profileData.nombre}\r\n          onVerificationComplete={handleVerificationComplete}\r\n        />\r\n      ) : profileData?.photoVerified ? (\r\n        <aside className=\"bg-green-50 border border-green-200 rounded-lg p-4\">\r\n          <div className=\"flex items-start gap-3\">\r\n            <Check className=\"h-5 w-5 text-green-600 mt-0.5\" />\r\n            <div>\r\n              <h4 className=\"font-semibold text-green-900\">\r\n                ✅ Verificación Completa\r\n              </h4>\r\n              <p className=\"text-sm text-green-800 mt-1\">\r\n                Tu cédula ha sido verificada exitosamente con foto. Tu cuenta está completamente verificada.\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </aside>\r\n      ) : (\r\n        <aside className=\"bg-gray-50 border border-gray-200 rounded-lg p-4\">\r\n          <div className=\"flex items-start gap-3\">\r\n            <AlertCircle className=\"h-5 w-5 text-gray-600 mt-0.5\" />\r\n            <div>\r\n              <h4 className=\"font-semibold text-gray-900\">\r\n                Primero Ancla tu Cédula\r\n              </h4>\r\n              <p className=\"text-sm text-gray-600 mt-1\">\r\n                Para verificar tu cédula con foto, primero debes:\r\n              </p>\r\n              <ol className=\"text-sm text-gray-600 mt-2 space-y-1 list-decimal list-inside\">\r\n                <li>Ir a la sección \"Mi Perfil\"</li>\r\n                <li>Ingresar tu número de cédula</li>\r\n                <li>Validar con datos oficiales del CNE</li>\r\n                <li>Hacer clic en \"Guardar\" para anclar tu cédula</li>\r\n                <li>Regresar aquí para subir la foto</li>\r\n              </ol>\r\n            </div>\r\n          </div>\r\n        </aside>\r\n      )}\r\n    </motion.article>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\extra-tabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\hooks\\use-imc-calculation.ts","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\hooks\\use-imc-calculation.ts:23:7\n  21 |   useEffect(() => {\n  22 |     if (!peso || !altura) {\n> 23 |       setImc(null);\n     |       ^^^^^^ Avoid calling setState() directly within an effect\n  24 |       setImcCategoria(\"\");\n  25 |       return;\n  26 |     }","line":23,"column":7,"nodeType":null,"endLine":23,"endColumn":13}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\r\n\r\ntype ImcCategory = \"Bajo peso\" | \"Normal\" | \"Sobrepeso\" | \"Obesidad\" | \"\";\r\n\r\ninterface UseImcCalculationResult {\r\n  imc: number | null;\r\n  imcCategoria: ImcCategory;\r\n}\r\n\r\n/**\r\n * Hook para calcular el IMC basado en peso y altura\r\n * Peso en kg, altura en cm\r\n */\r\nexport function useImcCalculation(\r\n  peso: string | undefined,\r\n  altura: string | undefined\r\n): UseImcCalculationResult {\r\n  const [imc, setImc] = useState<number | null>(null);\r\n  const [imcCategoria, setImcCategoria] = useState<ImcCategory>(\"\");\r\n\r\n  useEffect(() => {\r\n    if (!peso || !altura) {\r\n      setImc(null);\r\n      setImcCategoria(\"\");\r\n      return;\r\n    }\r\n\r\n    const pesoNum = parseFloat(peso);\r\n    const alturaNum = parseFloat(altura) / 100;\r\n\r\n    if (pesoNum > 0 && alturaNum > 0) {\r\n      const imcCalculado = pesoNum / (alturaNum * alturaNum);\r\n      setImc(imcCalculado);\r\n\r\n      if (imcCalculado < 18.5) {\r\n        setImcCategoria(\"Bajo peso\");\r\n      } else if (imcCalculado < 25) {\r\n        setImcCategoria(\"Normal\");\r\n      } else if (imcCalculado < 30) {\r\n        setImcCategoria(\"Sobrepeso\");\r\n      } else {\r\n        setImcCategoria(\"Obesidad\");\r\n      }\r\n    }\r\n  }, [peso, altura]);\r\n\r\n  return { imc, imcCategoria };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\hooks\\use-medical-data-parsing.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[453,456],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[453,456],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\hooks\\use-medical-data-parsing.ts:78:5\n  76 |     }\n  77 |\n> 78 |     setMedicalData(parsed);\n     |     ^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  79 |   }, [formData]);\n  80 |\n  81 |   return medicalData;","line":78,"column":5,"nodeType":null,"endLine":78,"endColumn":19}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\r\nimport type { Medication } from \"../../components/medication-input-improved\";\r\n\r\ninterface MedicalDataState {\r\n  alergiasMedicamentos: string[];\r\n  alergiasAlimentarias: string[];\r\n  otrasAlergias: string[];\r\n  condicionesCronicas: string[];\r\n  medicamentosActuales: Medication[];\r\n}\r\n\r\n/**\r\n * Hook para parsear y gestionar datos médicos estructurados\r\n */\r\nexport function useMedicalDataParsing(formData: any): MedicalDataState {\r\n  const [medicalData, setMedicalData] = useState<MedicalDataState>({\r\n    alergiasMedicamentos: [],\r\n    alergiasAlimentarias: [],\r\n    otrasAlergias: [],\r\n    condicionesCronicas: [],\r\n    medicamentosActuales: [],\r\n  });\r\n\r\n  useEffect(() => {\r\n    const parsed: MedicalDataState = {\r\n      alergiasMedicamentos: [],\r\n      alergiasAlimentarias: [],\r\n      otrasAlergias: [],\r\n      condicionesCronicas: [],\r\n      medicamentosActuales: [],\r\n    };\r\n\r\n    // Parsear alergias a medicamentos\r\n    if (formData.alergias) {\r\n      parsed.alergiasMedicamentos = formData.alergias\r\n        .split(\",\")\r\n        .map((s: string) => s.trim())\r\n        .filter(Boolean);\r\n    }\r\n\r\n    // Parsear alergias alimentarias\r\n    if (formData.alergiasAlimentarias) {\r\n      parsed.alergiasAlimentarias = formData.alergiasAlimentarias\r\n        .split(\",\")\r\n        .map((s: string) => s.trim())\r\n        .filter(Boolean);\r\n    }\r\n\r\n    // Parsear otras alergias\r\n    if (formData.otrasAlergias) {\r\n      parsed.otrasAlergias = formData.otrasAlergias\r\n        .split(\",\")\r\n        .map((s: string) => s.trim())\r\n        .filter(Boolean);\r\n    }\r\n\r\n    // Parsear condiciones crónicas\r\n    if (formData.condicionesCronicas) {\r\n      parsed.condicionesCronicas = formData.condicionesCronicas\r\n        .split(\",\")\r\n        .map((s: string) => s.trim())\r\n        .filter(Boolean);\r\n    }\r\n\r\n    // Parsear medicamentos (intentar JSON, si falla usar texto plano)\r\n    if (formData.medicamentosActuales) {\r\n      try {\r\n        const medicamentos = JSON.parse(formData.medicamentosActuales);\r\n        if (Array.isArray(medicamentos)) {\r\n          parsed.medicamentosActuales = medicamentos;\r\n        }\r\n      } catch {\r\n        // Si no es JSON válido, mantener vacío\r\n        parsed.medicamentosActuales = [];\r\n      }\r\n    }\r\n\r\n    setMedicalData(parsed);\r\n  }, [formData]);\r\n\r\n  return medicalData;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\medical-form-constants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\medical-tab-improved.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useImcCalculation' is defined but never used.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { motion } from \"framer-motion\";\r\nimport { Edit2, Save, X, Loader2 } from \"lucide-react\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport type { TabComponentProps } from \"../types\";\r\nimport { useState, useEffect } from \"react\";\r\nimport type { Medication } from \"../components/medication-input-improved\";\r\nimport { useImcCalculation } from \"./hooks/use-imc-calculation\";\r\nimport { useMedicalDataParsing } from \"./hooks/use-medical-data-parsing\";\r\nimport { VitalDataSection } from \"./components/vital-data-section\";\r\nimport { LifestyleHabitsSection } from \"./components/lifestyle-habits-section\";\r\nimport { WomenHealthSection } from \"./components/women-health-section\";\r\nimport { ClinicalInfoSection } from \"./components/clinical-info-section\";\r\n\r\nexport function MedicalTabImproved({\r\n  formData,\r\n  setFormData,\r\n  isEditing,\r\n  setIsEditing,\r\n  handleSave,\r\n}: TabComponentProps) {\r\n  const [localData, setLocalData] = useState(formData);\r\n  const [isSaving, setIsSaving] = useState(false);\r\n\r\n  // Datos médicos parseados\r\n  const medicalData = useMedicalDataParsing(formData);\r\n  const [alergiasMedicamentos, setAlergiasMedicamentos] = useState(\r\n    medicalData.alergiasMedicamentos\r\n  );\r\n  const [alergiasAlimentarias, setAlergiasAlimentarias] = useState(\r\n    medicalData.alergiasAlimentarias\r\n  );\r\n  const [otrasAlergias, setOtrasAlergias] = useState(medicalData.otrasAlergias);\r\n  const [condicionesCronicas, setCondicionesCronicas] = useState(\r\n    medicalData.condicionesCronicas\r\n  );\r\n  const [medicamentosActuales, setMedicamentosActuales] = useState<Medication[]>(\r\n    medicalData.medicamentosActuales\r\n  );\r\n\r\n  useEffect(() => {\r\n    setLocalData(formData);\r\n  }, [formData]);\r\n\r\n  useEffect(() => {\r\n    setAlergiasMedicamentos(medicalData.alergiasMedicamentos);\r\n    setAlergiasAlimentarias(medicalData.alergiasAlimentarias);\r\n    setOtrasAlergias(medicalData.otrasAlergias);\r\n    setCondicionesCronicas(medicalData.condicionesCronicas);\r\n    setMedicamentosActuales(medicalData.medicamentosActuales);\r\n  }, [medicalData]);\r\n\r\n  const handleLocalSave = async () => {\r\n    setIsSaving(true);\r\n    try {\r\n      // Preparar datos para guardar\r\n      const dataToSave = {\r\n        ...localData,\r\n        alergias: alergiasMedicamentos.join(\", \"),\r\n        alergiasAlimentarias: alergiasAlimentarias.join(\", \"),\r\n        otrasAlergias: otrasAlergias.join(\", \"),\r\n        condicionesCronicas: condicionesCronicas.join(\", \"),\r\n        medicamentosActuales: JSON.stringify(medicamentosActuales),\r\n      };\r\n\r\n      const result = await handleSave(dataToSave);\r\n      if (result.success) {\r\n        setFormData(dataToSave);\r\n      } else {\r\n        throw new Error(result.error || \"Error al guardar\");\r\n      }\r\n    } finally {\r\n      setIsSaving(false);\r\n    }\r\n  };\r\n\r\n  const handleCancel = () => {\r\n    setLocalData(formData);\r\n    setIsEditing(false);\r\n  };\r\n\r\n  const esMujer = localData.sexoBiologico === \"femenino\";\r\n\r\n  return (\r\n    <motion.article\r\n      key=\"medical\"\r\n      initial={{ opacity: 0, x: -20 }}\r\n      animate={{ opacity: 1, x: 0 }}\r\n      exit={{ opacity: 0, x: 20 }}\r\n    >\r\n      <header className=\"flex items-center justify-between mb-5\">\r\n        <div>\r\n          <h2 className=\"text-xl font-semibold text-gray-900\">\r\n            Información Médica\r\n          </h2>\r\n          <p className=\"text-sm text-gray-500 mt-1\">\r\n            Información confidencial visible solo para profesionales autorizados\r\n          </p>\r\n        </div>\r\n        {!isEditing ? (\r\n          <Button onClick={() => setIsEditing(true)} variant=\"outline\" size=\"sm\">\r\n            <Edit2 className=\"h-4 w-4 mr-2\" />\r\n            Editar\r\n          </Button>\r\n        ) : (\r\n          <div className=\"flex gap-2\">\r\n            <Button onClick={handleCancel} variant=\"outline\" size=\"sm\" disabled={isSaving}>\r\n              <X className=\"h-4 w-4 mr-2\" />\r\n              Cancelar\r\n            </Button>\r\n            <Button onClick={handleLocalSave} size=\"sm\" disabled={isSaving}>\r\n              {isSaving ? (\r\n                <>\r\n                  <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\r\n                  Guardando...\r\n                </>\r\n              ) : (\r\n                <>\r\n                  <Save className=\"h-4 w-4 mr-2\" />\r\n                  Guardar\r\n                </>\r\n              )}\r\n            </Button>\r\n          </div>\r\n        )}\r\n      </header>\r\n\r\n      <form className=\"grid grid-cols-2 gap-6\">\r\n        {/* Columna Izquierda */}\r\n        <VitalDataSection\r\n          isEditing={isEditing}\r\n          localData={localData}\r\n          setLocalData={setLocalData}\r\n          formData={formData}\r\n        />\r\n\r\n        {/* Hábitos */}\r\n        <LifestyleHabitsSection\r\n          isEditing={isEditing}\r\n          localData={localData}\r\n          setLocalData={setLocalData}\r\n          formData={formData}\r\n        />\r\n\r\n        {/* Información específica para mujeres */}\r\n        {esMujer && (\r\n          <WomenHealthSection\r\n            isEditing={isEditing}\r\n            localData={localData}\r\n            setLocalData={setLocalData}\r\n            formData={formData}\r\n          />\r\n        )}\r\n\r\n        {/* Columna Derecha */}\r\n        <ClinicalInfoSection\r\n          isEditing={isEditing}\r\n          alergiasMedicamentos={alergiasMedicamentos}\r\n          setAlergiasMedicamentos={setAlergiasMedicamentos}\r\n          alergiasAlimentarias={alergiasAlimentarias}\r\n          setAlergiasAlimentarias={setAlergiasAlimentarias}\r\n          otrasAlergias={otrasAlergias}\r\n          setOtrasAlergias={setOtrasAlergias}\r\n          condicionesCronicas={condicionesCronicas}\r\n          setCondicionesCronicas={setCondicionesCronicas}\r\n          medicamentosActuales={medicamentosActuales}\r\n          setMedicamentosActuales={setMedicamentosActuales}\r\n        />\r\n      </form>\r\n    </motion.article>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\medical-tab-improved\\components\\clinical-info-section.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\medical-tab-improved\\components\\female-specific-section.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\medical-tab-improved\\components\\lifestyle-section.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\medical-tab-improved\\components\\organ-donor-section.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\medical-tab-improved\\components\\vital-signs-section.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\medical-tab-improved\\constants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\medical-tab-improved\\hooks\\use-imc-calculator.ts","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\medical-tab-improved\\hooks\\use-imc-calculator.ts:15:9\n  13 |       if (pesoNum > 0 && alturaNum > 0) {\n  14 |         const imcCalculado = pesoNum / (alturaNum * alturaNum);\n> 15 |         setImc(imcCalculado);\n     |         ^^^^^^ Avoid calling setState() directly within an effect\n  16 |         \n  17 |         if (imcCalculado < 18.5) setImcCategoria(\"Bajo peso\");\n  18 |         else if (imcCalculado < 25) setImcCategoria(\"Normal\");","line":15,"column":9,"nodeType":null,"endLine":15,"endColumn":15}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\r\nimport type { IMCData } from \"../types\";\r\n\r\nexport function useIMCCalculator(peso?: string, altura?: string): IMCData {\r\n  const [imc, setImc] = useState<number | null>(null);\r\n  const [imcCategoria, setImcCategoria] = useState<string>(\"\");\r\n\r\n  useEffect(() => {\r\n    if (peso && altura) {\r\n      const pesoNum = parseFloat(peso);\r\n      const alturaNum = parseFloat(altura) / 100;\r\n      \r\n      if (pesoNum > 0 && alturaNum > 0) {\r\n        const imcCalculado = pesoNum / (alturaNum * alturaNum);\r\n        setImc(imcCalculado);\r\n        \r\n        if (imcCalculado < 18.5) setImcCategoria(\"Bajo peso\");\r\n        else if (imcCalculado < 25) setImcCategoria(\"Normal\");\r\n        else if (imcCalculado < 30) setImcCategoria(\"Sobrepeso\");\r\n        else setImcCategoria(\"Obesidad\");\r\n      }\r\n    } else {\r\n      setImc(null);\r\n      setImcCategoria(\"\");\r\n    }\r\n  }, [peso, altura]);\r\n\r\n  return { value: imc, categoria: imcCategoria };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\medical-tab-improved\\hooks\\use-medical-data-parser.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ParsedMedicalData' is defined but never used.","line":5,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":28},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\medical-tab-improved\\hooks\\use-medical-data-parser.ts:22:7\n  20 |   useEffect(() => {\n  21 |     if (formData.alergias) {\n> 22 |       setAlergiasMedicamentos(\n     |       ^^^^^^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  23 |         formData.alergias.split(\",\").map((s) => s.trim()).filter(Boolean)\n  24 |       );\n  25 |     }","line":22,"column":7,"nodeType":null,"endLine":22,"endColumn":30}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\r\nimport type { Medication } from \"../../../components/medication-input-improved\";\r\nimport type { MedicalFormData } from \"../types\";\r\n\r\ninterface ParsedMedicalData {\r\n  alergiasMedicamentos: string[];\r\n  alergiasAlimentarias: string[];\r\n  otrasAlergias: string[];\r\n  condicionesCronicas: string[];\r\n  medicamentosActuales: Medication[];\r\n}\r\n\r\nexport function useMedicalDataParser(formData: MedicalFormData) {\r\n  const [alergiasMedicamentos, setAlergiasMedicamentos] = useState<string[]>([]);\r\n  const [alergiasAlimentarias, setAlergiasAlimentarias] = useState<string[]>([]);\r\n  const [otrasAlergias, setOtrasAlergias] = useState<string[]>([]);\r\n  const [condicionesCronicas, setCondicionesCronicas] = useState<string[]>([]);\r\n  const [medicamentosActuales, setMedicamentosActuales] = useState<Medication[]>([]);\r\n\r\n  useEffect(() => {\r\n    if (formData.alergias) {\r\n      setAlergiasMedicamentos(\r\n        formData.alergias.split(\",\").map((s) => s.trim()).filter(Boolean)\r\n      );\r\n    }\r\n    if (formData.alergiasAlimentarias) {\r\n      setAlergiasAlimentarias(\r\n        formData.alergiasAlimentarias.split(\",\").map((s) => s.trim()).filter(Boolean)\r\n      );\r\n    }\r\n    if (formData.otrasAlergias) {\r\n      setOtrasAlergias(\r\n        formData.otrasAlergias.split(\",\").map((s) => s.trim()).filter(Boolean)\r\n      );\r\n    }\r\n    if (formData.condicionesCronicas) {\r\n      setCondicionesCronicas(\r\n        formData.condicionesCronicas.split(\",\").map((s) => s.trim()).filter(Boolean)\r\n      );\r\n    }\r\n    \r\n    if (formData.medicamentosActuales) {\r\n      try {\r\n        const parsed = JSON.parse(formData.medicamentosActuales);\r\n        if (Array.isArray(parsed)) {\r\n          setMedicamentosActuales(parsed);\r\n        }\r\n      } catch {\r\n        setMedicamentosActuales([]);\r\n      }\r\n    }\r\n  }, [formData]);\r\n\r\n  return {\r\n    alergiasMedicamentos,\r\n    setAlergiasMedicamentos,\r\n    alergiasAlimentarias,\r\n    setAlergiasAlimentarias,\r\n    otrasAlergias,\r\n    setOtrasAlergias,\r\n    condicionesCronicas,\r\n    setCondicionesCronicas,\r\n    medicamentosActuales,\r\n    setMedicamentosActuales,\r\n  };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\medical-tab-improved\\index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\medical-tab-improved\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\medical-tab-new.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\medical-tab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\preferences-tab.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":168,"column":93,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":168,"endColumn":96,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9161,9164],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9161,9164],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { motion } from \"framer-motion\";\r\nimport { Label } from \"@red-salud/ui\";\r\nimport { usePreferences } from \"@/lib/contexts/preferences-context\";\r\nimport { useI18n } from \"@/lib/hooks/use-i18n\";\r\nimport { Moon, Sun } from \"lucide-react\";\r\n\r\nexport function PreferencesTab() {\r\n  const { preferences, updatePreference } = usePreferences();\r\n  const { t } = useI18n();\r\n  \r\n  const theme = preferences.theme === \"system\" \r\n    ? (window.matchMedia(\"(prefers-color-scheme: dark)\").matches ? \"dark\" : \"light\")\r\n    : preferences.theme;\r\n  \r\n  const toggleTheme = () => {\r\n    const newTheme = theme === \"dark\" ? \"light\" : \"dark\";\r\n    updatePreference(\"theme\", newTheme);\r\n  };\r\n  \r\n  const setLanguage = (lang: \"es\" | \"en\" | \"pt\" | \"fr\" | \"it\") => {\r\n    updatePreference(\"language\", lang);\r\n  };\r\n  return (\r\n    <motion.article\r\n      key=\"preferences\"\r\n      initial={{ opacity: 0, x: -20 }}\r\n      animate={{ opacity: 1, x: 0 }}\r\n      exit={{ opacity: 0, x: 20 }}\r\n    >\r\n      <header className=\"mb-6\">\r\n        <h2 className=\"text-xl font-semibold text-gray-900 dark:text-gray-100\">\r\n          {t(\"preferences.title\")}\r\n        </h2>\r\n        <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\r\n          {t(\"preferences.subtitle\")}\r\n        </p>\r\n      </header>\r\n\r\n      <div className=\"grid grid-cols-2 gap-6\">\r\n        <section className=\"space-y-4\">\r\n          <h3 className=\"font-semibold text-gray-900 dark:text-gray-100 mb-3\">\r\n            {t(\"preferences.regional.title\")}\r\n          </h3>\r\n\r\n          <div className=\"p-4 rounded-lg border border-gray-200 dark:border-gray-700 dark:bg-gray-800\">\r\n            <Label htmlFor=\"idioma\" className=\"mb-2 block dark:text-gray-100\">\r\n              {t(\"preferences.regional.language\")}\r\n            </Label>\r\n            <select\r\n              id=\"idioma\"\r\n              value={preferences.language}\r\n              onChange={(e) => setLanguage(e.target.value as \"es\" | \"en\" | \"pt\" | \"fr\" | \"it\")}\r\n              className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-gray-100\"\r\n              aria-label=\"Seleccionar idioma\"\r\n            >\r\n              <option value=\"es\">Español</option>\r\n              <option value=\"en\">English</option>\r\n              <option value=\"pt\">Português</option>\r\n              <option value=\"fr\">Français</option>\r\n              <option value=\"it\">Italiano</option>\r\n            </select>\r\n          </div>\r\n\r\n          <div className=\"p-4 rounded-lg border border-gray-200 dark:border-gray-700 dark:bg-gray-800\">\r\n            <Label htmlFor=\"zona\" className=\"mb-2 block dark:text-gray-100\">\r\n              {t(\"preferences.regional.timezone\")}\r\n            </Label>\r\n            <select\r\n              id=\"zona\"\r\n              value={preferences.timezone}\r\n              onChange={(e) => updatePreference(\"timezone\", e.target.value)}\r\n              className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-gray-100\"\r\n              aria-label=\"Seleccionar zona horaria\"\r\n            >\r\n              <option value=\"America/Caracas\">Venezuela (GMT-4)</option>\r\n              <option value=\"America/Bogota\">Colombia (GMT-5)</option>\r\n              <option value=\"America/Lima\">Perú (GMT-5)</option>\r\n              <option value=\"America/Mexico_City\">México (GMT-6)</option>\r\n              <option value=\"America/Buenos_Aires\">Argentina (GMT-3)</option>\r\n              <option value=\"America/Santiago\">Chile (GMT-3)</option>\r\n              <option value=\"America/Sao_Paulo\">Brasil (GMT-3)</option>\r\n            </select>\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-between p-4 rounded-lg border border-gray-200 dark:border-gray-700 dark:bg-gray-800\">\r\n            <div className=\"flex items-center gap-3\">\r\n              {theme === \"dark\" ? (\r\n                <Moon className=\"h-5 w-5 text-gray-600 dark:text-gray-400\" />\r\n              ) : (\r\n                <Sun className=\"h-5 w-5 text-gray-600 dark:text-gray-400\" />\r\n              )}\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-900 dark:text-gray-100\">\r\n                  {t(\"preferences.appearance.theme\")}\r\n                </p>\r\n                <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                  {theme === \"dark\" ? t(\"preferences.appearance.themeDark\") : t(\"preferences.appearance.themeLight\")}\r\n                </p>\r\n              </div>\r\n            </div>\r\n            <label className=\"relative inline-flex items-center cursor-pointer\">\r\n              <input\r\n                type=\"checkbox\"\r\n                className=\"sr-only peer\"\r\n                checked={theme === \"dark\"}\r\n                onChange={toggleTheme}\r\n                aria-label=\"Activar modo oscuro\"\r\n              />\r\n              <div className=\"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600\"></div>\r\n            </label>\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-between p-4 rounded-lg border border-gray-200 dark:border-gray-700 dark:bg-gray-800\">\r\n            <div>\r\n              <p className=\"text-sm font-medium text-gray-900 dark:text-gray-100\">\r\n                {t(\"preferences.notifications.desktop\")}\r\n              </p>\r\n              <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                {t(\"preferences.notifications.desktopDesc\")}\r\n              </p>\r\n            </div>\r\n            <label className=\"relative inline-flex items-center cursor-pointer\">\r\n              <input\r\n                type=\"checkbox\"\r\n                className=\"sr-only peer\"\r\n                checked={preferences.desktopNotifications}\r\n                onChange={(e) => updatePreference(\"desktopNotifications\", e.target.checked)}\r\n                aria-label=\"Activar Notificaciones de Escritorio\"\r\n              />\r\n              <div className=\"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600\"></div>\r\n            </label>\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-between p-4 rounded-lg border border-gray-200 dark:border-gray-700 dark:bg-gray-800\">\r\n            <div>\r\n              <p className=\"text-sm font-medium text-gray-900 dark:text-gray-100\">\r\n                {t(\"preferences.notifications.sound\")}\r\n              </p>\r\n              <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                {t(\"preferences.notifications.soundDesc\")}\r\n              </p>\r\n            </div>\r\n            <label className=\"relative inline-flex items-center cursor-pointer\">\r\n              <input\r\n                type=\"checkbox\"\r\n                className=\"sr-only peer\"\r\n                checked={preferences.soundNotifications}\r\n                onChange={(e) => updatePreference(\"soundNotifications\", e.target.checked)}\r\n                aria-label=\"Activar Sonidos de Notificación\"\r\n              />\r\n              <div className=\"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600\"></div>\r\n            </label>\r\n          </div>\r\n        </section>\r\n\r\n        <section className=\"space-y-4\">\r\n          <h3 className=\"font-semibold text-gray-900 dark:text-gray-100 mb-3\">\r\n            {t(\"preferences.communication.title\")}\r\n          </h3>\r\n\r\n          <div className=\"p-4 rounded-lg border border-gray-200 dark:border-gray-700 dark:bg-gray-800\">\r\n            <Label htmlFor=\"metodoContacto\" className=\"mb-2 block dark:text-gray-100\">\r\n              {t(\"preferences.communication.preferredMethod\")}\r\n            </Label>\r\n            <select\r\n              id=\"metodoContacto\"\r\n              value={preferences.preferredContactMethod}\r\n              onChange={(e) => updatePreference(\"preferredContactMethod\", e.target.value as any)}\r\n              className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-gray-100\"\r\n              aria-label=\"Seleccionar método de contacto\"\r\n            >\r\n              <option value=\"email\">{t(\"preferences.communication.email\")}</option>\r\n              <option value=\"sms\">{t(\"preferences.communication.sms\")}</option>\r\n              <option value=\"whatsapp\">{t(\"preferences.communication.whatsapp\")}</option>\r\n              <option value=\"phone\">{t(\"preferences.communication.phone\")}</option>\r\n            </select>\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-between p-4 rounded-lg border border-gray-200 dark:border-gray-700 dark:bg-gray-800\">\r\n            <div>\r\n              <p className=\"text-sm font-medium text-gray-900 dark:text-gray-100\">\r\n                {t(\"preferences.subscriptions.newsletter\")}\r\n              </p>\r\n              <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                {t(\"preferences.subscriptions.newsletterDesc\")}\r\n              </p>\r\n            </div>\r\n            <label className=\"relative inline-flex items-center cursor-pointer\">\r\n              <input\r\n                type=\"checkbox\"\r\n                className=\"sr-only peer\"\r\n                checked={preferences.newsletterSubscribed}\r\n                onChange={(e) => updatePreference(\"newsletterSubscribed\", e.target.checked)}\r\n                aria-label=\"Activar Boletín Informativo\"\r\n              />\r\n              <div className=\"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600\"></div>\r\n            </label>\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-between p-4 rounded-lg border border-gray-200 dark:border-gray-700 dark:bg-gray-800\">\r\n            <div>\r\n              <p className=\"text-sm font-medium text-gray-900 dark:text-gray-100\">\r\n                {t(\"preferences.subscriptions.promotions\")}\r\n              </p>\r\n              <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                {t(\"preferences.subscriptions.promotionsDesc\")}\r\n              </p>\r\n            </div>\r\n            <label className=\"relative inline-flex items-center cursor-pointer\">\r\n              <input\r\n                type=\"checkbox\"\r\n                className=\"sr-only peer\"\r\n                checked={preferences.promotionsSubscribed}\r\n                onChange={(e) => updatePreference(\"promotionsSubscribed\", e.target.checked)}\r\n                aria-label=\"Activar Ofertas y Promociones\"\r\n              />\r\n              <div className=\"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600\"></div>\r\n            </label>\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-between p-4 rounded-lg border border-gray-200 dark:border-gray-700 dark:bg-gray-800\">\r\n            <div>\r\n              <p className=\"text-sm font-medium text-gray-900 dark:text-gray-100\">\r\n                {t(\"preferences.subscriptions.surveys\")}\r\n              </p>\r\n              <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                {t(\"preferences.subscriptions.surveysDesc\")}\r\n              </p>\r\n            </div>\r\n            <label className=\"relative inline-flex items-center cursor-pointer\">\r\n              <input\r\n                type=\"checkbox\"\r\n                className=\"sr-only peer\"\r\n                checked={preferences.surveysSubscribed}\r\n                onChange={(e) => updatePreference(\"surveysSubscribed\", e.target.checked)}\r\n                aria-label=\"Activar Encuestas de Satisfacción\"\r\n              />\r\n              <div className=\"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600\"></div>\r\n            </label>\r\n          </div>\r\n\r\n          <aside className=\"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mt-4\">\r\n            <p className=\"text-sm text-blue-800 dark:text-blue-300\">\r\n              <strong>Tip:</strong> {t(\"preferences.notifications.appointmentRemindersDesc\")}\r\n            </p>\r\n          </aside>\r\n        </section>\r\n      </div>\r\n    </motion.article>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\privacy-tab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\profile-tab.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isLoading' is defined but never used.","line":21,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":12},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'localData'. Either include it or remove the dependency array. You can also do a functional update 'setLocalData(l => ...)' if you only need 'localData' in the 'setLocalData' call.","line":64,"column":6,"nodeType":"ArrayExpression","endLine":64,"endColumn":24,"suggestions":[{"desc":"Update the dependencies array to be: [localData, localData.estado]","fix":{"range":[2432,2450],"text":"[localData, localData.estado]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { motion } from \"framer-motion\";\r\nimport { Edit2, Save, AlertCircle, Loader2, X } from \"lucide-react\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Input } from \"@red-salud/ui\";\r\nimport { Label } from \"@red-salud/ui\";\r\nimport { PhoneInput } from \"@red-salud/ui\";\r\nimport { DatePicker } from \"@red-salud/ui\";\r\nimport { CustomSelect } from \"@red-salud/ui\";\r\nimport { EmergencyContactCard } from \"../components/emergency-contact-card\";\r\nimport { ESTADOS_VENEZUELA } from \"../constants\";\r\nimport { CIUDADES_POR_ESTADO } from \"@/lib/constants/venezuela-cities\";\r\nimport type { TabComponentProps } from \"../types\";\r\nimport { useState, useEffect } from \"react\";\r\n\r\nexport function ProfileTab({\r\n  formData,\r\n  setFormData,\r\n  isEditing,\r\n  setIsEditing,\r\n  handleSave,\r\n  isLoading,\r\n}: TabComponentProps) {\r\n  // Estado local para edición\r\n  const [localData, setLocalData] = useState(formData);\r\n  const [isSaving, setIsSaving] = useState(false);\r\n\r\n  // Actualizar estado local cuando cambian los datos del servidor\r\n  useEffect(() => {\r\n    setLocalData(formData);\r\n  }, [formData]);\r\n  \r\n  const [isValidatingCedula, setIsValidatingCedula] = useState(false);\r\n  const [cedulaValidationStatus, setCedulaValidationStatus] = useState<\"idle\" | \"validating\" | \"success\" | \"error\">(\"idle\");\r\n  const [cedulaError, setCedulaError] = useState<string>(\"\");\r\n  const [nacionalidadCedula, setNacionalidadCedula] = useState<\"V\" | \"E\">(\"V\");\r\n  const [numeroCedula, setNumeroCedula] = useState<string>(\"\");\r\n  const [ciudadesDisponibles, setCiudadesDisponibles] = useState<string[]>([]);\r\n\r\n  // Cédula bloqueada si está verificada O si fue validada exitosamente\r\n  const isCedulaLocked = localData.cedulaVerificada || (cedulaValidationStatus as string) === \"success\";\r\n\r\n  useEffect(() => {\r\n    if (localData.cedula) {\r\n      const match = localData.cedula.match(/^([VE])-?(\\d+)$/i);\r\n      if (match) {\r\n        setNacionalidadCedula(match[1].toUpperCase() as \"V\" | \"E\");\r\n        setNumeroCedula(match[2]);\r\n      }\r\n    }\r\n  }, [localData.cedula]);\r\n\r\n  useEffect(() => {\r\n    if (localData.estado) {\r\n      setCiudadesDisponibles(CIUDADES_POR_ESTADO[localData.estado] || []);\r\n      if (\r\n        localData.ciudad &&\r\n        !CIUDADES_POR_ESTADO[localData.estado]?.includes(localData.ciudad)\r\n      ) {\r\n        setLocalData({ ...localData, ciudad: \"\" });\r\n      }\r\n    } else {\r\n      setCiudadesDisponibles([]);\r\n    }\r\n  }, [localData.estado]);\r\n\r\n  const handleCedulaValidation = async () => {\r\n    if (!numeroCedula) {\r\n      setCedulaValidationStatus(\"error\");\r\n      setCedulaError(\"Debe ingresar el número de cédula\");\r\n      return;\r\n    }\r\n\r\n    if (numeroCedula.length < 6) {\r\n      setCedulaValidationStatus(\"error\");\r\n      setCedulaError(\"El número de cédula debe tener al menos 6 dígitos\");\r\n      return;\r\n    }\r\n\r\n    const nacionalidad = nacionalidadCedula;\r\n    const cedula = numeroCedula;\r\n\r\n    setIsValidatingCedula(true);\r\n    setCedulaValidationStatus(\"idle\");\r\n    setCedulaError(\"\");\r\n\r\n    try {\r\n      const response = await fetch(\"/api/validate-cedula\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify({ nacionalidad, cedula }),\r\n      });\r\n\r\n      const result = await response.json();\r\n\r\n      if (result.error) {\r\n        setCedulaValidationStatus(\"error\");\r\n        \r\n        // Mensajes personalizados según el código de error\r\n        if (result.code === \"CEDULA_DUPLICADA\") {\r\n          setCedulaError(\"⚠️ Esta cédula ya está registrada en otra cuenta. Contacta a soporte si necesitas ayuda.\");\r\n        } else if (result.code === \"SIN_DATOS_CNE\") {\r\n          setCedulaError(\"⚠️ Esta cédula no tiene datos del CNE. Contacta a soporte para verificación manual.\");\r\n        } else {\r\n          setCedulaError(result.message || \"No se pudo validar la cédula\");\r\n        }\r\n        return;\r\n      }\r\n\r\n      const updatedData = {\r\n        ...localData,\r\n        cedula: `${result.data.nacionalidad}-${result.data.cedula}`,\r\n        nombre: result.data.nombreCompleto,\r\n        cneEstado: result.data.cne?.estado || \"\",\r\n        cneMunicipio: result.data.cne?.municipio || \"\",\r\n        cneParroquia: result.data.cne?.parroquia || \"\",\r\n        cneCentroElectoral: result.data.cne?.centroElectoral || \"\",\r\n        rif: result.data.rif || \"\",\r\n        nacionalidad: result.data.nacionalidad || \"V\",\r\n        primerNombre: result.data.primerNombre || \"\",\r\n        segundoNombre: result.data.segundoNombre || \"\",\r\n        primerApellido: result.data.primerApellido || \"\",\r\n        segundoApellido: result.data.segundoApellido || \"\",\r\n      };\r\n\r\n      setLocalData(updatedData);\r\n      setCedulaValidationStatus(\"success\");\r\n    } catch (error) {\r\n      console.error(\"Error validating cedula:\", error);\r\n      setCedulaValidationStatus(\"error\");\r\n      setCedulaError(\"Error al conectar con el servicio de validación\");\r\n    } finally {\r\n      setIsValidatingCedula(false);\r\n    }\r\n  };\r\n\r\n  const handleCedulaBlur = () => {\r\n    if (numeroCedula && isEditing && !isCedulaLocked) {\r\n      handleCedulaValidation();\r\n    }\r\n  };\r\n\r\n  const handleLocalSave = async () => {\r\n    // Validar campos requeridos antes de guardar\r\n    const missingFields = [];\r\n    if (!localData.nombre || localData.nombre.trim() === \"\") missingFields.push(\"Nombre completo\");\r\n    if (!localData.telefono || localData.telefono.trim() === \"\" || localData.telefono === \"+58 \") missingFields.push(\"Teléfono\");\r\n    if (!localData.cedula || localData.cedula.trim() === \"\") missingFields.push(\"Cédula\");\r\n    if (!localData.fechaNacimiento || localData.fechaNacimiento.trim() === \"\") missingFields.push(\"Fecha de nacimiento\");\r\n    if (!localData.direccion || localData.direccion.trim() === \"\") missingFields.push(\"Dirección\");\r\n    if (!localData.estado || localData.estado.trim() === \"\") missingFields.push(\"Estado\");\r\n    if (!localData.ciudad || localData.ciudad.trim() === \"\") missingFields.push(\"Ciudad\");\r\n\r\n    if (missingFields.length > 0) {\r\n      alert(`Por favor completa los siguientes campos obligatorios:\\n\\n${missingFields.join(\"\\n\")}`);\r\n      return;\r\n    }\r\n\r\n    // Validar formato de cédula\r\n    if (!/^[VE]-\\d{6,8}$/.test(localData.cedula)) {\r\n      alert(\"El formato de la cédula es inválido. Debe ser V-12345678 o E-12345678\");\r\n      return;\r\n    }\r\n\r\n    setIsSaving(true);\r\n    try {\r\n      console.log(\"📋 [ProfileTab] Datos locales antes de guardar:\", localData);\r\n      \r\n      // Guardar en el servidor PRIMERO con los datos actualizados\r\n      const result = await handleSave(localData);\r\n      \r\n      if (result.success) {\r\n        // Solo actualizar estado local si el guardado fue exitoso\r\n        setFormData(localData);\r\n        console.log(\"✅ [ProfileTab] Guardado exitoso\");\r\n      } else {\r\n        console.error(\"❌ [ProfileTab] Error al guardar:\", result.error);\r\n        throw new Error(result.error || \"Error al guardar\");\r\n      }\r\n    } finally {\r\n      setIsSaving(false);\r\n    }\r\n  };\r\n\r\n  const handleCancel = () => {\r\n    setLocalData(formData);\r\n    setIsEditing(false);\r\n    setCedulaValidationStatus(\"idle\");\r\n    setCedulaError(\"\");\r\n  };\r\n\r\n  return (\r\n    <motion.article\r\n      key=\"profile\"\r\n      initial={{ opacity: 0, x: -20 }}\r\n      animate={{ opacity: 1, x: 0 }}\r\n      exit={{ opacity: 0, x: 20 }}\r\n    >\r\n      <header className=\"flex items-center justify-between mb-4\">\r\n        <div className=\"flex items-center gap-3\">\r\n          <h2 className=\"text-xl font-semibold text-gray-900\">\r\n            Información Personal\r\n          </h2>\r\n          {formData.cedulaVerificada && !isEditing && (\r\n            <div className=\"bg-yellow-50 border border-yellow-200 rounded-lg px-2.5 py-1\">\r\n              <p className=\"text-xs text-yellow-800\">\r\n                Nombre y cédula bloqueados\r\n              </p>\r\n            </div>\r\n          )}\r\n        </div>\r\n        {!isEditing ? (\r\n          <Button onClick={() => setIsEditing(true)} variant=\"outline\" size=\"sm\">\r\n            <Edit2 className=\"h-4 w-4 mr-2\" aria-hidden=\"true\" />\r\n            Editar\r\n          </Button>\r\n        ) : (\r\n          <div className=\"flex gap-2\">\r\n            <Button\r\n              onClick={handleCancel}\r\n              variant=\"outline\"\r\n              size=\"sm\"\r\n              disabled={isSaving}\r\n            >\r\n              <X className=\"h-4 w-4 mr-2\" aria-hidden=\"true\" />\r\n              Cancelar\r\n            </Button>\r\n            <Button onClick={handleLocalSave} size=\"sm\" disabled={isSaving}>\r\n              {isSaving ? (\r\n                <>\r\n                  <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" aria-hidden=\"true\" />\r\n                  Guardando...\r\n                </>\r\n              ) : (\r\n                <>\r\n                  <Save className=\"h-4 w-4 mr-2\" aria-hidden=\"true\" />\r\n                  Guardar\r\n                </>\r\n              )}\r\n            </Button>\r\n          </div>\r\n        )}\r\n      </header>\r\n\r\n      {formData.cedulaVerificada && !formData.photoVerified && (\r\n        <div className=\"max-w-md mb-5\">\r\n          <div className=\"bg-blue-50 border border-blue-200 rounded-lg px-4 py-3\">\r\n            <p className=\"text-sm text-blue-900 leading-relaxed\">\r\n              <strong>Cédula anclada.</strong> Sube la foto en Documentos (30 días).\r\n            </p>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <form className=\"grid grid-cols-2 gap-6\">\r\n        <fieldset className=\"space-y-5\">\r\n          <legend className=\"sr-only\">Información básica</legend>\r\n\r\n          <div>\r\n            <Label htmlFor=\"nombre\">Nombre Completo *</Label>\r\n            {isEditing && !isCedulaLocked && (cedulaValidationStatus as string) !== \"success\" ? (\r\n              <Input\r\n                id=\"nombre\"\r\n                value={localData.nombre}\r\n                onChange={(e) =>\r\n                  setLocalData({ ...localData, nombre: e.target.value })\r\n                }\r\n                required\r\n                aria-required=\"true\"\r\n                placeholder=\"Ingresa tu cédula para validar tu nombre\"\r\n                disabled\r\n                className=\"bg-gray-50\"\r\n              />\r\n            ) : (\r\n              <div>\r\n                <p className=\"text-base font-medium text-gray-900 mt-1\">\r\n                  {localData.nombre || \"No registrado\"}\r\n                </p>\r\n                {(isCedulaLocked || (cedulaValidationStatus as string) === \"success\") && isEditing && (\r\n                  <p className=\"text-xs text-green-600 mt-1\">\r\n                    ✓ Nombre validado con la cédula\r\n                  </p>\r\n                )}\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          <div>\r\n            <Label htmlFor=\"email\">Correo Electrónico</Label>\r\n            <p className=\"text-base font-medium text-gray-900 mt-1\">\r\n              {formData.email}\r\n            </p>\r\n            <p className=\"text-xs text-gray-500 mt-1\">\r\n              Modifica tu email en la sección de Seguridad\r\n            </p>\r\n          </div>\r\n\r\n          <div>\r\n            <Label htmlFor=\"telefono\">Teléfono *</Label>\r\n            {isEditing ? (\r\n              <PhoneInput\r\n                value={localData.telefono}\r\n                onChange={(value) =>\r\n                  setLocalData({ ...localData, telefono: value })\r\n                }\r\n                disabled={false}\r\n              />\r\n            ) : (\r\n              <p className=\"text-base font-medium text-gray-900 mt-1\">\r\n                {formData.telefono || \"No registrado\"}\r\n              </p>\r\n            )}\r\n          </div>\r\n\r\n          <div>\r\n            <Label htmlFor=\"cedula\">Cédula de Identidad *</Label>\r\n            {isEditing && !isCedulaLocked ? (\r\n              <div className=\"space-y-2\">\r\n                <div className=\"flex gap-2\">\r\n                  <select\r\n                    value={nacionalidadCedula}\r\n                    onChange={(e) => {\r\n                      setNacionalidadCedula(e.target.value as \"V\" | \"E\");\r\n                      setCedulaValidationStatus(\"idle\");\r\n                      setCedulaError(\"\");\r\n                    }}\r\n                    className=\"w-16 h-10 px-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-center font-medium\"\r\n                    aria-label=\"Nacionalidad\"\r\n                  >\r\n                    <option value=\"V\">V</option>\r\n                    <option value=\"E\">E</option>\r\n                  </select>\r\n                  <div className=\"relative flex-1\">\r\n                    <Input\r\n                      id=\"cedula\"\r\n                      type=\"text\"\r\n                      placeholder=\"12345678\"\r\n                      value={numeroCedula}\r\n                      onChange={(e) => {\r\n                        const value = e.target.value.replace(/\\D/g, \"\");\r\n                        setNumeroCedula(value);\r\n                        setLocalData({ \r\n                          ...localData, \r\n                          cedula: value ? `${nacionalidadCedula}-${value}` : \"\" \r\n                        });\r\n                        setCedulaValidationStatus(\"idle\");\r\n                        setCedulaError(\"\");\r\n                      }}\r\n                      onBlur={handleCedulaBlur}\r\n                      required\r\n                      aria-required=\"true\"\r\n                      maxLength={8}\r\n                      className={\r\n                        cedulaValidationStatus === \"error\"\r\n                          ? \"border-red-500\"\r\n                          : cedulaValidationStatus === \"success\"\r\n                          ? \"border-green-500\"\r\n                          : \"\"\r\n                      }\r\n                    />\r\n                    {isValidatingCedula && (\r\n                      <Loader2 className=\"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 animate-spin text-blue-500\" />\r\n                    )}\r\n                    {!isValidatingCedula && cedulaValidationStatus === \"error\" && (\r\n                      <AlertCircle className=\"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-red-500\" />\r\n                    )}\r\n                  </div>\r\n                </div>\r\n                {cedulaValidationStatus === \"error\" && cedulaError && (\r\n                  <p className=\"text-xs text-red-600\">{cedulaError}</p>\r\n                )}\r\n                {cedulaValidationStatus === \"idle\" && (\r\n                  <p className=\"text-xs text-gray-500\">\r\n                    Ingrese su cédula para validar automáticamente\r\n                  </p>\r\n                )}\r\n                {cedulaValidationStatus === \"success\" && (\r\n                  <p className=\"text-xs text-green-600\">\r\n                    ✓ Cédula validada correctamente\r\n                  </p>\r\n                )}\r\n              </div>\r\n            ) : (\r\n              <div>\r\n                <p className=\"text-base font-medium text-gray-900 mt-1\">\r\n                  {localData.cedula || formData.cedula || \"No registrada\"}\r\n                </p>\r\n                {formData.cedulaVerificada && (\r\n                  <p className=\"text-xs text-green-600 mt-1\">\r\n                    ✓ Cédula anclada\r\n                  </p>\r\n                )}\r\n                {!formData.cedulaVerificada && (cedulaValidationStatus as string) === \"success\" && (\r\n                  <p className=\"text-xs text-green-600 mt-1\">\r\n                    ✓ Cédula validada\r\n                  </p>\r\n                )}\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          <div>\r\n            <Label htmlFor=\"fechaNacimiento\">Fecha de Nacimiento *</Label>\r\n            {isEditing && !isCedulaLocked ? (\r\n              <div className=\"space-y-1\">\r\n                <DatePicker\r\n                  value={localData.fechaNacimiento}\r\n                  onChange={(value) =>\r\n                    setLocalData({ ...localData, fechaNacimiento: value })\r\n                  }\r\n                  maxDate={new Date().toISOString().split(\"T\")[0]}\r\n                />\r\n                <p className=\"text-xs text-gray-500\">\r\n                  Escribe la fecha en formato DD/MM/AAAA o haz clic en el calendario\r\n                </p>\r\n              </div>\r\n            ) : (\r\n              <div>\r\n                <p className=\"text-base font-medium text-gray-900 mt-1\">\r\n                  {formData.fechaNacimiento\r\n                    ? new Date(formData.fechaNacimiento + \"T00:00:00\").toLocaleDateString(\r\n                        \"es-VE\",\r\n                        {\r\n                          year: \"numeric\",\r\n                          month: \"long\",\r\n                          day: \"numeric\",\r\n                        }\r\n                      )\r\n                    : \"No registrada\"}\r\n                </p>\r\n                {isCedulaLocked && isEditing && (\r\n                  <p className=\"text-xs text-gray-500 mt-1\">\r\n                    La fecha de nacimiento no se puede modificar\r\n                  </p>\r\n                )}\r\n              </div>\r\n            )}\r\n          </div>\r\n        </fieldset>\r\n\r\n        <fieldset className=\"space-y-5\">\r\n          <legend className=\"sr-only\">Dirección</legend>\r\n\r\n          <div>\r\n            <Label htmlFor=\"direccion\">Dirección Completa *</Label>\r\n            {isEditing ? (\r\n              <textarea\r\n                id=\"direccion\"\r\n                placeholder=\"Av. Principal, Edificio, Piso, Apartamento...\"\r\n                value={localData.direccion}\r\n                onChange={(e) =>\r\n                  setLocalData({ ...localData, direccion: e.target.value })\r\n                }\r\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 min-h-[70px]\"\r\n                required\r\n                aria-required=\"true\"\r\n              />\r\n            ) : (\r\n              <p className=\"text-base font-medium text-gray-900 mt-1\">\r\n                {formData.direccion || \"No registrada\"}\r\n              </p>\r\n            )}\r\n          </div>\r\n\r\n          <div>\r\n            <Label htmlFor=\"estado\">Estado *</Label>\r\n            {isEditing ? (\r\n              <CustomSelect\r\n                value={localData.estado}\r\n                onChange={(value) =>\r\n                  setLocalData({ ...localData, estado: value })\r\n                }\r\n                options={[...ESTADOS_VENEZUELA]}\r\n                placeholder=\"Seleccionar estado\"\r\n                direction=\"down\"\r\n              />\r\n            ) : (\r\n              <p className=\"text-base font-medium text-gray-900 mt-1\">\r\n                {formData.estado || \"No registrado\"}\r\n              </p>\r\n            )}\r\n          </div>\r\n\r\n          <div>\r\n            <Label htmlFor=\"ciudad\">Ciudad *</Label>\r\n            {isEditing ? (\r\n              <CustomSelect\r\n                value={localData.ciudad}\r\n                onChange={(value) =>\r\n                  setLocalData({ ...localData, ciudad: value })\r\n                }\r\n                options={ciudadesDisponibles}\r\n                placeholder={\r\n                  localData.estado\r\n                    ? \"Seleccionar ciudad\"\r\n                    : \"Primero seleccione un estado\"\r\n                }\r\n                disabled={!localData.estado || ciudadesDisponibles.length === 0}\r\n                direction=\"up\"\r\n              />\r\n            ) : (\r\n              <p className=\"text-base font-medium text-gray-900 mt-1\">\r\n                {formData.ciudad || \"No registrada\"}\r\n              </p>\r\n            )}\r\n          </div>\r\n\r\n          <div>\r\n            <Label htmlFor=\"codigoPostal\">Código Postal</Label>\r\n            {isEditing ? (\r\n              <Input\r\n                id=\"codigoPostal\"\r\n                placeholder=\"1010\"\r\n                value={localData.codigoPostal}\r\n                onChange={(e) =>\r\n                  setLocalData({ ...localData, codigoPostal: e.target.value })\r\n                }\r\n              />\r\n            ) : (\r\n              <p className=\"text-base font-medium text-gray-900 mt-1\">\r\n                {formData.codigoPostal || \"No registrado\"}\r\n              </p>\r\n            )}\r\n          </div>\r\n\r\n          {/* Contacto de Emergencia */}\r\n          <div className=\"col-span-2\">\r\n            <EmergencyContactCard\r\n              contactoEmergencia={localData.contactoEmergencia}\r\n              telefonoEmergencia={localData.telefonoEmergencia}\r\n              relacionEmergencia={localData.relacionEmergencia}\r\n              onUpdate={async (data) => {\r\n                console.log(\"🔄 [EmergencyContact] Iniciando actualización:\", data);\r\n                \r\n                // Crear objeto con todos los datos actualizados\r\n                const updatedData = {\r\n                  ...localData,\r\n                  contactoEmergencia: data.contactoEmergencia,\r\n                  telefonoEmergencia: data.telefonoEmergencia,\r\n                  relacionEmergencia: data.relacionEmergencia,\r\n                };\r\n                \r\n                console.log(\"📦 [EmergencyContact] Datos completos a guardar:\", {\r\n                  contactoEmergencia: updatedData.contactoEmergencia,\r\n                  telefonoEmergencia: updatedData.telefonoEmergencia,\r\n                  relacionEmergencia: updatedData.relacionEmergencia,\r\n                });\r\n                \r\n                // Guardar en el servidor PRIMERO con los datos actualizados\r\n                // Esto evita race conditions con Redux\r\n                const result = await handleSave(updatedData);\r\n                \r\n                if (result.success) {\r\n                  // Solo actualizar estados locales si el guardado fue exitoso\r\n                  setLocalData(updatedData);\r\n                  setFormData(updatedData);\r\n                  console.log(\"✅ [EmergencyContact] Actualización completada exitosamente\");\r\n                } else {\r\n                  console.error(\"❌ [EmergencyContact] Error en actualización:\", result.error);\r\n                  throw new Error(result.error || \"Error al guardar\");\r\n                }\r\n              }}\r\n            />\r\n          </div>\r\n\r\n          {isEditing && (\r\n            <aside className=\"bg-blue-50 border border-blue-200 rounded-lg p-3 col-span-2\">\r\n              <p className=\"text-xs text-blue-800\">\r\n                {isCedulaLocked ? (\r\n                  <>\r\n                    <strong>Nota:</strong> Puedes modificar dirección, ciudad, estado, código postal y teléfono. \r\n                    Nombre, cédula y fecha de nacimiento están bloqueados por seguridad.\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <strong>Nota:</strong> Los campos marcados con * son obligatorios.\r\n                  </>\r\n                )}\r\n              </p>\r\n            </aside>\r\n          )}\r\n        </fieldset>\r\n      </form>\r\n    </motion.article>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\security-tab-new.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'X' is defined but never used.","line":15,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":4},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Eye' is defined but never used.","line":16,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":6},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'EyeOff' is defined but never used.","line":17,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Loader2' is defined but never used.","line":18,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Clock' is defined but never used.","line":20,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":8},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MapPin' is defined but never used.","line":21,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":9},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`loadSecuritySettingsInBackground` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\security-tab-new.tsx:70:5\n  68 |   // Cargar configuraciones en segundo plano sin bloquear la UI\n  69 |   useEffect(() => {\n> 70 |     loadSecuritySettingsInBackground();\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ `loadSecuritySettingsInBackground` accessed before it is declared\n  71 |   }, []);\n  72 |\n  73 |   const loadSecuritySettingsInBackground = async () => {\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\security-tab-new.tsx:73:3\n  71 |   }, []);\n  72 |\n> 73 |   const loadSecuritySettingsInBackground = async () => {\n     |   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 74 |     try {\n     | ^^^^^^^^^\n> 75 |       // TODO: Implementar llamadas reales cuando las APIs estén listas\n     …\n     | ^^^^^^^^^\n> 89 |     }\n     | ^^^^^^^^^\n> 90 |   };\n     | ^^^^^ `loadSecuritySettingsInBackground` is declared here\n  91 |\n  92 |   const handleNotificationToggle = (key: keyof NotificationSettings) => {\n  93 |     const updated = { ...notifications, [key]: !notifications[key] };","line":70,"column":5,"nodeType":null,"endLine":70,"endColumn":37},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadSecuritySettingsInBackground'. Either include it or remove the dependency array.","line":71,"column":6,"nodeType":"ArrayExpression","endLine":71,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadSecuritySettingsInBackground]","fix":{"range":[2071,2073],"text":"[loadSecuritySettingsInBackground]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { motion } from \"framer-motion\";\r\nimport {\r\n  Lock,\r\n  Shield,\r\n  Mail,\r\n  Smartphone,\r\n  Key,\r\n  Bell,\r\n  Check,\r\n  AlertCircle,\r\n  Edit2,\r\n  X,\r\n  Eye,\r\n  EyeOff,\r\n  Loader2,\r\n  Monitor,\r\n  Clock,\r\n  MapPin,\r\n  History,\r\n} from \"lucide-react\";\r\nimport { ChangePasswordModal } from \"../components/security/change-password-modal\";\r\nimport { Setup2FAModal } from \"../components/security/setup-2fa-modal\";\r\nimport { VerifyPhoneModal } from \"../components/security/verify-phone-modal\";\r\nimport { SecurityQuestionsModal } from \"../components/security/security-questions-modal\";\r\nimport { SecurityEventsModal } from \"../components/security/security-events-modal\";\r\nimport { ActiveSessionsModal } from \"../components/security/active-sessions-modal\";\r\n\r\ninterface SecurityTabProps {\r\n  userEmail: string;\r\n  userId: string;\r\n}\r\n\r\ninterface NotificationSettings {\r\n  login_alerts: boolean;\r\n  account_changes: boolean;\r\n  appointment_reminders: boolean;\r\n  lab_results: boolean;\r\n  doctor_messages: boolean;\r\n  security_alerts: boolean;\r\n  password_changes: boolean;\r\n  new_device_login: boolean;\r\n  suspicious_activity: boolean;\r\n}\r\n\r\nexport function SecurityTabNew({ userEmail, userId }: SecurityTabProps) {\r\n  const [activeModal, setActiveModal] = useState<string | null>(null);\r\n  \r\n  // Inicializar con valores por defecto - sin loading\r\n  const [notifications, setNotifications] = useState<NotificationSettings>({\r\n    login_alerts: true,\r\n    account_changes: true,\r\n    appointment_reminders: true,\r\n    lab_results: true,\r\n    doctor_messages: true,\r\n    security_alerts: true,\r\n    password_changes: true,\r\n    new_device_login: true,\r\n    suspicious_activity: true,\r\n  });\r\n  \r\n  const [has2FA, setHas2FA] = useState(false);\r\n  const [hasSecurityQuestions, setHasSecurityQuestions] = useState(false);\r\n  const [phoneVerified, setPhoneVerified] = useState(false);\r\n\r\n  // Cargar configuraciones en segundo plano sin bloquear la UI\r\n  useEffect(() => {\r\n    loadSecuritySettingsInBackground();\r\n  }, []);\r\n\r\n  const loadSecuritySettingsInBackground = async () => {\r\n    try {\r\n      // TODO: Implementar llamadas reales cuando las APIs estén listas\r\n      // Por ahora, simular datos locales\r\n      \r\n      // Cargar desde localStorage o Supabase\r\n      const stored = localStorage.getItem(`security_settings_${userId}`);\r\n      if (stored) {\r\n        const data = JSON.parse(stored);\r\n        if (data.notifications) setNotifications(data.notifications);\r\n        if (data.has2FA !== undefined) setHas2FA(data.has2FA);\r\n        if (data.hasSecurityQuestions !== undefined) setHasSecurityQuestions(data.hasSecurityQuestions);\r\n        if (data.phoneVerified !== undefined) setPhoneVerified(data.phoneVerified);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error loading security settings:\", error);\r\n    }\r\n  };\r\n\r\n  const handleNotificationToggle = (key: keyof NotificationSettings) => {\r\n    const updated = { ...notifications, [key]: !notifications[key] };\r\n    setNotifications(updated);\r\n\r\n    // Guardar en localStorage\r\n    try {\r\n      const stored = localStorage.getItem(`security_settings_${userId}`) || \"{}\";\r\n      const data = JSON.parse(stored);\r\n      data.notifications = updated;\r\n      localStorage.setItem(`security_settings_${userId}`, JSON.stringify(data));\r\n      \r\n      // TODO: Sincronizar con backend cuando esté listo\r\n    } catch (error) {\r\n      console.error(\"Error saving notifications:\", error);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <motion.article\r\n      key=\"security\"\r\n      initial={{ opacity: 0, x: -20 }}\r\n      animate={{ opacity: 1, x: 0 }}\r\n      exit={{ opacity: 0, x: 20 }}\r\n    >\r\n      <header className=\"mb-6\">\r\n        <h2 className=\"text-xl font-semibold text-gray-900\">\r\n          Seguridad de la Cuenta\r\n        </h2>\r\n        <p className=\"text-sm text-gray-500 mt-1\">\r\n          Protege tu cuenta y mantén tu información segura\r\n        </p>\r\n      </header>\r\n\r\n      <div className=\"grid grid-cols-2 gap-6\">\r\n        {/* Columna Izquierda - Seguridad */}\r\n        <section className=\"space-y-4\">\r\n          <h3 className=\"font-semibold text-gray-900 mb-3\">\r\n            Configuración de Seguridad\r\n          </h3>\r\n\r\n          {/* Cambiar Contraseña */}\r\n          <button\r\n            onClick={() => setActiveModal(\"password\")}\r\n            className=\"w-full flex items-center justify-between p-4 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors text-left\"\r\n          >\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"p-2 bg-blue-100 rounded-lg\">\r\n                <Lock className=\"h-5 w-5 text-blue-600\" />\r\n              </div>\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-900\">\r\n                  Cambiar Contraseña\r\n                </p>\r\n                <p className=\"text-xs text-gray-500\">\r\n                  Actualiza tu contraseña regularmente\r\n                </p>\r\n              </div>\r\n            </div>\r\n            <Edit2 className=\"h-4 w-4 text-gray-400\" />\r\n          </button>\r\n\r\n          {/* 2FA */}\r\n          <button\r\n            onClick={() => setActiveModal(\"2fa\")}\r\n            className=\"w-full flex items-center justify-between p-4 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors text-left\"\r\n          >\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"p-2 bg-purple-100 rounded-lg\">\r\n                <Shield className=\"h-5 w-5 text-purple-600\" />\r\n              </div>\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-900\">\r\n                  Autenticación de Dos Factores (2FA)\r\n                </p>\r\n                <p className=\"text-xs text-gray-500\">\r\n                  {has2FA ? \"Activado\" : \"Agrega una capa extra de seguridad\"}\r\n                </p>\r\n              </div>\r\n            </div>\r\n            {has2FA ? (\r\n              <span className=\"inline-flex items-center gap-1 text-xs font-medium text-green-700 bg-green-100 px-3 py-1 rounded-full\">\r\n                <Check className=\"h-3 w-3\" />\r\n                Activo\r\n              </span>\r\n            ) : (\r\n              <span className=\"text-xs font-medium text-gray-500 bg-gray-100 px-3 py-1 rounded-full\">\r\n                Configurar\r\n              </span>\r\n            )}\r\n          </button>\r\n\r\n          {/* Verificación de Email */}\r\n          <div className=\"w-full flex items-center justify-between p-4 rounded-lg border border-gray-200 bg-gray-50\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"p-2 bg-green-100 rounded-lg\">\r\n                <Mail className=\"h-5 w-5 text-green-600\" />\r\n              </div>\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-900\">\r\n                  Verificación de Email\r\n                </p>\r\n                <p className=\"text-xs text-gray-500\">{userEmail}</p>\r\n              </div>\r\n            </div>\r\n            <span className=\"inline-flex items-center gap-1 text-xs font-medium text-green-700 bg-green-100 px-3 py-1 rounded-full\">\r\n              <Check className=\"h-3 w-3\" />\r\n              Verificado\r\n            </span>\r\n          </div>\r\n\r\n          {/* Verificación de Teléfono */}\r\n          <button\r\n            onClick={() => setActiveModal(\"phone\")}\r\n            className=\"w-full flex items-center justify-between p-4 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors text-left\"\r\n          >\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"p-2 bg-orange-100 rounded-lg\">\r\n                <Smartphone className=\"h-5 w-5 text-orange-600\" />\r\n              </div>\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-900\">\r\n                  Verificación de Teléfono\r\n                </p>\r\n                <p className=\"text-xs text-gray-500\">\r\n                  {phoneVerified ? \"Teléfono verificado\" : \"Verifica tu número de teléfono\"}\r\n                </p>\r\n              </div>\r\n            </div>\r\n            {phoneVerified ? (\r\n              <span className=\"inline-flex items-center gap-1 text-xs font-medium text-green-700 bg-green-100 px-3 py-1 rounded-full\">\r\n                <Check className=\"h-3 w-3\" />\r\n                Verificado\r\n              </span>\r\n            ) : (\r\n              <span className=\"text-xs font-medium text-gray-500 bg-gray-100 px-3 py-1 rounded-full\">\r\n                Verificar\r\n              </span>\r\n            )}\r\n          </button>\r\n\r\n          {/* Preguntas de Seguridad */}\r\n          <button\r\n            onClick={() => setActiveModal(\"questions\")}\r\n            className=\"w-full flex items-center justify-between p-4 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors text-left\"\r\n          >\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"p-2 bg-red-100 rounded-lg\">\r\n                <Key className=\"h-5 w-5 text-red-600\" />\r\n              </div>\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-900\">\r\n                  Preguntas de Seguridad\r\n                </p>\r\n                <p className=\"text-xs text-gray-500\">\r\n                  {hasSecurityQuestions ? \"Configuradas\" : \"Para recuperación de cuenta\"}\r\n                </p>\r\n              </div>\r\n            </div>\r\n            {hasSecurityQuestions ? (\r\n              <Edit2 className=\"h-4 w-4 text-gray-400\" />\r\n            ) : (\r\n              <span className=\"text-xs font-medium text-gray-500 bg-gray-100 px-3 py-1 rounded-full\">\r\n                Configurar\r\n              </span>\r\n            )}\r\n          </button>\r\n\r\n          {/* Sesiones Activas */}\r\n          <button\r\n            onClick={() => setActiveModal(\"sessions\")}\r\n            className=\"w-full flex items-center justify-between p-4 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors text-left\"\r\n          >\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"p-2 bg-indigo-100 rounded-lg\">\r\n                <Monitor className=\"h-5 w-5 text-indigo-600\" />\r\n              </div>\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-900\">\r\n                  Sesiones Activas\r\n                </p>\r\n                <p className=\"text-xs text-gray-500\">\r\n                  Administra tus dispositivos conectados\r\n                </p>\r\n              </div>\r\n            </div>\r\n            <Edit2 className=\"h-4 w-4 text-gray-400\" />\r\n          </button>\r\n\r\n          {/* Historial de Seguridad */}\r\n          <button\r\n            onClick={() => setActiveModal(\"events\")}\r\n            className=\"w-full flex items-center justify-between p-4 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors text-left\"\r\n          >\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"p-2 bg-gray-100 rounded-lg\">\r\n                <History className=\"h-5 w-5 text-gray-600\" />\r\n              </div>\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-900\">\r\n                  Historial de Seguridad\r\n                </p>\r\n                <p className=\"text-xs text-gray-500\">\r\n                  Ver eventos recientes de tu cuenta\r\n                </p>\r\n              </div>\r\n            </div>\r\n            <Edit2 className=\"h-4 w-4 text-gray-400\" />\r\n          </button>\r\n        </section>\r\n\r\n        {/* Columna Derecha - Notificaciones */}\r\n        <section className=\"space-y-4\">\r\n          <h3 className=\"font-semibold text-gray-900 mb-3\">\r\n            Notificaciones de Seguridad\r\n          </h3>\r\n\r\n          {notifications && (\r\n            <div className=\"space-y-3\">\r\n              {[\r\n                {\r\n                  key: \"login_alerts\" as keyof NotificationSettings,\r\n                  label: \"Alertas de Inicio de Sesión\",\r\n                  description: \"Notificar nuevos accesos\",\r\n                },\r\n                {\r\n                  key: \"new_device_login\" as keyof NotificationSettings,\r\n                  label: \"Nuevos Dispositivos\",\r\n                  description: \"Accesos desde dispositivos desconocidos\",\r\n                },\r\n                {\r\n                  key: \"password_changes\" as keyof NotificationSettings,\r\n                  label: \"Cambios de Contraseña\",\r\n                  description: \"Cuando se modifica tu contraseña\",\r\n                },\r\n                {\r\n                  key: \"account_changes\" as keyof NotificationSettings,\r\n                  label: \"Cambios en la Cuenta\",\r\n                  description: \"Modificaciones importantes\",\r\n                },\r\n                {\r\n                  key: \"suspicious_activity\" as keyof NotificationSettings,\r\n                  label: \"Actividad Sospechosa\",\r\n                  description: \"Intentos de acceso no autorizados\",\r\n                },\r\n                {\r\n                  key: \"appointment_reminders\" as keyof NotificationSettings,\r\n                  label: \"Recordatorios de Citas\",\r\n                  description: \"24 horas antes\",\r\n                },\r\n                {\r\n                  key: \"lab_results\" as keyof NotificationSettings,\r\n                  label: \"Resultados de Laboratorio\",\r\n                  description: \"Cuando estén listos\",\r\n                },\r\n                {\r\n                  key: \"doctor_messages\" as keyof NotificationSettings,\r\n                  label: \"Mensajes de Médicos\",\r\n                  description: \"Respuestas y consultas\",\r\n                },\r\n              ].map((item) => (\r\n                <div\r\n                  key={item.key}\r\n                  className=\"flex items-center justify-between p-4 rounded-lg border border-gray-200\"\r\n                >\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <Bell className=\"h-5 w-5 text-gray-600\" />\r\n                    <div>\r\n                      <p className=\"text-sm font-medium text-gray-900\">\r\n                        {item.label}\r\n                      </p>\r\n                      <p className=\"text-xs text-gray-500\">{item.description}</p>\r\n                    </div>\r\n                  </div>\r\n                  <label className=\"relative inline-flex items-center cursor-pointer\">\r\n                    <input\r\n                      type=\"checkbox\"\r\n                      className=\"sr-only peer\"\r\n                      checked={notifications[item.key]}\r\n                      onChange={() => handleNotificationToggle(item.key)}\r\n                    />\r\n                    <div className=\"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600\"></div>\r\n                  </label>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n\r\n          <aside className=\"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mt-4\">\r\n            <div className=\"flex items-start gap-3\">\r\n              <AlertCircle className=\"h-5 w-5 text-yellow-600 mt-0.5\" />\r\n              <div>\r\n                <h4 className=\"font-semibold text-yellow-900 mb-1\">\r\n                  Recomendación de Seguridad\r\n                </h4>\r\n                <p className=\"text-sm text-yellow-700\">\r\n                  {!has2FA && \"Activa la autenticación de dos factores para mayor seguridad. \"}\r\n                  {!hasSecurityQuestions && \"Configura preguntas de seguridad para recuperar tu cuenta. \"}\r\n                  {!phoneVerified && \"Verifica tu teléfono para recibir alertas importantes.\"}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </aside>\r\n        </section>\r\n      </div>\r\n\r\n      {/* Modales */}\r\n      <ChangePasswordModal\r\n        isOpen={activeModal === \"password\"}\r\n        onClose={() => setActiveModal(null)}\r\n        userEmail={userEmail}\r\n      />\r\n      <Setup2FAModal\r\n        isOpen={activeModal === \"2fa\"}\r\n        onClose={() => {\r\n          setActiveModal(null);\r\n          loadSecuritySettingsInBackground();\r\n        }}\r\n        has2FA={has2FA}\r\n      />\r\n      <VerifyPhoneModal\r\n        isOpen={activeModal === \"phone\"}\r\n        onClose={() => {\r\n          setActiveModal(null);\r\n          loadSecuritySettingsInBackground();\r\n        }}\r\n      />\r\n      <SecurityQuestionsModal\r\n        isOpen={activeModal === \"questions\"}\r\n        onClose={() => {\r\n          setActiveModal(null);\r\n          loadSecuritySettingsInBackground();\r\n        }}\r\n      />\r\n      <ActiveSessionsModal\r\n        isOpen={activeModal === \"sessions\"}\r\n        onClose={() => setActiveModal(null)}\r\n      />\r\n      <SecurityEventsModal\r\n        isOpen={activeModal === \"events\"}\r\n        onClose={() => setActiveModal(null)}\r\n      />\r\n    </motion.article>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\tabs\\security-tab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\profile\\user-profile-modal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isSaving' is assigned a value but never used.","line":62,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":62,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":97,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":97,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { fetchProfile, setProfile } from \"@/lib/redux/profileSlice\";\r\nimport type { RootState, AppDispatch } from \"@/lib/redux/store\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport {\r\n  User,\r\n  Heart,\r\n  FileText,\r\n  Shield,\r\n  Settings,\r\n  Eye,\r\n  Activity,\r\n  CreditCard,\r\n} from \"lucide-react\";\r\nimport { ModalHeader } from \"./components/modal-header\";\r\nimport { TabNavigation } from \"./components/tab-navigation\";\r\nimport { ProfileTab } from \"./tabs/profile-tab\";\r\nimport { MedicalTabImproved as MedicalTab } from \"./tabs/medical-tab-improved\";\r\nimport { DocumentsTabDidit as DocumentsTab } from \"./tabs/documents-tab-didit\";\r\nimport { SecurityTabNew as SecurityTab } from \"./tabs/security-tab-new\";\r\nimport { PreferencesTab } from \"./tabs/preferences-tab\";\r\nimport { PrivacyTab } from \"./tabs/privacy-tab\";\r\nimport { ActivityTab } from \"./tabs/activity-tab\";\r\nimport { BillingTab } from \"./tabs/billing-tab\";\r\nimport { useAvatarUpload } from \"./hooks/use-avatar-upload\";\r\nimport { useThemeColor } from \"@/hooks/use-theme-color\";\r\nimport { Toast, type ToastType } from \"@red-salud/ui\";\r\nimport type { UserProfileModalProps, TabType, TabConfig, FormData } from \"./types\";\r\n\r\nconst TABS: TabConfig[] = [\r\n  { id: \"profile\", label: \"Mi Perfil\", icon: User },\r\n  { id: \"medical\", label: \"Info. Médica\", icon: Heart },\r\n  { id: \"documents\", label: \"Documentos\", icon: FileText },\r\n  { id: \"security\", label: \"Seguridad\", icon: Shield },\r\n  { id: \"preferences\", label: \"Preferencias\", icon: Settings },\r\n  { id: \"privacy\", label: \"Privacidad\", icon: Eye },\r\n  { id: \"activity\", label: \"Actividad\", icon: Activity },\r\n  { id: \"billing\", label: \"Facturación\", icon: CreditCard },\r\n];\r\n\r\nexport function UserProfileModal({\r\n  isOpen,\r\n  onClose,\r\n  userName,\r\n  userEmail,\r\n  userId,\r\n}: UserProfileModalProps) {\r\n    const [activeTab, setActiveTab] = useState<TabType>(\"profile\");\r\n    const dispatch = useDispatch<AppDispatch>();\r\n    const profileState = useSelector((state: RootState) => state.profile);\r\n  const { themeColor, setThemeColor } = useThemeColor();\r\n  \r\n  // Toast state\r\n  const [toastMessage, setToastMessage] = useState(\"\");\r\n  const [toastType, setToastType] = useState<ToastType>(\"info\");\r\n  const [showToast, setShowToast] = useState(false);\r\n\r\n  const [isEditing, setIsEditing] = useState(false);\r\n  const [isSaving, setIsSaving] = useState(false);\r\n\r\n  const showNotification = (message: string, type: ToastType = \"info\") => {\r\n    setToastMessage(message);\r\n    setToastType(type);\r\n    setShowToast(true);\r\n  };\r\n\r\n  // Cargar datos del perfil cuando se abre el modal\r\n  useEffect(() => {\r\n    if (isOpen && userId && profileState.status === \"idle\") {\r\n      dispatch(fetchProfile(userId));\r\n    }\r\n  }, [isOpen, userId, dispatch, profileState.status]);\r\n\r\n  const {\r\n    avatarHover,\r\n    setAvatarHover,\r\n    fileInputRef,\r\n    handleAvatarClick,\r\n    handleFileChange,\r\n  } = useAvatarUpload(async (file) => {\r\n    if (!userId) {\r\n      showNotification(\"Error: Usuario no identificado\", \"error\");\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      showNotification(\"Subiendo imagen...\", \"info\");\r\n      // TODO: Implementar subida con Supabase Storage\r\n      console.log(\"Uploading file:\", file, \"for user:\", userId);\r\n      \r\n      // Simulación temporal - remover cuando se implemente Supabase Storage\r\n      await new Promise(resolve => setTimeout(resolve, 1000));\r\n      showNotification(\"Imagen subida correctamente (pendiente implementación)\", \"warning\");\r\n    } catch (error) {\r\n      showNotification(\"Error al subir la imagen\", \"error\");\r\n    }\r\n  });\r\n\r\n  const handleSave = async (dataOverride?: FormData) => {\r\n    if (!userId) {\r\n      showNotification(\"Error: Usuario no identificado\", \"error\");\r\n      return { success: false, error: \"Usuario no identificado\" };\r\n    }\r\n\r\n    // Usar datos proporcionados o los del estado de Redux\r\n    const dataToSave = dataOverride || profileState.data;\r\n\r\n    if (!dataToSave) {\r\n      showNotification(\"Error: No hay datos para guardar\", \"error\");\r\n      return { success: false, error: \"No hay datos para guardar\" };\r\n    }\r\n\r\n    setIsSaving(true);\r\n    try {\r\n      console.log(\"📤 Enviando datos al backend:\", {\r\n        userId,\r\n        ...dataToSave,\r\n      });\r\n      \r\n      const response = await fetch(\"/api/profile/update\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify({\r\n          userId,\r\n          ...dataToSave,\r\n        }),\r\n      });\r\n\r\n      const result = await response.json();\r\n\r\n      if (!response.ok) {\r\n        const errorMessage = result.message || \"Error al guardar el perfil\";\r\n        showNotification(errorMessage, \"error\");\r\n        return { success: false, error: errorMessage };\r\n      }\r\n\r\n      setIsEditing(false);\r\n      showNotification(\"Perfil actualizado correctamente\", \"success\");\r\n      \r\n      // Esperar un momento antes de recargar para asegurar consistencia en la BD\r\n      await new Promise(resolve => setTimeout(resolve, 300));\r\n      \r\n      // Recargar datos del perfil desde el servidor\r\n      if (userId) {\r\n        await dispatch(fetchProfile(userId));\r\n      }\r\n      \r\n      return { success: true };\r\n    } catch (error) {\r\n      console.error(\"Error saving:\", error);\r\n      const errorMessage = error instanceof Error ? error.message : \"Error al conectar con el servidor\";\r\n      showNotification(errorMessage, \"error\");\r\n      return { success: false, error: errorMessage };\r\n    } finally {\r\n      setIsSaving(false);\r\n    }\r\n  };\r\n\r\n  const handleTabChange = (tab: TabType) => {\r\n    setActiveTab(tab);\r\n    setIsEditing(false);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {/* Toast Notification */}\r\n      <Toast\r\n        message={toastMessage}\r\n        type={toastType}\r\n        isVisible={showToast}\r\n        onClose={() => setShowToast(false)}\r\n      />\r\n\r\n      <AnimatePresence>\r\n        {isOpen && (\r\n          <>\r\n            {/* Overlay */}\r\n            <motion.div\r\n              initial={{ opacity: 0 }}\r\n              animate={{ opacity: 1 }}\r\n              exit={{ opacity: 0 }}\r\n              onClick={onClose}\r\n              className=\"fixed inset-0 bg-black/50 z-100\"\r\n              aria-hidden=\"true\"\r\n            />\r\n\r\n            {/* Modal */}\r\n            <motion.dialog\r\n            initial={{ opacity: 0, scale: 0.95 }}\r\n            animate={{ opacity: 1, scale: 1 }}\r\n            exit={{ opacity: 0, scale: 0.95 }}\r\n            open={isOpen}\r\n            className=\"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-7xl h-[95vh] bg-white rounded-xl shadow-2xl z-101 overflow-hidden flex flex-col\"\r\n            style={{ translateX: '-50%', translateY: '-50%' }}\r\n            aria-labelledby=\"profile-modal-title\"\r\n            aria-modal=\"true\"\r\n          >\r\n            <ModalHeader\r\n              userName={userName}\r\n              userEmail={userEmail}\r\n              onClose={onClose}\r\n              avatarHover={avatarHover}\r\n              onAvatarHover={setAvatarHover}\r\n              onAvatarClick={handleAvatarClick}\r\n              fileInputRef={fileInputRef}\r\n              onFileChange={handleFileChange}\r\n              themeColor={themeColor}\r\n              onThemeColorChange={setThemeColor}\r\n            />\r\n\r\n            <TabNavigation\r\n              tabs={TABS}\r\n              activeTab={activeTab}\r\n              onTabChange={handleTabChange}\r\n            />\r\n\r\n            {/* Content Area - Scrollable */}\r\n            <main className=\"flex-1 overflow-y-auto\">\r\n              <div className=\"p-8\">\r\n                {profileState.status === \"loading\" && (\r\n                  <div className=\"flex items-center justify-center h-64\">\r\n                    <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\r\n                  </div>\r\n                )}\r\n                \r\n                {profileState.status === \"failed\" && (\r\n                  <div className=\"flex items-center justify-center h-64\">\r\n                    <div className=\"text-center\">\r\n                      <p className=\"text-red-600 mb-4\">{profileState.error || \"Error al cargar el perfil\"}</p>\r\n                      <button\r\n                        onClick={() => userId && dispatch(fetchProfile(userId))}\r\n                        className=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700\"\r\n                      >\r\n                        Reintentar\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {profileState.status === \"succeeded\" && profileState.data && (\r\n                  <AnimatePresence mode=\"wait\">\r\n                    {activeTab === \"profile\" && (\r\n                      <ProfileTab\r\n                        formData={profileState.data}\r\n                        setFormData={(data) => dispatch(setProfile(data))}\r\n                        isEditing={isEditing}\r\n                        setIsEditing={setIsEditing}\r\n                        handleSave={handleSave}\r\n                      />\r\n                    )}\r\n                    {activeTab === \"medical\" && (\r\n                      <MedicalTab\r\n                        formData={profileState.data}\r\n                        setFormData={(data) => dispatch(setProfile(data))}\r\n                        isEditing={isEditing}\r\n                        setIsEditing={setIsEditing}\r\n                        handleSave={handleSave}\r\n                      />\r\n                    )}\r\n                    {activeTab === \"documents\" && (\r\n                      <DocumentsTab\r\n                        formData={profileState.data}\r\n                        isLoading={false}\r\n                      />\r\n                    )}\r\n                    {activeTab === \"security\" && (\r\n                      <SecurityTab userEmail={userEmail ?? \"\"} userId={userId ?? \"\"} />\r\n                    )}\r\n                    {activeTab === \"preferences\" && <PreferencesTab />}\r\n                    {activeTab === \"privacy\" && <PrivacyTab userId={userId ?? \"\"} />}\r\n                    {activeTab === \"activity\" && <ActivityTab userId={userId ?? \"\"} />}\r\n                    {activeTab === \"billing\" && <BillingTab userId={userId ?? \"\"} />}\r\n                  </AnimatePresence>\r\n                )}\r\n              </div>\r\n            </main>\r\n          </motion.dialog>\r\n        </>\r\n      )}\r\n    </AnimatePresence>\r\n    </>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\tour-guide\\spotlight.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\tour-guide\\tour-guide-overlay.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\tour-guide\\tour-guide-provider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\tour-guide\\tour-tooltip.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\dashboard\\shared\\tour-guide\\tour-trigger-button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\layout\\footer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\layout\\header.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'APP_NAME' is defined but never used.","line":8,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":26}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport Link from \"next/link\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport { Menu, X, ChevronDown } from \"lucide-react\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { ROUTES, APP_NAME, AUTH_ROUTES } from \"@/lib/constants\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Logo } from \"@red-salud/ui\";\r\nimport { ThemeToggle } from \"@red-salud/ui\";\r\nimport { MainNav } from \"@/components/layout/main-nav\";\r\n\r\nconst servicios = [\r\n  { name: \"Pacientes\", href: \"/servicios/pacientes\", description: \"Consultas médicas en línea\" },\r\n  { name: \"Médicos\", href: \"/servicios/medicos\", description: \"Plataforma para profesionales\" },\r\n  { name: \"Clínicas\", href: \"/servicios/clinicas\", description: \"Gestión de centros médicos\" },\r\n  { name: \"Laboratorios\", href: \"/servicios/laboratorios\", description: \"Análisis y resultados\" },\r\n  { name: \"Farmacias\", href: \"/servicios/farmacias\", description: \"Gestión de medicamentos\" },\r\n  { name: \"Secretarias\", href: \"/servicios/secretarias\", description: \"Organiza agendas médicas\" },\r\n  { name: \"Ambulancias\", href: \"/servicios/ambulancias\", description: \"Servicio de emergencias\" },\r\n  { name: \"Seguros\", href: \"/servicios/seguros\", description: \"Gestión de pólizas\" },\r\n];\r\n\r\nconst navItems = [\r\n  { name: \"Inicio\", href: ROUTES.HOME },\r\n  { name: \"Nosotros\", href: ROUTES.NOSOTROS },\r\n  { name: \"Servicios\", href: ROUTES.SERVICIOS, hasDropdown: true },\r\n  { name: \"Precios\", href: ROUTES.PRECIOS },\r\n  { name: \"Blog\", href: ROUTES.BLOG },\r\n  { name: \"Soporte\", href: ROUTES.SOPORTE },\r\n];\r\n\r\n\r\n\r\nexport function Header() {\r\n  const [isScrolled, setIsScrolled] = useState(false);\r\n  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const handleScroll = () => {\r\n      setIsScrolled(window.scrollY > 20);\r\n    };\r\n\r\n    window.addEventListener(\"scroll\", handleScroll);\r\n    return () => window.removeEventListener(\"scroll\", handleScroll);\r\n  }, []);\r\n\r\n  return (\r\n    <motion.header\r\n      className={cn(\r\n        \"fixed top-0 left-0 right-0 z-50 transition-all duration-300\",\r\n        isScrolled\r\n          ? \"bg-background/95 backdrop-blur-xl shadow-lg border-b border-border/50\"\r\n          : \"bg-transparent\"\r\n      )}\r\n      initial={{ y: -100 }}\r\n      animate={{ y: 0 }}\r\n      transition={{ duration: 0.6, ease: [0.6, -0.05, 0.01, 0.99] }}\r\n    >\r\n      <nav className=\"container mx-auto px-4 sm:px-6 lg:px-8\">\r\n        <div className=\"flex items-center justify-between h-16 sm:h-20\">\r\n          {/* Logo */}\r\n          <motion.div\r\n            initial={{ opacity: 0, x: -20 }}\r\n            animate={{ opacity: 1, x: 0 }}\r\n            transition={{ duration: 0.5, delay: 0.2 }}\r\n          >\r\n            <Link href={ROUTES.HOME} className=\"hover:opacity-80 transition-opacity\">\r\n              <Logo size=\"lg\" />\r\n            </Link>\r\n          </motion.div>\r\n\r\n          {/* Desktop Navigation */}\r\n          <motion.div\r\n            className=\"hidden xl:flex items-center space-x-1\"\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            transition={{ duration: 0.5, delay: 0.4 }}\r\n          >\r\n            <MainNav isScrolled={isScrolled} />\r\n          </motion.div>\r\n\r\n          {/* Theme Toggle + Auth Buttons Desktop */}\r\n          <motion.div\r\n            className=\"hidden xl:flex items-center gap-3\"\r\n            initial={{ opacity: 0, x: 20 }}\r\n            animate={{ opacity: 1, x: 0 }}\r\n            transition={{ duration: 0.5, delay: 0.6 }}\r\n          >\r\n            <ThemeToggle />\r\n            <Button\r\n              asChild\r\n              variant=\"outline\"\r\n              className=\"border border-border hover:border-primary/50 text-foreground hover:bg-primary/5 transition-all duration-300\"\r\n            >\r\n              <Link href={AUTH_ROUTES.LOGIN}>Iniciar Sesión</Link>\r\n            </Button>\r\n            <Button\r\n              asChild\r\n              className=\"bg-primary hover:bg-primary/90 text-primary-foreground shadow-lg shadow-primary/20 hover:shadow-xl hover:shadow-primary/30 transition-all duration-300\"\r\n            >\r\n              <Link href={AUTH_ROUTES.REGISTER}>Registrarse</Link>\r\n            </Button>\r\n          </motion.div>\r\n\r\n          {/* Mobile Menu Button */}\r\n          <motion.button\r\n            className=\"xl:hidden p-2 rounded-lg\"\r\n            onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            transition={{ duration: 0.5, delay: 0.4 }}\r\n            aria-label=\"Toggle menu\"\r\n            aria-expanded={isMobileMenuOpen}\r\n            aria-controls=\"mobile-menu\"\r\n          >\r\n            {isMobileMenuOpen ? (\r\n              <X className=\"h-6 w-6 text-foreground\" />\r\n            ) : (\r\n              <Menu className=\"h-6 w-6 text-foreground\" />\r\n            )}\r\n          </motion.button>\r\n        </div>\r\n      </nav>\r\n\r\n      {/* Mobile Menu */}\r\n      <AnimatePresence>\r\n        {isMobileMenuOpen && (\r\n          <motion.div\r\n            id=\"mobile-menu\"\r\n            className=\"xl:hidden bg-background border-t border-border\"\r\n            initial={{ opacity: 0, height: 0 }}\r\n            animate={{ opacity: 1, height: \"auto\" }}\r\n            exit={{ opacity: 0, height: 0 }}\r\n            transition={{ duration: 0.3 }}\r\n          >\r\n            <div className=\"container mx-auto px-4 py-6 space-y-3\">\r\n              {navItems.map((item) => (\r\n                <motion.div\r\n                  key={item.name}\r\n                  initial={{ opacity: 0, x: -20 }}\r\n                  animate={{ opacity: 1, x: 0 }}\r\n                  exit={{ opacity: 0, x: -20 }}\r\n                  transition={{ duration: 0.3 }}\r\n                >\r\n                  {item.hasDropdown ? (\r\n                    <MobileServiciosItem />\r\n                  ) : (\r\n                    <Link\r\n                      href={item.href}\r\n                      className=\"block px-4 py-3 rounded-lg text-foreground hover:bg-primary/5 hover:text-primary transition-colors duration-300 font-medium\"\r\n                      onClick={() => setIsMobileMenuOpen(false)}\r\n                    >\r\n                      {item.name}\r\n                    </Link>\r\n                  )}\r\n                </motion.div>\r\n              ))}\r\n              <motion.div\r\n                initial={{ opacity: 0, x: -20 }}\r\n                animate={{ opacity: 1, x: 0 }}\r\n                exit={{ opacity: 0, x: -20 }}\r\n                transition={{ duration: 0.3, delay: 0.2 }}\r\n                className=\"pt-4 flex flex-col gap-3\"\r\n              >\r\n                <div className=\"flex items-center justify-between\">\r\n                  <ThemeToggle />\r\n                </div>\r\n                <Button\r\n                  asChild\r\n                  variant=\"outline\"\r\n                  size=\"lg\"\r\n                  className=\"w-full\"\r\n                >\r\n                  <Link\r\n                    href={AUTH_ROUTES.LOGIN}\r\n                    onClick={() => setIsMobileMenuOpen(false)}\r\n                  >\r\n                    Iniciar Sesión\r\n                  </Link>\r\n                </Button>\r\n                <Button\r\n                  asChild\r\n                  size=\"lg\"\r\n                  className=\"w-full bg-primary hover:bg-primary/90 text-primary-foreground shadow-lg shadow-primary/20\"\r\n                >\r\n                  <Link\r\n                    href={AUTH_ROUTES.REGISTER}\r\n                    onClick={() => setIsMobileMenuOpen(false)}\r\n                  >\r\n                    Registrarse\r\n                  </Link>\r\n                </Button>\r\n              </motion.div>\r\n            </div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n    </motion.header>\r\n  );\r\n}\r\n\r\nfunction MobileServiciosItem() {\r\n  const [open, setOpen] = useState(false);\r\n  return (\r\n    <div>\r\n      <button\r\n        className=\"w-full px-4 py-3 rounded-lg text-foreground hover:bg-primary/5 hover:text-primary transition-colors duration-300 font-medium flex items-center justify-between\"\r\n        onClick={() => setOpen(!open)}\r\n        aria-expanded={open}\r\n        aria-controls=\"mobile-servicios\"\r\n      >\r\n        Servicios\r\n        <ChevronDown className={cn(\"h-4 w-4 transition-transform\", open && \"rotate-180\")} />\r\n      </button>\r\n      <AnimatePresence>\r\n        {open && (\r\n          <motion.div\r\n            id=\"mobile-servicios\"\r\n            initial={{ opacity: 0, height: 0 }}\r\n            animate={{ opacity: 1, height: \"auto\" }}\r\n            exit={{ opacity: 0, height: 0 }}\r\n            className=\"mt-2 ml-2 border-l border-border\"\r\n          >\r\n            <div className=\"pl-4 space-y-1\">\r\n              {servicios.map((s) => (\r\n                <Link key={s.name} href={s.href} className=\"block px-3 py-2 rounded-md text-muted-foreground hover:bg-primary/5 hover:text-primary transition-colors\" >\r\n                  {s.name}\r\n                </Link>\r\n              ))}\r\n            </div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\layout\\main-nav.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isScrolled' is defined but never used.","line":84,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":84,"endColumn":37}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport Link from \"next/link\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport {\r\n    NavigationMenu,\r\n    NavigationMenuContent,\r\n    NavigationMenuItem,\r\n    NavigationMenuLink,\r\n    NavigationMenuList,\r\n    NavigationMenuTrigger,\r\n    navigationMenuTriggerStyle,\r\n} from \"@red-salud/ui\";\r\nimport { ROUTES } from \"@/lib/constants\";\r\nimport {\r\n    Users,\r\n    Stethoscope,\r\n    Building2,\r\n    FlaskConical,\r\n    Pill,\r\n    UserCog,\r\n    GraduationCap\r\n} from \"lucide-react\";\r\n\r\ninterface MainNavProps {\r\n    isScrolled: boolean;\r\n}\r\n\r\nconst categories = [\r\n    {\r\n        title: \"Profesionales\",\r\n        items: [\r\n            {\r\n                title: \"Médicos\",\r\n                href: \"/servicios/medicos\",\r\n                description: \"Plataforma para profesionales.\",\r\n                icon: Stethoscope,\r\n            },\r\n            {\r\n                title: \"Secretarias\",\r\n                href: \"/servicios/secretarias\",\r\n                description: \"Gestión de agendas.\",\r\n                icon: UserCog,\r\n            },\r\n        ],\r\n    },\r\n    {\r\n        title: \"Instituciones\",\r\n        items: [\r\n            {\r\n                title: \"Clínicas\",\r\n                href: \"/servicios/clinicas\",\r\n                description: \"Gestión de centros médicos.\",\r\n                icon: Building2,\r\n            },\r\n            {\r\n                title: \"Laboratorios\",\r\n                href: \"/servicios/laboratorios\",\r\n                description: \"Análisis y resultados.\",\r\n                icon: FlaskConical,\r\n            },\r\n            {\r\n                title: \"Farmacias\",\r\n                href: \"/servicios/farmacias\",\r\n                description: \"Control de inventario.\",\r\n                icon: Pill,\r\n            },\r\n        ],\r\n    },\r\n    {\r\n        title: \"Educación\",\r\n        items: [\r\n            {\r\n                title: \"Academy\",\r\n                href: \"/academy\",\r\n                description: \"Aprende medicina jugando.\",\r\n                icon: GraduationCap,\r\n            },\r\n        ],\r\n    },\r\n];\r\n\r\nexport function MainNav({ isScrolled }: MainNavProps) {\r\n    const triggerColorClass = \"text-foreground hover:bg-primary/5 hover:text-primary transition-colors\";\r\n\r\n    return (\r\n        <NavigationMenu>\r\n            <NavigationMenuList>\r\n                <NavigationMenuItem>\r\n                    <NavigationMenuLink asChild>\r\n                        <Link\r\n                            href={ROUTES.HOME}\r\n                            className={cn(\r\n                                navigationMenuTriggerStyle(),\r\n                                \"bg-transparent hover:bg-transparent focus:bg-transparent data-[active]:bg-transparent data-[state=open]:bg-transparent\",\r\n                                triggerColorClass,\r\n                                \"text-sm font-medium transition-all duration-300 hover:scale-105 px-3 md:px-4\"\r\n                            )}\r\n                        >\r\n                            Inicio\r\n                        </Link>\r\n                    </NavigationMenuLink>\r\n                </NavigationMenuItem>\r\n\r\n                <NavigationMenuItem>\r\n                    <NavigationMenuLink asChild>\r\n                        <Link\r\n                            href={ROUTES.NOSOTROS}\r\n                            className={cn(\r\n                                navigationMenuTriggerStyle(),\r\n                                \"bg-transparent hover:bg-transparent focus:bg-transparent data-[active]:bg-transparent data-[state=open]:bg-transparent\",\r\n                                triggerColorClass,\r\n                                \"text-sm font-medium transition-all duration-300 hover:scale-105 px-3 md:px-4\"\r\n                            )}\r\n                        >\r\n                            Nosotros\r\n                        </Link>\r\n                    </NavigationMenuLink>\r\n                </NavigationMenuItem>\r\n\r\n                <NavigationMenuItem>\r\n                    <NavigationMenuTrigger\r\n                        className={cn(\r\n                            \"bg-transparent hover:bg-transparent focus:bg-transparent data-[active]:bg-transparent data-[state=open]:bg-transparent\",\r\n                            triggerColorClass,\r\n                            \"text-sm font-medium transition-all duration-300 hover:scale-105 px-3 md:px-4\"\r\n                        )}\r\n                    >\r\n                        Servicios\r\n                    </NavigationMenuTrigger>\r\n                    <NavigationMenuContent>\r\n                        <div className=\"flex flex-col md:flex-row gap-6 p-6 w-[350px] md:w-[750px] lg:w-[850px]\">\r\n                            {/* Principal - Pacientes */}\r\n                            <div className=\"flex-shrink-0 w-full md:w-[240px]\">\r\n                                <div className=\"mb-3 text-xs font-semibold uppercase text-muted-foreground tracking-wider px-1\">\r\n                                    Principal\r\n                                </div>\r\n                                <NavigationMenuLink asChild>\r\n                                    <Link\r\n                                        className=\"group relative flex h-full min-h-[280px] w-full select-none flex-col justify-between overflow-hidden rounded-xl bg-gradient-to-br from-primary via-primary/90 to-secondary p-6 no-underline outline-none shadow-lg shadow-primary/20 transition-all hover:scale-[1.02] hover:shadow-2xl hover:shadow-primary/30 focus:shadow-xl\"\r\n                                        href=\"/servicios/pacientes\"\r\n                                    >\r\n                                        {/* Decorative background elements */}\r\n                                        <div className=\"absolute inset-0 bg-gradient-to-tr from-white/5 to-transparent opacity-0 transition-opacity group-hover:opacity-100\" />\r\n                                        <div className=\"absolute -right-8 -top-8 h-32 w-32 rounded-full bg-white/10 blur-2xl\" />\r\n                                        <div className=\"absolute -bottom-8 -left-8 h-32 w-32 rounded-full bg-secondary/30 blur-2xl\" />\r\n\r\n                                        {/* Content */}\r\n                                        <div className=\"relative z-10\">\r\n                                            <div className=\"mb-4 inline-flex rounded-lg bg-white/20 p-3 backdrop-blur-sm\">\r\n                                                <Users className=\"h-8 w-8 text-white\" />\r\n                                            </div>\r\n                                            <div className=\"mb-2 text-2xl font-bold text-white\">\r\n                                                Pacientes\r\n                                            </div>\r\n                                            <p className=\"text-sm leading-relaxed text-white/95\">\r\n                                                Agenda citas, revisa tu historial y gestiona tu salud desde cualquier lugar.\r\n                                            </p>\r\n                                        </div>\r\n\r\n                                        {/* Arrow indicator */}\r\n                                        <div className=\"relative z-10 flex items-center gap-2 text-sm font-medium text-white/90 transition-all group-hover:gap-3 group-hover:text-white\">\r\n                                            <span>Explorar</span>\r\n                                            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\r\n                                                <path d=\"M5 12h14\" />\r\n                                                <path d=\"m12 5 7 7-7 7\" />\r\n                                            </svg>\r\n                                        </div>\r\n                                    </Link>\r\n                                </NavigationMenuLink>\r\n                            </div>\r\n\r\n                            {/* Categorized Grid */}\r\n                            <div className=\"flex-1 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n                                {categories.map((category) => (\r\n                                    <div key={category.title} className=\"space-y-3\">\r\n                                        <div className=\"text-xs font-semibold uppercase text-muted-foreground tracking-wider px-2\">\r\n                                            {category.title}\r\n                                        </div>\r\n                                        <ul className=\"space-y-1\">\r\n                                            {category.items.map((item) => (\r\n                                                <ListItem\r\n                                                    key={item.title}\r\n                                                    title={item.title}\r\n                                                    href={item.href}\r\n                                                    icon={item.icon}\r\n                                                >\r\n                                                    {item.description}\r\n                                                </ListItem>\r\n                                            ))}\r\n                                        </ul>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    </NavigationMenuContent>\r\n                </NavigationMenuItem>\r\n\r\n                <NavigationMenuItem>\r\n                    <NavigationMenuLink asChild>\r\n                        <Link\r\n                            href={ROUTES.PRECIOS}\r\n                            className={cn(\r\n                                navigationMenuTriggerStyle(),\r\n                                \"bg-transparent hover:bg-transparent focus:bg-transparent data-[active]:bg-transparent data-[state=open]:bg-transparent\",\r\n                                triggerColorClass,\r\n                                \"text-sm font-medium transition-all duration-300 hover:scale-105 px-3 md:px-4\"\r\n                            )}\r\n                        >\r\n                            Precios\r\n                        </Link>\r\n                    </NavigationMenuLink>\r\n                </NavigationMenuItem>\r\n\r\n                <NavigationMenuItem>\r\n                    <NavigationMenuLink asChild>\r\n                        <Link\r\n                            href={ROUTES.BLOG}\r\n                            className={cn(\r\n                                navigationMenuTriggerStyle(),\r\n                                \"bg-transparent hover:bg-transparent focus:bg-transparent data-[active]:bg-transparent data-[state=open]:bg-transparent\",\r\n                                triggerColorClass,\r\n                                \"text-sm font-medium transition-all duration-300 hover:scale-105 px-3 md:px-4\"\r\n                            )}\r\n                        >\r\n                            Blog\r\n                        </Link>\r\n                    </NavigationMenuLink>\r\n                </NavigationMenuItem>\r\n\r\n                <NavigationMenuItem>\r\n                    <NavigationMenuLink asChild>\r\n                        <Link\r\n                            href={ROUTES.SOPORTE}\r\n                            className={cn(\r\n                                navigationMenuTriggerStyle(),\r\n                                \"bg-transparent hover:bg-transparent focus:bg-transparent data-[active]:bg-transparent data-[state=open]:bg-transparent\",\r\n                                triggerColorClass,\r\n                                \"text-sm font-medium transition-all duration-300 hover:scale-105 px-3 md:px-4\"\r\n                            )}\r\n                        >\r\n                            Soporte\r\n                        </Link>\r\n                    </NavigationMenuLink>\r\n                </NavigationMenuItem>\r\n            </NavigationMenuList>\r\n        </NavigationMenu>\r\n    );\r\n}\r\n\r\nconst ListItem = React.forwardRef<\r\n    React.ElementRef<\"a\">,\r\n    React.ComponentPropsWithoutRef<\"a\"> & { icon?: React.ComponentType<{ className?: string }> }\r\n>(({ className, title, children, icon: Icon, href, ...props }, ref) => {\r\n    return (\r\n        <li>\r\n            <NavigationMenuLink asChild>\r\n                <Link\r\n                    ref={ref as React.Ref<HTMLAnchorElement>}\r\n                    href={href || \"#\"}\r\n                    className={cn(\r\n                        \"block select-none space-y-1 rounded-lg p-3 leading-none no-underline outline-none transition-colors hover:bg-primary/5 hover:text-primary focus:bg-primary/5 focus:text-primary\",\r\n                        className\r\n                    )}\r\n                    {...props}\r\n                >\r\n                    <div className=\"flex items-center gap-2 text-sm font-semibold leading-none text-foreground\">\r\n                        {Icon && <Icon className=\"h-4 w-4 text-primary\" />}\r\n                        {title}\r\n                    </div>\r\n                    <p className=\"line-clamp-1 text-xs leading-snug text-muted-foreground mt-1.5 ml-6\">\r\n                        {children}\r\n                    </p>\r\n                </Link>\r\n            </NavigationMenuLink>\r\n        </li>\r\n    );\r\n});\r\nListItem.displayName = \"ListItem\";\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\messaging\\calls\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\messaging\\commands\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\messaging\\conversation-list.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@red-salud/ui\";\r\nimport { Badge } from \"@red-salud/ui\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { ScrollArea } from \"@red-salud/ui\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport type { Conversation } from \"@/lib/supabase/types/messaging\";\r\nimport { MessageSquare, Archive } from \"lucide-react\";\r\nimport { formatDistanceToNow } from \"date-fns\";\r\nimport { es } from \"date-fns/locale\";\r\n\r\ninterface ConversationListProps {\r\n  conversations: Conversation[];\r\n  selectedId?: string;\r\n  onSelect: (conversation: Conversation) => void;\r\n  currentUserId: string;\r\n  showArchived?: boolean;\r\n}\r\n\r\nexport function ConversationList({\r\n  conversations,\r\n  selectedId,\r\n  onSelect,\r\n  currentUserId,\r\n  showArchived = false,\r\n}: ConversationListProps) {\r\n  const filteredConversations = conversations.filter((conv) =>\r\n    showArchived ? conv.status === \"archived\" : conv.status === \"active\"\r\n  );\r\n\r\n  if (filteredConversations.length === 0) {\r\n    return (\r\n      <div className=\"flex flex-col items-center justify-center h-full p-8 text-center\">\r\n        <MessageSquare className=\"h-12 w-12 text-muted-foreground mb-4\" />\r\n        <p className=\"text-muted-foreground\">\r\n          {showArchived\r\n            ? \"No hay conversaciones archivadas\"\r\n            : \"No hay conversaciones activas\"}\r\n        </p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <ScrollArea className=\"h-full\">\r\n      <div className=\"space-y-2 p-4\">\r\n        {filteredConversations.map((conversation) => {\r\n          const otherUser =\r\n            conversation.patient_id === currentUserId\r\n              ? conversation.doctor\r\n              : conversation.patient;\r\n\r\n          const initials = otherUser?.nombre_completo\r\n            ?.split(\" \")\r\n            .map((n) => n[0])\r\n            .join(\"\")\r\n            .toUpperCase()\r\n            .slice(0, 2);\r\n\r\n          const lastMessageTime = conversation.last_message_at\r\n            ? formatDistanceToNow(new Date(conversation.last_message_at), {\r\n                addSuffix: true,\r\n                locale: es,\r\n              })\r\n            : null;\r\n\r\n          return (\r\n            <button\r\n              key={conversation.id}\r\n              onClick={() => onSelect(conversation)}\r\n              className={cn(\r\n                \"w-full p-4 rounded-lg border text-left transition-colors hover:bg-accent\",\r\n                selectedId === conversation.id && \"bg-accent border-primary\"\r\n              )}\r\n            >\r\n              <div className=\"flex items-start gap-3\">\r\n                <Avatar className=\"h-10 w-10\">\r\n                  <AvatarImage src={otherUser?.avatar_url} />\r\n                  <AvatarFallback>{initials}</AvatarFallback>\r\n                </Avatar>\r\n\r\n                <div className=\"flex-1 min-w-0\">\r\n                  <div className=\"flex items-center justify-between mb-1\">\r\n                    <p className=\"font-medium truncate\">\r\n                      {otherUser?.nombre_completo}\r\n                    </p>\r\n                    {lastMessageTime && (\r\n                      <span className=\"text-xs text-muted-foreground\">\r\n                        {lastMessageTime}\r\n                      </span>\r\n                    )}\r\n                  </div>\r\n\r\n                  {conversation.subject && (\r\n                    <p className=\"text-sm text-muted-foreground truncate mb-1\">\r\n                      {conversation.subject}\r\n                    </p>\r\n                  )}\r\n\r\n                  {conversation.last_message && (\r\n                    <p className=\"text-sm text-muted-foreground truncate\">\r\n                      {conversation.last_message.content}\r\n                    </p>\r\n                  )}\r\n\r\n                  <div className=\"flex items-center gap-2 mt-2\">\r\n                    {conversation.unread_count! > 0 && (\r\n                      <Badge variant=\"default\" className=\"text-xs\">\r\n                        {conversation.unread_count} nuevo\r\n                        {conversation.unread_count! > 1 ? \"s\" : \"\"}\r\n                      </Badge>\r\n                    )}\r\n                    {conversation.status === \"archived\" && (\r\n                      <Badge variant=\"secondary\" className=\"text-xs\">\r\n                        <Archive className=\"h-3 w-3 mr-1\" />\r\n                        Archivada\r\n                      </Badge>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </button>\r\n          );\r\n        })}\r\n      </div>\r\n    </ScrollArea>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\messaging\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\messaging\\input\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\messaging\\message-input.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Paperclip' is defined but never used.","line":6,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cn' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":12}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { Textarea } from \"@red-salud/ui\";\r\nimport { Send, Paperclip, Loader2 } from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\ninterface MessageInputProps {\r\n  onSend: (content: string) => Promise<void>;\r\n  disabled?: boolean;\r\n  placeholder?: string;\r\n}\r\n\r\nexport function MessageInput({\r\n  onSend,\r\n  disabled = false,\r\n  placeholder = \"Escribe tu mensaje...\",\r\n}: MessageInputProps) {\r\n  const [content, setContent] = useState(\"\");\r\n  const [sending, setSending] = useState(false);\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n\r\n    if (!content.trim() || sending || disabled) return;\r\n\r\n    setSending(true);\r\n    try {\r\n      await onSend(content.trim());\r\n      setContent(\"\");\r\n    } catch (error) {\r\n      console.error(\"Error sending message:\", error);\r\n    } finally {\r\n      setSending(false);\r\n    }\r\n  };\r\n\r\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\r\n    if (e.key === \"Enter\" && !e.shiftKey) {\r\n      e.preventDefault();\r\n      handleSubmit(e);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit} className=\"border-t p-4\">\r\n      <div className=\"flex gap-2\">\r\n        <Textarea\r\n          value={content}\r\n          onChange={(e) => setContent(e.target.value)}\r\n          onKeyDown={handleKeyDown}\r\n          placeholder={placeholder}\r\n          disabled={disabled || sending}\r\n          className=\"min-h-[60px] max-h-[120px] resize-none\"\r\n          rows={2}\r\n        />\r\n\r\n        <div className=\"flex flex-col gap-2\">\r\n          <Button\r\n            type=\"submit\"\r\n            size=\"icon\"\r\n            disabled={!content.trim() || disabled || sending}\r\n            className=\"h-[60px]\"\r\n          >\r\n            {sending ? (\r\n              <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n            ) : (\r\n              <Send className=\"h-4 w-4\" />\r\n            )}\r\n          </Button>\r\n        </div>\r\n      </div>\r\n\r\n      <p className=\"text-xs text-muted-foreground mt-2\">\r\n        Presiona Enter para enviar, Shift+Enter para nueva línea\r\n      </p>\r\n    </form>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\messaging\\message-thread.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used.","line":11,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@red-salud/ui\";\r\nimport { ScrollArea } from \"@red-salud/ui\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport type { Message } from \"@/lib/supabase/types/messaging\";\r\nimport { format } from \"date-fns\";\r\nimport { es } from \"date-fns/locale\";\r\nimport { useEffect, useRef } from \"react\";\r\nimport { FileText, Download } from \"lucide-react\";\r\nimport { Button } from \"@red-salud/ui\";\r\n\r\ninterface MessageThreadProps {\r\n  messages: Message[];\r\n  currentUserId: string;\r\n}\r\n\r\nexport function MessageThread({ messages, currentUserId }: MessageThreadProps) {\r\n  const scrollRef = useRef<HTMLDivElement>(null);\r\n\r\n  useEffect(() => {\r\n    // Scroll al final cuando hay nuevos mensajes\r\n    if (scrollRef.current) {\r\n      scrollRef.current.scrollTop = scrollRef.current.scrollHeight;\r\n    }\r\n  }, [messages]);\r\n\r\n  if (messages.length === 0) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-full text-muted-foreground\">\r\n        No hay mensajes aún. Envía el primero para iniciar la conversación.\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <ScrollArea className=\"h-full p-4\" ref={scrollRef}>\r\n      <div className=\"space-y-4\">\r\n        {messages.map((message, index) => {\r\n          const isOwn = message.sender_id === currentUserId;\r\n          const showAvatar =\r\n            index === 0 ||\r\n            messages[index - 1].sender_id !== message.sender_id;\r\n\r\n          const initials = message.sender?.nombre_completo\r\n            ?.split(\" \")\r\n            .map((n) => n[0])\r\n            .join(\"\")\r\n            .toUpperCase()\r\n            .slice(0, 2);\r\n\r\n          return (\r\n            <div\r\n              key={message.id}\r\n              className={cn(\r\n                \"flex gap-3\",\r\n                isOwn ? \"flex-row-reverse\" : \"flex-row\"\r\n              )}\r\n            >\r\n              {showAvatar ? (\r\n                <Avatar className=\"h-8 w-8\">\r\n                  <AvatarImage src={message.sender?.avatar_url} />\r\n                  <AvatarFallback>{initials}</AvatarFallback>\r\n                </Avatar>\r\n              ) : (\r\n                <div className=\"w-8\" />\r\n              )}\r\n\r\n              <div\r\n                className={cn(\r\n                  \"flex flex-col max-w-[70%]\",\r\n                  isOwn ? \"items-end\" : \"items-start\"\r\n                )}\r\n              >\r\n                {showAvatar && !isOwn && (\r\n                  <span className=\"text-xs font-medium mb-1\">\r\n                    {message.sender?.nombre_completo}\r\n                  </span>\r\n                )}\r\n\r\n                <div\r\n                  className={cn(\r\n                    \"rounded-lg px-4 py-2\",\r\n                    isOwn\r\n                      ? \"bg-primary text-primary-foreground\"\r\n                      : \"bg-muted\"\r\n                  )}\r\n                >\r\n                  <p className=\"text-sm whitespace-pre-wrap break-words\">\r\n                    {message.content}\r\n                  </p>\r\n\r\n                  {message.attachment_url && (\r\n                    <div className=\"mt-2 pt-2 border-t border-current/20\">\r\n                      <a\r\n                        href={message.attachment_url}\r\n                        target=\"_blank\"\r\n                        rel=\"noopener noreferrer\"\r\n                        className=\"flex items-center gap-2 text-xs hover:underline\"\r\n                      >\r\n                        <FileText className=\"h-4 w-4\" />\r\n                        <span className=\"truncate\">\r\n                          {message.attachment_name || \"Archivo adjunto\"}\r\n                        </span>\r\n                        <Download className=\"h-3 w-3\" />\r\n                      </a>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                <span className=\"text-xs text-muted-foreground mt-1\">\r\n                  {format(new Date(message.created_at), \"HH:mm\", {\r\n                    locale: es,\r\n                  })}\r\n                  {message.is_read && isOwn && \" · Leído\"}\r\n                </span>\r\n              </div>\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n    </ScrollArea>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\messaging\\new-conversation-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\messaging\\polls\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\nosotros\\ArchitectVariantC.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\nosotros\\BannerVariantD.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\nosotros\\CapacidadesVariantD.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\nosotros\\ContactoVariantB.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\nosotros\\DNAHelixVisual.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\nosotros\\ManifestoVariantB.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\nosotros\\VisionVariantD.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\nosotros\\index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\providers\\app-providers.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\providers\\supabase-auth-provider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\advantages-section.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\comparison-section.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\cta-section.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\dashboard-stats.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\faq-section.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\featured-doctors\\DoctorCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\featured-doctors\\FeaturedDoctors.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\featured-doctors\\FeaturedDoctorsSkeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\featured-doctors\\PlaceholderCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\featured-doctors\\featured-doctors-data.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\featured-doctors\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\features-section\\FeatureCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\features-section\\FeaturesSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\features-section\\features-section.data.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\features-section\\features-section.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\features-section\\index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\final-cta-section.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\hero-section.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'loading' is assigned a value but never used.","line":59,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":59,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { motion, useScroll, useTransform } from \"framer-motion\";\r\nimport {\r\n  ShieldCheck,\r\n  Users,\r\n  Activity,\r\n  Star,\r\n  ArrowRight,\r\n  LogIn,\r\n  Search,\r\n  Bell,\r\n  Calendar,\r\n  Home,\r\n  User,\r\n  Menu,\r\n  Stethoscope\r\n} from \"lucide-react\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport { AUTH_ROUTES } from \"@/lib/constants\";\r\nimport { useAuth } from \"@/hooks/use-auth\";\r\nimport { Counter } from \"@red-salud/ui\";\r\nimport { getDashboardMetrics, type DashboardMetrics } from \"@/lib/supabase/client\";\r\n\r\n// Animation variants\r\nconst fadeInUp = {\r\n  initial: { opacity: 0, y: 20 },\r\n  animate: { opacity: 1, y: 0, transition: { duration: 0.5 } }\r\n};\r\n\r\nconst staggerContainer = {\r\n  animate: { transition: { staggerChildren: 0.1 } }\r\n};\r\n\r\nconst floatAnimation = (delay: number) => ({\r\n  animate: {\r\n    y: [0, -10, 0],\r\n    transition: {\r\n      duration: 4,\r\n      repeat: Infinity,\r\n      repeatType: \"reverse\" as const,\r\n      ease: [0.4, 0, 0.2, 1] as const,\r\n      delay: delay,\r\n    },\r\n  },\r\n});\r\n\r\nconst defaultMetrics: DashboardMetrics = {\r\n  total_patients: 0,\r\n  total_doctors: 0,\r\n  total_specialties: 0,\r\n  satisfaction_percentage: 0,\r\n};\r\n\r\nexport function HeroSection() {\r\n  const { user } = useAuth();\r\n  const [metrics, setMetrics] = useState<DashboardMetrics>(defaultMetrics);\r\n  const [loading, setLoading] = useState(true);\r\n  const { scrollYProgress } = useScroll();\r\n  const yRange = useTransform(scrollYProgress, [0, 1], [0, 100]);\r\n\r\n  useEffect(() => {\r\n    async function loadMetrics() {\r\n      const data = await getDashboardMetrics();\r\n      if (data) setMetrics(data);\r\n      setLoading(false);\r\n    }\r\n    loadMetrics();\r\n    const interval = setInterval(loadMetrics, 30000);\r\n    return () => clearInterval(interval);\r\n  }, []);\r\n\r\n  return (\r\n    <section className=\"relative min-h-[90vh] lg:min-h-screen flex items-center pt-20 overflow-hidden bg-gradient-to-br from-blue-50/90 via-teal-50/60 to-slate-50 dark:from-background dark:via-background/95 dark:to-background\">\r\n      {/* Background Ambience */}\r\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\r\n        <div className=\"absolute top-[-10%] left-[-10%] w-[70%] h-[70%] bg-blue-200/30 dark:bg-primary/10 rounded-full blur-[120px] mix-blend-multiply dark:mix-blend-screen animate-pulse-slow\" />\r\n        <div className=\"absolute bottom-[-10%] right-[-10%] w-[60%] h-[60%] bg-teal-200/30 dark:bg-secondary/10 rounded-full blur-[120px] mix-blend-multiply dark:mix-blend-screen animate-pulse-slow delay-1000\" />\r\n        <div className=\"absolute top-[40%] left-[30%] w-[40%] h-[40%] bg-indigo-200/20 dark:bg-purple-500/5 rounded-full blur-[100px] mix-blend-multiply dark:mix-blend-screen animate-blob\" />\r\n        <div className=\"absolute inset-0 bg-[url('/grid.svg')] opacity-[0.4] dark:opacity-[0.03] bg-center [mask-image:radial-gradient(ellipse_at_center,black_50%,transparent_80%)]\" />\r\n      </div>\r\n\r\n      <div className=\"container relative z-10 px-4 sm:px-6 lg:px-8 mx-auto\">\r\n        <div className=\"grid lg:grid-cols-2 gap-8 lg:gap-4 items-center\">\r\n\r\n          {/* Left Content */}\r\n          <motion.div\r\n            variants={staggerContainer}\r\n            initial=\"initial\"\r\n            animate=\"animate\"\r\n            className=\"flex flex-col items-center lg:items-start text-center lg:text-left pt-10 lg:pt-0\"\r\n          >\r\n            <motion.div variants={fadeInUp} className=\"mb-6\">\r\n              <span className=\"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-primary/10 border border-primary/20 text-primary text-sm font-semibold tracking-wide\">\r\n                <span className=\"relative flex h-2 w-2\">\r\n                  <span className=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-primary opacity-75\"></span>\r\n                  <span className=\"relative inline-flex rounded-full h-2 w-2 bg-primary\"></span>\r\n                </span>\r\n                Ecosistema de Salud Integral\r\n              </span>\r\n            </motion.div>\r\n\r\n            <motion.h1\r\n              variants={fadeInUp}\r\n              className=\"text-4xl sm:text-5xl lg:text-6xl font-bold tracking-tight text-foreground mb-6 leading-[1.1]\"\r\n            >\r\n              Gestión de salud <br />\r\n              <span className=\"text-transparent bg-clip-text bg-gradient-to-r from-primary via-blue-500 to-secondary\">\r\n                inteligente y conectada\r\n              </span>\r\n            </motion.h1>\r\n\r\n            <motion.p\r\n              variants={fadeInUp}\r\n              className=\"text-lg sm:text-xl text-muted-foreground mb-8 max-w-xl leading-relaxed\"\r\n            >\r\n              Centralizamos tu bienestar. Agenda citas al instante, accede a tu historial clínico y conecta con especialistas certificados en una plataforma diseñada para ti.\r\n            </motion.p>\r\n\r\n            <motion.div\r\n              variants={fadeInUp}\r\n              className=\"flex flex-col sm:flex-row gap-4 w-full sm:w-auto\"\r\n            >\r\n              <Button\r\n                asChild\r\n                size=\"lg\"\r\n                className=\"h-14 px-8 text-lg rounded-full shadow-lg shadow-primary/25 hover:shadow-primary/40 hover:-translate-y-1 transition-all duration-300\"\r\n              >\r\n                <a href={user ? \"/dashboard/paciente/citas/nueva\" : AUTH_ROUTES.REGISTER}>\r\n                  {user ? \"Ir al Dashboard\" : \"Crear Cuenta Gratis\"}\r\n                  <ArrowRight className=\"ml-2 h-5 w-5\" />\r\n                </a>\r\n              </Button>\r\n              <Button\r\n                asChild\r\n                variant=\"outline\"\r\n                size=\"lg\"\r\n                className=\"h-14 px-8 text-lg rounded-full border-primary/20 hover:bg-primary/5 transition-all duration-300\"\r\n              >\r\n                <a href={AUTH_ROUTES.LOGIN}>\r\n                  <LogIn className=\"mr-2 h-5 w-5\" />\r\n                  Acceso Doctores\r\n                </a>\r\n              </Button>\r\n            </motion.div>\r\n\r\n            <motion.div variants={fadeInUp} className=\"mt-10 flex items-center gap-4 text-sm text-muted-foreground\">\r\n              <div className=\"flex items-center gap-1\">\r\n                <div className=\"flex -space-x-2\">\r\n                  {[1, 2, 3].map(i => (\r\n                    <div key={i} className=\"h-8 w-8 rounded-full border-2 border-background bg-muted flex items-center justify-center text-[10px] font-bold overflow-hidden\">\r\n                      <Users className=\"h-4 w-4 opacity-50\" />\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n                <div className=\"ml-2\">\r\n                  <strong className=\"text-foreground\"><Counter value={metrics.total_patients} /></strong> Pacientes confían en Red-Salud\r\n                </div>\r\n              </div>\r\n            </motion.div>\r\n          </motion.div>\r\n\r\n          {/* Right Visuals - 3D Interface */}\r\n          <motion.div\r\n            style={{ y: yRange }}\r\n            className=\"relative w-full flex justify-center lg:justify-center perspective-1000\"\r\n          >\r\n            {/* Interactive Composition Wrapper - Constrains the stats to the phone area */}\r\n            <div className=\"relative w-[300px] sm:w-[340px] h-[650px] mx-auto\">\r\n\r\n              {/* Central Phone Mockup */}\r\n              <motion.div\r\n                initial={{ opacity: 0, rotateY: -10, rotateX: 5 }}\r\n                animate={{ opacity: 1, rotateY: 0, rotateX: 0 }}\r\n                transition={{ duration: 0.8, ease: \"easeOut\" }}\r\n                className=\"relative z-20 w-full h-full bg-background rounded-[3rem] border-[10px] border-muted-foreground/10 shadow-2xl overflow-hidden ring-1 ring-border/50\"\r\n              >\r\n                {/* Phone Notch */}\r\n                <div className=\"absolute top-0 left-1/2 -translate-x-1/2 w-1/3 h-7 bg-black rounded-b-2xl z-30\" />\r\n\r\n                {/* Simulated App UI */}\r\n                <div className=\"w-full h-full bg-slate-50 dark:bg-slate-950 flex flex-col relative font-sans\">\r\n\r\n                  {/* App Header */}\r\n                  <div className=\"pt-12 px-6 pb-6 bg-white dark:bg-slate-900/50 backdrop-blur-md shadow-sm z-10 sticky top-0\">\r\n                    <div className=\"flex justify-between items-center mb-4\">\r\n                      <div className=\"flex items-center gap-3\">\r\n                        <div className=\"h-10 w-10 rounded-full bg-primary/10 border border-primary/20 flex items-center justify-center\">\r\n                          <User className=\"h-5 w-5 text-primary\" />\r\n                        </div>\r\n                        <div>\r\n                          <div className=\"text-xs text-muted-foreground\">Bienvenido,</div>\r\n                          <div className=\"text-sm font-bold text-foreground\">Carlos A.</div>\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"h-10 w-10 rounded-full bg-background border border-border flex items-center justify-center shadow-sm\">\r\n                        <Bell className=\"h-5 w-5 text-muted-foreground\" />\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Search Bar */}\r\n                    <div className=\"h-12 w-full bg-muted/50 rounded-2xl flex items-center px-4 gap-3 border border-border/50\">\r\n                      <Search className=\"h-4 w-4 text-muted-foreground\" />\r\n                      <span className=\"text-sm text-muted-foreground\">Buscar especialidad...</span>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Scrollable Content */}\r\n                  <div className=\"p-6 space-y-6 flex-1 overflow-y-hidden relative\">\r\n                    {/* Gradient Fade Overlay at bottom */}\r\n                    <div className=\"absolute bottom-0 left-0 right-0 h-20 bg-gradient-to-t from-background to-transparent z-10 pointer-events-none\" />\r\n\r\n                    {/* Next Appointment Card */}\r\n                    <div>\r\n                      <div className=\"flex justify-between items-center mb-3\">\r\n                        <h3 className=\"text-sm font-bold text-foreground\">Próxima Cita</h3>\r\n                        <span className=\"text-xs text-primary font-medium\">Ver todo</span>\r\n                      </div>\r\n                      <div className=\"w-full bg-gradient-to-br from-primary to-blue-600 rounded-3xl p-5 text-white shadow-lg shadow-primary/20 relative overflow-hidden group\">\r\n                        <div className=\"absolute right-[-10px] bottom-[-10px] opacity-10 group-hover:scale-110 transition-transform duration-500\">\r\n                          <Calendar className=\"h-32 w-32\" />\r\n                        </div>\r\n                        <div className=\"space-y-4 relative z-10\">\r\n                          <div className=\"flex items-start justify-between\">\r\n                            <div>\r\n                              <div className=\"text-blue-100 text-xs font-medium mb-1\">Mañana, 09:30 AM</div>\r\n                              <div className=\"text-lg font-bold\">Dr. Roberto G.</div>\r\n                              <div className=\"text-blue-100 text-xs\">Cardiología</div>\r\n                            </div>\r\n                            <div className=\"h-10 w-10 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center\">\r\n                              <Stethoscope className=\"h-5 w-5 text-white\" />\r\n                            </div>\r\n                          </div>\r\n                          <Button size=\"sm\" variant=\"secondary\" className=\"w-full rounded-xl bg-white/20 hover:bg-white/30 text-white border-none h-9 text-xs font-semibold backdrop-blur-sm\">\r\n                            Ver Detalles\r\n                          </Button>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Quick Services Grid */}\r\n                    <div>\r\n                      <h3 className=\"text-sm font-bold text-foreground mb-3\">Servicios Rápidos</h3>\r\n                      <div className=\"grid grid-cols-2 gap-3\">\r\n                        <div className=\"p-4 bg-white dark:bg-slate-900 rounded-2xl border border-border/50 shadow-sm hover:shadow-md transition-all flex flex-col items-center gap-2 text-center\">\r\n                          <div className=\"h-10 w-10 rounded-full bg-rose-500/10 flex items-center justify-center\">\r\n                            <Activity className=\"h-5 w-5 text-rose-500\" />\r\n                          </div>\r\n                          <span className=\"text-xs font-medium\">Resultados</span>\r\n                        </div>\r\n                        <div className=\"p-4 bg-white dark:bg-slate-900 rounded-2xl border border-border/50 shadow-sm hover:shadow-md transition-all flex flex-col items-center gap-2 text-center\">\r\n                          <div className=\"h-10 w-10 rounded-full bg-amber-500/10 flex items-center justify-center\">\r\n                            <Star className=\"h-5 w-5 text-amber-500\" />\r\n                          </div>\r\n                          <span className=\"text-xs font-medium\">Favoritos</span>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Recent Activity Fake Lines */}\r\n                    <div className=\"space-y-3 opacity-50\">\r\n                      <div className=\"h-14 w-full bg-muted/30 rounded-2xl\" />\r\n                      <div className=\"h-14 w-full bg-muted/30 rounded-2xl\" />\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Bottom Navigation */}\r\n                  <div className=\"h-20 bg-white dark:bg-slate-900 border-t border-border flex justify-around items-center px-6 pb-2\">\r\n                    <div className=\"flex flex-col items-center gap-1\">\r\n                      <Home className=\"h-6 w-6 text-primary\" />\r\n                      <span className=\"text-[10px] font-medium text-primary\">Inicio</span>\r\n                    </div>\r\n                    <div className=\"flex flex-col items-center gap-1 opacity-50\">\r\n                      <Calendar className=\"h-6 w-6\" />\r\n                      <span className=\"text-[10px] font-medium\">Agenda</span>\r\n                    </div>\r\n                    <div className=\"flex flex-col items-center gap-1 opacity-50\">\r\n                      <Menu className=\"h-6 w-6\" />\r\n                      <span className=\"text-[10px] font-medium\">Menú</span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </motion.div>\r\n\r\n              {/* Floating Stats Orbits - Tighter Positioning relative to wrapper */}\r\n\r\n              {/* Stat 1: Patients (Top Left) */}\r\n              <motion.div\r\n                variants={floatAnimation(0)}\r\n                initial=\"initial\" animate=\"animate\"\r\n                className=\"absolute top-[12%] -left-[14%] sm:-left-[18%] z-30\"\r\n              >\r\n                <div className=\"glass-card p-3 sm:p-4 rounded-2xl border border-white/20 shadow-xl backdrop-blur-md flex items-center gap-3 sm:gap-4 py-3 pr-6 min-w-[150px]\">\r\n                  <div className=\"h-10 w-10 rounded-full bg-blue-500/10 flex items-center justify-center text-blue-500\">\r\n                    <Users className=\"h-5 w-5\" />\r\n                  </div>\r\n                  <div>\r\n                    <div className=\"text-lg font-bold tabular-nums flex items-baseline\">\r\n                      <Counter value={metrics.total_patients} />\r\n                      <span className=\"text-xs ml-0.5 text-blue-500\">+</span>\r\n                    </div>\r\n                    <div className=\"text-[10px] text-muted-foreground font-medium uppercase tracking-wider\">Pacientes</div>\r\n                  </div>\r\n                </div>\r\n              </motion.div>\r\n\r\n              {/* Stat 2: Doctors (Bottom Right) */}\r\n              <motion.div\r\n                variants={floatAnimation(1)}\r\n                initial=\"initial\" animate=\"animate\"\r\n                className=\"absolute bottom-[22%] -right-[12%] sm:-right-[18%] z-30\"\r\n              >\r\n                <div className=\"glass-card p-3 sm:p-4 rounded-2xl border border-white/20 shadow-xl backdrop-blur-md flex items-center gap-3 sm:gap-4 py-3 pr-6 min-w-[150px]\">\r\n                  <div className=\"h-10 w-10 rounded-full bg-green-500/10 flex items-center justify-center text-green-500\">\r\n                    <ShieldCheck className=\"h-5 w-5\" />\r\n                  </div>\r\n                  <div>\r\n                    <div className=\"text-lg font-bold tabular-nums flex items-baseline\">\r\n                      <Counter value={metrics.total_doctors} />\r\n                      <span className=\"text-xs ml-0.5 text-green-500\">+</span>\r\n                    </div>\r\n                    <div className=\"text-[10px] text-muted-foreground font-medium uppercase tracking-wider\">Doctores</div>\r\n                  </div>\r\n                </div>\r\n              </motion.div>\r\n\r\n              {/* Stat 3: Satisfaction (Top Right) */}\r\n              <motion.div\r\n                variants={floatAnimation(2)}\r\n                initial=\"initial\" animate=\"animate\"\r\n                className=\"absolute top-[20%] -right-[8%] sm:-right-[12%] z-20\"\r\n              >\r\n                <div className=\"glass-card p-3 rounded-xl border border-white/20 shadow-lg backdrop-blur-md flex flex-col items-center gap-1 min-w-[90px]\">\r\n                  <div className=\"flex gap-0.5\">\r\n                    {[1, 2, 3, 4, 5].map(i => <Star key={i} className=\"h-3 w-3 text-amber-500 fill-amber-500\" />)}\r\n                  </div>\r\n                  <div className=\"text-sm font-bold\">\r\n                    <Counter value={metrics.satisfaction_percentage} />%\r\n                  </div>\r\n                  <div className=\"text-[10px] text-muted-foreground\">Satisfacción</div>\r\n                </div>\r\n              </motion.div>\r\n\r\n              {/* Stat 4: Specialties (Bottom Left) */}\r\n              <motion.div\r\n                variants={floatAnimation(1.5)}\r\n                initial=\"initial\" animate=\"animate\"\r\n                className=\"absolute bottom-[28%] -left-[8%] sm:-left-[12%] z-20\"\r\n              >\r\n                <div className=\"glass-card p-3 rounded-xl border border-white/20 shadow-lg backdrop-blur-md flex flex-col items-center gap-1 min-w-[90px]\">\r\n                  <Activity className=\"h-5 w-5 text-rose-500\" />\r\n                  <div className=\"text-sm font-bold\">\r\n                    <Counter value={metrics.total_specialties} />+\r\n                  </div>\r\n                  <div className=\"text-[10px] text-muted-foreground\">Esp.</div>\r\n                </div>\r\n              </motion.div>\r\n\r\n              {/* Floating Blobs behind Mockup */}\r\n              <div className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[350px] h-[350px] bg-gradient-to-tr from-primary/30 to-secondary/30 rounded-full blur-[60px] -z-10 animate-blob\" />\r\n\r\n            </div>\r\n          </motion.div>\r\n\r\n        </div>\r\n      </div>\r\n    </section>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\how-it-works-section.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Icon' is assigned a value but never used.","line":112,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":112,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { UserCheck, Calendar, Video, FileText, ArrowRight } from 'lucide-react';\r\n\r\nconst steps = [\r\n  {\r\n    icon: UserCheck,\r\n    number: '1',\r\n    title: 'Crea tu perfil',\r\n    description: 'Regístrate gratis en menos de 2 minutos. Solo necesitas correo y una contraseña segura.',\r\n    details: ['Información personal', 'Historial médico básico', 'Contacto de emergencia'],\r\n  },\r\n  {\r\n    icon: Calendar,\r\n    number: '2',\r\n    title: 'Busca tu médico',\r\n    description: 'Encuentra médicos por especialidad, ubicación, disponibilidad y valoraciones.',\r\n    details: ['Filtros avanzados', 'Ver horarios disponibles', 'Leer opiniones'],\r\n  },\r\n  {\r\n    icon: Video,\r\n    number: '3',\r\n    title: 'Agenda tu cita',\r\n    description: 'Elige la fecha y hora que mejor te convenga. Confirmación instantánea.',\r\n    details: ['Cita flexible', 'Recordatorio automático', 'Cambio fácil'],\r\n  },\r\n  {\r\n    icon: FileText,\r\n    number: '4',\r\n    title: 'Consulta y seguimiento',\r\n    description: 'Videoconsulta con tu médico. Recibe receta digital y seguimiento.',\r\n    details: ['Videollamada HD', 'Chat durante la consulta', 'Historial guardado'],\r\n  },\r\n];\r\n\r\nexport function HowItWorksSection() {\r\n  return (\r\n    <section id=\"como-funciona\" className=\"py-20 bg-gradient-to-b from-gray-50 to-white dark:from-slate-800 dark:to-slate-900\">\r\n      <div className=\"container mx-auto px-4 sm:px-6 lg:px-8\">\r\n        {/* Header */}\r\n        <div className=\"text-center mb-16\">\r\n          <div className=\"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-blue-100 dark:bg-blue-900/40 border border-blue-200 dark:border-blue-800 mb-6\">\r\n            <span className=\"text-sm font-medium text-blue-700 dark:text-blue-300\">\r\n              Proceso simple\r\n            </span>\r\n          </div>\r\n          <h2 className=\"text-4xl md:text-5xl font-bold text-gray-900 dark:text-white mb-4\">\r\n            ¿Cómo funciona?\r\n          </h2>\r\n          <p className=\"text-xl text-gray-600 dark:text-gray-300 max-w-2xl mx-auto\">\r\n            Cuatro pasos simples para comenzar tu camino hacia mejor salud\r\n          </p>\r\n        </div>\r\n\r\n        {/* Steps Grid */}\r\n        <div className=\"grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12\">\r\n          {steps.map((step, index) => {\r\n            const Icon = step.icon;\r\n            const isLast = index === steps.length - 1;\r\n\r\n            return (\r\n              <div key={step.number} className=\"relative\">\r\n                {/* Step card */}\r\n                <div className=\"h-full bg-white dark:bg-slate-800 rounded-2xl p-6 border border-gray-200 dark:border-slate-700 hover:border-blue-300 dark:hover:border-blue-700 transition-all duration-300 group hover:shadow-lg\">\r\n                  {/* Step number badge */}\r\n                  <div className=\"flex items-center justify-between mb-4\">\r\n                    <div className=\"w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-teal-500 flex items-center justify-center text-white font-bold text-lg\">\r\n                      {step.number}\r\n                    </div>\r\n                    {!isLast && (\r\n                      <ArrowRight className=\"h-6 w-6 text-gray-300 dark:text-gray-600 group-hover:text-blue-500 dark:group-hover:text-blue-400 transition-colors\" />\r\n                    )}\r\n                  </div>\r\n\r\n                  {/* Icon */}\r\n                  <div className=\"mb-4\">\r\n                    <Icon className=\"h-8 w-8 text-blue-600 dark:text-blue-400\" />\r\n                  </div>\r\n\r\n                  {/* Content */}\r\n                  <h3 className=\"text-lg font-bold text-gray-900 dark:text-white mb-2\">\r\n                    {step.title}\r\n                  </h3>\r\n                  <p className=\"text-gray-600 dark:text-gray-400 text-sm mb-4\">\r\n                    {step.description}\r\n                  </p>\r\n\r\n                  {/* Details list */}\r\n                  <div className=\"space-y-2 pt-4 border-t border-gray-200 dark:border-slate-700\">\r\n                    {step.details.map((detail) => (\r\n                      <div key={detail} className=\"flex items-start gap-2\">\r\n                        <div className=\"w-1.5 h-1.5 rounded-full bg-green-500 mt-1.5 shrink-0\" />\r\n                        <span className=\"text-sm text-gray-600 dark:text-gray-400\">{detail}</span>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Connection line (visible on lg screens, hidden on last item) */}\r\n                {!isLast && (\r\n                  <div className=\"hidden lg:block absolute top-1/2 -right-3 w-6 h-0.5 bg-gradient-to-r from-blue-400 to-transparent\" />\r\n                )}\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n\r\n        {/* Timeline for mobile/tablet */}\r\n        <div className=\"lg:hidden\">\r\n          <div className=\"space-y-4\">\r\n            {steps.map((step, index) => {\r\n              const Icon = step.icon;\r\n              return (\r\n                <div key={step.number} className=\"flex gap-4\">\r\n                  {/* Timeline line */}\r\n                  <div className=\"flex flex-col items-center\">\r\n                    <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-teal-500 flex items-center justify-center text-white font-bold text-sm\">\r\n                      {step.number}\r\n                    </div>\r\n                    {index !== steps.length - 1 && (\r\n                      <div className=\"w-1 h-12 bg-gradient-to-b from-blue-400 to-transparent mt-2\" />\r\n                    )}\r\n                  </div>\r\n\r\n                  {/* Content */}\r\n                  <div className=\"pb-4 pt-2\">\r\n                    <h3 className=\"font-bold text-gray-900 dark:text-white\">{step.title}</h3>\r\n                    <p className=\"text-gray-600 dark:text-gray-400 text-sm\">{step.description}</p>\r\n                  </div>\r\n                </div>\r\n              );\r\n            })}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\how-it-works.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useTransform' is defined but never used.","line":10,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":41},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'index' is defined but never used.","line":138,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":138,"endColumn":32},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isInView' is assigned a value but never used.","line":140,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":140,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file how-it-works.tsx\r\n * @description Sección \"Proceso Simplificado\" rediseñada con scroll-timeline y animaciones premium.\r\n * Implementa un efecto sticky donde la explicación general acompaña el scroll de las tarjetas.\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useRef } from \"react\";\r\nimport { motion, useScroll, useTransform, useSpring, useInView } from \"framer-motion\";\r\nimport { UserCircle, Settings, Share2, ArrowRight, Sparkles, CheckCircle2 } from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport Link from \"next/link\";\r\n\r\nconst steps = [\r\n  {\r\n    id: 1,\r\n    title: \"Crea tu Cuenta\",\r\n    subtitle: \"El inicio de tu ecosistema\",\r\n    description: \"Accede a la plataforma unificada de salud. Un solo registro te conecta con todo lo que necesitas, ya seas paciente que busca atención o especialista que ofrece sus servicios.\",\r\n    icon: UserCircle,\r\n    color: \"from-blue-500 to-cyan-400\",\r\n    shadow: \"shadow-blue-500/20\",\r\n    features: [\"Registro unificado\", \"Verificación segura\", \"Acceso inmediato\"]\r\n  },\r\n  {\r\n    id: 2,\r\n    title: \"Personaliza tu Experiencia\",\r\n    subtitle: \"Adaptado a tus necesidades\",\r\n    description: \"Configura tu perfil según tu rol. Los pacientes definen sus preferencias de búsqueda y los médicos establecen sus horarios y especialidades con herramientas flexibles.\",\r\n    icon: Settings,\r\n    color: \"from-violet-500 to-fuchsia-400\",\r\n    shadow: \"shadow-violet-500/20\",\r\n    features: [\"Ajustes flexibles\", \"Interfaz intuitiva\", \"Control total\"]\r\n  },\r\n  {\r\n    id: 3,\r\n    title: \"Conecta y Gestiona\",\r\n    subtitle: \"Interacción sin límites\",\r\n    description: \"Comienza a interactuar. Agenda citas, gestiona consultas y mantén el control total de tu salud o práctica médica desde un dashboard centralizado e inteligente.\",\r\n    icon: Share2,\r\n    color: \"from-emerald-500 to-teal-400\",\r\n    shadow: \"shadow-emerald-500/20\",\r\n    features: [\"Gestión centralizada\", \"Comunicación fluida\", \"Soporte constante\"]\r\n  }\r\n];\r\n\r\nexport function HowItWorksSection() {\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  const { scrollYProgress } = useScroll({\r\n    target: containerRef,\r\n    offset: [\"start start\", \"end end\"]\r\n  });\r\n\r\n  const springScroll = useSpring(scrollYProgress, {\r\n    stiffness: 100,\r\n    damping: 30,\r\n    restDelta: 0.001\r\n  });\r\n\r\n  return (\r\n    <section ref={containerRef} className=\"relative bg-background\">\r\n      {/* Dynamic Background */}\r\n      <div className=\"absolute inset-0 pointer-events-none overflow-hidden\">\r\n        <div className=\"absolute top-0 left-1/4 w-[500px] h-[500px] bg-primary/5 rounded-full blur-[100px] -translate-y-1/2\" />\r\n        <div className=\"absolute bottom-0 right-1/4 w-[500px] h-[500px] bg-blue-500/5 rounded-full blur-[100px] translate-y-1/2\" />\r\n        <div className=\"absolute inset-0 bg-[url('/noise.png')] opacity-[0.02] mix-blend-overlay\" />\r\n      </div>\r\n\r\n      <div className=\"container px-4 mx-auto\">\r\n        <div className=\"flex flex-col lg:flex-row gap-12 lg:gap-24 relative\">\r\n\r\n          {/* Sticky Header Section */}\r\n          <div className=\"lg:w-1/2 lg:h-screen lg:sticky lg:top-0 py-12 lg:py-0 flex flex-col justify-center z-10 transition-all duration-300\">\r\n            <div className=\"relative\">\r\n              <motion.div\r\n                initial={{ opacity: 0, x: -20 }}\r\n                whileInView={{ opacity: 1, x: 0 }}\r\n                viewport={{ once: true }}\r\n              >\r\n                <div className=\"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-primary/10 border border-primary/20 text-primary text-xs font-bold uppercase tracking-widest mb-6 w-fit\">\r\n                  <Sparkles className=\"w-3.5 h-3.5\" />\r\n                  <span>Proceso Simplificado</span>\r\n                </div>\r\n\r\n                <h2 className=\"text-4xl md:text-5xl lg:text-7xl font-black tracking-tight mb-8 leading-tight text-foreground\">\r\n                  Empieza en <br />\r\n                  <span className=\"text-transparent bg-clip-text bg-gradient-to-r from-primary via-blue-600 to-teal-500\">\r\n                    3 simples pasos\r\n                  </span>\r\n                </h2>\r\n\r\n                <p className=\"text-lg text-muted-foreground leading-relaxed max-w-lg mb-10\">\r\n                  Hemos simplificado la experiencia de salud digital.\r\n                  Sin burocracia, sin esperas y con la tecnología más avanzada\r\n                  trabajando para ti.\r\n                </p>\r\n\r\n                <div className=\"flex flex-wrap gap-4\">\r\n                  <Button asChild size=\"lg\" className=\"rounded-full px-8 text-base h-12 shadow-lg shadow-primary/25 hover:shadow-primary/40 transition-shadow\">\r\n                    <Link href=\"/auth/register\">\r\n                      Comenzar Ahora\r\n                      <ArrowRight className=\"ml-2 w-4 h-4\" />\r\n                    </Link>\r\n                  </Button>\r\n                  <Button asChild variant=\"outline\" size=\"lg\" className=\"rounded-full px-8 text-base h-12\">\r\n                    <Link href=\"/about\">\r\n                      Más Información\r\n                    </Link>\r\n                  </Button>\r\n                </div>\r\n              </motion.div>\r\n\r\n              {/* Decorative Line on Desktop */}\r\n              <div className=\"hidden lg:block absolute -left-8 top-1/2 -translate-y-1/2 h-3/4 w-[1px] bg-border/50\">\r\n                <motion.div\r\n                  style={{ height: springScroll, scaleY: scrollYProgress }}\r\n                  className=\"absolute top-0 left-0 w-full bg-primary origin-top\"\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Scrolling Steps Section */}\r\n          <div className=\"lg:w-1/2 py-12 lg:py-32 flex flex-col gap-32 lg:gap-[50vh] relative z-0\">\r\n            {steps.map((step, index) => (\r\n              <StepCard key={step.id} step={step} index={index} />\r\n            ))}\r\n          </div>\r\n\r\n        </div>\r\n      </div>\r\n    </section>\r\n  );\r\n}\r\n\r\nfunction StepCard({ step, index }: { step: typeof steps[0], index: number }) {\r\n  const ref = useRef(null);\r\n  const isInView = useInView(ref, { margin: \"-20% 0px -20% 0px\" });\r\n\r\n  return (\r\n    <motion.div\r\n      ref={ref}\r\n      initial={{ opacity: 0, y: 50, scale: 0.9 }}\r\n      whileInView={{ opacity: 1, y: 0, scale: 1 }}\r\n      viewport={{ once: true, margin: \"-100px\" }}\r\n      transition={{ duration: 0.7, type: \"spring\", bounce: 0.3 }}\r\n      className={cn(\r\n        \"relative rounded-3xl p-8 md:p-12 overflow-hidden border border-white/10 dark:border-white/5\",\r\n        \"bg-white/80 dark:bg-slate-900/80 backdrop-blur-xl shadow-2xl\",\r\n        step.shadow\r\n      )}\r\n    >\r\n      {/* Background Gradient */}\r\n      <div className={cn(\r\n        \"absolute -top-24 -right-24 w-64 h-64 rounded-full bg-gradient-to-br opacity-20 blur-3xl\",\r\n        step.color\r\n      )} />\r\n\r\n      <div className=\"relative z-10\">\r\n        <div className=\"flex items-center gap-4 mb-8\">\r\n          <div className={cn(\r\n            \"w-16 h-16 rounded-2xl flex items-center justify-center text-white shadow-lg bg-gradient-to-br\",\r\n            step.color\r\n          )}>\r\n            <step.icon className=\"w-8 h-8\" />\r\n          </div>\r\n          <span className=\"text-8xl font-black text-foreground/5 font-serif absolute -top-4 right-0 pointer-events-none select-none\">\r\n            0{step.id}\r\n          </span>\r\n        </div>\r\n\r\n        <h3 className=\"text-3xl font-bold mb-2\">{step.title}</h3>\r\n        <p className={cn(\"text-lg font-medium mb-6 bg-gradient-to-r bg-clip-text text-transparent w-fit\", step.color)}>\r\n          {step.subtitle}\r\n        </p>\r\n\r\n        <p className=\"text-muted-foreground leading-relaxed mb-8 text-lg\">\r\n          {step.description}\r\n        </p>\r\n\r\n        <div className=\"space-y-3\">\r\n          {step.features.map((feature, i) => (\r\n            <div key={i} className=\"flex items-center gap-3\">\r\n              <CheckCircle2 className={cn(\"w-5 h-5\", step.id === 1 ? \"text-blue-500\" : step.id === 2 ? \"text-violet-500\" : \"text-emerald-500\")} />\r\n              <span className=\"text-sm font-medium text-foreground/80\">{feature}</span>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    </motion.div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\how-it-works\\RoleCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\how-it-works\\StepCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\how-it-works\\how-it-works-data.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\how-it-works\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\impact-section\\ImpactSection.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useTransform' is defined but never used.","line":15,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":41},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MotionValue' is defined but never used.","line":15,"column":54,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":65}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\n/**\r\n * @file ImpactSection.tsx\r\n * @description Sección de Impacto rediseñada con Timeline robusto y responsive.\r\n * \r\n * Características:\r\n * - Diseño responsive: Vertical en móvil, Zigzag en desktop\r\n * - Animaciones estables con Framer Motion (variants)\r\n * - Línea de conexión animada\r\n * - Datos dinámicos de cobertura\r\n */\r\n\r\nimport { useRef } from \"react\";\r\nimport { motion, useScroll, useTransform, useSpring, MotionValue } from \"framer-motion\";\r\nimport { Counter } from \"@red-salud/ui\";\r\nimport { useImpactData } from \"./useImpactData\";\r\nimport { IMPACT_SECTION_CONTENT } from \"./impact-section.data\";\r\nimport { StatItem } from \"./impact-section.types\";\r\n\r\n/**\r\n * Componente de tarjeta individual del timeline\r\n */\r\nfunction TimelineCard({\r\n    stat,\r\n    index,\r\n    isLeft\r\n}: {\r\n    stat: StatItem;\r\n    index: number;\r\n    isLeft: boolean;\r\n}) {\r\n    // Parsear valores para efectos visuales\r\n    const isPercentage = stat.value.toString().includes(\"%\");\r\n    const isRatio = stat.value.toString().includes(\"/\") && !stat.value.toString().includes(\"24/7\");\r\n    const isNumeric = !isNaN(Number(stat.value));\r\n    const numericValue = isPercentage\r\n        ? parseInt(stat.value.replace(\"%\", \"\"))\r\n        : isNumeric\r\n            ? parseInt(stat.value)\r\n            : null;\r\n    const ratioParts = isRatio ? stat.value.toString().split(\"/\") : null;\r\n\r\n    const Icon = stat.icon;\r\n\r\n    return (\r\n        <div className={`relative flex items-center lg:w-1/2 ${isLeft ? 'lg:pr-12 lg:ml-auto lg:flex-row-reverse' : 'lg:pl-12 lg:mr-auto'}`}>\r\n\r\n            {/* Contenedor del contenido */}\r\n            <motion.div\r\n                initial={{ opacity: 0, y: 20 }}\r\n                whileInView={{ opacity: 1, y: 0 }}\r\n                transition={{ duration: 0.5, delay: index * 0.2 }}\r\n                viewport={{ once: true, margin: \"-100px\" }}\r\n                className={`relative w-full p-6 sm:p-8 rounded-3xl border shadow-lg hover:shadow-xl transition-all duration-300 group overflow-hidden ${stat.cardBgColor ?? 'bg-white dark:bg-slate-900'} ${stat.cardBorderColor ?? 'border-border/50'}`}\r\n            >\r\n                <div className=\"relative z-10 flex flex-col sm:flex-row items-start gap-4 sm:gap-6\">\r\n                    {/* Icono con background */}\r\n                    <motion.div\r\n                        whileHover={{ scale: 1.05 }}\r\n                        className={`flex-shrink-0 p-3 sm:p-4 rounded-2xl bg-gradient-to-br ${stat.color} shadow-lg`}\r\n                    >\r\n                        <Icon className=\"h-6 w-6 sm:h-8 sm:w-8 text-white\" />\r\n                    </motion.div>\r\n\r\n                    <div className=\"flex-1 min-w-0\">\r\n                        {/* Valor principal */}\r\n                        <div className={`text-3xl sm:text-4xl lg:text-5xl font-bold mb-2 bg-gradient-to-br ${stat.color} bg-clip-text text-transparent`}>\r\n                            {numericValue !== null && !isRatio ? (\r\n                                <div className=\"flex items-baseline gap-1\">\r\n                                    <Counter value={numericValue} />\r\n                                    {isPercentage && <span className=\"text-2xl sm:text-3xl\">%</span>}\r\n                                </div>\r\n                            ) : isRatio && ratioParts ? (\r\n                                <div className=\"flex items-baseline gap-1\">\r\n                                    <Counter value={parseInt(ratioParts[0])} />\r\n                                    <span className=\"text-2xl sm:text-3xl text-muted-foreground/60\">\r\n                                        /{ratioParts[1]}\r\n                                    </span>\r\n                                </div>\r\n                            ) : (\r\n                                stat.value\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Etiqueta */}\r\n                        <h3 className=\"text-lg sm:text-xl font-semibold text-foreground mb-1 sm:mb-2\">\r\n                            {stat.label}\r\n                        </h3>\r\n\r\n                        {/* Descripción */}\r\n                        <p className=\"text-sm sm:text-base text-muted-foreground leading-relaxed\">\r\n                            {stat.description}\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Línea decorativa inferior */}\r\n                <div className={`absolute bottom-0 left-0 h-1 bg-gradient-to-r ${stat.color} w-0 group-hover:w-full transition-all duration-700 ease-out`} />\r\n            </motion.div>\r\n\r\n            {/* Punto de conexión (Desktop y Mobile) */}\r\n            {/* En Desktop: Absoluto al centro */}\r\n            {/* En Mobile: Absoluto a la izquierda */}\r\n            <div className={`\r\n                absolute top-1/2 -translate-y-1/2\r\n                w-4 h-4 rounded-full bg-background border-4 border-primary shadow-[0_0_0_4px_rgba(59,130,246,0.1)]\r\n                z-20\r\n                \r\n                // Posicionamiento Mobile (Línea a la izquierda)\r\n                -left-6\r\n                \r\n                // Posicionamiento Desktop (Línea central)\r\n                lg:left-auto lg:right-auto\r\n                ${isLeft\r\n                    ? 'lg:-left-[calc(3rem+2px)]' // Ajuste fino para centrar en el gap de 12 (3rem)\r\n                    : 'lg:-right-[calc(3rem+2px)]'\r\n                }\r\n            `}>\r\n                <div className={`\r\n                    absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 \r\n                    w-2 h-2 rounded-full bg-primary\r\n                `} />\r\n            </div>\r\n\r\n            {/* Línea horizontal conectora (Solo Desktop) */}\r\n            <div className={`\r\n                hidden lg:block absolute top-1/2 -translate-y-1/2 h-0.5 bg-border/40 z-0\r\n                ${isLeft ? '-left-12 w-12' : '-right-12 w-12'}\r\n            `} />\r\n        </div>\r\n    );\r\n}\r\n\r\nexport function ImpactSectionTimeline() {\r\n    const { stats } = useImpactData();\r\n    const containerRef = useRef<HTMLElement>(null);\r\n    const { scrollYProgress } = useScroll({\r\n        target: containerRef,\r\n        offset: [\"start 20%\", \"end 80%\"]\r\n    });\r\n\r\n    const scaleY = useSpring(scrollYProgress, {\r\n        stiffness: 100,\r\n        damping: 30,\r\n        restDelta: 0.001\r\n    });\r\n\r\n    return (\r\n        <section\r\n            ref={containerRef}\r\n            className=\"relative py-20 lg:py-32 overflow-hidden bg-gradient-to-b from-slate-50 to-white dark:from-slate-950 dark:to-slate-900\"\r\n        >\r\n            {/* Background elements */}\r\n            <div className=\"absolute inset-0 bg-[linear-gradient(to_right,#80808012_1px,transparent_1px),linear-gradient(to_bottom,#80808012_1px,transparent_1px)] bg-[size:24px_24px] pointer-events-none\" />\r\n            <div className=\"absolute top-0 left-0 right-0 h-32 bg-gradient-to-b from-white dark:from-slate-950 to-transparent pointer-events-none\" />\r\n            <div className=\"absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-white dark:from-slate-950 to-transparent pointer-events-none\" />\r\n\r\n            <div className=\"container px-4 md:px-6 relative z-10\">\r\n                {/* Header */}\r\n                <div className=\"max-w-4xl mx-auto text-center mb-16 lg:mb-24\">\r\n                    <motion.div\r\n                        initial={{ opacity: 0, y: 20 }}\r\n                        whileInView={{ opacity: 1, y: 0 }}\r\n                        viewport={{ once: true }}\r\n                        className=\"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-primary/10 text-primary text-sm font-medium mb-6\"\r\n                    >\r\n                        <span className=\"w-2 h-2 rounded-full bg-primary animate-pulse\" />\r\n                        {IMPACT_SECTION_CONTENT.badge}\r\n                    </motion.div>\r\n\r\n                    <motion.h2\r\n                        initial={{ opacity: 0, y: 20 }}\r\n                        whileInView={{ opacity: 1, y: 0 }}\r\n                        viewport={{ once: true }}\r\n                        transition={{ delay: 0.1 }}\r\n                        className=\"text-3xl sm:text-4xl lg:text-5xl font-bold tracking-tight mb-6\"\r\n                    >\r\n                        <span className=\"block text-foreground\">{IMPACT_SECTION_CONTENT.title.line1}</span>\r\n                        <span className=\"block bg-gradient-to-r from-primary via-blue-600 to-secondary bg-clip-text text-transparent\">\r\n                            {IMPACT_SECTION_CONTENT.title.highlight}\r\n                        </span>\r\n                        <span className=\"block text-foreground\">{IMPACT_SECTION_CONTENT.title.line2}</span>\r\n                    </motion.h2>\r\n\r\n                    <motion.p\r\n                        initial={{ opacity: 0, y: 20 }}\r\n                        whileInView={{ opacity: 1, y: 0 }}\r\n                        viewport={{ once: true }}\r\n                        transition={{ delay: 0.2 }}\r\n                        className=\"text-lg sm:text-xl text-muted-foreground leading-relaxed\"\r\n                    >\r\n                        {IMPACT_SECTION_CONTENT.subtitle}\r\n                    </motion.p>\r\n                </div>\r\n\r\n                {/* Timeline Container */}\r\n                <div className=\"relative max-w-5xl mx-auto\">\r\n                    {/* Línea Central (Desktop) / Línea Lateral (Mobile) */}\r\n                    <div className=\"absolute top-0 bottom-0 \r\n                        left-[23px] lg:left-1/2 \r\n                        w-1 bg-border/30 \r\n                        -translate-x-1/2\r\n                        rounded-full\"\r\n                    >\r\n                        {/* Línea de progreso animada */}\r\n                        <motion.div\r\n                            className=\"absolute top-0 left-0 w-full bg-gradient-to-b from-primary via-blue-500 to-primary rounded-full origin-top shadow-[0_0_12px_2px_rgba(59,130,246,0.5)]\"\r\n                            style={{ scaleY, height: \"100%\" }}\r\n                        />\r\n                    </div>\r\n\r\n                    {/* Items */}\r\n                    <div className=\"space-y-12 lg:space-y-0 relative pl-12 lg:pl-0\">\r\n                        {stats.map((stat, index) => (\r\n                            <div key={stat.label} className=\"lg:min-h-[200px] flex flex-col justify-center\">\r\n                                <TimelineCard\r\n                                    stat={stat}\r\n                                    index={index}\r\n                                    isLeft={index % 2 !== 0} // Alternar lados en desktop: Primer item (0) a la derecha (isLeft=false porque 0%2===0 y queremos derecha primero? No, TimelineCard logic: isLeft ? reverse : normal. Si 0%2!=0 es false, entonces 0 es derecha.\r\n                                // 0 % 2 = 0 -> False -> Derecha (lg:mr-auto) -> Espera, queremos Zigzag.\r\n                                // TimelineCard logic:\r\n                                // className={`... ${isLeft ? 'lg:pr-12 lg:ml-auto lg:flex-row-reverse' : 'lg:pl-12 lg:mr-auto'}`}\r\n                                // Si isLeft es true -> ml-auto (DERECHA del contenedor, o sea lado derecho de la pantalla)\r\n                                // Si isLeft es false -> mr-auto (IZQUIERDA del contenedor, o sea lado izquierdo de la pantalla)\r\n                                // Queremos:\r\n                                // Index 0: Izquierda -> isLeft = false\r\n                                // Index 1: Derecha -> isLeft = true\r\n                                // Index 2: Izquierda -> isLeft = false\r\n                                // Por tanto:\r\n                                // index % 2 !== 0 \r\n                                // 0 % 2 = 0 -> false (Izquierda) // Correct\r\n                                // 1 % 2 = 1 -> true (Derecha) // Correct\r\n                                />\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Visión Footer */}\r\n                <motion.div\r\n                    initial={{ opacity: 0, y: 40 }}\r\n                    whileInView={{ opacity: 1, y: 0 }}\r\n                    viewport={{ once: true }}\r\n                    transition={{ delay: 0.4 }}\r\n                    className=\"mt-24 lg:mt-32 max-w-4xl mx-auto\"\r\n                >\r\n                    <div className=\"relative rounded-3xl p-8 sm:p-12 overflow-hidden bg-primary text-primary-foreground text-center\">\r\n                        <div className=\"absolute inset-0 bg-[linear-gradient(45deg,transparent_25%,rgba(255,255,255,0.1)_25%,rgba(255,255,255,0.1)_50%,transparent_50%,transparent_75%,rgba(255,255,255,0.1)_75%,rgba(255,255,255,0.1)_100%)] bg-[length:24px_24px] opacity-10\" />\r\n\r\n                        <div className=\"relative z-10\">\r\n                            <div className=\"text-primary-foreground/80 font-semibold tracking-wider uppercase text-sm mb-4\">\r\n                                {IMPACT_SECTION_CONTENT.vision.label}\r\n                            </div>\r\n                            <h3 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold mb-6\">\r\n                                {IMPACT_SECTION_CONTENT.vision.title}\r\n                            </h3>\r\n                            <p className=\"text-lg sm:text-xl text-primary-foreground/90 max-w-2xl mx-auto leading-relaxed\">\r\n                                {IMPACT_SECTION_CONTENT.vision.description}\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n                </motion.div>\r\n            </div>\r\n        </section>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\impact-section\\impact-section.data.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\impact-section\\impact-section.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\impact-section\\index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\impact-section\\useImpactData.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\infinite-specialties-scroll.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\medicos\\Benefits.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\medicos\\CTA.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\medicos\\FAQ.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\medicos\\Features.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\medicos\\Hero.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\medicos\\MedicosFinalCTA.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\medicos\\MedicosHeroSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\medicos\\MedicosHowItWorks.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\medicos\\PainPointsSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\medicos\\Pricing.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\medicos\\Process.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\medicos\\ProductShowcase.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\medicos\\Testimonials.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\medicos\\TrustSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\medicos\\ValueProposition.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\medicos\\medicos-hero\\DashboardPreview.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\medicos\\medicos-hero\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\medicos\\medicos-hero\\medicos-hero-data.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\medicos\\product-showcase\\ModulePreviews.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\medicos\\product-showcase\\ModuleSelector.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\medicos\\product-showcase\\PreviewPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\medicos\\product-showcase\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\medicos\\product-showcase\\modules-data.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Check' is defined but never used.","line":10,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":10}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport {\r\n    Calendar,\r\n    Users,\r\n    Video,\r\n    FileText,\r\n    FlaskConical,\r\n    BarChart3,\r\n    Check,\r\n} from \"lucide-react\";\r\nimport { LucideIcon } from \"lucide-react\";\r\n\r\n// Definición de tipos\r\nexport interface ModuleData {\r\n    id: string;\r\n    icon: LucideIcon;\r\n    name: string;\r\n    description: string;\r\n    color: string;\r\n    features: string[];\r\n}\r\n\r\n// Datos de módulos sin previews (los previews se renderizarán como componentes)\r\nexport const modulesData: ModuleData[] = [\r\n    {\r\n        id: \"agenda\",\r\n        icon: Calendar,\r\n        name: \"Agenda Inteligente\",\r\n        description: \"Gestiona citas con recordatorios automáticos\",\r\n        color: \"from-blue-500 to-blue-600\",\r\n        features: [\r\n            \"Calendario sincronizado en todos tus dispositivos\",\r\n            \"Recordatorios automáticos por SMS y WhatsApp\",\r\n            \"Bloqueo de horarios y días libres\",\r\n            \"Confirmación de citas online\",\r\n            \"Vista diaria, semanal y mensual\"\r\n        ],\r\n    },\r\n    {\r\n        id: \"pacientes\",\r\n        icon: Users,\r\n        name: \"Gestión de Pacientes\",\r\n        description: \"Historiales completos y seguimiento\",\r\n        color: \"from-emerald-500 to-emerald-600\",\r\n        features: [\r\n            \"Expediente clínico digital completo\",\r\n            \"Historial de consultas y tratamientos\",\r\n            \"Notas médicas privadas\",\r\n            \"Seguimiento automático de pacientes\",\r\n            \"Búsqueda y filtros avanzados\"\r\n        ],\r\n    },\r\n    {\r\n        id: \"telemedicina\",\r\n        icon: Video,\r\n        name: \"Telemedicina HD\",\r\n        description: \"Videoconsultas profesionales integradas\",\r\n        color: \"from-violet-500 to-violet-600\",\r\n        features: [\r\n            \"Video en alta definición\",\r\n            \"Sala de espera virtual\",\r\n            \"Compartir pantalla y documentos\",\r\n            \"Grabación opcional de consultas\",\r\n            \"Chat integrado durante la llamada\"\r\n        ],\r\n    },\r\n    {\r\n        id: \"recetas\",\r\n        icon: FileText,\r\n        name: \"Recetas Digitales\",\r\n        description: \"Firma electrónica válida en Venezuela\",\r\n        color: \"from-amber-500 to-orange-600\",\r\n        features: [\r\n            \"Firma electrónica certificada\",\r\n            \"Válida en 500+ farmacias\",\r\n            \"Envío automático al paciente\",\r\n            \"Historial de prescripciones\",\r\n            \"Base de datos de medicamentos\"\r\n        ],\r\n    },\r\n    {\r\n        id: \"laboratorio\",\r\n        icon: FlaskConical,\r\n        name: \"Órdenes de Laboratorio\",\r\n        description: \"Solicitudes digitales y resultados\",\r\n        color: \"from-cyan-500 to-teal-600\",\r\n        features: [\r\n            \"Órdenes digitales con código QR\",\r\n            \"Laboratorios afiliados a la red\",\r\n            \"Resultados automáticos en el historial\",\r\n            \"Notificación cuando estén listos\",\r\n            \"Histórico de estudios\"\r\n        ],\r\n    },\r\n    {\r\n        id: \"estadisticas\",\r\n        icon: BarChart3,\r\n        name: \"Estadísticas\",\r\n        description: \"Métricas y crecimiento de tu práctica\",\r\n        color: \"from-pink-500 to-rose-600\",\r\n        features: [\r\n            \"Dashboard de ingresos en tiempo real\",\r\n            \"Métricas de consultas y pacientes\",\r\n            \"Análisis de horarios más productivos\",\r\n            \"Comparativas mensuales\",\r\n            \"Exportación de reportes\"\r\n        ],\r\n    },\r\n];\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\pacientes-hero.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\pacientes\\Benefits.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\pacientes\\CTA.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\pacientes\\Features.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\pacientes\\Hero.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Image' is defined but never used.","line":7,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { motion } from 'framer-motion';\r\nimport { ArrowRight, CheckCircle2 } from 'lucide-react';\r\nimport { Button } from \"@red-salud/ui\";\r\nimport Link from 'next/link';\r\nimport Image from 'next/image';\r\n\r\nexport function Hero({ stats }: { stats?: { patients: number } }) {\r\n  const patientCount = stats?.patients || 0;\r\n  const hasEnoughData = patientCount > 50;\r\n  const displayCount = patientCount > 1000 \r\n    ? `${(patientCount / 1000).toFixed(1)}K+` \r\n    : patientCount.toString();\r\n\r\n  return (\r\n    <section className=\"relative min-h-[90vh] flex items-center overflow-hidden bg-slate-50 dark:bg-slate-950\">\r\n      {/* Background Elements */}\r\n      <div className=\"absolute inset-0 w-full h-full\">\r\n        <div className=\"absolute top-0 right-0 w-[500px] h-[500px] bg-blue-500/10 rounded-full blur-3xl\" />\r\n        <div className=\"absolute bottom-0 left-0 w-[500px] h-[500px] bg-teal-500/10 rounded-full blur-3xl\" />\r\n        <div className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[800px] h-[800px] bg-indigo-500/5 rounded-full blur-3xl\" />\r\n      </div>\r\n\r\n      <div className=\"container mx-auto px-4 sm:px-6 lg:px-8 relative z-10 pt-20\">\r\n        <div className=\"grid lg:grid-cols-2 gap-12 lg:gap-8 items-center\">\r\n          {/* Content Column */}\r\n          <motion.div \r\n            initial={{ opacity: 0, y: 20 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            transition={{ duration: 0.6 }}\r\n            className=\"space-y-8\"\r\n          >\r\n            {/* Badge */}\r\n            <motion.div \r\n              initial={{ opacity: 0, x: -20 }}\r\n              animate={{ opacity: 1, x: 0 }}\r\n              transition={{ delay: 0.2, duration: 0.5 }}\r\n              className=\"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/80 dark:bg-slate-900/80 backdrop-blur-sm border border-slate-200 dark:border-slate-800 shadow-sm\"\r\n            >\r\n              <span className=\"flex h-2 w-2 rounded-full bg-teal-500 animate-pulse\" />\r\n              <span className=\"text-sm font-medium text-slate-700 dark:text-slate-300\">\r\n                Salud Digital Reimaginada\r\n              </span>\r\n            </motion.div>\r\n\r\n            {/* Headline */}\r\n            <div className=\"space-y-4\">\r\n              <h1 className=\"text-4xl sm:text-5xl lg:text-6xl font-bold tracking-tight text-slate-900 dark:text-white leading-[1.1]\">\r\n                Tu Bienestar, <br />\r\n                <span className=\"text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-teal-500\">\r\n                  Sin Fronteras\r\n                </span>\r\n              </h1>\r\n              <p className=\"text-lg sm:text-xl text-slate-600 dark:text-slate-400 max-w-xl leading-relaxed\">\r\n                Accede a consultas médicas de primer nivel, gestiona tu historial y conecta con especialistas certificados. Todo desde la comodidad de tu hogar.\r\n                <span className=\"block mt-2 font-semibold text-teal-600 dark:text-teal-400\">100% Gratuito para pacientes.</span>\r\n              </p>\r\n            </div>\r\n\r\n            {/* CTAs */}\r\n            <div className=\"flex flex-col sm:flex-row gap-4\">\r\n              <Button \r\n                size=\"lg\" \r\n                asChild\r\n                className=\"bg-blue-600 hover:bg-blue-700 text-white rounded-full px-8 h-12 shadow-lg hover:shadow-blue-500/25 transition-all duration-300\"\r\n              >\r\n                <Link href=\"/auth/register?tipo=paciente\">\r\n                  Empezar Ahora\r\n                  <ArrowRight className=\"ml-2 h-4 w-4\" />\r\n                </Link>\r\n              </Button>\r\n            </div>\r\n\r\n            {/* Trust Indicators */}\r\n            <div className=\"pt-8 border-t border-slate-200 dark:border-slate-800\">\r\n              <p className=\"text-sm text-slate-500 mb-4\">\r\n                {hasEnoughData ? (\r\n                  <>Confían en nosotros más de <span className=\"font-bold text-slate-900 dark:text-white\">{displayCount}</span> pacientes</>\r\n                ) : (\r\n                  <span className=\"font-bold text-slate-900 dark:text-white\">Sé de los primeros en unirte y disfrutar los beneficios</span>\r\n                )}\r\n              </p>\r\n              <div className=\"flex flex-wrap gap-4 sm:gap-8\">\r\n                {['Atención 24/7', 'Médicos Certificados', 'Datos Seguros'].map((item, i) => (\r\n                  <div key={i} className=\"flex items-center gap-2 text-sm font-medium text-slate-700 dark:text-slate-300\">\r\n                    <CheckCircle2 className=\"h-4 w-4 text-teal-500\" />\r\n                    {item}\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          </motion.div>\r\n\r\n          {/* Visual Column */}\r\n          <motion.div \r\n            initial={{ opacity: 0, scale: 0.95 }}\r\n            animate={{ opacity: 1, scale: 1 }}\r\n            transition={{ delay: 0.3, duration: 0.8 }}\r\n            className=\"relative hidden lg:block\"\r\n          >\r\n            <div className=\"relative z-10 rounded-2xl overflow-hidden shadow-2xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 aspect-[4/3] group\">\r\n              {/* Abstract UI Representation */}\r\n              <div className=\"absolute inset-0 bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-slate-800\" />\r\n              \r\n              {/* Animated Floating Cards */}\r\n              <motion.div \r\n                animate={{ y: [0, -10, 0] }}\r\n                transition={{ repeat: Infinity, duration: 5, ease: \"easeInOut\" }}\r\n                className=\"absolute top-10 right-10 bg-white dark:bg-slate-800 p-4 rounded-xl shadow-lg border border-slate-100 dark:border-slate-700 max-w-[200px]\"\r\n              >\r\n                <div className=\"flex items-center gap-3 mb-2\">\r\n                  <div className=\"w-8 h-8 rounded-full bg-green-100 flex items-center justify-center text-green-600 text-xs font-bold\">Dr</div>\r\n                  <div className=\"h-2 w-20 bg-slate-200 dark:bg-slate-700 rounded\" />\r\n                </div>\r\n                <div className=\"h-2 w-full bg-slate-100 dark:bg-slate-800 rounded mb-1\" />\r\n                <div className=\"h-2 w-2/3 bg-slate-100 dark:bg-slate-800 rounded\" />\r\n              </motion.div>\r\n\r\n              <motion.div \r\n                animate={{ y: [0, 15, 0] }}\r\n                transition={{ repeat: Infinity, duration: 6, ease: \"easeInOut\", delay: 1 }}\r\n                className=\"absolute bottom-20 left-10 bg-white dark:bg-slate-800 p-4 rounded-xl shadow-lg border border-slate-100 dark:border-slate-700 max-w-[220px] z-20\"\r\n              >\r\n                <div className=\"flex items-center gap-3\">\r\n                  <div className=\"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600\">\r\n                    <CheckCircle2 className=\"h-6 w-6\" />\r\n                  </div>\r\n                  <div>\r\n                    <div className=\"text-sm font-semibold text-slate-900 dark:text-white\">Cita Confirmada</div>\r\n                    <div className=\"text-xs text-slate-500\">Hoy, 15:30 PM</div>\r\n                  </div>\r\n                </div>\r\n              </motion.div>\r\n\r\n              {/* Main Center Piece (Glassmorphism) */}\r\n              <div className=\"absolute inset-x-12 inset-y-24 bg-white/40 dark:bg-slate-900/40 backdrop-blur-md rounded-xl border border-white/20 shadow-xl flex items-center justify-center\">\r\n                 <div className=\"text-center p-6\">\r\n                    <div className=\"w-16 h-16 bg-gradient-to-tr from-blue-500 to-teal-500 rounded-2xl mx-auto mb-4 shadow-lg flex items-center justify-center\">\r\n                      <svg className=\"w-8 h-8 text-white\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z\" />\r\n                      </svg>\r\n                    </div>\r\n                    <h3 className=\"text-xl font-bold text-slate-800 dark:text-white mb-2\">Red Salud</h3>\r\n                    <p className=\"text-sm text-slate-600 dark:text-slate-300\">Conectando pacientes con los mejores especialistas.</p>\r\n                 </div>\r\n              </div>\r\n            </div>\r\n            \r\n            {/* Background Blob behind image */}\r\n            <div className=\"absolute -inset-4 bg-gradient-to-r from-blue-500 to-teal-500 rounded-2xl opacity-20 blur-2xl -z-10\" />\r\n          </motion.div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\pacientes\\PacientesFinalCTA.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\pacientes\\PacientesHeroSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\pacientes\\PacientesHowItWorks.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\pacientes\\PacientesPainPoints.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\pacientes\\PacientesProductShowcase.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\pacientes\\PacientesTrustSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\pacientes\\Process.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\pacientes\\Testimonials.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\specialties-dynamic.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\specialties-ticker.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'rowIndex' is defined but never used.","line":192,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":192,"endColumn":26},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\specialties-ticker.tsx:380:12\n  378 |           )}\n  379 |         >\n> 380 |           <Icon className=\"h-4 w-4\" />\n      |            ^^^^ This component is created during render\n  381 |         </div>\n  382 |\n  383 |         {/* Contenido */}\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\specialties-ticker.tsx:341:36\n  339 | function SpecialtyCard({ item, isHighlighted = false }: SpecialtyCardProps) {\n  340 |   // Memoizar el icono para evitar recrearlo en cada render\n> 341 |   const Icon = React.useMemo(() => getIconForSpecialty(item.name), [item.name]);\n      |                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ The component is created during render here\n  342 |   const isLocked = item.doctorCount === 0;\n  343 |\n  344 |   return (","line":380,"column":12,"nodeType":null,"endLine":380,"endColumn":16}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file specialties-ticker.tsx\r\n * @description Ticker de especialidades médicas para la página de inicio.\r\n * Muestra TODAS las especialidades en dos filas con scroll infinito.\r\n * Incluye buscador centrado arriba del ticker.\r\n *\r\n * @features\r\n * - Buscador centrado arriba del ticker\r\n * - Scroll infinito en dos filas (direcciones opuestas)\r\n * - Pausa automática de la fila al buscar\r\n * - Highlight visual de la especialidad encontrada\r\n */\r\n\r\n\"use client\";\r\n\r\nimport React, { useEffect, useState, useRef, useCallback } from \"react\";\r\nimport Link from \"next/link\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport {\r\n  Stethoscope,\r\n  Activity,\r\n  HeartPulse,\r\n  Brain,\r\n  Bone,\r\n  Eye,\r\n  Ear,\r\n  Baby,\r\n  Pill,\r\n  Syringe,\r\n  Heart,\r\n  Microscope,\r\n  Sparkles,\r\n} from \"lucide-react\";\r\nimport { cn, slugify } from \"@/lib/utils\";\r\nimport { motion } from \"framer-motion\";\r\nimport { SpecialtySearch } from \"./specialties/SpecialtySearch\";\r\n\r\nimport { MASTER_SPECIALTIES } from \"./specialties/master-list\";\r\n\r\ntype ApiResponse<T> = { success: boolean; data: T };\r\ntype Specialty = {\r\n  id: string;\r\n  name: string;\r\n  description?: string;\r\n  icon?: string;\r\n  doctorCount: number;\r\n};\r\n\r\n/**\r\n * Mapeo de iconos por nombre de especialidad o palabra clave.\r\n */\r\nconst iconMap: Record<string, React.ComponentType<{ className?: string }>> = {\r\n  Cardiología: HeartPulse,\r\n  Neurología: Brain,\r\n  \"Traumatología y Ortopedia\": Bone,\r\n  Oftalmología: Eye,\r\n  Otorrinolaringología: Ear,\r\n  Pediatría: Baby,\r\n  \"Medicina General\": Stethoscope,\r\n  \"Medicina Familiar\": Stethoscope,\r\n  Ginecología: Heart,\r\n  Dermatología: Microscope,\r\n  Psiquiatría: Brain,\r\n  default: Activity,\r\n};\r\n\r\n/**\r\n * Obtiene el icono apropiado para una especialidad.\r\n */\r\nfunction getIconForSpecialty(name: string): React.ComponentType<{ className?: string }> {\r\n  if (iconMap[name]) return iconMap[name];\r\n\r\n  const lower = name.toLowerCase();\r\n  if (lower.includes(\"cardio\")) return HeartPulse;\r\n  if (lower.includes(\"neuro\")) return Brain;\r\n  if (lower.includes(\"pediat\")) return Baby;\r\n  if (lower.includes(\"trauma\") || lower.includes(\"ortop\")) return Bone;\r\n  if (lower.includes(\"oftalmo\")) return Eye;\r\n  if (lower.includes(\"otorrino\")) return Ear;\r\n  if (lower.includes(\"gineco\") || lower.includes(\"obstet\")) return Heart;\r\n  if (lower.includes(\"dermato\")) return Microscope;\r\n  if (lower.includes(\"cirug\")) return Syringe;\r\n  if (lower.includes(\"medicina\")) return Stethoscope;\r\n  if (lower.includes(\"farmac\")) return Pill;\r\n\r\n  return Activity;\r\n}\r\n\r\n/**\r\n * Componente principal del ticker de especialidades.\r\n */\r\nexport function SpecialtiesTicker() {\r\n  const [items, setItems] = useState<Specialty[]>([]);\r\n  const [highlightedId, setHighlightedId] = useState<string | null>(null);\r\n  const [pausedRow, setPausedRow] = useState<1 | 2 | null>(null);\r\n\r\n  // Referencias a las filas para scroll programático\r\n  const row1Ref = useRef<HTMLDivElement>(null);\r\n  const row2Ref = useRef<HTMLDivElement>(null);\r\n\r\n  // Cargar especialidades al montar\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    async function load() {\r\n      // Inicializar con Master List (0 conteos)\r\n      const initialItems = MASTER_SPECIALTIES.map((s) => ({\r\n        ...s,\r\n        doctorCount: 0,\r\n      }));\r\n      if (mounted) setItems(initialItems);\r\n\r\n      try {\r\n        const res = await fetch(\"/api/public/doctor-specialties\", {\r\n          cache: \"no-store\",\r\n        });\r\n        if (res.ok) {\r\n          const json = (await res.json()) as ApiResponse<Specialty[]>;\r\n          if (mounted && json.success && Array.isArray(json.data)) {\r\n            // Crear mapa de especialidades de la DB\r\n            const dbMap = new Map<string, Specialty>();\r\n            json.data.forEach((s) => {\r\n              // Normalizar clave: minusculas, sin tildes, trim\r\n              const key = s.name\r\n                .toLowerCase()\r\n                .normalize(\"NFD\")\r\n                .replace(/[\\u0300-\\u036f]/g, \"\")\r\n                .trim();\r\n              dbMap.set(key, s);\r\n            });\r\n\r\n            // Procesar Master List: usar datos de DB si existen\r\n            const merged = MASTER_SPECIALTIES.map((ms) => {\r\n              const key = ms.name\r\n                .toLowerCase()\r\n                .normalize(\"NFD\")\r\n                .replace(/[\\u0300-\\u036f]/g, \"\")\r\n                .trim();\r\n\r\n              const dbItem = dbMap.get(key);\r\n\r\n              if (dbItem) {\r\n                dbMap.delete(key);\r\n                return {\r\n                  ...ms,\r\n                  id: dbItem.id,\r\n                  doctorCount: dbItem.doctorCount,\r\n                };\r\n              }\r\n              return { ...ms, doctorCount: 0 }; // Si no hay match, asumimos 0 doctores\r\n            });\r\n\r\n            // Agregar nuevas especialidades de la DB que no estaban en Master List\r\n            const newItems = Array.from(dbMap.values());\r\n            const final = [...merged, ...newItems];\r\n\r\n            setItems(final);\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error(\"[SpecialtiesTicker] Error syncing specialties:\", error);\r\n      }\r\n    }\r\n\r\n    load();\r\n    return () => {\r\n      mounted = false;\r\n    };\r\n  }, []);\r\n\r\n  /**\r\n   * Prepara el track para scroll infinito.\r\n   */\r\n  const prepareTrack = useCallback((arr: Specialty[]) => {\r\n    let filled = [...arr];\r\n    if (filled.length === 0) return [];\r\n\r\n    // Expandir a mínimo 20 items para pantallas anchas\r\n    while (filled.length < 20) {\r\n      filled = [...filled, ...arr];\r\n    }\r\n    // Duplicar para el loop -50%\r\n    return [...filled, ...filled];\r\n  }, []);\r\n\r\n  /**\r\n   * Maneja la selección desde el buscador.\r\n   */\r\n  /* Navegación directa al seleccionar */\r\n  const router = useRouter(); // Asegúrate de importar useRouter de next/navigation\r\n\r\n  const handleSearchSelect = useCallback(\r\n    (id: string, rowIndex: 1 | 2) => {\r\n      // Encontrar el item para obtener el slug\r\n      // Como optimization, podríamos pasar el nombre directo desde el Search,\r\n      // pero aquí buscamos en items por seguridad.\r\n      const item = items.find(i => i.id === id);\r\n      if (item) {\r\n        const slug = slugify(item.name);\r\n        router.push(`/especialidades/${slug}`);\r\n      }\r\n    },\r\n    [items, router]\r\n  );\r\n\r\n  /**\r\n   * Limpia el estado de búsqueda\r\n   */\r\n  const handleSearchClear = useCallback(() => {\r\n    setPausedRow(null);\r\n    setHighlightedId(null);\r\n  }, []);\r\n\r\n  if (items.length === 0) return null;\r\n\r\n  // Dividir items en dos filas\r\n  const mid = Math.ceil(items.length / 2);\r\n  const rawRow1 = items.slice(0, mid);\r\n  const rawRow2 = items.slice(mid);\r\n\r\n  const finalRow1 = prepareTrack(rawRow1);\r\n  const finalRow2 = prepareTrack(rawRow2);\r\n\r\n  return (\r\n    <section className=\"py-16 bg-gradient-to-b from-background via-muted/10 to-background border-y border-border/30 relative\">\r\n      {/* Textura de fondo */}\r\n      <div className=\"absolute inset-0 bg-[url('/noise.png')] opacity-[0.02] mix-blend-overlay pointer-events-none\" />\r\n\r\n      {/* Header con Buscador Centrado */}\r\n      <div className=\"container mx-auto px-4 mb-12 relative z-10\">\r\n        <div className=\"flex flex-col items-center text-center\">\r\n          {/* Badge */}\r\n          <div className=\"inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-primary/10 mb-4\">\r\n            <Sparkles className=\"w-4 h-4 text-primary\" />\r\n            <span className=\"text-xs font-bold uppercase tracking-widest text-primary\">\r\n              Directorio Médico Completo\r\n            </span>\r\n          </div>\r\n\r\n          {/* Título */}\r\n          <h3 className=\"text-3xl md:text-4xl font-black text-foreground mb-3\">\r\n            Explora Nuestras{\" \"}\r\n            <span className=\"text-transparent bg-clip-text bg-gradient-to-r from-primary via-blue-500 to-primary\">\r\n              Especialidades\r\n            </span>\r\n          </h3>\r\n\r\n          <p className=\"text-muted-foreground text-base max-w-lg mx-auto mb-8\">\r\n            Más de {items.length} especialidades médicas disponibles. Encuentra\r\n            el especialista que necesitas.\r\n          </p>\r\n\r\n          {/* Buscador Centrado */}\r\n          <SpecialtySearch\r\n            items={items}\r\n            row1Items={rawRow1}\r\n            row2Items={rawRow2}\r\n            onSelect={handleSearchSelect}\r\n            onClear={handleSearchClear}\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      {/* Ticker Container */}\r\n      <div className=\"relative w-full overflow-hidden flex flex-col gap-6 py-4\">\r\n        {/* Gradientes laterales */}\r\n        <div className=\"absolute left-0 top-0 bottom-0 w-24 sm:w-40 bg-gradient-to-r from-background via-background/90 to-transparent z-20 pointer-events-none\" />\r\n        <div className=\"absolute right-0 top-0 bottom-0 w-24 sm:w-40 bg-gradient-to-l from-background via-background/90 to-transparent z-20 pointer-events-none\" />\r\n\r\n        {/* Fila 1 */}\r\n        {finalRow1.length > 0 && (\r\n          <div\r\n            ref={row1Ref}\r\n            className={cn(\r\n              \"flex w-max\",\r\n              pausedRow === 1\r\n                ? \"\"\r\n                : \"animate-scroll hover:[animation-play-state:paused]\"\r\n            )}\r\n            style={{\r\n              animationDuration: \"280s\",\r\n              animationPlayState: pausedRow === 1 ? \"paused\" : undefined,\r\n            }}\r\n          >\r\n            <div className=\"flex gap-4 px-2\">\r\n              {finalRow1.map((item, index) => (\r\n                <SpecialtyCard\r\n                  key={`r1-${item.id}-${index}`}\r\n                  item={item}\r\n                  isHighlighted={highlightedId === item.id}\r\n                />\r\n              ))}\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Fila 2 (reversa) */}\r\n        {finalRow2.length > 0 && (\r\n          <div\r\n            ref={row2Ref}\r\n            className={cn(\r\n              \"flex w-max\",\r\n              pausedRow === 2\r\n                ? \"\"\r\n                : \"animate-scroll hover:[animation-play-state:paused]\"\r\n            )}\r\n            style={{\r\n              animationDirection: \"reverse\",\r\n              animationDuration: \"300s\",\r\n              animationPlayState: pausedRow === 2 ? \"paused\" : undefined,\r\n            }}\r\n          >\r\n            <div className=\"flex gap-4 px-2\">\r\n              {finalRow2.map((item, index) => (\r\n                <SpecialtyCard\r\n                  key={`r2-${item.id}-${index}`}\r\n                  item={item}\r\n                  isHighlighted={highlightedId === item.id}\r\n                />\r\n              ))}\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </section>\r\n  );\r\n}\r\n\r\n/**\r\n * Props del componente de tarjeta de especialidad.\r\n */\r\ninterface SpecialtyCardProps {\r\n  item: Specialty;\r\n  isHighlighted?: boolean;\r\n}\r\n\r\n/**\r\n * Tarjeta individual de especialidad.\r\n */\r\nfunction SpecialtyCard({ item, isHighlighted = false }: SpecialtyCardProps) {\r\n  // Memoizar el icono para evitar recrearlo en cada render\r\n  const Icon = React.useMemo(() => getIconForSpecialty(item.name), [item.name]);\r\n  const isLocked = item.doctorCount === 0;\r\n\r\n  return (\r\n    <Link href={`/especialidades/${slugify(item.name)}`} className=\"block\">\r\n      <motion.div\r\n        data-specialty-id={item.id}\r\n        animate={\r\n          isHighlighted\r\n            ? {\r\n              scale: 1.08,\r\n              boxShadow: \"0 0 25px rgba(59, 130, 246, 0.4)\",\r\n            }\r\n            : {}\r\n        }\r\n        transition={{ duration: 0.3 }}\r\n        className={cn(\r\n          \"group/card relative flex items-center gap-3 pl-3 pr-5 py-3 rounded-2xl border transition-all duration-300 min-w-[200px]\",\r\n          \"bg-white/70 dark:bg-slate-900/70 backdrop-blur-sm\",\r\n          \"hover:bg-white dark:hover:bg-slate-800 hover:shadow-lg hover:shadow-primary/10\",\r\n          \"hover:scale-[1.03] hover:z-30 hover:-translate-y-1\",\r\n          isHighlighted\r\n            ? \"ring-2 ring-primary ring-offset-2 bg-white dark:bg-slate-800 scale-[1.03] z-30 -translate-y-1\"\r\n            : \"\",\r\n          isLocked\r\n            ? \"border-dashed border-border/40 opacity-60 grayscale hover:opacity-100 hover:grayscale-0 hover:border-primary/50\"\r\n            : \"border-white/20 dark:border-white/5 hover:border-primary/30\"\r\n        )}\r\n      >\r\n        {/* Icono */}\r\n        <div\r\n          className={cn(\r\n            \"h-9 w-9 rounded-xl flex items-center justify-center transition-all duration-300 shadow-sm flex-shrink-0\",\r\n            isLocked\r\n              ? \"bg-muted text-muted-foreground\"\r\n              : \"bg-gradient-to-br from-primary/10 to-blue-500/10 text-primary group-hover/card:from-primary group-hover/card:to-blue-600 group-hover/card:text-white\",\r\n            isHighlighted && \"from-primary to-blue-600 text-white\"\r\n          )}\r\n        >\r\n          <Icon className=\"h-4 w-4\" />\r\n        </div>\r\n\r\n        {/* Contenido */}\r\n        <div className=\"flex flex-col min-w-0\">\r\n          <span\r\n            className={cn(\r\n              \"text-sm font-bold leading-tight transition-colors truncate\",\r\n              isLocked\r\n                ? \"text-muted-foreground\"\r\n                : \"text-foreground group-hover/card:text-primary\",\r\n              isHighlighted && \"text-primary\"\r\n            )}\r\n          >\r\n            {item.name}\r\n          </span>\r\n          <span className=\"text-[10px] font-medium text-muted-foreground\">\r\n            {isLocked ? \"Próximamente\" : `${item.doctorCount} especialistas`}\r\n          </span>\r\n        </div>\r\n\r\n        {/* Badge de highlight */}\r\n        {isHighlighted && (\r\n          <motion.div\r\n            initial={{ opacity: 0, scale: 0 }}\r\n            animate={{ opacity: 1, scale: 1 }}\r\n            className=\"absolute -top-2 -right-2 w-5 h-5 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-[10px] font-bold shadow-lg\"\r\n          >\r\n            ✓\r\n          </motion.div>\r\n        )}\r\n      </motion.div>\r\n    </Link>\r\n  );\r\n}\r\n\r\nexport default SpecialtiesTicker;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\specialties\\RelatedSpecialties.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'currentSpecialty' is defined but never used.","line":32,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file RelatedSpecialties.tsx\r\n * @description Sección de especialidades relacionadas para navegación cruzada.\r\n * Muestra links a otras especialidades que pueden ser de interés.\r\n *\r\n * @example\r\n * <RelatedSpecialties relatedSlugs={['neurologia', 'medicina-interna']} />\r\n */\r\n\r\n\"use client\";\r\n\r\nimport React from \"react\";\r\nimport Link from \"next/link\";\r\nimport { motion } from \"framer-motion\";\r\nimport { ArrowRight, Layers } from \"lucide-react\";\r\nimport { cn, slugify } from \"@/lib/utils\";\r\nimport { MASTER_SPECIALTIES } from \"./master-list\";\r\n\r\ninterface RelatedSpecialtiesProps {\r\n    /** Slugs de las especialidades relacionadas */\r\n    relatedSlugs: string[];\r\n    /** Nombre de la especialidad actual (para excluirla) */\r\n    currentSpecialty?: string;\r\n}\r\n\r\n/**\r\n * Componente que muestra especialidades relacionadas para navegación.\r\n * Facilita el descubrimiento de otras áreas médicas relevantes.\r\n */\r\nexport function RelatedSpecialties({\r\n    relatedSlugs,\r\n    currentSpecialty,\r\n}: RelatedSpecialtiesProps) {\r\n    if (!relatedSlugs || relatedSlugs.length === 0) return null;\r\n\r\n    // Buscar los nombres de las especialidades relacionadas\r\n    const relatedItems = relatedSlugs\r\n        .map((slug) => {\r\n            const found = MASTER_SPECIALTIES.find(\r\n                (s) => slugify(s.name) === slug || s.id === slug\r\n            );\r\n            return found ? { ...found, slug: slugify(found.name) } : null;\r\n        })\r\n        .filter(Boolean) as { id: string; name: string; slug: string }[];\r\n\r\n    if (relatedItems.length === 0) return null;\r\n\r\n    return (\r\n        <section className=\"py-12 bg-muted/20 border-t border-border/50\">\r\n            <div className=\"container mx-auto px-4\">\r\n                <div className=\"max-w-4xl mx-auto\">\r\n                    {/* Header */}\r\n                    <div className=\"flex items-center gap-3 mb-6\">\r\n                        <div className=\"w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center text-white\">\r\n                            <Layers className=\"w-5 h-5\" />\r\n                        </div>\r\n                        <div>\r\n                            <h3 className=\"font-bold text-foreground\">\r\n                                Especialidades Relacionadas\r\n                            </h3>\r\n                            <p className=\"text-sm text-muted-foreground\">\r\n                                Otras áreas médicas que podrían interesarte\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Grid de especialidades relacionadas */}\r\n                    <div className=\"grid sm:grid-cols-2 md:grid-cols-3 gap-3\">\r\n                        {relatedItems.map((item, index) => (\r\n                            <motion.div\r\n                                key={item.id}\r\n                                initial={{ opacity: 0, y: 10 }}\r\n                                whileInView={{ opacity: 1, y: 0 }}\r\n                                viewport={{ once: true }}\r\n                                transition={{ delay: index * 0.1 }}\r\n                            >\r\n                                <Link\r\n                                    href={`/especialidades/${item.slug}`}\r\n                                    className={cn(\r\n                                        \"group flex items-center justify-between p-4 rounded-xl\",\r\n                                        \"bg-white dark:bg-slate-900\",\r\n                                        \"border border-border/50 hover:border-primary/40\",\r\n                                        \"hover:shadow-md transition-all duration-300\"\r\n                                    )}\r\n                                >\r\n                                    <span className=\"font-medium text-foreground group-hover:text-primary transition-colors\">\r\n                                        {item.name}\r\n                                    </span>\r\n                                    <ArrowRight className=\"w-4 h-4 text-muted-foreground group-hover:text-primary group-hover:translate-x-1 transition-all\" />\r\n                                </Link>\r\n                            </motion.div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </section>\r\n    );\r\n}\r\n\r\nexport default RelatedSpecialties;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\specialties\\SpecialtyFAQ.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\specialties\\SpecialtyPreparation.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\specialties\\SpecialtySearch.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Link' is defined but never used.","line":16,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'slugify' is defined but never used.","line":17,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'row2Items' is defined but never used.","line":38,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":14},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\specialties\\SpecialtySearch.tsx:75:13\n  73 |     useEffect(() => {\n  74 |         if (!query.trim()) {\n> 75 |             setResults([]);\n     |             ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  76 |             setSelectedIndex(0);\n  77 |             setGhostText(\"\");\n  78 |             return;","line":75,"column":13,"nodeType":null,"endLine":75,"endColumn":23}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file SpecialtySearch.tsx\r\n * @description Componente de búsqueda de especialidades médicas inline.\r\n * Características:\r\n * - Autocompletado Ghost Text\r\n * - Límite visual de 4 sugerencias\r\n * - Navegación por teclado con auto-scroll\r\n */\r\n\r\n\"use client\";\r\n\r\nimport React, { useState, useRef, useEffect, useCallback } from \"react\";\r\nimport { Search, X, ArrowRight, Activity, ChevronRight, Stethoscope } from \"lucide-react\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport Link from \"next/link\";\r\nimport { slugify } from \"@/lib/utils\";\r\n\r\ninterface Specialty {\r\n    id: string;\r\n    name: string;\r\n    doctorCount: number;\r\n}\r\n\r\ninterface SpecialtySearchProps {\r\n    items: Specialty[];\r\n    onSelect: (id: string, rowIndex: 1 | 2) => void;\r\n    onClear: () => void;\r\n    row1Items: Specialty[];\r\n    row2Items: Specialty[];\r\n}\r\n\r\nexport function SpecialtySearch({\r\n    items,\r\n    onSelect,\r\n    onClear,\r\n    row1Items,\r\n    row2Items,\r\n}: SpecialtySearchProps) {\r\n    const [isExpanded, setIsExpanded] = useState(false);\r\n    const [query, setQuery] = useState(\"\");\r\n    const [results, setResults] = useState<Specialty[]>([]);\r\n    const [selectedIndex, setSelectedIndex] = useState(0);\r\n    const [ghostText, setGhostText] = useState(\"\");\r\n\r\n    const containerRef = useRef<HTMLDivElement>(null);\r\n    const inputRef = useRef<HTMLInputElement>(null);\r\n    const listRef = useRef<HTMLUListElement>(null);\r\n\r\n    const handleCollapse = useCallback(() => {\r\n        setIsExpanded(false);\r\n        setQuery(\"\");\r\n        setResults([]);\r\n        setGhostText(\"\");\r\n        onClear();\r\n    }, [onClear]);\r\n\r\n    // Cerrar al hacer clic fuera\r\n    useEffect(() => {\r\n        const handleClickOutside = (event: MouseEvent) => {\r\n            if (\r\n                containerRef.current &&\r\n                !containerRef.current.contains(event.target as Node)\r\n            ) {\r\n                handleCollapse();\r\n            }\r\n        };\r\n        document.addEventListener(\"mousedown\", handleClickOutside);\r\n        return () => document.removeEventListener(\"mousedown\", handleClickOutside);\r\n    }, [handleCollapse]);\r\n\r\n    // Filtrar resultados y generar Ghost Text\r\n    useEffect(() => {\r\n        if (!query.trim()) {\r\n            setResults([]);\r\n            setSelectedIndex(0);\r\n            setGhostText(\"\");\r\n            return;\r\n        }\r\n\r\n        const normalizedQuery = query.toLowerCase().normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\");\r\n\r\n        // Algoritmo de búsqueda\r\n        // Algoritmo de búsqueda mejorado: Inicio de palabra\r\n        const filtered = items\r\n            .filter((item) => {\r\n                const normalizedName = item.name.toLowerCase().normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\");\r\n                // Dividir en palabras y ver si alguna empieza con el query\r\n                const words = normalizedName.split(\" \");\r\n                // O checkear si el string completo empieza con el query (para mayor precisión)\r\n                return words.some(word => word.startsWith(normalizedQuery));\r\n            })\r\n            .sort((a, b) => {\r\n                const aName = a.name.toLowerCase().normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\");\r\n                const bName = b.name.toLowerCase().normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\");\r\n\r\n                const aStarts = aName.startsWith(normalizedQuery);\r\n                const bStarts = bName.startsWith(normalizedQuery);\r\n\r\n                if (aStarts && !bStarts) return -1;\r\n                if (!aStarts && bStarts) return 1;\r\n                return a.name.localeCompare(b.name);\r\n            });\r\n\r\n        setResults(filtered);\r\n        setSelectedIndex(0);\r\n\r\n        // Calcular Ghost Text\r\n        if (filtered.length > 0) {\r\n            const topMatch = filtered[0].name;\r\n            const normalizedTop = topMatch.toLowerCase().normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\");\r\n\r\n            if (normalizedTop.startsWith(normalizedQuery)) {\r\n                const matchSuffix = topMatch.slice(query.length);\r\n                setGhostText(query + matchSuffix);\r\n            } else {\r\n                setGhostText(\"\");\r\n            }\r\n        } else {\r\n            setGhostText(\"\");\r\n        }\r\n    }, [query, items]);\r\n\r\n    // Scroll automático al item seleccionado\r\n    useEffect(() => {\r\n        if (results.length > 0 && listRef.current) {\r\n            // Encontrar el elemento activo por su atributo data-index\r\n            const activeItem = listRef.current.querySelector(`[data-index=\"${selectedIndex}\"]`);\r\n            if (activeItem) {\r\n                activeItem.scrollIntoView({\r\n                    block: \"nearest\",\r\n                    behavior: \"smooth\"\r\n                });\r\n            }\r\n        }\r\n    }, [selectedIndex, results]);\r\n\r\n    // Focus input al expandir\r\n    useEffect(() => {\r\n        if (isExpanded && inputRef.current) {\r\n            setTimeout(() => inputRef.current?.focus(), 150);\r\n        }\r\n    }, [isExpanded]);\r\n\r\n    const getRowIndex = useCallback(\r\n        (id: string): 1 | 2 => {\r\n            return row1Items.some((item) => item.id === id) ? 1 : 2;\r\n        },\r\n        [row1Items]\r\n    );\r\n\r\n    const handleSelectItem = (item: Specialty) => {\r\n        const rowIndex = getRowIndex(item.id);\r\n        onSelect(item.id, rowIndex);\r\n        setIsExpanded(false);\r\n        setQuery(\"\");\r\n        setGhostText(\"\");\r\n    };\r\n\r\n    const handleKeyDown = (e: React.KeyboardEvent) => {\r\n        if (e.key === \"Escape\") handleCollapse();\r\n\r\n        // Autocompletar con Tab o Flecha Derecha\r\n        if ((e.key === \"Tab\" || e.key === \"ArrowRight\") && ghostText) {\r\n            if (inputRef.current && inputRef.current.selectionStart === query.length) {\r\n                e.preventDefault();\r\n                setQuery(ghostText);\r\n                return;\r\n            }\r\n        }\r\n\r\n        if (!results.length) return;\r\n\r\n        if (e.key === \"ArrowDown\") {\r\n            e.preventDefault();\r\n            setSelectedIndex((prev) => Math.min(prev + 1, results.length - 1));\r\n        } else if (e.key === \"ArrowUp\") {\r\n            e.preventDefault();\r\n            setSelectedIndex((prev) => Math.max(prev - 1, 0));\r\n        } else if (e.key === \"Enter\") {\r\n            e.preventDefault();\r\n            handleSelectItem(results[selectedIndex]);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div ref={containerRef} className=\"relative z-50 flex justify-center w-full h-[60px] px-4 md:px-0\">\r\n            <motion.div\r\n                layout\r\n                initial={false}\r\n                animate={{\r\n                    width: isExpanded ? \"100%\" : \"auto\",\r\n                    maxWidth: isExpanded ? \"600px\" : \"280px\",\r\n                }}\r\n                transition={{ type: \"spring\", stiffness: 300, damping: 25 }}\r\n                className={cn(\r\n                    \"relative flex items-center overflow-visible shadow-xl\",\r\n                    isExpanded\r\n                        ? \"bg-white dark:bg-slate-900 ring-2 ring-primary/20 rounded-2xl\"\r\n                        : \"cursor-pointer bg-white/80 dark:bg-slate-900/80 backdrop-blur-xl hover:scale-[1.02] rounded-2xl border border-white/20 dark:border-white/10\"\r\n                )}\r\n                onClick={() => !isExpanded && setIsExpanded(true)}\r\n            >\r\n                <AnimatePresence mode=\"wait\">\r\n                    {!isExpanded ? (\r\n                        /* BOTÓN COLAPSADO */\r\n                        <motion.div\r\n                            key=\"button\"\r\n                            initial={{ opacity: 0 }}\r\n                            animate={{ opacity: 1 }}\r\n                            exit={{ opacity: 0 }}\r\n                            className=\"flex items-center gap-3 px-6 py-3.5 w-full\"\r\n                        >\r\n                            <div className=\"w-10 h-10 rounded-xl bg-gradient-to-br from-primary to-blue-600 flex items-center justify-center text-white shadow-lg shadow-primary/25 flex-shrink-0\">\r\n                                <Search className=\"w-5 h-5\" />\r\n                            </div>\r\n                            <div className=\"flex-1 text-left min-w-[160px] hidden xs:block\">\r\n                                <span className=\"block text-sm font-bold text-foreground\">\r\n                                    Buscar Especialidad\r\n                                </span>\r\n                                <span className=\"block text-xs text-muted-foreground\">\r\n                                    Encuentra tu especialista\r\n                                </span>\r\n                            </div>\r\n                            <span className=\"block xs:hidden text-sm font-bold text-foreground\">Buscar</span>\r\n                            <ArrowRight className=\"w-4 h-4 text-muted-foreground ml-auto\" />\r\n                        </motion.div>\r\n                    ) : (\r\n                        /* INPUT EXPANDIDO */\r\n                        <motion.div\r\n                            key=\"input\"\r\n                            initial={{ opacity: 0 }}\r\n                            animate={{ opacity: 1 }}\r\n                            exit={{ opacity: 0 }}\r\n                            className=\"px-4 w-full flex items-center h-[60px] relative\"\r\n                        >\r\n                            <Search className=\"w-5 h-5 text-primary mr-3 flex-shrink-0 z-10\" />\r\n\r\n                            <div className=\"flex-1 relative h-full flex items-center\">\r\n                                {/* GHOST TEXT OVERLAY */}\r\n                                {ghostText && query && ghostText.toLowerCase().startsWith(query.toLowerCase()) && (\r\n                                    <div className=\"absolute inset-0 flex items-center pointer-events-none select-none text-lg font-sans overflow-hidden whitespace-pre\">\r\n                                        <span className=\"opacity-0\">{query}</span>\r\n                                        <span className=\"text-muted-foreground/40\">{ghostText.slice(query.length)}</span>\r\n                                    </div>\r\n                                )}\r\n\r\n                                <input\r\n                                    ref={inputRef}\r\n                                    value={query}\r\n                                    onChange={(e) => setQuery(e.target.value)}\r\n                                    onKeyDown={handleKeyDown}\r\n                                    placeholder=\"Escribe una especialidad...\"\r\n                                    className=\"w-full bg-transparent border-none outline-none text-lg text-foreground placeholder:text-muted-foreground/50 h-full relative z-10 font-sans\"\r\n                                    autoComplete=\"off\"\r\n                                    spellCheck={false}\r\n                                    autoCapitalize=\"off\"\r\n                                />\r\n                            </div>\r\n\r\n                            {query ? (\r\n                                <button\r\n                                    onClick={(e) => {\r\n                                        e.stopPropagation();\r\n                                        setQuery(\"\");\r\n                                        setGhostText(\"\");\r\n                                        inputRef.current?.focus();\r\n                                    }}\r\n                                    className=\"p-1 rounded-full hover:bg-muted text-muted-foreground hover:text-foreground transition-colors mr-2 z-10\"\r\n                                >\r\n                                    <X className=\"w-4 h-4\" />\r\n                                </button>\r\n                            ) : null}\r\n                            <button\r\n                                onClick={(e) => {\r\n                                    e.stopPropagation();\r\n                                    handleCollapse();\r\n                                }}\r\n                                className=\"p-2 rounded-xl hover:bg-muted text-sm font-medium text-muted-foreground transition-colors z-10\"\r\n                            >\r\n                                Cancelar\r\n                            </button>\r\n                        </motion.div>\r\n                    )}\r\n                </AnimatePresence>\r\n\r\n                {/* DROPDOWN DE RESULTADOS */}\r\n                <AnimatePresence>\r\n                    {isExpanded && (query || results.length > 0) && (\r\n                        <motion.div\r\n                            initial={{ opacity: 0, y: -10, scale: 0.98 }}\r\n                            animate={{ opacity: 1, y: 0, scale: 1 }}\r\n                            exit={{ opacity: 0, y: -10, scale: 0.98 }}\r\n                            transition={{ duration: 0.15 }}\r\n                            // Altura limitada para mostrar ~4 items (60px * 4 = 240px)\r\n                            className=\"absolute top-[calc(100%+8px)] left-0 right-0 bg-white dark:bg-slate-900 rounded-2xl shadow-2xl border border-border/50 overflow-hidden z-50 flex flex-col max-h-[260px]\"\r\n                        >\r\n                            <div className=\"flex-1 overflow-y-auto custom-scrollbar\">\r\n                                {results.length > 0 ? (\r\n                                    <ul ref={listRef} className=\"py-2\">\r\n                                        <li className=\"px-4 py-2 text-xs font-semibold text-muted-foreground bg-muted/30 flex justify-between sticky top-0 backdrop-blur-sm z-10\">\r\n                                            <span>Sugerencias</span>\r\n                                            {ghostText && (\r\n                                                <span className=\"hidden sm:inline-block opacity-70\">\r\n                                                    Tab ↹ autocompletar\r\n                                                </span>\r\n                                            )}\r\n                                        </li>\r\n                                        {results.map((item, index) => (\r\n                                            <li key={item.id} data-index={index}>\r\n                                                <button\r\n                                                    onClick={() => handleSelectItem(item)}\r\n                                                    onMouseEnter={() => setSelectedIndex(index)}\r\n                                                    className={cn(\r\n                                                        \"w-full text-left px-4 py-3 flex items-center justify-between transition-colors border-b border-border/30 last:border-0\",\r\n                                                        selectedIndex === index ? \"bg-primary/5 text-primary\" : \"hover:bg-muted/50 text-foreground\"\r\n                                                    )}\r\n                                                >\r\n                                                    <div className=\"flex items-center gap-3 truncate\">\r\n                                                        <div className={cn(\r\n                                                            \"w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0\",\r\n                                                            selectedIndex === index ? \"bg-primary/10\" : \"bg-muted\"\r\n                                                        )}>\r\n                                                            <Stethoscope className={cn(\"w-4 h-4\", selectedIndex === index ? \"text-primary\" : \"text-muted-foreground\")} />\r\n                                                        </div>\r\n                                                        <div className=\"truncate\">\r\n                                                            <span className=\"font-medium block leading-tight truncate\">{item.name}</span>\r\n                                                            <span className=\"text-xs text-muted-foreground/80\">\r\n                                                                {item.doctorCount > 0 ? `${item.doctorCount} doctores` : \"Consultar\"}\r\n                                                            </span>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                    {selectedIndex === index && (\r\n                                                        <ChevronRight className=\"w-4 h-4 opacity-50 flex-shrink-0 ml-2\" />\r\n                                                    )}\r\n                                                </button>\r\n                                            </li>\r\n                                        ))}\r\n                                    </ul>\r\n                                ) : query ? (\r\n                                    <div className=\"p-8 text-center text-muted-foreground flex flex-col items-center justify-center h-48\">\r\n                                        <Search className=\"w-8 h-8 mb-3 opacity-20\" />\r\n                                        <p>No hay resultados de &ldquo;{query}&rdquo;</p>\r\n                                    </div>\r\n                                ) : (\r\n                                    <div className=\"p-4\">\r\n                                        <p className=\"text-xs font-semibold text-muted-foreground mb-3 uppercase tracking-wider\">Populares</p>\r\n                                        <div className=\"grid grid-cols-2 gap-2\">\r\n                                            {[\"Cardiología\", \"Pediatría\", \"Dermatología\", \"Ginecología\"].map(s => (\r\n                                                <button\r\n                                                    key={s}\r\n                                                    onClick={() => setQuery(s)}\r\n                                                    className=\"px-3 py-2 rounded-lg bg-muted/40 hover:bg-primary/10 hover:text-primary text-sm font-medium transition-colors text-left flex items-center gap-2\"\r\n                                                >\r\n                                                    <Activity className=\"w-3 h-3 opacity-50\" />\r\n                                                    {s}\r\n                                                </button>\r\n                                            ))}\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </motion.div>\r\n                    )}\r\n                </AnimatePresence>\r\n            </motion.div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\specialties\\SpecialtyTreatments.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\specialties\\map\\MapControls.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Info' is defined but never used.","line":1,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":41}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { RotateCw, ZoomIn, ZoomOut, Info } from \"lucide-react\";\r\nimport { Button } from \"@red-salud/ui\";\r\nimport {\r\n    Tooltip,\r\n    TooltipContent,\r\n    TooltipProvider,\r\n    TooltipTrigger,\r\n} from \"@red-salud/ui\";\r\n\r\nexport interface MapControlsProps {\r\n    onReset: () => void;\r\n    onZoomIn?: () => void;\r\n    onZoomOut?: () => void;\r\n    showZoom?: boolean;\r\n}\r\n\r\nexport function MapControls({ onReset, onZoomIn, onZoomOut, showZoom = false }: MapControlsProps) {\r\n    return (\r\n        <div className=\"absolute top-4 right-4 z-10 flex flex-col gap-2\">\r\n            <TooltipProvider>\r\n                <Tooltip>\r\n                    <TooltipTrigger asChild>\r\n                        <Button\r\n                            variant=\"secondary\"\r\n                            size=\"icon\"\r\n                            className=\"bg-white/10 backdrop-blur-md border border-white/20 hover:bg-white/20 text-white\"\r\n                            onClick={onReset}\r\n                        >\r\n                            <RotateCw className=\"h-4 w-4\" />\r\n                        </Button>\r\n                    </TooltipTrigger>\r\n                    <TooltipContent side=\"left\">\r\n                        <p>Restablecer vista</p>\r\n                    </TooltipContent>\r\n                </Tooltip>\r\n\r\n                {showZoom && (\r\n                    <>\r\n                        <Tooltip>\r\n                            <TooltipTrigger asChild>\r\n                                <Button\r\n                                    variant=\"secondary\"\r\n                                    size=\"icon\"\r\n                                    className=\"bg-white/10 backdrop-blur-md border border-white/20 hover:bg-white/20 text-white\"\r\n                                    onClick={onZoomIn}\r\n                                >\r\n                                    <ZoomIn className=\"h-4 w-4\" />\r\n                                </Button>\r\n                            </TooltipTrigger>\r\n                            <TooltipContent side=\"left\">\r\n                                <p>Acercar</p>\r\n                            </TooltipContent>\r\n                        </Tooltip>\r\n\r\n                        <Tooltip>\r\n                            <TooltipTrigger asChild>\r\n                                <Button\r\n                                    variant=\"secondary\"\r\n                                    size=\"icon\"\r\n                                    className=\"bg-white/10 backdrop-blur-md border border-white/20 hover:bg-white/20 text-white\"\r\n                                    onClick={onZoomOut}\r\n                                >\r\n                                    <ZoomOut className=\"h-4 w-4\" />\r\n                                </Button>\r\n                            </TooltipTrigger>\r\n                            <TooltipContent side=\"left\">\r\n                                <p>Alejar</p>\r\n                            </TooltipContent>\r\n                        </Tooltip>\r\n                    </>\r\n                )}\r\n            </TooltipProvider>\r\n\r\n            <div className=\"bg-white/10 backdrop-blur-md border border-white/20 p-2 rounded-lg mt-4\">\r\n                <p className=\"text-[10px] text-white/50 mb-1 font-medium uppercase tracking-wider\">Densidad</p>\r\n                <div className=\"flex flex-col gap-1\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <div className=\"w-3 h-3 rounded-full bg-emerald-500\"></div>\r\n                        <span className=\"text-[10px] text-white/70\">Alta</span>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <div className=\"w-3 h-3 rounded-full bg-amber-500\"></div>\r\n                        <span className=\"text-[10px] text-white/70\">Media</span>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <div className=\"w-3 h-3 rounded-full bg-blue-500\"></div>\r\n                        <span className=\"text-[10px] text-white/70\">Baja</span>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <div className=\"w-3 h-3 rounded-full bg-slate-500\"></div>\r\n                        <span className=\"text-[10px] text-white/70\">Sin datos</span>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\specialties\\map\\StateView.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\specialties\\map\\VenezuelaMapSVG.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'specialtyName' is defined but never used.","line":21,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setIsLoading' is assigned a value but never used.","line":28,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState, useMemo } from \"react\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Loader2 } from \"lucide-react\";\r\nimport { normalizeStateName, VENEZUELA_STATES_GEO } from \"./venezuela-states.data\";\r\nimport { MapControls } from \"./MapControls\";\r\nimport { StateView } from \"./StateView\";\r\n\r\nexport interface VenezuelaMapSVGProps {\r\n    doctorDistribution: Record<string, number>;\r\n    specialtyName?: string;\r\n    onStateSelect?: (stateName: string) => void;\r\n    height?: string;\r\n    className?: string;\r\n}\r\n\r\nexport function VenezuelaMapSVG({\r\n    doctorDistribution,\r\n    specialtyName,\r\n    onStateSelect,\r\n    height = \"500px\",\r\n    className,\r\n}: VenezuelaMapSVGProps) {\r\n    const [selectedStateId, setSelectedStateId] = useState<string | null>(null);\r\n    const [hoveredStateId, setHoveredStateId] = useState<string | null>(null);\r\n    const [isLoading, setIsLoading] = useState(false);\r\n\r\n    // Normalizar mapa de distribución para coincidir con IDs\r\n    const normalizedDistribution = useMemo(() => {\r\n        const dist: Record<string, number> = {};\r\n        Object.entries(doctorDistribution).forEach(([key, val]) => {\r\n            const normalizedKey = normalizeStateName(key);\r\n            dist[normalizedKey] = (dist[normalizedKey] || 0) + val;\r\n        });\r\n        return dist;\r\n    }, [doctorDistribution]);\r\n\r\n    // Calcular máximo para escala de colores\r\n    const maxDoctors = useMemo(() => {\r\n        const values = Object.values(normalizedDistribution);\r\n        return values.length > 0 ? Math.max(...values) : 1;\r\n    }, [normalizedDistribution]);\r\n\r\n    const getColor = (stateId: string, isHovered: boolean, isSelected: boolean) => {\r\n        const count = normalizedDistribution[stateId] || 0;\r\n        const ratio = count / maxDoctors;\r\n\r\n        // Si está seleccionado, color especial\r\n        if (isSelected) return \"#3b82f6\"; // primary blue\r\n\r\n        // Colores base según distribución\r\n        let baseColor = \"#64748b\"; // slate-500 (sin datos)\r\n\r\n        if (count > 0) {\r\n            if (ratio < 0.2) baseColor = \"#3b82f6\"; // blue-500\r\n            else if (ratio < 0.5) baseColor = \"#10b981\"; // emerald-500\r\n            else if (ratio < 0.8) baseColor = \"#f59e0b\"; // amber-500\r\n            else baseColor = \"#ef4444\"; // red-500\r\n        }\r\n\r\n        // Hover effect (aclarar)\r\n        if (isHovered) return baseColor; // El hover real lo manejamos con filters o opacity\r\n\r\n        return baseColor;\r\n    };\r\n\r\n    const selectedStateData = useMemo(() =>\r\n        selectedStateId ? VENEZUELA_STATES_GEO.find(s => s.id === selectedStateId) : null\r\n        , [selectedStateId]);\r\n\r\n    const handleStateClick = (stateId: string) => {\r\n        setSelectedStateId(stateId);\r\n        if (onStateSelect) {\r\n            const stateData = VENEZUELA_STATES_GEO.find(s => s.id === stateId);\r\n            if (stateData) onStateSelect(stateData.name);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div\r\n            className={cn(\r\n                \"relative rounded-3xl overflow-hidden bg-gradient-to-br from-slate-900 to-slate-950 border border-slate-800 shadow-2xl\",\r\n                className\r\n            )}\r\n            style={{ height }}\r\n        >\r\n            {/* Controles y UI contextual */}\r\n            <MapControls\r\n                onReset={() => setSelectedStateId(null)}\r\n                showZoom={false} // Simplificado por ahora\r\n            />\r\n\r\n            {/* Loading Overlay */}\r\n            {isLoading && (\r\n                <div className=\"absolute inset-0 bg-slate-900/80 z-50 flex items-center justify-center\">\r\n                    <Loader2 className=\"w-8 h-8 text-primary animate-spin\" />\r\n                </div>\r\n            )}\r\n\r\n            {/* Contenido Principal con Transiciones */}\r\n            <AnimatePresence mode=\"wait\">\r\n                {selectedStateId && selectedStateData ? (\r\n                    <motion.div\r\n                        key=\"state-view\"\r\n                        initial={{ opacity: 0 }}\r\n                        animate={{ opacity: 1 }}\r\n                        exit={{ opacity: 0 }}\r\n                        className=\"absolute inset-0 z-20 bg-slate-900/95 backdrop-blur-sm\"\r\n                    >\r\n                        <StateView\r\n                            state={selectedStateData}\r\n                            doctorCount={normalizedDistribution[selectedStateId] || 0}\r\n                            onBack={() => setSelectedStateId(null)}\r\n                        />\r\n                    </motion.div>\r\n                ) : (\r\n                    <motion.div\r\n                        key=\"map-view\"\r\n                        initial={{ opacity: 0 }}\r\n                        animate={{ opacity: 1 }}\r\n                        exit={{ opacity: 0 }}\r\n                        className=\"w-full h-full flex items-center justify-center p-4 md:p-8\"\r\n                    >\r\n                        <svg\r\n                            viewBox=\"0 0 850 850\"\r\n                            className=\"w-full h-full max-h-[600px] drop-shadow-[0_0_15px_rgba(59,130,246,0.15)]\"\r\n                            style={{ filter: \"drop-shadow(0 4px 6px rgba(0,0,0,0.3))\" }}\r\n                            preserveAspectRatio=\"xMidYMid meet\"\r\n                        >\r\n                            <defs>\r\n                                <filter id=\"glow\" x=\"-20%\" y=\"-20%\" width=\"140%\" height=\"140%\">\r\n                                    <feGaussianBlur stdDeviation=\"3\" result=\"blur\" />\r\n                                    <feComposite in=\"SourceGraphic\" in2=\"blur\" operator=\"over\" />\r\n                                </filter>\r\n                            </defs>\r\n\r\n                            <g className=\"transition-transform duration-500 ease-out\">\r\n                                {VENEZUELA_STATES_GEO.map((state) => {\r\n                                    const isHovered = hoveredStateId === state.id;\r\n                                    const count = normalizedDistribution[state.id] || 0;\r\n                                    const color = getColor(state.id, isHovered, false);\r\n\r\n                                    return (\r\n                                        <g\r\n                                            key={state.id}\r\n                                            onClick={() => handleStateClick(state.id)}\r\n                                            onMouseEnter={() => setHoveredStateId(state.id)}\r\n                                            onMouseLeave={() => setHoveredStateId(null)}\r\n                                            className=\"cursor-pointer transition-all duration-300\"\r\n                                            style={{\r\n                                                opacity: hoveredStateId && hoveredStateId !== state.id ? 0.4 : 1,\r\n                                                transform: isHovered ? \"scale(1.005)\" : \"scale(1)\", // Efecto pop sutil\r\n                                                transformOrigin: \"center\"\r\n                                            }}\r\n                                        >\r\n                                            <path\r\n                                                d={state.path}\r\n                                                fill={color}\r\n                                                stroke=\"rgba(255,255,255,0.15)\"\r\n                                                strokeWidth={isHovered ? 2 : 1}\r\n                                                className=\"transition-all duration-300 ease-out\"\r\n                                                style={{\r\n                                                    filter: isHovered ? \"brightness(1.2)\" : \"none\"\r\n                                                }}\r\n                                            />\r\n\r\n                                            {/* Labels solo para estados con médicos o en hover */}\r\n                                            {(count > 0 || isHovered) && (\r\n                                                <g\r\n                                                    style={{ pointerEvents: \"none\" }}\r\n                                                    className={cn(\r\n                                                        \"transition-opacity duration-300\",\r\n                                                        isHovered ? \"opacity-100\" : \"opacity-0 md:opacity-70\"\r\n                                                    )}\r\n                                                >\r\n                                                    <circle cx={state.center[0]} cy={state.center[1]} r={2} fill=\"white\" />\r\n                                                    <text\r\n                                                        x={state.center[0]}\r\n                                                        y={state.center[1] - 5}\r\n                                                        textAnchor=\"middle\"\r\n                                                        fill=\"white\"\r\n                                                        fontSize=\"10\"\r\n                                                        fontWeight=\"bold\"\r\n                                                        className=\"drop-shadow-md select-none\"\r\n                                                    >\r\n                                                        {state.name}\r\n                                                    </text>\r\n                                                    {isHovered && (\r\n                                                        <text\r\n                                                            x={state.center[0]}\r\n                                                            y={state.center[1] + 10}\r\n                                                            textAnchor=\"middle\"\r\n                                                            fill=\"rgba(255,255,255,0.8)\"\r\n                                                            fontSize=\"8\"\r\n                                                            className=\"drop-shadow-md select-none\"\r\n                                                        >\r\n                                                            {count} Médicos\r\n                                                        </text>\r\n                                                    )}\r\n                                                </g>\r\n                                            )}\r\n                                        </g>\r\n                                    );\r\n                                })}\r\n                            </g>\r\n                        </svg>\r\n                    </motion.div>\r\n                )}\r\n            </AnimatePresence>\r\n\r\n            {/* Overlay informativa básica en mobile si no se ha interactuado */}\r\n            <div className=\"absolute bottom-4 left-4 right-4 pointer-events-none md:hidden\">\r\n                <div className=\"bg-slate-900/80 backdrop-blur-md rounded-lg p-3 text-xs text-center text-white/60 border border-white/10\">\r\n                    Toca un estado para ver detalles\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\specialties\\map\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\specialties\\map\\venezuela-states.data.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\specialties\\master-list.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\specialties\\specialties-content.data.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\specialties\\specialty-map.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Tooltip' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'specialtyName' is defined but never used.","line":54,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":54,"endColumn":45},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\specialties\\specialty-map.tsx:71:9\n  69 |\n  70 |     useEffect(() => {\n> 71 |         setMounted(true);\n     |         ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  72 |     }, []);\n  73 |\n  74 |     // Actualizar data cuando cambien las props","line":71,"column":9,"nodeType":null,"endLine":71,"endColumn":19},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\specialties\\specialty-map.tsx:77:13\n  75 |     useEffect(() => {\n  76 |         if (distribution && Object.keys(distribution).length > 0) {\n> 77 |             setData(distribution);\n     |             ^^^^^^^ Avoid calling setState() directly within an effect\n  78 |         } else if (doctorCount > 0) {\n  79 |             setData(generateMockData(doctorCount));\n  80 |         } else {","line":77,"column":13,"nodeType":null,"endLine":77,"endColumn":20}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useEffect, useState, useMemo } from \"react\";\r\nimport { ComposableMap, Geographies, Geography, ZoomableGroup } from \"react-simple-maps\";\r\nimport { scaleQuantile } from \"d3-scale\";\r\nimport { Tooltip } from \"react-tooltip\";\r\nimport { Loader2, MapPin, Users, Activity } from \"lucide-react\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\n// TopoJSON for Venezuela (States/Departments)\r\nconst GEO_URL = \"https://raw.githubusercontent.com/deldersveld/topojson/master/countries/venezuela/venezuela-estados.json\";\r\n\r\ninterface SpecialtyMapProps {\r\n    specialtyName: string;\r\n    doctorCount: number;\r\n    distribution?: Record<string, number>;\r\n}\r\n\r\n// Mock data generation (unchanged logic)\r\nconst generateMockData = (total: number) => {\r\n    const states = [\r\n        \"Amazonas\", \"Anzoátegui\", \"Apure\", \"Aragua\", \"Barinas\", \"Bolívar\",\r\n        \"Carabobo\", \"Cojedes\", \"Delta Amacuro\", \"Falcón\", \"Guárico\", \"Lara\",\r\n        \"Mérida\", \"Miranda\", \"Monagas\", \"Nueva Esparta\", \"Portuguesa\", \"Sucre\",\r\n        \"Táchira\", \"Trujillo\", \"Yaracuy\", \"Zulia\", \"La Guaira\", \"Distrito Capital\"\r\n    ];\r\n\r\n    const data: Record<string, number> = {};\r\n    let remaining = total;\r\n    const main = [\"Distrito Capital\", \"Miranda\", \"Zulia\", \"Carabobo\", \"Lara\"];\r\n\r\n    states.forEach(state => {\r\n        if (main.includes(state)) {\r\n            const count = Math.ceil(remaining * 0.15);\r\n            data[state] = count;\r\n            remaining -= count;\r\n        } else {\r\n            data[state] = 0;\r\n        }\r\n    });\r\n\r\n    states.forEach(state => {\r\n        if (remaining > 0 && !data[state]) {\r\n            const count = Math.floor(Math.random() * (remaining / 10));\r\n            data[state] = count;\r\n        }\r\n        if (!data[state]) data[state] = 0;\r\n    });\r\n\r\n    return data;\r\n};\r\n\r\nexport function SpecialtyMap({ specialtyName, doctorCount, distribution }: SpecialtyMapProps) {\r\n    const [hoveredState, setHoveredState] = useState<{ name: string; count: number } | null>(null);\r\n\r\n    // Calcular data inicial sin setState en useEffect\r\n    const initialData = React.useMemo(() => {\r\n        if (distribution && Object.keys(distribution).length > 0) {\r\n            return distribution;\r\n        } else if (doctorCount > 0) {\r\n            return generateMockData(doctorCount);\r\n        }\r\n        return {};\r\n    }, [distribution, doctorCount]);\r\n\r\n    const [data, setData] = useState<Record<string, number>>(initialData);\r\n    const [mounted, setMounted] = useState(false);\r\n\r\n    useEffect(() => {\r\n        setMounted(true);\r\n    }, []);\r\n\r\n    // Actualizar data cuando cambien las props\r\n    useEffect(() => {\r\n        if (distribution && Object.keys(distribution).length > 0) {\r\n            setData(distribution);\r\n        } else if (doctorCount > 0) {\r\n            setData(generateMockData(doctorCount));\r\n        } else {\r\n            setData({});\r\n        }\r\n    }, [distribution, doctorCount]);\r\n\r\n    const colorScale = useMemo(() => {\r\n        const values = Object.values(data).filter(v => v > 0);\r\n        return scaleQuantile<string>()\r\n            .domain(values.length > 0 ? values : [0])\r\n            .range([\r\n                \"#eff6ff\", // blue-50\r\n                \"#dbeafe\", // blue-100\r\n                \"#bfdbfe\", // blue-200\r\n                \"#93c5fd\", // blue-300\r\n                \"#60a5fa\", // blue-400\r\n                \"#3b82f6\", // blue-500\r\n                \"#2563eb\", // blue-600\r\n                \"#1d4ed8\", // blue-700\r\n            ]);\r\n    }, [data]);\r\n\r\n    if (!mounted) return (\r\n        <div className=\"h-full w-full flex items-center justify-center bg-muted/20\">\r\n            <Loader2 className=\"animate-spin text-primary w-8 h-8\" />\r\n        </div>\r\n    );\r\n\r\n    return (\r\n        <motion.div\r\n            initial={{ opacity: 0, scale: 0.95 }}\r\n            animate={{ opacity: 1, scale: 1 }}\r\n            transition={{ duration: 0.5 }}\r\n            className=\"w-full h-full bg-gradient-to-br from-slate-50 to-white dark:from-slate-900 dark:to-slate-950 relative overflow-hidden\"\r\n        >\r\n            {/* Header / Legend Overlay */}\r\n            <div className=\"absolute top-6 left-6 z-20 pointer-events-none\">\r\n                <motion.div\r\n                    initial={{ x: -20, opacity: 0 }}\r\n                    animate={{ x: 0, opacity: 1 }}\r\n                    transition={{ delay: 0.2 }}\r\n                >\r\n                    <h4 className=\"text-xl font-black text-foreground tracking-tight drop-shadow-sm\">Distribución Nacional</h4>\r\n                    <p className=\"text-sm text-slate-500 dark:text-slate-400 font-medium mt-1 flex items-center gap-2\">\r\n                        <Activity className=\"w-4 h-4 text-primary\" />\r\n                        {doctorCount} especialistas activos\r\n                    </p>\r\n                </motion.div>\r\n            </div>\r\n\r\n            {/* Interactive Map */}\r\n            <div className=\"w-full h-full pt-12 pb-4 px-4\">\r\n                <ComposableMap\r\n                    projection=\"geoMercator\"\r\n                    projectionConfig={{\r\n                        scale: 3200,\r\n                        center: [-66, 7] // Center on Venezuela\r\n                    }}\r\n                    className=\"w-full h-full drop-shadow-xl\"\r\n                >\r\n                    <ZoomableGroup zoom={1} maxZoom={3}>\r\n                        <Geographies geography={GEO_URL}>\r\n                            {({ geographies }) =>\r\n                                (geographies as Array<{ rsmKey: string; properties: { NAME_1?: string; name?: string }; [key: string]: unknown }>).map((geo) => {\r\n                                    const stateName = geo.properties.NAME_1 || geo.properties.name || '';\r\n                                    const count = data[stateName] || 0;\r\n                                    const isHovered = hoveredState?.name === stateName;\r\n\r\n                                    return (\r\n                                        <Geography\r\n                                            key={geo.rsmKey}\r\n                                            geography={geo}\r\n                                            fill={count > 0 ? colorScale(count) : \"#f8fafc\"}\r\n                                            stroke={isHovered ? \"#3b82f6\" : \"#cbd5e1\"}\r\n                                            strokeWidth={isHovered ? 2 : 0.5}\r\n                                            className={cn(\r\n                                                \"outline-none transition-all duration-300 cursor-pointer\",\r\n                                                isHovered ? \"opacity-100 z-10\" : \"opacity-90 hover:opacity-100\"\r\n                                            )}\r\n                                            onMouseEnter={() => setHoveredState({ name: stateName, count })}\r\n                                            onMouseLeave={() => setHoveredState(null)}\r\n                                            style={{\r\n                                                default: { outline: \"none\" },\r\n                                                hover: { fill: count > 0 ? colorScale(count) : \"#e2e8f0\", outline: \"none\" },\r\n                                                pressed: { outline: \"none\" },\r\n                                            }}\r\n                                        />\r\n                                    );\r\n                                })\r\n                            }\r\n                        </Geographies>\r\n                    </ZoomableGroup>\r\n                </ComposableMap>\r\n            </div>\r\n\r\n            {/* Dynamic Data Card Overlay */}\r\n            <AnimatePresence>\r\n                {hoveredState && (\r\n                    <motion.div\r\n                        initial={{ opacity: 0, y: 20, x: 20 }}\r\n                        animate={{ opacity: 1, y: 0, x: 0 }}\r\n                        exit={{ opacity: 0, y: 10, x: 10 }}\r\n                        className=\"absolute bottom-6 right-6 z-30 min-w-[220px]\"\r\n                    >\r\n                        <div className=\"bg-white/90 dark:bg-slate-900/90 backdrop-blur-xl border border-white/20 dark:border-white/10 p-5 rounded-2xl shadow-2xl ring-1 ring-black/5\">\r\n                            <h5 className=\"text-lg font-bold text-foreground mb-1 flex items-center gap-2\">\r\n                                <MapPin className=\"w-4 h-4 text-primary fill-primary/20\" />\r\n                                {hoveredState.name}\r\n                            </h5>\r\n                            <div className=\"h-px w-full bg-border/50 my-3\" />\r\n                            <div className=\"flex items-center justify-between\">\r\n                                <span className=\"text-sm text-muted-foreground\">Especialistas</span>\r\n                                <span className={cn(\r\n                                    \"text-2xl font-black\",\r\n                                    hoveredState.count > 0 ? \"text-primary\" : \"text-muted-foreground\"\r\n                                )}>\r\n                                    {hoveredState.count}\r\n                                </span>\r\n                            </div>\r\n                            {hoveredState.count === 0 && (\r\n                                <p className=\"text-xs text-muted-foreground mt-2 italic\">\r\n                                    No hay registros en esta zona\r\n                                </p>\r\n                            )}\r\n                            {hoveredState.count > 0 && (\r\n                                <div className=\"mt-3 flex items-center gap-2 text-xs text-emerald-600 dark:text-emerald-400 bg-emerald-50 dark:bg-emerald-900/20 px-2 py-1 rounded-md w-fit\">\r\n                                    <Users className=\"w-3 h-3\" />\r\n                                    Disponible ahora\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </motion.div>\r\n                )}\r\n            </AnimatePresence>\r\n\r\n            {/* Simple Legend for cleaner look */}\r\n            {!hoveredState && (\r\n                <motion.div\r\n                    initial={{ opacity: 0 }}\r\n                    animate={{ opacity: 1 }}\r\n                    className=\"absolute bottom-6 right-6 bg-white/50 dark:bg-slate-900/50 backdrop-blur-sm px-3 py-1.5 rounded-lg border border-border/50 text-xs text-muted-foreground\"\r\n                >\r\n                    Pasa el cursor por el mapa\r\n                </motion.div>\r\n            )}\r\n        </motion.div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\stats-section.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\technology-section.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\sections\\testimonials-section.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\components\\video\\video-background.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\auth\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\auth\\use-oauth-errors.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\auth\\use-oauth-signin.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\auth\\use-rate-limit.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'attempts' is assigned a value but never used.","line":15,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useCallback } from \"react\";\r\n\r\n// Sistema de bloqueo progresivo más razonable\r\nconst LOCKOUT_THRESHOLDS = [\r\n  { attempts: 3, duration: 20 * 1000 },      // 3 intentos: 20 segundos\r\n  { attempts: 5, duration: 60 * 1000 },      // 5 intentos: 1 minuto\r\n  { attempts: 7, duration: 3 * 60 * 1000 },  // 7 intentos: 3 minutos\r\n  { attempts: 10, duration: 10 * 60 * 1000 }, // 10 intentos: 10 minutos\r\n];\r\n\r\nexport function useRateLimit() {\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const checkRateLimit = useCallback(() => {\r\n    const attempts = parseInt(localStorage.getItem(\"login_attempts\") || \"0\");\r\n    const lockoutUntil = parseInt(localStorage.getItem(\"lockout_until\") || \"0\");\r\n\r\n    if (lockoutUntil && Date.now() < lockoutUntil) {\r\n      const timeLeft = lockoutUntil - Date.now();\r\n      const secondsLeft = Math.ceil(timeLeft / 1000);\r\n      \r\n      let message: string;\r\n      if (secondsLeft < 60) {\r\n        message = `Demasiados intentos fallidos. Intenta de nuevo en ${secondsLeft} segundo${secondsLeft > 1 ? \"s\" : \"\"}.`;\r\n      } else {\r\n        const minutesLeft = Math.ceil(secondsLeft / 60);\r\n        message = `Demasiados intentos fallidos. Intenta de nuevo en ${minutesLeft} minuto${minutesLeft > 1 ? \"s\" : \"\"}.`;\r\n      }\r\n      \r\n      setError(message);\r\n      return { allowed: false, message };\r\n    }\r\n\r\n    // Si el bloqueo expiró, limpiar intentos\r\n    if (lockoutUntil && Date.now() >= lockoutUntil) {\r\n      localStorage.removeItem(\"login_attempts\");\r\n      localStorage.removeItem(\"lockout_until\");\r\n    }\r\n\r\n    setError(null);\r\n    return { allowed: true };\r\n  }, []);\r\n\r\n  const recordFailedAttempt = useCallback(() => {\r\n    const attempts = parseInt(localStorage.getItem(\"login_attempts\") || \"0\") + 1;\r\n    localStorage.setItem(\"login_attempts\", attempts.toString());\r\n\r\n    // Buscar el umbral de bloqueo correspondiente\r\n    const threshold = LOCKOUT_THRESHOLDS.find(t => attempts >= t.attempts);\r\n    \r\n    if (threshold) {\r\n      const lockoutUntil = Date.now() + threshold.duration;\r\n      localStorage.setItem(\"lockout_until\", lockoutUntil.toString());\r\n      \r\n      const seconds = Math.ceil(threshold.duration / 1000);\r\n      let message: string;\r\n      \r\n      if (seconds < 60) {\r\n        message = `Demasiados intentos fallidos (${attempts}). Espera ${seconds} segundos antes de intentar nuevamente.`;\r\n      } else {\r\n        const minutes = Math.ceil(seconds / 60);\r\n        message = `Demasiados intentos fallidos (${attempts}). Espera ${minutes} minuto${minutes > 1 ? \"s\" : \"\"} antes de intentar nuevamente.`;\r\n      }\r\n      \r\n      setError(message);\r\n    }\r\n  }, []);\r\n\r\n  const resetAttempts = useCallback(() => {\r\n    localStorage.removeItem(\"login_attempts\");\r\n    localStorage.removeItem(\"lockout_until\");\r\n    setError(null);\r\n  }, []);\r\n\r\n  return {\r\n    error,\r\n    setError,\r\n    checkRateLimit,\r\n    recordFailedAttempt,\r\n    resetAttempts,\r\n  };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\auth\\use-session-setup.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\auth\\use-session-validation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\paciente\\useConfiguracion.ts","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadUserData'. Either include it or remove the dependency array.","line":79,"column":6,"nodeType":"ArrayExpression","endLine":79,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadUserData]","fix":{"range":[2368,2370],"text":"[loadUserData]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-appointment-form.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'timestamp' is assigned a value but never used.","line":93,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":93,"endColumn":24,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-appointments.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'session?.access_token'. Either include it or remove the dependency array.","line":77,"column":6,"nodeType":"ArrayExpression","endLine":77,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [doctorId, session?.access_token]","fix":{"range":[2277,2287],"text":"[doctorId, session?.access_token]"}}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-appointments.ts:175:7\n  173 |     if (!doctorId || !date) {\n  174 |       // Solo limpiar si ya hay datos\n> 175 |       setTimeSlots(prev => prev.length > 0 ? [] : prev);\n      |       ^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  176 |       return;\n  177 |     }\n  178 |","line":175,"column":7,"nodeType":null,"endLine":175,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\r\nimport {\r\n  getPatientAppointments,\r\n  getDoctorAppointments,\r\n  getMedicalSpecialties,\r\n  getAvailableDoctors,\r\n  getDoctorProfile,\r\n  getAvailableTimeSlots,\r\n  createAppointment,\r\n  cancelAppointment,\r\n} from \"@/lib/supabase/services/appointments-service\";\r\nimport type {\r\n  Appointment,\r\n  MedicalSpecialty,\r\n  DoctorProfile,\r\n  TimeSlot,\r\n  CreateAppointmentData,\r\n} from \"@/lib/supabase/types/appointments\";\r\nimport { useAuth } from \"./use-auth\";\r\n\r\n// Hook para citas del paciente\r\nexport function usePatientAppointments(patientId: string | undefined) {\r\n  const [appointments, setAppointments] = useState<Appointment[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (!patientId) return;\r\n\r\n    const loadAppointments = async () => {\r\n      setLoading(true);\r\n      const result = await getPatientAppointments(patientId);\r\n      if (result.success) {\r\n        setAppointments(result.data);\r\n      } else {\r\n        setError(String(result.error) || 'Error loading appointments');\r\n      }\r\n      setLoading(false);\r\n    };\r\n\r\n    loadAppointments();\r\n  }, [patientId]);\r\n\r\n  const refreshAppointments = async () => {\r\n    if (!patientId) return;\r\n    const result = await getPatientAppointments(patientId);\r\n    if (result.success && result.data) {\r\n      setAppointments(result.data);\r\n    }\r\n  };\r\n\r\n  return { appointments, loading, error, refreshAppointments };\r\n}\r\n\r\n// Hook para citas del doctor\r\nexport function useDoctorAppointments(doctorId: string | undefined) {\r\n  const [appointments, setAppointments] = useState<Appointment[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const { session } = useAuth();\r\n\r\n  useEffect(() => {\r\n    if (!doctorId) return;\r\n\r\n    const loadAppointments = async () => {\r\n      setLoading(true);\r\n      const result = await getDoctorAppointments(doctorId, session?.access_token);\r\n      if (result.success) {\r\n        setAppointments(result.data);\r\n      } else {\r\n        setError(String(result.error) || 'Error loading appointments');\r\n      }\r\n      setLoading(false);\r\n    };\r\n\r\n    loadAppointments();\r\n  }, [doctorId]);\r\n\r\n  const refreshAppointments = async () => {\r\n    if (!doctorId) return;\r\n    const result = await getDoctorAppointments(doctorId, session?.access_token);\r\n    if (result.success && result.data) {\r\n      setAppointments(result.data);\r\n    }\r\n  };\r\n\r\n  return { appointments, loading, error, refreshAppointments };\r\n}\r\n\r\n// Hook para especialidades médicas\r\nexport function useMedicalSpecialties(onlyWithDoctors: boolean = false) {\r\n  const [specialties, setSpecialties] = useState<MedicalSpecialty[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    console.log('🎣 useMedicalSpecialties hook called with onlyWithDoctors:', onlyWithDoctors);\r\n\r\n    const loadSpecialties = async () => {\r\n      console.log('⏳ Loading specialties...');\r\n      const result = await getMedicalSpecialties(onlyWithDoctors);\r\n      console.log('📦 Result from getMedicalSpecialties:', result);\r\n\r\n      if (result.success) {\r\n        console.log('✅ Setting specialties:', result.data.length);\r\n        setSpecialties(result.data);\r\n      } else {\r\n        console.error('❌ Failed to load specialties:', result.error);\r\n      }\r\n      setLoading(false);\r\n    };\r\n\r\n    loadSpecialties();\r\n  }, [onlyWithDoctors]);\r\n\r\n  console.log('🎣 Hook returning:', { specialties: specialties.length, loading });\r\n\r\n  return { specialties, loading };\r\n}\r\n\r\n// Hook para doctores disponibles\r\nexport function useAvailableDoctors(specialtyId?: string) {\r\n  const [doctors, setDoctors] = useState<DoctorProfile[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const loadDoctors = async () => {\r\n      setLoading(true);\r\n      const result = await getAvailableDoctors(specialtyId);\r\n      if (result.success) {\r\n        setDoctors(result.data);\r\n      }\r\n      setLoading(false);\r\n    };\r\n\r\n    loadDoctors();\r\n  }, [specialtyId]);\r\n\r\n  return { doctors, loading };\r\n}\r\n\r\n// Hook para perfil de doctor\r\nexport function useDoctorProfile(doctorId: string | undefined) {\r\n  const [doctor, setDoctor] = useState<DoctorProfile | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    if (!doctorId) return;\r\n\r\n    const loadDoctor = async () => {\r\n      setLoading(true);\r\n      const result = await getDoctorProfile(doctorId);\r\n      if (result.success) {\r\n        setDoctor(result.data);\r\n      }\r\n      setLoading(false);\r\n    };\r\n\r\n    loadDoctor();\r\n  }, [doctorId]);\r\n\r\n  return { doctor, loading };\r\n}\r\n\r\n// Hook para slots de tiempo disponibles\r\nexport function useAvailableTimeSlots(\r\n  doctorId: string | undefined,\r\n  date: string | undefined\r\n) {\r\n  const [timeSlots, setTimeSlots] = useState<TimeSlot[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (!doctorId || !date) {\r\n      // Solo limpiar si ya hay datos\r\n      setTimeSlots(prev => prev.length > 0 ? [] : prev);\r\n      return;\r\n    }\r\n\r\n    const loadTimeSlots = async () => {\r\n      setLoading(true);\r\n      const result = await getAvailableTimeSlots(doctorId, date);\r\n      if (result.success) {\r\n        setTimeSlots(result.data);\r\n      }\r\n      setLoading(false);\r\n    };\r\n\r\n    loadTimeSlots();\r\n  }, [doctorId, date]);\r\n\r\n  return { timeSlots, loading };\r\n}\r\n\r\n// Hook para crear cita\r\nexport function useCreateAppointment() {\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const create = async (\r\n    patientId: string,\r\n    appointmentData: CreateAppointmentData\r\n  ) => {\r\n    setLoading(true);\r\n    setError(null);\r\n    const result = await createAppointment(patientId, appointmentData);\r\n    setLoading(false);\r\n    if (!result.success) {\r\n      setError(String(result.error));\r\n    }\r\n    return result;\r\n  };\r\n\r\n  return { create, loading, error };\r\n}\r\n\r\n// Hook para cancelar cita\r\nexport function useCancelAppointment() {\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const cancel = async (\r\n    appointmentId: string,\r\n    userId: string,\r\n    reason?: string\r\n  ) => {\r\n    setLoading(true);\r\n    setError(null);\r\n    const result = await cancelAppointment(appointmentId, userId, reason);\r\n    setLoading(false);\r\n    if (!result.success) {\r\n      setError(String(result.error));\r\n    }\r\n    return result;\r\n  };\r\n\r\n  return { cancel, loading, error };\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-auth.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[272,275],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[272,275],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from \"react\";\r\nimport { User } from \"@supabase/supabase-js\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\n\r\nexport function useAuth() {\r\n  const [user, setUser] = useState<User | null>(null);\r\n  const [session, setSession] = useState<any>(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    // Obtener sesión actual\r\n    const getSession = async () => {\r\n      try {\r\n        const { data: { session } } = await supabase.auth.getSession();\r\n        setSession(session);\r\n        setUser(session?.user ?? null);\r\n      } catch (error) {\r\n        console.error(\"Error getting session:\", error);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    getSession();\r\n\r\n    // Escuchar cambios de autenticación\r\n    const { data: { subscription } } = supabase.auth.onAuthStateChange(\r\n      (_event, session) => {\r\n        setSession(session);\r\n        setUser(session?.user ?? null);\r\n        setLoading(false);\r\n      }\r\n    );\r\n\r\n    return () => {\r\n      subscription.unsubscribe();\r\n    };\r\n  }, []);\r\n\r\n  return { user, session, loading };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-bcv-rate.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-cita-tour-guide.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-clinic-international.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CreateInternationalPatientInput' is defined but never used.","line":27,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":34}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Hook para gestión de pacientes internacionales\r\n * \r\n * Maneja registro, documentos y seguimiento de pacientes extranjeros\r\n */\r\n\r\n'use client';\r\n\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\r\nimport {\r\n  getInternationalPatients,\r\n  getInternationalPatientById,\r\n  getActiveInternationalPatients,\r\n  getPendingArrivals,\r\n  createInternationalPatient,\r\n  updateInternationalPatient,\r\n  updatePatientStatus,\r\n  getTravelDocuments,\r\n  uploadTravelDocument,\r\n  verifyTravelDocument,\r\n  deleteTravelDocument,\r\n  getPendingDocumentVerifications,\r\n  getInternationalPatientStats,\r\n  getCountryRequirements,\r\n} from '@/lib/supabase/services/clinic-international-service';\r\nimport type {\r\n  CreateInternationalPatientInput,\r\n  InternationalPatient,\r\n  TravelDocument,\r\n} from '@/lib/types/clinic.types';\r\n\r\nexport function useInternationalPatients(clinicId?: string) {\r\n  const queryClient = useQueryClient();\r\n\r\n  // Obtener todos los pacientes internacionales\r\n  const {\r\n    data: patients,\r\n    isLoading: loadingPatients,\r\n    refetch: refetchPatients,\r\n  } = useQuery({\r\n    queryKey: ['international-patients', clinicId],\r\n    queryFn: () => (clinicId ? getInternationalPatients(clinicId) : []),\r\n    enabled: !!clinicId,\r\n  });\r\n\r\n  // Obtener pacientes activos\r\n  const {\r\n    data: activePatients,\r\n    isLoading: loadingActive,\r\n  } = useQuery({\r\n    queryKey: ['active-international-patients', clinicId],\r\n    queryFn: () => (clinicId ? getActiveInternationalPatients(clinicId) : []),\r\n    enabled: !!clinicId,\r\n  });\r\n\r\n  // Obtener próximas llegadas\r\n  const {\r\n    data: pendingArrivals,\r\n    isLoading: loadingArrivals,\r\n  } = useQuery({\r\n    queryKey: ['pending-arrivals', clinicId],\r\n    queryFn: () => (clinicId ? getPendingArrivals(clinicId, 30) : []),\r\n    enabled: !!clinicId,\r\n  });\r\n\r\n  // Obtener documentos pendientes de verificación\r\n  const {\r\n    data: pendingDocs,\r\n    isLoading: loadingPendingDocs,\r\n    refetch: refetchPendingDocs,\r\n  } = useQuery({\r\n    queryKey: ['pending-document-verifications', clinicId],\r\n    queryFn: () => (clinicId ? getPendingDocumentVerifications(clinicId) : []),\r\n    enabled: !!clinicId,\r\n  });\r\n\r\n  // Obtener estadísticas\r\n  const {\r\n    data: stats,\r\n    isLoading: loadingStats,\r\n  } = useQuery({\r\n    queryKey: ['international-patient-stats', clinicId],\r\n    queryFn: () => (clinicId ? getInternationalPatientStats(clinicId) : null),\r\n    enabled: !!clinicId,\r\n  });\r\n\r\n  // Mutation: Crear paciente internacional\r\n  const createPatientMutation = useMutation({\r\n    mutationFn: createInternationalPatient,\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['international-patients'] });\r\n      queryClient.invalidateQueries({ queryKey: ['active-international-patients'] });\r\n      queryClient.invalidateQueries({ queryKey: ['international-patient-stats'] });\r\n    },\r\n  });\r\n\r\n  // Mutation: Actualizar paciente\r\n  const updatePatientMutation = useMutation({\r\n    mutationFn: ({\r\n      patientId,\r\n      updates,\r\n    }: {\r\n      patientId: string;\r\n      updates: Partial<InternationalPatient>;\r\n    }) => updateInternationalPatient(patientId, updates),\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['international-patients'] });\r\n      queryClient.invalidateQueries({ queryKey: ['international-patient'] });\r\n    },\r\n  });\r\n\r\n  // Mutation: Actualizar estado\r\n  const updateStatusMutation = useMutation({\r\n    mutationFn: ({\r\n      patientId,\r\n      status,\r\n    }: {\r\n      patientId: string;\r\n      status: InternationalPatient['status'];\r\n    }) => updatePatientStatus(patientId, status),\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['international-patients'] });\r\n      queryClient.invalidateQueries({ queryKey: ['active-international-patients'] });\r\n      queryClient.invalidateQueries({ queryKey: ['pending-arrivals'] });\r\n    },\r\n  });\r\n\r\n  return {\r\n    // Data\r\n    patients,\r\n    activePatients,\r\n    pendingArrivals,\r\n    pendingDocs,\r\n    stats,\r\n\r\n    // Loading\r\n    isLoading: loadingPatients || loadingActive || loadingArrivals,\r\n    loadingPatients,\r\n    loadingActive,\r\n    loadingArrivals,\r\n    loadingPendingDocs,\r\n    loadingStats,\r\n\r\n    // Actions\r\n    createPatient: createPatientMutation.mutateAsync,\r\n    updatePatient: updatePatientMutation.mutateAsync,\r\n    updateStatus: updateStatusMutation.mutateAsync,\r\n\r\n    // Refetch\r\n    refetchPatients,\r\n    refetchPendingDocs,\r\n\r\n    // Mutation states\r\n    isCreating: createPatientMutation.isPending,\r\n    isUpdating: updatePatientMutation.isPending,\r\n  };\r\n}\r\n\r\nexport function useInternationalPatientDetails(patientId?: string) {\r\n  const queryClient = useQueryClient();\r\n\r\n  const {\r\n    data: patient,\r\n    isLoading: loadingPatient,\r\n    error,\r\n  } = useQuery({\r\n    queryKey: ['international-patient', patientId],\r\n    queryFn: () => (patientId ? getInternationalPatientById(patientId) : null),\r\n    enabled: !!patientId,\r\n  });\r\n\r\n  const {\r\n    data: documents,\r\n    isLoading: loadingDocuments,\r\n    refetch: refetchDocuments,\r\n  } = useQuery({\r\n    queryKey: ['travel-documents', patientId],\r\n    queryFn: () => (patientId ? getTravelDocuments(patientId) : []),\r\n    enabled: !!patientId,\r\n  });\r\n\r\n  const {\r\n    data: countryReqs,\r\n    isLoading: loadingCountryReqs,\r\n  } = useQuery({\r\n    queryKey: ['country-requirements', patient?.origin_country],\r\n    queryFn: () =>\r\n      patient?.origin_country ? getCountryRequirements(patient.origin_country) : null,\r\n    enabled: !!patient?.origin_country,\r\n  });\r\n\r\n  // Mutation: Subir documento\r\n  const uploadDocumentMutation = useMutation({\r\n    mutationFn: ({\r\n      documentType,\r\n      documentName,\r\n      file,\r\n    }: {\r\n      documentType: TravelDocument['document_type'];\r\n      documentName: string;\r\n      file: File;\r\n    }) => {\r\n      if (!patientId) throw new Error('No patient ID');\r\n      return uploadTravelDocument(patientId, documentType, documentName, file);\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['travel-documents', patientId] });\r\n      queryClient.invalidateQueries({ queryKey: ['pending-document-verifications'] });\r\n    },\r\n  });\r\n\r\n  // Mutation: Verificar documento\r\n  const verifyDocumentMutation = useMutation({\r\n    mutationFn: ({ documentId, userId }: { documentId: string; userId: string }) =>\r\n      verifyTravelDocument(documentId, userId),\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['travel-documents', patientId] });\r\n      queryClient.invalidateQueries({ queryKey: ['pending-document-verifications'] });\r\n    },\r\n  });\r\n\r\n  // Mutation: Eliminar documento\r\n  const deleteDocumentMutation = useMutation({\r\n    mutationFn: deleteTravelDocument,\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['travel-documents', patientId] });\r\n    },\r\n  });\r\n\r\n  // Helpers\r\n  const requiredDocs = countryReqs?.required_documents || [];\r\n  const uploadedDocTypes = new Set<string>(documents?.map((d) => d.document_type) || []);\r\n  const missingDocs = requiredDocs.filter((docType) => !uploadedDocTypes.has(docType as string));\r\n  const verifiedDocs = documents?.filter((d) => d.verified) || [];\r\n  const unverifiedDocs = documents?.filter((d) => !d.verified) || [];\r\n\r\n  const isDocumentationComplete = missingDocs.length === 0;\r\n  const isAllVerified = (documents?.length || 0) > 0 && unverifiedDocs.length === 0;\r\n\r\n  return {\r\n    // Data\r\n    patient,\r\n    documents,\r\n    countryReqs,\r\n    requiredDocs,\r\n    missingDocs,\r\n    verifiedDocs,\r\n    unverifiedDocs,\r\n    isDocumentationComplete,\r\n    isAllVerified,\r\n\r\n    // Loading\r\n    isLoading: loadingPatient || loadingDocuments,\r\n    loadingPatient,\r\n    loadingDocuments,\r\n    loadingCountryReqs,\r\n    error,\r\n\r\n    // Actions\r\n    uploadDocument: uploadDocumentMutation.mutateAsync,\r\n    verifyDocument: verifyDocumentMutation.mutateAsync,\r\n    deleteDocument: deleteDocumentMutation.mutateAsync,\r\n\r\n    // Refetch\r\n    refetchDocuments,\r\n\r\n    // Mutation states\r\n    isUploading: uploadDocumentMutation.isPending,\r\n    isVerifying: verifyDocumentMutation.isPending,\r\n    isDeleting: deleteDocumentMutation.isPending,\r\n  };\r\n}\r\n\r\nexport function useCountryRequirements(countryCode?: string) {\r\n  const { data, isLoading } = useQuery({\r\n    queryKey: ['country-requirements', countryCode],\r\n    queryFn: () => (countryCode ? getCountryRequirements(countryCode) : null),\r\n    enabled: !!countryCode,\r\n  });\r\n\r\n  return {\r\n    requirements: data,\r\n    isLoading,\r\n  };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-clinic-operations.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getAvailableResources' is defined but never used.","line":12,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'updateStaffShift' is defined but never used.","line":17,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'generateOperationalAlerts' is defined but never used.","line":21,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'StaffShift' is defined but never used.","line":27,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Hook para gestión de operaciones clínicas\r\n * \r\n * Maneja recursos, turnos, métricas y alertas operacionales\r\n */\r\n\r\n'use client';\r\n\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\r\nimport {\r\n  getClinicResources,\r\n  getAvailableResources,\r\n  updateResourceStatus,\r\n  getStaffShifts,\r\n  getActiveShifts,\r\n  createStaffShift,\r\n  updateStaffShift,\r\n  cancelStaffShift,\r\n  getOperationalMetrics,\r\n  getDailyMetricsSummary,\r\n  generateOperationalAlerts,\r\n  getClinicDepartments,\r\n} from '@/lib/supabase/services/clinic-operations-service';\r\nimport type {\r\n  ResourceFilters,\r\n  ClinicResource,\r\n  StaffShift,\r\n} from '@/lib/types/clinic.types';\r\n\r\nexport function useClinicOperations(locationIds?: string[]) {\r\n  const queryClient = useQueryClient();\r\n\r\n  // Obtener recursos\r\n  const {\r\n    data: resources,\r\n    isLoading: loadingResources,\r\n    refetch: refetchResources,\r\n  } = useQuery({\r\n    queryKey: ['clinic-resources', locationIds],\r\n    queryFn: () => {\r\n      if (!locationIds || locationIds.length === 0) return [];\r\n      const filters: ResourceFilters = { location_ids: locationIds };\r\n      return getClinicResources(filters);\r\n    },\r\n    enabled: !!locationIds && locationIds.length > 0,\r\n  });\r\n\r\n  // Obtener departamentos\r\n  const { data: departments } = useQuery({\r\n    queryKey: ['clinic-departments', locationIds],\r\n    queryFn: () => {\r\n      if (!locationIds || locationIds.length === 0) return [];\r\n      return getClinicDepartments(locationIds);\r\n    },\r\n    enabled: !!locationIds && locationIds.length > 0,\r\n  });\r\n\r\n  // Obtener turnos activos\r\n  const {\r\n    data: activeShifts,\r\n    isLoading: loadingShifts,\r\n    refetch: refetchShifts,\r\n  } = useQuery({\r\n    queryKey: ['active-shifts', locationIds],\r\n    queryFn: async () => {\r\n      if (!locationIds || locationIds.length === 0) return [];\r\n      const shiftsPromises = locationIds.map((locId) => getActiveShifts(locId));\r\n      const shiftsArrays = await Promise.all(shiftsPromises);\r\n      return shiftsArrays.flat();\r\n    },\r\n    enabled: !!locationIds && locationIds.length > 0,\r\n  });\r\n\r\n  // Obtener métricas del día\r\n  const {\r\n    data: todayMetrics,\r\n    isLoading: loadingMetrics,\r\n    refetch: refetchMetrics,\r\n  } = useQuery({\r\n    queryKey: ['daily-metrics', locationIds],\r\n    queryFn: () => {\r\n      if (!locationIds || locationIds.length === 0) return null;\r\n      const today = new Date().toISOString().split('T')[0];\r\n      return getDailyMetricsSummary(locationIds, today);\r\n    },\r\n    enabled: !!locationIds && locationIds.length > 0,\r\n    refetchInterval: 60000, // Cada minuto\r\n  });\r\n\r\n  // Mutation: Actualizar estado de recurso\r\n  const updateResourceStatusMutation = useMutation({\r\n    mutationFn: ({\r\n      resourceId,\r\n      status,\r\n    }: {\r\n      resourceId: string;\r\n      status: ClinicResource['status'];\r\n    }) => updateResourceStatus(resourceId, status),\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['clinic-resources'] });\r\n    },\r\n  });\r\n\r\n  // Mutation: Crear turno\r\n  const createShiftMutation = useMutation({\r\n    mutationFn: createStaffShift,\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['active-shifts'] });\r\n      queryClient.invalidateQueries({ queryKey: ['staff-shifts'] });\r\n    },\r\n  });\r\n\r\n  // Mutation: Cancelar turno\r\n  const cancelShiftMutation = useMutation({\r\n    mutationFn: cancelStaffShift,\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['active-shifts'] });\r\n      queryClient.invalidateQueries({ queryKey: ['staff-shifts'] });\r\n    },\r\n  });\r\n\r\n  // Helpers\r\n  const getResourcesByType = (type: ClinicResource['type']) => {\r\n    return resources?.filter((r) => r.type === type) || [];\r\n  };\r\n\r\n  const getAvailableResourcesByType = (type: ClinicResource['type']) => {\r\n    return resources?.filter((r) => r.type === type && r.status === 'available') || [];\r\n  };\r\n\r\n  const getResourcesByDepartment = (department: string) => {\r\n    return resources?.filter((r) => r.department === department) || [];\r\n  };\r\n\r\n  const beds = getResourcesByType('bed');\r\n  const availableBeds = getAvailableResourcesByType('bed');\r\n  const operatingRooms = getResourcesByType('operating_room');\r\n  const availableOperatingRooms = getAvailableResourcesByType('operating_room');\r\n  const consultationRooms = getResourcesByType('consultation_room');\r\n  const availableConsultationRooms = getAvailableResourcesByType('consultation_room');\r\n\r\n  const bedOccupancyRate = beds.length > 0\r\n    ? ((beds.length - availableBeds.length) / beds.length) * 100\r\n    : 0;\r\n\r\n  return {\r\n    // Data\r\n    resources,\r\n    departments,\r\n    activeShifts,\r\n    todayMetrics,\r\n\r\n    // Resources by type\r\n    beds,\r\n    availableBeds,\r\n    operatingRooms,\r\n    availableOperatingRooms,\r\n    consultationRooms,\r\n    availableConsultationRooms,\r\n    bedOccupancyRate,\r\n\r\n    // Loading\r\n    isLoading: loadingResources || loadingShifts || loadingMetrics,\r\n    loadingResources,\r\n    loadingShifts,\r\n    loadingMetrics,\r\n\r\n    // Actions\r\n    updateResourceStatus: updateResourceStatusMutation.mutateAsync,\r\n    createShift: createShiftMutation.mutateAsync,\r\n    cancelShift: cancelShiftMutation.mutateAsync,\r\n\r\n    // Helpers\r\n    getResourcesByType,\r\n    getAvailableResourcesByType,\r\n    getResourcesByDepartment,\r\n\r\n    // Refetch\r\n    refetchResources,\r\n    refetchShifts,\r\n    refetchMetrics,\r\n    refresh: () => {\r\n      refetchResources();\r\n      refetchShifts();\r\n      refetchMetrics();\r\n    },\r\n  };\r\n}\r\n\r\nexport function useResourceSchedule(locationId: string, dateFrom: string, dateTo: string) {\r\n  const {\r\n    data: shifts,\r\n    isLoading,\r\n    refetch,\r\n  } = useQuery({\r\n    queryKey: ['staff-shifts', locationId, dateFrom, dateTo],\r\n    queryFn: () => getStaffShifts(locationId, dateFrom, dateTo),\r\n    enabled: !!locationId,\r\n  });\r\n\r\n  return {\r\n    shifts,\r\n    isLoading,\r\n    refetch,\r\n  };\r\n}\r\n\r\nexport function useOperationalMetrics(\r\n  locationId: string,\r\n  dateFrom: string,\r\n  dateTo: string\r\n) {\r\n  const {\r\n    data: metrics,\r\n    isLoading,\r\n    refetch,\r\n  } = useQuery({\r\n    queryKey: ['operational-metrics', locationId, dateFrom, dateTo],\r\n    queryFn: () => getOperationalMetrics(locationId, dateFrom, dateTo),\r\n    enabled: !!locationId,\r\n  });\r\n\r\n  // Calcular promedios\r\n  const averages = metrics\r\n    ? {\r\n        avgAppointments:\r\n          metrics.reduce((sum, m) => sum + m.total_appointments, 0) / metrics.length,\r\n        avgCompletionRate:\r\n          metrics.reduce(\r\n            (sum, m) =>\r\n              sum +\r\n              (m.total_appointments > 0\r\n                ? (m.completed_appointments / m.total_appointments) * 100\r\n                : 0),\r\n            0\r\n          ) / metrics.length,\r\n        avgOccupancy:\r\n          metrics.reduce((sum, m) => sum + (m.occupancy_rate || 0), 0) / metrics.length,\r\n        totalRevenue: metrics.reduce((sum, m) => sum + m.revenue_amount, 0),\r\n        totalPatients: metrics.reduce((sum, m) => sum + m.patient_count, 0),\r\n      }\r\n    : null;\r\n\r\n  return {\r\n    metrics,\r\n    averages,\r\n    isLoading,\r\n    refetch,\r\n  };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-clinic-overview.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useMutation' is defined but never used.","line":9,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Clinic' is defined but never used.","line":18,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ClinicOverviewStats' is defined but never used.","line":18,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":58},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ClinicAlert' is defined but never used.","line":18,"column":60,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":71},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'loadingRoles' is assigned a value but never used.","line":36,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Hook para gestión del overview/panel principal de clínica\r\n * \r\n * Orquesta datos de stats, alertas y métricas principales\r\n */\r\n\r\n'use client';\r\n\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\r\nimport {\r\n  getUserClinics,\r\n  getClinicById,\r\n  getClinicLocations,\r\n  getClinicOverviewStats,\r\n  getUserClinicRoles,\r\n} from '@/lib/supabase/services/clinics-service';\r\nimport { generateOperationalAlerts } from '@/lib/supabase/services/clinic-operations-service';\r\nimport type { Clinic, ClinicLocation, ClinicOverviewStats, ClinicAlert } from '@/lib/types/clinic.types';\r\n\r\nexport function useClinicOverview(clinicId?: string, locationIds?: string[]) {\r\n  const queryClient = useQueryClient();\r\n\r\n  // Obtener clínicas del usuario\r\n  const {\r\n    data: clinics,\r\n    isLoading: loadingClinics,\r\n    error: clinicsError,\r\n  } = useQuery({\r\n    queryKey: ['user-clinics'],\r\n    queryFn: getUserClinics,\r\n  });\r\n\r\n  // Obtener roles del usuario\r\n  const {\r\n    data: userRoles,\r\n    isLoading: loadingRoles,\r\n  } = useQuery({\r\n    queryKey: ['user-clinic-roles'],\r\n    queryFn: getUserClinicRoles,\r\n  });\r\n\r\n  // Obtener clínica actual\r\n  const {\r\n    data: currentClinic,\r\n    isLoading: loadingClinic,\r\n    error: clinicError,\r\n  } = useQuery({\r\n    queryKey: ['clinic', clinicId],\r\n    queryFn: () => (clinicId ? getClinicById(clinicId) : null),\r\n    enabled: !!clinicId,\r\n  });\r\n\r\n  // Obtener sedes de la clínica\r\n  const {\r\n    data: locations,\r\n    isLoading: loadingLocations,\r\n    error: locationsError,\r\n  } = useQuery({\r\n    queryKey: ['clinic-locations', clinicId],\r\n    queryFn: () => (clinicId ? getClinicLocations(clinicId) : []),\r\n    enabled: !!clinicId,\r\n  });\r\n\r\n  // Obtener estadísticas generales\r\n  const {\r\n    data: stats,\r\n    isLoading: loadingStats,\r\n    error: statsError,\r\n    refetch: refetchStats,\r\n  } = useQuery({\r\n    queryKey: ['clinic-overview-stats', clinicId, locationIds],\r\n    queryFn: () =>\r\n      clinicId ? getClinicOverviewStats(clinicId, locationIds) : null,\r\n    enabled: !!clinicId,\r\n    refetchInterval: 60000, // Refrescar cada minuto\r\n  });\r\n\r\n  // Obtener alertas operacionales\r\n  const {\r\n    data: alerts,\r\n    isLoading: loadingAlerts,\r\n    refetch: refetchAlerts,\r\n  } = useQuery({\r\n    queryKey: ['clinic-alerts', clinicId, locationIds],\r\n    queryFn: () => {\r\n      if (!clinicId || !locationIds || locationIds.length === 0) return [];\r\n      return generateOperationalAlerts(clinicId, locationIds);\r\n    },\r\n    enabled: !!clinicId && !!locationIds && locationIds.length > 0,\r\n    refetchInterval: 120000, // Refrescar cada 2 minutos\r\n  });\r\n\r\n  // Helpers\r\n  const getActiveLocation = (locationId?: string): ClinicLocation | undefined => {\r\n    if (!locations) return undefined;\r\n    if (locationId) {\r\n      return locations.find((l) => l.id === locationId);\r\n    }\r\n    return locations.find((l) => l.is_main) || locations[0];\r\n  };\r\n\r\n  const hasRole = (roles: string[]): boolean => {\r\n    if (!userRoles || !clinicId) return false;\r\n    return userRoles.some(\r\n      (ur) => ur.clinic_id === clinicId && roles.includes(ur.role)\r\n    );\r\n  };\r\n\r\n  const canManageFinance = () => hasRole(['owner', 'admin', 'finance']);\r\n  const canManageOperations = () => hasRole(['owner', 'admin', 'manager', 'operations']);\r\n  const canViewReports = () => hasRole(['owner', 'admin', 'finance', 'manager', 'auditor']);\r\n\r\n  const criticalAlerts = alerts?.filter((a) => a.severity === 'critical') || [];\r\n  const warningAlerts = alerts?.filter((a) => a.severity === 'warning') || [];\r\n\r\n  return {\r\n    // Data\r\n    clinics,\r\n    currentClinic,\r\n    locations,\r\n    stats,\r\n    alerts,\r\n    userRoles,\r\n\r\n    // Loading states\r\n    isLoading: loadingClinics || loadingClinic || loadingLocations || loadingStats,\r\n    loadingClinics,\r\n    loadingClinic,\r\n    loadingLocations,\r\n    loadingStats,\r\n    loadingAlerts,\r\n\r\n    // Errors\r\n    error: clinicsError || clinicError || locationsError || statsError,\r\n\r\n    // Helpers\r\n    getActiveLocation,\r\n    hasRole,\r\n    canManageFinance,\r\n    canManageOperations,\r\n    canViewReports,\r\n    criticalAlerts,\r\n    warningAlerts,\r\n\r\n    // Actions\r\n    refetchStats,\r\n    refetchAlerts,\r\n    refresh: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['clinic-overview-stats'] });\r\n      queryClient.invalidateQueries({ queryKey: ['clinic-alerts'] });\r\n    },\r\n  };\r\n}\r\n\r\nexport function useClinicSelector() {\r\n  const { clinics, userRoles } = useClinicOverview();\r\n\r\n  const getClinicsByRole = (role: string) => {\r\n    if (!clinics || !userRoles) return [];\r\n    const clinicIds = userRoles\r\n      .filter((ur) => ur.role === role)\r\n      .map((ur) => ur.clinic_id);\r\n    return clinics.filter((c) => clinicIds.includes(c.id));\r\n  };\r\n\r\n  const getOwnedClinics = () => getClinicsByRole('owner');\r\n  const getManagedClinics = () => getClinicsByRole('manager');\r\n\r\n  return {\r\n    clinics,\r\n    userRoles,\r\n    getClinicsByRole,\r\n    getOwnedClinics,\r\n    getManagedClinics,\r\n  };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-clinic-rcm.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getPayerContracts' is defined but never used.","line":24,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CreateClaimInput' is defined but never used.","line":32,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'RegisterPaymentInput' is defined but never used.","line":33,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'locationIds' is defined but never used.","line":38,"column":49,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":60}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Hook para gestión del Revenue Cycle Management (RCM)\r\n * \r\n * Orquesta claims, pagos, KPIs financieros y conciliación\r\n */\r\n\r\n'use client';\r\n\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\r\nimport {\r\n  getClaims,\r\n  getClaimById,\r\n  createClaim,\r\n  updateClaim,\r\n  submitClaim,\r\n  approveClaim,\r\n  denyClaim,\r\n  getClaimItems,\r\n  addClaimItem,\r\n  getClaimPayments,\r\n  registerPayment,\r\n  reconcilePayment,\r\n  getUnreconciledPayments,\r\n  getPayerContracts,\r\n  getActivePayerContracts,\r\n  getFinancialKPIs,\r\n  calculateDSO,\r\n  getAgingClaims,\r\n} from '@/lib/supabase/services/clinic-rcm-service';\r\nimport type {\r\n  ClaimFilters,\r\n  CreateClaimInput,\r\n  RegisterPaymentInput,\r\n  RCMClaimItem,\r\n  ClaimSummary,\r\n} from '@/lib/types/clinic.types';\r\n\r\nexport function useClinicRCM(clinicId?: string, locationIds?: string[]) {\r\n  const queryClient = useQueryClient();\r\n\r\n  // Obtener contratos activos\r\n  const {\r\n    data: payerContracts,\r\n    isLoading: loadingContracts,\r\n  } = useQuery({\r\n    queryKey: ['payer-contracts', clinicId],\r\n    queryFn: () => (clinicId ? getActivePayerContracts(clinicId) : []),\r\n    enabled: !!clinicId,\r\n  });\r\n\r\n  // Obtener KPIs financieros\r\n  const {\r\n    data: financialKPIs,\r\n    isLoading: loadingKPIs,\r\n    refetch: refetchKPIs,\r\n  } = useQuery({\r\n    queryKey: ['financial-kpis', clinicId],\r\n    queryFn: () => (clinicId ? getFinancialKPIs(clinicId, 6) : []),\r\n    enabled: !!clinicId,\r\n  });\r\n\r\n  // Calcular DSO\r\n  const {\r\n    data: dso,\r\n    isLoading: loadingDSO,\r\n  } = useQuery({\r\n    queryKey: ['dso', clinicId],\r\n    queryFn: () => (clinicId ? calculateDSO(clinicId, 90) : 0),\r\n    enabled: !!clinicId,\r\n  });\r\n\r\n  // Obtener pagos sin conciliar\r\n  const {\r\n    data: unreconciledPayments,\r\n    isLoading: loadingUnreconciled,\r\n    refetch: refetchUnreconciled,\r\n  } = useQuery({\r\n    queryKey: ['unreconciled-payments', clinicId],\r\n    queryFn: () => (clinicId ? getUnreconciledPayments(clinicId) : []),\r\n    enabled: !!clinicId,\r\n  });\r\n\r\n  // Obtener claims próximos a vencer\r\n  const {\r\n    data: agingClaims,\r\n    isLoading: loadingAging,\r\n  } = useQuery({\r\n    queryKey: ['aging-claims', clinicId],\r\n    queryFn: () => (clinicId ? getAgingClaims(clinicId, 30) : []),\r\n    enabled: !!clinicId,\r\n  });\r\n\r\n  // Mutation: Crear claim\r\n  const createClaimMutation = useMutation({\r\n    mutationFn: createClaim,\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['claims'] });\r\n      queryClient.invalidateQueries({ queryKey: ['financial-kpis'] });\r\n    },\r\n  });\r\n\r\n  // Mutation: Actualizar claim\r\n  const updateClaimMutation = useMutation({\r\n    mutationFn: ({ claimId, updates }: { claimId: string; updates: Partial<ClaimSummary> }) =>\r\n      updateClaim(claimId, updates),\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['claims'] });\r\n      queryClient.invalidateQueries({ queryKey: ['claim'] });\r\n    },\r\n  });\r\n\r\n  // Mutation: Enviar claim\r\n  const submitClaimMutation = useMutation({\r\n    mutationFn: submitClaim,\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['claims'] });\r\n      queryClient.invalidateQueries({ queryKey: ['claim'] });\r\n    },\r\n  });\r\n\r\n  // Mutation: Aprobar claim\r\n  const approveClaimMutation = useMutation({\r\n    mutationFn: ({ claimId, amount }: { claimId: string; amount: number }) =>\r\n      approveClaim(claimId, amount),\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['claims'] });\r\n      queryClient.invalidateQueries({ queryKey: ['claim'] });\r\n    },\r\n  });\r\n\r\n  // Mutation: Denegar claim\r\n  const denyClaimMutation = useMutation({\r\n    mutationFn: ({\r\n      claimId,\r\n      reason,\r\n      code,\r\n    }: {\r\n      claimId: string;\r\n      reason: string;\r\n      code?: string;\r\n    }) => denyClaim(claimId, reason, code),\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['claims'] });\r\n      queryClient.invalidateQueries({ queryKey: ['claim'] });\r\n    },\r\n  });\r\n\r\n  // Mutation: Registrar pago\r\n  const registerPaymentMutation = useMutation({\r\n    mutationFn: registerPayment,\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['claim-payments'] });\r\n      queryClient.invalidateQueries({ queryKey: ['claims'] });\r\n      queryClient.invalidateQueries({ queryKey: ['unreconciled-payments'] });\r\n      queryClient.invalidateQueries({ queryKey: ['financial-kpis'] });\r\n      queryClient.invalidateQueries({ queryKey: ['dso'] });\r\n    },\r\n  });\r\n\r\n  // Mutation: Conciliar pago\r\n  const reconcilePaymentMutation = useMutation({\r\n    mutationFn: ({ paymentId, userId }: { paymentId: string; userId: string }) =>\r\n      reconcilePayment(paymentId, userId),\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['unreconciled-payments'] });\r\n      queryClient.invalidateQueries({ queryKey: ['claim-payments'] });\r\n    },\r\n  });\r\n\r\n  return {\r\n    // Data\r\n    payerContracts,\r\n    financialKPIs,\r\n    dso,\r\n    unreconciledPayments,\r\n    agingClaims,\r\n\r\n    // Loading\r\n    isLoading: loadingContracts || loadingKPIs || loadingDSO,\r\n    loadingContracts,\r\n    loadingKPIs,\r\n    loadingDSO,\r\n    loadingUnreconciled,\r\n    loadingAging,\r\n\r\n    // Actions\r\n    createClaim: createClaimMutation.mutateAsync,\r\n    updateClaim: updateClaimMutation.mutateAsync,\r\n    submitClaim: submitClaimMutation.mutateAsync,\r\n    approveClaim: approveClaimMutation.mutateAsync,\r\n    denyClaim: denyClaimMutation.mutateAsync,\r\n    registerPayment: registerPaymentMutation.mutateAsync,\r\n    reconcilePayment: reconcilePaymentMutation.mutateAsync,\r\n\r\n    // Refetch\r\n    refetchKPIs,\r\n    refetchUnreconciled,\r\n\r\n    // Mutation states\r\n    isCreatingClaim: createClaimMutation.isPending,\r\n    isUpdatingClaim: updateClaimMutation.isPending,\r\n    isSubmittingClaim: submitClaimMutation.isPending,\r\n    isRegisteringPayment: registerPaymentMutation.isPending,\r\n  };\r\n}\r\n\r\nexport function useClaimDetails(claimId?: string) {\r\n  const queryClient = useQueryClient();\r\n\r\n  const {\r\n    data: claim,\r\n    isLoading: loadingClaim,\r\n    error,\r\n  } = useQuery({\r\n    queryKey: ['claim', claimId],\r\n    queryFn: () => (claimId ? getClaimById(claimId) : null),\r\n    enabled: !!claimId,\r\n  });\r\n\r\n  const {\r\n    data: items,\r\n    isLoading: loadingItems,\r\n  } = useQuery({\r\n    queryKey: ['claim-items', claimId],\r\n    queryFn: () => (claimId ? getClaimItems(claimId) : []),\r\n    enabled: !!claimId,\r\n  });\r\n\r\n  const {\r\n    data: payments,\r\n    isLoading: loadingPayments,\r\n  } = useQuery({\r\n    queryKey: ['claim-payments', claimId],\r\n    queryFn: () => (claimId ? getClaimPayments(claimId) : []),\r\n    enabled: !!claimId,\r\n  });\r\n\r\n  const addItemMutation = useMutation({\r\n    mutationFn: (item: Omit<RCMClaimItem, 'id' | 'claim_id' | 'line_number' | 'created_at' | 'updated_at'>) =>\r\n      claimId ? addClaimItem(claimId, item) : Promise.reject('No claim ID'),\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['claim-items', claimId] });\r\n      queryClient.invalidateQueries({ queryKey: ['claim', claimId] });\r\n    },\r\n  });\r\n\r\n  const totalAmount = items?.reduce((sum, item) => sum + item.total_price, 0) || 0;\r\n  const paidAmount = payments?.reduce((sum, payment) => sum + payment.amount, 0) || 0;\r\n  const balanceDue = totalAmount - paidAmount;\r\n\r\n  return {\r\n    claim,\r\n    items,\r\n    payments,\r\n    totalAmount,\r\n    paidAmount,\r\n    balanceDue,\r\n    isLoading: loadingClaim || loadingItems || loadingPayments,\r\n    error,\r\n    addItem: addItemMutation.mutateAsync,\r\n    isAddingItem: addItemMutation.isPending,\r\n  };\r\n}\r\n\r\nexport function useClaimsList(filters: ClaimFilters) {\r\n  const {\r\n    data: claims,\r\n    isLoading,\r\n    error,\r\n    refetch,\r\n  } = useQuery({\r\n    queryKey: ['claims', filters],\r\n    queryFn: () => getClaims(filters),\r\n    enabled: !!(filters.clinic_ids && filters.clinic_ids.length > 0),\r\n  });\r\n\r\n  return {\r\n    claims,\r\n    isLoading,\r\n    error,\r\n    refetch,\r\n  };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-clinic-resources.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ClinicArea' is defined but never used.","line":13,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":206,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":206,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file useClinicResources.ts\r\n * @description Hook personalizado para gestión de recursos clínicos con react-query\r\n * @module hooks\r\n * \r\n * Proporciona operaciones CRUD sobre recursos, áreas, asignaciones y filtros\r\n */\r\n\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\r\nimport { createClient } from '@/lib/supabase/client';\r\nimport type {\r\n    ResourceWithPosition,\r\n    ClinicArea,\r\n    AreaWithResources,\r\n    ResourceAssignment,\r\n    CreateResourceInput,\r\n    CreateAreaInput,\r\n    AssignResourceInput,\r\n} from '@/lib/types/clinic.types';\r\n\r\nconst supabase = createClient();\r\n\r\n/**\r\n * Hook para obtener recursos de una sede con datos espaciales\r\n * \r\n * @param locationId - ID de la sede\r\n * @param floor - Piso opcional para filtrar\r\n * @returns Query con recursos y datos espaciales\r\n */\r\nexport function useClinicResources(locationId: string, floor?: number) {\r\n    return useQuery({\r\n        queryKey: ['clinic-resources', locationId, floor],\r\n        queryFn: async (): Promise<ResourceWithPosition[]> => {\r\n            let query = supabase\r\n                .from('clinic_resources')\r\n                .select(`\r\n          *,\r\n          area:area_id (*)\r\n        `)\r\n                .eq('location_id', locationId);\r\n\r\n            if (floor !== undefined) {\r\n                query = query.eq('floor', floor);\r\n            }\r\n\r\n            const { data, error } = await query.order('name');\r\n\r\n            if (error) throw error;\r\n            return (data || []) as ResourceWithPosition[];\r\n        },\r\n        enabled: !!locationId,\r\n    });\r\n}\r\n\r\n/**\r\n * Hook para obtener áreas con sus recursos\r\n * \r\n * @param locationId - ID de la sede\r\n * @param floor - Piso opcional para filtrar\r\n * @returns Query con áreas y sus recursos\r\n */\r\nexport function useClinicAreas(locationId: string, floor?: number) {\r\n    return useQuery({\r\n        queryKey: ['clinic-areas', locationId, floor],\r\n        queryFn: async (): Promise<AreaWithResources[]> => {\r\n            let query = supabase\r\n                .from('clinic_areas')\r\n                .select(`\r\n          *,\r\n          resources:clinic_resources(*)\r\n        `)\r\n                .eq('location_id', locationId);\r\n\r\n            if (floor !== undefined) {\r\n                query = query.eq('floor', floor);\r\n            }\r\n\r\n            const { data, error } = await query.order('floor').order('name');\r\n\r\n            if (error) throw error;\r\n\r\n            // Calcular contadores\r\n            return (data || []).map((area: { resources?: Array<{ status?: string }> }) => ({\r\n                ...area,\r\n                resource_count: area.resources?.length || 0,\r\n                occupied_count: area.resources?.filter((r) => r.status === 'occupied').length || 0,\r\n            })) as AreaWithResources[];\r\n        },\r\n        enabled: !!locationId,\r\n    });\r\n}\r\n\r\n/**\r\n * Hook para obtener asignaciones activas de recursos\r\n */\r\nexport function useResourceAssignments(resourceIds?: string[]) {\r\n    return useQuery({\r\n        queryKey: ['resource-assignments', resourceIds],\r\n        queryFn: async (): Promise<ResourceAssignment[]> => {\r\n            let query = supabase\r\n                .from('resource_assignments')\r\n                .select('*')\r\n                .eq('status', 'active');\r\n\r\n            if (resourceIds && resourceIds.length > 0) {\r\n                query = query.in('resource_id', resourceIds);\r\n            }\r\n\r\n            const { data, error } = await query;\r\n\r\n            if (error) throw error;\r\n            return data || [];\r\n        },\r\n        enabled: !resourceIds || resourceIds.length > 0,\r\n    });\r\n}\r\n\r\n/**\r\n * Mutation para crear un nuevo recurso\r\n */\r\nexport function useCreateResource() {\r\n    const queryClient = useQueryClient();\r\n\r\n    return useMutation({\r\n        mutationFn: async (input: CreateResourceInput) => {\r\n            const { data, error } = await supabase\r\n                .from('clinic_resources')\r\n                .insert(input)\r\n                .select()\r\n                .single();\r\n\r\n            if (error) throw error;\r\n            return data;\r\n        },\r\n        onSuccess: (data) => {\r\n            // Invalidar queries relacionadas\r\n            queryClient.invalidateQueries({ queryKey: ['clinic-resources', data.location_id] });\r\n            if (data.area_id) {\r\n                queryClient.invalidateQueries({ queryKey: ['clinic-areas', data.location_id] });\r\n            }\r\n        },\r\n    });\r\n}\r\n\r\n/**\r\n * Mutation para actualizar posición de recurso (drag & drop)\r\n */\r\nexport function useUpdateResourcePosition() {\r\n    const queryClient = useQueryClient();\r\n\r\n    return useMutation({\r\n        mutationFn: async ({\r\n            resourceId,\r\n            position_x,\r\n            position_y,\r\n            area_id,\r\n        }: {\r\n            resourceId: string;\r\n            position_x: number;\r\n            position_y: number;\r\n            area_id?: string;\r\n        }) => {\r\n            const { data, error } = await supabase\r\n                .from('clinic_resources')\r\n                .update({ position_x, position_y, area_id })\r\n                .eq('id', resourceId)\r\n                .select()\r\n                .single();\r\n\r\n            if (error) throw error;\r\n            return data;\r\n        },\r\n        onSuccess: (data) => {\r\n            queryClient.invalidateQueries({ queryKey: ['clinic-resources', data.location_id] });\r\n            queryClient.invalidateQueries({ queryKey: ['clinic-areas', data.location_id] });\r\n        },\r\n    });\r\n}\r\n\r\n/**\r\n * Mutation para cambiar estado de recurso\r\n */\r\nexport function useUpdateResourceStatus() {\r\n    const queryClient = useQueryClient();\r\n\r\n    return useMutation({\r\n        mutationFn: async ({\r\n            resourceId,\r\n            status,\r\n            notes,\r\n        }: {\r\n            resourceId: string;\r\n            status: string;\r\n            notes?: string;\r\n        }) => {\r\n            const { data, error } = await supabase\r\n                .from('clinic_resources')\r\n                .update({ status, notes })\r\n                .eq('id', resourceId)\r\n                .select()\r\n                .single();\r\n\r\n            if (error) throw error;\r\n            return data;\r\n        },\r\n        onSuccess: (data) => {\r\n            queryClient.invalidateQueries({ queryKey: ['clinic-resources'] });\r\n        },\r\n    });\r\n}\r\n\r\n/**\r\n * Mutation para asignar paciente a recurso\r\n */\r\nexport function useAssignResource() {\r\n    const queryClient = useQueryClient();\r\n\r\n    return useMutation({\r\n        mutationFn: async (input: AssignResourceInput) => {\r\n            const { data, error } = await supabase\r\n                .from('resource_assignments')\r\n                .insert(input)\r\n                .select()\r\n                .single();\r\n\r\n            if (error) throw error;\r\n            return data;\r\n        },\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: ['clinic-resources'] });\r\n            queryClient.invalidateQueries({ queryKey: ['resource-assignments'] });\r\n        },\r\n    });\r\n}\r\n\r\n/**\r\n * Mutation para dar de alta paciente (discharge)\r\n */\r\nexport function useDischargeResource() {\r\n    const queryClient = useQueryClient();\r\n\r\n    return useMutation({\r\n        mutationFn: async ({\r\n            assignmentId,\r\n            discharge_notes,\r\n        }: {\r\n            assignmentId: string;\r\n            discharge_notes?: string;\r\n        }) => {\r\n            const { data, error } = await supabase\r\n                .from('resource_assignments')\r\n                .update({\r\n                    status: 'discharged',\r\n                    discharge_date: new Date().toISOString(),\r\n                    discharge_notes,\r\n                })\r\n                .eq('id', assignmentId)\r\n                .select()\r\n                .single();\r\n\r\n            if (error) throw error;\r\n            return data;\r\n        },\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: ['clinic-resources'] });\r\n            queryClient.invalidateQueries({ queryKey: ['resource-assignments'] });\r\n        },\r\n    });\r\n}\r\n\r\n/**\r\n * Mutation para crear área\r\n */\r\nexport function useCreateArea() {\r\n    const queryClient = useQueryClient();\r\n\r\n    return useMutation({\r\n        mutationFn: async (input: CreateAreaInput) => {\r\n            const { data, error } = await supabase\r\n                .from('clinic_areas')\r\n                .insert(input)\r\n                .select()\r\n                .single();\r\n\r\n            if (error) throw error;\r\n            return data;\r\n        },\r\n        onSuccess: (data) => {\r\n            queryClient.invalidateQueries({ queryKey: ['clinic-areas', data.location_id] });\r\n        },\r\n    });\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-current-office.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadCurrentOffice'. Either include it or remove the dependency array.","line":32,"column":8,"nodeType":"ArrayExpression","endLine":32,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [loadCurrentOffice]","fix":{"range":[815,817],"text":"[loadCurrentOffice]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file use-current-office.ts\r\n * @description Hook para gestionar el consultorio actual del médico.\r\n * @module Hooks\r\n */\r\n\r\n\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\n\r\n/** Interfaz para consultorio */\r\ninterface Office {\r\n    id: string;\r\n    nombre: string;\r\n    direccion?: string;\r\n    ciudad?: string;\r\n    estado?: string;\r\n    es_principal: boolean;\r\n}\r\n\r\n/**\r\n * Hook para obtener y actualizar el consultorio actual del médico\r\n */\r\nexport function useCurrentOffice() {\r\n    const [currentOffice, setCurrentOffice] = useState<Office | null>(null);\r\n    const [allOffices, setAllOffices] = useState<Office[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        loadCurrentOffice();\r\n    }, []);\r\n\r\n    /**\r\n     * Carga el consultorio actual del médico\r\n     */\r\n    const loadCurrentOffice = async () => {\r\n        try {\r\n            const { data: { user } } = await supabase.auth.getUser();\r\n            if (!user) return;\r\n\r\n            // Cargar todos los consultorios activos\r\n            const { data: offices, error: officesError } = await supabase\r\n                .from(\"doctor_offices\")\r\n                .select(\"id, nombre, direccion, ciudad, estado, es_principal\")\r\n                .eq(\"doctor_id\", user.id)\r\n                .eq(\"activo\", true)\r\n                .order(\"es_principal\", { ascending: false });\r\n\r\n            if (officesError) throw officesError;\r\n\r\n            setAllOffices(offices || []);\r\n\r\n            if (!offices || offices.length === 0) {\r\n                setLoading(false);\r\n                return;\r\n            }\r\n\r\n            // Intentar cargar preferencia guardada\r\n            const { data: preference } = await supabase\r\n                .from(\"doctor_preferences\")\r\n                .select(\"current_office_id\")\r\n                .eq(\"doctor_id\", user.id)\r\n                .single();\r\n\r\n            // Si hay preferencia, buscar ese consultorio\r\n            if (preference?.current_office_id) {\r\n                const office = offices.find(o => o.id === preference.current_office_id);\r\n                if (office) {\r\n                    setCurrentOffice(office);\r\n                    setLoading(false);\r\n                    return;\r\n                }\r\n            }\r\n\r\n            // Si no hay preferencia o el consultorio no existe, usar el principal o el primero\r\n            const defaultOffice = offices.find(o => o.es_principal) || offices[0];\r\n            setCurrentOffice(defaultOffice);\r\n\r\n            // Guardar preferencia si no existe\r\n            await updateCurrentOffice(defaultOffice.id);\r\n\r\n        } catch (error) {\r\n            console.error(\"[useCurrentOffice] Error:\", error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Actualiza el consultorio actual\r\n     */\r\n    const updateCurrentOffice = async (officeId: string) => {\r\n        try {\r\n            const { data: { user } } = await supabase.auth.getUser();\r\n            if (!user) return;\r\n\r\n            // Actualizar en base de datos\r\n            await supabase\r\n                .from(\"doctor_preferences\")\r\n                .upsert({\r\n                    doctor_id: user.id,\r\n                    current_office_id: officeId,\r\n                });\r\n\r\n            // Actualizar estado local\r\n            const office = allOffices.find(o => o.id === officeId);\r\n            if (office) {\r\n                setCurrentOffice(office);\r\n            }\r\n        } catch (error) {\r\n            console.error(\"[useCurrentOffice] Error updating:\", error);\r\n        }\r\n    };\r\n\r\n    return {\r\n        currentOffice,\r\n        allOffices,\r\n        loading,\r\n        updateCurrentOffice,\r\n        refresh: loadCurrentOffice,\r\n    };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-dashboard-data.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'formatTime' is defined but never used.","line":131,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":131,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":153,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":153,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4836,4839],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4836,4839],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":267,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":267,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10217,10220],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10217,10220],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\n/**\r\n * @file use-dashboard-data.ts\r\n * @description Hook principal para obtener datos reales del dashboard del médico.\r\n * Centraliza todas las queries y suscripciones de tiempo real para los widgets.\r\n *\r\n * @module Dashboard\r\n *\r\n * @example\r\n * const { appointments, messages, notifications, stats, isLoading } = useDashboardData(doctorId);\r\n */\r\n\r\nimport type { Appointment } from '@/lib/supabase/types/appointments';\r\n\r\nimport { useState, useEffect, useCallback, useMemo } from \"react\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport { getDoctorAppointments } from \"@/lib/supabase/services/appointments/appointments.queries\";\r\nimport { getUserConversations, getUnreadMessagesCount } from \"@/lib/supabase/services/messaging-service\";\r\nimport {\r\n    getNotifications,\r\n    getUnreadNotificationsCount,\r\n    getTasks,\r\n    subscribeToNotifications,\r\n} from \"@/lib/supabase/services/dashboard-preferences-service\";\r\nimport type { DoctorNotification, DoctorTask } from \"@/lib/types/dashboard-types\";\r\n\r\n// ============================================================================\r\n// TIPOS\r\n// ============================================================================\r\n\r\n/** Cita del día para el widget timeline */\r\nexport interface TodayAppointment {\r\n    id: string;\r\n    time: string;\r\n    patient: string;\r\n    patientId: string;\r\n    patientAvatar?: string;\r\n    type: \"presencial\" | \"telemedicina\";\r\n    status: \"pending\" | \"in-progress\" | \"completed\" | \"cancelled\";\r\n    duration: number;\r\n    motivo?: string;\r\n}\r\n\r\n/** Mensaje/conversación reciente */\r\nexport interface RecentConversation {\r\n    id: string;\r\n    patientName: string;\r\n    patientAvatar?: string;\r\n    lastMessage: string;\r\n    lastMessageTime: string;\r\n    unreadCount: number;\r\n}\r\n\r\n/** Estadísticas del dashboard */\r\nexport interface DashboardStats {\r\n    todayAppointments: number;\r\n    weekAppointments: number;\r\n    totalPatients: number;\r\n    completedAppointments: number;\r\n    cancelledAppointments: number;\r\n    pendingAppointments: number;\r\n    averageRating: number;\r\n    unreadMessages: number;\r\n    unreadNotifications: number;\r\n    pendingTasks: number;\r\n}\r\n\r\n/** Datos completos del dashboard */\r\nexport interface DashboardData {\r\n    /** Citas crudas */\r\n    appointments: Appointment[];\r\n    /** Citas del día */\r\n    todayAppointments: TodayAppointment[];\r\n    /** Citas de la semana */\r\n    weekAppointments: TodayAppointment[];\r\n    /** Conversaciones recientes */\r\n    conversations: RecentConversation[];\r\n    /** Notificaciones */\r\n    notifications: DoctorNotification[];\r\n    /** Tareas */\r\n    tasks: DoctorTask[];\r\n    /** Estadísticas */\r\n    stats: DashboardStats;\r\n    /** Estado de carga */\r\n    isLoading: boolean;\r\n    /** Error si existe */\r\n    error: string | null;\r\n    /** Refrescar todos los datos */\r\n    refresh: () => Promise<void>;\r\n    /** Refrescar solo citas */\r\n    refreshAppointments: () => Promise<void>;\r\n    /** Refrescar solo notificaciones */\r\n    refreshNotifications: () => Promise<void>;\r\n}\r\n\r\n// ============================================================================\r\n// HELPERS\r\n// ============================================================================\r\n\r\n/**\r\n * Obtiene el inicio y fin del día actual.\r\n */\r\nfunction getTodayRange(): { start: Date; end: Date } {\r\n    const now = new Date();\r\n    const start = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0, 0, 0);\r\n    const end = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59);\r\n    return { start, end };\r\n}\r\n\r\n/**\r\n * Obtiene el rango de la semana actual.\r\n */\r\nfunction getWeekRange(): { start: Date; end: Date } {\r\n    const now = new Date();\r\n    const dayOfWeek = now.getDay();\r\n    const start = new Date(now);\r\n    start.setDate(now.getDate() - dayOfWeek);\r\n    start.setHours(0, 0, 0, 0);\r\n\r\n    const end = new Date(start);\r\n    end.setDate(start.getDate() + 6);\r\n    end.setHours(23, 59, 59, 999);\r\n\r\n    return { start, end };\r\n}\r\n\r\n/**\r\n * Formatea hora de una fecha ISO.\r\n */\r\nfunction formatTime(isoDate: string): string {\r\n    const date = new Date(isoDate);\r\n    return date.toLocaleTimeString(\"es-VE\", {\r\n        hour: \"2-digit\",\r\n        minute: \"2-digit\",\r\n        hour12: false,\r\n    });\r\n}\r\n\r\n// ============================================================================\r\n// HOOK PRINCIPAL\r\n// ============================================================================\r\n\r\n/**\r\n * Hook para obtener todos los datos del dashboard del médico.\r\n * Incluye suscripciones de tiempo real para notificaciones.\r\n * \r\n * @param doctorId - UUID del médico\r\n * @returns Datos del dashboard\r\n */\r\nexport function useDashboardData(doctorId: string | undefined): DashboardData {\r\n    // Estados\r\n    const [appointments, setAppointments] = useState<any[]>([]); // Raw appointments\r\n    const [todayAppointments, setTodayAppointments] = useState<TodayAppointment[]>([]);\r\n    const [weekAppointments, setWeekAppointments] = useState<TodayAppointment[]>([]);\r\n    const [conversations, setConversations] = useState<RecentConversation[]>([]);\r\n    const [notifications, setNotifications] = useState<DoctorNotification[]>([]);\r\n    const [tasks, setTasks] = useState<DoctorTask[]>([]);\r\n    const [stats, setStats] = useState<DashboardStats>({\r\n        todayAppointments: 0,\r\n        weekAppointments: 0,\r\n        totalPatients: 0,\r\n        completedAppointments: 0,\r\n        cancelledAppointments: 0,\r\n        pendingAppointments: 0,\r\n        averageRating: 0,\r\n        unreadMessages: 0,\r\n        unreadNotifications: 0,\r\n        pendingTasks: 0,\r\n    });\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    // =========================================================================\r\n    // FUNCIONES DE CARGA\r\n    // =========================================================================\r\n\r\n    /**\r\n     * Carga las citas del médico.\r\n     */\r\n    const loadAppointments = useCallback(async () => {\r\n        if (!doctorId) return;\r\n\r\n        try {\r\n            const result = await getDoctorAppointments(doctorId);\r\n\r\n            if (result.success && result.data) {\r\n                const allAppointments = result.data;\r\n                setAppointments(allAppointments); // Store raw appointments\r\n\r\n                const { start: todayStart, end: todayEnd } = getTodayRange();\r\n                const { start: weekStart, end: weekEnd } = getWeekRange();\r\n\r\n                // Helper para obtener fecha completa de una cita\r\n                const getAppointmentDate = (apt: typeof allAppointments[0]) => {\r\n                    return new Date(`${apt.appointment_date}T${apt.appointment_time}`);\r\n                };\r\n\r\n                // Filtrar citas del día\r\n                const today = allAppointments\r\n                    .filter((apt) => {\r\n                        const aptDate = getAppointmentDate(apt);\r\n                        return aptDate >= todayStart && aptDate <= todayEnd;\r\n                    })\r\n                    .map((apt) => ({\r\n                        id: apt.id,\r\n                        time: apt.appointment_time.slice(0, 5), // HH:mm\r\n                        patient: apt.patient?.nombre_completo || \"Paciente\",\r\n                        patientId: apt.patient_id,\r\n                        patientAvatar: apt.patient?.avatar_url || undefined,\r\n                        type: (apt.consultation_type === \"video\" ? \"telemedicina\" : \"presencial\") as \"presencial\" | \"telemedicina\",\r\n                        status: apt.status as TodayAppointment[\"status\"],\r\n                        duration: apt.duration || 30,\r\n                        motivo: apt.reason,\r\n                    }))\r\n                    .sort((a, b) => a.time.localeCompare(b.time));\r\n\r\n                // Filtrar citas de la semana\r\n                const week = allAppointments\r\n                    .filter((apt) => {\r\n                        const aptDate = getAppointmentDate(apt);\r\n                        return aptDate >= weekStart && aptDate <= weekEnd;\r\n                    })\r\n                    .map((apt) => ({\r\n                        id: apt.id,\r\n                        time: apt.appointment_time.slice(0, 5),\r\n                        patient: apt.patient?.nombre_completo || \"Paciente\",\r\n                        patientId: apt.patient_id,\r\n                        patientAvatar: apt.patient?.avatar_url || undefined,\r\n                        type: (apt.consultation_type === \"video\" ? \"telemedicina\" : \"presencial\") as \"presencial\" | \"telemedicina\",\r\n                        status: apt.status as TodayAppointment[\"status\"],\r\n                        duration: apt.duration || 30,\r\n                        motivo: apt.reason,\r\n                    }));\r\n\r\n                setTodayAppointments(today);\r\n                setWeekAppointments(week);\r\n\r\n                // Actualizar estadísticas de citas\r\n                setStats((prev) => ({\r\n                    ...prev,\r\n                    todayAppointments: today.length,\r\n                    weekAppointments: week.length,\r\n                    pendingAppointments: today.filter((a) => a.status === \"pending\").length,\r\n                    completedAppointments: allAppointments.filter((a) => a.status === \"completed\").length,\r\n                    cancelledAppointments: allAppointments.filter((a) => a.status === \"cancelled\").length,\r\n                }));\r\n            }\r\n        } catch (err) {\r\n            console.error(\"[useDashboardData] Error loading appointments:\", err);\r\n        }\r\n    }, [doctorId]);\r\n\r\n    /**\r\n     * Carga las conversaciones recientes.\r\n     */\r\n    const loadConversations = useCallback(async () => {\r\n        if (!doctorId) return;\r\n\r\n        try {\r\n            const result = await getUserConversations(doctorId);\r\n\r\n            if (result.success && result.data) {\r\n                const recent = result.data.slice(0, 5).map((conv) => {\r\n                    // last_message puede ser un objeto Message o undefined\r\n                    const lastMsgContent = typeof conv.last_message === 'object' && conv.last_message\r\n                        ? (conv.last_message as any).content || \"Sin mensajes\"\r\n                        : \"Sin mensajes\";\r\n\r\n                    return {\r\n                        id: conv.id,\r\n                        patientName: conv.patient?.nombre_completo || \"Paciente\",\r\n                        patientAvatar: conv.patient?.avatar_url || undefined,\r\n                        lastMessage: lastMsgContent,\r\n                        lastMessageTime: conv.last_message_at || conv.created_at,\r\n                        unreadCount: conv.unread_count || 0,\r\n                    };\r\n                });\r\n\r\n                setConversations(recent);\r\n            }\r\n\r\n            // Obtener conteo de no leídos\r\n            const unreadResult = await getUnreadMessagesCount(doctorId);\r\n            if (unreadResult.success) {\r\n                setStats((prev) => ({\r\n                    ...prev,\r\n                    unreadMessages: unreadResult.data || 0,\r\n                }));\r\n            }\r\n        } catch (err) {\r\n            console.error(\"[useDashboardData] Error loading conversations:\", err);\r\n        }\r\n    }, [doctorId]);\r\n\r\n    /**\r\n     * Carga las notificaciones.\r\n     */\r\n    const loadNotifications = useCallback(async () => {\r\n        if (!doctorId) return;\r\n\r\n        try {\r\n            const result = await getNotifications(doctorId, { limit: 10 });\r\n\r\n            if (result.success) {\r\n                setNotifications(result.data);\r\n            }\r\n\r\n            // Obtener conteo de no leídas\r\n            const unreadResult = await getUnreadNotificationsCount(doctorId);\r\n            if (unreadResult.success) {\r\n                setStats((prev) => ({\r\n                    ...prev,\r\n                    unreadNotifications: unreadResult.count,\r\n                }));\r\n            }\r\n        } catch (err) {\r\n            console.error(\"[useDashboardData] Error loading notifications:\", err);\r\n        }\r\n    }, [doctorId]);\r\n\r\n    /**\r\n     * Carga las tareas.\r\n     */\r\n    const loadTasks = useCallback(async () => {\r\n        if (!doctorId) return;\r\n\r\n        try {\r\n            const result = await getTasks(doctorId, { limit: 10 });\r\n\r\n            if (result.success) {\r\n                setTasks(result.data);\r\n                setStats((prev) => ({\r\n                    ...prev,\r\n                    pendingTasks: result.data.filter((t) => !t.is_completed).length,\r\n                }));\r\n            }\r\n        } catch (err) {\r\n            console.error(\"[useDashboardData] Error loading tasks:\", err);\r\n        }\r\n    }, [doctorId]);\r\n\r\n    /**\r\n     * Carga estadísticas adicionales.\r\n     */\r\n    const loadStats = useCallback(async () => {\r\n        if (!doctorId) return;\r\n\r\n        try {\r\n            // Obtener total de pacientes únicos\r\n            const { count: patientsCount } = await supabase\r\n                .from(\"appointments\")\r\n                .select(\"paciente_id\", { count: \"exact\", head: true })\r\n                .eq(\"medico_id\", doctorId);\r\n\r\n            // Obtener rating promedio desde la tabla ratings\r\n            let averageRating = 0;\r\n            try {\r\n                const { data: ratingData } = await supabase\r\n                    .from(\"ratings\")\r\n                    .select(`\r\n                        rating,\r\n                        consultation:consultations!inner(doctor_id)\r\n                    `)\r\n                    .eq(\"consultation.doctor_id\", doctorId);\r\n\r\n                if (ratingData && ratingData.length > 0) {\r\n                    const total = ratingData.reduce((sum, r) => sum + (r.rating || 0), 0);\r\n                    averageRating = total / ratingData.length;\r\n                }\r\n            } catch (err) {\r\n                console.warn(\"[useDashboardData] Error loading average rating:\", err);\r\n                averageRating = 0;\r\n            }\r\n\r\n            setStats((prev) => ({\r\n                ...prev,\r\n                totalPatients: patientsCount || 0,\r\n                averageRating,\r\n            }));\r\n        } catch (err) {\r\n            console.error(\"[useDashboardData] Error loading stats:\", err);\r\n        }\r\n    }, [doctorId]);\r\n\r\n    // =========================================================================\r\n    // FUNCIONES PÚBLICAS\r\n    // =========================================================================\r\n\r\n    /**\r\n     * Refrescar todos los datos.\r\n     */\r\n    const refresh = useCallback(async () => {\r\n        setIsLoading(true);\r\n        setError(null);\r\n\r\n        try {\r\n            await Promise.all([\r\n                loadAppointments(),\r\n                loadConversations(),\r\n                loadNotifications(),\r\n                loadTasks(),\r\n                loadStats(),\r\n            ]);\r\n        } catch (err) {\r\n            setError(String(err));\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    }, [loadAppointments, loadConversations, loadNotifications, loadTasks, loadStats]);\r\n\r\n    /**\r\n     * Refrescar solo citas.\r\n     */\r\n    const refreshAppointments = useCallback(async () => {\r\n        await loadAppointments();\r\n    }, [loadAppointments]);\r\n\r\n    /**\r\n     * Refrescar solo notificaciones.\r\n     */\r\n    const refreshNotifications = useCallback(async () => {\r\n        await loadNotifications();\r\n    }, [loadNotifications]);\r\n\r\n    // =========================================================================\r\n    // EFECTOS\r\n    // =========================================================================\r\n\r\n    // Carga inicial\r\n    useEffect(() => {\r\n        if (doctorId) {\r\n            refresh();\r\n        }\r\n    }, [doctorId, refresh]);\r\n\r\n    // Suscripción a notificaciones en tiempo real\r\n    useEffect(() => {\r\n        if (!doctorId) return;\r\n\r\n        const subscription = subscribeToNotifications(doctorId, (newNotification) => {\r\n            // Agregar nueva notificación al inicio\r\n            setNotifications((prev) => [newNotification, ...prev.slice(0, 9)]);\r\n\r\n            // Actualizar conteo\r\n            setStats((prev) => ({\r\n                ...prev,\r\n                unreadNotifications: prev.unreadNotifications + 1,\r\n            }));\r\n        });\r\n\r\n        return () => {\r\n            subscription.unsubscribe();\r\n        };\r\n    }, [doctorId]);\r\n\r\n    // Refrescar citas cada 5 minutos\r\n    useEffect(() => {\r\n        if (!doctorId) return;\r\n\r\n        const interval = setInterval(() => {\r\n            loadAppointments();\r\n        }, 5 * 60 * 1000);\r\n\r\n        return () => clearInterval(interval);\r\n    }, [doctorId, loadAppointments]);\r\n\r\n    // =========================================================================\r\n    // RETORNO\r\n    // =========================================================================\r\n\r\n    return useMemo(\r\n        () => ({\r\n            appointments, // Exposed raw appointments\r\n            todayAppointments,\r\n            weekAppointments,\r\n            conversations,\r\n            notifications,\r\n            tasks,\r\n            stats,\r\n            isLoading,\r\n            error,\r\n            refresh,\r\n            refreshAppointments,\r\n            refreshNotifications,\r\n        }),\r\n        [\r\n            appointments,\r\n            todayAppointments,\r\n            weekAppointments,\r\n            conversations,\r\n            notifications,\r\n            tasks,\r\n            stats,\r\n            isLoading,\r\n            error,\r\n            refresh,\r\n            refreshAppointments,\r\n            refreshNotifications,\r\n        ]\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-dashboard-widgets.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-doctor-profile.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[567,570],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[567,570],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-doctor-profile.ts:64:12\n  62 |   useEffect(() => {\n  63 |     if (userId) {\n> 64 |       void loadProfile();\n     |            ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  65 |       void loadSpecialties();\n  66 |       void loadStats();\n  67 |     }","line":64,"column":12,"nodeType":null,"endLine":64,"endColumn":23}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport {\r\n  getDoctorProfile,\r\n  updateDoctorProfile,\r\n  getSpecialties,\r\n  getDoctorStats,\r\n} from '@/lib/supabase/services/doctors-service';\r\nimport type { DoctorProfile, MedicalSpecialty, DoctorProfileFormData } from '@/lib/supabase/types/doctors';\r\n\r\nexport function useDoctorProfile(userId?: string) {\r\n  const [profile, setProfile] = useState<DoctorProfile | null>(null);\r\n  const [specialties, setSpecialties] = useState<MedicalSpecialty[]>([]);\r\n  const [stats, setStats] = useState<any>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const loadProfile = useCallback(async () => {\r\n    if (!userId) return;\r\n\r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    const result = await getDoctorProfile(userId);\r\n\r\n    if (result.success && result.data) {\r\n      setProfile(result.data);\r\n    } else {\r\n      setProfile(null);\r\n      setError(result.error || 'No se pudo cargar el perfil');\r\n    }\r\n\r\n    setLoading(false);\r\n  }, [userId]);\r\n\r\n  const loadSpecialties = useCallback(async () => {\r\n    try {\r\n      const result = await getSpecialties();\r\n      if (result.success && result.data) {\r\n        setSpecialties(result.data);\r\n      }\r\n    } catch (err) {\r\n      console.error('Error loading specialties:', err);\r\n    }\r\n  }, []);\r\n\r\n  const loadStats = useCallback(async () => {\r\n    if (!userId) return;\r\n\r\n    try {\r\n      const result = await getDoctorStats(userId);\r\n      if (result.success && result.data) {\r\n        setStats(result.data);\r\n      }\r\n    } catch (err) {\r\n      console.error('Error loading stats:', err);\r\n      setError('Error loading stats');\r\n    }\r\n  }, [userId]);\r\n\r\n  useEffect(() => {\r\n    if (userId) {\r\n      void loadProfile();\r\n      void loadSpecialties();\r\n      void loadStats();\r\n    }\r\n  }, [userId, loadProfile, loadSpecialties, loadStats]);\r\n\r\n  const updateProfile = async (updates: Partial<DoctorProfile>) => {\r\n    if (!userId) return { success: false, error: 'No user ID' };\r\n\r\n    // Filtrar solo los campos permitidos para actualización y convertir null a undefined\r\n    const allowedUpdates: Record<string, unknown> = {};\r\n    const allowedFields: Array<keyof DoctorProfile> = [\r\n      'specialty_id', 'license_number', 'license_country', 'years_experience',\r\n      'professional_phone', 'professional_email', 'clinic_address',\r\n      'consultation_duration', 'consultation_price', 'accepts_insurance', 'bio', 'languages'\r\n    ];\r\n    \r\n    Object.keys(updates).forEach(key => {\r\n      if (allowedFields.includes(key as keyof DoctorProfile)) {\r\n        const value = updates[key as keyof DoctorProfile];\r\n        if (value !== null && value !== undefined) {\r\n          allowedUpdates[key] = value;\r\n        }\r\n      }\r\n    });\r\n\r\n    const result = await updateDoctorProfile(userId, allowedUpdates as Partial<DoctorProfileFormData>);\r\n\r\n    if (result.success && result.data) {\r\n      setProfile(result.data);\r\n    }\r\n\r\n    return result;\r\n  };\r\n\r\n  const refreshProfile = () => {\r\n    loadProfile();\r\n    loadStats();\r\n  };\r\n\r\n  return {\r\n    profile,\r\n    specialties,\r\n    stats,\r\n    loading,\r\n    error,\r\n    updateProfile,\r\n    refreshProfile,\r\n  };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-drag-drop.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-health-metrics.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'updateHealthMetric' is defined but never used.","line":6,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'deleteHealthMetric' is defined but never used.","line":7,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'updateHealthGoal' is defined but never used.","line":12,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'createMeasurementReminder' is defined but never used.","line":15,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'updateMeasurementReminder' is defined but never used.","line":16,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CreateMeasurementReminderData' is defined but never used.","line":26,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":32},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'filters'. Either include it or remove the dependency array.","line":90,"column":6,"nodeType":"ArrayExpression","endLine":90,"endColumn":94,"suggestions":[{"desc":"Update the dependencies array to be: [patientId, filters.metricTypeId, filters.startDate, filters.endDate, filters.limit, filters]","fix":{"range":[2253,2341],"text":"[patientId, filters.metricTypeId, filters.startDate, filters.endDate, filters.limit, filters]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\r\nimport {\r\n  getHealthMetricTypes,\r\n  getPatientHealthMetrics,\r\n  createHealthMetric,\r\n  updateHealthMetric,\r\n  deleteHealthMetric,\r\n  getMetricStats,\r\n  getMetricTrend,\r\n  getPatientHealthGoals,\r\n  createHealthGoal,\r\n  updateHealthGoal,\r\n  getGoalProgress,\r\n  getPatientMeasurementReminders,\r\n  createMeasurementReminder,\r\n  updateMeasurementReminder,\r\n  getHealthDashboardSummary,\r\n} from \"@/lib/supabase/services/health-metrics-service\";\r\nimport type {\r\n  HealthMetricType,\r\n  HealthMetric,\r\n  HealthGoal,\r\n  MeasurementReminder,\r\n  CreateHealthMetricData,\r\n  CreateHealthGoalData,\r\n  CreateMeasurementReminderData,\r\n  MetricStats,\r\n  HealthDashboardSummary,\r\n  MetricTrend,\r\n  GoalProgress,\r\n} from \"@/lib/supabase/types/health-metrics\";\r\n\r\n// Hook para tipos de métricas\r\nexport function useHealthMetricTypes() {\r\n  const [metricTypes, setMetricTypes] = useState<HealthMetricType[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const loadMetricTypes = async () => {\r\n      const result = await getHealthMetricTypes();\r\n      if (result.success) {\r\n        setMetricTypes(result.data);\r\n      }\r\n      setLoading(false);\r\n    };\r\n\r\n    loadMetricTypes();\r\n  }, []);\r\n\r\n  return { metricTypes, loading };\r\n}\r\n\r\n// Hook para métricas del paciente\r\nexport function usePatientHealthMetrics(\r\n  patientId: string | undefined,\r\n  filters?: {\r\n    metricTypeId?: string;\r\n    startDate?: string;\r\n    endDate?: string;\r\n    limit?: number;\r\n  }\r\n) {\r\n  const [metrics, setMetrics] = useState<HealthMetric[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (!patientId) return;\r\n    \r\n    let cancelled = false;\r\n    \r\n    const loadMetrics = async () => {\r\n      setLoading(true);\r\n      const result = await getPatientHealthMetrics(patientId, filters);\r\n      if (!cancelled) {\r\n        if (result.success) {\r\n          setMetrics(result.data);\r\n        } else {\r\n          setError(String(result.error) || 'Error loading metrics');\r\n        }\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    loadMetrics();\r\n    \r\n    return () => {\r\n      cancelled = true;\r\n    };\r\n  }, [patientId, filters?.metricTypeId, filters?.startDate, filters?.endDate, filters?.limit]);\r\n\r\n  const refreshMetrics = async () => {\r\n    if (!patientId) return;\r\n    setLoading(true);\r\n    const result = await getPatientHealthMetrics(patientId, filters);\r\n    if (result.success && result.data) {\r\n      setMetrics(result.data);\r\n    } else {\r\n      setError(String(result.error) || 'Error loading metrics');\r\n    }\r\n    setLoading(false);\r\n  };\r\n\r\n  return { metrics, loading, error, refreshMetrics };\r\n}\r\n\r\n// Hook para crear métrica\r\nexport function useCreateHealthMetric() {\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const create = async (metricData: CreateHealthMetricData) => {\r\n    setLoading(true);\r\n    setError(null);\r\n    const result = await createHealthMetric(metricData);\r\n    setLoading(false);\r\n    if (!result.success) {\r\n      setError(String(result.error) || 'Error creating metric');\r\n    }\r\n    return result;\r\n  };\r\n\r\n  return { create, loading, error };\r\n}\r\n\r\n// Hook para estadísticas de métrica\r\nexport function useMetricStats(\r\n  patientId: string | undefined,\r\n  metricTypeId: string | undefined,\r\n  days: number = 30\r\n) {\r\n  const [stats, setStats] = useState<MetricStats | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    if (!patientId || !metricTypeId) return;\r\n\r\n    const loadStats = async () => {\r\n      setLoading(true);\r\n      const result = await getMetricStats(patientId, metricTypeId, days);\r\n      if (result.success) {\r\n        setStats(result.data);\r\n      }\r\n      setLoading(false);\r\n    };\r\n\r\n    loadStats();\r\n  }, [patientId, metricTypeId, days]);\r\n\r\n  return { stats, loading };\r\n}\r\n\r\n// Hook para tendencia de métrica\r\nexport function useMetricTrend(\r\n  patientId: string | undefined,\r\n  metricTypeId: string | undefined,\r\n  days: number = 30\r\n) {\r\n  const [trend, setTrend] = useState<MetricTrend[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    if (!patientId || !metricTypeId) return;\r\n\r\n    const loadTrend = async () => {\r\n      setLoading(true);\r\n      const result = await getMetricTrend(patientId, metricTypeId, days);\r\n      if (result.success) {\r\n        setTrend(result.data);\r\n      }\r\n      setLoading(false);\r\n    };\r\n\r\n    loadTrend();\r\n  }, [patientId, metricTypeId, days]);\r\n\r\n  return { trend, loading };\r\n}\r\n\r\n// Hook para metas de salud\r\nexport function usePatientHealthGoals(patientId: string | undefined, status?: string) {\r\n  const [goals, setGoals] = useState<HealthGoal[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    if (!patientId) return;\r\n    \r\n    let cancelled = false;\r\n    \r\n    const loadGoals = async () => {\r\n      setLoading(true);\r\n      const result = await getPatientHealthGoals(patientId, status);\r\n      if (!cancelled) {\r\n        if (result.success) {\r\n          setGoals(result.data);\r\n        }\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    loadGoals();\r\n    \r\n    return () => {\r\n      cancelled = true;\r\n    };\r\n  }, [patientId, status]);\r\n\r\n  const refreshGoals = async () => {\r\n    if (!patientId) return;\r\n    setLoading(true);\r\n    const result = await getPatientHealthGoals(patientId, status);\r\n    if (result.success && result.data) {\r\n      setGoals(result.data);\r\n    }\r\n    setLoading(false);\r\n  };\r\n\r\n  return { goals, loading, refreshGoals };\r\n}\r\n\r\n// Hook para crear meta\r\nexport function useCreateHealthGoal() {\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const create = async (goalData: CreateHealthGoalData) => {\r\n    setLoading(true);\r\n    setError(null);\r\n    const result = await createHealthGoal(goalData);\r\n    setLoading(false);\r\n    if (!result.success) {\r\n      setError(String(result.error) || 'Error creating goal');\r\n    }\r\n    return result;\r\n  };\r\n\r\n  return { create, loading, error };\r\n}\r\n\r\n// Hook para progreso de meta\r\nexport function useGoalProgress(goalId: string | undefined) {\r\n  const [progress, setProgress] = useState<GoalProgress | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    if (!goalId) return;\r\n\r\n    const loadProgress = async () => {\r\n      setLoading(true);\r\n      const result = await getGoalProgress(goalId);\r\n      if (result.success) {\r\n        setProgress(result.data);\r\n      }\r\n      setLoading(false);\r\n    };\r\n\r\n    loadProgress();\r\n  }, [goalId]);\r\n\r\n  return { progress, loading };\r\n}\r\n\r\n// Hook para recordatorios de medición\r\nexport function usePatientMeasurementReminders(patientId: string | undefined) {\r\n  const [reminders, setReminders] = useState<MeasurementReminder[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    if (!patientId) return;\r\n    \r\n    let cancelled = false;\r\n    \r\n    const loadReminders = async () => {\r\n      setLoading(true);\r\n      const result = await getPatientMeasurementReminders(patientId);\r\n      if (!cancelled) {\r\n        if (result.success) {\r\n          setReminders(result.data);\r\n        }\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    loadReminders();\r\n    \r\n    return () => {\r\n      cancelled = true;\r\n    };\r\n  }, [patientId]);\r\n\r\n  const refreshReminders = async () => {\r\n    if (!patientId) return;\r\n    setLoading(true);\r\n    const result = await getPatientMeasurementReminders(patientId);\r\n    if (result.success && result.data) {\r\n      setReminders(result.data);\r\n    }\r\n    setLoading(false);\r\n  };\r\n\r\n  return { reminders, loading, refreshReminders };\r\n}\r\n\r\n// Hook para dashboard summary\r\nexport function useHealthDashboardSummary(patientId: string | undefined) {\r\n  const [summary, setSummary] = useState<HealthDashboardSummary | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    if (!patientId) return;\r\n    \r\n    let cancelled = false;\r\n    \r\n    const loadSummary = async () => {\r\n      setLoading(true);\r\n      const result = await getHealthDashboardSummary(patientId);\r\n      if (!cancelled) {\r\n        if (result.success) {\r\n          setSummary(result.data);\r\n        }\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    loadSummary();\r\n    \r\n    return () => {\r\n      cancelled = true;\r\n    };\r\n  }, [patientId]);\r\n\r\n  const refreshSummary = async () => {\r\n    if (!patientId) return;\r\n    setLoading(true);\r\n    const result = await getHealthDashboardSummary(patientId);\r\n    if (result.success && result.data) {\r\n      setSummary(result.data);\r\n    }\r\n    setLoading(false);\r\n  };\r\n\r\n  return { summary, loading, refreshSummary };\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-keyboard-shortcuts.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":27,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport { useEffect, useCallback } from 'react';\r\n\r\n// Atajos predefinidos (Defaults)\r\nexport const DEFAULT_SHORTCUTS = {\r\n  NEW_APPOINTMENT: { key: 'n', description: 'Nueva cita' },\r\n  TODAY: { key: 't', description: 'Ir a hoy' },\r\n  NEXT_WEEK: { key: 'ArrowRight', description: 'Semana siguiente' },\r\n  PREV_WEEK: { key: 'ArrowLeft', description: 'Semana anterior' },\r\n  DAY_VIEW: { key: 'd', description: 'Vista día' },\r\n  WEEK_VIEW: { key: 'w', description: 'Vista semana' },\r\n  MONTH_VIEW: { key: 'm', description: 'Vista mes' },\r\n  LIST_VIEW: { key: 'l', description: 'Vista lista' },\r\n  SEARCH: { key: 'f', ctrl: true, description: 'Buscar' },\r\n  REFRESH: { key: 'r', ctrl: true, description: 'Actualizar' },\r\n  HELP: { key: '?', shift: true, description: 'Mostrar ayuda' },\r\n};\r\n\r\nconst STORAGE_KEY = 'red-salud-shortcuts';\r\n\r\nexport function getStoredShortcuts() {\r\n  if (typeof window === 'undefined') return DEFAULT_SHORTCUTS;\r\n\r\n  try {\r\n    const stored = localStorage.getItem(STORAGE_KEY);\r\n    return stored ? { ...DEFAULT_SHORTCUTS, ...JSON.parse(stored) } : DEFAULT_SHORTCUTS;\r\n  } catch (e) {\r\n    return DEFAULT_SHORTCUTS;\r\n  }\r\n}\r\n\r\nexport function saveShortcut(action: string, key: string) {\r\n  if (typeof window === 'undefined') return;\r\n  const current = getStoredShortcuts();\r\n  current[action as keyof typeof current] = { ...current[action as keyof typeof current], key };\r\n  localStorage.setItem(STORAGE_KEY, JSON.stringify(current));\r\n  // Disparar evento para actualizar otros componentes\r\n  window.dispatchEvent(new Event('shortcuts-updated'));\r\n}\r\n\r\nexport function useKeyboardShortcuts(handlers: { key?: string; handler: () => void; description?: string }[]) {\r\n  const handleKeyDown = useCallback((event: KeyboardEvent) => {\r\n    // No disparar si estamos en un input\r\n    if (['INPUT', 'TEXTAREA'].includes((event.target as HTMLElement).tagName)) return;\r\n\r\n    const pressedKey = event.key.toLowerCase();\r\n    const isCtrl = event.ctrlKey || event.metaKey;\r\n    const isShift = event.shiftKey;\r\n    const isAlt = event.altKey;\r\n\r\n    // Obtener shortcuts actualizados\r\n    const storedShortcuts = Object.values(getStoredShortcuts()) as Array<{ key: string; description: string; ctrl?: boolean; shift?: boolean }>;\r\n\r\n    for (const handler of handlers) {\r\n      let effectiveKey = handler.key;\r\n\r\n      // Attempt to find dynamic override by description\r\n      if (handler.description) {\r\n        const match = storedShortcuts.find(s => s.description === handler.description);\r\n        if (match) {\r\n          effectiveKey = match.key;\r\n        }\r\n      }\r\n\r\n      // Check match\r\n      const keyMatch = effectiveKey?.toLowerCase() === pressedKey;\r\n\r\n      // Simplified match for the single-key customization requested:\r\n      if (keyMatch && !isCtrl && !isShift && !isAlt) {\r\n        event.preventDefault();\r\n        handler.handler();\r\n        return;\r\n      }\r\n    }\r\n  }, [handlers]);\r\n\r\n  useEffect(() => {\r\n    window.addEventListener('keydown', handleKeyDown);\r\n    return () => window.removeEventListener('keydown', handleKeyDown);\r\n  }, [handleKeyDown]);\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-laboratory.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getLabOrderResults' is defined but never used.","line":7,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":21},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-laboratory.ts:63:10\n  61 |   // Cargar datos cuando cambien las dependencias\n  62 |   useEffect(() => {\n> 63 |     void loadOrders();\n     |          ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  64 |     void loadStats();\n  65 |   }, [loadOrders, loadStats]);\n  66 |","line":63,"column":10,"nodeType":null,"endLine":63,"endColumn":20},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-laboratory.ts:114:10\n  112 |\n  113 |   useEffect(() => {\n> 114 |     void loadOrder();\n      |          ^^^^^^^^^ Avoid calling setState() directly within an effect\n  115 |     void loadStatusHistory();\n  116 |   }, [loadOrder, loadStatusHistory]);\n  117 |","line":114,"column":10,"nodeType":null,"endLine":114,"endColumn":19}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect, useCallback } from \"react\";\r\nimport {\r\n  getPatientLabOrders,\r\n  getLabOrderDetails,\r\n  getLabOrderResults,\r\n  getLabTestTypes,\r\n  getLabTestCategories,\r\n  getPatientLabStats,\r\n  getLabOrderStatusHistory,\r\n} from \"@/lib/supabase/services/laboratory-service\";\r\nimport type {\r\n  LabOrder,\r\n  LabResult,\r\n  LabTestType,\r\n  LabOrderFilters,\r\n  LabResultStats,\r\n  LabOrderStatusHistory,\r\n} from \"@/lib/supabase/types/laboratory\";\r\n\r\nexport function useLaboratory(patientId: string, filters?: LabOrderFilters) {\r\n  const [orders, setOrders] = useState<LabOrder[]>([]);\r\n  const [stats, setStats] = useState<LabResultStats>({\r\n    total_ordenes: 0,\r\n    pendientes: 0,\r\n    completadas: 0,\r\n    con_valores_anormales: 0,\r\n  });\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const loadOrders = useCallback(async () => {\r\n    if (!patientId) return;\r\n\r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    const result = await getPatientLabOrders(patientId, filters);\r\n\r\n    if (result.success) {\r\n      setOrders(result.data);\r\n    } else {\r\n      setError(\"Error al cargar órdenes de laboratorio\");\r\n      console.error(result.error);\r\n    }\r\n\r\n    setLoading(false);\r\n  }, [patientId, filters]);\r\n\r\n  const loadStats = useCallback(async () => {\r\n    if (!patientId) return;\r\n\r\n    const result = await getPatientLabStats(patientId);\r\n\r\n    if (result.success) {\r\n      setStats(result.data);\r\n    }\r\n  }, [patientId]);\r\n\r\n  // Cargar datos cuando cambien las dependencias\r\n  useEffect(() => {\r\n    void loadOrders();\r\n    void loadStats();\r\n  }, [loadOrders, loadStats]);\r\n\r\n  return {\r\n    orders,\r\n    stats,\r\n    loading,\r\n    error,\r\n    refreshOrders: loadOrders,\r\n    refreshStats: loadStats,\r\n  };\r\n}\r\n\r\nexport function useLabOrder(orderId: string) {\r\n  const [order, setOrder] = useState<LabOrder | null>(null);\r\n  const [results, setResults] = useState<LabResult[]>([]);\r\n  const [statusHistory, setStatusHistory] = useState<LabOrderStatusHistory[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const loadOrder = useCallback(async () => {\r\n    if (!orderId) return;\r\n\r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    const result = await getLabOrderDetails(orderId);\r\n\r\n    if (result.success) {\r\n      setOrder(result.data);\r\n      setResults(result.data?.results || []);\r\n    } else {\r\n      setError(\"Error al cargar orden de laboratorio\");\r\n      console.error(result.error);\r\n    }\r\n\r\n    setLoading(false);\r\n  }, [orderId]);\r\n\r\n  const loadStatusHistory = useCallback(async () => {\r\n    if (!orderId) return;\r\n\r\n    const result = await getLabOrderStatusHistory(orderId);\r\n\r\n    if (result.success) {\r\n      setStatusHistory(result.data);\r\n    }\r\n  }, [orderId]);\r\n\r\n  useEffect(() => {\r\n    void loadOrder();\r\n    void loadStatusHistory();\r\n  }, [loadOrder, loadStatusHistory]);\r\n\r\n  return {\r\n    order,\r\n    results,\r\n    statusHistory,\r\n    loading,\r\n    error,\r\n    refreshOrder: loadOrder,\r\n  };\r\n}\r\n\r\nexport function useLabTestTypes(categoria?: string) {\r\n  const [testTypes, setTestTypes] = useState<LabTestType[]>([]);\r\n  const [categories, setCategories] = useState<string[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    const loadData = async () => {\r\n      setLoading(true);\r\n      setError(null);\r\n\r\n      const [typesResult, categoriesResult] = await Promise.all([\r\n        getLabTestTypes(categoria),\r\n        getLabTestCategories(),\r\n      ]);\r\n\r\n      if (typesResult.success) {\r\n        setTestTypes(typesResult.data);\r\n      } else {\r\n        setError(\"Error al cargar tipos de exámenes\");\r\n      }\r\n\r\n      if (categoriesResult.success) {\r\n        setCategories(categoriesResult.data);\r\n      }\r\n\r\n      setLoading(false);\r\n    };\r\n\r\n    loadData();\r\n  }, [categoria]);\r\n\r\n  return {\r\n    testTypes,\r\n    categories,\r\n    loading,\r\n    error,\r\n  };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-medical-records.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'filters' and 'session?.access_token'. Either include them or remove the dependency array.","line":41,"column":6,"nodeType":"ArrayExpression","endLine":41,"endColumn":74,"suggestions":[{"desc":"Update the dependencies array to be: [patientId, filters.startDate, filters.endDate, filters.medicoId, filters, session?.access_token]","fix":{"range":[1233,1301],"text":"[patientId, filters.startDate, filters.endDate, filters.medicoId, filters, session?.access_token]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\r\nimport {\r\n  getPatientMedicalRecords,\r\n  getMedicalRecord,\r\n  getMedicalHistorySummary,\r\n  searchMedicalRecords,\r\n  getMedicalRecordByAppointment,\r\n} from \"@/lib/supabase/services/medical-records-service\";\r\nimport type {\r\n  MedicalRecord,\r\n  MedicalRecordFilters,\r\n  MedicalHistorySummary,\r\n} from \"@/lib/supabase/types/medical-records\";\r\nimport { useAuth } from \"./use-auth\";\r\n\r\n// Hook para obtener historial médico del paciente\r\nexport function usePatientMedicalRecords(\r\n  patientId: string | undefined,\r\n  filters?: MedicalRecordFilters\r\n) {\r\n  const [records, setRecords] = useState<MedicalRecord[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const { session } = useAuth();\r\n\r\n  useEffect(() => {\r\n    if (!patientId) return;\r\n\r\n    const loadRecords = async () => {\r\n      setLoading(true);\r\n      const result = await getPatientMedicalRecords(patientId, filters, session?.access_token);\r\n      if (result.success) {\r\n        setRecords(result.data);\r\n      } else {\r\n        setError(String(result.error) || 'Error loading records');\r\n      }\r\n      setLoading(false);\r\n    };\r\n\r\n    loadRecords();\r\n  }, [patientId, filters?.startDate, filters?.endDate, filters?.medicoId]);\r\n\r\n  const refreshRecords = async () => {\r\n    if (!patientId) return;\r\n    const result = await getPatientMedicalRecords(patientId, filters, session?.access_token);\r\n    if (result.success && result.data) {\r\n      setRecords(result.data);\r\n    }\r\n  };\r\n\r\n  return { records, loading, error, refreshRecords };\r\n}\r\n\r\n// Hook para obtener un registro médico específico\r\nexport function useMedicalRecord(recordId: string | undefined) {\r\n  const [record, setRecord] = useState<MedicalRecord | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (!recordId) return;\r\n\r\n    const loadRecord = async () => {\r\n      setLoading(true);\r\n      const result = await getMedicalRecord(recordId);\r\n      if (result.success) {\r\n        setRecord(result.data);\r\n      } else {\r\n        setError(String(result.error) || 'Error loading record');\r\n      }\r\n      setLoading(false);\r\n    };\r\n\r\n    loadRecord();\r\n  }, [recordId]);\r\n\r\n  return { record, loading, error };\r\n}\r\n\r\n// Hook para obtener resumen del historial médico\r\nexport function useMedicalHistorySummary(patientId: string | undefined) {\r\n  const [summary, setSummary] = useState<MedicalHistorySummary | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (!patientId) return;\r\n\r\n    const loadSummary = async () => {\r\n      setLoading(true);\r\n      const result = await getMedicalHistorySummary(patientId);\r\n      if (result.success) {\r\n        setSummary(result.data);\r\n      } else {\r\n        setError(String(result.error) || 'Error loading summary');\r\n      }\r\n      setLoading(false);\r\n    };\r\n\r\n    loadSummary();\r\n  }, [patientId]);\r\n\r\n  const refreshSummary = async () => {\r\n    if (!patientId) return;\r\n    const result = await getMedicalHistorySummary(patientId);\r\n    if (result.success && result.data) {\r\n      setSummary(result.data);\r\n    }\r\n  };\r\n\r\n  return { summary, loading, error, refreshSummary };\r\n}\r\n\r\n// Hook para buscar en el historial médico\r\nexport function useSearchMedicalRecords(patientId: string | undefined) {\r\n  const [results, setResults] = useState<MedicalRecord[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const search = async (searchTerm: string) => {\r\n    if (!patientId || !searchTerm) {\r\n      setResults([]);\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    const result = await searchMedicalRecords(patientId, searchTerm);\r\n    if (result.success) {\r\n      setResults(result.data);\r\n    } else {\r\n      setError(String(result.error) || 'Error searching records');\r\n    }\r\n    setLoading(false);\r\n  };\r\n\r\n  const clearSearch = () => {\r\n    setResults([]);\r\n    setError(null);\r\n  };\r\n\r\n  return { results, loading, error, search, clearSearch };\r\n}\r\n\r\n// Hook para obtener registro médico de una cita\r\nexport function useMedicalRecordByAppointment(appointmentId: string | undefined) {\r\n  const [record, setRecord] = useState<MedicalRecord | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (!appointmentId) return;\r\n\r\n    const loadRecord = async () => {\r\n      setLoading(true);\r\n      const result = await getMedicalRecordByAppointment(appointmentId);\r\n      if (result.success) {\r\n        setRecord(result.data);\r\n      } else {\r\n        setError(String(result.error) || 'Error loading record');\r\n      }\r\n      setLoading(false);\r\n    };\r\n\r\n    loadRecord();\r\n  }, [appointmentId]);\r\n\r\n  return { record, loading, error };\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-medications.ts","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-medications.ts:164:10\n  162 |\n  163 |   useEffect(() => {\n> 164 |     void loadIntakeLog();\n      |          ^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  165 |   }, [loadIntakeLog]);\n  166 |\n  167 |   const recordIntake = async (intakeId: string, status: 'tomado' | 'omitido', notes?: string) => {","line":164,"column":10,"nodeType":null,"endLine":164,"endColumn":23},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-medications.ts:223:10\n  221 |\n  222 |   useEffect(() => {\n> 223 |     void loadSummary();\n      |          ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  224 |   }, [loadSummary]);\n  225 |\n  226 |   return { summary, loading, error, refreshSummary: loadSummary };","line":223,"column":10,"nodeType":null,"endLine":223,"endColumn":21}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from \"react\";\r\nimport {\r\n  searchMedicationsCatalog,\r\n  getPatientPrescriptions,\r\n  getPrescription,\r\n  getPatientReminders,\r\n  getTodayIntakeLog,\r\n  recordMedicationIntake,\r\n  getAdherenceStats,\r\n  getActiveMedicationsSummary,\r\n  createReminder,\r\n  updateReminder,\r\n  deactivateReminder,\r\n} from \"@/lib/supabase/services/medications-service\";\r\nimport type {\r\n  MedicationCatalog,\r\n  Prescription,\r\n  MedicationReminder,\r\n  MedicationIntakeLog,\r\n  AdherenceStats,\r\n  ActiveMedicationsSummary,\r\n  CreateReminderData,\r\n} from \"@/lib/supabase/types/medications\";\r\n\r\n// Hook para buscar medicamentos en el catálogo\r\nexport function useSearchMedications() {\r\n  const [results, setResults] = useState<MedicationCatalog[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const search = async (searchTerm: string) => {\r\n    if (!searchTerm || searchTerm.length < 2) {\r\n      setResults([]);\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    const result = await searchMedicationsCatalog(searchTerm);\r\n    if (result.success) {\r\n      setResults(result.data);\r\n    }\r\n    setLoading(false);\r\n  };\r\n\r\n  const clearSearch = () => {\r\n    setResults([]);\r\n  };\r\n\r\n  return { results, loading, search, clearSearch };\r\n}\r\n\r\n// Hook para prescripciones del paciente\r\nexport function usePatientPrescriptions(patientId: string | undefined) {\r\n  const [prescriptions, setPrescriptions] = useState<Prescription[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (!patientId) return;\r\n\r\n    const loadPrescriptions = async () => {\r\n      setLoading(true);\r\n      const result = await getPatientPrescriptions(patientId);\r\n      if (result.success) {\r\n        setPrescriptions(result.data);\r\n      } else {\r\n        setError(String(result.error) || 'Error loading prescriptions');\r\n      }\r\n      setLoading(false);\r\n    };\r\n\r\n    loadPrescriptions();\r\n  }, [patientId]);\r\n\r\n  const refreshPrescriptions = async () => {\r\n    if (!patientId) return;\r\n    const result = await getPatientPrescriptions(patientId);\r\n    if (result.success && result.data) {\r\n      setPrescriptions(result.data);\r\n    }\r\n  };\r\n\r\n  return { prescriptions, loading, error, refreshPrescriptions };\r\n}\r\n\r\n// Hook para una prescripción específica\r\nexport function usePrescription(prescriptionId: string | undefined) {\r\n  const [prescription, setPrescription] = useState<Prescription | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (!prescriptionId) return;\r\n\r\n    const loadPrescription = async () => {\r\n      setLoading(true);\r\n      const result = await getPrescription(prescriptionId);\r\n      if (result.success) {\r\n        setPrescription(result.data);\r\n      } else {\r\n        setError(String(result.error) || 'Error loading prescription');\r\n      }\r\n      setLoading(false);\r\n    };\r\n\r\n    loadPrescription();\r\n  }, [prescriptionId]);\r\n\r\n  return { prescription, loading, error };\r\n}\r\n\r\n// Hook para recordatorios del paciente\r\nexport function usePatientReminders(patientId: string | undefined) {\r\n  const [reminders, setReminders] = useState<MedicationReminder[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (!patientId) return;\r\n\r\n    const loadReminders = async () => {\r\n      setLoading(true);\r\n      const result = await getPatientReminders(patientId);\r\n      if (result.success) {\r\n        setReminders(result.data);\r\n      } else {\r\n        setError(String(result.error) || 'Error loading reminders');\r\n      }\r\n      setLoading(false);\r\n    };\r\n\r\n    loadReminders();\r\n  }, [patientId]);\r\n\r\n  const refreshReminders = async () => {\r\n    if (!patientId) return;\r\n    const result = await getPatientReminders(patientId);\r\n    if (result.success && result.data) {\r\n      setReminders(result.data);\r\n    }\r\n  };\r\n\r\n  return { reminders, loading, error, refreshReminders };\r\n}\r\n\r\n// Hook para registro de tomas del día\r\nexport function useTodayIntakeLog(patientId: string | undefined) {\r\n  const [intakeLog, setIntakeLog] = useState<MedicationIntakeLog[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const loadIntakeLog = useCallback(async () => {\r\n    if (!patientId) return;\r\n    setLoading(true);\r\n    const result = await getTodayIntakeLog(patientId);\r\n    if (result.success) {\r\n      setIntakeLog(result.data);\r\n    } else {\r\n      setError(String(result.error) || 'Error loading intake log');\r\n    }\r\n    setLoading(false);\r\n  }, [patientId]);\r\n\r\n  useEffect(() => {\r\n    void loadIntakeLog();\r\n  }, [loadIntakeLog]);\r\n\r\n  const recordIntake = async (intakeId: string, status: 'tomado' | 'omitido', notes?: string) => {\r\n    const result = await recordMedicationIntake(intakeId, status, notes);\r\n    if (result.success) {\r\n      await loadIntakeLog();\r\n    }\r\n    return result;\r\n  };\r\n\r\n  return { intakeLog, loading, error, recordIntake, refreshIntakeLog: loadIntakeLog };\r\n}\r\n\r\n// Hook para estadísticas de adherencia\r\nexport function useAdherenceStats(patientId: string | undefined, days: number = 30) {\r\n  const [stats, setStats] = useState<AdherenceStats | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (!patientId) return;\r\n\r\n    const loadStats = async () => {\r\n      setLoading(true);\r\n      const result = await getAdherenceStats(patientId, days);\r\n      if (result.success) {\r\n        setStats(result.data);\r\n      } else {\r\n        setError(String(result.error) || 'Error loading stats');\r\n      }\r\n      setLoading(false);\r\n    };\r\n\r\n    loadStats();\r\n  }, [patientId, days]);\r\n\r\n  return { stats, loading, error };\r\n}\r\n\r\n// Hook para resumen de medicamentos activos\r\nexport function useActiveMedicationsSummary(patientId: string | undefined) {\r\n  const [summary, setSummary] = useState<ActiveMedicationsSummary | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const loadSummary = useCallback(async () => {\r\n    if (!patientId) return;\r\n    setLoading(true);\r\n    const result = await getActiveMedicationsSummary(patientId);\r\n    if (result.success) {\r\n      setSummary(result.data);\r\n    } else {\r\n      setError(String(result.error) || 'Error loading summary');\r\n    }\r\n    setLoading(false);\r\n  }, [patientId]);\r\n\r\n  useEffect(() => {\r\n    void loadSummary();\r\n  }, [loadSummary]);\r\n\r\n  return { summary, loading, error, refreshSummary: loadSummary };\r\n}\r\n\r\n// Hook para crear recordatorio\r\nexport function useCreateReminder() {\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const create = async (reminderData: CreateReminderData) => {\r\n    setLoading(true);\r\n    setError(null);\r\n    const result = await createReminder(reminderData);\r\n    setLoading(false);\r\n    if (!result.success) {\r\n      setError(String(result.error));\r\n    }\r\n    return result;\r\n  };\r\n\r\n  return { create, loading, error };\r\n}\r\n\r\n// Hook para actualizar recordatorio\r\nexport function useUpdateReminder() {\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const update = async (reminderId: string, updates: Partial<MedicationReminder>) => {\r\n    setLoading(true);\r\n    setError(null);\r\n    const result = await updateReminder(reminderId, updates);\r\n    setLoading(false);\r\n    if (!result.success) {\r\n      setError(String(result.error));\r\n    }\r\n    return result;\r\n  };\r\n\r\n  const deactivate = async (reminderId: string) => {\r\n    setLoading(true);\r\n    setError(null);\r\n    const result = await deactivateReminder(reminderId);\r\n    setLoading(false);\r\n    if (!result.success) {\r\n      setError(String(result.error));\r\n    }\r\n    return result;\r\n  };\r\n\r\n  return { update, deactivate, loading, error };\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-messaging.ts","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-messaging.ts:57:10\n  55 |\n  56 |   useEffect(() => {\n> 57 |     void loadConversations();\n     |          ^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  58 |     void loadUnreadCount();\n  59 |   }, [loadConversations, loadUnreadCount]);\n  60 |","line":57,"column":10,"nodeType":null,"endLine":57,"endColumn":27},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-messaging.ts:148:10\n  146 |\n  147 |   useEffect(() => {\n> 148 |     void loadConversation();\n      |          ^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  149 |     void loadMessages();\n  150 |   }, [loadConversation, loadMessages]);\n  151 |","line":148,"column":10,"nodeType":null,"endLine":148,"endColumn":26}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect, useCallback } from \"react\";\r\nimport {\r\n  getUserConversations,\r\n  getConversation,\r\n  createConversation,\r\n  getConversationMessages,\r\n  sendMessage,\r\n  markMessagesAsRead,\r\n  archiveConversation,\r\n  reactivateConversation,\r\n  getUnreadMessagesCount,\r\n  subscribeToMessages,\r\n} from \"@/lib/supabase/services/messaging-service\";\r\nimport type {\r\n  Conversation,\r\n  Message,\r\n  CreateConversationData,\r\n  SendMessageData,\r\n} from \"@/lib/supabase/types/messaging\";\r\n\r\nexport function useMessaging(userId: string) {\r\n  const [conversations, setConversations] = useState<Conversation[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [unreadCount, setUnreadCount] = useState(0);\r\n\r\n  const loadConversations = useCallback(async () => {\r\n    if (!userId) return;\r\n\r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    const result = await getUserConversations(userId);\r\n\r\n    if (result.success) {\r\n      setConversations(result.data);\r\n    } else {\r\n      setError(\"Error al cargar conversaciones\");\r\n      console.error(result.error);\r\n    }\r\n\r\n    setLoading(false);\r\n  }, [userId]);\r\n\r\n  const loadUnreadCount = useCallback(async () => {\r\n    if (!userId) return;\r\n\r\n    const result = await getUnreadMessagesCount(userId);\r\n    if (result.success) {\r\n      setUnreadCount(result.data);\r\n    }\r\n  }, [userId]);\r\n\r\n  useEffect(() => {\r\n    void loadConversations();\r\n    void loadUnreadCount();\r\n  }, [loadConversations, loadUnreadCount]);\r\n\r\n  const createNewConversation = async (data: CreateConversationData) => {\r\n    const result = await createConversation(userId, data);\r\n\r\n    if (result.success && result.data) {\r\n      await loadConversations();\r\n      return { success: true, data: result.data };\r\n    } else {\r\n      setError(\"Error al crear conversación\");\r\n      return { success: false, error: result.error ? String(result.error) : \"Error desconocido\" };\r\n    }\r\n  };\r\n\r\n  const archiveConv = async (conversationId: string) => {\r\n    const result = await archiveConversation(conversationId);\r\n\r\n    if (result.success) {\r\n      await loadConversations();\r\n    } else {\r\n      setError(\"Error al archivar conversación\");\r\n      throw result.error;\r\n    }\r\n  };\r\n\r\n  const reactivateConv = async (conversationId: string) => {\r\n    const result = await reactivateConversation(conversationId);\r\n\r\n    if (result.success) {\r\n      await loadConversations();\r\n    } else {\r\n      setError(\"Error al reactivar conversación\");\r\n      throw result.error;\r\n    }\r\n  };\r\n\r\n  return {\r\n    conversations,\r\n    loading,\r\n    error,\r\n    unreadCount,\r\n    refreshConversations: loadConversations,\r\n    createConversation: createNewConversation,\r\n    archiveConversation: archiveConv,\r\n    reactivateConversation: reactivateConv,\r\n  };\r\n}\r\n\r\nexport function useConversation(conversationId: string, userId: string) {\r\n  const [conversation, setConversation] = useState<Conversation | null>(null);\r\n  const [messages, setMessages] = useState<Message[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [sending, setSending] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const loadConversation = useCallback(async () => {\r\n    if (!conversationId) return;\r\n\r\n    const result = await getConversation(conversationId);\r\n\r\n    if (result.success) {\r\n      setConversation(result.data);\r\n    } else {\r\n      setError(\"Error al cargar conversación\");\r\n      console.error(result.error);\r\n    }\r\n  }, [conversationId]);\r\n\r\n  const loadMessages = useCallback(async () => {\r\n    if (!conversationId) return;\r\n\r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    const result = await getConversationMessages(conversationId);\r\n\r\n    if (result.success) {\r\n      setMessages(result.data);\r\n      // Marcar mensajes como leídos\r\n      await markMessagesAsRead(conversationId, userId);\r\n    } else {\r\n      setError(\"Error al cargar mensajes\");\r\n      console.error(result.error);\r\n    }\r\n\r\n    setLoading(false);\r\n  }, [conversationId, userId]);\r\n\r\n  useEffect(() => {\r\n    void loadConversation();\r\n    void loadMessages();\r\n  }, [loadConversation, loadMessages]);\r\n\r\n  // Suscribirse a nuevos mensajes en tiempo real\r\n  useEffect(() => {\r\n    if (!conversationId) return;\r\n\r\n    const unsubscribe = subscribeToMessages(conversationId, (newMessage) => {\r\n      setMessages((prev) => [...prev, newMessage]);\r\n\r\n      // Si el mensaje no es del usuario actual, marcarlo como leído\r\n      if (newMessage.sender_id !== userId) {\r\n        markMessagesAsRead(conversationId, userId);\r\n      }\r\n    });\r\n\r\n    return unsubscribe;\r\n  }, [conversationId, userId]);\r\n\r\n  const sendNewMessage = async (data: SendMessageData) => {\r\n    setSending(true);\r\n    setError(null);\r\n\r\n    const result = await sendMessage(userId, data);\r\n\r\n    if (result.success) {\r\n      // El mensaje se agregará automáticamente por la suscripción en tiempo real\r\n      setSending(false);\r\n      return result.data;\r\n    } else {\r\n      setError(\"Error al enviar mensaje\");\r\n      setSending(false);\r\n      throw result.error;\r\n    }\r\n  };\r\n\r\n  return {\r\n    conversation,\r\n    messages,\r\n    loading,\r\n    sending,\r\n    error,\r\n    sendMessage: sendNewMessage,\r\n    refreshMessages: loadMessages,\r\n  };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-patient-profile.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":58,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":58,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":146,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":146,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4600,4603],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4600,4603],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":168,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":168,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5128,5131],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5128,5131],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":190,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":190,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5677,5680],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5677,5680],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":212,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":212,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6244,6247],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6244,6247],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":234,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":234,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6796,6799],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6796,6799],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\r\nimport {\r\n  getPatientProfile,\r\n  updateBasicProfile,\r\n  updateMedicalInfo,\r\n  type PatientProfile,\r\n} from \"@/lib/supabase/services/profile-service\";\r\nimport { uploadAvatar, uploadDocument } from \"@/lib/supabase/services/storage-service\";\r\nimport {\r\n  getUserPreferences,\r\n  updateUserPreferences,\r\n  getPrivacySettings,\r\n  updatePrivacySettings,\r\n  getNotificationSettings,\r\n  updateNotificationSettings,\r\n} from \"@/lib/supabase/services/settings-service\";\r\nimport type {\r\n  UserPreferences,\r\n  PrivacySettings,\r\n  NotificationSettings,\r\n} from \"@/lib/supabase/types\";\r\nimport {\r\n  getUserActivity,\r\n  getUserSessions,\r\n} from \"@/lib/supabase/services/activity-service\";\r\nimport {\r\n  getPaymentMethods,\r\n  getTransactions,\r\n} from \"@/lib/supabase/services/billing-service\";\r\nimport { getPatientDocuments } from \"@/lib/supabase/services/documents-service\";\r\n\r\nexport function usePatientProfile(userId: string | undefined) {\r\n  const [profile, setProfile] = useState<PatientProfile | null>(null);\r\n  const [preferences, setPreferences] = useState<UserPreferences | null>(null);\r\n  const [privacySettings, setPrivacySettings] = useState<PrivacySettings | null>(null);\r\n  const [notificationSettings, setNotificationSettings] = useState<NotificationSettings | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  // Cargar datos iniciales\r\n  useEffect(() => {\r\n    if (!userId) return;\r\n\r\n    const loadData = async () => {\r\n      setLoading(true);\r\n      try {\r\n        const [profileData, prefsData, privacyData, notifData] = await Promise.all([\r\n          getPatientProfile(userId),\r\n          getUserPreferences(userId),\r\n          getPrivacySettings(userId),\r\n          getNotificationSettings(userId),\r\n        ]);\r\n\r\n        setProfile(profileData);\r\n        setPreferences(prefsData.data || null);\r\n        setPrivacySettings(privacyData.data || null);\r\n        setNotificationSettings(notifData.data || null);\r\n      } catch (err) {\r\n        setError('Error loading profile data');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    loadData();\r\n  }, [userId]);\r\n\r\n  // Actualizar perfil básico\r\n  const updateProfile = async (data: Partial<PatientProfile>) => {\r\n    if (!userId) return { success: false };\r\n    const result = await updateBasicProfile(userId, data);\r\n    if (result.success && profile) {\r\n      setProfile({ ...profile, ...data });\r\n    }\r\n    return result;\r\n  };\r\n\r\n  // Actualizar información médica\r\n  const updateMedical = async (data: Partial<PatientProfile>) => {\r\n    if (!userId) return { success: false };\r\n    const result = await updateMedicalInfo(userId, data);\r\n    if (result.success && profile) {\r\n      setProfile({ ...profile, ...data });\r\n    }\r\n    return result;\r\n  };\r\n\r\n  // Subir avatar\r\n  const updateAvatar = async (file: File) => {\r\n    if (!userId) return { success: false };\r\n    const result = await uploadAvatar(userId, file);\r\n    if (result.success && profile) {\r\n      setProfile({ ...profile, avatar_url: result.url });\r\n    }\r\n    return result;\r\n  };\r\n\r\n  // Actualizar preferencias\r\n  const updatePrefs = async (data: Partial<UserPreferences>) => {\r\n    if (!userId) return { success: false };\r\n    const result = await updateUserPreferences(userId, data);\r\n    if (result.success && preferences) {\r\n      setPreferences({ ...preferences, ...data });\r\n    }\r\n    return result;\r\n  };\r\n\r\n  // Actualizar privacidad\r\n  const updatePrivacy = async (data: Partial<PrivacySettings>) => {\r\n    if (!userId) return { success: false };\r\n    const result = await updatePrivacySettings(userId, data);\r\n    if (result.success && privacySettings) {\r\n      setPrivacySettings({ ...privacySettings, ...data });\r\n    }\r\n    return result;\r\n  };\r\n\r\n  // Actualizar notificaciones\r\n  const updateNotifications = async (data: Partial<NotificationSettings>) => {\r\n    if (!userId) return { success: false };\r\n    const result = await updateNotificationSettings(userId, data);\r\n    if (result.success && notificationSettings) {\r\n      setNotificationSettings({ ...notificationSettings, ...data });\r\n    }\r\n    return result;\r\n  };\r\n\r\n  return {\r\n    profile,\r\n    preferences,\r\n    privacySettings,\r\n    notificationSettings,\r\n    loading,\r\n    error,\r\n    updateProfile,\r\n    updateMedical,\r\n    updateAvatar,\r\n    updatePrefs,\r\n    updatePrivacy,\r\n    updateNotifications,\r\n  };\r\n}\r\n\r\n// Hook para actividad\r\nexport function useUserActivity(userId: string | undefined) {\r\n  const [activity, setActivity] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    if (!userId) return;\r\n\r\n    const loadActivity = async () => {\r\n      const result = await getUserActivity(userId);\r\n      if (result.success) {\r\n        setActivity(result.data || []);\r\n      }\r\n      setLoading(false);\r\n    };\r\n\r\n    loadActivity();\r\n  }, [userId]);\r\n\r\n  return { activity, loading };\r\n}\r\n\r\n// Hook para sesiones\r\nexport function useUserSessions(userId: string | undefined) {\r\n  const [sessions, setSessions] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    if (!userId) return;\r\n\r\n    const loadSessions = async () => {\r\n      const result = await getUserSessions(userId);\r\n      if (result.success) {\r\n        setSessions(result.data || []);\r\n      }\r\n      setLoading(false);\r\n    };\r\n\r\n    loadSessions();\r\n  }, [userId]);\r\n\r\n  return { sessions, loading };\r\n}\r\n\r\n// Hook para métodos de pago\r\nexport function usePaymentMethods(userId: string | undefined) {\r\n  const [paymentMethods, setPaymentMethods] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    if (!userId) return;\r\n\r\n    const loadPaymentMethods = async () => {\r\n      const result = await getPaymentMethods(userId);\r\n      if (result.success) {\r\n        setPaymentMethods(result.data || []);\r\n      }\r\n      setLoading(false);\r\n    };\r\n\r\n    loadPaymentMethods();\r\n  }, [userId]);\r\n\r\n  return { paymentMethods, loading };\r\n}\r\n\r\n// Hook para transacciones\r\nexport function useTransactions(userId: string | undefined) {\r\n  const [transactions, setTransactions] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    if (!userId) return;\r\n\r\n    const loadTransactions = async () => {\r\n      const result = await getTransactions(userId);\r\n      if (result.success) {\r\n        setTransactions(result.data || []);\r\n      }\r\n      setLoading(false);\r\n    };\r\n\r\n    loadTransactions();\r\n  }, [userId]);\r\n\r\n  return { transactions, loading };\r\n}\r\n\r\n// Hook para documentos\r\nexport function usePatientDocuments(userId: string | undefined) {\r\n  const [documents, setDocuments] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    if (!userId) return;\r\n\r\n    const loadDocuments = async () => {\r\n      const result = await getPatientDocuments(userId);\r\n      if (result.success) {\r\n        setDocuments(result.data || []);\r\n      }\r\n      setLoading(false);\r\n    };\r\n\r\n    loadDocuments();\r\n  }, [userId]);\r\n\r\n  const uploadDoc = async (file: File, documentType: string, documentName: string) => {\r\n    if (!userId) return { success: false };\r\n    const result = await uploadDocument(userId, file, documentType, documentName);\r\n    if (result.success) {\r\n      // Recargar documentos\r\n      const reloadResult = await getPatientDocuments(userId);\r\n      if (reloadResult.success) {\r\n        setDocuments(reloadResult.data || []);\r\n      }\r\n    }\r\n    return result;\r\n  };\r\n\r\n  return { documents, loading, uploadDoc };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-patient-service-metrics.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-secretary-permissions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-sidebar-state.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-tasks.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-tauri-appointments.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[442,445],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[442,445],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1561,1564],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1561,1564],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2634,2637],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2634,2637],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":90,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3329,3332],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3329,3332],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":105,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3849,3852],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3849,3852],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect, useCallback } from \"react\";\r\nimport { tauriApiService } from \"@/lib/services/tauri-api-service\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\n\r\nexport interface Appointment {\r\n    id: string;\r\n    doctor_id: string;\r\n    patient_id: string;\r\n    date: string;\r\n    status: 'scheduled' | 'confirmed' | 'cancelled' | 'completed';\r\n    type: string;\r\n    notes?: string;\r\n    [key: string]: any;\r\n}\r\n\r\nexport function useTauriAppointments(doctorId: string) {\r\n    const [appointments, setAppointments] = useState<Appointment[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    const loadAppointments = useCallback(async () => {\r\n        if (!doctorId) return;\r\n        try {\r\n            setLoading(true);\r\n            // Use getOfflineData first for immediate display, then sync\r\n            const cached = await tauriApiService.getOfflineData<Appointment[]>(`appointments_${doctorId}`);\r\n            if (cached) {\r\n                setAppointments(cached);\r\n            }\r\n\r\n            const { data: { session } } = await supabase.auth.getSession();\r\n            const token = session?.access_token || '';\r\n\r\n            const data = await tauriApiService.supabaseGet<Appointment[]>(\r\n                `/rest/v1/appointments?doctor_id=eq.${doctorId}&select=*`,\r\n                token,\r\n                `appointments_${doctorId}`\r\n            );\r\n            setAppointments(data);\r\n            setError(null);\r\n        } catch (err: any) {\r\n            console.error(\"Error loading appointments:\", err);\r\n            // If network fails, we rely on cache which might have been set above\r\n            if (!appointments.length) {\r\n                setError(err.message || \"Failed to load appointments\");\r\n            }\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }, [doctorId, appointments.length]);\r\n\r\n    useEffect(() => {\r\n        loadAppointments();\r\n    }, [loadAppointments]);\r\n\r\n    const createAppointment = async (appointmentData: Omit<Appointment, 'id'>) => {\r\n        try {\r\n            const { data: { session } } = await supabase.auth.getSession();\r\n            const token = session?.access_token || '';\r\n\r\n            // For Supabase REST API\r\n            const newAppointment = await tauriApiService.supabasePost<Appointment>(\r\n                \"/rest/v1/appointments\",\r\n                appointmentData,\r\n                token\r\n            );\r\n            setAppointments((prev) => [...prev, newAppointment]);\r\n            return newAppointment;\r\n        } catch (err: any) {\r\n            throw new Error(err.message);\r\n        }\r\n    };\r\n\r\n    const updateAppointment = async (id: string, updates: Partial<Appointment>) => {\r\n        try {\r\n            const { data: { session } } = await supabase.auth.getSession();\r\n            const token = session?.access_token || '';\r\n\r\n            const updated = await tauriApiService.supabasePatch<Appointment>(\r\n                `/rest/v1/appointments?id=eq.${id}`,\r\n                updates,\r\n                token\r\n            );\r\n            setAppointments((prev) =>\r\n                prev.map((apt) => (apt.id === id ? { ...apt, ...updates } : apt))\r\n            );\r\n            return updated;\r\n        } catch (err: any) {\r\n            throw new Error(err.message);\r\n        }\r\n    };\r\n\r\n    const deleteAppointment = async (id: string) => {\r\n        try {\r\n            const { data: { session } } = await supabase.auth.getSession();\r\n            const token = session?.access_token || '';\r\n\r\n            await tauriApiService.supabaseDelete(\r\n                `/rest/v1/appointments?id=eq.${id}`,\r\n                token\r\n            );\r\n            setAppointments((prev) => prev.filter((apt) => apt.id !== id));\r\n        } catch (err: any) {\r\n            throw new Error(err.message);\r\n        }\r\n    };\r\n\r\n    return {\r\n        appointments,\r\n        loading,\r\n        error,\r\n        refresh: loadAppointments,\r\n        createAppointment,\r\n        updateAppointment,\r\n        deleteAppointment,\r\n    };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-tauri-medical-records.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[390,393],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[390,393],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":39,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1405,1408],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1405,1408],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":63,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2227,2230],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2227,2230],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":82,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2919,2922],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2919,2922],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect, useCallback } from \"react\";\r\nimport { tauriApiService } from \"@/lib/services/tauri-api-service\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\n\r\nexport interface MedicalRecord {\r\n    id: string;\r\n    patient_id: string;\r\n    doctor_id: string;\r\n    diagnosis: string;\r\n    treatment: string;\r\n    created_at: string;\r\n    [key: string]: any;\r\n}\r\n\r\nexport function useTauriMedicalRecords(patientId: string) {\r\n    const [records, setRecords] = useState<MedicalRecord[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    const loadRecords = useCallback(async () => {\r\n        if (!patientId) return;\r\n        try {\r\n            setLoading(true);\r\n            const cached = await tauriApiService.getOfflineData<MedicalRecord[]>(`records_${patientId}`);\r\n            if (cached) setRecords(cached);\r\n\r\n            const { data: { session } } = await supabase.auth.getSession();\r\n            const token = session?.access_token || '';\r\n\r\n            const data = await tauriApiService.supabaseGet<MedicalRecord[]>(\r\n                `/rest/v1/medical_records?patient_id=eq.${patientId}&select=*&order=created_at.desc`,\r\n                token,\r\n                `records_${patientId}`\r\n            );\r\n            setRecords(data);\r\n            setError(null);\r\n        } catch (err: any) {\r\n            console.error(err);\r\n            if (!records.length) setError(err.message);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }, [patientId, records.length]);\r\n\r\n    useEffect(() => {\r\n        loadRecords();\r\n    }, [loadRecords]);\r\n\r\n    const createRecord = async (recordData: Omit<MedicalRecord, 'id' | 'created_at'>) => {\r\n        try {\r\n            const { data: { session } } = await supabase.auth.getSession();\r\n            const token = session?.access_token || '';\r\n\r\n            const newRecord = await tauriApiService.supabasePost<MedicalRecord>(\r\n                \"/rest/v1/medical_records\",\r\n                recordData,\r\n                token\r\n            );\r\n            setRecords((prev) => [newRecord, ...prev]);\r\n            return newRecord;\r\n        } catch (err: any) {\r\n            throw new Error(err.message);\r\n        }\r\n    };\r\n\r\n    const updateRecord = async (id: string, updates: Partial<MedicalRecord>) => {\r\n        try {\r\n            const { data: { session } } = await supabase.auth.getSession();\r\n            const token = session?.access_token || '';\r\n\r\n            const updated = await tauriApiService.supabasePatch<MedicalRecord>(\r\n                `/rest/v1/medical_records?id=eq.${id}`,\r\n                updates,\r\n                token\r\n            );\r\n            setRecords((prev) =>\r\n                prev.map((rec) => (rec.id === id ? { ...rec, ...updates } : rec))\r\n            );\r\n            return updated;\r\n        } catch (err: any) {\r\n            throw new Error(err.message);\r\n        }\r\n    };\r\n\r\n    return {\r\n        records,\r\n        loading,\r\n        error,\r\n        refresh: loadRecords,\r\n        createRecord,\r\n        updateRecord,\r\n    };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-tauri-patients.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[353,356],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[353,356],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1316,1319],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1316,1319],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2231,2234],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2231,2234],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect, useCallback } from \"react\";\r\nimport { tauriApiService } from \"@/lib/services/tauri-api-service\";\r\nimport { supabase } from \"@/lib/supabase/client\";\r\n\r\nexport interface Patient {\r\n    id: string;\r\n    first_name: string;\r\n    last_name: string;\r\n    email?: string;\r\n    phone?: string;\r\n    [key: string]: any;\r\n}\r\n\r\nexport function useTauriPatients(doctorId: string) {\r\n    const [patients, setPatients] = useState<Patient[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    const loadPatients = useCallback(async () => {\r\n        if (!doctorId) return;\r\n        try {\r\n            setLoading(true);\r\n            const cached = await tauriApiService.getOfflineData<Patient[]>(`patients_${doctorId}`);\r\n            if (cached) setPatients(cached);\r\n\r\n            const { data: { session } } = await supabase.auth.getSession();\r\n            const token = session?.access_token || '';\r\n\r\n            const data = await tauriApiService.supabaseGet<Patient[]>(\r\n                `/rest/v1/patients?doctor_id=eq.${doctorId}&select=*`,\r\n                token,\r\n                `patients_${doctorId}`\r\n            );\r\n            setPatients(data);\r\n            setError(null);\r\n        } catch (err: any) {\r\n            console.error(err);\r\n            if (!patients.length) setError(err.message);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }, [doctorId, patients.length]);\r\n\r\n    useEffect(() => {\r\n        loadPatients();\r\n    }, [loadPatients]);\r\n\r\n    const getPatient = async (patientId: string) => {\r\n        try {\r\n            // Check cache first\r\n            if (patients.length) {\r\n                const found = patients.find(p => p.id === patientId);\r\n                if (found) return found;\r\n            }\r\n\r\n            const { data: { session } } = await supabase.auth.getSession();\r\n            const token = session?.access_token || '';\r\n\r\n            return await tauriApiService.supabaseGet<Patient>(\r\n                `/rest/v1/patients?id=eq.${patientId}&select=*`,\r\n                token,\r\n                `patient_${patientId}`\r\n            );\r\n        } catch (err: any) {\r\n            throw new Error(err.message);\r\n        }\r\n    };\r\n\r\n    return {\r\n        patients,\r\n        loading,\r\n        error,\r\n        refresh: loadPatients,\r\n        getPatient,\r\n    };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-telemedicine.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getSessionPrescriptions' is defined but never used.","line":18,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":26},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-telemedicine.ts:57:10\n  55 |\n  56 |   useEffect(() => {\n> 57 |     void loadSessions();\n     |          ^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  58 |   }, [loadSessions]);\n  59 |\n  60 |   return { sessions, loading, error, refreshSessions: loadSessions };","line":57,"column":10,"nodeType":null,"endLine":57,"endColumn":22},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-telemedicine.ts:82:10\n  80 |\n  81 |   useEffect(() => {\n> 82 |     void loadSessions();\n     |          ^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  83 |   }, [loadSessions]);\n  84 |\n  85 |   return { sessions, loading, error, refreshSessions: loadSessions };","line":82,"column":10,"nodeType":null,"endLine":82,"endColumn":22},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-telemedicine.ts:107:10\n  105 |\n  106 |   useEffect(() => {\n> 107 |     void loadSession();\n      |          ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  108 |   }, [loadSession]);\n  109 |\n  110 |   return { session, loading, error, refreshSession: loadSession };","line":107,"column":10,"nodeType":null,"endLine":107,"endColumn":21},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-telemedicine.ts:195:10\n  193 |\n  194 |   useEffect(() => {\n> 195 |     void loadParticipants();\n      |          ^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  196 |   }, [loadParticipants]);\n  197 |\n  198 |   const join = async (userId: string, joinData: JoinSessionData) => {","line":195,"column":10,"nodeType":null,"endLine":195,"endColumn":26},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-telemedicine.ts:236:10\n  234 |\n  235 |   useEffect(() => {\n> 236 |     void loadMessages();\n      |          ^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  237 |   }, [loadMessages]);\n  238 |\n  239 |   const send = async (senderId: string, messageData: SendMessageData) => {","line":236,"column":10,"nodeType":null,"endLine":236,"endColumn":22},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-telemedicine.ts:278:10\n  276 |\n  277 |   useEffect(() => {\n> 278 |     void loadPrescriptions();\n      |          ^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  279 |   }, [loadPrescriptions]);\n  280 |\n  281 |   return { prescriptions, loading, error, refreshPrescriptions: loadPrescriptions };","line":278,"column":10,"nodeType":null,"endLine":278,"endColumn":27},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-telemedicine.ts:350:10\n  348 |\n  349 |   useEffect(() => {\n> 350 |     void loadWaitingPatients();\n      |          ^^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  351 |   }, [loadWaitingPatients]);\n  352 |\n  353 |   const admit = async (waitingRoomId: string) => {","line":350,"column":10,"nodeType":null,"endLine":350,"endColumn":29}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from \"react\";\r\nimport {\r\n  getPatientSessions,\r\n  getDoctorSessions,\r\n  getSession,\r\n  createTelemedicineSession,\r\n  startSession,\r\n  endSession,\r\n  updateSession,\r\n  joinSession,\r\n  leaveSession,\r\n  getSessionParticipants,\r\n  sendMessage,\r\n  getSessionMessages,\r\n  markMessagesAsRead,\r\n  createPrescription,\r\n  getPatientPrescriptions,\r\n  getSessionPrescriptions,\r\n  enterWaitingRoom,\r\n  getWaitingRoomPatients,\r\n  admitPatient,\r\n  getPatientSessionStats,\r\n} from \"@/lib/supabase/services/telemedicine-service\";\r\nimport type {\r\n  TelemedicineSession,\r\n  TelemedicineParticipant,\r\n  TelemedicineChatMessage,\r\n  TelemedicinePrescription,\r\n  WaitingRoomEntry,\r\n  CreateSessionData,\r\n  UpdateSessionData,\r\n  CreatePrescriptionData,\r\n  SendMessageData,\r\n  JoinSessionData,\r\n  SessionStats,\r\n} from \"@/lib/supabase/types/telemedicine\";\r\n\r\n// Hook para sesiones del paciente\r\nexport function usePatientSessions(patientId: string | undefined) {\r\n  const [sessions, setSessions] = useState<TelemedicineSession[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const loadSessions = useCallback(async () => {\r\n    if (!patientId) return;\r\n    setLoading(true);\r\n    const result = await getPatientSessions(patientId);\r\n    if (result.success) {\r\n      setSessions(result.data);\r\n    } else {\r\n      setError(String(result.error) || 'Error loading patient sessions');\r\n    }\r\n    setLoading(false);\r\n  }, [patientId]);\r\n\r\n  useEffect(() => {\r\n    void loadSessions();\r\n  }, [loadSessions]);\r\n\r\n  return { sessions, loading, error, refreshSessions: loadSessions };\r\n}\r\n\r\n// Hook para sesiones del doctor\r\nexport function useDoctorSessions(doctorId: string | undefined) {\r\n  const [sessions, setSessions] = useState<TelemedicineSession[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const loadSessions = useCallback(async () => {\r\n    if (!doctorId) return;\r\n    setLoading(true);\r\n    const result = await getDoctorSessions(doctorId);\r\n    if (result.success) {\r\n      setSessions(result.data);\r\n    } else {\r\n      setError(String(result.error) || 'Error loading doctor sessions');\r\n    }\r\n    setLoading(false);\r\n  }, [doctorId]);\r\n\r\n  useEffect(() => {\r\n    void loadSessions();\r\n  }, [loadSessions]);\r\n\r\n  return { sessions, loading, error, refreshSessions: loadSessions };\r\n}\r\n\r\n// Hook para una sesión específica\r\nexport function useSession(sessionId: string | undefined) {\r\n  const [session, setSession] = useState<TelemedicineSession | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const loadSession = useCallback(async () => {\r\n    if (!sessionId) return;\r\n    setLoading(true);\r\n    const result = await getSession(sessionId);\r\n    if (result.success) {\r\n      setSession(result.data);\r\n    } else {\r\n      setError(String(result.error) || 'Error loading session');\r\n    }\r\n    setLoading(false);\r\n  }, [sessionId]);\r\n\r\n  useEffect(() => {\r\n    void loadSession();\r\n  }, [loadSession]);\r\n\r\n  return { session, loading, error, refreshSession: loadSession };\r\n}\r\n\r\n// Hook para crear sesión\r\nexport function useCreateSession() {\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const create = async (patientId: string, sessionData: CreateSessionData) => {\r\n    setLoading(true);\r\n    setError(null);\r\n    const result = await createTelemedicineSession(patientId, sessionData);\r\n    setLoading(false);\r\n    if (!result.success) {\r\n      setError(String(result.error) || 'Error creating session');\r\n    }\r\n    return result;\r\n  };\r\n\r\n  return { create, loading, error };\r\n}\r\n\r\n// Hook para gestionar sesión activa\r\nexport function useActiveSession(sessionId: string | undefined) {\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const start = async () => {\r\n    if (!sessionId) return { success: false, error: \"No session ID\" };\r\n    setLoading(true);\r\n    setError(null);\r\n    const result = await startSession(sessionId);\r\n    setLoading(false);\r\n    if (!result.success) {\r\n      setError(String(result.error) || 'Error starting session');\r\n    }\r\n    return result;\r\n  };\r\n\r\n  const end = async (notes?: string) => {\r\n    if (!sessionId) return { success: false, error: \"No session ID\" };\r\n    setLoading(true);\r\n    setError(null);\r\n    const result = await endSession(sessionId, notes);\r\n    setLoading(false);\r\n    if (!result.success) {\r\n      setError(String(result.error) || 'Error ending session');\r\n    }\r\n    return result;\r\n  };\r\n\r\n  const update = async (updates: UpdateSessionData) => {\r\n    if (!sessionId) return { success: false, error: \"No session ID\" };\r\n    setLoading(true);\r\n    setError(null);\r\n    const result = await updateSession(sessionId, updates);\r\n    setLoading(false);\r\n    if (!result.success) {\r\n      setError(String(result.error) || 'Error updating session');\r\n    }\r\n    return result;\r\n  };\r\n\r\n  return { start, end, update, loading, error };\r\n}\r\n\r\n// Hook para participantes\r\nexport function useSessionParticipants(sessionId: string | undefined) {\r\n  const [participants, setParticipants] = useState<TelemedicineParticipant[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const loadParticipants = useCallback(async () => {\r\n    if (!sessionId) return;\r\n    setLoading(true);\r\n    const result = await getSessionParticipants(sessionId);\r\n    if (result.success) {\r\n      setParticipants(result.data);\r\n    } else {\r\n      setError(String(result.error) || 'Error loading participants');\r\n    }\r\n    setLoading(false);\r\n  }, [sessionId]);\r\n\r\n  useEffect(() => {\r\n    void loadParticipants();\r\n  }, [loadParticipants]);\r\n\r\n  const join = async (userId: string, joinData: JoinSessionData) => {\r\n    const result = await joinSession(userId, joinData);\r\n    if (result.success) {\r\n      await loadParticipants();\r\n    }\r\n    return result;\r\n  };\r\n\r\n  const leave = async (participantId: string) => {\r\n    const result = await leaveSession(participantId);\r\n    if (result.success) {\r\n      await loadParticipants();\r\n    }\r\n    return result;\r\n  };\r\n\r\n  return { participants, loading, error, join, leave, refreshParticipants: loadParticipants };\r\n}\r\n\r\n// Hook para chat\r\nexport function useSessionChat(sessionId: string | undefined) {\r\n  const [messages, setMessages] = useState<TelemedicineChatMessage[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const loadMessages = useCallback(async () => {\r\n    if (!sessionId) return;\r\n    setLoading(true);\r\n    const result = await getSessionMessages(sessionId);\r\n    if (result.success) {\r\n      setMessages(result.data);\r\n    } else {\r\n      setError(String(result.error) || 'Error loading messages');\r\n    }\r\n    setLoading(false);\r\n  }, [sessionId]);\r\n\r\n  useEffect(() => {\r\n    void loadMessages();\r\n  }, [loadMessages]);\r\n\r\n  const send = async (senderId: string, messageData: SendMessageData) => {\r\n    const result = await sendMessage(senderId, messageData);\r\n    if (result.success) {\r\n      await loadMessages();\r\n    }\r\n    return result;\r\n  };\r\n\r\n  const markAsRead = async (userId: string) => {\r\n    if (!sessionId) return;\r\n    const result = await markMessagesAsRead(sessionId, userId);\r\n    if (result.success) {\r\n      await loadMessages();\r\n    }\r\n    return result;\r\n  };\r\n\r\n  return { messages, loading, error, send, markAsRead, refreshMessages: loadMessages };\r\n}\r\n\r\n// Hook para recetas\r\nexport function usePatientPrescriptions(patientId: string | undefined) {\r\n  const [prescriptions, setPrescriptions] = useState<TelemedicinePrescription[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const loadPrescriptions = useCallback(async () => {\r\n    if (!patientId) return;\r\n    setLoading(true);\r\n    const result = await getPatientPrescriptions(patientId);\r\n    if (result.success) {\r\n      setPrescriptions(result.data);\r\n    } else {\r\n      setError(String(result.error) || 'Error loading prescriptions');\r\n    }\r\n    setLoading(false);\r\n  }, [patientId]);\r\n\r\n  useEffect(() => {\r\n    void loadPrescriptions();\r\n  }, [loadPrescriptions]);\r\n\r\n  return { prescriptions, loading, error, refreshPrescriptions: loadPrescriptions };\r\n}\r\n\r\n// Hook para crear receta\r\nexport function useCreatePrescription() {\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const create = async (\r\n    doctorId: string,\r\n    patientId: string,\r\n    prescriptionData: CreatePrescriptionData\r\n  ) => {\r\n    setLoading(true);\r\n    setError(null);\r\n    const result = await createPrescription(doctorId, patientId, prescriptionData);\r\n    setLoading(false);\r\n    if (!result.success) {\r\n      setError(String(result.error) || 'Error creating prescription');\r\n    }\r\n    return result;\r\n  };\r\n\r\n  return { create, loading, error };\r\n}\r\n\r\n// Hook para sala de espera (paciente)\r\nexport function useWaitingRoom() {\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const enter = async (\r\n    patientId: string,\r\n    sessionId: string,\r\n    reasonForVisit?: string,\r\n    priority?: 'low' | 'normal' | 'high' | 'urgent'\r\n  ) => {\r\n    setLoading(true);\r\n    setError(null);\r\n    const result = await enterWaitingRoom(patientId, sessionId, reasonForVisit, priority);\r\n    setLoading(false);\r\n    if (!result.success) {\r\n      setError(String(result.error) || 'Error entering waiting room');\r\n    }\r\n    return result;\r\n  };\r\n\r\n  return { enter, loading, error };\r\n}\r\n\r\n// Hook para sala de espera (doctor)\r\nexport function useDoctorWaitingRoom(doctorId: string | undefined) {\r\n  const [waitingPatients, setWaitingPatients] = useState<WaitingRoomEntry[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const loadWaitingPatients = useCallback(async () => {\r\n    if (!doctorId) return;\r\n    setLoading(true);\r\n    const result = await getWaitingRoomPatients(doctorId);\r\n    if (result.success) {\r\n      setWaitingPatients(result.data);\r\n    } else {\r\n      setError(String(result.error) || 'Error loading waiting patients');\r\n    }\r\n    setLoading(false);\r\n  }, [doctorId]);\r\n\r\n  useEffect(() => {\r\n    void loadWaitingPatients();\r\n  }, [loadWaitingPatients]);\r\n\r\n  const admit = async (waitingRoomId: string) => {\r\n    const result = await admitPatient(waitingRoomId);\r\n    if (result.success) {\r\n      await loadWaitingPatients();\r\n    }\r\n    return result;\r\n  };\r\n\r\n  return { waitingPatients, loading, error, admit, refreshWaitingRoom: loadWaitingPatients };\r\n}\r\n\r\n// Hook para estadísticas\r\nexport function useSessionStats(patientId: string | undefined) {\r\n  const [stats, setStats] = useState<SessionStats | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (!patientId) return;\r\n\r\n    const loadStats = async () => {\r\n      setLoading(true);\r\n      const result = await getPatientSessionStats(patientId);\r\n      if (result.success) {\r\n        setStats(result.data);\r\n      } else {\r\n        setError(String(result.error) || 'Error loading stats');\r\n      }\r\n      setLoading(false);\r\n    };\r\n\r\n    loadStats();\r\n  }, [patientId]);\r\n\r\n  return { stats, loading, error };\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-theme-color.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-tour-guide.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\use-widget-modes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\useIMCCalculation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\hooks\\useMedicalForm.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\academy\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\academy\\services\\gamification.service.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'LevelInfo' is defined but never used.","line":8,"column":49,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":58}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file gamification.service.ts\r\n * @description Servicio para el sistema de gamificación de Academy (XP, rachas, vidas, ligas)\r\n * @module Academy/Services\r\n */\r\n\r\nimport { createClient } from '@/lib/supabase/client';\r\nimport type { UserStats, StreakInfo, LivesInfo, LevelInfo, LeagueTier } from '../types/gamification.types';\r\n\r\n/** XP necesario por nivel (progresión exponencial suave) */\r\nconst XP_PER_LEVEL = [0, 100, 250, 450, 700, 1000, 1350, 1750, 2200, 2700, 3250];\r\n\r\n/** Tiempo de recarga de vidas en segundos */\r\nconst LIFE_REFILL_TIME = 30 * 60; // 30 minutos\r\n\r\n/**\r\n * Servicio para gestión de gamificación de Academy\r\n */\r\nexport const AcademyGamificationService = {\r\n    /**\r\n     * Obtiene las estadísticas del usuario\r\n     */\r\n    async getUserStats(userId: string): Promise<UserStats | null> {\r\n        const supabase = createClient();\r\n\r\n        const { data, error } = await supabase\r\n            .from('academy_user_stats')\r\n            .select('*')\r\n            .eq('user_id', userId)\r\n            .single();\r\n\r\n        if (error) {\r\n            if (error.code === 'PGRST116') return null;\r\n            console.error('[AcademyGamificationService] Error:', error);\r\n            throw new Error('Error al obtener estadísticas');\r\n        }\r\n\r\n        return data ? mapStatsFromDb(data) : null;\r\n    },\r\n\r\n    /**\r\n     * Añade XP al usuario y verifica si sube de nivel\r\n     */\r\n    async addXp(userId: string, amount: number): Promise<{ newXp: number; leveledUp: boolean; newLevel: number }> {\r\n        const supabase = createClient();\r\n        const stats = await this.getUserStats(userId);\r\n        if (!stats) throw new Error('Usuario no encontrado');\r\n\r\n        const newXp = stats.totalXp + amount;\r\n        const { level: newLevel, xpToNext } = calculateLevel(newXp);\r\n        const leveledUp = newLevel > stats.currentLevel;\r\n\r\n        await supabase.from('academy_user_stats').update({\r\n            total_xp: newXp,\r\n            current_level: newLevel,\r\n            xp_to_next_level: xpToNext,\r\n            league_xp_this_week: stats.leagueXpThisWeek + amount,\r\n        }).eq('user_id', userId);\r\n\r\n        return { newXp, leveledUp, newLevel };\r\n    },\r\n\r\n    /**\r\n     * Obtiene información de racha actual\r\n     */\r\n    async getStreakInfo(userId: string): Promise<StreakInfo> {\r\n        const stats = await this.getUserStats(userId);\r\n        const today = new Date().toISOString().split('T')[0];\r\n        const studiedToday = stats?.lastActivityDate === today;\r\n\r\n        return {\r\n            currentStreak: stats?.currentStreak ?? 0,\r\n            longestStreak: stats?.longestStreak ?? 0,\r\n            isAtRisk: !studiedToday && (stats?.currentStreak ?? 0) > 0,\r\n            freezeAvailable: stats?.streakFreezeAvailable ?? 0,\r\n            studiedToday,\r\n            deadline: !studiedToday ? `${today}T23:59:59` : null,\r\n        };\r\n    },\r\n\r\n    /**\r\n     * Actualiza la racha del día\r\n     */\r\n    async updateStreak(userId: string, xpEarned: number): Promise<{ newStreak: number; maintained: boolean }> {\r\n        const supabase = createClient();\r\n        const stats = await this.getUserStats(userId);\r\n        if (!stats) throw new Error('Usuario no encontrado');\r\n\r\n        const today = new Date().toISOString().split('T')[0];\r\n        const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];\r\n\r\n        let newStreak = stats.currentStreak;\r\n        let maintained = false;\r\n\r\n        if (stats.lastActivityDate === today) {\r\n            // Ya estudió hoy, solo actualizar XP del día\r\n            maintained = true;\r\n        } else if (stats.lastActivityDate === yesterday) {\r\n            // Estudió ayer, incrementar racha\r\n            newStreak = stats.currentStreak + 1;\r\n            maintained = true;\r\n        } else if (stats.streakFreezeAvailable > 0 && stats.currentStreak > 0) {\r\n            // Usar streak freeze\r\n            await supabase.from('academy_user_stats').update({\r\n                streak_freeze_available: stats.streakFreezeAvailable - 1,\r\n            }).eq('user_id', userId);\r\n            newStreak = stats.currentStreak + 1;\r\n            maintained = true;\r\n        } else {\r\n            // Racha perdida, reiniciar\r\n            newStreak = 1;\r\n        }\r\n\r\n        // Actualizar stats\r\n        await supabase.from('academy_user_stats').update({\r\n            current_streak: newStreak,\r\n            longest_streak: Math.max(newStreak, stats.longestStreak),\r\n            last_activity_date: today,\r\n        }).eq('user_id', userId);\r\n\r\n        // Registrar en historial\r\n        await supabase.from('academy_streak_history').upsert({\r\n            user_id: userId,\r\n            date: today,\r\n            xp_earned: xpEarned,\r\n            lessons_completed: 1,\r\n            streak_maintained: maintained,\r\n        }, { onConflict: 'user_id,date' });\r\n\r\n        return { newStreak, maintained };\r\n    },\r\n\r\n    /**\r\n     * Obtiene información de vidas\r\n     */\r\n    async getLivesInfo(userId: string): Promise<LivesInfo> {\r\n        const stats = await this.getUserStats(userId);\r\n        if (!stats) return { current: 5, max: 5, isUnlimited: false, nextLifeIn: null, fullRefillIn: null };\r\n\r\n        const now = Date.now();\r\n        const unlimitedUntil = stats.unlimitedLivesUntil ? new Date(stats.unlimitedLivesUntil).getTime() : 0;\r\n        const isUnlimited = unlimitedUntil > now;\r\n\r\n        if (isUnlimited) {\r\n            return { current: stats.maxLives, max: stats.maxLives, isUnlimited: true, nextLifeIn: null, fullRefillIn: null };\r\n        }\r\n\r\n        // Calcular vidas regeneradas desde última recarga\r\n        const lastRefill = new Date(stats.livesLastRefill).getTime();\r\n        const secondsSinceRefill = Math.floor((now - lastRefill) / 1000);\r\n        const livesRegened = Math.floor(secondsSinceRefill / LIFE_REFILL_TIME);\r\n        const currentLives = Math.min(stats.lives + livesRegened, stats.maxLives);\r\n\r\n        const nextLifeIn = currentLives < stats.maxLives\r\n            ? LIFE_REFILL_TIME - (secondsSinceRefill % LIFE_REFILL_TIME)\r\n            : null;\r\n\r\n        return {\r\n            current: currentLives,\r\n            max: stats.maxLives,\r\n            isUnlimited: false,\r\n            nextLifeIn,\r\n            fullRefillIn: nextLifeIn ? nextLifeIn + (stats.maxLives - currentLives - 1) * LIFE_REFILL_TIME : null,\r\n        };\r\n    },\r\n\r\n    /**\r\n     * Consume una vida\r\n     */\r\n    async useLife(userId: string): Promise<{ success: boolean; livesRemaining: number }> {\r\n        const livesInfo = await this.getLivesInfo(userId);\r\n        if (livesInfo.isUnlimited) return { success: true, livesRemaining: livesInfo.max };\r\n        if (livesInfo.current <= 0) return { success: false, livesRemaining: 0 };\r\n\r\n        const supabase = createClient();\r\n        await supabase.from('academy_user_stats').update({\r\n            lives: livesInfo.current - 1,\r\n            lives_last_refill: new Date().toISOString(),\r\n        }).eq('user_id', userId);\r\n\r\n        return { success: true, livesRemaining: livesInfo.current - 1 };\r\n    },\r\n\r\n    /**\r\n     * Añade o resta gemas\r\n     */\r\n    async updateGems(\r\n        userId: string,\r\n        amount: number,\r\n        type: 'reward' | 'purchase' | 'spend',\r\n        description: string\r\n    ): Promise<number> {\r\n        const supabase = createClient();\r\n        const stats = await this.getUserStats(userId);\r\n        if (!stats) throw new Error('Usuario no encontrado');\r\n\r\n        const newBalance = Math.max(0, stats.gems + amount);\r\n\r\n        await supabase.from('academy_user_stats').update({ gems: newBalance }).eq('user_id', userId);\r\n\r\n        // Registrar transacción\r\n        await supabase.from('academy_gem_transactions').insert({\r\n            user_id: userId,\r\n            amount,\r\n            balance_after: newBalance,\r\n            transaction_type: type,\r\n            description,\r\n        });\r\n\r\n        return newBalance;\r\n    },\r\n};\r\n\r\n/** Calcula nivel basado en XP total */\r\nfunction calculateLevel(totalXp: number): { level: number; xpToNext: number } {\r\n    let level = 1;\r\n    for (let i = 1; i < XP_PER_LEVEL.length; i++) {\r\n        if (totalXp >= XP_PER_LEVEL[i]) level = i + 1;\r\n        else break;\r\n    }\r\n    const nextLevelXp = XP_PER_LEVEL[level] ?? XP_PER_LEVEL[level - 1] + 600;\r\n    return { level, xpToNext: nextLevelXp - totalXp };\r\n}\r\n\r\n/** Mapea stats de DB a tipo TypeScript */\r\nfunction mapStatsFromDb(data: Record<string, unknown>): UserStats {\r\n    return {\r\n        id: data.id as string,\r\n        userId: data.user_id as string,\r\n        totalXp: (data.total_xp as number) || 0,\r\n        currentLevel: (data.current_level as number) || 1,\r\n        xpToNextLevel: (data.xp_to_next_level as number) || 100,\r\n        gems: (data.gems as number) || 0,\r\n        currentStreak: (data.current_streak as number) || 0,\r\n        longestStreak: (data.longest_streak as number) || 0,\r\n        lastActivityDate: data.last_activity_date as string | null,\r\n        streakFreezeAvailable: (data.streak_freeze_available as number) || 0,\r\n        lives: (data.lives as number) || 5,\r\n        maxLives: (data.max_lives as number) || 5,\r\n        livesLastRefill: data.lives_last_refill as string,\r\n        unlimitedLivesUntil: data.unlimited_lives_until as string | null,\r\n        currentLeague: (data.current_league as LeagueTier) || 'bronze',\r\n        leagueXpThisWeek: (data.league_xp_this_week as number) || 0,\r\n        leagueStartDate: data.league_start_date as string | null,\r\n        totalLessonsCompleted: (data.total_lessons_completed as number) || 0,\r\n        totalQuestionsAnswered: (data.total_questions_answered as number) || 0,\r\n        totalCorrectAnswers: (data.total_correct_answers as number) || 0,\r\n        totalTimeSpentMinutes: (data.total_time_spent_minutes as number) || 0,\r\n        createdAt: data.created_at as string,\r\n        updatedAt: data.updated_at as string,\r\n    };\r\n}\r\n\r\nexport default AcademyGamificationService;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\academy\\services\\lesson.service.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":120,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4251,4254],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4251,4254],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":120,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4259,4262],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4259,4262],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * @file lesson.service.ts\r\n * @description Servicio para gestionar lecciones y contenido de Red Salud Academy\r\n * @module Academy/Services\r\n * \r\n * @example\r\n * import { AcademyLessonService } from '@/lib/academy';\r\n * \r\n * const specialties = await AcademyLessonService.getActiveSpecialties();\r\n * const lesson = await AcademyLessonService.getLessonWithQuestions('lesson-id');\r\n */\r\n\r\nimport { createClient } from '@/lib/supabase/client';\r\nimport type {\r\n    AcademySpecialty,\r\n    AcademyLevel,\r\n    AcademyUnit,\r\n    AcademyLesson,\r\n    AcademyQuestion,\r\n    LessonWithDetails,\r\n    SpecialtyWithTree,\r\n} from '../types/lesson.types';\r\n\r\n/**\r\n * Servicio para gestión de contenido educativo de Academy\r\n * \r\n * Proporciona métodos para:\r\n * - Obtener especialidades, niveles, unidades y lecciones\r\n * - Cargar contenido completo para el reproductor de lecciones\r\n * - Navegación entre lecciones\r\n */\r\nexport const AcademyLessonService = {\r\n    // ============================================================================\r\n    // ESPECIALIDADES\r\n    // ============================================================================\r\n\r\n    /**\r\n     * Obtiene todas las especialidades activas\r\n     * @returns Lista de especialidades ordenadas\r\n     */\r\n    async getActiveSpecialties(): Promise<AcademySpecialty[]> {\r\n        const supabase = createClient();\r\n\r\n        const { data, error } = await supabase\r\n            .from('academy_specialties')\r\n            .select('*')\r\n            .eq('is_active', true)\r\n            .order('order_index', { ascending: true });\r\n\r\n        if (error) {\r\n            console.error('[AcademyLessonService] Error fetching specialties:', error);\r\n            throw new Error('Error al cargar especialidades');\r\n        }\r\n\r\n        return (data || []).map(mapSpecialtyFromDb);\r\n    },\r\n\r\n    /**\r\n     * Obtiene una especialidad por su slug\r\n     * @param slug - Slug de la especialidad (ej: 'cardiologia')\r\n     * @returns Especialidad o null si no existe\r\n     */\r\n    async getSpecialtyBySlug(slug: string): Promise<AcademySpecialty | null> {\r\n        const supabase = createClient();\r\n\r\n        const { data, error } = await supabase\r\n            .from('academy_specialties')\r\n            .select('*')\r\n            .eq('slug', slug)\r\n            .eq('is_active', true)\r\n            .single();\r\n\r\n        if (error) {\r\n            if (error.code === 'PGRST116') return null; // Not found\r\n            console.error('[AcademyLessonService] Error fetching specialty:', error);\r\n            throw new Error('Error al cargar especialidad');\r\n        }\r\n\r\n        return data ? mapSpecialtyFromDb(data) : null;\r\n    },\r\n\r\n    /**\r\n     * Obtiene una especialidad con su árbol completo de contenido\r\n     * @param slug - Slug de la especialidad\r\n     * @returns Especialidad con niveles, unidades y lecciones\r\n     */\r\n    async getSpecialtyWithTree(slug: string): Promise<SpecialtyWithTree | null> {\r\n        const supabase = createClient();\r\n\r\n        // Obtener especialidad\r\n        const specialty = await this.getSpecialtyBySlug(slug);\r\n        if (!specialty) return null;\r\n\r\n        // Obtener niveles con unidades y lecciones\r\n        const { data: levels, error: levelsError } = await supabase\r\n            .from('academy_levels')\r\n            .select(`\r\n        *,\r\n        units:academy_units (\r\n          *,\r\n          lessons:academy_lessons (*)\r\n        )\r\n      `)\r\n            .eq('specialty_id', specialty.id)\r\n            .order('order_index', { ascending: true });\r\n\r\n        if (levelsError) {\r\n            console.error('[AcademyLessonService] Error fetching specialty tree:', levelsError);\r\n            throw new Error('Error al cargar árbol de especialidad');\r\n        }\r\n\r\n        // Mapear y ordenar datos\r\n        const mappedLevels = (levels || []).map(level => ({\r\n            ...mapLevelFromDb(level),\r\n            units: (level.units || [])\r\n                .sort((a: { order_index: number }, b: { order_index: number }) => a.order_index - b.order_index)\r\n                .map((unit: Record<string, unknown>) => ({\r\n                    ...mapUnitFromDb(unit),\r\n                    lessons: ((unit.lessons as Record<string, unknown>[]) || [])\r\n                        .sort((a: any, b: any) => a.order_index - b.order_index)\r\n                        .map(mapLessonFromDb),\r\n                })),\r\n        }));\r\n\r\n        return {\r\n            ...specialty,\r\n            levels: mappedLevels,\r\n        };\r\n    },\r\n\r\n    // ============================================================================\r\n    // NIVELES\r\n    // ============================================================================\r\n\r\n    /**\r\n     * Obtiene los niveles de una especialidad\r\n     * @param specialtyId - ID de la especialidad\r\n     * @returns Lista de niveles ordenados\r\n     */\r\n    async getLevelsBySpecialty(specialtyId: string): Promise<AcademyLevel[]> {\r\n        const supabase = createClient();\r\n\r\n        const { data, error } = await supabase\r\n            .from('academy_levels')\r\n            .select('*')\r\n            .eq('specialty_id', specialtyId)\r\n            .order('order_index', { ascending: true });\r\n\r\n        if (error) {\r\n            console.error('[AcademyLessonService] Error fetching levels:', error);\r\n            throw new Error('Error al cargar niveles');\r\n        }\r\n\r\n        return (data || []).map(mapLevelFromDb);\r\n    },\r\n\r\n    // ============================================================================\r\n    // UNIDADES\r\n    // ============================================================================\r\n\r\n    /**\r\n     * Obtiene las unidades de un nivel\r\n     * @param levelId - ID del nivel\r\n     * @returns Lista de unidades ordenadas\r\n     */\r\n    async getUnitsByLevel(levelId: string): Promise<AcademyUnit[]> {\r\n        const supabase = createClient();\r\n\r\n        const { data, error } = await supabase\r\n            .from('academy_units')\r\n            .select('*')\r\n            .eq('level_id', levelId)\r\n            .order('order_index', { ascending: true });\r\n\r\n        if (error) {\r\n            console.error('[AcademyLessonService] Error fetching units:', error);\r\n            throw new Error('Error al cargar unidades');\r\n        }\r\n\r\n        return (data || []).map(mapUnitFromDb);\r\n    },\r\n\r\n    // ============================================================================\r\n    // LECCIONES\r\n    // ============================================================================\r\n\r\n    /**\r\n     * Obtiene las lecciones de una unidad\r\n     * @param unitId - ID de la unidad\r\n     * @returns Lista de lecciones ordenadas\r\n     */\r\n    async getLessonsByUnit(unitId: string): Promise<AcademyLesson[]> {\r\n        const supabase = createClient();\r\n\r\n        const { data, error } = await supabase\r\n            .from('academy_lessons')\r\n            .select('*')\r\n            .eq('unit_id', unitId)\r\n            .eq('is_active', true)\r\n            .order('order_index', { ascending: true });\r\n\r\n        if (error) {\r\n            console.error('[AcademyLessonService] Error fetching lessons:', error);\r\n            throw new Error('Error al cargar lecciones');\r\n        }\r\n\r\n        return (data || []).map(mapLessonFromDb);\r\n    },\r\n\r\n    /**\r\n     * Obtiene una lección con todas sus preguntas y contexto\r\n     * Útil para el reproductor de lecciones\r\n     * @param lessonId - ID de la lección\r\n     * @returns Lección completa con preguntas\r\n     */\r\n    async getLessonWithQuestions(lessonId: string): Promise<LessonWithDetails | null> {\r\n        const supabase = createClient();\r\n\r\n        // Obtener lección con relaciones\r\n        const { data: lesson, error: lessonError } = await supabase\r\n            .from('academy_lessons')\r\n            .select(`\r\n        *,\r\n        unit:academy_units (\r\n          *,\r\n          level:academy_levels (\r\n            *,\r\n            specialty:academy_specialties (*)\r\n          )\r\n        )\r\n      `)\r\n            .eq('id', lessonId)\r\n            .eq('is_active', true)\r\n            .single();\r\n\r\n        if (lessonError) {\r\n            if (lessonError.code === 'PGRST116') return null;\r\n            console.error('[AcademyLessonService] Error fetching lesson:', lessonError);\r\n            throw new Error('Error al cargar lección');\r\n        }\r\n\r\n        if (!lesson) return null;\r\n\r\n        // Obtener preguntas de la lección\r\n        const { data: questions, error: questionsError } = await supabase\r\n            .from('academy_questions')\r\n            .select('*')\r\n            .eq('lesson_id', lessonId)\r\n            .order('order_index', { ascending: true });\r\n\r\n        if (questionsError) {\r\n            console.error('[AcademyLessonService] Error fetching questions:', questionsError);\r\n            throw new Error('Error al cargar preguntas');\r\n        }\r\n\r\n        return {\r\n            ...mapLessonFromDb(lesson),\r\n            unit: mapUnitFromDb(lesson.unit),\r\n            level: mapLevelFromDb(lesson.unit.level),\r\n            specialty: mapSpecialtyFromDb(lesson.unit.level.specialty),\r\n            questions: (questions || []).map(mapQuestionFromDb),\r\n        };\r\n    },\r\n\r\n    /**\r\n     * Obtiene la siguiente lección disponible después de la actual\r\n     * @param currentLessonId - ID de la lección actual\r\n     * @returns Siguiente lección o null si no hay más\r\n     */\r\n    async getNextLesson(currentLessonId: string): Promise<AcademyLesson | null> {\r\n        const supabase = createClient();\r\n\r\n        // Obtener lección actual con su contexto\r\n        const { data: current, error: currentError } = await supabase\r\n            .from('academy_lessons')\r\n            .select(`\r\n        *,\r\n        unit:academy_units (\r\n          *,\r\n          level:academy_levels (*)\r\n        )\r\n      `)\r\n            .eq('id', currentLessonId)\r\n            .single();\r\n\r\n        if (currentError || !current) return null;\r\n\r\n        // Buscar siguiente lección en la misma unidad\r\n        const { data: nextInUnit } = await supabase\r\n            .from('academy_lessons')\r\n            .select('*')\r\n            .eq('unit_id', current.unit_id)\r\n            .eq('is_active', true)\r\n            .gt('order_index', current.order_index)\r\n            .order('order_index', { ascending: true })\r\n            .limit(1)\r\n            .single();\r\n\r\n        if (nextInUnit) {\r\n            return mapLessonFromDb(nextInUnit);\r\n        }\r\n\r\n        // Si no hay más en la unidad, buscar siguiente unidad\r\n        const { data: nextUnit } = await supabase\r\n            .from('academy_units')\r\n            .select('id')\r\n            .eq('level_id', current.unit.level_id)\r\n            .gt('order_index', current.unit.order_index)\r\n            .order('order_index', { ascending: true })\r\n            .limit(1)\r\n            .single();\r\n\r\n        if (nextUnit) {\r\n            const { data: firstLesson } = await supabase\r\n                .from('academy_lessons')\r\n                .select('*')\r\n                .eq('unit_id', nextUnit.id)\r\n                .eq('is_active', true)\r\n                .order('order_index', { ascending: true })\r\n                .limit(1)\r\n                .single();\r\n\r\n            if (firstLesson) {\r\n                return mapLessonFromDb(firstLesson);\r\n            }\r\n        }\r\n\r\n        // Si no hay más unidades, buscar siguiente nivel (si está desbloqueado)\r\n        // Esto requerirá verificar el progreso del usuario\r\n        return null;\r\n    },\r\n};\r\n\r\n// ============================================================================\r\n// MAPPERS (DB → TypeScript)\r\n// ============================================================================\r\n\r\n/** Mapea especialidad de DB a tipo TypeScript */\r\nfunction mapSpecialtyFromDb(data: Record<string, unknown>): AcademySpecialty {\r\n    return {\r\n        id: data.id as string,\r\n        name: data.name as string,\r\n        slug: data.slug as string,\r\n        description: data.description as string | null,\r\n        shortDescription: data.short_description as string | null,\r\n        icon: data.icon as string | null,\r\n        color: data.color as string || '#0ea5e9',\r\n        coverImageUrl: data.cover_image_url as string | null,\r\n        orderIndex: data.order_index as number || 0,\r\n        isPremium: data.is_premium as boolean || false,\r\n        isActive: data.is_active as boolean || true,\r\n        totalLessons: data.total_lessons as number || 0,\r\n        estimatedHours: data.estimated_hours as number || 0,\r\n        difficultyLevel: (data.difficulty_level as 1 | 2 | 3 | 4 | 5) || 1,\r\n        createdAt: data.created_at as string,\r\n        updatedAt: data.updated_at as string,\r\n    };\r\n}\r\n\r\n/** Mapea nivel de DB a tipo TypeScript */\r\nfunction mapLevelFromDb(data: Record<string, unknown>): AcademyLevel {\r\n    return {\r\n        id: data.id as string,\r\n        specialtyId: data.specialty_id as string,\r\n        name: data.name as string,\r\n        description: data.description as string | null,\r\n        orderIndex: data.order_index as number || 0,\r\n        requiredXp: data.required_xp as number || 0,\r\n        icon: data.icon as string | null,\r\n        color: data.color as string | null,\r\n        isLocked: data.is_locked as boolean || true,\r\n        unlockRequirement: data.unlock_requirement as Record<string, unknown> | null,\r\n        createdAt: data.created_at as string,\r\n        updatedAt: data.updated_at as string,\r\n    };\r\n}\r\n\r\n/** Mapea unidad de DB a tipo TypeScript */\r\nfunction mapUnitFromDb(data: Record<string, unknown>): AcademyUnit {\r\n    return {\r\n        id: data.id as string,\r\n        levelId: data.level_id as string,\r\n        name: data.name as string,\r\n        description: data.description as string | null,\r\n        orderIndex: data.order_index as number || 0,\r\n        icon: data.icon as string | null,\r\n        estimatedMinutes: data.estimated_minutes as number || 30,\r\n        isCheckpoint: data.is_checkpoint as boolean || false,\r\n        createdAt: data.created_at as string,\r\n        updatedAt: data.updated_at as string,\r\n    };\r\n}\r\n\r\n/** Mapea lección de DB a tipo TypeScript */\r\nfunction mapLessonFromDb(data: Record<string, unknown>): AcademyLesson {\r\n    return {\r\n        id: data.id as string,\r\n        unitId: data.unit_id as string,\r\n        title: data.title as string,\r\n        type: data.type as AcademyLesson['type'] || 'standard',\r\n        content: (data.content as AcademyLesson['content']) || {},\r\n        orderIndex: data.order_index as number || 0,\r\n        xpReward: data.xp_reward as number || 10,\r\n        gemReward: data.gem_reward as number || 0,\r\n        estimatedMinutes: data.estimated_minutes as number || 5,\r\n        difficulty: (data.difficulty as 1 | 2 | 3 | 4 | 5) || 1,\r\n        isPremium: data.is_premium as boolean || false,\r\n        isActive: data.is_active as boolean || true,\r\n        createdAt: data.created_at as string,\r\n        updatedAt: data.updated_at as string,\r\n    };\r\n}\r\n\r\n/** Mapea pregunta de DB a tipo TypeScript */\r\nfunction mapQuestionFromDb(data: Record<string, unknown>): AcademyQuestion {\r\n    return {\r\n        id: data.id as string,\r\n        lessonId: data.lesson_id as string,\r\n        type: data.type as AcademyQuestion['type'] || 'multiple_choice',\r\n        question: data.question as AcademyQuestion['question'],\r\n        options: data.options as AcademyQuestion['options'],\r\n        correctAnswer: data.correct_answer as AcademyQuestion['correctAnswer'],\r\n        explanation: data.explanation as string | null,\r\n        hint: data.hint as string | null,\r\n        difficulty: (data.difficulty as 1 | 2 | 3 | 4 | 5) || 1,\r\n        orderIndex: data.order_index as number || 0,\r\n        xpBonus: data.xp_bonus as number || 0,\r\n        createdAt: data.created_at as string,\r\n    };\r\n}\r\n\r\nexport default AcademyLessonService;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\academy\\services\\progress.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\academy\\types\\gamification.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\academy\\types\\lesson.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\academy\\types\\progress.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\agora\\utils\\token-generator.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'role' is assigned a value but never used.","line":17,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'expirationTimeInSeconds' is assigned a value but never used.","line":18,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'expirationTimeInSeconds' is assigned a value but never used.","line":29,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":26}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Tipos básicos para Agora\r\nexport enum RtcRole {\r\n  PUBLISHER = 1,\r\n  SUBSCRIBER = 2,\r\n}\r\n\r\nexport enum RtmRole {\r\n  Rtm_User = 1,\r\n}\r\n\r\n// Funciones placeholder - requieren implementación completa con agora-token\r\nexport function generateRTCToken(\r\n  appId: string,\r\n  appCertificate: string,\r\n  channelName: string,\r\n  uid: number,\r\n  role: RtcRole = RtcRole.PUBLISHER,\r\n  expirationTimeInSeconds: number = 3600\r\n): string {\r\n  // TODO: Implementar con agora-token cuando esté disponible\r\n  console.warn(\"generateRTCToken: Implementación placeholder\");\r\n  return `rtc_token_${appId}_${channelName}_${uid}`;\r\n}\r\n\r\nexport function generateRTMToken(\r\n  appId: string,\r\n  appCertificate: string,\r\n  userId: string,\r\n  expirationTimeInSeconds: number = 3600\r\n): string {\r\n  // TODO: Implementar con agora-token cuando esté disponible\r\n  console.warn(\"generateRTMToken: Implementación placeholder\");\r\n  return `rtm_token_${appId}_${userId}`;\r\n}\r\n\r\n// Interfaz para configuración de sesión\r\nexport interface SessionConfig {\r\n  appId: string;\r\n  appCertificate: string;\r\n  channelName: string;\r\n  uid: number;\r\n  expirationInSeconds?: number;\r\n}\r\n\r\n// Funciones adicionales que pueden ser requeridas\r\nexport function generateSessionTokens(\r\n  config: SessionConfig,\r\n  role: RtcRole = RtcRole.PUBLISHER\r\n) {\r\n  const expiration = config.expirationInSeconds || 3600;\r\n  const expiresAt = new Date(Date.now() + expiration * 1000);\r\n  \r\n  return {\r\n    rtcToken: generateRTCToken(\r\n      config.appId,\r\n      config.appCertificate,\r\n      config.channelName,\r\n      config.uid,\r\n      role,\r\n      expiration\r\n    ),\r\n    rtmToken: generateRTMToken(\r\n      config.appId,\r\n      config.appCertificate,\r\n      config.uid.toString(),\r\n      expiration\r\n    ),\r\n    expiresAt,\r\n  };\r\n}\r\n\r\nexport function getAgoraConfigFromEnv() {\r\n  return {\r\n    appId: process.env.NEXT_PUBLIC_AGORA_APP_ID || \"\",\r\n    appCertificate: process.env.AGORA_APP_CERTIFICATE || \"\",\r\n  };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\animations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\api\\blog.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\auth\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\auth\\role-validator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\auth\\secretary-permissions.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":76,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1995,1998],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1995,1998],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Sistema de permisos para secretarias médicas\r\n * Proporciona funciones para verificar y gestionar permisos\r\n */\r\n\r\nimport { supabase } from \"@/lib/supabase/client\";\r\nimport type { SecretaryPermissions, DoctorSecretaryRelation } from \"@/lib/types/secretary\";\r\n\r\n/**\r\n * Obtiene la relación médico-secretaria activa\r\n */\r\nexport async function getSecretaryRelation(\r\n  secretaryId: string,\r\n  doctorId: string\r\n): Promise<DoctorSecretaryRelation | null> {\r\n  const { data, error } = await supabase\r\n    .from(\"doctor_secretaries\")\r\n    .select(\"*\")\r\n    .eq(\"secretary_id\", secretaryId)\r\n    .eq(\"doctor_id\", doctorId)\r\n    .eq(\"status\", \"active\")\r\n    .single();\r\n\r\n  if (error || !data) {\r\n    return null;\r\n  }\r\n\r\n  return data as DoctorSecretaryRelation;\r\n}\r\n\r\n/**\r\n * Obtiene todos los médicos vinculados a una secretaria\r\n */\r\nexport async function getSecretaryDoctors(secretaryId: string) {\r\n  const { data, error } = await supabase\r\n    .from(\"doctor_secretary_relationships\")\r\n    .select(\"*\")\r\n    .eq(\"secretary_id\", secretaryId)\r\n    .eq(\"status\", \"active\");\r\n\r\n  if (error) {\r\n    console.error(\"Error fetching secretary doctors:\", error);\r\n    return [];\r\n  }\r\n\r\n  return data || [];\r\n}\r\n\r\n/**\r\n * Verifica si una secretaria tiene un permiso específico\r\n */\r\nexport async function checkSecretaryPermission(\r\n  secretaryId: string,\r\n  doctorId: string,\r\n  permission: keyof SecretaryPermissions\r\n): Promise<boolean> {\r\n  const relation = await getSecretaryRelation(secretaryId, doctorId);\r\n  \r\n  if (!relation || relation.status !== \"active\") {\r\n    return false;\r\n  }\r\n\r\n  return relation.permissions[permission] === true;\r\n}\r\n\r\n/**\r\n * Verifica múltiples permisos a la vez\r\n */\r\nexport async function checkSecretaryPermissions(\r\n  secretaryId: string,\r\n  doctorId: string,\r\n  permissions: Array<keyof SecretaryPermissions>\r\n): Promise<Record<keyof SecretaryPermissions, boolean>> {\r\n  const relation = await getSecretaryRelation(secretaryId, doctorId);\r\n  \r\n  const result: any = {};\r\n  \r\n  if (!relation || relation.status !== \"active\") {\r\n    permissions.forEach(perm => {\r\n      result[perm] = false;\r\n    });\r\n    return result;\r\n  }\r\n\r\n  permissions.forEach(perm => {\r\n    result[perm] = relation.permissions[perm] === true;\r\n  });\r\n\r\n  return result;\r\n}\r\n\r\n/**\r\n * Actualiza los permisos de una secretaria (solo médicos)\r\n */\r\nexport async function updateSecretaryPermissions(\r\n  doctorId: string,\r\n  secretaryId: string,\r\n  permissions: Partial<SecretaryPermissions>\r\n): Promise<{ success: boolean; error?: string }> {\r\n  const { error } = await supabase\r\n    .from(\"doctor_secretaries\")\r\n    .update({ permissions })\r\n    .eq(\"doctor_id\", doctorId)\r\n    .eq(\"secretary_id\", secretaryId);\r\n\r\n  if (error) {\r\n    return { success: false, error: error.message };\r\n  }\r\n\r\n  return { success: true };\r\n}\r\n\r\n/**\r\n * Cambia el estado de una secretaria (activar/desactivar/suspender)\r\n */\r\nexport async function updateSecretaryStatus(\r\n  doctorId: string,\r\n  secretaryId: string,\r\n  status: 'active' | 'inactive' | 'suspended'\r\n): Promise<{ success: boolean; error?: string }> {\r\n  const { error } = await supabase\r\n    .from(\"doctor_secretaries\")\r\n    .update({ status })\r\n    .eq(\"doctor_id\", doctorId)\r\n    .eq(\"secretary_id\", secretaryId);\r\n\r\n  if (error) {\r\n    return { success: false, error: error.message };\r\n  }\r\n\r\n  return { success: true };\r\n}\r\n\r\n/**\r\n * Agrega una nueva secretaria a un médico\r\n */\r\nexport async function addSecretary(\r\n  doctorId: string,\r\n  secretaryEmail: string,\r\n  permissions?: Partial<SecretaryPermissions>\r\n): Promise<{ success: boolean; error?: string }> {\r\n  // Buscar el perfil de la secretaria por email\r\n  const { data: secretaryProfile, error: profileError } = await supabase\r\n    .from(\"profiles\")\r\n    .select(\"id, role\")\r\n    .eq(\"email\", secretaryEmail)\r\n    .eq(\"role\", \"secretaria\")\r\n    .single();\r\n\r\n  if (profileError || !secretaryProfile) {\r\n    return { \r\n      success: false, \r\n      error: \"No se encontró una secretaria con ese email\" \r\n    };\r\n  }\r\n\r\n  // Crear la relación\r\n  const { error: insertError } = await supabase\r\n    .from(\"doctor_secretaries\")\r\n    .insert({\r\n      doctor_id: doctorId,\r\n      secretary_id: secretaryProfile.id,\r\n      permissions: permissions || undefined,\r\n      status: \"active\",\r\n    });\r\n\r\n  if (insertError) {\r\n    if (insertError.code === \"23505\") {\r\n      return { \r\n        success: false, \r\n        error: \"Esta secretaria ya está vinculada a tu cuenta\" \r\n      };\r\n    }\r\n    return { success: false, error: insertError.message };\r\n  }\r\n\r\n  return { success: true };\r\n}\r\n\r\n/**\r\n * Elimina una secretaria de un médico\r\n */\r\nexport async function removeSecretary(\r\n  doctorId: string,\r\n  secretaryId: string\r\n): Promise<{ success: boolean; error?: string }> {\r\n  const { error } = await supabase\r\n    .from(\"doctor_secretaries\")\r\n    .delete()\r\n    .eq(\"doctor_id\", doctorId)\r\n    .eq(\"secretary_id\", secretaryId);\r\n\r\n  if (error) {\r\n    return { success: false, error: error.message };\r\n  }\r\n\r\n  return { success: true };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\constants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\constants\\medical-suggestions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\constants\\medicos-content.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\constants\\pacientes-content.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\constants\\venezuela-cities.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\contexts\\language-context.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used.","line":3,"column":47,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":56}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { createContext, useContext, useState, useEffect } from \"react\";\r\n\r\ntype Language = \"es\" | \"en\" | \"pt\";\r\n\r\ninterface LanguageContextType {\r\n  language: Language;\r\n  setLanguage: (lang: Language) => void;\r\n  t: (key: string) => string;\r\n}\r\n\r\nconst LanguageContext = createContext<LanguageContextType | undefined>(undefined);\r\n\r\n// Traducciones básicas\r\nconst translations: Record<Language, Record<string, string>> = {\r\n  es: {\r\n    \"profile.title\": \"Mi Perfil\",\r\n    \"profile.edit\": \"Editar\",\r\n    \"profile.save\": \"Guardar\",\r\n    \"profile.cancel\": \"Cancelar\",\r\n    \"profile.name\": \"Nombre Completo\",\r\n    \"profile.email\": \"Correo Electrónico\",\r\n    \"profile.phone\": \"Teléfono\",\r\n    \"profile.address\": \"Dirección\",\r\n    \"medical.title\": \"Información Médica\",\r\n    \"medical.bloodType\": \"Tipo de Sangre\",\r\n    \"medical.allergies\": \"Alergias\",\r\n    \"documents.title\": \"Documentos\",\r\n    \"security.title\": \"Seguridad\",\r\n    \"preferences.title\": \"Preferencias\",\r\n    \"privacy.title\": \"Privacidad\",\r\n    \"activity.title\": \"Actividad\",\r\n    \"billing.title\": \"Facturación\",\r\n  },\r\n  en: {\r\n    \"profile.title\": \"My Profile\",\r\n    \"profile.edit\": \"Edit\",\r\n    \"profile.save\": \"Save\",\r\n    \"profile.cancel\": \"Cancel\",\r\n    \"profile.name\": \"Full Name\",\r\n    \"profile.email\": \"Email\",\r\n    \"profile.phone\": \"Phone\",\r\n    \"profile.address\": \"Address\",\r\n    \"medical.title\": \"Medical Information\",\r\n    \"medical.bloodType\": \"Blood Type\",\r\n    \"medical.allergies\": \"Allergies\",\r\n    \"documents.title\": \"Documents\",\r\n    \"security.title\": \"Security\",\r\n    \"preferences.title\": \"Preferences\",\r\n    \"privacy.title\": \"Privacy\",\r\n    \"activity.title\": \"Activity\",\r\n    \"billing.title\": \"Billing\",\r\n  },\r\n  pt: {\r\n    \"profile.title\": \"Meu Perfil\",\r\n    \"profile.edit\": \"Editar\",\r\n    \"profile.save\": \"Salvar\",\r\n    \"profile.cancel\": \"Cancelar\",\r\n    \"profile.name\": \"Nome Completo\",\r\n    \"profile.email\": \"E-mail\",\r\n    \"profile.phone\": \"Telefone\",\r\n    \"profile.address\": \"Endereço\",\r\n    \"medical.title\": \"Informação Médica\",\r\n    \"medical.bloodType\": \"Tipo Sanguíneo\",\r\n    \"medical.allergies\": \"Alergias\",\r\n    \"documents.title\": \"Documentos\",\r\n    \"security.title\": \"Segurança\",\r\n    \"preferences.title\": \"Preferências\",\r\n    \"privacy.title\": \"Privacidade\",\r\n    \"activity.title\": \"Atividade\",\r\n    \"billing.title\": \"Faturamento\",\r\n  },\r\n};\r\n\r\nexport function LanguageProvider({ children }: { children: React.ReactNode }) {\r\n  // Inicializar con valor de localStorage si existe\r\n  const [language, setLanguageState] = useState<Language>(() => {\r\n    if (typeof window !== 'undefined') {\r\n      const stored = localStorage.getItem(\"language\") as Language;\r\n      if (stored && [\"es\", \"en\", \"pt\"].includes(stored)) {\r\n        return stored;\r\n      }\r\n    }\r\n    return \"es\";\r\n  });\r\n\r\n  const setLanguage = (lang: Language) => {\r\n    setLanguageState(lang);\r\n    localStorage.setItem(\"language\", lang);\r\n  };\r\n\r\n  const t = (key: string): string => {\r\n    return translations[language][key] || key;\r\n  };\r\n\r\n  return (\r\n    <LanguageContext.Provider value={{ language, setLanguage, t }}>\r\n      {children}\r\n    </LanguageContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useLanguage() {\r\n  const context = useContext(LanguageContext);\r\n  if (!context) {\r\n    throw new Error(\"useLanguage must be used within LanguageProvider\");\r\n  }\r\n  return context;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\contexts\\preferences-context.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\contexts\\sidebar-context.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\contexts\\theme-context.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\contexts\\theme-context.tsx:33:5\n  31 |   useEffect(() => {\n  32 |     document.documentElement.classList.toggle(\"dark\", theme === \"dark\");\n> 33 |     setMounted(true);\n     |     ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  34 |   }, [theme]);\n  35 |\n  36 |   const setTheme = (newTheme: Theme) => {","line":33,"column":5,"nodeType":null,"endLine":33,"endColumn":15}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { createContext, useContext, useEffect, useState } from \"react\";\r\n\r\ntype Theme = \"light\" | \"dark\";\r\n\r\ninterface ThemeContextType {\r\n  theme: Theme;\r\n  toggleTheme: () => void;\r\n  setTheme: (theme: Theme) => void;\r\n}\r\n\r\nconst ThemeContext = createContext<ThemeContextType | undefined>(undefined);\r\n\r\nexport function ThemeProvider({ children }: { children: React.ReactNode }) {\r\n  // Inicializar tema desde localStorage o preferencia del sistema\r\n  const [theme, setThemeState] = useState<Theme>(() => {\r\n    if (typeof window !== 'undefined') {\r\n      const stored = localStorage.getItem(\"theme\") as Theme;\r\n      if (stored) return stored;\r\n      \r\n      const prefersDark = window.matchMedia(\"(prefers-color-scheme: dark)\").matches;\r\n      return prefersDark ? \"dark\" : \"light\";\r\n    }\r\n    return \"light\";\r\n  });\r\n  \r\n  const [mounted, setMounted] = useState(false);\r\n\r\n  // Aplicar tema al DOM cuando el componente se monta\r\n  useEffect(() => {\r\n    document.documentElement.classList.toggle(\"dark\", theme === \"dark\");\r\n    setMounted(true);\r\n  }, [theme]);\r\n\r\n  const setTheme = (newTheme: Theme) => {\r\n    setThemeState(newTheme);\r\n    localStorage.setItem(\"theme\", newTheme);\r\n    document.documentElement.classList.toggle(\"dark\", newTheme === \"dark\");\r\n  };\r\n\r\n  const toggleTheme = () => {\r\n    setTheme(theme === \"light\" ? \"dark\" : \"light\");\r\n  };\r\n\r\n  if (!mounted) return null;\r\n\r\n  return (\r\n    <ThemeContext.Provider value={{ theme, toggleTheme, setTheme }}>\r\n      {children}\r\n    </ThemeContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useTheme() {\r\n  const context = useContext(ThemeContext);\r\n  if (!context) {\r\n    throw new Error(\"useTheme must be used within ThemeProvider\");\r\n  }\r\n  return context;\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\data\\consultation-reasons.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\data\\icd11-fallback.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\data\\knowledge-base.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\data\\office-options.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CreditCard' is defined but never used.","line":1,"column":50,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":60}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Wifi, Car, Accessibility, Baby, Coffee, CreditCard, Clock, Stethoscope } from \"lucide-react\";\r\n\r\nexport const OFFICE_AMENITIES = [\r\n    { id: \"wifi\", label: \"Wifi Gratis\", icon: Wifi },\r\n    { id: \"parking\", label: \"Estacionamiento\", icon: Car },\r\n    { id: \"elevator\", label: \"Ascensor\", icon: Accessibility },\r\n    { id: \"wheelchair_access\", label: \"Acceso Silla de Ruedas\", icon: Accessibility }, // Reusing icon or finding better one\r\n    { id: \"cafeteria\", label: \"Cafetería/Snacks\", icon: Coffee },\r\n    { id: \"kids_area\", label: \"Área de Niños\", icon: Baby },\r\n    { id: \"pharmacy\", label: \"Farmacia Cercana\", icon: Stethoscope },\r\n    { id: \"24_7\", label: \"Abierto 24/7\", icon: Clock },\r\n    { id: \"emergency\", label: \"Emergencias\", icon: Stethoscope }, // Or Ambulance\r\n];\r\n\r\nexport const PAYMENT_METHODS = [\r\n    { id: \"cash\", label: \"Efectivo ($)\" },\r\n    { id: \"bs\", label: \"Bolívares (Bs)\" },\r\n    { id: \"pago_movil\", label: \"Pago Móvil\" },\r\n    { id: \"zelle\", label: \"Zelle\" },\r\n    { id: \"debit_card\", label: \"Tarjeta Débito\" },\r\n    { id: \"credit_card\", label: \"Tarjeta Crédito\" },\r\n    { id: \"insurance\", label: \"Seguro Médico\" },\r\n    { id: \"paypal\", label: \"PayPal\" },\r\n    { id: \"binance\", label: \"Binance / Cripto\" },\r\n];\r\n\r\nexport const CURRENCIES = [\r\n    { code: \"USD\", name: \"Dólar Americano\", symbol: \"$\" },\r\n    { code: \"VES\", name: \"Bolívar Digital\", symbol: \"Bs.\" },\r\n    { code: \"EUR\", name: \"Euro\", symbol: \"€\" },\r\n];\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\data\\venezuela-data.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\hooks\\use-i18n.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\hooks\\use-translation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\i18n\\translations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\i18n\\translations\\appointments.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\i18n\\translations\\auth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\i18n\\translations\\common.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\i18n\\translations\\dashboard.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\i18n\\translations\\errors.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\i18n\\translations\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\i18n\\translations\\medical.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\i18n\\translations\\messages.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\i18n\\translations\\modules\\common.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\i18n\\translations\\modules\\dashboard.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\i18n\\translations\\preferences.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\i18n\\translations\\profile.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\redux\\profileSlice.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\redux\\store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\runtime\\__tests__\\connectivity-monitor.property.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'transitionsAfterUnsubscribe' is assigned a value but never used.","line":301,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":301,"endColumn":46},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'callback' is assigned a value but never used.","line":321,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":321,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Property-Based Tests for Connectivity Monitor\r\n * \r\n * These tests validate correctness properties that should hold true\r\n * across all valid executions of the connectivity monitor.\r\n * \r\n * Testing Framework: fast-check (property-based testing)\r\n * Test Runner: Vitest\r\n * \r\n * Feature: tauri-dashboard-medico\r\n * Property 5: Connectivity State Propagation\r\n * Validates: Requirements 2.6, 8.2\r\n * \r\n * **Validates: Requirements 2.6, 8.2**\r\n */\r\n\r\nimport { describe, it, expect, beforeEach, afterEach, vi } from 'vitest';\r\nimport fc from 'fast-check';\r\nimport {\r\n  ConnectivityMonitorImpl,\r\n  resetConnectivityMonitor,\r\n  type ConnectivityCallback,\r\n} from '../connectivity-monitor';\r\nimport { RuntimeService } from '../runtime-service';\r\nimport type { NetworkService } from '../types';\r\n\r\n/**\r\n * Property 5: Connectivity State Propagation\r\n * \r\n * For any change in connectivity status (online to offline, or offline to online),\r\n * the Connectivity_Monitor SHALL emit events that update all relevant UI components\r\n * to reflect the current state.\r\n * \r\n * This property test verifies that:\r\n * 1. Status changes are detected correctly\r\n * 2. All registered listeners are notified\r\n * 3. Listeners receive the correct status value\r\n * 4. Multiple listeners all receive the same status\r\n * 5. Status changes propagate regardless of the sequence of transitions\r\n */\r\ndescribe('Property 5: Connectivity State Propagation', () => {\r\n  let monitor: ConnectivityMonitorImpl;\r\n  let mockNetworkService: NetworkService;\r\n\r\n  beforeEach(() => {\r\n    // Reset the singleton\r\n    resetConnectivityMonitor();\r\n\r\n    // Create a mock network service\r\n    mockNetworkService = {\r\n      checkConnectivity: vi.fn().mockResolvedValue(true),\r\n      get: vi.fn(),\r\n      post: vi.fn(),\r\n      patch: vi.fn(),\r\n      delete: vi.fn(),\r\n    };\r\n\r\n    // Mock RuntimeService to return our mock network service\r\n    vi.spyOn(RuntimeService, 'getNetworkService').mockReturnValue(mockNetworkService);\r\n\r\n    // Create a new monitor instance\r\n    monitor = new ConnectivityMonitorImpl();\r\n  });\r\n\r\n  afterEach(() => {\r\n    // Stop the monitor if it's running\r\n    monitor.stop();\r\n    vi.restoreAllMocks();\r\n  });\r\n\r\n  /**\r\n   * Test that all listeners receive status change events\r\n   * for any sequence of connectivity transitions\r\n   */\r\n  it('should propagate status changes to all registered listeners', async () => {\r\n    await fc.assert(\r\n      fc.asyncProperty(\r\n        // Generate a sequence of connectivity states (true = online, false = offline)\r\n        fc.array(fc.boolean(), { minLength: 2, maxLength: 10 }),\r\n        // Generate number of listeners (1-10)\r\n        fc.integer({ min: 1, max: 10 }),\r\n        async (statusSequence, listenerCount) => {\r\n          // Create multiple listeners\r\n          const listeners: Array<{ callback: ConnectivityCallback; calls: boolean[] }> = [];\r\n          \r\n          for (let i = 0; i < listenerCount; i++) {\r\n            const calls: boolean[] = [];\r\n            const callback = vi.fn((status: boolean) => {\r\n              calls.push(status);\r\n            });\r\n            \r\n            monitor.onStatusChange(callback);\r\n            listeners.push({ callback, calls });\r\n          }\r\n\r\n          // Apply the sequence of status changes\r\n          for (const status of statusSequence) {\r\n            mockNetworkService.checkConnectivity = vi.fn().mockResolvedValue(status);\r\n            await monitor.forceCheck();\r\n          }\r\n\r\n          // Calculate expected transitions (only when status actually changes)\r\n          const transitions: boolean[] = [];\r\n          let previousStatus = true; // Monitor starts with online status\r\n          \r\n          for (const status of statusSequence) {\r\n            if (status !== previousStatus) {\r\n              transitions.push(status);\r\n              previousStatus = status;\r\n            }\r\n          }\r\n\r\n          // Verify all listeners received the same transitions\r\n          for (const listener of listeners) {\r\n            expect(listener.calls).toEqual(transitions);\r\n            expect(listener.callback).toHaveBeenCalledTimes(transitions.length);\r\n          }\r\n\r\n          // Verify all listeners received identical sequences\r\n          if (listeners.length > 1) {\r\n            const firstListenerCalls = listeners[0].calls;\r\n            for (let i = 1; i < listeners.length; i++) {\r\n              expect(listeners[i].calls).toEqual(firstListenerCalls);\r\n            }\r\n          }\r\n        }\r\n      ),\r\n      { numRuns: 100 }\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that status changes are correctly detected\r\n   * regardless of the initial state\r\n   */\r\n  it('should detect status changes from any initial state', async () => {\r\n    await fc.assert(\r\n      fc.asyncProperty(\r\n        // Generate initial status\r\n        fc.boolean(),\r\n        // Generate target status (must be different)\r\n        fc.boolean(),\r\n        async (initialStatus, targetStatus) => {\r\n          // Skip if statuses are the same (no transition)\r\n          fc.pre(initialStatus !== targetStatus);\r\n\r\n          const callback = vi.fn();\r\n          monitor.onStatusChange(callback);\r\n\r\n          // Set initial status\r\n          mockNetworkService.checkConnectivity = vi.fn().mockResolvedValue(initialStatus);\r\n          await monitor.forceCheck();\r\n\r\n          // Change to target status\r\n          mockNetworkService.checkConnectivity = vi.fn().mockResolvedValue(targetStatus);\r\n          await monitor.forceCheck();\r\n\r\n          // Verify transition was detected\r\n          expect(callback).toHaveBeenCalledWith(targetStatus);\r\n          expect(monitor.isOnline()).toBe(targetStatus);\r\n        }\r\n      ),\r\n      { numRuns: 100 }\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that the monitor correctly tracks current status\r\n   * through any sequence of changes\r\n   */\r\n  it('should maintain correct current status through any sequence of changes', async () => {\r\n    await fc.assert(\r\n      fc.asyncProperty(\r\n        fc.array(fc.boolean(), { minLength: 1, maxLength: 20 }),\r\n        async (statusSequence) => {\r\n          // Apply sequence of status changes\r\n          for (const status of statusSequence) {\r\n            mockNetworkService.checkConnectivity = vi.fn().mockResolvedValue(status);\r\n            await monitor.forceCheck();\r\n          }\r\n\r\n          // Current status should match the last status in the sequence\r\n          const expectedStatus = statusSequence[statusSequence.length - 1];\r\n          expect(monitor.isOnline()).toBe(expectedStatus);\r\n        }\r\n      ),\r\n      { numRuns: 100 }\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that status changes are idempotent\r\n   * (multiple checks with same status don't trigger multiple events)\r\n   */\r\n  it('should not emit duplicate events for unchanged status', async () => {\r\n    await fc.assert(\r\n      fc.asyncProperty(\r\n        fc.boolean(),\r\n        fc.integer({ min: 2, max: 10 }),\r\n        async (status, checkCount) => {\r\n          const callback = vi.fn();\r\n          monitor.onStatusChange(callback);\r\n\r\n          // Set initial status (different from default)\r\n          const initialStatus = !status;\r\n          mockNetworkService.checkConnectivity = vi.fn().mockResolvedValue(initialStatus);\r\n          await monitor.forceCheck();\r\n\r\n          // Clear the callback calls from initial transition\r\n          callback.mockClear();\r\n\r\n          // Check multiple times with same status\r\n          mockNetworkService.checkConnectivity = vi.fn().mockResolvedValue(status);\r\n          await monitor.forceCheck();\r\n\r\n          // Additional checks with same status\r\n          for (let i = 1; i < checkCount; i++) {\r\n            await monitor.forceCheck();\r\n          }\r\n\r\n          // Should only emit once for the actual transition\r\n          expect(callback).toHaveBeenCalledTimes(1);\r\n          expect(callback).toHaveBeenCalledWith(status);\r\n        }\r\n      ),\r\n      { numRuns: 100 }\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that listeners added after status changes\r\n   * don't receive historical events\r\n   */\r\n  it('should not send historical events to newly added listeners', async () => {\r\n    await fc.assert(\r\n      fc.asyncProperty(\r\n        fc.array(fc.boolean(), { minLength: 2, maxLength: 5 }),\r\n        async (statusSequence) => {\r\n          // Apply some status changes without listeners\r\n          for (const status of statusSequence) {\r\n            mockNetworkService.checkConnectivity = vi.fn().mockResolvedValue(status);\r\n            await monitor.forceCheck();\r\n          }\r\n\r\n          // Add listener after changes\r\n          const lateCallback = vi.fn();\r\n          monitor.onStatusChange(lateCallback);\r\n\r\n          // Listener should not have received any historical events\r\n          expect(lateCallback).not.toHaveBeenCalled();\r\n\r\n          // But should receive future events\r\n          const newStatus = !statusSequence[statusSequence.length - 1];\r\n          mockNetworkService.checkConnectivity = vi.fn().mockResolvedValue(newStatus);\r\n          await monitor.forceCheck();\r\n\r\n          expect(lateCallback).toHaveBeenCalledWith(newStatus);\r\n          expect(lateCallback).toHaveBeenCalledTimes(1);\r\n        }\r\n      ),\r\n      { numRuns: 100 }\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that unsubscribed listeners don't receive events\r\n   */\r\n  it('should not send events to unsubscribed listeners', async () => {\r\n    await fc.assert(\r\n      fc.asyncProperty(\r\n        fc.array(fc.boolean(), { minLength: 3, maxLength: 10 }),\r\n        fc.integer({ min: 1, max: 5 }), // Unsubscribe after N transitions\r\n        async (statusSequence, unsubscribeAfter) => {\r\n          const callback = vi.fn();\r\n          const unsubscribe = monitor.onStatusChange(callback);\r\n\r\n          let transitionCount = 0;\r\n          let previousStatus = true;\r\n\r\n          // Apply status changes\r\n          for (const status of statusSequence) {\r\n            mockNetworkService.checkConnectivity = vi.fn().mockResolvedValue(status);\r\n            await monitor.forceCheck();\r\n\r\n            // Count actual transitions\r\n            if (status !== previousStatus) {\r\n              transitionCount++;\r\n              previousStatus = status;\r\n\r\n              // Unsubscribe after specified number of transitions\r\n              if (transitionCount === unsubscribeAfter) {\r\n                unsubscribe();\r\n                callback.mockClear(); // Clear calls up to this point\r\n              }\r\n            }\r\n          }\r\n\r\n          // If we unsubscribed before all transitions, callback should not have been called after unsubscribe\r\n          if (unsubscribeAfter < transitionCount) {\r\n            // Calculate transitions after unsubscribe\r\n            const transitionsAfterUnsubscribe = transitionCount - unsubscribeAfter;\r\n            \r\n            // Callback should not have been called for transitions after unsubscribe\r\n            expect(callback).toHaveBeenCalledTimes(0);\r\n          }\r\n        }\r\n      ),\r\n      { numRuns: 100 }\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that connectivity state propagates correctly\r\n   * even with rapid status changes\r\n   */\r\n  it('should handle rapid status changes correctly', async () => {\r\n    await fc.assert(\r\n      fc.asyncProperty(\r\n        fc.array(fc.boolean(), { minLength: 5, maxLength: 20 }),\r\n        async (rapidChanges) => {\r\n          const callback = vi.fn();\r\n          const receivedStatuses: boolean[] = [];\r\n\r\n          monitor.onStatusChange((status) => {\r\n            receivedStatuses.push(status);\r\n          });\r\n\r\n          // Apply rapid changes\r\n          for (const status of rapidChanges) {\r\n            mockNetworkService.checkConnectivity = vi.fn().mockResolvedValue(status);\r\n            await monitor.forceCheck();\r\n          }\r\n\r\n          // Calculate expected transitions\r\n          const expectedTransitions: boolean[] = [];\r\n          let previousStatus = true;\r\n\r\n          for (const status of rapidChanges) {\r\n            if (status !== previousStatus) {\r\n              expectedTransitions.push(status);\r\n              previousStatus = status;\r\n            }\r\n          }\r\n\r\n          // Verify all transitions were captured\r\n          expect(receivedStatuses).toEqual(expectedTransitions);\r\n        }\r\n      ),\r\n      { numRuns: 100 }\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that error conditions result in offline status\r\n   */\r\n  it('should propagate offline status when connectivity check fails', async () => {\r\n    await fc.assert(\r\n      fc.asyncProperty(\r\n        fc.integer({ min: 1, max: 5 }),\r\n        async (errorCount) => {\r\n          const callback = vi.fn();\r\n          monitor.onStatusChange(callback);\r\n\r\n          // Start online\r\n          mockNetworkService.checkConnectivity = vi.fn().mockResolvedValue(true);\r\n          await monitor.forceCheck();\r\n\r\n          // Clear initial calls\r\n          callback.mockClear();\r\n\r\n          // Simulate connectivity check errors\r\n          mockNetworkService.checkConnectivity = vi.fn().mockRejectedValue(\r\n            new Error('Network check failed')\r\n          );\r\n\r\n          for (let i = 0; i < errorCount; i++) {\r\n            await monitor.forceCheck();\r\n          }\r\n\r\n          // Should transition to offline on first error\r\n          expect(callback).toHaveBeenCalledWith(false);\r\n          expect(callback).toHaveBeenCalledTimes(1); // Only once, not for each error\r\n          expect(monitor.isOnline()).toBe(false);\r\n        }\r\n      ),\r\n      { numRuns: 100 }\r\n    );\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\runtime\\__tests__\\connectivity-monitor.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ConnectivityCallback' is defined but never used.","line":19,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Unit Tests for Connectivity Monitor\r\n * \r\n * These tests verify specific examples, edge cases, and behavior\r\n * for the ConnectivityMonitor implementation.\r\n * \r\n * Testing Framework: Vitest\r\n * \r\n * Feature: tauri-dashboard-medico\r\n * Task: 4.3 - Write unit tests for connectivity monitoring\r\n * Validates: Requirements 8.2\r\n */\r\n\r\nimport { describe, it, expect, beforeEach, afterEach, vi } from 'vitest';\r\nimport {\r\n  ConnectivityMonitorImpl,\r\n  resetConnectivityMonitor,\r\n  getConnectivityMonitor,\r\n  type ConnectivityCallback,\r\n} from '../connectivity-monitor';\r\nimport { RuntimeService } from '../runtime-service';\r\nimport type { NetworkService } from '../types';\r\n\r\ndescribe('ConnectivityMonitor', () => {\r\n  let monitor: ConnectivityMonitorImpl;\r\n  let mockNetworkService: NetworkService;\r\n\r\n  beforeEach(() => {\r\n    // Reset the singleton\r\n    resetConnectivityMonitor();\r\n\r\n    // Create a mock network service\r\n    mockNetworkService = {\r\n      checkConnectivity: vi.fn().mockResolvedValue(true),\r\n      get: vi.fn(),\r\n      post: vi.fn(),\r\n      patch: vi.fn(),\r\n      delete: vi.fn(),\r\n    };\r\n\r\n    // Mock RuntimeService to return our mock network service\r\n    vi.spyOn(RuntimeService, 'getNetworkService').mockReturnValue(mockNetworkService);\r\n\r\n    // Create a new monitor instance\r\n    monitor = new ConnectivityMonitorImpl();\r\n  });\r\n\r\n  afterEach(() => {\r\n    // Stop the monitor if it's running\r\n    monitor.stop();\r\n    vi.restoreAllMocks();\r\n    vi.clearAllTimers();\r\n  });\r\n\r\n  describe('Initialization', () => {\r\n    it('should initialize with online status', () => {\r\n      expect(monitor.isOnline()).toBe(true);\r\n    });\r\n\r\n    it('should have no listeners initially', () => {\r\n      expect(monitor.getListenerCount()).toBe(0);\r\n    });\r\n\r\n    it('should not be running initially', () => {\r\n      // Monitor should not start automatically\r\n      expect(monitor.isOnline()).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe('Start and Stop', () => {\r\n    it('should start monitoring', () => {\r\n      monitor.start();\r\n      // Monitor should be running (we can't directly check, but we can verify it doesn't throw)\r\n      expect(() => monitor.stop()).not.toThrow();\r\n    });\r\n\r\n    it('should stop monitoring', () => {\r\n      monitor.start();\r\n      monitor.stop();\r\n      // Should not throw when stopping\r\n      expect(() => monitor.stop()).not.toThrow();\r\n    });\r\n\r\n    it('should warn when starting twice', () => {\r\n      const consoleSpy = vi.spyOn(console, 'warn').mockImplementation(() => {});\r\n      \r\n      monitor.start();\r\n      monitor.start(); // Start again\r\n      \r\n      expect(consoleSpy).toHaveBeenCalledWith('ConnectivityMonitor is already running');\r\n      consoleSpy.mockRestore();\r\n    });\r\n\r\n    it('should warn when stopping without starting', () => {\r\n      const consoleSpy = vi.spyOn(console, 'warn').mockImplementation(() => {});\r\n      \r\n      monitor.stop(); // Stop without starting\r\n      \r\n      expect(consoleSpy).toHaveBeenCalledWith('ConnectivityMonitor is not running');\r\n      consoleSpy.mockRestore();\r\n    });\r\n\r\n    it('should check connectivity immediately on start', async () => {\r\n      monitor.start();\r\n      \r\n      // Wait a bit for the async check to complete\r\n      await new Promise(resolve => setTimeout(resolve, 100));\r\n      \r\n      expect(mockNetworkService.checkConnectivity).toHaveBeenCalled();\r\n    });\r\n  });\r\n\r\n  describe('Online to Offline Transition', () => {\r\n    it('should detect online to offline transition', async () => {\r\n      const callback = vi.fn();\r\n      monitor.onStatusChange(callback);\r\n\r\n      // Start with online status\r\n      mockNetworkService.checkConnectivity = vi.fn().mockResolvedValue(true);\r\n      await monitor.forceCheck();\r\n      expect(monitor.isOnline()).toBe(true);\r\n\r\n      // Change to offline\r\n      mockNetworkService.checkConnectivity = vi.fn().mockResolvedValue(false);\r\n      await monitor.forceCheck();\r\n\r\n      expect(monitor.isOnline()).toBe(false);\r\n      expect(callback).toHaveBeenCalledWith(false);\r\n      expect(callback).toHaveBeenCalledTimes(1);\r\n    });\r\n\r\n    it('should emit event only once for online to offline', async () => {\r\n      const callback = vi.fn();\r\n      monitor.onStatusChange(callback);\r\n\r\n      // Start online\r\n      mockNetworkService.checkConnectivity = vi.fn().mockResolvedValue(true);\r\n      await monitor.forceCheck();\r\n\r\n      // Go offline\r\n      mockNetworkService.checkConnectivity = vi.fn().mockResolvedValue(false);\r\n      await monitor.forceCheck();\r\n\r\n      // Stay offline\r\n      await monitor.forceCheck();\r\n      await monitor.forceCheck();\r\n\r\n      // Should only emit once for the transition\r\n      expect(callback).toHaveBeenCalledTimes(1);\r\n      expect(callback).toHaveBeenCalledWith(false);\r\n    });\r\n\r\n    it('should log status change', async () => {\r\n      const consoleSpy = vi.spyOn(console, 'log').mockImplementation(() => {});\r\n\r\n      // Start online\r\n      mockNetworkService.checkConnectivity = vi.fn().mockResolvedValue(true);\r\n      await monitor.forceCheck();\r\n\r\n      // Go offline\r\n      mockNetworkService.checkConnectivity = vi.fn().mockResolvedValue(false);\r\n      await monitor.forceCheck();\r\n\r\n      expect(consoleSpy).toHaveBeenCalledWith(\r\n        expect.stringContaining('Connectivity status changed: online → offline')\r\n      );\r\n\r\n      consoleSpy.mockRestore();\r\n    });\r\n  });\r\n\r\n  describe('Offline to Online Transition', () => {\r\n    it('should detect offline to online transition', async () => {\r\n      const callback = vi.fn();\r\n      monitor.onStatusChange(callback);\r\n\r\n      // Start offline\r\n      mockNetworkService.checkConnectivity = vi.fn().mockResolvedValue(false);\r\n      await monitor.forceCheck();\r\n      expect(monitor.isOnline()).toBe(false);\r\n\r\n      // Change to online\r\n      mockNetworkService.checkConnectivity = vi.fn().mockResolvedValue(true);\r\n      await monitor.forceCheck();\r\n\r\n      expect(monitor.isOnline()).toBe(true);\r\n      expect(callback).toHaveBeenCalledWith(true);\r\n      expect(callback).toHaveBeenCalledTimes(2); // Once for offline, once for online\r\n    });\r\n\r\n    it('should emit event only once for offline to online', async () => {\r\n      const callback = vi.fn();\r\n      monitor.onStatusChange(callback);\r\n\r\n      // Start offline\r\n      mockNetworkService.checkConnectivity = vi.fn().mockResolvedValue(false);\r\n      await monitor.forceCheck();\r\n\r\n      // Go online\r\n      mockNetworkService.checkConnectivity = vi.fn().mockResolvedValue(true);\r\n      await monitor.forceCheck();\r\n\r\n      // Stay online\r\n      await monitor.forceCheck();\r\n      await monitor.forceCheck();\r\n\r\n      // Should emit twice: once for initial offline, once for transition to online\r\n      expect(callback).toHaveBeenCalledTimes(2);\r\n      expect(callback).toHaveBeenNthCalledWith(1, false);\r\n      expect(callback).toHaveBeenNthCalledWith(2, true);\r\n    });\r\n\r\n    it('should log status change', async () => {\r\n      const consoleSpy = vi.spyOn(console, 'log').mockImplementation(() => {});\r\n\r\n      // Start offline\r\n      mockNetworkService.checkConnectivity = vi.fn().mockResolvedValue(false);\r\n      await monitor.forceCheck();\r\n\r\n      // Go online\r\n      mockNetworkService.checkConnectivity = vi.fn().mockResolvedValue(true);\r\n      await monitor.forceCheck();\r\n\r\n      expect(consoleSpy).toHaveBeenCalledWith(\r\n        expect.stringContaining('Connectivity status changed: offline → online')\r\n      );\r\n\r\n      consoleSpy.mockRestore();\r\n    });\r\n  });\r\n\r\n  describe('Event Listener Registration/Unregistration', () => {\r\n    it('should register event listener', () => {\r\n      const callback = vi.fn();\r\n      monitor.onStatusChange(callback);\r\n\r\n      expect(monitor.getListenerCount()).toBe(1);\r\n    });\r\n\r\n    it('should register multiple event listeners', () => {\r\n      const callback1 = vi.fn();\r\n      const callback2 = vi.fn();\r\n      const callback3 = vi.fn();\r\n\r\n      monitor.onStatusChange(callback1);\r\n      monitor.onStatusChange(callback2);\r\n      monitor.onStatusChange(callback3);\r\n\r\n      expect(monitor.getListenerCount()).toBe(3);\r\n    });\r\n\r\n    it('should unregister event listener', () => {\r\n      const callback = vi.fn();\r\n      const unsubscribe = monitor.onStatusChange(callback);\r\n\r\n      expect(monitor.getListenerCount()).toBe(1);\r\n\r\n      unsubscribe();\r\n\r\n      expect(monitor.getListenerCount()).toBe(0);\r\n    });\r\n\r\n    it('should unregister specific listener', () => {\r\n      const callback1 = vi.fn();\r\n      const callback2 = vi.fn();\r\n      const callback3 = vi.fn();\r\n\r\n      const unsubscribe1 = monitor.onStatusChange(callback1);\r\n      const unsubscribe2 = monitor.onStatusChange(callback2);\r\n      monitor.onStatusChange(callback3);\r\n\r\n      expect(monitor.getListenerCount()).toBe(3);\r\n\r\n      unsubscribe1();\r\n      expect(monitor.getListenerCount()).toBe(2);\r\n\r\n      unsubscribe2();\r\n      expect(monitor.getListenerCount()).toBe(1);\r\n    });\r\n\r\n    it('should call all registered listeners on status change', async () => {\r\n      const callback1 = vi.fn();\r\n      const callback2 = vi.fn();\r\n      const callback3 = vi.fn();\r\n\r\n      monitor.onStatusChange(callback1);\r\n      monitor.onStatusChange(callback2);\r\n      monitor.onStatusChange(callback3);\r\n\r\n      // Change status\r\n      mockNetworkService.checkConnectivity = vi.fn().mockResolvedValue(false);\r\n      await monitor.forceCheck();\r\n\r\n      expect(callback1).toHaveBeenCalledWith(false);\r\n      expect(callback2).toHaveBeenCalledWith(false);\r\n      expect(callback3).toHaveBeenCalledWith(false);\r\n    });\r\n\r\n    it('should not call unregistered listeners', async () => {\r\n      const callback1 = vi.fn();\r\n      const callback2 = vi.fn();\r\n\r\n      monitor.onStatusChange(callback1);\r\n      const unsubscribe2 = monitor.onStatusChange(callback2);\r\n\r\n      // Unregister callback2\r\n      unsubscribe2();\r\n\r\n      // Change status\r\n      mockNetworkService.checkConnectivity = vi.fn().mockResolvedValue(false);\r\n      await monitor.forceCheck();\r\n\r\n      expect(callback1).toHaveBeenCalledWith(false);\r\n      expect(callback2).not.toHaveBeenCalled();\r\n    });\r\n\r\n    it('should handle listener errors gracefully', async () => {\r\n      const errorCallback = vi.fn().mockImplementation(() => {\r\n        throw new Error('Listener error');\r\n      });\r\n      const normalCallback = vi.fn();\r\n\r\n      const consoleSpy = vi.spyOn(console, 'error').mockImplementation(() => {});\r\n\r\n      monitor.onStatusChange(errorCallback);\r\n      monitor.onStatusChange(normalCallback);\r\n\r\n      // Change status\r\n      mockNetworkService.checkConnectivity = vi.fn().mockResolvedValue(false);\r\n      await monitor.forceCheck();\r\n\r\n      // Both callbacks should be called, even though one throws\r\n      expect(errorCallback).toHaveBeenCalled();\r\n      expect(normalCallback).toHaveBeenCalled();\r\n      expect(consoleSpy).toHaveBeenCalledWith(\r\n        'Error in connectivity status change callback:',\r\n        expect.any(Error)\r\n      );\r\n\r\n      consoleSpy.mockRestore();\r\n    });\r\n  });\r\n\r\n  describe('Error Handling', () => {\r\n    it('should handle connectivity check errors', async () => {\r\n      const callback = vi.fn();\r\n      monitor.onStatusChange(callback);\r\n\r\n      const consoleSpy = vi.spyOn(console, 'error').mockImplementation(() => {});\r\n\r\n      // Mock checkConnectivity to throw an error\r\n      mockNetworkService.checkConnectivity = vi.fn().mockRejectedValue(\r\n        new Error('Network check failed')\r\n      );\r\n\r\n      await monitor.forceCheck();\r\n\r\n      // Should assume offline on error\r\n      expect(monitor.isOnline()).toBe(false);\r\n      expect(callback).toHaveBeenCalledWith(false);\r\n      expect(consoleSpy).toHaveBeenCalledWith(\r\n        'Error checking connectivity:',\r\n        expect.any(Error)\r\n      );\r\n\r\n      consoleSpy.mockRestore();\r\n    });\r\n\r\n    it('should only emit event once when multiple errors occur', async () => {\r\n      const callback = vi.fn();\r\n      monitor.onStatusChange(callback);\r\n\r\n      // Mock checkConnectivity to throw an error\r\n      mockNetworkService.checkConnectivity = vi.fn().mockRejectedValue(\r\n        new Error('Network check failed')\r\n      );\r\n\r\n      await monitor.forceCheck();\r\n      await monitor.forceCheck();\r\n      await monitor.forceCheck();\r\n\r\n      // Should only emit once for the transition to offline\r\n      expect(callback).toHaveBeenCalledTimes(1);\r\n      expect(callback).toHaveBeenCalledWith(false);\r\n    });\r\n  });\r\n\r\n  describe('Periodic Checking', () => {\r\n    beforeEach(() => {\r\n      vi.useFakeTimers();\r\n    });\r\n\r\n    afterEach(() => {\r\n      vi.useRealTimers();\r\n    });\r\n\r\n    it('should check connectivity every 30 seconds', async () => {\r\n      monitor.start();\r\n\r\n      // Initial check\r\n      await vi.runOnlyPendingTimersAsync();\r\n      expect(mockNetworkService.checkConnectivity).toHaveBeenCalledTimes(1);\r\n\r\n      // After 30 seconds\r\n      vi.advanceTimersByTime(30000);\r\n      await vi.runOnlyPendingTimersAsync();\r\n      expect(mockNetworkService.checkConnectivity).toHaveBeenCalledTimes(2);\r\n\r\n      // After another 30 seconds\r\n      vi.advanceTimersByTime(30000);\r\n      await vi.runOnlyPendingTimersAsync();\r\n      expect(mockNetworkService.checkConnectivity).toHaveBeenCalledTimes(3);\r\n    });\r\n\r\n    it('should stop periodic checking when stopped', async () => {\r\n      monitor.start();\r\n\r\n      // Initial check\r\n      await vi.runOnlyPendingTimersAsync();\r\n      expect(mockNetworkService.checkConnectivity).toHaveBeenCalledTimes(1);\r\n\r\n      // Stop the monitor\r\n      monitor.stop();\r\n\r\n      // Advance time\r\n      vi.advanceTimersByTime(60000); // 60 seconds\r\n      await vi.runOnlyPendingTimersAsync();\r\n\r\n      // Should not have checked again\r\n      expect(mockNetworkService.checkConnectivity).toHaveBeenCalledTimes(1);\r\n    });\r\n  });\r\n\r\n  describe('Singleton Pattern', () => {\r\n    it('should return the same instance', () => {\r\n      const instance1 = getConnectivityMonitor();\r\n      const instance2 = getConnectivityMonitor();\r\n\r\n      expect(instance1).toBe(instance2);\r\n    });\r\n\r\n    it('should reset singleton instance', () => {\r\n      const instance1 = getConnectivityMonitor();\r\n      resetConnectivityMonitor();\r\n      const instance2 = getConnectivityMonitor();\r\n\r\n      expect(instance1).not.toBe(instance2);\r\n    });\r\n\r\n    it('should stop monitor when resetting', () => {\r\n      const instance = getConnectivityMonitor();\r\n      instance.start();\r\n\r\n      // Reset should stop the monitor\r\n      resetConnectivityMonitor();\r\n\r\n      // Should not throw\r\n      expect(() => resetConnectivityMonitor()).not.toThrow();\r\n    });\r\n  });\r\n\r\n  describe('Integration with RuntimeService', () => {\r\n    it('should use NetworkService from RuntimeService', () => {\r\n      expect(RuntimeService.getNetworkService).toHaveBeenCalled();\r\n    });\r\n\r\n    it('should work with different NetworkService implementations', async () => {\r\n      const customNetworkService: NetworkService = {\r\n        checkConnectivity: vi.fn().mockResolvedValue(false),\r\n        get: vi.fn(),\r\n        post: vi.fn(),\r\n        patch: vi.fn(),\r\n        delete: vi.fn(),\r\n      };\r\n\r\n      vi.spyOn(RuntimeService, 'getNetworkService').mockReturnValue(customNetworkService);\r\n\r\n      const customMonitor = new ConnectivityMonitorImpl();\r\n      await customMonitor.forceCheck();\r\n\r\n      expect(customNetworkService.checkConnectivity).toHaveBeenCalled();\r\n      expect(customMonitor.isOnline()).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe('Edge Cases', () => {\r\n    it('should handle rapid status changes', async () => {\r\n      const callback = vi.fn();\r\n      monitor.onStatusChange(callback);\r\n\r\n      // Rapid changes: online → offline → online → offline\r\n      mockNetworkService.checkConnectivity = vi.fn().mockResolvedValue(false);\r\n      await monitor.forceCheck();\r\n\r\n      mockNetworkService.checkConnectivity = vi.fn().mockResolvedValue(true);\r\n      await monitor.forceCheck();\r\n\r\n      mockNetworkService.checkConnectivity = vi.fn().mockResolvedValue(false);\r\n      await monitor.forceCheck();\r\n\r\n      // Should emit for each transition\r\n      expect(callback).toHaveBeenCalledTimes(3);\r\n      expect(callback).toHaveBeenNthCalledWith(1, false);\r\n      expect(callback).toHaveBeenNthCalledWith(2, true);\r\n      expect(callback).toHaveBeenNthCalledWith(3, false);\r\n    });\r\n\r\n    it('should handle no status change', async () => {\r\n      const callback = vi.fn();\r\n      monitor.onStatusChange(callback);\r\n\r\n      // Stay online\r\n      mockNetworkService.checkConnectivity = vi.fn().mockResolvedValue(true);\r\n      await monitor.forceCheck();\r\n      await monitor.forceCheck();\r\n      await monitor.forceCheck();\r\n\r\n      // Should not emit any events (no status change)\r\n      expect(callback).not.toHaveBeenCalled();\r\n    });\r\n\r\n    it('should handle concurrent force checks', async () => {\r\n      const callback = vi.fn();\r\n      monitor.onStatusChange(callback);\r\n\r\n      mockNetworkService.checkConnectivity = vi.fn().mockResolvedValue(false);\r\n\r\n      // Trigger multiple concurrent checks\r\n      await Promise.all([\r\n        monitor.forceCheck(),\r\n        monitor.forceCheck(),\r\n        monitor.forceCheck(),\r\n      ]);\r\n\r\n      // Should only emit once for the status change\r\n      expect(callback).toHaveBeenCalledTimes(1);\r\n      expect(callback).toHaveBeenCalledWith(false);\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\runtime\\__tests__\\network-service.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1100,1103],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1100,1103],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1436,1439],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1436,1439],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1847,1850],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1847,1850],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":70,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2236,2239],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2236,2239],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":82,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2588,2591],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2588,2591],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":95,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2953,2956],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2953,2956],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":114,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3477,3480],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3477,3480],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":137,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":137,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4178,4181],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4178,4181],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":149,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4513,4516],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4513,4516],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":161,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":161,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4850,4853],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4850,4853],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":174,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":174,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5209,5212],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5209,5212],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":193,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":193,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5751,5754],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5751,5754],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":213,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":213,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6300,6303],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6300,6303],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":224,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":224,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6606,6609],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6606,6609],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":239,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":239,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7038,7041],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7038,7041],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":261,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":261,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7743,7746],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7743,7746],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":289,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":289,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8595,8598],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8595,8598],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":303,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":303,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9050,9053],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9050,9053],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":322,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":322,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9622,9625],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9622,9625],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":341,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":341,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10202,10205],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10202,10205],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":358,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":358,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10725,10728],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10725,10728],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":382,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":382,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11414,11417],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11414,11417],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":417,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":417,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12393,12396],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12393,12396],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":431,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":431,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12760,12763],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12760,12763],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":440,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":440,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13048,13051],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13048,13051],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":454,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":454,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13423,13426],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13423,13426],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":470,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":470,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13867,13870],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13867,13870],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":486,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":486,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14359,14362],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14359,14362],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":504,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":504,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14914,14917],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14914,14917],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":514,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":514,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15197,15200],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15197,15200],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":535,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":535,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15728,15731],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15728,15731],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":545,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":545,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16020,16023],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16020,16023],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":32,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Unit Tests for Network Service Error Handling\r\n * \r\n * These tests verify specific examples, edge cases, and error conditions\r\n * for the network service implementations.\r\n * \r\n * Testing Framework: Vitest\r\n * \r\n * Feature: tauri-dashboard-medico\r\n * Task: 3.3 - Write unit tests for network error handling\r\n * Validates: Requirements 7.6\r\n */\r\n\r\nimport { describe, it, expect, beforeEach, afterEach, vi } from 'vitest';\r\nimport { WebNetworkService, NetworkError, NetworkErrorType } from '../services/web-network-service';\r\nimport type { NetworkService } from '../types';\r\n\r\ndescribe('Network Service Error Handling', () => {\r\n  let networkService: NetworkService;\r\n\r\n  beforeEach(() => {\r\n    // Use WebNetworkService for testing as it's easier to mock\r\n    networkService = new WebNetworkService();\r\n    \r\n    // Mock fetch globally\r\n    global.fetch = vi.fn();\r\n  });\r\n\r\n  afterEach(() => {\r\n    vi.restoreAllMocks();\r\n  });\r\n\r\n  describe('Connection Timeout', () => {\r\n    it('should timeout after specified duration', async () => {\r\n      // Mock a slow response\r\n      (global.fetch as any).mockImplementation(() => \r\n        new Promise(resolve => setTimeout(resolve, 10000))\r\n      );\r\n\r\n      await expect(\r\n        networkService.get('/api/test', { timeout: 100 })\r\n      ).rejects.toThrow('Request timed out');\r\n    });\r\n\r\n    it('should not timeout if response is fast enough', async () => {\r\n      (global.fetch as any).mockResolvedValue({\r\n        ok: true,\r\n        json: async () => ({ data: 'test' }),\r\n      });\r\n\r\n      const result = await networkService.get('/api/test', { timeout: 1000 });\r\n      expect(result).toEqual({ data: 'test' });\r\n    });\r\n\r\n    it('should use default timeout if not specified', async () => {\r\n      // Mock a response that takes 35 seconds (longer than default 30s)\r\n      (global.fetch as any).mockImplementation(() => \r\n        new Promise(resolve => setTimeout(resolve, 35000))\r\n      );\r\n\r\n      // Should timeout with default timeout\r\n      await expect(\r\n        networkService.get('/api/test')\r\n      ).rejects.toThrow();\r\n    });\r\n  });\r\n\r\n  describe('Server Errors (5xx)', () => {\r\n    it('should handle 500 Internal Server Error', async () => {\r\n      (global.fetch as any).mockResolvedValue({\r\n        ok: false,\r\n        status: 500,\r\n        json: async () => ({ error: 'Internal Server Error' }),\r\n      });\r\n\r\n      await expect(\r\n        networkService.get('/api/test')\r\n      ).rejects.toThrow('Server error: 500');\r\n    });\r\n\r\n    it('should handle 503 Service Unavailable', async () => {\r\n      (global.fetch as any).mockResolvedValue({\r\n        ok: false,\r\n        status: 503,\r\n        json: async () => ({ error: 'Service Unavailable' }),\r\n      });\r\n\r\n      await expect(\r\n        networkService.get('/api/test')\r\n      ).rejects.toThrow('Server error: 503');\r\n    });\r\n\r\n    it('should retry on 500 errors', async () => {\r\n      let callCount = 0;\r\n      (global.fetch as any).mockImplementation(() => {\r\n        callCount++;\r\n        return Promise.resolve({\r\n          ok: false,\r\n          status: 500,\r\n          json: async () => ({ error: 'Internal Server Error' }),\r\n        });\r\n      });\r\n\r\n      await expect(\r\n        networkService.get('/api/test', { retries: 3 })\r\n      ).rejects.toThrow();\r\n\r\n      // Should have tried 3 times\r\n      expect(callCount).toBe(3);\r\n    });\r\n\r\n    it('should succeed if retry succeeds', async () => {\r\n      let callCount = 0;\r\n      (global.fetch as any).mockImplementation(() => {\r\n        callCount++;\r\n        if (callCount < 3) {\r\n          return Promise.resolve({\r\n            ok: false,\r\n            status: 500,\r\n            json: async () => ({ error: 'Internal Server Error' }),\r\n          });\r\n        }\r\n        return Promise.resolve({\r\n          ok: true,\r\n          json: async () => ({ data: 'success' }),\r\n        });\r\n      });\r\n\r\n      const result = await networkService.get('/api/test', { retries: 3 });\r\n      expect(result).toEqual({ data: 'success' });\r\n      expect(callCount).toBe(3);\r\n    });\r\n  });\r\n\r\n  describe('Client Errors (4xx)', () => {\r\n    it('should handle 400 Bad Request', async () => {\r\n      (global.fetch as any).mockResolvedValue({\r\n        ok: false,\r\n        status: 400,\r\n        json: async () => ({ error: 'Bad Request' }),\r\n      });\r\n\r\n      await expect(\r\n        networkService.get('/api/test')\r\n      ).rejects.toThrow('Client error: 400');\r\n    });\r\n\r\n    it('should handle 401 Unauthorized', async () => {\r\n      (global.fetch as any).mockResolvedValue({\r\n        ok: false,\r\n        status: 401,\r\n        json: async () => ({ error: 'Unauthorized' }),\r\n      });\r\n\r\n      await expect(\r\n        networkService.get('/api/test')\r\n      ).rejects.toThrow('Authentication failed');\r\n    });\r\n\r\n    it('should handle 404 Not Found', async () => {\r\n      (global.fetch as any).mockResolvedValue({\r\n        ok: false,\r\n        status: 404,\r\n        json: async () => ({ error: 'Not Found' }),\r\n      });\r\n\r\n      await expect(\r\n        networkService.get('/api/test')\r\n      ).rejects.toThrow('Client error: 404');\r\n    });\r\n\r\n    it('should NOT retry on 401 errors', async () => {\r\n      let callCount = 0;\r\n      (global.fetch as any).mockImplementation(() => {\r\n        callCount++;\r\n        return Promise.resolve({\r\n          ok: false,\r\n          status: 401,\r\n          json: async () => ({ error: 'Unauthorized' }),\r\n        });\r\n      });\r\n\r\n      await expect(\r\n        networkService.get('/api/test', { retries: 3 })\r\n      ).rejects.toThrow('Authentication failed');\r\n\r\n      // Should NOT retry on auth errors\r\n      expect(callCount).toBe(1);\r\n    });\r\n\r\n    it('should NOT retry on 400 errors', async () => {\r\n      let callCount = 0;\r\n      (global.fetch as any).mockImplementation(() => {\r\n        callCount++;\r\n        return Promise.resolve({\r\n          ok: false,\r\n          status: 400,\r\n          json: async () => ({ error: 'Bad Request' }),\r\n        });\r\n      });\r\n\r\n      await expect(\r\n        networkService.get('/api/test', { retries: 3 })\r\n      ).rejects.toThrow();\r\n\r\n      // Should NOT retry on client errors\r\n      expect(callCount).toBe(1);\r\n    });\r\n  });\r\n\r\n  describe('Network Connection Errors', () => {\r\n    it('should handle network failure', async () => {\r\n      (global.fetch as any).mockRejectedValue(\r\n        new TypeError('Failed to fetch')\r\n      );\r\n\r\n      await expect(\r\n        networkService.get('/api/test')\r\n      ).rejects.toThrow('Connection failed');\r\n    });\r\n\r\n    it('should retry on network failures', async () => {\r\n      let callCount = 0;\r\n      (global.fetch as any).mockImplementation(() => {\r\n        callCount++;\r\n        return Promise.reject(new TypeError('Failed to fetch'));\r\n      });\r\n\r\n      await expect(\r\n        networkService.get('/api/test', { retries: 3 })\r\n      ).rejects.toThrow();\r\n\r\n      // Should have tried 3 times\r\n      expect(callCount).toBe(3);\r\n    });\r\n\r\n    it('should succeed if network recovers', async () => {\r\n      let callCount = 0;\r\n      (global.fetch as any).mockImplementation(() => {\r\n        callCount++;\r\n        if (callCount < 2) {\r\n          return Promise.reject(new TypeError('Failed to fetch'));\r\n        }\r\n        return Promise.resolve({\r\n          ok: true,\r\n          json: async () => ({ data: 'success' }),\r\n        });\r\n      });\r\n\r\n      const result = await networkService.get('/api/test', { retries: 3 });\r\n      expect(result).toEqual({ data: 'success' });\r\n      expect(callCount).toBe(2);\r\n    });\r\n  });\r\n\r\n  describe('Retry with Exponential Backoff', () => {\r\n    it('should wait with exponential backoff between retries', async () => {\r\n      const delays: number[] = [];\r\n      let lastTime = Date.now();\r\n\r\n      (global.fetch as any).mockImplementation(() => {\r\n        const now = Date.now();\r\n        if (delays.length > 0) {\r\n          delays.push(now - lastTime);\r\n        }\r\n        lastTime = now;\r\n        return Promise.resolve({\r\n          ok: false,\r\n          status: 500,\r\n          json: async () => ({ error: 'Server Error' }),\r\n        });\r\n      });\r\n\r\n      await expect(\r\n        networkService.get('/api/test', { retries: 3 })\r\n      ).rejects.toThrow();\r\n\r\n      // Should have 2 delays (between 3 attempts)\r\n      expect(delays.length).toBe(2);\r\n      \r\n      // Second delay should be roughly 2x the first (exponential backoff)\r\n      // Allow some tolerance for timing\r\n      expect(delays[1]).toBeGreaterThan(delays[0] * 1.5);\r\n    });\r\n  });\r\n\r\n  describe('HTTP Methods', () => {\r\n    it('should handle GET requests', async () => {\r\n      (global.fetch as any).mockResolvedValue({\r\n        ok: true,\r\n        json: async () => ({ data: 'get-result' }),\r\n      });\r\n\r\n      const result = await networkService.get('/api/test');\r\n      expect(result).toEqual({ data: 'get-result' });\r\n      expect(global.fetch).toHaveBeenCalledWith(\r\n        expect.any(String),\r\n        expect.objectContaining({ method: 'GET' })\r\n      );\r\n    });\r\n\r\n    it('should handle POST requests', async () => {\r\n      (global.fetch as any).mockResolvedValue({\r\n        ok: true,\r\n        json: async () => ({ data: 'post-result' }),\r\n      });\r\n\r\n      const body = { name: 'test' };\r\n      const result = await networkService.post('/api/test', body);\r\n      \r\n      expect(result).toEqual({ data: 'post-result' });\r\n      expect(global.fetch).toHaveBeenCalledWith(\r\n        expect.any(String),\r\n        expect.objectContaining({\r\n          method: 'POST',\r\n          body: JSON.stringify(body),\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should handle PATCH requests', async () => {\r\n      (global.fetch as any).mockResolvedValue({\r\n        ok: true,\r\n        json: async () => ({ data: 'patch-result' }),\r\n      });\r\n\r\n      const body = { name: 'updated' };\r\n      const result = await networkService.patch('/api/test', body);\r\n      \r\n      expect(result).toEqual({ data: 'patch-result' });\r\n      expect(global.fetch).toHaveBeenCalledWith(\r\n        expect.any(String),\r\n        expect.objectContaining({\r\n          method: 'PATCH',\r\n          body: JSON.stringify(body),\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should handle DELETE requests', async () => {\r\n      (global.fetch as any).mockResolvedValue({\r\n        ok: true,\r\n        json: async () => ({ data: 'delete-result' }),\r\n      });\r\n\r\n      const result = await networkService.delete('/api/test');\r\n      \r\n      expect(result).toEqual({ data: 'delete-result' });\r\n      expect(global.fetch).toHaveBeenCalledWith(\r\n        expect.any(String),\r\n        expect.objectContaining({ method: 'DELETE' })\r\n      );\r\n    });\r\n  });\r\n\r\n  describe('Request Headers', () => {\r\n    it('should include custom headers', async () => {\r\n      (global.fetch as any).mockResolvedValue({\r\n        ok: true,\r\n        json: async () => ({ data: 'test' }),\r\n      });\r\n\r\n      await networkService.get('/api/test', {\r\n        headers: {\r\n          'Authorization': 'Bearer token123',\r\n          'X-Custom-Header': 'custom-value',\r\n        },\r\n      });\r\n\r\n      expect(global.fetch).toHaveBeenCalledWith(\r\n        expect.any(String),\r\n        expect.objectContaining({\r\n          headers: expect.objectContaining({\r\n            'Authorization': 'Bearer token123',\r\n            'X-Custom-Header': 'custom-value',\r\n          }),\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should include Content-Type header by default', async () => {\r\n      (global.fetch as any).mockResolvedValue({\r\n        ok: true,\r\n        json: async () => ({ data: 'test' }),\r\n      });\r\n\r\n      await networkService.post('/api/test', { data: 'test' });\r\n\r\n      expect(global.fetch).toHaveBeenCalledWith(\r\n        expect.any(String),\r\n        expect.objectContaining({\r\n          headers: expect.objectContaining({\r\n            'Content-Type': 'application/json',\r\n          }),\r\n        })\r\n      );\r\n    });\r\n  });\r\n\r\n  describe('Connectivity Check', () => {\r\n    it('should return false when navigator.onLine is false', async () => {\r\n      Object.defineProperty(navigator, 'onLine', {\r\n        writable: true,\r\n        value: false,\r\n      });\r\n\r\n      const isOnline = await networkService.checkConnectivity();\r\n      expect(isOnline).toBe(false);\r\n    });\r\n\r\n    it('should return true when ping succeeds', async () => {\r\n      Object.defineProperty(navigator, 'onLine', {\r\n        writable: true,\r\n        value: true,\r\n      });\r\n\r\n      (global.fetch as any).mockResolvedValue({\r\n        ok: true,\r\n      });\r\n\r\n      const isOnline = await networkService.checkConnectivity();\r\n      expect(isOnline).toBe(true);\r\n    });\r\n\r\n    it('should return false when ping fails', async () => {\r\n      Object.defineProperty(navigator, 'onLine', {\r\n        writable: true,\r\n        value: true,\r\n      });\r\n\r\n      (global.fetch as any).mockRejectedValue(new Error('Network error'));\r\n\r\n      const isOnline = await networkService.checkConnectivity();\r\n      expect(isOnline).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe('URL Handling', () => {\r\n    it('should handle relative URLs', async () => {\r\n      (global.fetch as any).mockResolvedValue({\r\n        ok: true,\r\n        json: async () => ({ data: 'test' }),\r\n      });\r\n\r\n      await networkService.get('/api/test');\r\n\r\n      expect(global.fetch).toHaveBeenCalledWith(\r\n        expect.stringContaining('/api/test'),\r\n        expect.any(Object)\r\n      );\r\n    });\r\n\r\n    it('should handle absolute URLs', async () => {\r\n      (global.fetch as any).mockResolvedValue({\r\n        ok: true,\r\n        json: async () => ({ data: 'test' }),\r\n      });\r\n\r\n      await networkService.get('https://example.com/api/test');\r\n\r\n      expect(global.fetch).toHaveBeenCalledWith(\r\n        'https://example.com/api/test',\r\n        expect.any(Object)\r\n      );\r\n    });\r\n  });\r\n\r\n  describe('Error Information', () => {\r\n    it('should include status code in error', async () => {\r\n      (global.fetch as any).mockResolvedValue({\r\n        ok: false,\r\n        status: 404,\r\n        json: async () => ({ error: 'Not Found' }),\r\n      });\r\n\r\n      try {\r\n        await networkService.get('/api/test');\r\n        expect.fail('Should have thrown an error');\r\n      } catch (error) {\r\n        expect(error).toBeInstanceOf(NetworkError);\r\n        expect((error as NetworkError).statusCode).toBe(404);\r\n      }\r\n    });\r\n\r\n    it('should include error type in error', async () => {\r\n      (global.fetch as any).mockResolvedValue({\r\n        ok: false,\r\n        status: 500,\r\n        json: async () => ({ error: 'Server Error' }),\r\n      });\r\n\r\n      try {\r\n        await networkService.get('/api/test');\r\n        expect.fail('Should have thrown an error');\r\n      } catch (error) {\r\n        expect(error).toBeInstanceOf(NetworkError);\r\n        expect((error as NetworkError).type).toBe(NetworkErrorType.SERVER_ERROR);\r\n      }\r\n    });\r\n  });\r\n\r\n  describe('Edge Cases', () => {\r\n    it('should handle empty response body', async () => {\r\n      (global.fetch as any).mockResolvedValue({\r\n        ok: true,\r\n        json: async () => null,\r\n      });\r\n\r\n      const result = await networkService.get('/api/test');\r\n      expect(result).toBeNull();\r\n    });\r\n\r\n    it('should handle malformed JSON response', async () => {\r\n      (global.fetch as any).mockResolvedValue({\r\n        ok: true,\r\n        json: async () => {\r\n          throw new SyntaxError('Unexpected token');\r\n        },\r\n      });\r\n\r\n      await expect(\r\n        networkService.get('/api/test')\r\n      ).rejects.toThrow();\r\n    });\r\n\r\n    it('should handle very large response', async () => {\r\n      const largeData = {\r\n        items: Array.from({ length: 10000 }, (_, i) => ({\r\n          id: i,\r\n          name: `Item ${i}`,\r\n          data: 'x'.repeat(1000),\r\n        })),\r\n      };\r\n\r\n      (global.fetch as any).mockResolvedValue({\r\n        ok: true,\r\n        json: async () => largeData,\r\n      });\r\n\r\n      const result = await networkService.get('/api/test');\r\n      expect(result).toEqual(largeData);\r\n    });\r\n\r\n    it('should handle concurrent requests', async () => {\r\n      (global.fetch as any).mockResolvedValue({\r\n        ok: true,\r\n        json: async () => ({ data: 'test' }),\r\n      });\r\n\r\n      const promises = Array.from({ length: 10 }, (_, i) =>\r\n        networkService.get(`/api/test/${i}`)\r\n      );\r\n\r\n      const results = await Promise.all(promises);\r\n      expect(results).toHaveLength(10);\r\n      results.forEach(result => {\r\n        expect(result).toEqual({ data: 'test' });\r\n      });\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\runtime\\__tests__\\runtime-service.property.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1898,1901],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1898,1901],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":63,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2359,2362],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2359,2362],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2452,2455],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2452,2455],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":75,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2617,2620],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2617,2620],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":77,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2671,2674],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2671,2674],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":337,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":337,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11416,11419],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11416,11419],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":483,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":483,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17017,17020],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17017,17020],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":489,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":489,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17257,17260],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17257,17260],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":495,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":495,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17510,17513],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17510,17513],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":501,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":501,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17832,17835],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17832,17835],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Property-Based Tests for Runtime Service\r\n * \r\n * These tests validate correctness properties that should hold true\r\n * across all valid executions of the runtime service.\r\n * \r\n * Testing Framework: fast-check (property-based testing)\r\n * Test Runner: Vitest\r\n * \r\n * Feature: tauri-dashboard-medico\r\n * Property 17: Runtime-Specific Implementation Selection\r\n * Validates: Requirements 7.3, 9.2, 9.3\r\n */\r\n\r\nimport { describe, it, expect, beforeEach, afterEach, vi } from 'vitest';\r\nimport fc from 'fast-check';\r\nimport { RuntimeService, RuntimeServiceImpl } from '../runtime-service';\r\nimport { TauriNetworkService } from '../services/tauri-network-service';\r\nimport { WebNetworkService } from '../services/web-network-service';\r\nimport { TauriStorageService } from '../services/tauri-storage-service';\r\nimport { WebStorageService } from '../services/web-storage-service';\r\nimport type { NetworkService, StorageService } from '../types';\r\n\r\n/**\r\n * Property 17: Runtime-Specific Implementation Selection\r\n * \r\n * For any operation that has runtime-specific implementations (storage, network, \r\n * notifications), the correct implementation SHALL be selected based on the \r\n * detected runtime (Tauri vs Web).\r\n * \r\n * **Validates: Requirements 7.3, 9.2, 9.3**\r\n * \r\n * This property test verifies that:\r\n * 1. RuntimeService correctly detects the environment (Tauri vs Web)\r\n * 2. RuntimeService returns TauriNetworkService in Tauri environment\r\n * 3. RuntimeService returns WebNetworkService in web environment\r\n * 4. RuntimeService returns TauriStorageService in Tauri environment\r\n * 5. RuntimeService returns WebStorageService in web environment\r\n * 6. The selection is consistent across multiple calls\r\n * 7. The selection is correct regardless of the order of service requests\r\n */\r\ndescribe('Property 17: Runtime-Specific Implementation Selection', () => {\r\n  let originalWindow: any;\r\n\r\n  beforeEach(() => {\r\n    // Save original window state\r\n    originalWindow = global.window;\r\n  });\r\n\r\n  afterEach(() => {\r\n    // Restore original window state\r\n    global.window = originalWindow;\r\n    \r\n    // Reset runtime service singleton instance\r\n    RuntimeServiceImpl.resetInstance();\r\n  });\r\n\r\n  /**\r\n   * Helper to mock Tauri environment\r\n   */\r\n  function mockTauriEnvironment() {\r\n    if (typeof window !== 'undefined') {\r\n      (window as any).__TAURI__ = {\r\n        invoke: vi.fn(),\r\n      };\r\n    }\r\n    global.window = window as any;\r\n  }\r\n\r\n  /**\r\n   * Helper to mock Web environment\r\n   */\r\n  function mockWebEnvironment() {\r\n    if (typeof window !== 'undefined') {\r\n      delete (window as any).__TAURI__;\r\n    }\r\n    global.window = window as any;\r\n  }\r\n\r\n  /**\r\n   * Test that RuntimeService correctly selects TauriNetworkService in Tauri environment\r\n   */\r\n  it('should select TauriNetworkService when running in Tauri environment', () => {\r\n    fc.assert(\r\n      fc.property(\r\n        // Generate arbitrary number of service requests\r\n        fc.integer({ min: 1, max: 10 }),\r\n        (numRequests) => {\r\n          // Setup: Mock Tauri environment\r\n          mockTauriEnvironment();\r\n          \r\n          // Verify environment detection\r\n          expect(RuntimeService.isTauri()).toBe(true);\r\n          expect(RuntimeService.isWeb()).toBe(false);\r\n          \r\n          // Execute: Request network service multiple times\r\n          const services: NetworkService[] = [];\r\n          for (let i = 0; i < numRequests; i++) {\r\n            services.push(RuntimeService.getNetworkService());\r\n          }\r\n          \r\n          // Verify: All instances should be TauriNetworkService\r\n          services.forEach(service => {\r\n            expect(service).toBeInstanceOf(TauriNetworkService);\r\n          });\r\n          \r\n          // Verify: All instances should be the same (singleton pattern)\r\n          const firstService = services[0];\r\n          services.forEach(service => {\r\n            expect(service).toBe(firstService);\r\n          });\r\n        }\r\n      ),\r\n      { numRuns: 100 }\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that RuntimeService correctly selects WebNetworkService in web environment\r\n   */\r\n  it('should select WebNetworkService when running in web environment', () => {\r\n    fc.assert(\r\n      fc.property(\r\n        // Generate arbitrary number of service requests\r\n        fc.integer({ min: 1, max: 10 }),\r\n        (numRequests) => {\r\n          // Setup: Mock web environment\r\n          mockWebEnvironment();\r\n          \r\n          // Reset to pick up new environment\r\n          RuntimeService.resetServices();\r\n          \r\n          // Verify environment detection\r\n          expect(RuntimeService.isWeb()).toBe(true);\r\n          expect(RuntimeService.isTauri()).toBe(false);\r\n          \r\n          // Execute: Request network service multiple times\r\n          const services: NetworkService[] = [];\r\n          for (let i = 0; i < numRequests; i++) {\r\n            services.push(RuntimeService.getNetworkService());\r\n          }\r\n          \r\n          // Verify: All instances should be WebNetworkService\r\n          services.forEach(service => {\r\n            expect(service).toBeInstanceOf(WebNetworkService);\r\n          });\r\n          \r\n          // Verify: All instances should be the same (singleton pattern)\r\n          const firstService = services[0];\r\n          services.forEach(service => {\r\n            expect(service).toBe(firstService);\r\n          });\r\n        }\r\n      ),\r\n      { numRuns: 100 }\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that RuntimeService correctly selects TauriStorageService in Tauri environment\r\n   */\r\n  it('should select TauriStorageService when running in Tauri environment', () => {\r\n    fc.assert(\r\n      fc.property(\r\n        // Generate arbitrary number of service requests\r\n        fc.integer({ min: 1, max: 10 }),\r\n        (numRequests) => {\r\n          // Setup: Mock Tauri environment\r\n          mockTauriEnvironment();\r\n          \r\n          // Reset to pick up new environment\r\n          RuntimeService.resetServices();\r\n          \r\n          // Verify environment detection\r\n          expect(RuntimeService.isTauri()).toBe(true);\r\n          \r\n          // Execute: Request storage service multiple times\r\n          const services: StorageService[] = [];\r\n          for (let i = 0; i < numRequests; i++) {\r\n            services.push(RuntimeService.getStorageService());\r\n          }\r\n          \r\n          // Verify: All instances should be TauriStorageService\r\n          services.forEach(service => {\r\n            expect(service).toBeInstanceOf(TauriStorageService);\r\n          });\r\n          \r\n          // Verify: All instances should be the same (singleton pattern)\r\n          const firstService = services[0];\r\n          services.forEach(service => {\r\n            expect(service).toBe(firstService);\r\n          });\r\n        }\r\n      ),\r\n      { numRuns: 100 }\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that RuntimeService correctly selects WebStorageService in web environment\r\n   */\r\n  it('should select WebStorageService when running in web environment', () => {\r\n    fc.assert(\r\n      fc.property(\r\n        // Generate arbitrary number of service requests\r\n        fc.integer({ min: 1, max: 10 }),\r\n        (numRequests) => {\r\n          // Setup: Mock web environment\r\n          mockWebEnvironment();\r\n          \r\n          // Reset to pick up new environment\r\n          RuntimeService.resetServices();\r\n          \r\n          // Verify environment detection\r\n          expect(RuntimeService.isWeb()).toBe(true);\r\n          \r\n          // Execute: Request storage service multiple times\r\n          const services: StorageService[] = [];\r\n          for (let i = 0; i < numRequests; i++) {\r\n            services.push(RuntimeService.getStorageService());\r\n          }\r\n          \r\n          // Verify: All instances should be WebStorageService\r\n          services.forEach(service => {\r\n            expect(service).toBeInstanceOf(WebStorageService);\r\n          });\r\n          \r\n          // Verify: All instances should be the same (singleton pattern)\r\n          const firstService = services[0];\r\n          services.forEach(service => {\r\n            expect(service).toBe(firstService);\r\n          });\r\n        }\r\n      ),\r\n      { numRuns: 100 }\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that environment detection is consistent\r\n   */\r\n  it('should consistently detect Tauri environment', () => {\r\n    fc.assert(\r\n      fc.property(\r\n        // Generate arbitrary number of checks\r\n        fc.integer({ min: 1, max: 20 }),\r\n        (numChecks) => {\r\n          // Setup: Mock Tauri environment\r\n          mockTauriEnvironment();\r\n          \r\n          // Reset to pick up new environment\r\n          RuntimeService.resetServices();\r\n          \r\n          // Execute: Check environment multiple times\r\n          const results: boolean[] = [];\r\n          for (let i = 0; i < numChecks; i++) {\r\n            results.push(RuntimeService.isTauri());\r\n          }\r\n          \r\n          // Verify: All checks should return true\r\n          results.forEach(result => {\r\n            expect(result).toBe(true);\r\n          });\r\n          \r\n          // Verify: isWeb should return false\r\n          expect(RuntimeService.isWeb()).toBe(false);\r\n          \r\n          // Verify: getEnvironment should return 'tauri'\r\n          expect(RuntimeService.getEnvironment()).toBe('tauri');\r\n        }\r\n      ),\r\n      { numRuns: 100 }\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that environment detection is consistent for web\r\n   */\r\n  it('should consistently detect web environment', () => {\r\n    fc.assert(\r\n      fc.property(\r\n        // Generate arbitrary number of checks\r\n        fc.integer({ min: 1, max: 20 }),\r\n        (numChecks) => {\r\n          // Setup: Mock web environment\r\n          mockWebEnvironment();\r\n          \r\n          // Reset to pick up new environment\r\n          RuntimeService.resetServices();\r\n          \r\n          // Execute: Check environment multiple times\r\n          const results: boolean[] = [];\r\n          for (let i = 0; i < numChecks; i++) {\r\n            results.push(RuntimeService.isWeb());\r\n          }\r\n          \r\n          // Verify: All checks should return true\r\n          results.forEach(result => {\r\n            expect(result).toBe(true);\r\n          });\r\n          \r\n          // Verify: isTauri should return false\r\n          expect(RuntimeService.isTauri()).toBe(false);\r\n          \r\n          // Verify: getEnvironment should return 'web'\r\n          expect(RuntimeService.getEnvironment()).toBe('web');\r\n        }\r\n      ),\r\n      { numRuns: 100 }\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that service selection is independent of request order\r\n   */\r\n  it('should select correct services regardless of request order', () => {\r\n    fc.assert(\r\n      fc.property(\r\n        // Generate random sequence of service requests\r\n        fc.array(\r\n          fc.constantFrom('storage', 'network'),\r\n          { minLength: 2, maxLength: 10 }\r\n        ),\r\n        fc.boolean(), // Randomly choose Tauri or Web environment\r\n        (serviceSequence, isTauriEnv) => {\r\n          // Setup: Mock environment\r\n          if (isTauriEnv) {\r\n            mockTauriEnvironment();\r\n          } else {\r\n            mockWebEnvironment();\r\n          }\r\n          \r\n          // Reset to pick up new environment\r\n          RuntimeService.resetServices();\r\n          \r\n          // Execute: Request services in the given sequence\r\n          const services: any[] = [];\r\n          for (const serviceType of serviceSequence) {\r\n            if (serviceType === 'storage') {\r\n              services.push({\r\n                type: 'storage',\r\n                instance: RuntimeService.getStorageService(),\r\n              });\r\n            } else {\r\n              services.push({\r\n                type: 'network',\r\n                instance: RuntimeService.getNetworkService(),\r\n              });\r\n            }\r\n          }\r\n          \r\n          // Verify: All storage services should be of the correct type\r\n          const storageServices = services.filter(s => s.type === 'storage');\r\n          if (storageServices.length > 0) {\r\n            const expectedStorageType = isTauriEnv ? TauriStorageService : WebStorageService;\r\n            storageServices.forEach(s => {\r\n              expect(s.instance).toBeInstanceOf(expectedStorageType);\r\n            });\r\n            \r\n            // All storage services should be the same instance\r\n            const firstStorage = storageServices[0].instance;\r\n            storageServices.forEach(s => {\r\n              expect(s.instance).toBe(firstStorage);\r\n            });\r\n          }\r\n          \r\n          // Verify: All network services should be of the correct type\r\n          const networkServices = services.filter(s => s.type === 'network');\r\n          if (networkServices.length > 0) {\r\n            const expectedNetworkType = isTauriEnv ? TauriNetworkService : WebNetworkService;\r\n            networkServices.forEach(s => {\r\n              expect(s.instance).toBeInstanceOf(expectedNetworkType);\r\n            });\r\n            \r\n            // All network services should be the same instance\r\n            const firstNetwork = networkServices[0].instance;\r\n            networkServices.forEach(s => {\r\n              expect(s.instance).toBe(firstNetwork);\r\n            });\r\n          }\r\n        }\r\n      ),\r\n      { numRuns: 100 }\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that resetServices clears cached services\r\n   */\r\n  it('should clear cached services after reset', () => {\r\n    fc.assert(\r\n      fc.property(\r\n        fc.boolean(), // Randomly choose Tauri or Web environment\r\n        (isTauriEnv) => {\r\n          // Setup: Mock environment\r\n          if (isTauriEnv) {\r\n            mockTauriEnvironment();\r\n          } else {\r\n            mockWebEnvironment();\r\n          }\r\n          \r\n          // Reset to pick up new environment\r\n          RuntimeService.resetServices();\r\n          \r\n          // Execute: Get services, reset, then get again\r\n          const networkBefore = RuntimeService.getNetworkService();\r\n          const storageBefore = RuntimeService.getStorageService();\r\n          \r\n          RuntimeService.resetServices();\r\n          \r\n          const networkAfter = RuntimeService.getNetworkService();\r\n          const storageAfter = RuntimeService.getStorageService();\r\n          \r\n          // Verify: Services should be different instances after reset\r\n          expect(networkAfter).not.toBe(networkBefore);\r\n          expect(storageAfter).not.toBe(storageBefore);\r\n          \r\n          // Verify: But they should still be the correct type\r\n          const expectedNetworkType = isTauriEnv ? TauriNetworkService : WebNetworkService;\r\n          const expectedStorageType = isTauriEnv ? TauriStorageService : WebStorageService;\r\n          \r\n          expect(networkAfter).toBeInstanceOf(expectedNetworkType);\r\n          expect(storageAfter).toBeInstanceOf(expectedStorageType);\r\n        }\r\n      ),\r\n      { numRuns: 100 }\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that service selection works correctly after multiple resets\r\n   */\r\n  it('should maintain correct service selection after multiple resets', () => {\r\n    fc.assert(\r\n      fc.property(\r\n        fc.integer({ min: 1, max: 5 }), // Number of reset cycles\r\n        fc.boolean(), // Randomly choose Tauri or Web environment\r\n        (numResets, isTauriEnv) => {\r\n          // Setup: Mock environment\r\n          if (isTauriEnv) {\r\n            mockTauriEnvironment();\r\n          } else {\r\n            mockWebEnvironment();\r\n          }\r\n          \r\n          // Reset to pick up new environment\r\n          RuntimeService.resetServices();\r\n          \r\n          const expectedNetworkType = isTauriEnv ? TauriNetworkService : WebNetworkService;\r\n          const expectedStorageType = isTauriEnv ? TauriStorageService : WebStorageService;\r\n          \r\n          // Execute: Multiple reset cycles\r\n          for (let i = 0; i < numResets; i++) {\r\n            // Get services\r\n            const network = RuntimeService.getNetworkService();\r\n            const storage = RuntimeService.getStorageService();\r\n            \r\n            // Verify correct types\r\n            expect(network).toBeInstanceOf(expectedNetworkType);\r\n            expect(storage).toBeInstanceOf(expectedStorageType);\r\n            \r\n            // Reset for next cycle\r\n            RuntimeServiceImpl.resetInstance();\r\n          }\r\n          \r\n          // Final verification after all resets\r\n          const finalNetwork = RuntimeService.getNetworkService();\r\n          const finalStorage = RuntimeService.getStorageService();\r\n          \r\n          expect(finalNetwork).toBeInstanceOf(expectedNetworkType);\r\n          expect(finalStorage).toBeInstanceOf(expectedStorageType);\r\n        }\r\n      ),\r\n      { numRuns: 100 }\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that environment detection handles edge cases\r\n   */\r\n  it('should handle edge cases in environment detection', () => {\r\n    // Test case 1: window is undefined (should default to web)\r\n    global.window = undefined as any;\r\n    RuntimeServiceImpl.resetInstance();\r\n    expect(RuntimeService.isWeb()).toBe(true);\r\n    expect(RuntimeService.isTauri()).toBe(false);\r\n    \r\n    // Test case 2: window exists but __TAURI__ is undefined\r\n    global.window = {} as any;\r\n    RuntimeServiceImpl.resetInstance();\r\n    expect(RuntimeService.isWeb()).toBe(true);\r\n    expect(RuntimeService.isTauri()).toBe(false);\r\n    \r\n    // Test case 3: window exists and __TAURI__ is defined\r\n    global.window = { __TAURI__: {} } as any;\r\n    RuntimeServiceImpl.resetInstance();\r\n    expect(RuntimeService.isTauri()).toBe(true);\r\n    expect(RuntimeService.isWeb()).toBe(false);\r\n    \r\n    // Test case 4: window exists and __TAURI__ is null (should be tauri because 'in' operator checks for property existence)\r\n    global.window = { __TAURI__: null } as any;\r\n    RuntimeServiceImpl.resetInstance();\r\n    expect(RuntimeService.isTauri()).toBe(true); // Changed: 'in' operator returns true even if value is null\r\n    expect(RuntimeService.isWeb()).toBe(false);\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\runtime\\__tests__\\storage-service.property.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'vi' is defined but never used.","line":19,"column":55,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":57},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TauriStorageService' is defined but never used.","line":22,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'WebStorageService' is defined but never used.","line":23,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":53,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":53,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Property-Based Tests for Storage Service\r\n * \r\n * These tests validate correctness properties that should hold true\r\n * across all valid executions of the storage service.\r\n * \r\n * Testing Framework: fast-check (property-based testing)\r\n * Test Runner: Vitest\r\n * \r\n * To run these tests:\r\n * 1. Install dependencies: npm install --save-dev vitest fast-check @vitest/ui\r\n * 2. Run tests: npm test\r\n * \r\n * Feature: tauri-dashboard-medico\r\n * Property 3: Dual State Update on Successful Fetch\r\n * Validates: Requirements 2.4, 7.5\r\n */\r\n\r\nimport { describe, it, expect, beforeEach, afterEach, vi } from 'vitest';\r\nimport fc from 'fast-check';\r\nimport { RuntimeServiceImpl } from '../runtime-service';\r\nimport { TauriStorageService } from '../services/tauri-storage-service';\r\nimport { WebStorageService } from '../services/web-storage-service';\r\nimport type { StorageService } from '../types';\r\n\r\n/**\r\n * Property 3: Dual State Update on Successful Fetch\r\n * \r\n * For any successful data fetch operation, both the React state AND \r\n * the Offline_Store SHALL be updated with the fresh data.\r\n * \r\n * This property test verifies that:\r\n * 1. Data can be saved to storage\r\n * 2. Data can be retrieved from storage\r\n * 3. Retrieved data matches saved data (round-trip consistency)\r\n * 4. This holds for any valid data structure\r\n */\r\ndescribe('Property 3: Dual State Update on Successful Fetch', () => {\r\n  let storageService: StorageService;\r\n  let runtimeService: RuntimeServiceImpl;\r\n\r\n  beforeEach(() => {\r\n    // Reset runtime service for each test\r\n    runtimeService = RuntimeServiceImpl.getInstance();\r\n    runtimeService.resetServices();\r\n    storageService = runtimeService.getStorageService();\r\n  });\r\n\r\n  afterEach(async () => {\r\n    // Clean up storage after each test\r\n    try {\r\n      await storageService.clear();\r\n    } catch (error) {\r\n      // Ignore cleanup errors\r\n    }\r\n  });\r\n\r\n  /**\r\n   * Test that storage operations maintain data integrity\r\n   * across save and retrieve operations\r\n   */\r\n  it('should maintain data integrity for any valid data structure', async () => {\r\n    await fc.assert(\r\n      fc.asyncProperty(\r\n        // Generate arbitrary data structures\r\n        fc.record({\r\n          key: fc.string({ minLength: 1, maxLength: 50 }),\r\n          data: fc.oneof(\r\n            fc.string(),\r\n            fc.integer(),\r\n            fc.boolean(),\r\n            fc.array(fc.string()),\r\n            fc.record({\r\n              id: fc.uuid(),\r\n              name: fc.string(),\r\n              value: fc.integer(),\r\n              nested: fc.record({\r\n                field1: fc.string(),\r\n                field2: fc.boolean(),\r\n              }),\r\n            }),\r\n          ),\r\n        }),\r\n        async ({ key, data }) => {\r\n          // Save data to storage\r\n          await storageService.save(key, data);\r\n\r\n          // Retrieve data from storage\r\n          const retrieved = await storageService.get(key);\r\n\r\n          // Verify data integrity (round-trip consistency)\r\n          expect(retrieved).toEqual(data);\r\n        }\r\n      ),\r\n      { numRuns: 100 } // Run 100 iterations with random data\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that storage correctly handles patient data structures\r\n   */\r\n  it('should correctly store and retrieve patient data', async () => {\r\n    await fc.assert(\r\n      fc.asyncProperty(\r\n        fc.record({\r\n          id: fc.uuid(),\r\n          firstName: fc.string({ minLength: 1 }),\r\n          lastName: fc.string({ minLength: 1 }),\r\n          dateOfBirth: fc.date({ max: new Date() }).map(d => d.toISOString()),\r\n          gender: fc.constantFrom('male', 'female', 'other'),\r\n          phone: fc.string({ minLength: 10, maxLength: 15 }),\r\n          email: fc.option(fc.emailAddress(), { nil: undefined }),\r\n        }),\r\n        async (patientData) => {\r\n          const key = `patients:${patientData.id}`;\r\n\r\n          // Save patient data\r\n          await storageService.save(key, patientData);\r\n\r\n          // Retrieve patient data\r\n          const retrieved = await storageService.get(key);\r\n\r\n          // Verify all fields match\r\n          expect(retrieved).toEqual(patientData);\r\n        }\r\n      ),\r\n      { numRuns: 100 }\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that storage correctly handles appointment data structures\r\n   */\r\n  it('should correctly store and retrieve appointment data', async () => {\r\n    await fc.assert(\r\n      fc.asyncProperty(\r\n        fc.record({\r\n          id: fc.uuid(),\r\n          patientId: fc.uuid(),\r\n          doctorId: fc.uuid(),\r\n          date: fc.date({ min: new Date() }).map(d => d.toISOString()),\r\n          duration: fc.integer({ min: 15, max: 120 }),\r\n          type: fc.constantFrom('consultation', 'follow-up', 'emergency'),\r\n          status: fc.constantFrom('scheduled', 'completed', 'cancelled', 'no-show'),\r\n          reason: fc.option(fc.string(), { nil: undefined }),\r\n        }),\r\n        async (appointmentData) => {\r\n          const key = `appointments:${appointmentData.id}`;\r\n\r\n          // Save appointment data\r\n          await storageService.save(key, appointmentData);\r\n\r\n          // Retrieve appointment data\r\n          const retrieved = await storageService.get(key);\r\n\r\n          // Verify all fields match\r\n          expect(retrieved).toEqual(appointmentData);\r\n        }\r\n      ),\r\n      { numRuns: 100 }\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that storage correctly handles consultation data structures\r\n   */\r\n  it('should correctly store and retrieve consultation data', async () => {\r\n    await fc.assert(\r\n      fc.asyncProperty(\r\n        fc.record({\r\n          id: fc.uuid(),\r\n          patientId: fc.uuid(),\r\n          doctorId: fc.uuid(),\r\n          date: fc.date().map(d => d.toISOString()),\r\n          chiefComplaint: fc.string({ minLength: 1 }),\r\n          symptoms: fc.array(fc.string(), { minLength: 1 }),\r\n          diagnoses: fc.array(\r\n            fc.record({\r\n              id: fc.uuid(),\r\n              icd11Code: fc.string(),\r\n              description: fc.string(),\r\n              type: fc.constantFrom('primary', 'secondary'),\r\n            }),\r\n            { minLength: 1 }\r\n          ),\r\n          prescriptions: fc.array(\r\n            fc.record({\r\n              id: fc.uuid(),\r\n              medication: fc.string(),\r\n              dosage: fc.string(),\r\n              frequency: fc.string(),\r\n              duration: fc.string(),\r\n            })\r\n          ),\r\n        }),\r\n        async (consultationData) => {\r\n          const key = `consultations:${consultationData.id}`;\r\n\r\n          // Save consultation data\r\n          await storageService.save(key, consultationData);\r\n\r\n          // Retrieve consultation data\r\n          const retrieved = await storageService.get(key);\r\n\r\n          // Verify all fields match\r\n          expect(retrieved).toEqual(consultationData);\r\n        }\r\n      ),\r\n      { numRuns: 100 }\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that storage handles multiple save operations correctly\r\n   * (last write wins)\r\n   */\r\n  it('should handle multiple saves with last-write-wins semantics', async () => {\r\n    await fc.assert(\r\n      fc.asyncProperty(\r\n        fc.string({ minLength: 1, maxLength: 50 }),\r\n        fc.array(fc.string(), { minLength: 2, maxLength: 5 }),\r\n        async (key, values) => {\r\n          // Save multiple values to the same key\r\n          for (const value of values) {\r\n            await storageService.save(key, value);\r\n          }\r\n\r\n          // Retrieve the value\r\n          const retrieved = await storageService.get(key);\r\n\r\n          // Should get the last value written\r\n          expect(retrieved).toEqual(values[values.length - 1]);\r\n        }\r\n      ),\r\n      { numRuns: 100 }\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that delete operation removes data\r\n   */\r\n  it('should remove data after delete operation', async () => {\r\n    await fc.assert(\r\n      fc.asyncProperty(\r\n        fc.string({ minLength: 1, maxLength: 50 }),\r\n        fc.string(),\r\n        async (key, data) => {\r\n          // Save data\r\n          await storageService.save(key, data);\r\n\r\n          // Verify it exists\r\n          const beforeDelete = await storageService.get(key);\r\n          expect(beforeDelete).toEqual(data);\r\n\r\n          // Delete data\r\n          await storageService.delete(key);\r\n\r\n          // Verify it's gone\r\n          const afterDelete = await storageService.get(key);\r\n          expect(afterDelete).toBeNull();\r\n        }\r\n      ),\r\n      { numRuns: 100 }\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that keys() returns all stored keys\r\n   */\r\n  it('should return all stored keys', async () => {\r\n    await fc.assert(\r\n      fc.asyncProperty(\r\n        fc.array(\r\n          fc.record({\r\n            key: fc.string({ minLength: 1, maxLength: 50 }),\r\n            data: fc.string(),\r\n          }),\r\n          { minLength: 1, maxLength: 10 }\r\n        ),\r\n        async (items) => {\r\n          // Clear storage first\r\n          await storageService.clear();\r\n\r\n          // Save all items\r\n          for (const item of items) {\r\n            await storageService.save(item.key, item.data);\r\n          }\r\n\r\n          // Get all keys\r\n          const keys = await storageService.keys();\r\n\r\n          // Verify all keys are present\r\n          const expectedKeys = items.map(item => item.key);\r\n          expect(keys.sort()).toEqual(expectedKeys.sort());\r\n        }\r\n      ),\r\n      { numRuns: 50 } // Fewer runs for this test as it's more expensive\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that clear() removes all data\r\n   */\r\n  it('should remove all data after clear operation', async () => {\r\n    await fc.assert(\r\n      fc.asyncProperty(\r\n        fc.array(\r\n          fc.record({\r\n            key: fc.string({ minLength: 1, maxLength: 50 }),\r\n            data: fc.string(),\r\n          }),\r\n          { minLength: 1, maxLength: 10 }\r\n        ),\r\n        async (items) => {\r\n          // Save all items\r\n          for (const item of items) {\r\n            await storageService.save(item.key, item.data);\r\n          }\r\n\r\n          // Verify items exist\r\n          const keysBefore = await storageService.keys();\r\n          expect(keysBefore.length).toBeGreaterThan(0);\r\n\r\n          // Clear storage\r\n          await storageService.clear();\r\n\r\n          // Verify all items are gone\r\n          const keysAfter = await storageService.keys();\r\n          expect(keysAfter).toEqual([]);\r\n        }\r\n      ),\r\n      { numRuns: 50 }\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that storage handles null/undefined gracefully\r\n   */\r\n  it('should handle null and undefined values correctly', async () => {\r\n    const key = 'test-null-undefined';\r\n\r\n    // Test null\r\n    await storageService.save(key, null);\r\n    const retrievedNull = await storageService.get(key);\r\n    expect(retrievedNull).toBeNull();\r\n\r\n    // Test undefined (should be stored as null)\r\n    await storageService.save(key, undefined);\r\n    const retrievedUndefined = await storageService.get(key);\r\n    // undefined gets serialized as null in JSON\r\n    expect(retrievedUndefined).toBeNull();\r\n  });\r\n\r\n  /**\r\n   * Test that storage handles special characters in keys\r\n   */\r\n  it('should handle special characters in keys', async () => {\r\n    await fc.assert(\r\n      fc.asyncProperty(\r\n        fc.string({ minLength: 1, maxLength: 50 }),\r\n        fc.string(),\r\n        async (key, data) => {\r\n          // Save with special character key\r\n          const specialKey = `test:${key}:special`;\r\n          await storageService.save(specialKey, data);\r\n\r\n          // Retrieve\r\n          const retrieved = await storageService.get(specialKey);\r\n          expect(retrieved).toEqual(data);\r\n        }\r\n      ),\r\n      { numRuns: 100 }\r\n    );\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\runtime\\__tests__\\storage-service.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'vi' is defined but never used.","line":14,"column":55,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":57},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TauriStorageService' is defined but never used.","line":16,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'WebStorageService' is defined but never used.","line":17,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":33,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2274,2277],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2274,2277],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":74,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2522,2525],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2522,2525],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":132,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4428,4431],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4428,4431],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":376,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":376,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12096,12099],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12096,12099],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Unit Tests for Storage Service Edge Cases\r\n * \r\n * These tests verify specific examples, edge cases, and error conditions\r\n * for the storage service implementations.\r\n * \r\n * Testing Framework: Vitest\r\n * \r\n * Feature: tauri-dashboard-medico\r\n * Task: 2.3 - Write unit tests for storage edge cases\r\n * Validates: Requirements 2.4\r\n */\r\n\r\nimport { describe, it, expect, beforeEach, afterEach, vi } from 'vitest';\r\nimport { RuntimeServiceImpl } from '../runtime-service';\r\nimport { TauriStorageService } from '../services/tauri-storage-service';\r\nimport { WebStorageService } from '../services/web-storage-service';\r\nimport type { StorageService } from '../types';\r\n\r\ndescribe('Storage Service Edge Cases', () => {\r\n  let storageService: StorageService;\r\n  let runtimeService: RuntimeServiceImpl;\r\n\r\n  beforeEach(() => {\r\n    runtimeService = RuntimeServiceImpl.getInstance();\r\n    runtimeService.resetServices();\r\n    storageService = runtimeService.getStorageService();\r\n  });\r\n\r\n  afterEach(async () => {\r\n    try {\r\n      await storageService.clear();\r\n    } catch (error) {\r\n      // Ignore cleanup errors\r\n    }\r\n  });\r\n\r\n  describe('Empty Data Handling', () => {\r\n    it('should return null for non-existent key', async () => {\r\n      const result = await storageService.get('non-existent-key');\r\n      expect(result).toBeNull();\r\n    });\r\n\r\n    it('should handle empty string as key', async () => {\r\n      // Empty string keys should be handled gracefully\r\n      // Some implementations may reject them, others may accept\r\n      try {\r\n        await storageService.save('', 'test-data');\r\n        const result = await storageService.get('');\r\n        expect(result).toBe('test-data');\r\n      } catch (error) {\r\n        // If implementation rejects empty keys, that's also valid\r\n        expect(error).toBeDefined();\r\n      }\r\n    });\r\n\r\n    it('should handle empty string as data', async () => {\r\n      const key = 'empty-data-key';\r\n      await storageService.save(key, '');\r\n      const result = await storageService.get(key);\r\n      expect(result).toBe('');\r\n    });\r\n\r\n    it('should handle empty array as data', async () => {\r\n      const key = 'empty-array-key';\r\n      await storageService.save(key, []);\r\n      const result = await storageService.get<any[]>(key);\r\n      expect(result).toEqual([]);\r\n    });\r\n\r\n    it('should handle empty object as data', async () => {\r\n      const key = 'empty-object-key';\r\n      await storageService.save(key, {});\r\n      const result = await storageService.get<any>(key);\r\n      expect(result).toEqual({});\r\n    });\r\n\r\n    it('should handle zero as data', async () => {\r\n      const key = 'zero-key';\r\n      await storageService.save(key, 0);\r\n      const result = await storageService.get<number>(key);\r\n      expect(result).toBe(0);\r\n    });\r\n\r\n    it('should handle false as data', async () => {\r\n      const key = 'false-key';\r\n      await storageService.save(key, false);\r\n      const result = await storageService.get<boolean>(key);\r\n      expect(result).toBe(false);\r\n    });\r\n\r\n    it('should handle null as data', async () => {\r\n      const key = 'null-key';\r\n      await storageService.save(key, null);\r\n      const result = await storageService.get(key);\r\n      expect(result).toBeNull();\r\n    });\r\n  });\r\n\r\n  describe('Large Data Handling', () => {\r\n    it('should handle large strings', async () => {\r\n      const key = 'large-string-key';\r\n      // Create a 1MB string\r\n      const largeString = 'x'.repeat(1024 * 1024);\r\n      \r\n      await storageService.save(key, largeString);\r\n      const result = await storageService.get<string>(key);\r\n      \r\n      expect(result).toBe(largeString);\r\n      expect(result?.length).toBe(1024 * 1024);\r\n    });\r\n\r\n    it('should handle large arrays', async () => {\r\n      const key = 'large-array-key';\r\n      // Create an array with 10,000 items\r\n      const largeArray = Array.from({ length: 10000 }, (_, i) => ({\r\n        id: i,\r\n        name: `Item ${i}`,\r\n        value: Math.random(),\r\n      }));\r\n      \r\n      await storageService.save(key, largeArray);\r\n      const result = await storageService.get<typeof largeArray>(key);\r\n      \r\n      expect(result).toEqual(largeArray);\r\n      expect(result?.length).toBe(10000);\r\n    });\r\n\r\n    it('should handle deeply nested objects', async () => {\r\n      const key = 'nested-object-key';\r\n      // Create a deeply nested object (10 levels)\r\n      let deepObject: any = { value: 'deep' };\r\n      for (let i = 0; i < 10; i++) {\r\n        deepObject = { nested: deepObject };\r\n      }\r\n      \r\n      await storageService.save(key, deepObject);\r\n      const result = await storageService.get(key);\r\n      \r\n      expect(result).toEqual(deepObject);\r\n    });\r\n  });\r\n\r\n  describe('Special Characters and Unicode', () => {\r\n    it('should handle special characters in keys', async () => {\r\n      const specialKeys = [\r\n        'key:with:colons',\r\n        'key/with/slashes',\r\n        'key-with-dashes',\r\n        'key_with_underscores',\r\n        'key.with.dots',\r\n        'key with spaces',\r\n      ];\r\n\r\n      for (const key of specialKeys) {\r\n        await storageService.save(key, `data-for-${key}`);\r\n        const result = await storageService.get(key);\r\n        expect(result).toBe(`data-for-${key}`);\r\n      }\r\n    });\r\n\r\n    it('should handle unicode characters in data', async () => {\r\n      const key = 'unicode-key';\r\n      const unicodeData = {\r\n        emoji: '😀🎉🚀',\r\n        chinese: '你好世界',\r\n        arabic: 'مرحبا بالعالم',\r\n        spanish: 'Médico',\r\n        symbols: '©®™€£¥',\r\n      };\r\n      \r\n      await storageService.save(key, unicodeData);\r\n      const result = await storageService.get(key);\r\n      \r\n      expect(result).toEqual(unicodeData);\r\n    });\r\n\r\n    it('should handle unicode characters in keys', async () => {\r\n      const unicodeKeys = [\r\n        'key-😀',\r\n        'key-你好',\r\n        'key-مرحبا',\r\n      ];\r\n\r\n      for (const key of unicodeKeys) {\r\n        await storageService.save(key, `data-for-${key}`);\r\n        const result = await storageService.get(key);\r\n        expect(result).toBe(`data-for-${key}`);\r\n      }\r\n    });\r\n  });\r\n\r\n  describe('Concurrent Operations', () => {\r\n    it('should handle concurrent saves to different keys', async () => {\r\n      const promises = Array.from({ length: 10 }, (_, i) =>\r\n        storageService.save(`concurrent-key-${i}`, `data-${i}`)\r\n      );\r\n\r\n      await Promise.all(promises);\r\n\r\n      // Verify all data was saved\r\n      for (let i = 0; i < 10; i++) {\r\n        const result = await storageService.get(`concurrent-key-${i}`);\r\n        expect(result).toBe(`data-${i}`);\r\n      }\r\n    });\r\n\r\n    it('should handle concurrent saves to the same key (last write wins)', async () => {\r\n      const key = 'concurrent-same-key';\r\n      const promises = Array.from({ length: 10 }, (_, i) =>\r\n        storageService.save(key, `data-${i}`)\r\n      );\r\n\r\n      await Promise.all(promises);\r\n\r\n      // Should have one of the values (last write wins)\r\n      const result = await storageService.get(key);\r\n      expect(result).toMatch(/^data-\\d$/);\r\n    });\r\n\r\n    it('should handle concurrent reads', async () => {\r\n      const key = 'concurrent-read-key';\r\n      await storageService.save(key, 'test-data');\r\n\r\n      const promises = Array.from({ length: 10 }, () =>\r\n        storageService.get(key)\r\n      );\r\n\r\n      const results = await Promise.all(promises);\r\n\r\n      // All reads should return the same data\r\n      results.forEach(result => {\r\n        expect(result).toBe('test-data');\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Data Type Preservation', () => {\r\n    it('should preserve number types', async () => {\r\n      const key = 'number-key';\r\n      const numbers = [0, 1, -1, 3.14, -3.14, 1e10, 1e-10];\r\n\r\n      for (const num of numbers) {\r\n        await storageService.save(key, num);\r\n        const result = await storageService.get<number>(key);\r\n        expect(result).toBe(num);\r\n        expect(typeof result).toBe('number');\r\n      }\r\n    });\r\n\r\n    it('should preserve boolean types', async () => {\r\n      const key = 'boolean-key';\r\n      \r\n      await storageService.save(key, true);\r\n      let result = await storageService.get<boolean>(key);\r\n      expect(result).toBe(true);\r\n      expect(typeof result).toBe('boolean');\r\n\r\n      await storageService.save(key, false);\r\n      result = await storageService.get<boolean>(key);\r\n      expect(result).toBe(false);\r\n      expect(typeof result).toBe('boolean');\r\n    });\r\n\r\n    it('should preserve date strings', async () => {\r\n      const key = 'date-key';\r\n      const dateString = new Date().toISOString();\r\n      \r\n      await storageService.save(key, dateString);\r\n      const result = await storageService.get<string>(key);\r\n      \r\n      expect(result).toBe(dateString);\r\n      expect(new Date(result!).toISOString()).toBe(dateString);\r\n    });\r\n\r\n    it('should preserve complex nested structures', async () => {\r\n      const key = 'complex-key';\r\n      const complexData = {\r\n        string: 'text',\r\n        number: 42,\r\n        boolean: true,\r\n        null: null,\r\n        array: [1, 'two', { three: 3 }],\r\n        nested: {\r\n          deep: {\r\n            deeper: {\r\n              value: 'found',\r\n            },\r\n          },\r\n        },\r\n      };\r\n      \r\n      await storageService.save(key, complexData);\r\n      const result = await storageService.get(key);\r\n      \r\n      expect(result).toEqual(complexData);\r\n    });\r\n  });\r\n\r\n  describe('Error Handling', () => {\r\n    it('should handle delete of non-existent key gracefully', async () => {\r\n      // Should not throw error\r\n      await expect(\r\n        storageService.delete('non-existent-key')\r\n      ).resolves.not.toThrow();\r\n    });\r\n\r\n    it('should handle clear on empty storage gracefully', async () => {\r\n      await storageService.clear();\r\n      \r\n      // Should not throw error\r\n      await expect(\r\n        storageService.clear()\r\n      ).resolves.not.toThrow();\r\n    });\r\n\r\n    it('should handle keys() on empty storage', async () => {\r\n      await storageService.clear();\r\n      \r\n      const keys = await storageService.keys();\r\n      expect(keys).toEqual([]);\r\n    });\r\n\r\n    it('should handle get after delete', async () => {\r\n      const key = 'delete-test-key';\r\n      \r\n      await storageService.save(key, 'test-data');\r\n      await storageService.delete(key);\r\n      \r\n      const result = await storageService.get(key);\r\n      expect(result).toBeNull();\r\n    });\r\n\r\n    it('should handle get after clear', async () => {\r\n      const key = 'clear-test-key';\r\n      \r\n      await storageService.save(key, 'test-data');\r\n      await storageService.clear();\r\n      \r\n      const result = await storageService.get(key);\r\n      expect(result).toBeNull();\r\n    });\r\n  });\r\n\r\n  describe('Storage Quota (Simulated)', () => {\r\n    it('should handle storage quota exceeded gracefully', async () => {\r\n      // This test simulates quota exceeded by trying to save very large data\r\n      // In a real scenario, this would depend on the storage implementation\r\n      \r\n      const key = 'quota-test-key';\r\n      // Try to save a very large string (10MB)\r\n      const veryLargeString = 'x'.repeat(10 * 1024 * 1024);\r\n      \r\n      try {\r\n        await storageService.save(key, veryLargeString);\r\n        // If it succeeds, verify we can retrieve it\r\n        const result = await storageService.get<string>(key);\r\n        expect(result?.length).toBe(10 * 1024 * 1024);\r\n      } catch (error) {\r\n        // If it fails due to quota, that's expected behavior\r\n        // The error should be defined and meaningful\r\n        expect(error).toBeDefined();\r\n      }\r\n    });\r\n  });\r\n\r\n  describe('Corrupted Data Recovery', () => {\r\n    it('should handle corrupted JSON gracefully', async () => {\r\n      // This test is more relevant for implementations that store JSON\r\n      // For now, we test that invalid data doesn't break the system\r\n      \r\n      const key = 'corrupted-key';\r\n      \r\n      // Try to save and retrieve data that might cause issues\r\n      const problematicData = {\r\n        circular: null as any,\r\n        undefined: undefined,\r\n        function: null, // Functions can't be serialized\r\n      };\r\n      \r\n      // Create circular reference\r\n      problematicData.circular = problematicData;\r\n      \r\n      try {\r\n        await storageService.save(key, problematicData);\r\n        const result = await storageService.get(key);\r\n        // If it succeeds, the implementation handled it\r\n        expect(result).toBeDefined();\r\n      } catch (error) {\r\n        // If it fails, that's expected for circular references\r\n        expect(error).toBeDefined();\r\n      }\r\n    });\r\n\r\n    it('should handle retrieval when storage is corrupted', async () => {\r\n      // This test verifies that get() returns null for corrupted data\r\n      // rather than throwing an error\r\n      \r\n      const key = 'potentially-corrupted-key';\r\n      \r\n      // First save valid data\r\n      await storageService.save(key, 'valid-data');\r\n      \r\n      // In a real scenario, data might get corrupted externally\r\n      // For now, we just verify that get() handles errors gracefully\r\n      const result = await storageService.get(key);\r\n      expect(result).toBe('valid-data');\r\n    });\r\n  });\r\n\r\n  describe('Key Management', () => {\r\n    it('should return correct keys after multiple operations', async () => {\r\n      await storageService.clear();\r\n      \r\n      // Save multiple items\r\n      await storageService.save('key1', 'data1');\r\n      await storageService.save('key2', 'data2');\r\n      await storageService.save('key3', 'data3');\r\n      \r\n      let keys = await storageService.keys();\r\n      expect(keys.sort()).toEqual(['key1', 'key2', 'key3']);\r\n      \r\n      // Delete one\r\n      await storageService.delete('key2');\r\n      \r\n      keys = await storageService.keys();\r\n      expect(keys.sort()).toEqual(['key1', 'key3']);\r\n      \r\n      // Add another\r\n      await storageService.save('key4', 'data4');\r\n      \r\n      keys = await storageService.keys();\r\n      expect(keys.sort()).toEqual(['key1', 'key3', 'key4']);\r\n    });\r\n\r\n    it('should handle keys with similar prefixes', async () => {\r\n      await storageService.clear();\r\n      \r\n      const keys = [\r\n        'patient',\r\n        'patient:1',\r\n        'patient:10',\r\n        'patient:100',\r\n        'patients',\r\n        'patients:all',\r\n      ];\r\n      \r\n      for (const key of keys) {\r\n        await storageService.save(key, `data-${key}`);\r\n      }\r\n      \r\n      const retrievedKeys = await storageService.keys();\r\n      expect(retrievedKeys.sort()).toEqual(keys.sort());\r\n    });\r\n  });\r\n\r\n  describe('Performance Edge Cases', () => {\r\n    it('should handle rapid sequential operations', async () => {\r\n      const key = 'rapid-key';\r\n      \r\n      // Rapidly save and retrieve\r\n      for (let i = 0; i < 100; i++) {\r\n        await storageService.save(key, `data-${i}`);\r\n        const result = await storageService.get(key);\r\n        expect(result).toBe(`data-${i}`);\r\n      }\r\n    });\r\n\r\n    it('should handle many keys efficiently', async () => {\r\n      await storageService.clear();\r\n      \r\n      // Save 1000 keys\r\n      const promises = Array.from({ length: 1000 }, (_, i) =>\r\n        storageService.save(`key-${i}`, `data-${i}`)\r\n      );\r\n      \r\n      await Promise.all(promises);\r\n      \r\n      // Verify keys count\r\n      const keys = await storageService.keys();\r\n      expect(keys.length).toBe(1000);\r\n      \r\n      // Verify we can still retrieve data\r\n      const result = await storageService.get('key-500');\r\n      expect(result).toBe('data-500');\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\runtime\\__tests__\\sync-service.property.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SYNC_METADATA' is defined but never used.","line":19,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":35},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":61,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":61,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":561,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":561,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Property-Based Tests for Sync Service\r\n * \r\n * These tests validate correctness properties that should hold true\r\n * across all valid executions of the sync service.\r\n * \r\n * Testing Framework: fast-check (property-based testing)\r\n * Test Runner: Vitest\r\n * \r\n * Feature: tauri-dashboard-medico\r\n * Validates: Requirements 2.2, 2.3, 2.5, 3.1, 3.2, 3.3, 3.6\r\n */\r\n\r\nimport { describe, it, expect, beforeEach, afterEach, vi } from 'vitest';\r\nimport fc from 'fast-check';\r\nimport { SyncService } from '../sync-service';\r\nimport { RuntimeServiceImpl } from '../runtime-service';\r\nimport type { StorageService, NetworkService, PendingChange } from '../types';\r\nimport { SYNC_QUEUE, SYNC_METADATA } from '../storage-keys';\r\n\r\n/**\r\n * Property 1: Offline Operations Queue Changes\r\n * \r\n * For any CRUD operation (create, update, delete) performed while offline\r\n * on any entity (patient, appointment, consultation, message, settings),\r\n * the Change_Queue SHALL store the operation with all necessary data for\r\n * later synchronization.\r\n * \r\n * **Validates: Requirements 2.2, 12.3, 13.3, 15.3, 16.3**\r\n */\r\ndescribe('Property 1: Offline Operations Queue Changes', () => {\r\n  let syncService: SyncService;\r\n  let storageService: StorageService;\r\n  let networkService: NetworkService;\r\n  let runtimeService: RuntimeServiceImpl;\r\n\r\n  beforeEach(() => {\r\n    // Reset runtime service\r\n    runtimeService = RuntimeServiceImpl.getInstance();\r\n    runtimeService.resetServices();\r\n    \r\n    // Get services\r\n    storageService = runtimeService.getStorageService();\r\n    networkService = runtimeService.getNetworkService();\r\n    \r\n    // Create sync service\r\n    syncService = new SyncService(storageService, networkService);\r\n  });\r\n\r\n  afterEach(async () => {\r\n    // Stop sync service if it exists\r\n    if (syncService) {\r\n      syncService.stop();\r\n    }\r\n    \r\n    // Clean up storage\r\n    try {\r\n      if (storageService) {\r\n        await storageService.clear();\r\n      }\r\n    } catch (error) {\r\n      // Ignore cleanup errors\r\n    }\r\n  });\r\n\r\n  /**\r\n   * Test that any CRUD operation is queued correctly\r\n   */\r\n  it('should queue all CRUD operations with complete data', async () => {\r\n    await fc.assert(\r\n      fc.asyncProperty(\r\n        // Generate arbitrary CRUD operations\r\n        fc.record({\r\n          id: fc.uuid(),\r\n          type: fc.constantFrom('create', 'update', 'delete'),\r\n          entity: fc.constantFrom(\r\n            'patient',\r\n            'appointment',\r\n            'consultation',\r\n            'message',\r\n            'settings'\r\n          ),\r\n          data: fc.record({\r\n            id: fc.uuid(),\r\n            name: fc.string(),\r\n            value: fc.oneof(fc.string(), fc.integer(), fc.boolean()),\r\n            timestamp: fc.integer({ min: Date.now() - 1000000, max: Date.now() }),\r\n          }),\r\n          timestamp: fc.integer({ min: Date.now() - 1000000, max: Date.now() }),\r\n          retries: fc.constant(0),\r\n        }),\r\n        async (operation: PendingChange) => {\r\n          // Queue the operation\r\n          await syncService.queueChange(operation);\r\n\r\n          // Verify operation is in queue\r\n          const queue = await syncService.getPendingChanges();\r\n          \r\n          // Should contain the operation\r\n          expect(queue).toContainEqual(operation);\r\n          \r\n          // Should have all required fields\r\n          const queuedOp = queue.find(op => op.id === operation.id);\r\n          expect(queuedOp).toBeDefined();\r\n          expect(queuedOp?.type).toBe(operation.type);\r\n          expect(queuedOp?.entity).toBe(operation.entity);\r\n          expect(queuedOp?.data).toEqual(operation.data);\r\n          expect(queuedOp?.timestamp).toBe(operation.timestamp);\r\n          expect(queuedOp?.retries).toBe(0);\r\n        }\r\n      ),\r\n      { numRuns: 100 }\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that patient operations are queued correctly\r\n   */\r\n  it('should queue patient CRUD operations', async () => {\r\n    await fc.assert(\r\n      fc.asyncProperty(\r\n        fc.record({\r\n          id: fc.uuid(),\r\n          type: fc.constantFrom('create', 'update', 'delete'),\r\n          entity: fc.constant('patient' as const),\r\n          data: fc.record({\r\n            id: fc.uuid(),\r\n            firstName: fc.string({ minLength: 1 }),\r\n            lastName: fc.string({ minLength: 1 }),\r\n            dateOfBirth: fc.date({ max: new Date() }).map(d => d.toISOString()),\r\n            gender: fc.constantFrom('male', 'female', 'other'),\r\n            phone: fc.string({ minLength: 10, maxLength: 15 }),\r\n          }),\r\n          timestamp: fc.integer({ min: Date.now() - 1000000, max: Date.now() }),\r\n          retries: fc.constant(0),\r\n        }),\r\n        async (operation: PendingChange) => {\r\n          await syncService.queueChange(operation);\r\n\r\n          const queue = await syncService.getPendingChanges();\r\n          const queuedOp = queue.find(op => op.id === operation.id);\r\n\r\n          expect(queuedOp).toBeDefined();\r\n          expect(queuedOp?.entity).toBe('patient');\r\n          expect(queuedOp?.data.firstName).toBe(operation.data.firstName);\r\n          expect(queuedOp?.data.lastName).toBe(operation.data.lastName);\r\n        }\r\n      ),\r\n      { numRuns: 100 }\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that appointment operations are queued correctly\r\n   */\r\n  it('should queue appointment CRUD operations', async () => {\r\n    await fc.assert(\r\n      fc.asyncProperty(\r\n        fc.record({\r\n          id: fc.uuid(),\r\n          type: fc.constantFrom('create', 'update', 'delete'),\r\n          entity: fc.constant('appointment' as const),\r\n          data: fc.record({\r\n            id: fc.uuid(),\r\n            patientId: fc.uuid(),\r\n            doctorId: fc.uuid(),\r\n            date: fc.date({ min: new Date() }).map(d => d.toISOString()),\r\n            duration: fc.integer({ min: 15, max: 120 }),\r\n            type: fc.constantFrom('consultation', 'follow-up', 'emergency'),\r\n            status: fc.constantFrom('scheduled', 'completed', 'cancelled', 'no-show'),\r\n          }),\r\n          timestamp: fc.integer({ min: Date.now() - 1000000, max: Date.now() }),\r\n          retries: fc.constant(0),\r\n        }),\r\n        async (operation: PendingChange) => {\r\n          await syncService.queueChange(operation);\r\n\r\n          const queue = await syncService.getPendingChanges();\r\n          const queuedOp = queue.find(op => op.id === operation.id);\r\n\r\n          expect(queuedOp).toBeDefined();\r\n          expect(queuedOp?.entity).toBe('appointment');\r\n          expect(queuedOp?.data.patientId).toBe(operation.data.patientId);\r\n          expect(queuedOp?.data.type).toBe(operation.data.type);\r\n        }\r\n      ),\r\n      { numRuns: 100 }\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that consultation operations are queued correctly\r\n   */\r\n  it('should queue consultation CRUD operations', async () => {\r\n    await fc.assert(\r\n      fc.asyncProperty(\r\n        fc.record({\r\n          id: fc.uuid(),\r\n          type: fc.constantFrom('create', 'update', 'delete'),\r\n          entity: fc.constant('consultation' as const),\r\n          data: fc.record({\r\n            id: fc.uuid(),\r\n            patientId: fc.uuid(),\r\n            doctorId: fc.uuid(),\r\n            date: fc.date().map(d => d.toISOString()),\r\n            chiefComplaint: fc.string({ minLength: 1 }),\r\n            symptoms: fc.array(fc.string(), { minLength: 1 }),\r\n            diagnoses: fc.array(\r\n              fc.record({\r\n                id: fc.uuid(),\r\n                icd11Code: fc.string(),\r\n                description: fc.string(),\r\n                type: fc.constantFrom('primary', 'secondary'),\r\n              }),\r\n              { minLength: 1 }\r\n            ),\r\n          }),\r\n          timestamp: fc.integer({ min: Date.now() - 1000000, max: Date.now() }),\r\n          retries: fc.constant(0),\r\n        }),\r\n        async (operation: PendingChange) => {\r\n          await syncService.queueChange(operation);\r\n\r\n          const queue = await syncService.getPendingChanges();\r\n          const queuedOp = queue.find(op => op.id === operation.id);\r\n\r\n          expect(queuedOp).toBeDefined();\r\n          expect(queuedOp?.entity).toBe('consultation');\r\n          expect(queuedOp?.data.chiefComplaint).toBe(operation.data.chiefComplaint);\r\n          expect(queuedOp?.data.diagnoses).toEqual(operation.data.diagnoses);\r\n        }\r\n      ),\r\n      { numRuns: 100 }\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that message operations are queued correctly\r\n   */\r\n  it('should queue message CRUD operations', async () => {\r\n    await fc.assert(\r\n      fc.asyncProperty(\r\n        fc.record({\r\n          id: fc.uuid(),\r\n          type: fc.constantFrom('create', 'update', 'delete'),\r\n          entity: fc.constant('message' as const),\r\n          data: fc.record({\r\n            id: fc.uuid(),\r\n            conversationId: fc.uuid(),\r\n            senderId: fc.uuid(),\r\n            recipientId: fc.uuid(),\r\n            content: fc.string({ minLength: 1 }),\r\n            sentAt: fc.date().map(d => d.toISOString()),\r\n          }),\r\n          timestamp: fc.integer({ min: Date.now() - 1000000, max: Date.now() }),\r\n          retries: fc.constant(0),\r\n        }),\r\n        async (operation: PendingChange) => {\r\n          await syncService.queueChange(operation);\r\n\r\n          const queue = await syncService.getPendingChanges();\r\n          const queuedOp = queue.find(op => op.id === operation.id);\r\n\r\n          expect(queuedOp).toBeDefined();\r\n          expect(queuedOp?.entity).toBe('message');\r\n          expect(queuedOp?.data.content).toBe(operation.data.content);\r\n        }\r\n      ),\r\n      { numRuns: 100 }\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that settings operations are queued correctly\r\n   */\r\n  it('should queue settings CRUD operations', async () => {\r\n    await fc.assert(\r\n      fc.asyncProperty(\r\n        fc.record({\r\n          id: fc.uuid(),\r\n          type: fc.constantFrom('create', 'update', 'delete'),\r\n          entity: fc.constant('settings' as const),\r\n          data: fc.record({\r\n            id: fc.uuid(),\r\n            userId: fc.uuid(),\r\n            credentials: fc.string(),\r\n            specialties: fc.array(fc.string(), { minLength: 1 }),\r\n            licenseNumber: fc.string(),\r\n          }),\r\n          timestamp: fc.integer({ min: Date.now() - 1000000, max: Date.now() }),\r\n          retries: fc.constant(0),\r\n        }),\r\n        async (operation: PendingChange) => {\r\n          await syncService.queueChange(operation);\r\n\r\n          const queue = await syncService.getPendingChanges();\r\n          const queuedOp = queue.find(op => op.id === operation.id);\r\n\r\n          expect(queuedOp).toBeDefined();\r\n          expect(queuedOp?.entity).toBe('settings');\r\n          expect(queuedOp?.data.credentials).toBe(operation.data.credentials);\r\n        }\r\n      ),\r\n      { numRuns: 100 }\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that multiple operations are queued in order (FIFO)\r\n   */\r\n  it('should maintain FIFO order for multiple operations', async () => {\r\n    await fc.assert(\r\n      fc.asyncProperty(\r\n        fc.array(\r\n          fc.record({\r\n            id: fc.uuid(),\r\n            type: fc.constantFrom('create', 'update', 'delete'),\r\n            entity: fc.constantFrom(\r\n              'patient',\r\n              'appointment',\r\n              'consultation',\r\n              'message',\r\n              'settings'\r\n            ),\r\n            data: fc.record({\r\n              id: fc.uuid(),\r\n              value: fc.string(),\r\n            }),\r\n            timestamp: fc.integer({ min: Date.now() - 1000000, max: Date.now() }),\r\n            retries: fc.constant(0),\r\n          }),\r\n          { minLength: 2, maxLength: 10 }\r\n        ),\r\n        async (operations: PendingChange[]) => {\r\n          // Clear queue first\r\n          await storageService.save(SYNC_QUEUE, []);\r\n\r\n          // Queue all operations\r\n          for (const operation of operations) {\r\n            await syncService.queueChange(operation);\r\n          }\r\n\r\n          // Get queue\r\n          const queue = await syncService.getPendingChanges();\r\n\r\n          // Should have all operations\r\n          expect(queue.length).toBe(operations.length);\r\n\r\n          // Should maintain order (FIFO)\r\n          for (let i = 0; i < operations.length; i++) {\r\n            expect(queue[i].id).toBe(operations[i].id);\r\n          }\r\n        }\r\n      ),\r\n      { numRuns: 50 }\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that queue updates metadata correctly\r\n   */\r\n  it('should update sync metadata when queueing changes', async () => {\r\n    await fc.assert(\r\n      fc.asyncProperty(\r\n        fc.array(\r\n          fc.record({\r\n            id: fc.uuid(),\r\n            type: fc.constantFrom('create', 'update', 'delete'),\r\n            entity: fc.constantFrom(\r\n              'patient',\r\n              'appointment',\r\n              'consultation',\r\n              'message',\r\n              'settings'\r\n            ),\r\n            data: fc.record({\r\n              id: fc.uuid(),\r\n              value: fc.string(),\r\n            }),\r\n            timestamp: fc.integer({ min: Date.now() - 1000000, max: Date.now() }),\r\n            retries: fc.constant(0),\r\n          }),\r\n          { minLength: 1, maxLength: 10 }\r\n        ),\r\n        async (operations: PendingChange[]) => {\r\n          // Clear queue first\r\n          await storageService.save(SYNC_QUEUE, []);\r\n\r\n          // Queue all operations\r\n          for (const operation of operations) {\r\n            await syncService.queueChange(operation);\r\n          }\r\n\r\n          // Get metadata\r\n          const metadata = await syncService.getSyncMetadata();\r\n\r\n          // Should reflect correct pending count\r\n          expect(metadata.pendingChanges).toBe(operations.length);\r\n        }\r\n      ),\r\n      { numRuns: 50 }\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that queue handles duplicate IDs correctly\r\n   */\r\n  it('should handle operations with duplicate IDs', async () => {\r\n    await fc.assert(\r\n      fc.asyncProperty(\r\n        fc.record({\r\n          id: fc.uuid(),\r\n          type: fc.constantFrom('create', 'update', 'delete'),\r\n          entity: fc.constantFrom(\r\n            'patient',\r\n            'appointment',\r\n            'consultation',\r\n            'message',\r\n            'settings'\r\n          ),\r\n          data: fc.record({\r\n            id: fc.uuid(),\r\n            value: fc.string(),\r\n          }),\r\n          timestamp: fc.integer({ min: Date.now() - 1000000, max: Date.now() }),\r\n          retries: fc.constant(0),\r\n        }),\r\n        fc.integer({ min: 2, max: 5 }),\r\n        async (operation: PendingChange, count: number) => {\r\n          // Clear queue first\r\n          await storageService.save(SYNC_QUEUE, []);\r\n\r\n          // Queue same operation multiple times\r\n          for (let i = 0; i < count; i++) {\r\n            await syncService.queueChange(operation);\r\n          }\r\n\r\n          // Get queue\r\n          const queue = await syncService.getPendingChanges();\r\n\r\n          // Should have all instances (duplicates allowed for idempotency)\r\n          expect(queue.length).toBe(count);\r\n          \r\n          // All should have same ID\r\n          queue.forEach(op => {\r\n            expect(op.id).toBe(operation.id);\r\n          });\r\n        }\r\n      ),\r\n      { numRuns: 50 }\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that empty queue returns empty array\r\n   */\r\n  it('should return empty array for empty queue', async () => {\r\n    // Clear queue\r\n    await storageService.save(SYNC_QUEUE, []);\r\n\r\n    const queue = await syncService.getPendingChanges();\r\n    expect(queue).toEqual([]);\r\n  });\r\n\r\n  /**\r\n   * Test that queue persists across service instances\r\n   */\r\n  it('should persist queue across service instances', async () => {\r\n    await fc.assert(\r\n      fc.asyncProperty(\r\n        fc.array(\r\n          fc.record({\r\n            id: fc.uuid(),\r\n            type: fc.constantFrom('create', 'update', 'delete'),\r\n            entity: fc.constantFrom(\r\n              'patient',\r\n              'appointment',\r\n              'consultation',\r\n              'message',\r\n              'settings'\r\n            ),\r\n            data: fc.record({\r\n              id: fc.uuid(),\r\n              value: fc.string(),\r\n            }),\r\n            timestamp: fc.integer({ min: Date.now() - 1000000, max: Date.now() }),\r\n            retries: fc.constant(0),\r\n          }),\r\n          { minLength: 1, maxLength: 5 }\r\n        ),\r\n        async (operations: PendingChange[]) => {\r\n          // Clear queue first\r\n          await storageService.save(SYNC_QUEUE, []);\r\n\r\n          // Queue operations with first service instance\r\n          const service1 = new SyncService(storageService, networkService);\r\n          for (const operation of operations) {\r\n            await service1.queueChange(operation);\r\n          }\r\n\r\n          // Create new service instance\r\n          const service2 = new SyncService(storageService, networkService);\r\n          const queue = await service2.getPendingChanges();\r\n\r\n          // Should have all operations\r\n          expect(queue.length).toBe(operations.length);\r\n          \r\n          // Should match original operations\r\n          for (let i = 0; i < operations.length; i++) {\r\n            expect(queue[i].id).toBe(operations[i].id);\r\n          }\r\n        }\r\n      ),\r\n      { numRuns: 50 }\r\n    );\r\n  });\r\n});\r\n\r\n\r\n/**\r\n * Property 7: Sync Store Update\r\n * \r\n * For any successful synchronization operation, the Offline_Store SHALL be\r\n * updated with all fresh data received from the server.\r\n * \r\n * **Validates: Requirements 3.3**\r\n */\r\ndescribe('Property 7: Sync Store Update', () => {\r\n  let syncService: SyncService;\r\n  let storageService: StorageService;\r\n  let networkService: NetworkService;\r\n  let runtimeService: RuntimeServiceImpl;\r\n\r\n  beforeEach(() => {\r\n    // Reset runtime service\r\n    runtimeService = RuntimeServiceImpl.getInstance();\r\n    runtimeService.resetServices();\r\n    \r\n    // Get services\r\n    storageService = runtimeService.getStorageService();\r\n    networkService = runtimeService.getNetworkService();\r\n    \r\n    // Mock network service to simulate server responses\r\n    vi.spyOn(networkService, 'checkConnectivity').mockResolvedValue(true);\r\n    \r\n    // Create sync service\r\n    syncService = new SyncService(storageService, networkService);\r\n  });\r\n\r\n  afterEach(async () => {\r\n    // Stop sync service if it exists\r\n    if (syncService) {\r\n      syncService.stop();\r\n    }\r\n    \r\n    // Clean up storage\r\n    try {\r\n      if (storageService) {\r\n        await storageService.clear();\r\n      }\r\n    } catch (error) {\r\n      // Ignore cleanup errors\r\n    }\r\n    \r\n    // Restore mocks\r\n    vi.restoreAllMocks();\r\n  });\r\n\r\n  /**\r\n   * Test that sync updates storage with fresh patient data\r\n   */\r\n  it('should update storage with fresh patient data after sync', async () => {\r\n    await fc.assert(\r\n      fc.asyncProperty(\r\n        fc.array(\r\n          fc.record({\r\n            id: fc.uuid(),\r\n            firstName: fc.string({ minLength: 1 }),\r\n            lastName: fc.string({ minLength: 1 }),\r\n            dateOfBirth: fc.date({ max: new Date() }).map(d => d.toISOString()),\r\n            gender: fc.constantFrom('male', 'female', 'other'),\r\n            phone: fc.string({ minLength: 10, maxLength: 15 }),\r\n            updatedAt: fc.date().map(d => d.toISOString()),\r\n          }),\r\n          { minLength: 1, maxLength: 10 }\r\n        ),\r\n        async (patients) => {\r\n          // Mock network to return fresh patient data\r\n          vi.spyOn(networkService, 'get').mockImplementation(async (url: string) => {\r\n            if (url.includes('/api/patients')) {\r\n              return patients;\r\n            }\r\n            return [];\r\n          });\r\n\r\n          // Mock network post/patch/delete to succeed\r\n          vi.spyOn(networkService, 'post').mockResolvedValue({});\r\n          vi.spyOn(networkService, 'patch').mockResolvedValue({});\r\n          vi.spyOn(networkService, 'delete').mockResolvedValue({});\r\n\r\n          // Perform sync\r\n          const result = await syncService.syncNow();\r\n\r\n          // Verify sync was successful\r\n          expect(result.success).toBe(true);\r\n          expect(result.downloaded).toBeGreaterThan(0);\r\n\r\n          // Verify storage was updated with fresh data\r\n          const storedPatients = await storageService.get('patients:all');\r\n          expect(storedPatients).toEqual(patients);\r\n\r\n          // Verify individual patients are stored\r\n          for (const patient of patients) {\r\n            const storedPatient = await storageService.get(`patients:${patient.id}`);\r\n            expect(storedPatient).toEqual(patient);\r\n          }\r\n        }\r\n      ),\r\n      { numRuns: 50 } // Fewer runs since this involves mocking\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that sync updates storage with fresh appointment data\r\n   */\r\n  it('should update storage with fresh appointment data after sync', async () => {\r\n    await fc.assert(\r\n      fc.asyncProperty(\r\n        fc.array(\r\n          fc.record({\r\n            id: fc.uuid(),\r\n            patientId: fc.uuid(),\r\n            doctorId: fc.uuid(),\r\n            date: fc.date({ min: new Date() }).map(d => d.toISOString()),\r\n            duration: fc.integer({ min: 15, max: 120 }),\r\n            type: fc.constantFrom('consultation', 'follow-up', 'emergency'),\r\n            status: fc.constantFrom('scheduled', 'completed', 'cancelled', 'no-show'),\r\n            updatedAt: fc.date().map(d => d.toISOString()),\r\n          }),\r\n          { minLength: 1, maxLength: 10 }\r\n        ),\r\n        async (appointments) => {\r\n          // Mock network to return fresh appointment data\r\n          vi.spyOn(networkService, 'get').mockImplementation(async (url: string) => {\r\n            if (url.includes('/api/appointments')) {\r\n              return appointments;\r\n            }\r\n            return [];\r\n          });\r\n\r\n          // Mock network post/patch/delete to succeed\r\n          vi.spyOn(networkService, 'post').mockResolvedValue({});\r\n          vi.spyOn(networkService, 'patch').mockResolvedValue({});\r\n          vi.spyOn(networkService, 'delete').mockResolvedValue({});\r\n\r\n          // Perform sync\r\n          const result = await syncService.syncNow();\r\n\r\n          // Verify sync was successful\r\n          expect(result.success).toBe(true);\r\n\r\n          // Verify storage was updated with fresh data\r\n          const storedAppointments = await storageService.get('appointments:all');\r\n          expect(storedAppointments).toEqual(appointments);\r\n\r\n          // Verify individual appointments are stored\r\n          for (const appointment of appointments) {\r\n            const storedAppointment = await storageService.get(`appointments:${appointment.id}`);\r\n            expect(storedAppointment).toEqual(appointment);\r\n          }\r\n        }\r\n      ),\r\n      { numRuns: 50 }\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that sync updates storage with fresh consultation data\r\n   */\r\n  it('should update storage with fresh consultation data after sync', async () => {\r\n    await fc.assert(\r\n      fc.asyncProperty(\r\n        fc.array(\r\n          fc.record({\r\n            id: fc.uuid(),\r\n            patientId: fc.uuid(),\r\n            doctorId: fc.uuid(),\r\n            date: fc.date().map(d => d.toISOString()),\r\n            chiefComplaint: fc.string({ minLength: 1 }),\r\n            symptoms: fc.array(fc.string(), { minLength: 1 }),\r\n            diagnoses: fc.array(\r\n              fc.record({\r\n                id: fc.uuid(),\r\n                icd11Code: fc.string(),\r\n                description: fc.string(),\r\n                type: fc.constantFrom('primary', 'secondary'),\r\n              }),\r\n              { minLength: 1 }\r\n            ),\r\n            updatedAt: fc.date().map(d => d.toISOString()),\r\n          }),\r\n          { minLength: 1, maxLength: 10 }\r\n        ),\r\n        async (consultations) => {\r\n          // Mock network to return fresh consultation data\r\n          vi.spyOn(networkService, 'get').mockImplementation(async (url: string) => {\r\n            if (url.includes('/api/consultations')) {\r\n              return consultations;\r\n            }\r\n            return [];\r\n          });\r\n\r\n          // Mock network post/patch/delete to succeed\r\n          vi.spyOn(networkService, 'post').mockResolvedValue({});\r\n          vi.spyOn(networkService, 'patch').mockResolvedValue({});\r\n          vi.spyOn(networkService, 'delete').mockResolvedValue({});\r\n\r\n          // Perform sync\r\n          const result = await syncService.syncNow();\r\n\r\n          // Verify sync was successful\r\n          expect(result.success).toBe(true);\r\n\r\n          // Verify storage was updated with fresh data\r\n          const storedConsultations = await storageService.get('consultations:all');\r\n          expect(storedConsultations).toEqual(consultations);\r\n\r\n          // Verify individual consultations are stored\r\n          for (const consultation of consultations) {\r\n            const storedConsultation = await storageService.get(`consultations:${consultation.id}`);\r\n            expect(storedConsultation).toEqual(consultation);\r\n          }\r\n        }\r\n      ),\r\n      { numRuns: 50 }\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that sync updates storage with fresh message data\r\n   */\r\n  it('should update storage with fresh message data after sync', async () => {\r\n    await fc.assert(\r\n      fc.asyncProperty(\r\n        fc.array(\r\n          fc.record({\r\n            id: fc.uuid(),\r\n            conversationId: fc.uuid(),\r\n            senderId: fc.uuid(),\r\n            recipientId: fc.uuid(),\r\n            content: fc.string({ minLength: 1 }),\r\n            sentAt: fc.date().map(d => d.toISOString()),\r\n            updatedAt: fc.date().map(d => d.toISOString()),\r\n          }),\r\n          { minLength: 1, maxLength: 10 }\r\n        ),\r\n        async (messages) => {\r\n          // Mock network to return fresh message data\r\n          vi.spyOn(networkService, 'get').mockImplementation(async (url: string) => {\r\n            if (url.includes('/api/messages')) {\r\n              return messages;\r\n            }\r\n            return [];\r\n          });\r\n\r\n          // Mock network post/patch/delete to succeed\r\n          vi.spyOn(networkService, 'post').mockResolvedValue({});\r\n          vi.spyOn(networkService, 'patch').mockResolvedValue({});\r\n          vi.spyOn(networkService, 'delete').mockResolvedValue({});\r\n\r\n          // Perform sync\r\n          const result = await syncService.syncNow();\r\n\r\n          // Verify sync was successful\r\n          expect(result.success).toBe(true);\r\n\r\n          // Verify storage was updated with fresh data\r\n          const storedMessages = await storageService.get('messages:all');\r\n          expect(storedMessages).toEqual(messages);\r\n\r\n          // Verify individual messages are stored\r\n          for (const message of messages) {\r\n            const storedMessage = await storageService.get(`messages:${message.id}`);\r\n            expect(storedMessage).toEqual(message);\r\n          }\r\n        }\r\n      ),\r\n      { numRuns: 50 }\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that sync updates storage with fresh settings data\r\n   */\r\n  it('should update storage with fresh settings data after sync', async () => {\r\n    await fc.assert(\r\n      fc.asyncProperty(\r\n        fc.array(\r\n          fc.record({\r\n            id: fc.uuid(),\r\n            userId: fc.uuid(),\r\n            credentials: fc.string(),\r\n            specialties: fc.array(fc.string(), { minLength: 1 }),\r\n            licenseNumber: fc.string(),\r\n            updatedAt: fc.date().map(d => d.toISOString()),\r\n          }),\r\n          { minLength: 1, maxLength: 5 }\r\n        ),\r\n        async (settings) => {\r\n          // Mock network to return fresh settings data\r\n          vi.spyOn(networkService, 'get').mockImplementation(async (url: string) => {\r\n            if (url.includes('/api/settings')) {\r\n              return settings;\r\n            }\r\n            return [];\r\n          });\r\n\r\n          // Mock network post/patch/delete to succeed\r\n          vi.spyOn(networkService, 'post').mockResolvedValue({});\r\n          vi.spyOn(networkService, 'patch').mockResolvedValue({});\r\n          vi.spyOn(networkService, 'delete').mockResolvedValue({});\r\n\r\n          // Perform sync\r\n          const result = await syncService.syncNow();\r\n\r\n          // Verify sync was successful\r\n          expect(result.success).toBe(true);\r\n\r\n          // Verify storage was updated with fresh data\r\n          const storedSettings = await storageService.get('settings:all');\r\n          expect(storedSettings).toEqual(settings);\r\n\r\n          // Verify individual settings are stored\r\n          for (const setting of settings) {\r\n            const storedSetting = await storageService.get(`settings:${setting.id}`);\r\n            expect(storedSetting).toEqual(setting);\r\n          }\r\n        }\r\n      ),\r\n      { numRuns: 50 }\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that sync updates metadata after successful sync\r\n   */\r\n  it('should update sync metadata after successful sync', async () => {\r\n    await fc.assert(\r\n      fc.asyncProperty(\r\n        fc.array(\r\n          fc.record({\r\n            id: fc.uuid(),\r\n            name: fc.string(),\r\n            updatedAt: fc.date().map(d => d.toISOString()),\r\n          }),\r\n          { minLength: 1, maxLength: 5 }\r\n        ),\r\n        async (data) => {\r\n          // Mock network to return data\r\n          vi.spyOn(networkService, 'get').mockResolvedValue(data);\r\n          vi.spyOn(networkService, 'post').mockResolvedValue({});\r\n          vi.spyOn(networkService, 'patch').mockResolvedValue({});\r\n          vi.spyOn(networkService, 'delete').mockResolvedValue({});\r\n\r\n          // Get metadata before sync\r\n          const metadataBefore = await syncService.getSyncMetadata();\r\n          const lastSyncBefore = metadataBefore.lastSyncTime;\r\n\r\n          // Wait a bit to ensure timestamp difference\r\n          await new Promise(resolve => setTimeout(resolve, 10));\r\n\r\n          // Perform sync\r\n          await syncService.syncNow();\r\n\r\n          // Get metadata after sync\r\n          const metadataAfter = await syncService.getSyncMetadata();\r\n\r\n          // Verify metadata was updated\r\n          expect(metadataAfter.lastSyncTime).not.toBeNull();\r\n          expect(metadataAfter.lastSuccessfulSync).not.toBeNull();\r\n          \r\n          // Last sync time should be after previous sync time\r\n          if (lastSyncBefore) {\r\n            expect(new Date(metadataAfter.lastSyncTime!).getTime()).toBeGreaterThan(\r\n              new Date(lastSyncBefore).getTime()\r\n            );\r\n          }\r\n        }\r\n      ),\r\n      { numRuns: 50 }\r\n    );\r\n  });\r\n\r\n  /**\r\n   * Test that sync handles empty server response correctly\r\n   */\r\n  it('should handle empty server response without errors', async () => {\r\n    // Mock network to return empty arrays\r\n    vi.spyOn(networkService, 'get').mockResolvedValue([]);\r\n    vi.spyOn(networkService, 'post').mockResolvedValue({});\r\n    vi.spyOn(networkService, 'patch').mockResolvedValue({});\r\n    vi.spyOn(networkService, 'delete').mockResolvedValue({});\r\n\r\n    // Perform sync\r\n    const result = await syncService.syncNow();\r\n\r\n    // Verify sync was successful even with no data\r\n    expect(result.success).toBe(true);\r\n    expect(result.downloaded).toBe(0);\r\n    expect(result.errors).toEqual([]);\r\n  });\r\n\r\n  /**\r\n   * Test that sync preserves existing data when no updates available\r\n   */\r\n  it('should preserve existing data when no updates available', async () => {\r\n    await fc.assert(\r\n      fc.asyncProperty(\r\n        fc.array(\r\n          fc.record({\r\n            id: fc.uuid(),\r\n            name: fc.string(),\r\n            value: fc.string(),\r\n          }),\r\n          { minLength: 1, maxLength: 5 }\r\n        ),\r\n        async (existingData) => {\r\n          // Save existing data to storage\r\n          await storageService.save('patients:all', existingData);\r\n\r\n          // Mock network to return empty (no updates)\r\n          vi.spyOn(networkService, 'get').mockResolvedValue([]);\r\n          vi.spyOn(networkService, 'post').mockResolvedValue({});\r\n          vi.spyOn(networkService, 'patch').mockResolvedValue({});\r\n          vi.spyOn(networkService, 'delete').mockResolvedValue({});\r\n\r\n          // Perform sync\r\n          await syncService.syncNow();\r\n\r\n          // Verify existing data is still there\r\n          const storedData = await storageService.get('patients:all');\r\n          expect(storedData).toEqual(existingData);\r\n        }\r\n      ),\r\n      { numRuns: 50 }\r\n    );\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\runtime\\connectivity-monitor.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\runtime\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\runtime\\runtime-service.ts","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":80,"column":41,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":80,"endColumn":84},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":84,"column":39,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":84,"endColumn":80},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":98,"column":41,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":98,"endColumn":84},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":102,"column":39,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":102,"endColumn":80},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":116,"column":37,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":116,"endColumn":76},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":120,"column":35,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":120,"endColumn":72},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":134,"column":46,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":134,"endColumn":94},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":138,"column":44,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":138,"endColumn":90},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":161,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":161,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4791,4794],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4791,4794],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Runtime Service - Singleton for Runtime Detection\r\n * \r\n * This service detects the runtime environment (Tauri vs Web) and provides\r\n * factory methods to get the appropriate service implementations.\r\n * \r\n * Validates: Requirements 9.1, 9.2, 9.3\r\n */\r\n\r\nimport type {\r\n  RuntimeService as IRuntimeService,\r\n  RuntimeEnvironment,\r\n  StorageService,\r\n  NetworkService,\r\n  PDFService,\r\n  NotificationService,\r\n} from './types';\r\n\r\nclass RuntimeServiceImpl implements IRuntimeService {\r\n  private static instance: RuntimeServiceImpl;\r\n  private environment: RuntimeEnvironment;\r\n  private storageService: StorageService | null = null;\r\n  private networkService: NetworkService | null = null;\r\n  private pdfService: PDFService | null = null;\r\n  private notificationService: NotificationService | null = null;\r\n\r\n  private constructor() {\r\n    // Detect runtime environment\r\n    this.environment = this.detectEnvironment();\r\n  }\r\n\r\n  /**\r\n   * Get the singleton instance\r\n   */\r\n  public static getInstance(): RuntimeServiceImpl {\r\n    if (!RuntimeServiceImpl.instance) {\r\n      RuntimeServiceImpl.instance = new RuntimeServiceImpl();\r\n    }\r\n    return RuntimeServiceImpl.instance;\r\n  }\r\n\r\n  /**\r\n   * Detect the runtime environment\r\n   */\r\n  private detectEnvironment(): RuntimeEnvironment {\r\n    if (typeof window !== 'undefined' && '__TAURI__' in window) {\r\n      return 'tauri';\r\n    }\r\n    return 'web';\r\n  }\r\n\r\n  /**\r\n   * Check if running in Tauri environment\r\n   */\r\n  public isTauri(): boolean {\r\n    return this.environment === 'tauri';\r\n  }\r\n\r\n  /**\r\n   * Check if running in web environment\r\n   */\r\n  public isWeb(): boolean {\r\n    return this.environment === 'web';\r\n  }\r\n\r\n  /**\r\n   * Get the current runtime environment\r\n   */\r\n  public getEnvironment(): RuntimeEnvironment {\r\n    return this.environment;\r\n  }\r\n\r\n  /**\r\n   * Get the storage service for the current runtime\r\n   */\r\n  public getStorageService(): StorageService {\r\n    if (!this.storageService) {\r\n      if (this.isTauri()) {\r\n        // Lazy load Tauri storage service\r\n        const { TauriStorageService } = require('./services/tauri-storage-service');\r\n        this.storageService = new TauriStorageService();\r\n      } else {\r\n        // Lazy load Web storage service\r\n        const { WebStorageService } = require('./services/web-storage-service');\r\n        this.storageService = new WebStorageService();\r\n      }\r\n    }\r\n    return this.storageService!;\r\n  }\r\n\r\n  /**\r\n   * Get the network service for the current runtime\r\n   */\r\n  public getNetworkService(): NetworkService {\r\n    if (!this.networkService) {\r\n      if (this.isTauri()) {\r\n        // Lazy load Tauri network service\r\n        const { TauriNetworkService } = require('./services/tauri-network-service');\r\n        this.networkService = new TauriNetworkService();\r\n      } else {\r\n        // Lazy load Web network service\r\n        const { WebNetworkService } = require('./services/web-network-service');\r\n        this.networkService = new WebNetworkService();\r\n      }\r\n    }\r\n    return this.networkService!;\r\n  }\r\n\r\n  /**\r\n   * Get the PDF service for the current runtime\r\n   */\r\n  public getPDFService(): PDFService {\r\n    if (!this.pdfService) {\r\n      if (this.isTauri()) {\r\n        // Lazy load Tauri PDF service\r\n        const { TauriPDFService } = require('./services/tauri-pdf-service');\r\n        this.pdfService = new TauriPDFService();\r\n      } else {\r\n        // Lazy load Web PDF service\r\n        const { WebPDFService } = require('./services/web-pdf-service');\r\n        this.pdfService = new WebPDFService();\r\n      }\r\n    }\r\n    return this.pdfService!;\r\n  }\r\n\r\n  /**\r\n   * Get the notification service for the current runtime\r\n   */\r\n  public getNotificationService(): NotificationService {\r\n    if (!this.notificationService) {\r\n      if (this.isTauri()) {\r\n        // Lazy load Tauri notification service\r\n        const { TauriNotificationService } = require('./services/tauri-notification-service');\r\n        this.notificationService = new TauriNotificationService();\r\n      } else {\r\n        // Lazy load Web notification service\r\n        const { WebNotificationService } = require('./services/web-notification-service');\r\n        this.notificationService = new WebNotificationService();\r\n      }\r\n    }\r\n    return this.notificationService!;\r\n  }\r\n\r\n  /**\r\n   * Reset all services (useful for testing)\r\n   */\r\n  public resetServices(): void {\r\n    this.storageService = null;\r\n    this.networkService = null;\r\n    this.pdfService = null;\r\n    this.notificationService = null;\r\n    // Re-detect environment\r\n    this.environment = this.detectEnvironment();\r\n  }\r\n\r\n  /**\r\n   * Reset the singleton instance (useful for testing)\r\n   */\r\n  public static resetInstance(): void {\r\n    RuntimeServiceImpl.instance = null as any;\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const RuntimeService = RuntimeServiceImpl.getInstance();\r\n\r\n// Export class for testing\r\nexport { RuntimeServiceImpl };\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\runtime\\services\\tauri-network-service.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":220,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":220,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6155,6158],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6155,6158],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":241,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":241,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6758,6761],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6758,6761],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Tauri Network Service\r\n * \r\n * Network service implementation for Tauri (desktop) environment.\r\n * Uses Rust commands for network operations with offline support.\r\n * \r\n * Features:\r\n * - Automatic retry with exponential backoff\r\n * - Network error detection and handling\r\n * - Timeout support\r\n * \r\n * Validates: Requirements 7.3, 9.2, 9.3\r\n */\r\n\r\nimport { invoke } from '@tauri-apps/api/core';\r\nimport type { NetworkService, RequestOptions } from '../types';\r\n\r\n/**\r\n * Network error types for better error handling\r\n */\r\nexport enum NetworkErrorType {\r\n  TIMEOUT = 'TIMEOUT',\r\n  CONNECTION_FAILED = 'CONNECTION_FAILED',\r\n  SERVER_ERROR = 'SERVER_ERROR',\r\n  AUTHENTICATION_ERROR = 'AUTHENTICATION_ERROR',\r\n  UNKNOWN = 'UNKNOWN',\r\n}\r\n\r\nexport class NetworkError extends Error {\r\n  constructor(\r\n    message: string,\r\n    public type: NetworkErrorType,\r\n    public statusCode?: number,\r\n    public originalError?: unknown\r\n  ) {\r\n    super(message);\r\n    this.name = 'NetworkError';\r\n  }\r\n}\r\n\r\nexport class TauriNetworkService implements NetworkService {\r\n  private readonly DEFAULT_TIMEOUT = 30000; // 30 seconds\r\n  private readonly DEFAULT_RETRIES = 3;\r\n  private readonly INITIAL_RETRY_DELAY = 1000; // 1 second\r\n\r\n  /**\r\n   * Sleep for a specified duration\r\n   */\r\n  private sleep(ms: number): Promise<void> {\r\n    return new Promise(resolve => setTimeout(resolve, ms));\r\n  }\r\n\r\n  /**\r\n   * Calculate exponential backoff delay\r\n   */\r\n  private getRetryDelay(attempt: number): number {\r\n    return this.INITIAL_RETRY_DELAY * Math.pow(2, attempt);\r\n  }\r\n\r\n  /**\r\n   * Determine if an error is retryable\r\n   */\r\n  private isRetryableError(error: NetworkError): boolean {\r\n    // Retry on timeout, connection failures, and server errors (5xx)\r\n    return (\r\n      error.type === NetworkErrorType.TIMEOUT ||\r\n      error.type === NetworkErrorType.CONNECTION_FAILED ||\r\n      (error.type === NetworkErrorType.SERVER_ERROR && \r\n       error.statusCode !== undefined && \r\n       error.statusCode >= 500)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Parse error from Rust command invocation\r\n   */\r\n  private parseError(error: unknown): NetworkError {\r\n    const errorStr = String(error);\r\n    \r\n    // Check for timeout\r\n    if (errorStr.includes('timeout') || errorStr.includes('timed out')) {\r\n      return new NetworkError(\r\n        'Request timed out',\r\n        NetworkErrorType.TIMEOUT,\r\n        undefined,\r\n        error\r\n      );\r\n    }\r\n    \r\n    // Check for connection errors\r\n    if (\r\n      errorStr.includes('connection') ||\r\n      errorStr.includes('network') ||\r\n      errorStr.includes('offline')\r\n    ) {\r\n      return new NetworkError(\r\n        'Connection failed',\r\n        NetworkErrorType.CONNECTION_FAILED,\r\n        undefined,\r\n        error\r\n      );\r\n    }\r\n    \r\n    // Check for authentication errors\r\n    if (errorStr.includes('401') || errorStr.includes('unauthorized')) {\r\n      return new NetworkError(\r\n        'Authentication failed',\r\n        NetworkErrorType.AUTHENTICATION_ERROR,\r\n        401,\r\n        error\r\n      );\r\n    }\r\n    \r\n    // Check for server errors\r\n    const statusMatch = errorStr.match(/(\\d{3})/);\r\n    if (statusMatch) {\r\n      const statusCode = parseInt(statusMatch[1], 10);\r\n      if (statusCode >= 500) {\r\n        return new NetworkError(\r\n          `Server error: ${statusCode}`,\r\n          NetworkErrorType.SERVER_ERROR,\r\n          statusCode,\r\n          error\r\n        );\r\n      }\r\n    }\r\n    \r\n    return new NetworkError(\r\n      'Unknown network error',\r\n      NetworkErrorType.UNKNOWN,\r\n      undefined,\r\n      error\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Execute a request with retry logic\r\n   */\r\n  private async executeWithRetry<T>(\r\n    operation: () => Promise<T>,\r\n    options?: RequestOptions\r\n  ): Promise<T> {\r\n    const maxRetries = options?.retries ?? this.DEFAULT_RETRIES;\r\n    let lastError: NetworkError | null = null;\r\n\r\n    for (let attempt = 0; attempt < maxRetries; attempt++) {\r\n      try {\r\n        // Add timeout wrapper if specified\r\n        if (options?.timeout) {\r\n          return await this.withTimeout(operation(), options.timeout);\r\n        }\r\n        return await operation();\r\n      } catch (error) {\r\n        lastError = this.parseError(error);\r\n        \r\n        // Don't retry on authentication errors\r\n        if (lastError.type === NetworkErrorType.AUTHENTICATION_ERROR) {\r\n          throw lastError;\r\n        }\r\n        \r\n        // Check if we should retry\r\n        const isLastAttempt = attempt === maxRetries - 1;\r\n        if (isLastAttempt || !this.isRetryableError(lastError)) {\r\n          throw lastError;\r\n        }\r\n        \r\n        // Wait before retrying with exponential backoff\r\n        const delay = this.getRetryDelay(attempt);\r\n        console.warn(\r\n          `Request failed (attempt ${attempt + 1}/${maxRetries}), retrying in ${delay}ms...`,\r\n          lastError.message\r\n        );\r\n        await this.sleep(delay);\r\n      }\r\n    }\r\n\r\n    // This should never be reached, but TypeScript needs it\r\n    throw lastError || new NetworkError('Request failed', NetworkErrorType.UNKNOWN);\r\n  }\r\n\r\n  /**\r\n   * Wrap a promise with a timeout\r\n   */\r\n  private async withTimeout<T>(promise: Promise<T>, timeoutMs: number): Promise<T> {\r\n    return Promise.race([\r\n      promise,\r\n      new Promise<T>((_, reject) =>\r\n        setTimeout(\r\n          () => reject(new NetworkError('Request timed out', NetworkErrorType.TIMEOUT)),\r\n          timeoutMs\r\n        )\r\n      ),\r\n    ]);\r\n  }\r\n\r\n  /**\r\n   * Perform a GET request\r\n   */\r\n  async get<T>(url: string, options?: RequestOptions): Promise<T> {\r\n    return this.executeWithRetry(async () => {\r\n      try {\r\n        // Extract access token from headers if present\r\n        const accessToken = options?.headers?.['Authorization']?.replace('Bearer ', '') || '';\r\n        \r\n        const result = await invoke<string>('supabase_get', {\r\n          endpoint: url,\r\n          accessToken,\r\n        });\r\n        \r\n        return JSON.parse(result);\r\n      } catch (error) {\r\n        throw this.parseError(error);\r\n      }\r\n    }, options);\r\n  }\r\n\r\n  /**\r\n   * Perform a POST request\r\n   */\r\n  async post<T>(url: string, body: any, options?: RequestOptions): Promise<T> {\r\n    return this.executeWithRetry(async () => {\r\n      try {\r\n        const accessToken = options?.headers?.['Authorization']?.replace('Bearer ', '') || '';\r\n        \r\n        const result = await invoke<string>('supabase_post', {\r\n          endpoint: url,\r\n          body: JSON.stringify(body),\r\n          accessToken,\r\n        });\r\n        \r\n        return JSON.parse(result);\r\n      } catch (error) {\r\n        throw this.parseError(error);\r\n      }\r\n    }, options);\r\n  }\r\n\r\n  /**\r\n   * Perform a PATCH request\r\n   */\r\n  async patch<T>(url: string, body: any, options?: RequestOptions): Promise<T> {\r\n    return this.executeWithRetry(async () => {\r\n      try {\r\n        const accessToken = options?.headers?.['Authorization']?.replace('Bearer ', '') || '';\r\n        \r\n        const result = await invoke<string>('supabase_patch', {\r\n          endpoint: url,\r\n          body: JSON.stringify(body),\r\n          accessToken,\r\n        });\r\n        \r\n        return JSON.parse(result);\r\n      } catch (error) {\r\n        throw this.parseError(error);\r\n      }\r\n    }, options);\r\n  }\r\n\r\n  /**\r\n   * Perform a DELETE request\r\n   */\r\n  async delete<T>(url: string, options?: RequestOptions): Promise<T> {\r\n    return this.executeWithRetry(async () => {\r\n      try {\r\n        const accessToken = options?.headers?.['Authorization']?.replace('Bearer ', '') || '';\r\n        \r\n        const result = await invoke<string>('supabase_delete', {\r\n          endpoint: url,\r\n          accessToken,\r\n        });\r\n        \r\n        return JSON.parse(result);\r\n      } catch (error) {\r\n        throw this.parseError(error);\r\n      }\r\n    }, options);\r\n  }\r\n\r\n  /**\r\n   * Check network connectivity\r\n   */\r\n  async checkConnectivity(): Promise<boolean> {\r\n    try {\r\n      return await invoke<boolean>('check_connectivity');\r\n    } catch (error) {\r\n      console.error('Connectivity check failed:', error);\r\n      return false;\r\n    }\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\runtime\\services\\tauri-notification-service.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'notification' is defined but never used.","line":16,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'notification' is defined but never used.","line":24,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'delay' is defined but never used.","line":24,"column":50,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":55},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'notificationId' is defined but never used.","line":32,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Tauri Notification Service\r\n * \r\n * Notification service implementation for Tauri (desktop) environment.\r\n * Uses Tauri's notification plugin for native system notifications.\r\n * \r\n * This is a stub implementation - will be fully implemented in Task 12.\r\n */\r\n\r\nimport type { NotificationService, NotificationData } from '../types';\r\n\r\nexport class TauriNotificationService implements NotificationService {\r\n  /**\r\n   * Show a notification\r\n   */\r\n  async show(notification: NotificationData): Promise<void> {\r\n    // TODO: Implement in Task 12\r\n    throw new Error('Notification show not yet implemented');\r\n  }\r\n\r\n  /**\r\n   * Schedule a notification for later\r\n   */\r\n  async schedule(notification: NotificationData, delay: number): Promise<string> {\r\n    // TODO: Implement in Task 12\r\n    throw new Error('Notification scheduling not yet implemented');\r\n  }\r\n\r\n  /**\r\n   * Cancel a scheduled notification\r\n   */\r\n  async cancel(notificationId: string): Promise<void> {\r\n    // TODO: Implement in Task 12\r\n    throw new Error('Notification cancellation not yet implemented');\r\n  }\r\n\r\n  /**\r\n   * Request notification permission\r\n   */\r\n  async requestPermission(): Promise<boolean> {\r\n    // TODO: Implement in Task 12\r\n    throw new Error('Notification permission request not yet implemented');\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\runtime\\services\\tauri-pdf-service.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":15,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":34},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":23,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":36}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Tauri PDF Service\r\n * \r\n * PDF generation service implementation for Tauri (desktop) environment.\r\n * \r\n * This is a stub implementation - will be fully implemented in Task 11.\r\n */\r\n\r\nimport type { PDFService, PrescriptionData, MedicalHistoryData, PDFResult } from '../types';\r\n\r\nexport class TauriPDFService implements PDFService {\r\n  /**\r\n   * Generate a prescription PDF\r\n   */\r\n  async generatePrescription(data: PrescriptionData): Promise<PDFResult> {\r\n    // TODO: Implement in Task 11\r\n    throw new Error('Prescription PDF generation not yet implemented');\r\n  }\r\n\r\n  /**\r\n   * Generate a medical history PDF\r\n   */\r\n  async generateMedicalHistory(data: MedicalHistoryData): Promise<PDFResult> {\r\n    // TODO: Implement in Task 11\r\n    throw new Error('Medical history PDF generation not yet implemented');\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\runtime\\services\\tauri-storage-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\runtime\\services\\web-network-service.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":193,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":193,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5279,5282],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5279,5282],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":231,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":231,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6292,6295],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6292,6295],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":271,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":271,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7345,7348],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7345,7348],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":281,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":281,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7609,7612],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7609,7612],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Web Network Service\r\n * \r\n * Network service implementation for web environment.\r\n * Uses standard fetch API for network operations.\r\n * \r\n * Features:\r\n * - Automatic retry with exponential backoff\r\n * - Network error detection and handling\r\n * - Timeout support\r\n * \r\n * Validates: Requirements 7.3, 9.2, 9.3\r\n */\r\n\r\nimport type { NetworkService, RequestOptions } from '../types';\r\n\r\n/**\r\n * Network error types for better error handling\r\n */\r\nexport enum NetworkErrorType {\r\n  TIMEOUT = 'TIMEOUT',\r\n  CONNECTION_FAILED = 'CONNECTION_FAILED',\r\n  SERVER_ERROR = 'SERVER_ERROR',\r\n  AUTHENTICATION_ERROR = 'AUTHENTICATION_ERROR',\r\n  CLIENT_ERROR = 'CLIENT_ERROR',\r\n  UNKNOWN = 'UNKNOWN',\r\n}\r\n\r\nexport class NetworkError extends Error {\r\n  constructor(\r\n    message: string,\r\n    public type: NetworkErrorType,\r\n    public statusCode?: number,\r\n    public originalError?: unknown\r\n  ) {\r\n    super(message);\r\n    this.name = 'NetworkError';\r\n  }\r\n}\r\n\r\nexport class WebNetworkService implements NetworkService {\r\n  private baseUrl: string;\r\n  private readonly DEFAULT_TIMEOUT = 30000; // 30 seconds\r\n  private readonly DEFAULT_RETRIES = 3;\r\n  private readonly INITIAL_RETRY_DELAY = 1000; // 1 second\r\n\r\n  constructor() {\r\n    this.baseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || '';\r\n  }\r\n\r\n  /**\r\n   * Sleep for a specified duration\r\n   */\r\n  private sleep(ms: number): Promise<void> {\r\n    return new Promise(resolve => setTimeout(resolve, ms));\r\n  }\r\n\r\n  /**\r\n   * Calculate exponential backoff delay\r\n   */\r\n  private getRetryDelay(attempt: number): number {\r\n    return this.INITIAL_RETRY_DELAY * Math.pow(2, attempt);\r\n  }\r\n\r\n  /**\r\n   * Determine if an error is retryable\r\n   */\r\n  private isRetryableError(error: NetworkError): boolean {\r\n    // Retry on timeout, connection failures, and server errors (5xx)\r\n    return (\r\n      error.type === NetworkErrorType.TIMEOUT ||\r\n      error.type === NetworkErrorType.CONNECTION_FAILED ||\r\n      (error.type === NetworkErrorType.SERVER_ERROR && \r\n       error.statusCode !== undefined && \r\n       error.statusCode >= 500)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Parse error from fetch response\r\n   */\r\n  private parseError(error: unknown, statusCode?: number): NetworkError {\r\n    // Handle fetch-specific errors\r\n    if (error instanceof TypeError) {\r\n      // Network errors (offline, DNS failure, etc.)\r\n      return new NetworkError(\r\n        'Connection failed',\r\n        NetworkErrorType.CONNECTION_FAILED,\r\n        undefined,\r\n        error\r\n      );\r\n    }\r\n\r\n    // Handle timeout errors\r\n    if (error instanceof Error && error.name === 'AbortError') {\r\n      return new NetworkError(\r\n        'Request timed out',\r\n        NetworkErrorType.TIMEOUT,\r\n        undefined,\r\n        error\r\n      );\r\n    }\r\n\r\n    // Handle HTTP status codes\r\n    if (statusCode !== undefined) {\r\n      if (statusCode === 401 || statusCode === 403) {\r\n        return new NetworkError(\r\n          'Authentication failed',\r\n          NetworkErrorType.AUTHENTICATION_ERROR,\r\n          statusCode,\r\n          error\r\n        );\r\n      }\r\n      \r\n      if (statusCode >= 500) {\r\n        return new NetworkError(\r\n          `Server error: ${statusCode}`,\r\n          NetworkErrorType.SERVER_ERROR,\r\n          statusCode,\r\n          error\r\n        );\r\n      }\r\n      \r\n      if (statusCode >= 400) {\r\n        return new NetworkError(\r\n          `Client error: ${statusCode}`,\r\n          NetworkErrorType.CLIENT_ERROR,\r\n          statusCode,\r\n          error\r\n        );\r\n      }\r\n    }\r\n\r\n    return new NetworkError(\r\n      'Unknown network error',\r\n      NetworkErrorType.UNKNOWN,\r\n      statusCode,\r\n      error\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Execute a request with retry logic\r\n   */\r\n  private async executeWithRetry<T>(\r\n    operation: () => Promise<T>,\r\n    options?: RequestOptions\r\n  ): Promise<T> {\r\n    const maxRetries = options?.retries ?? this.DEFAULT_RETRIES;\r\n    let lastError: NetworkError | null = null;\r\n\r\n    for (let attempt = 0; attempt < maxRetries; attempt++) {\r\n      try {\r\n        return await operation();\r\n      } catch (error) {\r\n        lastError = error instanceof NetworkError \r\n          ? error \r\n          : this.parseError(error);\r\n        \r\n        // Don't retry on authentication or client errors\r\n        if (\r\n          lastError.type === NetworkErrorType.AUTHENTICATION_ERROR ||\r\n          lastError.type === NetworkErrorType.CLIENT_ERROR\r\n        ) {\r\n          throw lastError;\r\n        }\r\n        \r\n        // Check if we should retry\r\n        const isLastAttempt = attempt === maxRetries - 1;\r\n        if (isLastAttempt || !this.isRetryableError(lastError)) {\r\n          throw lastError;\r\n        }\r\n        \r\n        // Wait before retrying with exponential backoff\r\n        const delay = this.getRetryDelay(attempt);\r\n        console.warn(\r\n          `Request failed (attempt ${attempt + 1}/${maxRetries}), retrying in ${delay}ms...`,\r\n          lastError.message\r\n        );\r\n        await this.sleep(delay);\r\n      }\r\n    }\r\n\r\n    // This should never be reached, but TypeScript needs it\r\n    throw lastError || new NetworkError('Request failed', NetworkErrorType.UNKNOWN);\r\n  }\r\n\r\n  /**\r\n   * Build fetch options from RequestOptions\r\n   */\r\n  private buildFetchOptions(\r\n    method: string,\r\n    body?: any,\r\n    options?: RequestOptions\r\n  ): { init: RequestInit; controller: AbortController } {\r\n    const controller = new AbortController();\r\n    const timeout = options?.timeout ?? this.DEFAULT_TIMEOUT;\r\n\r\n    // Set timeout\r\n    const timeoutId = setTimeout(() => controller.abort(), timeout);\r\n\r\n    const headers: HeadersInit = {\r\n      'Content-Type': 'application/json',\r\n      ...options?.headers,\r\n    };\r\n\r\n    const fetchOptions: RequestInit = {\r\n      method,\r\n      headers,\r\n      signal: controller.signal,\r\n    };\r\n\r\n    if (body) {\r\n      fetchOptions.body = JSON.stringify(body);\r\n    }\r\n\r\n    // Clear timeout on completion\r\n    const originalSignal = controller.signal;\r\n    const cleanup = () => clearTimeout(timeoutId);\r\n    originalSignal.addEventListener('abort', cleanup);\r\n\r\n    return { init: fetchOptions, controller };\r\n  }\r\n\r\n  /**\r\n   * Perform a fetch request with error handling\r\n   */\r\n  private async fetchWithErrorHandling<T>(\r\n    url: string,\r\n    method: string,\r\n    body?: any,\r\n    options?: RequestOptions\r\n  ): Promise<T> {\r\n    const fullUrl = url.startsWith('http') ? url : `${this.baseUrl}${url}`;\r\n    const { init } = this.buildFetchOptions(method, body, options);\r\n\r\n    try {\r\n      const response = await fetch(fullUrl, init);\r\n      \r\n      if (!response.ok) {\r\n        throw this.parseError(\r\n          new Error(`HTTP error! status: ${response.status}`),\r\n          response.status\r\n        );\r\n      }\r\n      \r\n      return await response.json();\r\n    } catch (error) {\r\n      // If it's already a NetworkError, rethrow it\r\n      if (error instanceof NetworkError) {\r\n        throw error;\r\n      }\r\n      // Otherwise, parse it\r\n      throw this.parseError(error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Perform a GET request\r\n   */\r\n  async get<T>(url: string, options?: RequestOptions): Promise<T> {\r\n    return this.executeWithRetry(\r\n      () => this.fetchWithErrorHandling<T>(url, 'GET', undefined, options),\r\n      options\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Perform a POST request\r\n   */\r\n  async post<T>(url: string, body: any, options?: RequestOptions): Promise<T> {\r\n    return this.executeWithRetry(\r\n      () => this.fetchWithErrorHandling<T>(url, 'POST', body, options),\r\n      options\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Perform a PATCH request\r\n   */\r\n  async patch<T>(url: string, body: any, options?: RequestOptions): Promise<T> {\r\n    return this.executeWithRetry(\r\n      () => this.fetchWithErrorHandling<T>(url, 'PATCH', body, options),\r\n      options\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Perform a DELETE request\r\n   */\r\n  async delete<T>(url: string, options?: RequestOptions): Promise<T> {\r\n    return this.executeWithRetry(\r\n      () => this.fetchWithErrorHandling<T>(url, 'DELETE', undefined, options),\r\n      options\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Check network connectivity\r\n   */\r\n  async checkConnectivity(): Promise<boolean> {\r\n    if (!navigator.onLine) {\r\n      return false;\r\n    }\r\n\r\n    // Perform a simple ping test\r\n    try {\r\n      const controller = new AbortController();\r\n      const timeoutId = setTimeout(() => controller.abort(), 5000); // 5 second timeout\r\n\r\n      const response = await fetch(`${this.baseUrl}/rest/v1/`, {\r\n        method: 'HEAD',\r\n        cache: 'no-cache',\r\n        signal: controller.signal,\r\n      });\r\n\r\n      clearTimeout(timeoutId);\r\n      return response.ok;\r\n    } catch {\r\n      return false;\r\n    }\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\runtime\\services\\web-notification-service.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'notification' is defined but never used.","line":16,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'notification' is defined but never used.","line":24,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'delay' is defined but never used.","line":24,"column":50,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":55},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'notificationId' is defined but never used.","line":32,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Web Notification Service\r\n * \r\n * Notification service implementation for web environment.\r\n * Uses Web Notifications API for browser notifications.\r\n * \r\n * This is a stub implementation - will be fully implemented in Task 12.\r\n */\r\n\r\nimport type { NotificationService, NotificationData } from '../types';\r\n\r\nexport class WebNotificationService implements NotificationService {\r\n  /**\r\n   * Show a notification\r\n   */\r\n  async show(notification: NotificationData): Promise<void> {\r\n    // TODO: Implement in Task 12\r\n    throw new Error('Notification show not yet implemented');\r\n  }\r\n\r\n  /**\r\n   * Schedule a notification for later\r\n   */\r\n  async schedule(notification: NotificationData, delay: number): Promise<string> {\r\n    // TODO: Implement in Task 12\r\n    throw new Error('Notification scheduling not yet implemented');\r\n  }\r\n\r\n  /**\r\n   * Cancel a scheduled notification\r\n   */\r\n  async cancel(notificationId: string): Promise<void> {\r\n    // TODO: Implement in Task 12\r\n    throw new Error('Notification cancellation not yet implemented');\r\n  }\r\n\r\n  /**\r\n   * Request notification permission\r\n   */\r\n  async requestPermission(): Promise<boolean> {\r\n    // TODO: Implement in Task 12\r\n    throw new Error('Notification permission request not yet implemented');\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\runtime\\services\\web-pdf-service.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":15,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":34},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":23,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":36}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Web PDF Service\r\n * \r\n * PDF generation service implementation for web environment.\r\n * \r\n * This is a stub implementation - will be fully implemented in Task 11.\r\n */\r\n\r\nimport type { PDFService, PrescriptionData, MedicalHistoryData, PDFResult } from '../types';\r\n\r\nexport class WebPDFService implements PDFService {\r\n  /**\r\n   * Generate a prescription PDF\r\n   */\r\n  async generatePrescription(data: PrescriptionData): Promise<PDFResult> {\r\n    // TODO: Implement in Task 11\r\n    throw new Error('Prescription PDF generation not yet implemented');\r\n  }\r\n\r\n  /**\r\n   * Generate a medical history PDF\r\n   */\r\n  async generateMedicalHistory(data: MedicalHistoryData): Promise<PDFResult> {\r\n    // TODO: Implement in Task 11\r\n    throw new Error('Medical history PDF generation not yet implemented');\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\runtime\\services\\web-storage-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\runtime\\storage-keys.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\runtime\\sync-service.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SYNC_ERRORS' is defined but never used.","line":24,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":48},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":397,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":397,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11128,11131],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11128,11131],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":447,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":447,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12596,12599],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12596,12599],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":473,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":473,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13288,13291],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13288,13291],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":484,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":484,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13636,13639],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13636,13639],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Sync Service - Synchronization between local storage and server\r\n * \r\n * This service manages automatic synchronization of data between the local\r\n * offline store and the remote server. It handles:\r\n * - Automatic sync every 5 minutes when online\r\n * - Manual sync on demand\r\n * - Queueing changes when offline\r\n * - Conflict resolution with last-write-wins strategy\r\n * - Retry with exponential backoff\r\n * \r\n * Validates: Requirements 2.2, 2.3, 2.5, 3.1, 3.2, 3.3, 3.6\r\n */\r\n\r\nimport type {\r\n  SyncService as ISyncService,\r\n  SyncResult,\r\n  PendingChange,\r\n  SyncMetadata,\r\n  SyncError,\r\n  StorageService,\r\n  NetworkService,\r\n} from './types';\r\nimport { SYNC_QUEUE, SYNC_METADATA, SYNC_ERRORS } from './storage-keys';\r\n\r\nexport class SyncService implements ISyncService {\r\n  private syncInterval: NodeJS.Timeout | null = null;\r\n  private syncing = false;\r\n  private readonly SYNC_INTERVAL_MS = 5 * 60 * 1000; // 5 minutes\r\n  private readonly MAX_RETRIES = 3;\r\n  private readonly INITIAL_BACKOFF_MS = 1000; // 1 second\r\n\r\n  constructor(\r\n    private storage: StorageService,\r\n    private network: NetworkService,\r\n    private onConnectivityChange?: (online: boolean) => void\r\n  ) {}\r\n\r\n  /**\r\n   * Start automatic synchronization\r\n   * Syncs every 5 minutes when online\r\n   */\r\n  public start(): void {\r\n    if (this.syncInterval) {\r\n      return; // Already started\r\n    }\r\n\r\n    // Start periodic sync\r\n    this.syncInterval = setInterval(() => {\r\n      this.syncNow().catch(error => {\r\n        console.error('Automatic sync failed:', error);\r\n      });\r\n    }, this.SYNC_INTERVAL_MS);\r\n\r\n    // Trigger initial sync\r\n    this.syncNow().catch(error => {\r\n      console.error('Initial sync failed:', error);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Stop automatic synchronization\r\n   */\r\n  public stop(): void {\r\n    if (this.syncInterval) {\r\n      clearInterval(this.syncInterval);\r\n      this.syncInterval = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if sync is currently in progress\r\n   */\r\n  public isSyncing(): boolean {\r\n    return this.syncing;\r\n  }\r\n\r\n  /**\r\n   * Trigger immediate synchronization\r\n   * \r\n   * Sync Algorithm:\r\n   * 1. Check connectivity\r\n   * 2. Upload pending changes from queue (FIFO order)\r\n   * 3. Handle conflicts with last-write-wins\r\n   * 4. Download updates since last sync timestamp\r\n   * 5. Update local storage with fresh data\r\n   * 6. Update sync metadata (last sync time)\r\n   */\r\n  public async syncNow(): Promise<SyncResult> {\r\n    // Prevent concurrent syncs\r\n    if (this.syncing) {\r\n      return {\r\n        success: false,\r\n        uploaded: 0,\r\n        downloaded: 0,\r\n        conflicts: 0,\r\n        errors: [\r\n          {\r\n            id: Date.now().toString(),\r\n            changeId: '',\r\n            error: 'Sync already in progress',\r\n            timestamp: new Date(),\r\n            retries: 0,\r\n          },\r\n        ],\r\n      };\r\n    }\r\n\r\n    this.syncing = true;\r\n\r\n    try {\r\n      // Step 1: Check connectivity\r\n      const isOnline = await this.network.checkConnectivity();\r\n      if (!isOnline) {\r\n        return {\r\n          success: false,\r\n          uploaded: 0,\r\n          downloaded: 0,\r\n          conflicts: 0,\r\n          errors: [\r\n            {\r\n              id: Date.now().toString(),\r\n              changeId: '',\r\n              error: 'No network connectivity',\r\n              timestamp: new Date(),\r\n              retries: 0,\r\n            },\r\n          ],\r\n        };\r\n      }\r\n\r\n      const result: SyncResult = {\r\n        success: true,\r\n        uploaded: 0,\r\n        downloaded: 0,\r\n        conflicts: 0,\r\n        errors: [],\r\n      };\r\n\r\n      // Step 2: Upload pending changes (priority: upload before download)\r\n      const uploadResult = await this.uploadPendingChanges();\r\n      result.uploaded = uploadResult.uploaded;\r\n      result.conflicts = uploadResult.conflicts;\r\n      result.errors.push(...uploadResult.errors);\r\n\r\n      // Step 3: Download updates since last sync\r\n      const downloadResult = await this.downloadUpdates();\r\n      result.downloaded = downloadResult.downloaded;\r\n      result.errors.push(...downloadResult.errors);\r\n\r\n      // Step 4: Update sync metadata\r\n      await this.updateSyncMetadata(result);\r\n\r\n      // If there were any errors, mark as partial success\r\n      if (result.errors.length > 0) {\r\n        result.success = false;\r\n      }\r\n\r\n      return result;\r\n    } catch (error) {\r\n      console.error('Sync failed:', error);\r\n      return {\r\n        success: false,\r\n        uploaded: 0,\r\n        downloaded: 0,\r\n        conflicts: 0,\r\n        errors: [\r\n          {\r\n            id: Date.now().toString(),\r\n            changeId: '',\r\n            error: error instanceof Error ? error.message : 'Unknown error',\r\n            timestamp: new Date(),\r\n            retries: 0,\r\n          },\r\n        ],\r\n      };\r\n    } finally {\r\n      this.syncing = false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Queue a change for later synchronization\r\n   * Called when operations are performed offline\r\n   */\r\n  public async queueChange(change: PendingChange): Promise<void> {\r\n    const queue = await this.getPendingChanges();\r\n    queue.push(change);\r\n    await this.storage.save(SYNC_QUEUE, queue);\r\n\r\n    // Update metadata\r\n    const metadata = await this.getSyncMetadata();\r\n    metadata.pendingChanges = queue.length;\r\n    await this.storage.save(SYNC_METADATA, metadata);\r\n  }\r\n\r\n  /**\r\n   * Get all pending changes from the queue\r\n   */\r\n  public async getPendingChanges(): Promise<PendingChange[]> {\r\n    const queue = await this.storage.get<PendingChange[]>(SYNC_QUEUE);\r\n    return queue || [];\r\n  }\r\n\r\n  /**\r\n   * Get sync metadata\r\n   */\r\n  public async getSyncMetadata(): Promise<SyncMetadata> {\r\n    const metadata = await this.storage.get<SyncMetadata>(SYNC_METADATA);\r\n    return (\r\n      metadata || {\r\n        lastSyncTime: null,\r\n        lastSuccessfulSync: null,\r\n        pendingChanges: 0,\r\n        conflicts: 0,\r\n        errors: [],\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Upload pending changes to the server\r\n   * Uses FIFO order and retry with exponential backoff\r\n   */\r\n  private async uploadPendingChanges(): Promise<{\r\n    uploaded: number;\r\n    conflicts: number;\r\n    errors: SyncError[];\r\n  }> {\r\n    const queue = await this.getPendingChanges();\r\n    const result = {\r\n      uploaded: 0,\r\n      conflicts: 0,\r\n      errors: [] as SyncError[],\r\n    };\r\n\r\n    if (queue.length === 0) {\r\n      return result;\r\n    }\r\n\r\n    const remainingQueue: PendingChange[] = [];\r\n\r\n    // Process each change in FIFO order\r\n    for (const change of queue) {\r\n      try {\r\n        const uploadSuccess = await this.uploadChange(change);\r\n        if (uploadSuccess) {\r\n          result.uploaded++;\r\n        } else {\r\n          // Retry logic\r\n          if (change.retries < this.MAX_RETRIES) {\r\n            change.retries++;\r\n            remainingQueue.push(change);\r\n          } else {\r\n            // Max retries reached, log error\r\n            result.errors.push({\r\n              id: Date.now().toString(),\r\n              changeId: change.id,\r\n              error: `Max retries (${this.MAX_RETRIES}) reached`,\r\n              timestamp: new Date(),\r\n              retries: change.retries,\r\n            });\r\n          }\r\n        }\r\n      } catch (error) {\r\n        // Handle conflicts\r\n        if (this.isConflictError(error)) {\r\n          result.conflicts++;\r\n          // Apply last-write-wins: if server timestamp > local timestamp, skip\r\n          // Otherwise, retry\r\n          const shouldRetry = await this.resolveConflict(change, error);\r\n          if (shouldRetry && change.retries < this.MAX_RETRIES) {\r\n            change.retries++;\r\n            remainingQueue.push(change);\r\n          }\r\n        } else {\r\n          // Other errors: retry with backoff\r\n          if (change.retries < this.MAX_RETRIES) {\r\n            change.retries++;\r\n            remainingQueue.push(change);\r\n          } else {\r\n            result.errors.push({\r\n              id: Date.now().toString(),\r\n              changeId: change.id,\r\n              error: error instanceof Error ? error.message : 'Unknown error',\r\n              timestamp: new Date(),\r\n              retries: change.retries,\r\n            });\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // Update queue with remaining changes\r\n    await this.storage.save(SYNC_QUEUE, remainingQueue);\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Upload a single change to the server\r\n   */\r\n  private async uploadChange(change: PendingChange): Promise<boolean> {\r\n    // Apply exponential backoff for retries\r\n    if (change.retries > 0) {\r\n      const backoffMs = this.INITIAL_BACKOFF_MS * Math.pow(2, change.retries - 1);\r\n      await this.sleep(backoffMs);\r\n    }\r\n\r\n    try {\r\n      const endpoint = this.getEndpointForEntity(change.entity);\r\n\r\n      switch (change.type) {\r\n        case 'create':\r\n          await this.network.post(endpoint, change.data);\r\n          break;\r\n        case 'update':\r\n          await this.network.patch(`${endpoint}/${change.data.id}`, change.data);\r\n          break;\r\n        case 'delete':\r\n          await this.network.delete(`${endpoint}/${change.data.id}`);\r\n          break;\r\n      }\r\n\r\n      return true;\r\n    } catch (error) {\r\n      console.error(`Failed to upload change ${change.id}:`, error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Download updates from the server since last sync\r\n   */\r\n  private async downloadUpdates(): Promise<{\r\n    downloaded: number;\r\n    errors: SyncError[];\r\n  }> {\r\n    const result = {\r\n      downloaded: 0,\r\n      errors: [] as SyncError[],\r\n    };\r\n\r\n    try {\r\n      const metadata = await this.getSyncMetadata();\r\n      const lastSyncTime = metadata.lastSuccessfulSync;\r\n\r\n      // Download updates for each entity type\r\n      const entities: Array<PendingChange['entity']> = [\r\n        'patient',\r\n        'appointment',\r\n        'consultation',\r\n        'message',\r\n        'settings',\r\n      ];\r\n\r\n      for (const entity of entities) {\r\n        try {\r\n          const updates = await this.downloadEntityUpdates(entity, lastSyncTime);\r\n          result.downloaded += updates;\r\n        } catch (error) {\r\n          result.errors.push({\r\n            id: Date.now().toString(),\r\n            changeId: '',\r\n            error: `Failed to download ${entity} updates: ${\r\n              error instanceof Error ? error.message : 'Unknown error'\r\n            }`,\r\n            timestamp: new Date(),\r\n            retries: 0,\r\n          });\r\n        }\r\n      }\r\n    } catch (error) {\r\n      result.errors.push({\r\n        id: Date.now().toString(),\r\n        changeId: '',\r\n        error: error instanceof Error ? error.message : 'Unknown error',\r\n        timestamp: new Date(),\r\n        retries: 0,\r\n      });\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Download updates for a specific entity type\r\n   */\r\n  private async downloadEntityUpdates(\r\n    entity: PendingChange['entity'],\r\n    since: Date | null\r\n  ): Promise<number> {\r\n    const endpoint = this.getEndpointForEntity(entity);\r\n    const params = since ? `?since=${since.toISOString()}` : '';\r\n\r\n    try {\r\n      const updates = await this.network.get<any[]>(`${endpoint}${params}`);\r\n\r\n      if (!updates || updates.length === 0) {\r\n        return 0;\r\n      }\r\n\r\n      // Save updates to local storage\r\n      for (const item of updates) {\r\n        const key = this.getStorageKeyForEntity(entity, item.id);\r\n        await this.storage.save(key, item);\r\n      }\r\n\r\n      // Update collection cache\r\n      const collectionKey = this.getCollectionKeyForEntity(entity);\r\n      await this.storage.save(collectionKey, updates);\r\n\r\n      return updates.length;\r\n    } catch (error) {\r\n      console.error(`Failed to download ${entity} updates:`, error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update sync metadata after sync operation\r\n   */\r\n  private async updateSyncMetadata(result: SyncResult): Promise<void> {\r\n    const metadata = await this.getSyncMetadata();\r\n\r\n    metadata.lastSyncTime = new Date();\r\n    if (result.success) {\r\n      metadata.lastSuccessfulSync = new Date();\r\n    }\r\n\r\n    const queue = await this.getPendingChanges();\r\n    metadata.pendingChanges = queue.length;\r\n    metadata.conflicts += result.conflicts;\r\n\r\n    // Keep only recent errors (last 10)\r\n    metadata.errors = [...result.errors, ...metadata.errors].slice(0, 10);\r\n\r\n    await this.storage.save(SYNC_METADATA, metadata);\r\n  }\r\n\r\n  /**\r\n   * Resolve conflict using last-write-wins strategy\r\n   * Returns true if should retry, false if should skip\r\n   */\r\n  private async resolveConflict(\r\n    change: PendingChange,\r\n    error: any\r\n  ): Promise<boolean> {\r\n    // Extract server timestamp from error (if available)\r\n    const serverTimestamp = this.extractServerTimestamp(error);\r\n\r\n    if (!serverTimestamp) {\r\n      // Can't determine, retry\r\n      return true;\r\n    }\r\n\r\n    // Last-write-wins: if local timestamp > server timestamp, retry\r\n    // Otherwise, skip (server version is newer)\r\n    const shouldRetry = change.timestamp > serverTimestamp;\r\n\r\n    if (!shouldRetry) {\r\n      console.log(\r\n        `Conflict resolved: Server version is newer for change ${change.id}`\r\n      );\r\n    }\r\n\r\n    return shouldRetry;\r\n  }\r\n\r\n  /**\r\n   * Check if error is a conflict error\r\n   */\r\n  private isConflictError(error: any): boolean {\r\n    // Check for common conflict indicators\r\n    if (error?.status === 409) return true;\r\n    if (error?.code === 'CONFLICT') return true;\r\n    if (error?.message?.includes('conflict')) return true;\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Extract server timestamp from error response\r\n   */\r\n  private extractServerTimestamp(error: any): number | null {\r\n    try {\r\n      if (error?.data?.timestamp) {\r\n        return new Date(error.data.timestamp).getTime();\r\n      }\r\n      if (error?.response?.data?.timestamp) {\r\n        return new Date(error.response.data.timestamp).getTime();\r\n      }\r\n    } catch {\r\n      // Ignore parsing errors\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Get API endpoint for entity type\r\n   */\r\n  private getEndpointForEntity(entity: PendingChange['entity']): string {\r\n    const endpoints: Record<PendingChange['entity'], string> = {\r\n      patient: '/api/patients',\r\n      appointment: '/api/appointments',\r\n      consultation: '/api/consultations',\r\n      message: '/api/messages',\r\n      settings: '/api/settings',\r\n    };\r\n    return endpoints[entity];\r\n  }\r\n\r\n  /**\r\n   * Get storage key for entity\r\n   */\r\n  private getStorageKeyForEntity(\r\n    entity: PendingChange['entity'],\r\n    id: string\r\n  ): string {\r\n    return `${entity}s:${id}`;\r\n  }\r\n\r\n  /**\r\n   * Get collection storage key for entity\r\n   */\r\n  private getCollectionKeyForEntity(entity: PendingChange['entity']): string {\r\n    return `${entity}s:all`;\r\n  }\r\n\r\n  /**\r\n   * Sleep utility for backoff\r\n   */\r\n  private sleep(ms: number): Promise<void> {\r\n    return new Promise(resolve => setTimeout(resolve, ms));\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\runtime\\types.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1669,1672],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1669,1672],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":69,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1790,1793],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1790,1793],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":270,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":270,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6201,6204],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6201,6204],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Runtime Detection and Service Abstraction Layer Types\r\n * \r\n * This module defines the TypeScript interfaces for all service abstractions\r\n * that allow the same code to work in both Tauri (desktop) and web environments.\r\n */\r\n\r\n// ============================================================================\r\n// Core Runtime Types\r\n// ============================================================================\r\n\r\nexport type RuntimeEnvironment = 'tauri' | 'web';\r\n\r\nexport interface RequestOptions {\r\n  headers?: Record<string, string>;\r\n  timeout?: number;\r\n  retries?: number;\r\n}\r\n\r\n// ============================================================================\r\n// Storage Service Interface\r\n// ============================================================================\r\n\r\nexport interface StorageService {\r\n  /**\r\n   * Retrieve data from storage by key\r\n   */\r\n  get<T>(key: string): Promise<T | null>;\r\n\r\n  /**\r\n   * Save data to storage\r\n   */\r\n  save<T>(key: string, data: T): Promise<void>;\r\n\r\n  /**\r\n   * Delete data from storage by key\r\n   */\r\n  delete(key: string): Promise<void>;\r\n\r\n  /**\r\n   * Clear all data from storage\r\n   */\r\n  clear(): Promise<void>;\r\n\r\n  /**\r\n   * Get all storage keys\r\n   */\r\n  keys(): Promise<string[]>;\r\n}\r\n\r\n// ============================================================================\r\n// Network Service Interface\r\n// ============================================================================\r\n\r\nexport interface NetworkService {\r\n  /**\r\n   * Perform a GET request\r\n   */\r\n  get<T>(url: string, options?: RequestOptions): Promise<T>;\r\n\r\n  /**\r\n   * Perform a POST request\r\n   */\r\n  post<T>(url: string, body: any, options?: RequestOptions): Promise<T>;\r\n\r\n  /**\r\n   * Perform a PATCH request\r\n   */\r\n  patch<T>(url: string, body: any, options?: RequestOptions): Promise<T>;\r\n\r\n  /**\r\n   * Perform a DELETE request\r\n   */\r\n  delete<T>(url: string, options?: RequestOptions): Promise<T>;\r\n\r\n  /**\r\n   * Check network connectivity\r\n   */\r\n  checkConnectivity(): Promise<boolean>;\r\n}\r\n\r\n// ============================================================================\r\n// PDF Service Interface\r\n// ============================================================================\r\n\r\nexport interface PDFService {\r\n  /**\r\n   * Generate a prescription PDF\r\n   */\r\n  generatePrescription(data: PrescriptionData): Promise<PDFResult>;\r\n\r\n  /**\r\n   * Generate a medical history PDF\r\n   */\r\n  generateMedicalHistory(data: MedicalHistoryData): Promise<PDFResult>;\r\n}\r\n\r\nexport interface PrescriptionData {\r\n  patient: PatientInfo;\r\n  doctor: DoctorInfo;\r\n  medications: Medication[];\r\n  date: Date;\r\n  clinicLogo?: string;\r\n}\r\n\r\nexport interface MedicalHistoryData {\r\n  patient: PatientInfo;\r\n  consultations: Consultation[];\r\n  diagnoses: Diagnosis[];\r\n  prescriptions: Prescription[];\r\n  labOrders: LabOrder[];\r\n}\r\n\r\nexport interface PatientInfo {\r\n  id: string;\r\n  firstName: string;\r\n  lastName: string;\r\n  dateOfBirth: Date;\r\n  age: number;\r\n  gender: 'male' | 'female' | 'other';\r\n  phone?: string;\r\n  email?: string;\r\n}\r\n\r\nexport interface DoctorInfo {\r\n  id: string;\r\n  name: string;\r\n  credentials: string;\r\n  specialty: string;\r\n  licenseNumber: string;\r\n  digitalSignature?: string;\r\n}\r\n\r\nexport interface Medication {\r\n  id: string;\r\n  name: string;\r\n  dosage: string;\r\n  frequency: string;\r\n  duration: string;\r\n  instructions?: string;\r\n}\r\n\r\nexport interface Consultation {\r\n  id: string;\r\n  date: Date;\r\n  chiefComplaint: string;\r\n  symptoms: string[];\r\n  physicalExam?: string;\r\n  diagnoses: Diagnosis[];\r\n  prescriptions: Prescription[];\r\n  labOrders: LabOrder[];\r\n  notes?: string;\r\n}\r\n\r\nexport interface Diagnosis {\r\n  id: string;\r\n  icd11Code: string;\r\n  description: string;\r\n  type: 'primary' | 'secondary';\r\n}\r\n\r\nexport interface Prescription {\r\n  id: string;\r\n  medication: string;\r\n  dosage: string;\r\n  frequency: string;\r\n  duration: string;\r\n  instructions?: string;\r\n}\r\n\r\nexport interface LabOrder {\r\n  id: string;\r\n  testName: string;\r\n  labName?: string;\r\n  orderDate: Date;\r\n  status: 'ordered' | 'completed' | 'cancelled';\r\n  results?: string;\r\n  resultDate?: Date;\r\n}\r\n\r\nexport interface PDFResult {\r\n  success: boolean;\r\n  filePath?: string;\r\n  error?: Error;\r\n}\r\n\r\n// ============================================================================\r\n// Notification Service Interface\r\n// ============================================================================\r\n\r\nexport interface NotificationService {\r\n  /**\r\n   * Show a notification\r\n   */\r\n  show(notification: NotificationData): Promise<void>;\r\n\r\n  /**\r\n   * Schedule a notification for later\r\n   */\r\n  schedule(notification: NotificationData, delay: number): Promise<string>;\r\n\r\n  /**\r\n   * Cancel a scheduled notification\r\n   */\r\n  cancel(notificationId: string): Promise<void>;\r\n\r\n  /**\r\n   * Request notification permission\r\n   */\r\n  requestPermission(): Promise<boolean>;\r\n}\r\n\r\nexport interface NotificationData {\r\n  title: string;\r\n  body: string;\r\n  icon?: string;\r\n  action?: NotificationAction;\r\n}\r\n\r\nexport interface NotificationAction {\r\n  type: 'navigate' | 'open_url';\r\n  target: string;\r\n}\r\n\r\n// ============================================================================\r\n// Sync Service Interface\r\n// ============================================================================\r\n\r\nexport interface SyncService {\r\n  /**\r\n   * Start automatic synchronization (every 5 minutes)\r\n   */\r\n  start(): void;\r\n\r\n  /**\r\n   * Stop automatic synchronization\r\n   */\r\n  stop(): void;\r\n\r\n  /**\r\n   * Trigger immediate synchronization\r\n   */\r\n  syncNow(): Promise<SyncResult>;\r\n\r\n  /**\r\n   * Queue a change for later synchronization\r\n   */\r\n  queueChange(change: PendingChange): Promise<void>;\r\n\r\n  /**\r\n   * Get all pending changes\r\n   */\r\n  getPendingChanges(): Promise<PendingChange[]>;\r\n\r\n  /**\r\n   * Check if sync is currently in progress\r\n   */\r\n  isSyncing(): boolean;\r\n\r\n  /**\r\n   * Get sync metadata (last sync time, etc.)\r\n   */\r\n  getSyncMetadata(): Promise<SyncMetadata>;\r\n}\r\n\r\nexport interface PendingChange {\r\n  id: string;\r\n  type: 'create' | 'update' | 'delete';\r\n  entity: 'patient' | 'appointment' | 'consultation' | 'message' | 'settings';\r\n  data: any;\r\n  timestamp: number;\r\n  retries: number;\r\n}\r\n\r\nexport interface SyncResult {\r\n  success: boolean;\r\n  uploaded: number;\r\n  downloaded: number;\r\n  conflicts: number;\r\n  errors: SyncError[];\r\n}\r\n\r\nexport interface SyncError {\r\n  id: string;\r\n  changeId: string;\r\n  error: string;\r\n  timestamp: Date;\r\n  retries: number;\r\n}\r\n\r\nexport interface SyncMetadata {\r\n  lastSyncTime: Date | null;\r\n  lastSuccessfulSync: Date | null;\r\n  pendingChanges: number;\r\n  conflicts: number;\r\n  errors: SyncError[];\r\n}\r\n\r\n// ============================================================================\r\n// Runtime Service Interface\r\n// ============================================================================\r\n\r\nexport interface RuntimeService {\r\n  /**\r\n   * Check if running in Tauri environment\r\n   */\r\n  isTauri(): boolean;\r\n\r\n  /**\r\n   * Check if running in web environment\r\n   */\r\n  isWeb(): boolean;\r\n\r\n  /**\r\n   * Get the current runtime environment\r\n   */\r\n  getEnvironment(): RuntimeEnvironment;\r\n\r\n  /**\r\n   * Get the storage service for the current runtime\r\n   */\r\n  getStorageService(): StorageService;\r\n\r\n  /**\r\n   * Get the network service for the current runtime\r\n   */\r\n  getNetworkService(): NetworkService;\r\n\r\n  /**\r\n   * Get the PDF service for the current runtime\r\n   */\r\n  getPDFService(): PDFService;\r\n\r\n  /**\r\n   * Get the notification service for the current runtime\r\n   */\r\n  getNotificationService(): NotificationService;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\security\\security-notifications.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\security\\session-manager.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\security\\session-tracking.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\security\\two-factor-auth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\services\\appointment-status.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\services\\bcv-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\services\\cedula-validation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\services\\chatbot-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\services\\cie10-database.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\services\\gemini-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\services\\icd-api-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\services\\icd10-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\services\\tauri-api-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\services\\tauri-notification-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\services\\tauri-pdf-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\services\\tauri-sync-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\specialty-theme.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\admin.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\auth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\middleware.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\server.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\activity-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\appointments-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\appointments\\appointments.mutations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\appointments\\appointments.queries.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\appointments\\appointments.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\appointments\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\billing-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\clinic-international-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\clinic-operations-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\clinic-rcm-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\clinics-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\dashboard-preferences-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\doctor-documents-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\doctor-verification-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\doctors-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\documents-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\health-metrics-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\health-metrics\\health-metrics.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\laboratory-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\medical-records-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\medications-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\medications\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\medications\\medications.mutations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\medications\\medications.queries.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\medications\\medications.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\messaging-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\prescriptions-advanced\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\prescriptions-advanced\\prescriptions.mutations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\prescriptions-advanced\\prescriptions.queries.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\profile-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\public-pages.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\settings-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\signatures\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\statistics-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\storage-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\telemedicine-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\telemedicine\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\telemedicine\\telemedicine.mutations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\telemedicine\\telemedicine.queries.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\services\\telemedicine\\telemedicine.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\types\\api.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\types\\appointments.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\types\\common.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\types\\database.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\types\\doctors.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\types\\health-metrics.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\types\\laboratory.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\types\\medical-records.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\types\\medications.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\types\\messaging.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\types\\prescriptions-advanced.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":333,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":333,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8755,8758],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8755,8758],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":362,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":362,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9504,9507],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9504,9507],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Tipos TypeScript para el Sistema de Recetas Médicas Avanzado\n * Incluye templates, firmas digitales, escaneos OCR e impresiones\n */\n\n// ============================================================================\n// PRESCRIPTION TEMPLATES\n// ============================================================================\n\nexport type TemplateType = 'sistema' | 'personalizado' | 'escaneado';\nexport type TemplateCategory = 'general' | 'pediatria' | 'cardiologia' | 'medicina-interna' | 'otro';\nexport type Orientation = 'portrait' | 'landscape';\n\nexport interface PatientField {\n  field: string;\n  required: boolean;\n  label: string;\n}\n\nexport interface LayoutConfig {\n  show_logo: boolean;\n  show_header: boolean;\n  show_medico_name: boolean;\n  show_medico_specialty: boolean;\n  show_medico_address: boolean;\n  show_patient_details: boolean;\n  show_patient_fields: string[];\n  show_horario: boolean;\n  show_firma: boolean;\n  show_instrucciones: boolean;\n  show_footer: boolean;\n  orientation: Orientation;\n}\n\nexport interface CustomStyles {\n  primary_color: string;\n  secondary_color: string;\n  font_family: string;\n  font_size: number;\n  line_height: number;\n}\n\nexport interface HeaderConfig {\n  logo_type: 'esculapio' | 'custom' | 'none';\n  logo_url?: string | null;\n  show_medico_data: boolean;\n}\n\nexport interface FooterConfig {\n  show_firma: boolean;\n  show_horario: boolean;\n  horario_texto?: string | null;\n  show_instrucciones: boolean;\n}\n\nexport interface PrescriptionTemplate {\n  id: string;\n  medico_id: string | null;\n  nombre: string;\n  descripcion?: string | null;\n  tipo: TemplateType;\n  categoria?: TemplateCategory;\n  layout_config: LayoutConfig;\n  custom_styles: CustomStyles;\n  header_config: HeaderConfig;\n  patient_fields: PatientField[];\n  footer_config: FooterConfig;\n  texto_encabezado?: string | null;\n  texto_pie?: string | null;\n  texto_instrucciones: string;\n  es_predeterminado: boolean;\n  activo: boolean;\n  usos_count: number;\n  created_at: string;\n  updated_at: string;\n}\n\n// ============================================================================\n// DOCTOR SIGNATURES\n// ============================================================================\n\nexport type SignatureType = 'digital' | 'upload' | 'touch';\n\nexport interface DoctorSignature {\n  id: string;\n  medico_id: string;\n  firma_url?: string | null;\n  firma_type: SignatureType;\n  firma_data?: string | null;\n  es_firma_autografa: boolean;\n  fecha_creacion: string;\n  activa: boolean;\n  created_at: string;\n  updated_at: string;\n}\n\n// ============================================================================\n// PRESCRIPTION SCANS\n// ============================================================================\n\nexport type ScanType = 'scan' | 'photo' | 'upload';\n\nexport interface OCRData {\n  patient_name?: string;\n  medications?: string[];\n  diagnosis?: string;\n  raw_text?: string;\n  confidence?: number;\n}\n\nexport interface PrescriptionScan {\n  id: string;\n  medico_id: string;\n  paciente_id?: string | null;\n  imagen_url: string;\n  imagen_type: ScanType;\n  ocr_data?: OCRData | null;\n  procesada: boolean;\n  template_id?: string | null;\n  prescription_id?: string | null;\n  notas?: string | null;\n  fecha_escaneo: string;\n  created_at: string;\n  updated_at: string;\n}\n\n// ============================================================================\n// PRESCRIPTION PRINTS\n// ============================================================================\n\nexport type PrintFormat = 'pdf' | 'print';\n\nexport interface PrescriptionPrint {\n  id: string;\n  prescription_id: string;\n  medico_id: string;\n  template_id?: string | null;\n  formato: PrintFormat;\n  copias: number;\n  ip_address?: string | null;\n  user_agent?: string | null;\n  fecha_impresion: string;\n  created_at: string;\n}\n\n// ============================================================================\n// PRESCRIPTION EXTENSIONS\n// ============================================================================\n\nexport interface PrescriptionExtended {\n  id: string;\n  template_id?: string | null;\n  custom_layout?: LayoutConfig | null;\n  signature_id?: string | null;\n  numero_receta?: string | null;\n  paciente_data?: PatientDataSnapshot | null;\n  medico_data?: MedicoDataSnapshot | null;\n  medicamentos?: PrescriptionMedication[] | null;\n  indicaciones?: string | null;\n  diagnostico?: string | null;\n  fecha_emision?: string | null;\n  estado?: string | null;\n  medico_id?: string | null;\n  paciente_id?: string | null;\n  created_at?: string;\n  updated_at?: string;\n}\n\nexport interface PatientDataSnapshot {\n  id: string;\n  nombre_completo: string;\n  cedula?: string;\n  edad?: number;\n  sexo?: string;\n  peso?: number;\n  email?: string;\n  telefono?: string;\n}\n\nexport interface MedicoDataSnapshot {\n  id: string;\n  nombre_completo: string;\n  especialidad?: string;\n  direccion?: string;\n  telefono?: string;\n  mpps?: string;\n}\n\n// ============================================================================\n// INPUT TYPES\n// ============================================================================\n\nexport interface CreatePrescriptionTemplateInput {\n  nombre: string;\n  descripcion?: string;\n  categoria?: TemplateCategory;\n  layout_config?: Partial<LayoutConfig>;\n  custom_styles?: Partial<CustomStyles>;\n  header_config?: Partial<HeaderConfig>;\n  patient_fields?: PatientField[];\n  footer_config?: Partial<FooterConfig>;\n  texto_encabezado?: string;\n  texto_pie?: string;\n  texto_instrucciones?: string;\n}\n\nexport interface UpdatePrescriptionTemplateInput {\n  nombre?: string;\n  descripcion?: string;\n  categoria?: TemplateCategory;\n  layout_config?: Partial<LayoutConfig>;\n  custom_styles?: Partial<CustomStyles>;\n  header_config?: Partial<HeaderConfig>;\n  patient_fields?: PatientField[];\n  footer_config?: Partial<FooterConfig>;\n  texto_encabezado?: string;\n  texto_pie?: string;\n  texto_instrucciones?: string;\n  activo?: boolean;\n}\n\nexport interface CreatePrescriptionScanInput {\n  paciente_id?: string;\n  imagen_url: string;\n  imagen_type: ScanType;\n  ocr_data?: OCRData;\n  notas?: string;\n}\n\nexport interface CreateDoctorSignatureInput {\n  firma_url?: string;\n  firma_type: SignatureType;\n  firma_data?: string;\n  es_firma_autografa?: boolean;\n}\n\nexport interface UpdateDoctorSignatureInput {\n  firma_url?: string;\n  firma_type?: SignatureType;\n  firma_data?: string;\n  es_firma_autografa?: boolean;\n  activa?: boolean;\n}\n\n// ============================================================================\n// PRINT TYPES\n// ============================================================================\n\nexport interface PrescriptionPrintOptions {\n  template_id?: string;\n  formato?: PrintFormat;\n  copias?: number;\n  include_background?: boolean;\n  high_quality?: boolean;\n}\n\nexport interface PrintData {\n  prescription: PrescriptionExtended;\n  template?: PrescriptionTemplate;\n  signature?: DoctorSignature;\n  doctor: MedicoDataSnapshot;\n  patient: PatientDataSnapshot;\n  medications: PrescriptionMedication[];\n  layout_config: LayoutConfig;\n  custom_styles: CustomStyles;\n}\n\nexport interface PrescriptionMedication {\n  nombre_medicamento: string;\n  dosis: string;\n  frecuencia: string;\n  duracion_dias?: number;\n  instrucciones_especiales?: string;\n}\n\n// ============================================================================\n// PREVIEW TYPES\n// ============================================================================\n\nexport interface TemplatePreview {\n  template: PrescriptionTemplate;\n  preview_url?: string;\n  medico_nombre?: string;\n  usos_count: number;\n}\n\nexport interface PrescriptionPreviewData {\n  paciente: PatientDataSnapshot;\n  medico: MedicoDataSnapshot;\n  medications: PrescriptionMedication[];\n  diagnostico?: string;\n  notas?: string;\n  template?: PrescriptionTemplate;\n  numero_receta?: string;\n  fecha_emision: Date;\n  fecha_vencimiento?: Date;\n}\n\n// ============================================================================\n// FILTER & QUERY TYPES\n// ============================================================================\n\nexport interface TemplateFilters {\n  tipo?: TemplateType;\n  categoria?: TemplateCategory;\n  activo?: boolean;\n  search?: string;\n  medico_id?: string;\n}\n\nexport interface PrescriptionScanFilters {\n  procesada?: boolean;\n  paciente_id?: string;\n  search?: string;\n  fecha_desde?: Date;\n  fecha_hasta?: Date;\n}\n\nexport interface PrescriptionPrintFilters {\n  template_id?: string;\n  formato?: PrintFormat;\n  fecha_desde?: Date;\n  fecha_hasta?: Date;\n}\n\n// ============================================================================\n// RESPONSE TYPES\n// ============================================================================\n\nexport interface ServiceResponse<T> {\n  success: boolean;\n  data?: T;\n  error?: any;\n  message?: string;\n}\n\nexport interface TemplateListResponse {\n  templates: PrescriptionTemplate[];\n  total: number;\n  page: number;\n  per_page: number;\n}\n\nexport interface PrescriptionDetailResponse {\n  prescription: PrescriptionExtended;\n  template?: PrescriptionTemplate;\n  signature?: DoctorSignature;\n  scan?: PrescriptionScan;\n  medications: PrescriptionMedication[];\n  patient: PatientDataSnapshot;\n  doctor: MedicoDataSnapshot;\n}\n\n// ============================================================================\n// ERROR TYPES\n// ============================================================================\n\nexport class PrescriptionError extends Error {\n  constructor(\n    message: string,\n    public code: string,\n    public details?: any\n  ) {\n    super(message);\n    this.name = 'PrescriptionError';\n  }\n}\n\nexport enum PrescriptionErrorCode {\n  TEMPLATE_NOT_FOUND = 'TEMPLATE_NOT_FOUND',\n  INVALID_TEMPLATE_CONFIG = 'INVALID_TEMPLATE_CONFIG',\n  SIGNATURE_NOT_FOUND = 'SIGNATURE_NOT_FOUND',\n  INVALID_SIGNATURE = 'INVALID_SIGNATURE',\n  SCAN_NOT_FOUND = 'SCAN_NOT_FOUND',\n  OCR_PROCESSING_FAILED = 'OCR_PROCESSING_FAILED',\n  PDF_GENERATION_FAILED = 'PDF_GENERATION_FAILED',\n  PRINT_FAILED = 'PRINT_FAILED',\n  UNAUTHORIZED_ACCESS = 'UNAUTHORIZED_ACCESS',\n}\n\n// ============================================================================\n// UTILITY TYPES\n// ============================================================================\n\nexport type PartialBy<T, K extends keyof T> = Omit<T, K> & Partial<Pick<T, K>>;\nexport type Nullable<T> = T | null;\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\supabase\\types\\telemedicine.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\templates\\extended-templates.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\templates\\medical-templates.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\templates\\structured-templates.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\tour-guide\\tours.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\tour-guide\\tours\\appointments-tour.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\tour-guide\\tours\\dashboard-overview.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\tour-guide\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\types\\blog.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\types\\clinic.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\types\\consultation-types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\types\\dashboard-types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\types\\secretary.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\types\\statistics-types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\utils\\date-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\utils\\format-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\validations\\appointment.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\validations\\auth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\validations\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\validations\\medical.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\validations\\patient.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\lib\\validations\\profile.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\next.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\postcss.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\proxy.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\apply-doctor-migration.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\apply-migrations-api.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\apply-preferences-migration.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\apply-security-fixes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\apply-widget-modes-migration.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\check-didit-config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\check-gemini-models.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\check-user-status.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\create-clinic-credentials.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\fix-all-errors.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\generate-specialty-inserts.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\index-knowledge-base.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\index-public-pages.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\inspect-sacs.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\sacs-scraper.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\scrape-sacs-simple.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\scrape-sacs.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\sync-specialties-to-db.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\sync-user-roles.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\tauri-build.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\test-bcv-simple.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\test-consulta-build.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\test-email-validation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\test-hero-usability.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\test-icd11-api.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\test-phone-prefix.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\test-register-users.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\test-sacs-ajax.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\test-sacs-final.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\test-sacs-puppeteer.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\test-sacs-scraping.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\test-sacs-simple.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\verificar-cedula-sacs.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\verify-file-sizes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\verify-imports.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\verify-routes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\verify-single-responsibility.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\scripts\\verify-workspace-setup.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\supabase\\functions\\verify-doctor-sacs\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\tailwind.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\test-slug.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\vitest.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Fredd\\Dev\\red-salud\\apps\\web\\vitest.setup.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[324,327],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[324,327],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[694,697],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[694,697],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Vitest Setup File\r\n * \r\n * This file runs before all tests and sets up the testing environment.\r\n */\r\n\r\nimport { beforeAll, afterAll, vi } from 'vitest';\r\n\r\n// Mock Tauri API for testing\r\nbeforeAll(() => {\r\n  // Mock window.__TAURI__ for environment detection\r\n  if (typeof window !== 'undefined') {\r\n    (window as any).__TAURI__ = {\r\n      invoke: vi.fn(),\r\n    };\r\n  }\r\n\r\n  // Mock IndexedDB for web storage tests\r\n  if (typeof global !== 'undefined' && !global.indexedDB) {\r\n    // Use fake-indexeddb if needed\r\n    // For now, we'll rely on jsdom's IndexedDB implementation\r\n  }\r\n});\r\n\r\nafterAll(() => {\r\n  // Cleanup\r\n  if (typeof window !== 'undefined') {\r\n    delete (window as any).__TAURI__;\r\n  }\r\n});\r\n\r\n// Suppress console errors during tests (optional)\r\n// global.console = {\r\n//   ...console,\r\n//   error: vi.fn(),\r\n//   warn: vi.fn(),\r\n// };\r\n","usedDeprecatedRules":[]}]
