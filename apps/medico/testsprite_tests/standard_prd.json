{
  "meta": {
    "project": "Red Salud",
    "date": "2026-02-14",
    "prepared_by": "Generated by TestSprite"
  },
  "product_overview": "Red Salud is a multi-role healthcare platform (web + desktop) that provides role-based dashboards, E2E prescription flows and specialty-aware clinical workspaces to connect doctors, patients, secretaries and pharmacies with traceability.",
  "core_goals": [
    "Provide secure authentication and role-based access for medico, paciente, secretaria and farmacia.",
    "Deliver an end-to-end prescription flow: doctor issues prescription → patient views → pharmacy validates/dispenses.",
    "Expose specialty-aware dashboards that adapt KPIs and modules automatically per doctor specialty.",
    "Support appointment scheduling and management for clinical workflows.",
    "Enable identity verification for Venezuelan doctors via SACS and persist verification state.",
    "Ensure observable, auditable state changes and quality gates (lint, typecheck, tests)."
  ],
  "features": [
    {
      "name": "Doctor Login",
      "description": "Authentication for doctors using email and password that redirects to the doctor dashboard on success or shows actionable errors on failure.",
      "user_flows": [
        "Navigate to /login/medico -> Fill email input -> Fill password input -> Click login button -> Redirect to /dashboard/medico on success -> See specialty-specific dashboard",
        "Navigate to /login/medico -> Fill email input with invalid email -> Fill password input -> Click login button -> See error on invalid credentials",
        "Navigate to /login/medico -> Fill email input -> Fill password input -> Click login button -> See network error message if sign-in API fails"
      ]
    },
    {
      "name": "Specialty Auto-Detection",
      "description": "Automatically detect the logged-in doctor's specialty from SACS/profile/sub-specialties and load the appropriate specialty dashboard and modules.",
      "user_flows": [
        "Redirect to /dashboard/medico after login -> System requests doctor details from doctor_details -> System auto-detects specialty -> See specialty-specific KPI grid and sidebar modules",
        "Navigate to /dashboard/medico -> System attempts to fetch doctor_details -> If doctor_details is missing or detection fails then show generic dashboard shell with fallback modules and a notification about missing specialty data",
        "Navigate to /dashboard/medico?test=odontologia (dev) -> System uses test param -> See odontology-specific KPIs and modules"
      ]
    },
    {
      "name": "Specialty Dashboard Shell",
      "description": "Generic dashboard shell that renders KPIs, modules and real-time widgets for any detected specialty with pull-to-refresh and sidebar navigation.",
      "user_flows": [
        "Navigate to /dashboard/medico -> See specialty-specific KPI cards (patients seen, satisfaction, etc.) -> Click a module in the sidebar -> See module content load -> Observe real-time appointment updates",
        "Navigate to /dashboard/medico -> KPI resolver queries appointments and patients -> If KPI queries timeout or return error then show KPI loading state and an actionable error message",
        "Navigate to /dashboard/medico -> See KPI cards -> Perform pull-to-refresh -> KPI data reloads successfully"
      ]
    },
    {
      "name": "Custom Dental Dashboard",
      "description": "Odontology-specific dashboard variant with dental modules such as periodontogram, dental imaging and treatment plan management when the specialty detector identifies odontology.",
      "user_flows": [
        "Redirect to /dashboard/medico after login -> System detects odontology specialty -> See dental-specific KPI cards -> Click Periodontograma module in sidebar -> See periodontogram viewer and patient dental record",
        "Navigate to /dashboard/medico -> System detects odontology specialty -> Click Dental Imaging module -> View available dental images and treatment estimates",
        "Navigate to /dashboard/medico -> System detects odontology specialty -> Click Dental Imaging module -> If imaging service fails or resource missing then show a placeholder message and an option to retry or upload image"
      ]
    },
    {
      "name": "Appointment Management",
      "description": "View and manage doctor appointments: calendar views, create/modify/cancel appointments and persist changes to appointments table.",
      "user_flows": [
        "Navigate to /dashboard/medico/citas -> See daily/weekly/monthly calendar view -> Click Create appointment -> Fill appointment details -> Click Save -> See the new appointment appear in the calendar",
        "Navigate to /dashboard/medico/citas -> Click an existing appointment -> Change status or time -> Click Save -> See updated appointment in calendar",
        "Navigate to /dashboard/medico/citas -> Click Create appointment -> Fill invalid or conflicting data -> Click Save -> See validation error and guidance to correct inputs"
      ]
    },
    {
      "name": "Role-Based Access Control",
      "description": "Protect dashboard routes and content by user role; redirect unauthenticated users to login and show 403 for wrong-role access.",
      "user_flows": [
        "Navigate to /dashboard/medico while not authenticated -> Middleware detects no session -> Redirect to /login/medico",
        "Sign in as a medico -> Navigate to /dashboard/medico -> Middleware checks role -> Show medico dashboard",
        "Sign in as a paciente -> Navigate to /dashboard/medico -> Middleware checks role -> Show 403 forbidden page with guidance to go to the correct dashboard"
      ]
    },
    {
      "name": "SACS Verification",
      "description": "Allow Venezuelan doctors to verify identity via SACS by submitting cedula number and receiving a verified badge after backend verification.",
      "user_flows": [
        "Navigate to /dashboard/medico/perfil/setup -> Enter cedula number -> Click Verify -> System posts to /api/sacs/verify -> Receive verification success -> See verified badge on profile and completed professional profile",
        "Navigate to /dashboard/medico/perfil/setup -> Enter cedula number -> Click Verify -> System posts to /api/sacs/verify -> Receive verification failure -> See explanatory error and next steps to retry or contact support",
        "Navigate to /dashboard/medico/perfil/setup -> Leave cedula empty -> Click Verify -> See client-side validation error asking to enter cedula"
      ]
    }
  ],
  "code_summary": {
    "version": "2",
    "type": "frontend",
    "tech_stack": [
      "TypeScript",
      "Next.js 16 (App Router)",
      "React 19",
      "Tailwind CSS 4",
      "Radix UI",
      "shadcn/ui",
      "Supabase (Auth + Database + Realtime)",
      "Framer Motion",
      "Vitest",
      "Tauri (desktop builds)"
    ],
    "routes": [
      {
        "path": "/",
        "file": "app/page.tsx",
        "auth_required": false,
        "description": "Landing page"
      },
      {
        "path": "/login/medico",
        "file": "app/(auth)/login/medico/page.tsx",
        "auth_required": false,
        "description": "Doctor login page"
      },
      {
        "path": "/login/paciente",
        "file": "app/(auth)/login/paciente/page.tsx",
        "auth_required": false,
        "description": "Patient login page"
      },
      {
        "path": "/register",
        "file": "app/(auth)/register/page.tsx",
        "auth_required": false,
        "description": "Registration page"
      },
      {
        "path": "/dashboard/medico",
        "file": "app/dashboard/medico/page.tsx",
        "auth_required": true,
        "description": "Doctor main dashboard - auto-detects specialty and renders specialized UI"
      },
      {
        "path": "/dashboard/medico/citas",
        "file": "app/dashboard/medico/citas/page.tsx",
        "auth_required": true,
        "description": "Doctor appointments management"
      },
      {
        "path": "/dashboard/medico/pacientes",
        "file": "app/dashboard/medico/pacientes/page.tsx",
        "auth_required": true,
        "description": "Doctor patient list"
      },
      {
        "path": "/dashboard/medico/recetas",
        "file": "app/dashboard/medico/recetas/page.tsx",
        "auth_required": true,
        "description": "Digital prescriptions"
      },
      {
        "path": "/dashboard/medico/mensajeria",
        "file": "app/dashboard/medico/mensajeria/page.tsx",
        "auth_required": true,
        "description": "Doctor messaging"
      },
      {
        "path": "/dashboard/medico/estadisticas",
        "file": "app/dashboard/medico/estadisticas/page.tsx",
        "auth_required": true,
        "description": "Doctor statistics"
      },
      {
        "path": "/dashboard/medico/perfil",
        "file": "app/dashboard/medico/perfil/page.tsx",
        "auth_required": true,
        "description": "Doctor profile"
      },
      {
        "path": "/dashboard/medico/perfil/setup",
        "file": "app/dashboard/medico/perfil/setup/page.tsx",
        "auth_required": true,
        "description": "Doctor profile setup and SACS verification"
      },
      {
        "path": "/dashboard/medico/configuracion",
        "file": "app/dashboard/medico/configuracion/page.tsx",
        "auth_required": true,
        "description": "Doctor settings"
      },
      {
        "path": "/dashboard/medico/consulta",
        "file": "app/dashboard/medico/consulta/page.tsx",
        "auth_required": true,
        "description": "Clinical consultation workspace"
      },
      {
        "path": "/dashboard/medico/telemedicina",
        "file": "app/dashboard/medico/telemedicina/page.tsx",
        "auth_required": true,
        "description": "Telemedicine video calls"
      },
      {
        "path": "/dashboard/paciente",
        "file": "app/dashboard/paciente/page.tsx",
        "auth_required": true,
        "description": "Patient dashboard"
      },
      {
        "path": "/dashboard/secretaria",
        "file": "app/dashboard/secretaria/page.tsx",
        "auth_required": true,
        "description": "Secretary dashboard"
      },
      {
        "path": "/dashboard/farmacia",
        "file": "app/dashboard/farmacia/page.tsx",
        "auth_required": true,
        "description": "Pharmacy dashboard"
      }
    ],
    "features": [
      {
        "name": "Doctor Login",
        "description": "Login with email and password for doctors",
        "files": [
          "app/(auth)/login/medico/page.tsx",
          "lib/supabase/client.ts",
          "components/providers/supabase-auth-provider.tsx"
        ],
        "entry_route": "/login/medico",
        "user_interactions": [
          "Fill email input",
          "Fill password input",
          "Click login button",
          "See error on invalid credentials",
          "Redirect to /dashboard/medico on success"
        ],
        "api_calls": [
          {
            "method": "POST",
            "endpoint": "supabase.auth.signInWithPassword"
          }
        ],
        "auth_required": false
      },
      {
        "name": "Specialty Auto-Detection",
        "description": "Automatically detects doctor specialty from SACS data, profile, or sub-specialties and loads the appropriate dashboard",
        "files": [
          "lib/specialties/core/detector.ts",
          "lib/specialties/core/registry.ts",
          "lib/specialties/configs/index.ts",
          "lib/specialties/identity/specialty-identities.ts",
          "lib/specialties/index.ts",
          "app/dashboard/medico/page.tsx"
        ],
        "entry_route": "/dashboard/medico",
        "user_interactions": [
          "Doctor logs in and lands on dashboard",
          "Dashboard automatically shows specialty-specific KPIs",
          "Dashboard shows specialty-specific modules in sidebar",
          "Can test with ?test=odontologia URL param in dev"
        ],
        "api_calls": [
          {
            "method": "GET",
            "endpoint": "supabase.from('doctor_details').select('*,especialidad:specialties(name)')"
          }
        ],
        "auth_required": true
      },
      {
        "name": "Specialty Dashboard Shell",
        "description": "Generic dashboard shell that renders any of 132 specialties with KPI grid, modules, and widgets",
        "files": [
          "components/dashboard/medico/specialty/specialty-dashboard-shell.tsx",
          "components/dashboard/medico/specialty-dashboard-loader.tsx",
          "hooks/dashboard/use-specialty-dashboard.ts",
          "hooks/dashboard/use-specialty-kpis.ts",
          "lib/specialties/data/specialty-kpi-resolver.ts"
        ],
        "entry_route": "/dashboard/medico",
        "user_interactions": [
          "View specialty-specific KPI cards (patients seen, satisfaction, etc.)",
          "Navigate specialty modules via sidebar",
          "See real-time appointment updates",
          "Pull-to-refresh KPI data"
        ],
        "api_calls": [
          {
            "method": "GET",
            "endpoint": "supabase.from('appointments').select('*')"
          },
          {
            "method": "GET",
            "endpoint": "supabase.from('patients').select('*')"
          }
        ],
        "auth_required": true
      },
      {
        "name": "Custom Dental Dashboard",
        "description": "Specialized odontology dashboard with periodontogram, dental imaging, treatment plans",
        "files": [
          "components/dashboard/medico/odontologia/odontologia-dashboard.tsx",
          "components/dashboard/medico/specialty-dashboard-loader.tsx"
        ],
        "entry_route": "/dashboard/medico",
        "user_interactions": [
          "View dental-specific KPIs",
          "Access periodontogram module",
          "View dental imaging",
          "Manage treatment estimates"
        ],
        "api_calls": [],
        "auth_required": true
      },
      {
        "name": "Appointment Management",
        "description": "Doctor appointment scheduling, viewing, and management",
        "files": [
          "app/dashboard/medico/citas/page.tsx",
          "lib/supabase/services/appointments-service.ts"
        ],
        "entry_route": "/dashboard/medico/citas",
        "user_interactions": [
          "View daily/weekly/monthly calendar",
          "Create new appointment",
          "Modify appointment status",
          "Cancel appointment"
        ],
        "api_calls": [
          {
            "method": "GET",
            "endpoint": "supabase.from('appointments').select('*')"
          },
          {
            "method": "POST",
            "endpoint": "supabase.from('appointments').insert()"
          }
        ],
        "auth_required": true
      },
      {
        "name": "Role-Based Access Control",
        "description": "Routes protected by user role (medico, paciente, secretaria, admin)",
        "files": [
          "lib/supabase/middleware.ts",
          "app/dashboard/medico/layout.client.tsx"
        ],
        "entry_route": "/dashboard/medico",
        "user_interactions": [
          "Redirect to login if not authenticated",
          "Redirect to correct dashboard based on role",
          "Show 403 if accessing wrong role dashboard"
        ],
        "api_calls": [
          {
            "method": "GET",
            "endpoint": "supabase.from('profiles').select('role')"
          }
        ],
        "auth_required": true
      },
      {
        "name": "SACS Verification",
        "description": "Venezuelan doctors verify their identity via SACS (Sistema de Atención al Ciudadano en Salud)",
        "files": [
          "app/dashboard/medico/perfil/setup/page.tsx",
          "services/sacs-verification/"
        ],
        "entry_route": "/dashboard/medico/perfil/setup",
        "user_interactions": [
          "Enter cedula number",
          "System auto-verifies against SACS API",
          "Complete professional profile",
          "Get verified badge"
        ],
        "api_calls": [
          {
            "method": "POST",
            "endpoint": "/api/sacs/verify"
          }
        ],
        "auth_required": true
      }
    ],
    "known_limitations": [
      {
        "issue": "Custom cardiology dashboard exists but widgets (ECG viewer, alerts) are placeholder UI",
        "location": "components/dashboard/medico/cardiology/cardiologia-dashboard.tsx",
        "impact": "Cardiology doctors see the shell but interactive widgets are not functional"
      },
      {
        "issue": "KPI resolver queries against tables that may not have materialized views yet",
        "location": "lib/specialties/data/specialty-kpi-resolver.ts",
        "impact": "KPI queries may be slow on large datasets without proper indexing/views"
      },
      {
        "issue": "Only 3 specialty overrides exist (odontologia, cardiologia, pediatria) out of 132 specialties",
        "location": "lib/specialties/configs/overrides/",
        "impact": "Most specialties use auto-generated configs without fine-tuned KPIs or widgets"
      }
    ]
  }
}
